TC.control=TC.control||{},TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control"),TC.control.Attribution=function(){var t=this;TC.Control.apply(t,arguments),t.apiAttribution="",t.mainDataAttribution="",t.dataAttributions=t.options.dataAttributions&&t.options.dataAttributions instanceof Array?t.options.dataAttributions:[t.options.dataAttributions]||[]},TC.inherit(TC.control.Attribution,TC.Control),function(){var t=TC.control.Attribution.prototype;t.CLASS="tc-ctl-attrib",t.template=TC.isDebug?TC.apiLocation+"TC/templates/Attribution.html":function(){function i(t,i){return t.w("<div><span>&copy; ").f(i.get(["api"],!1),i,"h",["s"]).w("</span> - ").h("i18n",i,{},{$key:"data"}).w(": <span>").f(i.get(["mainData"],!1),i,"h",["s"]).w("</span>").x(i.get(["otherData"],!1),i,{block:n},{}).w('<div class="tc-ctl-attrib-other tc-collapsed">').s(i.get(["otherData"],!1),i,{block:r},{}).w("</div></div>")}function n(t,i){return t.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",i,{},{$key:"others"}).w("...</span>")}function r(t,i){return t.w("<span>").f(i.getPath(!1,["otherData",i.get(["$idx"],!1)]),i,"h",["s"]).w("</span>").h("sep",i,{block:a},{})}function a(t,i){return t.w(", ")}return dust.register(t.CLASS,i),i.__dustBody=!0,n.__dustBody=!0,r.__dustBody=!0,a.__dustBody=!0,i},t.register=function(t){var i=this;TC.Control.prototype.register.call(i,t),i.apiAttribution=i.map.options.attribution||i.apiAttribution;var n=function(t){if(t){var n=$("<div/>").html($.trim(t.wrap.getAttribution(TC.capabilities[t.url]))).text();if(n)if(/IDENA/.test(n))i.mainDataAttribution='<a href="http://idena.navarra.es/" target="_blank">IDENA</a>';else{for(var r=!1,a=0;a<i.dataAttributions.length;a++)if(n===i.dataAttributions[a]){r=!0;break}r||i.dataAttributions.push(n)}}},r=function(t){if(t){var n=function(){if(t.map.workLayers.length>0){for(var i=t.map.workLayers.slice().reverse(),n=0;n<i.length;n++)if(i[n].url==t.url&&i[n].getVisibility())return!1;return!0}return!0};if(n()){var r=$("<div/>").html($.trim(t.wrap.getAttribution(TC.capabilities[t.url]))).text();if(r){var a=i.dataAttributions.indexOf(r);a>-1&&i.dataAttributions.splice(a,1)}}}};i.render(),t.on(TC.Consts.event.LAYERADD,function(t){t.layer.wrap.getAttribution&&(n(t.layer),i.render())}),t.on(TC.Consts.event.LAYERREMOVE,function(t){t.layer.wrap.getAttribution&&(r(t.layer),i.render())}),t.on(TC.Consts.event.LAYERVISIBILITY,function(t){t.layer.wrap.getAttribution&&(t.layer.getVisibility()?n(t.layer):r(t.layer),i.render())})},t.render=function(t){var i=this;i.renderData({api:i.apiAttribution,mainData:i.mainDataAttribution,otherData:i.dataAttributions},function(){i._$div.find("."+i.CLASS+"-cmd").on(TC.Consts.event.CLICK,function(){i._$div.find("."+i.CLASS+"-other").toggleClass(TC.Consts.classes.COLLAPSED)}),$.isFunction(t)&&t()})}}();