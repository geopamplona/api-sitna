TC.control=TC.control||{},TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control"),function(){TC.control.SWCacheClient=function(){var e=this;e.serviceWorkerEnabled=!1,e._serviceWorkerDeferred=$.Deferred()},TC.inherit(TC.control.SWCacheClient,TC.Control);var e=TC.control.SWCacheClient.prototype;e.CLASS="tc-ctl-swcc",e.register=function(e){var r=this;TC.Control.prototype.register.call(r,e),navigator.serviceWorker?navigator.serviceWorker.register("tc-cb-service-worker.js",{scope:"./"}).then(function(e){r.serviceWorkerEnabled=!0,e.installing?r._serviceWorkerDeferred.resolve(e.installing):e.waiting?r._serviceWorkerDeferred.resolve(e.waiting):e.active&&r._serviceWorkerDeferred.resolve(e.active),console.log(e.scope,"register")},function(e){r.serviceWorkerEnabled=!1,r._serviceWorkerDeferred.reject(),console.error("Could not register service worker: "+e)}):r._serviceWorkerDeferred.reject()},e.getServiceWorker=function(){return this._serviceWorkerDeferred.promise()};var r=function(e,r,t,o){var n="message",i=function c(i){i.data.name===r&&(i.data.action===t&&i.data.event===o?e.resolve(r):"error"===i.data.event&&e.reject(),navigator.serviceWorker.removeEventListener(n,c))};navigator.serviceWorker.addEventListener(n,i)};e.createCache=function(e,t){var o=this,n=$.Deferred();return o.getServiceWorker().then(function(o){var i="create",c=t||{};r(n,e,i,"cached"),o.postMessage({action:i,name:e,list:c.urlList||[],silent:c.silent})},function(){n.resolve(!1)}),n.promise()},e.deleteCache=function(e,t){var o=this,n=$.Deferred();return o.getServiceWorker().then(function(o){var i="delete",c=t||{};r(n,e,i,"deleted"),o.postMessage({action:i,name:e,silent:c.silent})},function(){n.resolve(!1)}),n.promise()}}();