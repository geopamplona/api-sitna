TC.control=TC.control||{},TC.Consts=TC.Consts||{},TC.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize",TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control"),TC.control.Scale=function(){TC.Control.apply(this,arguments)},TC.inherit(TC.control.Scale,TC.Control),function(){var e=TC.control.Scale.prototype;e.CLASS="tc-ctl-scl",e.template=TC.isDebug?TC.apiLocation+"TC/templates/Scale.html":function(){function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><span>1:').h("math",t,{},{key:n,method:"round"}).w('</span> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></div>')}function n(e,t){return e.f(t.get(["scale"],!1),t,"h")}return dust.register(e.CLASS,t),t.__dustBody=!0,n.__dustBody=!0,t},e.render=function(e){var t=this;$("input[type=button]",t._$div).off(),t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize},function(){var n=t._$div.find("span");n.text("1:"+t.format(n.text().substr(2))),t._$div.find('input[type="button"]').on(TC.Consts.event.CLICK,function(){t.setScreenSize.call(t)}),$.isFunction(e)&&e()})},e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);var n=TC.Util.storage.getLocalValue(TC.Consts.SCREEN_SIZE_KEY);n&&(TC.Cfg.screenSize=n),t.render(function(){e.on(TC.Consts.event.ZOOM,function(){delete t.metersPerDegree,t.update()})})},e.update=function(){this.render()},e.setScreenSize=function(){var e=this;TC.prompt(e.getLocaleString("selectScreenSize"),TC.Cfg.screenSize,function(t){t&&(TC.Cfg.screenSize=parseFloat(t),TC.Util.storage.setLocalValue(TC.Consts.SCREEN_SIZE_KEY,TC.Cfg.screenSize),e.update())})},e.getScale=function(e){var t=this,n=0,r=!e&&t.map?t.map.wrap.getResolution():e;if(r&&(n=r*t.getDpi(TC.Cfg.screenSize)/.0254,window.devicePixelRatio&&(n*=window.devicePixelRatio)),t.map&&t.map.wrap.isGeo()){if(!t.metersPerDegree){var i=t.map.getExtent();i&&(t.metersPerDegree=TC.Util.getMetersPerDegree(i))}t.metersPerDegree&&(n*=t.metersPerDegree)}return n},e.getDpi=function(e){var t=this;return t.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/e,t.dpi},e.format=function(e){for(var t=new Number(e).toFixed(0),n=[];t.length>3;){var r=t.length-3;n.unshift(t.substr(r)),t=t.substr(0,r)}return t&&n.unshift(t),n.join(".")}}();