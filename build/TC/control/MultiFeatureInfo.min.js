TC.control=TC.control||{},TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control"),function(){TC.control.MultiFeatureInfo=function(){var t=this;t.lineColor=null,TC.Control.apply(t,arguments),t.modes=t.options.modes||{},"undefined"==typeof t.modes[TC.Consts.geom.POINT]&&(t.modes[TC.Consts.geom.POINT]=!0),"undefined"==typeof t.modes[TC.Consts.geom.POLYGON]&&(t.modes[TC.Consts.geom.POLYGON]=!0),t.fInfoCtrl=null,t.lineFInfoCtrl=null,t.polygonFInfoCtrl=null,t.lastCtrlActive=null,t.listTOCCtrl=null,t.popup=null},TC.inherit(TC.control.MultiFeatureInfo,TC.Control);var t=TC.control.MultiFeatureInfo.prototype;t.CLASS="tc-ctl-m-finfo",t.template=TC.isDebug?TC.apiLocation+"TC/templates/MultiFeatureInfo.html":function(){function o(t,o){return t.w('<div class="tc-ctl-m-finfo-select"><form><span>').h("i18n",o,{},{$key:"selection"}).w("</span>").x(o.get(["pointSelectValue"],!1),o,{block:e},{}).x(o.get(["lineSelectValue"],!1),o,{block:n},{}).x(o.get(["polygonSelectValue"],!1),o,{block:l},{}).w("</form></div>")}function e(t,o){return t.w('<label class="tc-ctl-m-finfo-btn-point" title="').h("i18n",o,{},{$key:"selectionByPoint"}).w('"><input type="radio" name="selectmode" value="').f(o.get(["pointSelectValue"],!1),o,"h").w('" checked /><span class="tc-ctl-btn">').h("i18n",o,{},{$key:"byPoint"}).w("</span></label>")}function n(t,o){return t.w('<label class="tc-ctl-m-finfo-btn-line" title="').h("i18n",o,{},{$key:"selectionByLine"}).w('"><input type="radio" name="selectmode" value="').f(o.get(["lineSelectValue"],!1),o,"h").w('" /><span class="tc-ctl-btn">').h("i18n",o,{},{$key:"byLine"}).w("</span></label>")}function l(t,o){return t.w('<label class="tc-ctl-m-finfo-btn-polygon" title="').h("i18n",o,{},{$key:"selectionByPrecinct"}).w('"><input type="radio" name="selectmode" value="').f(o.get(["polygonSelectValue"],!1),o,"h").w('" /><span class="tc-ctl-btn">').h("i18n",o,{},{$key:"byPrecinct"}).w("</span></label>")}return dust.register(t.CLASS,o),o.__dustBody=!0,e.__dustBody=!0,n.__dustBody=!0,l.__dustBody=!0,o},t.register=function(t){var o=this;TC.Control.prototype.register.call(o,t),t.loaded(function(){var e=[];if(o.modes[TC.Consts.geom.POINT]){var n=$.Deferred();e.push(n),$.when(t.addControl("featureInfo",{displayMode:o.options.displayMode})).then(function(t){o.fInfoCtrl=t,n.resolve()})}if(o.modes[TC.Consts.geom.POLYLINE]){var l=$.Deferred();e.push(l),$.when(t.addControl("lineFeatureInfo",{displayMode:o.options.displayMode,lineColor:o.lineColor})).then(function(t){o.lineFInfoCtrl=t,l.resolve()})}if(o.modes[TC.Consts.geom.POLYGON]){var i=$.Deferred();e.push(i),$.when(t.addControl("polygonFeatureInfo",{displayMode:o.options.displayMode,lineColor:o.lineColor})).then(function(t){o.polygonFInfoCtrl=t,i.resolve()})}$.when.apply(this,e).then(function(){o.fInfoCtrl&&(o.fInfoCtrl.activate(),o.lastCtrlActive=o.fInfoCtrl,o.lastCtrlActive.popup=o.popup)})}),$.when(t.addControl("popup",{closeButton:!0,draggable:o.options.draggable})).then(function(t){o.popup=t,t.caller=o})},t.render=function(t){var o=this;o.lineColor=o.options.lineColor?o.options.lineColor:"#c00";var e={};o.modes[TC.Consts.geom.POINT]&&(e.pointSelectValue=TC.Consts.geom.POINT),o.modes[TC.Consts.geom.POLYLINE]&&(e.lineSelectValue=TC.Consts.geom.POLYLINE),o.modes[TC.Consts.geom.POLYGON]&&(e.polygonSelectValue=TC.Consts.geom.POLYGON),TC.Control.prototype.renderData.call(o,e,function(){var e=function(){switch(this.value){case TC.Consts.geom.POLYLINE:console.log("seleccion por línea"),(o.map.activeControl===o.fInfoCtrl||o.map.activeControl===o.polygonFInfoCtrl)&&o.lineFInfoCtrl.activate(),o.lastCtrlActive=o.lineFInfoCtrl;break;case TC.Consts.geom.POLYGON:console.log("seleccion por polígono"),(o.map.activeControl===o.fInfoCtrl||o.map.activeControl===o.lineFInfoCtrl)&&o.polygonFInfoCtrl.activate(),o.lastCtrlActive=o.polygonFInfoCtrl;break;default:console.log("seleccion por punto"),(o.map.activeControl===o.polygonFInfoCtrl||o.map.activeControl===o.lineFInfoCtrl)&&o.fInfoCtrl.activate(),o.lastCtrlActive=o.fInfoCtrl}};o._$div.find("input[type=radio]").on("change",e),$.isFunction(t)&&t()})},t.activate=function(){var t=this;t.lastCtrlActive&&t.lastCtrlActive.activate()},t.deactivate=function(){var t=this;t.lastCtrlActive.deactivate(!1)},TC.Map.prototype.getDefaultControl=function(){var t=this.getControlsByClass("TC.control.MultiFeatureInfo");return t&&t.length?t[0].lastCtrlActive:(t=this.getControlsByClass("TC.control.FeatureInfo"),t&&t.length?t[0]:null)}}();