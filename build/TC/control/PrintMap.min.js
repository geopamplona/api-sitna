TC.control=TC.control||{},TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control"),TC.control.PrintMap=function(){var t=this;TC.Control.apply(t,arguments)},TC.inherit(TC.control.PrintMap,TC.Control),function(){var t=TC.control.PrintMap.prototype;t.CLASS="tc-ctl-printMap",t.template={},t.template[t.CLASS]=TC.isDebug?TC.apiLocation+"TC/templates/PrintMap.html":function(){function i(t,i){return t.w("<h2>").h("i18n",i,{},{$key:"print"}).w('</h2><div><div class="tc-ctl-printMap-div"><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",i,{},{$key:"title"}).w(':</label><input type="text" class="tc-ctl-printMap-title tc-textbox" maxlength="30" placeholder="').h("i18n",i,{},{$key:"mapTitle"}).w('" /></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",i,{},{$key:"layout"}).w(':</label><select id="print-design" class="tc-combo"><option value="landscape">').h("i18n",i,{},{$key:"landscape"}).w('</option><option value="portrait">').h("i18n",i,{},{$key:"portrait"}).w('</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",i,{},{$key:"size"}).w(':</label><select id="print-size" class="tc-combo"><option value="a4">A4</option><option value="a3">A3</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><button class="tc-ctl-printMap-btn tc-button tc-icon-button" title="').h("i18n",i,{},{$key:"printMap"}).w('">').h("i18n",i,{},{$key:"print"}).w("</button></div></div></div>")}return dust.register(t.CLASS,i),i.__dustBody=!0,i},t.register=function(t){var i=this;TC.Control.prototype.register.call(i,t);var n=function(){var n="?";$.isEmptyObject(TC.Util.getQueryStringParams(window.location.href))||(n="&"),n+="layout=print&orientation="+$("#print-design").val()+"&title="+$("input.tc-ctl-printMap-title").val()+"&size="+$("#print-size").val();var e;e=window.location.hash?window.location.href.replace(window.location.hash,n+window.location.hash):window.location.href+n,i.printWindow&&void 0!==i.printWindow&&i.printWindow.close(),TC.printPreview={},TC.printPreview.refererMap=t;for(var o,r=[],l=0;l<t.workLayers.length;l++)if(o=t.workLayers[l],(o.type===TC.Consts.layerType.VECTOR||o.type===TC.Consts.layerType.WFS)&&o.getVisibility()&&o.features.length>0)for(var a=o.features,p=0;p<a.length;p++){var c=a[p],s={};if(!(TC.feature.Marker&&c instanceof TC.feature.Marker&&c.options.noPrint)){if(c.layer.styles){var d=void 0==c.layer.styles[c.STYLETYPE]?c.layer.styles["polyline"===c.STYLETYPE?"line":c.STYLETYPE]:c.layer.styles["multipolygon"===c.STYLETYPE?"polygon":c.STYLETYPE];for(var y in d)s[y]="function"==typeof d[y]?d[y](c):d[y]}r.push({geometry:c.geometry,CLASSNAME:c.CLASSNAME,options:$.extend({},c.options,s,c.getStyle(),{layer:null})})}}TC.printPreview.mapFeatures=r,i.printWindow=window.open(e,"print"),i.printWindow.onbeforeunload=function(){delete this.printWindow}.bind(this)};i._$div.on("click",".tc-ctl-printMap-btn",n)}}();