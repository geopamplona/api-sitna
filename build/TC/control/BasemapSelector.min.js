TC.control=TC.control||{},TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents"),TC.control.BasemapSelector=function(){var t=this;TC.control.MapContents.apply(t,arguments)},TC.inherit(TC.control.BasemapSelector,TC.control.MapContents),function(){var t=TC.control.BasemapSelector.prototype;t.CLASS="tc-ctl-bms",t.template={},TC.isDebug?(t.template[t.CLASS]=TC.apiLocation+"TC/templates/BasemapSelector.html",t.template[t.CLASS+"-node"]=TC.apiLocation+"TC/templates/BasemapSelectorNode.html"):(t.template[t.CLASS]=function(){function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"backgroundMaps"}).w('</h2><div class="tc-ctl-bms-tree"><form><ul class="tc-ctl-bms-branch">').s(e.get(["baseLayers"],!1),e,{block:a},{}).w("</ul></form></div>")}function a(t,e){return t.p("tc-ctl-bms-node",e,e.rebase(e.getPath(!0,[])),{})}return dust.register(t.CLASS,e),e.__dustBody=!0,a.__dustBody=!0,e},t.template[t.CLASS+"-node"]=function(){function e(t,e){return t.w('<li class="tc-ctl-bms-node" data-tc-layer-name="').f(e.get(["name"],!1),e,"h").w('" data-tc-layer-uid="').f(e.get(["uid"],!1),e,"h").w('"><label').x(e.get(["legend"],!1),e,{block:a},{}).w('><input type="radio" name="bms" value="').f(e.get(["name"],!1),e,"h").w('" /><span>').f(e.get(["title"],!1),e,"h").w("</span></label></li>")}function a(t,e){return t.w(' style="background-size: 100% 100%; background-image: url(').f(e.getPath(!1,["legend","src"]),e,"h").w(')"')}return dust.register(t.CLASS+"-node",e),e.__dustBody=!0,a.__dustBody=!0,e}),t.register=function(t){var e=this;TC.control.MapContents.prototype.register.call(e,t),t.on(TC.Consts.event.BASELAYERCHANGE,function(){e.update()}),e._$div.on("change","input[type=radio]",function(t){var a=$(t.target);Modernizr.canvas||(e._$div.find("label > span").removeClass(TC.Consts.classes.CHECKED),a.next().addClass(TC.Consts.classes.CHECKED));var n=a.closest("li").data("layer");n!=n.map.getBaseLayer()&&n.map.setBaseLayer(n),t.stopPropagation()})},t.update=function(){var t=this;t._$div.find("ul."+t.CLASS+"-branch").children("li").each(function(e,a){var n=$(a),r=n.data("layer"),o=n.find("input[type=radio]").first(),s=t.map.baseLayer===r;o.prop("checked",s),Modernizr.canvas||o.next().toggleClass(TC.Consts.classes.CHECKED,s)}),t.updateScale()},t.updateLayerTree=function(t){var e=this;if(t.isBase&&!t.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(e,t);var a=e.CLASS+"-node";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(a,e.layerTrees[t.id],function(a,n){var r=$(n),o=r.data("tcLayerUid"),s=e._$div.find("."+e.CLASS+"-branch"),l=s.find('li[data-tc-layer-uid="'+o+'"]');1===l.length?l.html(r.html()):(r.data("layer",t),s.append(r)),a&&TC.error(a)}),e.update()})}},t.updateLayerOrder=function(t,e,a){},t.removeLayer=function(t){var e=this;if(t.isBase){var a=e._$div.find("."+e.CLASS+"-branch").children("li");a.each(function(e,a){var n=$(a);return n.data("layer")===t?(n.remove(),!1):void 0})}}}();