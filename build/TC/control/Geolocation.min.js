!function(){Math.hypot=Math.hypot||function(){for(var t=0,e=arguments.length,a=0;e>a;a++){if(arguments[a]===1/0||arguments[a]===-(1/0))return 1/0;t+=arguments[a]*arguments[a]}return Math.sqrt(t)}}(),function(){for(var t=0,e=["ms","moz","webkit","o"],a=!(!window.performance||!window.performance.now),n=0,o=e.length;o>n&&!window.requestAnimationFrame;n+=1)window.requestAnimationFrame=window[e[n]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[e[n]+"CancelAnimationFrame"]||window[e[n]+"CancelRequestAnimationFrame"];if(window.requestAnimationFrame||(window.requestAnimationFrame=function(e,a){var n=(new Date).getTime(),o=Math.max(0,16-(n-t)),i=window.setTimeout(function(){e(n+o)},o);return t=n+o,i}),window.cancelAnimationFrame||(window.cancelAnimationFrame=function(t){clearTimeout(t)}),!a){var i=window.requestAnimationFrame,r=+new Date;window.requestAnimationFrame=function(t,e){var a=function(e){var a=1e12>e?e:e-r;return t(a)};i(a,e)}}}(),TC.control=TC.control||{},TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control"),TC.control.Geolocation=function(t){var e=this;e.$events=$(e),e._classSelector="."+e.CLASS,e.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT_GPX:".tc-btn-export-gpx",EXPORT_KML:".tc-btn-export-kml",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}},TC.Control.apply(e,arguments);var a=t||{};e._$dialogDiv=$(TC.Util.getDiv(a.dialogDiv)),a.dialogDiv||e._$dialogDiv.appendTo("body"),e.delta=500,e.walkingSpeed=5e3,e.gapHill=e.options.gapHill||20},TC.inherit(TC.control.Geolocation,TC.Control),function(){var t=TC.control.Geolocation.prototype;t.CLASS="tc-ctl-geolocation",TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc",TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc",t.template={},TC.isDebug?(t.template[t.CLASS]=TC.apiLocation+"TC/templates/Geolocation.html",t.template[t.CLASS+"-track-node"]=TC.apiLocation+"TC/templates/GeolocationTrackNode.html",t.template[t.CLASS+"-track-snapping-node"]=TC.apiLocation+"TC/templates/GeolocationTrackSnappingNode.html",t.template[t.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/GeolocationDialog.html",t.template[t.CLASS+"-tracking-toast"]=TC.apiLocation+"TC/templates/GeolocationTrackingToast.html"):(t.template[t.CLASS]=function(){function e(t,e){return t.w("<h2>").h("i18n",e,{},{$key:"geo"}).w('</h2><div class="tc-ctl-geolocation-content"> <div class="tc-ctl-geolocation-track"><div class="tc-ctl-geolocation-track-snap-info"></div><div class="tc-ctl-geolocation-info-tracking tc-hidden"><div class="tc-ctl-p-results"><div class="prpanel-group prsidebar-body "><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><label>').h("i18n",e,{},{$key:"geo.mylocation"}).w('</label> <span id="trackingInfoClose" class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",e,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span id="trackingInfoMin" class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",e,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span> </h4></div><div id="results" class="prpanel-collapse"><div class="prpanel-body list-group"> </div> </div></div></div><div id="trackingInfoMax" class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",e,{},{$key:"geo.trk.panel.3"}).w('"><i class="fa fa-list-alt"></i></div></div></div><!-- img se insertan en el div del mapa--> <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;" /> <div class="tc-ctl-geolocation-track-panel-block"><input id="tc-ctl-geolocation-track-panel-opened" type="checkbox" checked/><label for="tc-ctl-geolocation-track-panel-opened" title="').h("i18n",e,{},{$key:"geo.trk.panel.help.1"}).w('">').h("i18n",e,{},{$key:"geo.trk.panel.help.2"}).w('</label><i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="').h("i18n",e,{},{$key:"geo.trk.panel.help.3"}).w('"></i></div><div class="tc-ctl-geolocation-track-mng"><div class="tc-ctl-geolocation-select"><form> <label class="tc-ctl-geolocation-btn-track" title="').h("i18n",e,{},{$key:"geo.track.title"}).w('"><input type="radio" name="mode" value="tracks" /><span>').h("i18n",e,{},{$key:"geo.gps"}).w('</span></label><label class="tc-ctl-geolocation-btn-tracks" title="').h("i18n",e,{},{$key:"geo.tracks.title"}).w('"><input type="radio" name="mode" value="track-available" /><span>').h("i18n",e,{},{$key:"geo.tracks"}).w('</span></label> </form></div> <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden"><i class="tc-ctl-geolocation-track-search-icon"></i><input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="').h("i18n",e,{},{$key:"geo.filter.plhr"}).w('" maxlength="200" /> <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst"><li class="tc-ctl-geolocation-track-available-empty"><span>').h("i18n",e,{},{$key:"geo.noTracks"}).w('</span></li><li class="tc-ctl-geolocation-track-not" hidden><span>').h("i18n",e,{},{$key:"noMatches"}).w('</span></li></ol><div class="tc-ctl-geolocation-track-cnt"><input name="uploaded-file" id="uploaded-file" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml" disabled /><label class="tc-button tc-icon-button" for="uploaded-file" title="').h("i18n",e,{},{$key:"geo.trk.import.upload"}).w('">').h("i18n",e,{},{$key:"geo.trk.import.lbl"}).w('</label></div></div><div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel tc-hidden"> <div class="tc-alert alert-warning tc-hidden"><p id="panel-msg">').h("i18n",e,{},{$key:"geo.trk.panel.1"}).w(" <ul><li>").h("i18n",e,{},{$key:"geo.trk.panel.2"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.3"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.4"}).w("</li><li>").h("i18n",e,{},{$key:"geo.trk.panel.5"}).w('</li></ul></p></div> <div class="tc-ctl-geolocation-track-ui"> <div class="tc-ctl-geolocation-track-render"><input id="tc-ctl-geolocation-track-render" type="checkbox" hidden checked /><label for="tc-ctl-geolocation-track-render" class="tc-ctl-geolocation-track-render" title="').h("i18n",e,{},{$key:"geo.trk.render"}).w('">').h("i18n",e,{},{$key:"geo.trk.render"}).w('</label></div><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="').h("i18n",e,{},{$key:"geo.track.activate.title"}).w('">').h("i18n",e,{},{$key:"geo.track.activate"}).w('</button><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="').h("i18n",e,{},{$key:"geo.track.deactivate.title"}).w('">').h("i18n",e,{},{$key:"geo.track.deactivate"}).w('</button></div><div class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt"><input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="').h("i18n",e,{},{$key:"geo.trk.name.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="').h("i18n",e,{},{$key:"geo.trk.name.save"}).w('"></button><input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="').h("i18n",e,{},{$key:"geo.trk.wyp.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="').h("i18n",e,{},{$key:"geo.trk.wyp.save"}).w('"></button></div></div></div></div></div><!--se inserta en el div del mapa--><div class="tc-ctl-geolocation-track-center tc-hidden"> <button class="tc-ctl-btn tc-button tc-icon-button" title="').h("i18n",e,{},{$key:"geo.trk.center"}).w('"></button></div>')}return dust.register(t.CLASS,e),e.__dustBody=!0,e},t.template[t.CLASS+"-track-node"]=function(){function e(t,e){return t.w('<li data-id="').f(e.get(["id"],!1),e,"h").w('" data-uid="').f(e.get(["uid"],!1),e,"h").w('"><span class="tc-draw tc-selectable" title="').f(e.get(["name"],!1),e,"h").w('">').f(e.get(["name"],!1),e,"h").w('</span><input class="tc-textbox tc-hidden" type="text" value="').f(e.get(["name"],!1),e,"h").w('" /> <button class="tc-btn-simulate" title="').h("i18n",e,{},{$key:"tr.lst.simulate"}).w('"></button><button hidden class="tc-btn-stop" title="').h("i18n",e,{},{$key:"tr.lst.stop"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",e,{},{$key:"tr.lst.edit"}).w('"></button><button hidden class="tc-btn-pause" title="').h("i18n",e,{},{$key:"tr.lst.pause"}).w('"></button> <button hidden class="tc-btn-backward" title="').h("i18n",e,{},{$key:"tr.lst.backward"}).w('"></button><label hidden class="tc-spn-speed" title="').h("i18n",e,{},{$key:"tr.lst.velocity"}).w('"></label><button hidden class="tc-btn-forward" title="').h("i18n",e,{},{$key:"tr.lst.forward"}).w('"></button> <button class="tc-btn-save tc-hidden" title="').h("i18n",e,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",e,{},{$key:"tr.lst.cancel"}).w('"></button><button class="tc-btn-delete" title="').h("i18n",e,{},{$key:"tr.lst.delete"}).w('"></button><button class="tc-btn-export-gpx" title="').h("i18n",e,{},{$key:"tr.lst.exportGPX"}).w('"></button><button class="tc-btn-export-kml" title="').h("i18n",e,{},{$key:"tr.lst.exportKML"}).w('"></button> </li>')}return dust.register(t.CLASS+"-track-node",e),e.__dustBody=!0,e},t.template[t.CLASS+"-track-snapping-node"]=function(){function e(t,e){return t.w("<ul>").x(e.get(["n"],!1),e,{block:a},{}).w("<li> <span>X:</span> ").f(e.get(["x"],!1),e,"h").w(" </li><li> <span>Y:</span> ").f(e.get(["y"],!1),e,"h").w(" </li>").x(e.get(["z"],!1),e,{block:n},{}).x(e.get(["m"],!1),e,{block:i},{}).w("</ul>")}function a(t,e){return t.w("<li> <span>").h("i18n",e,{},{$key:"geo.trk.snapping.name"}).w(":</span> ").f(e.get(["n"],!1),e,"h").w(" </li>")}function n(t,e){return t.h("ne",e,{block:o},{key:e.get(["z"],!1),value:0}).w(" ")}function o(t,e){return t.w("<li> <span>Z:</span> ").f(e.get(["z"],!1),e,"h").w(" </li>")}function i(t,e){return t.w("<li> ").f(e.get(["m"],!1),e,"h").w(" </li>")}return dust.register(t.CLASS+"-track-snapping-node",e),e.__dustBody=!0,a.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,i.__dustBody=!0,e},t.template[t.CLASS+"-dialog"]=function(){function e(t,e){return t.w('<div class="tc-ctl-geolocation-continue-track-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"geo.gps"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><button class="tc-button tc-ctl-geolocation-track-continue"> ').h("i18n",e,{},{$key:"geo.trk.dialog.cnt"}).w(' </button><button class="tc-button tc-ctl-geolocation-track-new"> ').h("i18n",e,{},{$key:"geo.trk.dialog.new"}).w(' </button> <button class="tc-button tc-modal-close"> ').h("i18n",e,{},{$key:"geo.trk.dialog.cancel"}).w(' </button></div></div></div><div class="tc-ctl-geolocation-track-advert-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",e,{},{$key:"geo.track.activate.title"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p id="pageBlurMsg">').h("i18n",e,{},{$key:"geo.trk.page.blur"}).w('</p><p class="tc-ctl-geolocation-track-advertisement p"> <label> <input type="checkbox" name="checkbox" id="advertisement"> ').h("i18n",e,{},{$key:"geo.trk.dialog.advertisement"}).w(' </label> </p></div><div class="tc-modal-footer"><button class="tc-button tc-ctl-geolocation-track-advert-ok"> ').h("i18n",e,{},{$key:"ok"}).w(" </button></div></div></div>")}return dust.register(t.CLASS+"-dialog",e),e.__dustBody=!0,e},t.template[t.CLASS+"-tracking-toast"]=function(){function e(t,e){return t.w("<ul><li><span>X:</span> ").f(e.get(["x"],!1),e,"h").w("<br /><span>Y:</span> ").f(e.get(["y"],!1),e,"h").w("<br />").x(e.get(["z"],!1),e,{block:a},{}).w("</li><li>").x(e.get(["accuracy"],!1),e,{block:n},{}).x(e.get(["speed"],!1),e,{block:o},{}).w("</li></ul>")}function a(t,e){return t.w("<span>Z:</span> ").f(e.get(["z"],!1),e,"h").w(" m<br />")}function n(t,e){return t.w("<span>").h("i18n",e,{},{$key:"geo.trk.accuracy"}).w(":</span> ").f(e.get(["accuracy"],!1),e,"h").w(" m<br />")}function o(t,e){return t.w("<span>").h("i18n",e,{},{$key:"geo.trk.speed"}).w(":</span> ").f(e.get(["speed"],!1),e,"h").w(" km/h<br />")}return dust.register(t.CLASS+"-tracking-toast",e),e.__dustBody=!0,a.__dustBody=!0,n.__dustBody=!0,o.__dustBody=!0,e}),t.register=function(t){var e=this;TC.Control.prototype.register.call(e,t),e.wrap=new TC.wrap.control.Geolocation(e),e.wrap.register(t),t.loaded(function(){$.when(t.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.GPS"})).then(function(t){e.layerGPS=t}),$.when(t.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Tracking"})).then(function(t){e.layerTracking=t}),t.on(TC.Consts.event.FEATURESIMPORT,function(t){var e=this;if(e.isDisabled)/.gpx$/g.test(t.fileName.toLowerCase())&&e.map.toast(e.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(t.fileName&&t.features&&t.features.length>0){var a=/.kml$/g.test(t.fileName.toLowerCase())&&e.importedByMe||!1;if(/.gpx$/g.test(t.fileName.toLowerCase())||a){if(e.layerTrack&&(e.map.removeLayer(e.layerTrack),e.layerTrack=void 0),a){for(var n=0;n<e.map.workLayers.slice().reverse().length;n++){var o=e.map.workLayers.slice().reverse()[n];if(o.title&&o.title.toLowerCase().trim()===t.fileName.toLowerCase().trim()){e.map.removeLayer(o);break}}e.importedByMe=!1}e.getLayer(e.Const.Layers.TRACK).then(function(a){var n=e.getLoadingIndicator().addWait();e.importedFileName=t.fileName;for(var o=0,i=t.features.length;i>o;o++)e.layerTrack.addFeature(t.features[o]);if(e.wrap.processImportedFeatures(n),e.layerTrack){if(e.map&&e.map.layout&&e.map.layout.accordion&&e._$div.hasClass(TC.Consts.classes.COLLAPSED))for(var o=0;o<e.map.controls.length;o++)e.map.controls[o]!==e&&e.map.controls[o]._$div.addClass(TC.Consts.classes.COLLAPSED);e._$div.removeClass(TC.Consts.classes.COLLAPSED),$("."+e.CLASS+"-btn-tracks > span").click(),e.map.$events.trigger($.Event(TC.Consts.event.TOOLSOPEN),{})}})}}}.bind(e)),t.on(TC.Consts.event.LAYERVISIBILITY+" "+TC.Consts.event.LAYEROPACITY+" "+TC.Consts.event.LAYERREMOVE,function(t){var e=this;if(t.layer==e.layerTrack)switch(!0){case t.type+"."+t.namespace===TC.Consts.event.LAYERREMOVE:e.wrap.deactivateSnapping();var a=e.getSelectedTrack();a&&e.clearSelectedTrack(),e.resultsPanelChart&&e.resultsPanelChart.close(),e.layerTrack=void 0;break;case t.opacity>0&&t.opacity<1:return;case 0==t.layer.getVisibility():e.resultsPanelChart&&e.resultsPanelChart.minimize();case 0==t.opacity:e.wrap.deactivateSnapping();break;case 1==t.layer.getVisibility():e.resultsPanelChart&&e.resultsPanelChart.maximize();case 1==t.opacity:e.wrap.activateSnapping()}}.bind(e))})},t.render=function(t){var e=this;e.getRenderedHtml(e.CLASS+"-dialog",null,function(t){e._$dialogDiv.html(t)}).then(function(){TC.Control.prototype.render.call(e,t)})};var e=!0;t.renderData=function(r,s){var c=this,l=function(t,e){return(e.match(/(moveTop.*)/g)||[]).join(" ")};c.trackingActive={isTrackingActive:!1,get:function(){return this.isTrackingActive},set:function(t){switch(this.isTrackingActive=t,c.$geoInfoResult||(c.$geoInfoResult=$("."+c.CLASS+"-info-tracking div.tc-ctl-p-results")),this.isTrackingActive){case!0:c.elevationActiveCollapsed.get()?(c.$geoInfoResult.removeClass(l).addClass("moveTop57"),c.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw"),c.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")):c.elevationActive.get()?(c.$geoInfoResult.removeClass(l).addClass("moveTop159"),c.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw"),c.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")):(c.$geoInfoResult.removeClass(l).addClass("moveTop33"),c.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw"),c.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw"));break;case!1:}}},c.elevationActive={isElevationActive:!1,get:function(){return this.isElevationActive},set:function(t){switch(this.isElevationActive=t,c.$geoInfoResult||(c.$geoInfoResult=$("."+c.CLASS+"-info-tracking div.tc-ctl-p-results")),this.isElevationActive){case!0:c.trackingActive.get()&&(c.$geoInfoResult.removeClass(l).addClass("moveTop159"),c.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw"),c.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw"));break;case!1:c.trackingActive.get()&&(c.$geoInfoResult.removeClass(l).addClass("moveTop33"),c.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw"),c.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw"))}}},c.elevationActiveCollapsed={isElevationActiveCollapsed:!1,get:function(){return this.isElevationActiveCollapsed},set:function(t){switch(this.isElevationActiveCollapsed=t,c.$geoInfoResult||(c.$geoInfoResult=$("."+c.CLASS+"-info-tracking div.tc-ctl-p-results")),this.isElevationActiveCollapsed){case!0:c.trackingActive.get()&&(c.$geoInfoResult.removeClass(l).addClass("moveTop57"),c.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw"),c.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw"));break;case!1:c.trackingActive.get()&&(c.$geoInfoResult.removeClass(l).addClass("moveTop159"),c.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw"),c.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw"))}}};var A=c.Const.Selector;TC.Control.prototype.renderData.call(c,r,function(){var r=c._$div.find(c._classSelector+"-panel");c._$div.find(".tc-ctl-geolocation-select span").on(TC.Consts.event.CLICK,function(t){var e=$(this).closest("label").find("input[type=radio][name=mode]"),a=e.val();r.removeClass(TC.Consts.classes.HIDDEN),r.not(".tc-ctl-geolocation-"+a).addClass(TC.Consts.classes.HIDDEN)}),c.gps={},c.gps.$activateButton=c._$div.find(c._classSelector+"-locate-show"),c.gps.$deactivateButton=c._$div.find(c._classSelector+"-locate-hide"),c.track={},c.track.$activateButton=c._$div.find(c._classSelector+"-track-ui-activate"),c.track.$deactivateButton=c._$div.find(c._classSelector+"-track-ui-deactivate"),c.track.$info=c._$div.find(c._classSelector+"-info-tracking").appendTo(c.map._$div),$(document).on("click","#trackingInfoMin",function(){var t=$(this).closest("div.tc-ctl-p-results");t.find(".prsidebar-body").toggle("slide",function(){t.find(".prcollapsed-max").fadeIn()})}),$(document).on("click","#trackingInfoMax",function(){var t=$(this).closest("div.tc-ctl-p-results");t.find(".prsidebar-body").toggle("slide"),t.find(".prcollapsed-max").hide()}),$(document).on("click","#trackingInfoClose",function(){$(this).closest("div.tc-ctl-p-results").find(".prsidebar-body").fadeOut("slide")}),c.track.$trackSearch=c._$div.find(c._classSelector+"-track-available-srch"),c.track.$trackList=c._$div.find(c._classSelector+"-track-available-lst"),c.track.$trackToolPanelOpened=c._$div.find("#tc-ctl-geolocation-track-panel-opened"),c._$div.find("."+t.CLASS+"-track-panel-help").click(function(){i.call(c)}),c.track.$trackName=c._$div.find(c._classSelector+"-track-title"),c.track.$trackSave=c._$div.find(c._classSelector+"-track-save"),c.track.$trackWPT=c._$div.find(c._classSelector+"-track-waypoint"),c.track.$trackAdd=c._$div.find(c._classSelector+"-track-add-wpt"),c.track.$trackContinue=c._$dialogDiv.find(".tc-ctl-geolocation-track-continue"),c.track.$trackRenew=c._$dialogDiv.find(".tc-ctl-geolocation-track-new"),c.track.$trackClose=c._$dialogDiv.find(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close"),c.track.$trackAddSegment=c._$div.find("#tc-ctl-geolocation-track-segment"),c.track.$trackAdvertisementOK=c._$dialogDiv.find(".tc-ctl-geolocation-track-advert-ok"),c.track.$trackImportFile=c._$div.find(c._classSelector+"-track-import"),TC.Util.detectMobile()&&Modernizr.mq("screen and (max-height: 50em) and (max-width: 50em)")&&c.track.$trackToolPanelOpened.prop("checked",!1),window.File&&window.FileReader&&window.FileList&&window.Blob?(c.track.$trackImportFile.removeAttr("disabled"),c.track.$trackImportFile.on(TC.Consts.event.CLICK,function(t){$(this).wrap("<form>").closest("form").get(0).reset(),$(this).unwrap()}),c.track.$trackImportFile.on("change",function(t){c._cleaning||(c.clear(c.Const.Layers.TRACK),c.map&&(c.map.on(TC.Consts.event.LAYERERROR,a),c.importedByMe=!0,c.map.wrap.loadFiles(t.target.files)))})):console.log("no es posible la importación"),c.gps.$activateButton.on("click",function(){c.activateGPS()}),c.gps.$deactivateButton.on("click",function(){c.deactivateGPS()}),c.track.$activateButton.on("click",function(){c.activateTracking(),n.call(c)}),c.track.$deactivateButton.on("click",function(){c.deactivateTracking(),o.call(c)});var s=function(t){t=t.toLowerCase();var e=c.track.$trackList.find("li").hide(),a=e.filter("li:not([class]),li."+c.Const.Classes.SELECTEDTRACK);if(0===t.length)a.show(),c._$div.find(c._classSelector+"-track-search-icon").css("visibility","visible");else{c._$div.find(c._classSelector+"-track-search-icon").css("visibility","hidden");var n=new RegExp(t,"i");a.each(function(){var t=$(this);t.toggle(n.test(t.children("span").text()))}),0===a.filter(":visible").length&&e.filter('[class^="tc-ctl-geolocation-track-not"]').show()}};c.track.$trackSearch.on("keyup search",function(){s($(this).val().toLowerCase().trim())});try{if(c.track.$trackSearch.has($("::-ms-clear"))){var l;c.track.$trackSearch.on("mouseup",function(t){l=c.track.$trackSearch.val(),""!==l&&setTimeout(function(){var t=c.track.$trackSearch.val();""===t&&s(t)},1)})}}catch(g){}c.track.$trackSave.on("click",$.proxy(c.saveTrack,c)),c.track.$trackAdd.on("click",$.proxy(c.addWaypoint,c));var u=function(t,e){e.is("li")||(e=e.parent()),t?(e.find("input").first().removeClass(TC.Consts.classes.HIDDEN),e.find("span").first().addClass(TC.Consts.classes.HIDDEN),e.find("input").first().focus().val(e.find("span").first().text()),e.find(A.SIMULATE).first().addClass(TC.Consts.classes.HIDDEN),e.find(A.EDIT).first().addClass(TC.Consts.classes.HIDDEN),e.find(A.DELETE).first().addClass(TC.Consts.classes.HIDDEN),e.find(A.DRAW).first().addClass(TC.Consts.classes.HIDDEN),e.find(A.EXPORT_GPX).first().addClass(TC.Consts.classes.HIDDEN),e.find(A.EXPORT_KML).first().addClass(TC.Consts.classes.HIDDEN),e.find(A.SAVE).first().removeClass(TC.Consts.classes.HIDDEN),e.find(A.CANCEL).first().removeClass(TC.Consts.classes.HIDDEN)):(e.find("input").first().addClass(TC.Consts.classes.HIDDEN),e.find("span").first().removeClass(TC.Consts.classes.HIDDEN),e.find(A.SIMULATE).first().removeClass(TC.Consts.classes.HIDDEN),e.find(A.EDIT).first().removeClass(TC.Consts.classes.HIDDEN),e.find(A.DELETE).first().removeClass(TC.Consts.classes.HIDDEN),e.find(A.DRAW).first().removeClass(TC.Consts.classes.HIDDEN),e.find(A.EXPORT_GPX).first().removeClass(TC.Consts.classes.HIDDEN),e.find(A.EXPORT_KML).first().removeClass(TC.Consts.classes.HIDDEN),e.find(A.SAVE).first().addClass(TC.Consts.classes.HIDDEN),e.find(A.CANCEL).first().addClass(TC.Consts.classes.HIDDEN))};c.uiSimulate=function(t,e){var a=[A.SIMULATE,A.EDIT,A.DELETE,A.EXPORT_GPX,A.EXPORT_KML],n=[A.STOP,A.PAUSE,A.BACKWARD,A.FORWARD,A.SPEED],o=e.is("li")?e:e.parent();if(t){for(var i=0;i<a.length;i++)$(o).find(a[i]).first().attr("hidden","hidden");for(var i=0;i<n.length;i++)$(o).find(n[i]).first().removeAttr("hidden")}else{for(var i=0;i<n.length;i++)$(o).find(n[i]).first().attr("hidden","hidden");for(var i=0;i<a.length;i++)$(o).find(a[i]).first().removeAttr("hidden")}},$(document).on("click",A.SIMULATE,function(){var t=c.getLoadingIndicator().addWait();$(this).parent().find(A.SPEED).text("x 1"),$.when(C(c,this)).then(function(){c.getLoadingIndicator().removeWait(t)})}),$(document).on("click",A.DRAW,function(){var t=c.getLoadingIndicator().addWait();$.when(v(c,this)).then(function(){c.getLoadingIndicator().removeWait(t)})}),c.$events.on(c.Const.Event.IMPORTEDTRACK,function(t,e){if(c.isDisabled)c.map.toast(c.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{var a=c.track.$trackList.find('li[data-id="'+e+'"]');v(c,a.find(A.DRAW)),c.track.$trackList.animate({scrollTop:e*a.outerHeight()},"slow")}});var p=function(t,e){for(var a=t.track.$trackList.find("li[data-id]"),n=0;n<a.length;n++){var o=$(a[n]);if(o&&o.attr("data-id")!==e){var i=o.find(A.SIMULATE),r=o.find(A.PAUSE);i.toggleClass(t.Const.Classes.SIMULATIONACTIVATED,!1),i.attr("title",t.getLocaleString("tr.lst.simulate")),r.toggleClass("play",!1),r.attr("title",t.getLocaleString("tr.lst.pause")),t.uiSimulate(!1,o),u(!1,o)}}t.clear(t.Const.Layers.TRACK)},v=function(t,e){var a=$.Deferred(),n=$(e).parent();return setTimeout(function(){n.hasClass(t.Const.Classes.SELECTEDTRACK)?(t.uiSimulate(!1,$(e)),t.clear(t.Const.Layers.TRACK),$(e).attr("title",$(e).text()),t.elevationActive.set(!1),void 0!==t.layerTrack&&(t.map.removeLayer(t.layerTrack),t.layerTrack=void 0)):t.getSelectedTrack().length>0?(p(t,n.attr("data-id")),t.drawTrack(n)):t.drawTrack(n),a.resolve()},0),a.promise()},C=function(t,e){var a=$.Deferred();return setTimeout(function(){var n=$(e).parent();t.getLayer(t.Const.Layers.TRACK).then(function(o){p(t,n.attr("data-id")),t.uiSimulate(!1,t.getSelectedTrack()),$(this).parent().addClass(t.Const.Classes.SELECTEDTRACK),t.uiSimulate(!0,$(e)),t.simulate_paused=!1,t.simulateTrack($(e).parent()),a.resolve()})},0),a.promise()};$(document).on("click",c._classSelector+" "+A.EDIT,function(){u(!0,$(this))}),$(document).on("click",c._classSelector+" "+A.DELETE,function(){c.removeTrack($(this).parent())}),$(document).on("click",c._classSelector+" "+A.SAVE,function(){var t=$(this).parent().find("input").first().val();0==t.trim().length?TC.alert(c.getLocaleString("geo.trk.edit.alert")):(c.editTrackName($(this).parent().attr("data-id"),$(this).parent().find("input").first().val()),u(!1,$(this)))}),$(document).on("click",c._classSelector+" "+A.CANCEL,function(){u(!1,$(this))}),$(document).on("click",c._classSelector+" "+A.EXPORT_GPX+","+c._classSelector+" "+A.EXPORT_KML,function(){var t=this,e="tc-btn-export-",a=$.grep($(this).attr("class").split(" "),function(t){return 0===t.indexOf(e)})[0],n=a.replace(e,"").toUpperCase();c["export"](n,$(this).parent()).then(function(e){if(e){var a=$(t).parent().find("span").first().text(),o=new RegExp(c.Const.SupportedFileExtensions.join("|"),"gi"),i=a.replace(o,"");TC.Util.downloadFile(i+"."+n.toLowerCase(),c.Const.MimeMap[n],e)}else TC.alert(c.getLocaleString("geo.error.export"))})}),$(document).on("click",c._classSelector+" "+A.STOP,function(){c.uiSimulate(!1,$(this)),c.wrap.simulateTrackEnd();var t=$(this).parent().find(A.PAUSE);t.toggleClass("play",!1),t.attr("title",c.getLocaleString("tr.lst.pause")),$(this).parent().find(A.SPEED).text("x 1"),c.simulate_speed=1}),$(document).on("click",c._classSelector+" "+A.PAUSE,function(){c.simulate_paused=!$(this).hasClass("play"),c.simulate_paused&&(c.simulate_pausedElapse=-1),$(this).attr("title",c.getLocaleString(c.simulate_paused?"tr.lst.play":"tr.lst.pause")),$(this).toggleClass("play",c.simulate_paused)});var h=.5;$(document).on("click",c._classSelector+" "+A.BACKWARD,function(){c.simulate_speed=1==c.simulate_speed?h:c.simulate_speed/2,$(c._classSelector+" "+A.FORWARD).removeAttr("disabled"),$(this).parent().find(A.SPEED).text(c.simulate_speed<1?"/ "+1/c.simulate_speed:"x "+c.simulate_speed),.000244140625==c.simulate_speed&&$(this).attr("disabled","disabled")}),$(document).on("click",c._classSelector+" "+A.FORWARD,function(){c.simulate_speed=c.simulate_speed/h,$(this).parent().find(A.SPEED).text(c.simulate_speed<1?"/ "+1/c.simulate_speed:"x "+c.simulate_speed),$(c._classSelector+" "+A.BACKWARD).removeAttr("disabled"),4096==c.simulate_speed&&$(this).attr("disabled","disabled")}),c.track.$trackContinue.on("click",function(){TC.Util.closeModal(),d.call(c)}),c.track.$trackRenew.on("click",function(){delete c.sessionTracking,TC.Util.storage.setSessionLocalValue(c.Const.LocalStorageKey.TRACKINGTEMP,void 0),localforage.removeItem(c.Const.LocalStorageKey.TRACKINGTEMP),TC.Util.closeModal(),d.call(c)}),c.track.$trackClose.on("click",function(){o.call(c)}),c.track.$trackAddSegment.on("click",function(){TC.alert("pendiente"),TC.Util.closeModal()}),c.track.$trackAdvertisementOK.on("click",function(){var t=$(body).find('input[name*="Advertisement"]:checked');if(t.length>0){var e=new $.Deferred;window.localforage?e.resolve():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){e.resolve()}),e.then(function(){localforage.setItem(t.first().attr("name"),!1)})}TC.Util.closeModal()}),c.track.renderTrack=$("#tc-ctl-geolocation-track-render").change(function(){c.track.$activateButton.hasClass(TC.Consts.classes.HIDDEN)&&c.wrap.setTrackOnMapVisibility(this.checked),e=this.checked}),window.localforage?c.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){c.bindTracks()})}),$.isFunction(s)&&s()},t.activate=function(){var t=this;TC.Control.prototype.activate.call(t)},t.deactivate=function(){var t=this;t.clearSelection(),t.deactivateTracking(),TC.Control.prototype.deactivate.call(t)};var a=function(){var t=this;t.map.off(TC.Consts.event.LAYERERROR,a),t.clearFileInput(t.track.$trackImportFile),TC.alert(t.getLocaleString("geo.trk.upload.error3"))},n=function(){var t=this;t.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!0),t.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!1)},o=function(){var t=this;t.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1),t.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)},i=function(){var t=this;t.map.toast(t._$div.find(".alert-warning").html(),{duration:1e4})};t.getLayer=function(t){var e,a=this,n=!0,o="";switch(!0){case t==a.Const.Layers.TRACKING:n=void 0!==a.layerTracking,o="layerTracking";break;case t==a.Const.Layers.TRACK:n=void 0!==a.layerTrack,o="layerTrack",e={line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:3,fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,fontWeight:"bold",labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(t){var e=t.getData().name;return e=e&&(e+"").trim().length>0?(e+"").trim().toLowerCase():""}}};break;case t==a.Const.Layers.GPS:n=void 0!==a.layerGPS,o="layerGPS"}if(this[o]){var i=new $.Deferred;return i.resolve(this[o]),i}if(a.layerPromise&&"resolved"!==a.layerPromise.state())return a.layerPromise;a.layerPromise=new $.Deferred;var r={id:TC.getUID(),type:TC.Consts.layerType.VECTOR,
title:a.getLocaleString("geo")+" - "+t,stealth:!0};return e&&(r.styles=e),$.when(a.map.addLayer(r)).then(function(t){this[o]=t,this[o].map.putLayerOnTop(t),a.layerPromise.resolve(this[o])}.bind(a)),a.layerPromise},t.activateGPS=function(){var t=this;t.deactivateTracking(),T.call(t,t.Const.LocalStorageKey.GPSSHOWADVERTISEMENT),A.apply(t),h.apply(t),t.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!0),t.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!1),t.track.$trackToolPanelOpened.prop("checked")||t.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{}),$.when(t.getLayer(t.Const.Layers.GPS)).then(function(e){if(t.currentPositionWaiting=t.getLoadingIndicator().addWait(),navigator.geolocation){var a={timeout:6e4},n=function(a){a=a.coords,t.geopositionGPS=!0;var n=TC.Util.reproject([a.longitude,a.latitude],"EPSG:4326",t.map.crs);t.getLoadingIndicator().removeWait(t.currentPositionWaiting),e&&e.clearFeatures();var o=function(e){var a=function(t,e){return t instanceof Array?e[0]>=t[0]&&e[0]<=t[2]&&e[1]>=t[1]&&e[1]<=t[3]:!0};return a(t.map.options.maxExtent,e)?!0:!1};o(n)?$.when(e.addCircle([n,a.accuracy]),e.addMarker(n,{title:"GPS",cssClass:TC.Consts.classes.POINT,anchor:[.5,.5]})).then(function(a,n){t.gps.accuracyCircle=a,t.gps.geoPosition=n,t.wrap.pulsated||(t.map.zoomToFeatures(e.features,{animate:!1}),t.wrap.pulsate(a))}):TC.alert(t.getLocaleString("geo.error.out"))};navigator.geolocation?(navigator.geolocation.getCurrentPosition(function(e){t.data=e,n(e),t.currentPosition=navigator.geolocation.watchPosition(n,t.onGeolocateError.bind(t))},t.onGeolocateError.bind(t)),setTimeout(function(){t.data||(t.getLoadingIndicator().removeWait(t.currentPositionWaiting),t.map.toast(t.getLocaleString("geo.error.permission_denied"),{type:TC.Consts.msgType.WARNING}),t.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1),t.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0))},a.timeout+1e3)):alert("not supported")}else t.onGeolocateError()})},t.deactivateGPS=function(){var t=this;return delete t.geopositionGPS,g(),k(),delete t.wrap.pulsated,navigator.geolocation&&t.currentPosition&&navigator.geolocation.clearWatch(t.currentPosition),$.when(t.getLayer(t.Const.Layers.GPS)).then(function(t){t&&t.clearFeatures()}),t.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1),t.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0),t.currentPositionWaiting&&t.getLoadingIndicator().removeWait(t.currentPositionWaiting),!0};var r,s,c,l=function(){var t=this;t.track.$trackToolPanelOpened.prop("checked")||t.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{})},d=function(){var t=this;t.activate(),n.call(t),l.call(t),t.track.$info.find(".prsidebar-body").show(),t.$events.on(t.Const.Event.POSITIONCHANGE,function(e){t.currentPoint=e.pd;var a={},n=TC.Util.getMapLocale(t.map);a.x=Math.round(e.pd.position[0]).toLocaleString(n),a.y=Math.round(e.pd.position[1]).toLocaleString(n),a.z=Math.round(e.pd.altitude).toLocaleString(n),a.accuracy=Math.round(e.pd.accuracy).toLocaleString(n),a.speed=e.pd.speed.toLocaleString(n,{minimumFractionDigits:1,maximumFractionDigits:1}),a&&t.getRenderedHtml(t.CLASS+"-tracking-toast",a,function(e){t.track.$info.find(".prpanel-body").html(e),t.track.$info.hasClass(TC.Consts.classes.HIDDEN)&&t.track.$info.removeClass(TC.Consts.classes.HIDDEN),t.trackingActive.set(!0)}),t.track.$trackName.removeAttr("disabled"),t.track.$trackSave.removeAttr("disabled"),t.track.$trackWPT.removeAttr("disabled"),t.track.$trackAdd.removeAttr("disabled"),TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,t.wrap.formattedToStorage(t.layerTracking))}),t.$events.on(t.Const.Event.STATEUPDATED,function(t){}),t.clear(t.Const.Layers.TRACKING),T.call(t,t.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT),t.wrap.setTracking(!0)},A=function(){var t=this;if(!t.videoScreenOn){var e={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};t.videoScreenOn=document.createElement("video"),t.videoScreenOn.setAttribute("loop",""),t.videoScreenOn.setAttribute("muted",""),t.videoScreenOn.setAttribute("webkit-playsinline",""),t.videoScreenOn.setAttribute("playsinline",""),t.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var a=document.createElement("source");a.src=e.WebM,a.type="video/webm",t.videoScreenOn.appendChild(a);var n=document.createElement("source");n.src=e.MP4,n.type="video/mp4",t.videoScreenOn.appendChild(n)}t.videoScreenOn.play()},g=function(){var t=this;t.videoScreenOn&&t.videoScreenOn.pause()},u=function(){var t=this;return console.log("onWindowBlurred"),console.log("video is: "+t.videoScreenOn.paused),f.apply(t),"Texto de aviso"},p=function(){var t=this;console.log("onWindowFocused"),console.log("video is: "+t.videoScreenOn.paused),t.videoScreenOn.paused&&t.videoScreenOn.play(),m.apply(t),console.log("video is: "+t.videoScreenOn.paused)},v=function(){var t=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var e=0;e<t.length;e++)if(t[e]+"Hidden"in document)return t[e]+"Hidden";return null},C=function(){var t=this,e=v();document[e]||p.apply(t),console.log("video is: "+t.videoScreenOn.paused)},h=function(){var t=this;c||(c=C.bind(t)),r||(r=u.bind(t)),s||(s=p.bind(t)),window.addEventListener("visibilitychange",c,!1),TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)?(window.addEventListener("pagehide",r,!1),window.addEventListener("pageshow",s,!1)):(window.addEventListener("blur",r,!1),window.addEventListener("focus",s,!1))},k=function(){window.removeEventListener("visibilitychange",c,!1),TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)?(window.removeEventListener("pagehide",r,!1),window.removeEventListener("pageshow",s,!1)):(window.removeEventListener("blur",r,!1),window.removeEventListener("focus",s,!1))},f=function(){var t=this,e=TC.Util.storage.getSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP);e&&e.length>0&&localforage.setItem(t.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof e?e:JSON.stringify(e))},m=function(){var t=this;localforage.getItem(t.Const.LocalStorageKey.TRACKINGTEMP).then(function(e){null!==e&&"null"!==e&&e.length>0&&TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,e)})},T=function(t){var e=this,a=new $.Deferred;window.localforage?a.resolve():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){a.resolve()}),a.then(function(){localforage.getItem(t).then(function(a){if(null==a){var n=e._$dialogDiv.find(".tc-ctl-geolocation-track-advert-dialog");n.find('input[type="checkbox"]').first().attr("name",t).removeAttr("checked"),$("#pageBlurMsg").text(TC.Util.detectMobile()?e.getLocaleString("geo.trk.page.blur"):e.getLocaleString("geo.trk.page.blur.desktop")),n.find("h3").text(t==e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?e.getLocaleString("geo.track.activate")+" "+e.getLocaleString("geo.gps"):e.getLocaleString("geo.track.activate.title")),TC.Util.showModal(e._$dialogDiv.find(".tc-ctl-geolocation-track-advert-dialog"))}})}),e.map.toast(e.getLocaleString(TC.Util.detectMobile()?"geo.trk.page.blur":"geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};t.activateTracking=function(){var t=this,e=!0;t.clear(t.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TEST,t.Const.LocalStorageKey.TEST)}catch(a){a.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(t.getLocaleString("geo.error.trackinglocalstorage")):TC.error(a),e=!1}e?(A.apply(t),h.apply(t),t.sessionTracking=TC.Util.storage.getSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP),t.sessionTracking?TC.Util.showModal(t._$dialogDiv.find(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){o.call(t)}}):d.call(t)):o.call(t)},t.deactivateTracking=function(){var t=this,a=function(){return t.track.$info.addClass(TC.Consts.classes.HIDDEN),$("#trackingInfoMax").hide(),f.apply(t),t.wrap.setTracking(!1),delete t.geopositionTracking,e||$(t._classSelector+"-track-render").find("label").click(),g.apply(t),k.apply(t),t.$events.off(t.Const.Event.POSITIONCHANGE),t.$events.off(t.Const.Event.STATEUPDATED),o.call(t),t.trackingActive.set(!1),t.track.$trackName.val(""),t.track.$trackName.attr("disabled","disabled"),t.track.$trackSave.attr("disabled","disabled"),t.track.$trackWPT.val(""),t.track.$trackWPT.attr("disabled","disabled"),t.track.$trackAdd.attr("disabled","disabled"),t.clear(t.Const.Layers.TRACKING),t.clear(t.Const.Layers.GPS),!0};return t.wrap.hasCoordinates()?(t.map.toast(t.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4}),a()):a()},t.getStoredTracks=function(){var t=this,e=new $.Deferred,a=[];return localforage.keys().then(function(n){var o=[];n=n.filter(function(e){return!e.startsWith(t.Const.LocalStorageKey.TRACKINGTEMP)&&e.startsWith(t.Const.LocalStorageKey.TRACKING)?(o.push(new $.Deferred),!0):!1}),0==n.length&&(t.availableTracks=a,e.resolve(a)),o.forEach(function(t,e){localforage.getItem(n[e],function(e,a){t.resolve(a)})}),$.when.apply($,o).then(function(){var n=Array.prototype.slice.call(arguments,0);if(n&&n.length){n.forEach(function(t){var t=JSON.parse(t);t instanceof Array?a=a.concat(t):a.push(t)});var o=S(a);t.availableTracks=o,e.resolve(o)}})}),e};var S=function(t){var e=[];for(var a in t)t[a]&&(e.push(t[a]),e.sort(function(t,e){return t.name.localeCompare(e.name)}));return e};t.setStoredTracks=function(t){var e=this,a=new $.Deferred,n=[];return t.forEach(function(t){n.push(new $.Deferred);var a=n[n.length-1];localforage.setItem(e.Const.LocalStorageKey.TRACKING+"#"+t.uid,JSON.stringify(t),function(t,e){a.resolve(e)})}),$.when.apply($,n).then(function(){e.getStoredTracks().then(function(){e.bindTracks(),a.resolve()})}),a},t.getAvailableTracks=function(){var t=this,e=new $.Deferred;return t.availableTracks?e.resolve(t.availableTracks):t.getStoredTracks().then(function(t){e.resolve(t)}),e},t.bindTracks=function(){var t=this;t.track.$trackList.find('li:not([class^="tc-ctl-geolocation-track-available-empty"])').hide(),t.track.$trackList.find('li[class^="tc-ctl-geolocation-track-available-empty"]').hide(),t.getAvailableTracks().then(function(e){if(w(e))t.track.$trackList.find('li[class^="tc-ctl-geolocation-track-available-empty"]').show(),t.track.$trackSearch.attr("disabled","disabled");else{var a=$(t.getSelectedTrack()[0]).attr("data-uid");t.track.$trackList.find("li[data-id]").remove();for(var n in e)t.getRenderedHtml(t.CLASS+"-track-node",{id:n,uid:e[n].uid,name:e[n].name?e[n].name.trim():""},function(e){t.track.$trackList.append(e)});t.setSelectedTrack(t.track.$trackList.find('li[data-uid="'+a+'"]')),t.track.$trackSearch.removeAttr("disabled")}})},t.simulateTrack=function(t){var e=this;e.simulate_speed=1,e.drawTrack(t,!1),e.wrap.simulateTrack()},t.drawTrack=function(t,e){var a=this;l.call(a),a.getLayer(a.Const.Layers.TRACK).then(function(e){a.setSelectedTrack(t),a.drawTrackingData(t),a.elevationTrack(t),a.activate()})},t.elevationTrack=function(t,e){var a=this;e&&(a.wrap.simulateTrackEnd(),a.uiSimulate(!1,t)),a.onResize||(a.onResize=a.elevationTrack.bind(a,t,!0),window.addEventListener("resize",a.onResize,!1));var n={},o={},i=0;a.chart={coordinates:[]},a.track.elevationChart&&(a.track.elevationChart=a.track.elevationChart.destroy());var r=function(t){var e,r,s=new $.Deferred;return e=[],r=[],a.getTrackingData(t).then(function(t){if(t)for(var c=(new ol.format.GeoJSON).readFeatures(t),l=0;l<c.length;l++){var d=c[l].getGeometry(),A=function(){var t=d.getLength();return parseFloat((t/1e3).toFixed(2))},g=function(){if(d.getLayout()==ol.geom.GeometryLayout.XYZM){var t=d.getLastCoordinate()[3]-d.getFirstCoordinate()[3];return{s:Math.floor(t/1e3%60),m:Math.floor(t/6e4%60),h:Math.floor(t/36e5%24)}}return null},u=function(t){if(t&&t.length>0&&t[0].length>2){for(var e=0,n=0,o=0,i=0,r=0,s=!0,c=0;c<t.length;c++){var l=t[c],d=l[2];0==c&&(o=d,i=d,r=d),i=Math.min(i,d),r=Math.max(r,d);var A=d-o;A>a.gapHill||A>0&&c==t.length-1?(s?e+=A:(n-=i-o,e+=d-i,s=!0),o=d,i=d,r=d):(A<-a.gapHill||0>A&&c==t.length-1)&&(s?(e+=r-o,n-=d-r,s=!1):n-=A,o=d,i=d,r=d)}return{upHill:Math.round(e),downHill:Math.round(n)}}return null};switch(d.getType().toLowerCase()){case"point":continue;case"linestring":o=g(d),i=A(d),n=u(d.getCoordinates()),a.chart.coordinates=a.chart.coordinates.concat(d.getCoordinates());break;case"multilinestring":for(var p,v=d.getLineStrings(),l=0;l<v.length;l++)i+=A(v[l]),v[l].getLayout()==ol.geom.GeometryLayout.XYZM&&(p+=v[l].getLastCoordinate()[3]-v[l].getFirstCoordinate()[3]),a.chart.coordinates=a.chart.coordinates.concat(v[l].getCoordinates());p&&(o=g(p));break;default:return null}if(a.chart.coordinates.length>0){var C=0;e.push(C);for(var l=1;l<=a.chart.coordinates.length-1;l++){var h=a.chart.coordinates[l],k=a.chart.coordinates[l-1];C+=Math.hypot(h[0]-k[0],h[1]-k[1]),e.push(parseFloat(C.toFixed(2)))}}for(var f,m,T=!0,l=0;l<a.chart.coordinates.length;l++){if(!(a.chart.coordinates[l].length>2))return s.resolve(null);var S=Math.round(10*a.chart.coordinates[l][2])/10;T&&S>0&&(T=!1),r.push(S),0==l&&(f=m=S),f=Math.min(f,S),m=Math.max(m,S)}}return r instanceof Array&&0==r.length&&(T=!0),a.chartData=T?null:$.extend({},{time:o,ele:r,x:e,miny:f,maxy:m},n),s.resolve(a.chartData)}),s};r(t).then(function(t){var e=TC.Util.getMapLocale(a.map);if(null!=t){t.time&&(t.time=("00000"+t.time.h).slice(-2)+":"+("00000"+t.time.m).slice(-2)+":"+("00000"+t.time.s).slice(-2));var n=(a.map.options.pointBoundsRadius,document.documentElement.clientWidth/100*40);a.elevationChartSize={height:n>445?128:70,width:n>445?445:n>310?310:215},t=$.extend({},t,{size:{height:a.elevationChartSize.height,width:a.elevationChartSize.width},data:{x:"x",columns:[["x"].concat(t.x),["ele"].concat(t.ele)],types:{ele:"area-spline"},colors:{ele:"url(#grad1)"}},point:{show:!1},axis:{x:{tick:{count:5,format:function(t){t/=1e3;var a,n;return 1>t?(a=Math.round(1e3*t),n=" m"):(a=Math.round(100*t)/100,n=" km"),a=a.toLocaleString(e),a+n}}},y:{padding:{top:0,bottom:0},max:t.maxy,min:t.miny,tick:{count:2,format:function(t){return parseInt(t.toFixed(0)).toLocaleString(e)+"m"}}}}}),a.hasElevation=!0,a.elevationActive.set(!0)}else a.hasElevation=!1,t={msg:a.getLocaleString("geo.trk.chart.chpe.empty")},a.elevationActive.set(!1);a.resultsPanelChart?a.map.$events.trigger($.Event(a.Const.Event.DRAWTRACK),{data:t}):(TC.control.ResultsPanel||TC.syncLoadJS(TC.apiLocation+"TC/control/ResultsPanel"),window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js"),a.resultsPanelChart=new TC.control.ResultsPanel({div:"results-panel",content:"chart",titles:{main:a.getLocaleString("geo.trk.chart.chpe"),max:a.getLocaleString("geo.trk.chart.chpe")},openOn:a.Const.Event.DRAWTRACK,closeOn:a.Const.Event.CLEARTRACK,chart:{ctx:a,onmouseout:TC.control.Geolocation.prototype.removeTooltip,tooltip:TC.control.Geolocation.prototype.getTooltip}}),a.resultsPanelChart.register(a.map),a.resultsPanelChart.render(function(){a.resultsPanelChart.activateSnapping=function(t){a.layerTrack.getVisibility()||0!=a.layerTrack.getOpacity()||a.wrap.deactivateSnapping.call(a.wrap)},a.resultsPanelChart.deactivateSnapping=function(t){a.layerTrack.getVisibility()&&a.layerTrack.getOpacity()>0&&a.wrap.activateSnapping.call(a.wrap)},a.resultsPanelChart._$div.on("mouseover",a.resultsPanelChart.deactivateSnapping),a.resultsPanelChart._$div.on("mouseout",a.resultsPanelChart.activateSnapping),a.track.htmlElevationMarker=document.getElementById("tc-ctl-geolocation-track-elevation-marker"),a.map.on(TC.Consts.event.RESULTSPANELMIN,function(){$(a.wrap.miDiv).hide(),a.elevationActiveCollapsed.set(!0)}),a.map.on(TC.Consts.event.RESULTSPANELMAX,function(){$(a.wrap.miDiv).show(),a.elevationActiveCollapsed.set(!1)}),a.map.on(TC.Consts.event.RESULTSPANELCLOSE,function(){$(a.wrap.miDiv).hide(),a.elevationActive.set(!1)}),a.map.on(TC.Consts.event.DRAWCHART,function(t,e){function n(){d3.select(".c3-axis-x").length&&!d3.select(".c3-axis-x").node()?a.elevationChartLabelsRAF=requestAnimationFrame(n):d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBoundingClientRect().width?a.elevationChartLabelsRAF=requestAnimationFrame(n):(window.cancelAnimationFrame(a.elevationChartLabelsRAF),a.elevationChartLabelsRAF=void 0,(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=a.elevationChartSize.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(a.elevationChartSize.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&g())}var o=e.svg.getElementsByTagName("defs")[0],i="http://www.w3.org/2000/svg",r=document.createElementNS(i,"linearGradient");r.setAttributeNS(null,"id","grad1"),r.setAttributeNS(null,"x1","0%"),r.setAttributeNS(null,"x2","0%"),r.setAttributeNS(null,"y1","0%"),r.setAttributeNS(null,"y2","100%"),r.setAttributeNS(null,"gradientUnits","userSpaceOnUse");var s=document.createElementNS(i,"stop");s.setAttributeNS(null,"offset","0%"),s.setAttributeNS(null,"stop-color","red"),s.setAttributeNS(null,"stop-opacity","0.7"),r.appendChild(s);var c=document.createElementNS(i,"stop");c.setAttributeNS(null,"offset","50%"),c.setAttributeNS(null,"stop-color","orange"),c.setAttributeNS(null,"stop-opacity","0.9"),r.appendChild(c);var l=document.createElementNS(i,"stop");l.setAttributeNS(null,"offset","100%"),l.setAttributeNS(null,"stop-color","green"),l.setAttributeNS(null,"stop-opacity","1"),r.appendChild(l),o.appendChild(r),$(d3.select(".c3-brush").node()).remove(),d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(t){d3.event.stopPropagation();var e=this.chart.coordinates[t.index].slice(0,2);e&&TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){this.map.zoomToFeatures([new TC.feature.Point(e)])}.bind(a))}.bind(a));var d=d3.select(".c3-axis.c3-axis-x").select("path").attr("d"),A=/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(d);if(A)d=d.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10"),d3.select(".c3-axis.c3-axis-x").select("path").attr("d",d);else{var A=/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(d);A&&(d=d.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10"),d3.select(".c3-axis.c3-axis-x").select("path").attr("d",d))}var g=function(){var t=d3.scale.ordinal().rangeRoundBands([0,a.elevationChartSize.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(t,e){t.each(function(){t.each(function(t,e){if(0!=e&&(d3text=d3.select(this),!d3text.attr("edited"))){d3text.attr("edited",!0);var a=d3text.select("tspan").node().cloneNode(),n=d3text.text().split(" ");d3text.select("tspan").text(n[0]),a.textContent=n[1];var o=a.getAttribute("dy");o=o?parseFloat(a.getAttribute("dy")):.71,o=o+.18+"em",a.setAttribute("dy",o),d3text.node().appendChild(a)}})})},t.rangeBand())};d3.select(".c3-axis-x").node().getBoundingClientRect().width?(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=a.elevationChartSize.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(a.elevationChartSize.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&g():(a.elevationChartLabelsRAF&&(window.cancelAnimationFrame(a.elevationChartLabelsRAF),a.elevationChartLabelsRAF=void 0),a.elevationChartLabelsRAF=requestAnimationFrame(n))}),a.map.$events.trigger($.Event(a.Const.Event.DRAWTRACK),{data:t})}))})},t.clear=function(t){var e=this;e.onResize&&(window.removeEventListener("resize",e.onResize,!1),e.onResize=void 0),t==e.Const.Layers.TRACK?(e.resultsPanelChart&&e.resultsPanelChart.close(),delete e.chartData,e.wrap.simulateTrackEnd(),e.track.$trackList.find("li").removeClass(e.Const.Classes.SELECTEDTRACK),void 0!==e.layerTrack&&(e.map.removeLayer(e.layerTrack),e.layerTrack=void 0),e.map.$events.trigger($.Event(e.Const.Event.CLEARTRACK),{})):e.getLayer(t).then(function(t){e.wrap.clear(t)})},t.saveTrack=function(){var t=this,e=new $.Deferred,a=arguments.length>0&&"string"==typeof arguments[0]?arguments[0]:t.getLocaleString("geo.trk.save.alert"),n=function(n){t.getLayer(n).then(function(n){var o;o=t.getLoadingIndicator().addWait();var i=t.importedFileName||t.track.$trackName.val().trim(),r=t.availableTracks;r||(r={});var s=TC.getUID();r.push({name:i,data:t.wrap.formattedToStorage(n,!0),uid:parseInt(s)}),r=S(r);var c=function(e){t.track.$trackName.val(""),t.track.$trackName.attr("disabled","disabled"),t.track.$trackSave.attr("disabled","disabled"),t.track.$trackWPT.val(""),t.track.$trackWPT.attr("disabled","disabled"),t.track.$trackAdd.attr("disabled","disabled"),t.getLoadingIndicator().removeWait(e),l.call(t)};try{t.setStoredTracks(r).then(function(){t.map.toast(a,{duration:3e3}),c(o);for(var n,i=0;i<r.length;i++)if(parseInt(r[i].uid)===parseInt(s)){n=i;break}e.resolve(n)})}catch(d){TC.alert(t.getLocaleString("geo.error.savelocalstorage")+": "+d.message),c(o),e.reject()}})};return t.importedFileName?n(t.Const.Layers.TRACK):0==t.track.$trackName.val().trim().length?(t.track.$trackName.val((new Date).toLocaleString()),n(t.Const.Layers.TRACKING)):n(t.Const.Layers.TRACKING),e},t.addWaypoint=function(){var t=this,e=t.track.$trackWPT.val().trim();e||(e=(new Date).toLocaleString());var a=t.getLoadingIndicator().addWait();l.call(t),t.wrap.addWaypoint(t.currentPoint.position,{name:e,ele:t.currentPoint.heading,time:(new Date).getTime()}),t.track.$trackWPT.val(""),t.track.$trackWPT.attr("disabled","disabled"),t.track.$trackAdd.attr("disabled","disabled"),TC.Util.storage.setSessionLocalValue(t.Const.LocalStorageKey.TRACKINGTEMP,t.wrap.formattedToStorage(t.layerTracking)),t.getLoadingIndicator().removeWait(a)},t.editTrackName=function(t,e){var a=this;a.getAvailableTracks().then(function(n){n&&n[t]&&(n[t].name=e,a.setStoredTracks(n))})},t.removeTrack=function(t){var e=this;e.getAvailableTracks().then(function(a){if(a){var n=$(t).attr("data-id");if(a[n]){var o=a[n].uid;TC.confirm(e.getLocaleString("geo.trk.delete.alert"),function(){e.getSelectedTrack().length>0&&$(e.getSelectedTrack()[0]).attr("data-id")==n&&e.clear(e.Const.Layers.TRACK),localforage.removeItem(e.Const.LocalStorageKey.TRACKING+"#"+o),1==$(t).parent().find('li[class=""]').length?e.getStoredTracks().then(function(){e.bindTracks()}):$(t).remove()},function(){})}}})},t.setSelectedTrack=function(t){var e=this;e.track.$trackList.find("li[data-id] > span").each(function(){$(this).attr("title",$(this).text())}),e.track.$trackList.find("li").removeClass(e.Const.Classes.SELECTEDTRACK),t.addClass(e.Const.Classes.SELECTEDTRACK),$(t).attr("title",e.getLocaleString("tr.lst.clear")+$(t).find("span").text()),$(t).find(e.Const.Selector.DRAW).attr("title",$(t).attr("title"))},t.getSelectedTrack=function(){var t=this;return t.track.$trackList.find("li."+t.Const.Classes.SELECTEDTRACK)},t.clearSelectedTrack=function(){var t=this,e=t.getSelectedTrack();e&&(t.onResize&&(window.removeEventListener("resize",t.onResize,!1),t.onResize=void 0),e.removeClass(t.Const.Classes.SELECTEDTRACK),e.attr("title",e.text()),e.find(t.Const.Selector.DRAW).attr("title",e.attr("title")))},t.clearSelection=function(){var t=this;t.wrap.deactivateSnapping();var e=t.getSelectedTrack();e&&t.clearSelectedTrack(),t.resultsPanelChart&&(t.resultsPanelChart._$div.off("mouseover",t.resultsPanelChart.deactivateSnapping),t.resultsPanelChart._$div.off("mouseout",t.resultsPanelChart.activateSnapping),t.resultsPanelChart.close(),delete t.resultsPanelChart),t.clear(t.Const.Layers.TRACK)},t.drawTrackingData=function(t){var e=this;e.wrap.clear(),e.getTrackingData(t).then(function(t){t&&e.wrap.drawTrackingData(t).then(function(){var t=e.layerTrack.features;if(t&&t.length>0)for(var a,n=0;n<t.length;n++)t[n].STYLETYPE.indexOf("line")>-1&&(a=t[n]),t[n].showsPopup=!1;if(a&&a.geometry){var o=a.geometry[0],i=a.geometry[a.geometry.length-1];o&&o!==i&&e.layerTrack.addMarker(o.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon-end",anchor:[.5,1]}),i&&e.layerTrack.addMarker(i.slice().splice(0,2),{showsPopup:!1,cssClass:e.CLASS+"-track-marker-icon",anchor:[.5,1]})}})})},t.getTrackingData=function(t){var e=this,a=t,n=new $.Deferred;return e.getAvailableTracks().then(function(t){if(t){var e=$(a).attr("data-id");if(t[e])return n.resolve(t[e].data)}return n.resolve()}),n},t["export"]=function(t,e){var a=this;return a.wrap["export"](t,e)},t.getTooltip=function(t){var e=this;return e.wrap.getTooltip(t)},t.removeTooltip=function(){var t=this;$(t.track.htmlElevationMarker).hide()},t.clearFileInput=function(t){var e=$(t);e.wrap("<form>").closest("form").get(0).reset(),e.unwrap()},t.getLoadingIndicator=function(){var t=this;return t.loading||(t.loading=t.map.getControlsByClass(TC.control.LoadingIndicator),t.loading&&t.loading.length>0&&(t.loading=t.loading[0])),t.loading},t.onGeolocateError=function(t){var e=this;navigator.geolocation&&(e.currentPosition&&navigator.geolocation.clearWatch(e.currentPosition),e.currentPositionTrk&&navigator.geolocation.clearWatch(e.currentPositionTrk)),e.currentPositionWaiting&&e.getLoadingIndicator().removeWait(e.currentPositionWaiting);var a;switch(t.code){case t.PERMISSION_DENIED:a=e.getLocaleString("geo.error.permission_denied");break;case t.POSITION_UNAVAILABLE:a=e.getLocaleString("geo.error.position_unavailable");break;case t.TIMEOUT:a=e.getLocaleString("geo.error.timeout");break;default:a=e.getLocaleString("geo.error.default")}e.map.toast(a,{type:TC.Consts.msgType.WARNING}),!e.geopositionTracking&&e.track&&(e.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1),e.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0))};var w=function(t){return!t||0===t.length}}();