function JL(e){if(!e)return JL.__;Array.prototype.reduce||(Array.prototype.reduce=function(e,t){for(var r=t,n=0;n<this.length;n++)r=e(r,this[n],n,this);return r});var t="";return("."+e).split(".").reduce(function(e,r,n,i){t=t?t+("."+r):r;r=e["__"+t];void 0===r&&(JL.Logger.prototype=e,r=new JL.Logger(t),e["__"+t]=r);return r},JL.__)}function phi4z(e,t,r,n,i,a,s,o,l){var c,u,p,h,d,f,m,y,g,v;l=a;for(v=1;15>=v;v++){c=Math.sin(l);p=Math.tan(l);o=p*Math.sqrt(1-e*c*c);u=Math.sin(2*l);h=t*l-r*u+n*Math.sin(4*l)-i*Math.sin(6*l);d=t-2*r*Math.cos(2*l)+4*n*Math.cos(4*l)-6*i*Math.cos(6*l);f=2*h+o*(h*h+s)-2*a*(o*h+1);m=e*u*(h*h+s-2*a*h)/(2*o);y=2*(a-h)*(o*d-2/u)-2*d;g=f/(m+y);l+=g;if(Math.abs(g)<=1e-10)return l}Proj4js.reportError("phi4z: No convergence");return null}function e4fn(e){var t,r;t=1+e;r=1-e;return Math.sqrt(Math.pow(t,t)*Math.pow(r,r))}function xml2json(e){var t={toObj:function(e){var r={};if(1==e.nodeType){if(e.attributes.length)for(var n=0;n<e.attributes.length;n++)"name"!==e.attributes[n].nodeName&&(r[e.attributes[n].nodeName]=(e.attributes[n].nodeValue||"").toString());if(e.firstChild){for(var i=0,a=0,s=!1,o=e.firstChild;o;o=o.nextSibling)1==o.nodeType?s=!0:3==o.nodeType&&o.nodeValue.match(/[^ \f\n\r\t\v]/)?i++:4==o.nodeType&&a++;if(s)if(2>i&&2>a){t.removeWhite(e);for(var o=e.firstChild;o;o=o.nextSibling){var l=t.removePrefix(o.nodeName);if(3==o.nodeType)r["#text"]=t.escape(o.nodeValue);else if(4==o.nodeType)r["#cdata"]=t.escape(o.nodeValue);else if(r[l])r[l]instanceof Array?r[l][r[l].length]=t.toObj(o):r[l]=[r[l],t.toObj(o)];else{var c=null;o.attributes.getNamedItem("name")&&(c=o.attributes.getNamedItem("name").nodeValue),r[c?c:l]=t.toObj(o)}}}else e.attributes.length?r["#text"]=t.escape(t.innerXml(e)):r=t.escape(t.innerXml(e));else if(i)e.attributes.length?r["#text"]=t.escape(t.innerXml(e)):r=t.escape(t.innerXml(e));else if(a)if(a>1)r=t.escape(t.innerXml(e));else for(var o=e.firstChild;o;o=o.nextSibling)r["#cdata"]=t.escape(o.nodeValue)}e.attributes.length||e.firstChild||(r=null)}else 9==e.nodeType?r=t.toObj(e.documentElement):8==e.nodeType?console.log(e.textContent):alert("unhandled node type: "+e.nodeType);return r},toJson:function(e,r,n){var i=r?'"'+r+'"':"";if(e instanceof Array){for(var a=0,s=e.length;s>a;a++)e[a]=t.toJson(e[a],"",n+"	");i+=(r?":[":"[")+(e.length>1?"\n"+n+"	"+e.join(",\n"+n+"	")+"\n"+n:e.join(""))+"]"}else if(null==e)i+=(r&&":")+"null";else if("object"==typeof e){var o=[];for(var l in e)o[o.length]=t.toJson(e[l],l,n+"	");i+=(r?":{":"{")+(o.length>1?"\n"+n+"	"+o.join(",\n"+n+"	")+"\n"+n:o.join(""))+"}"}else i+="string"==typeof e?(r&&":")+'"'+e.toString()+'"':(r&&":")+e.toString();return i},innerXml:function(e){var t="";if("innerHTML"in e)t=e.innerHTML;else for(var r=function(e){var t="";if(1==e.nodeType){t+="<"+e.nodeName;for(var n=0;n<e.attributes.length;n++)t+=" "+e.attributes[n].nodeName+'="'+(e.attributes[n].nodeValue||"").toString()+'"';if(e.firstChild){t+=">";for(var i=e.firstChild;i;i=i.nextSibling)t+=r(i);t+="</"+e.nodeName+">"}else t+="/>"}else 3==e.nodeType?t+=e.nodeValue:4==e.nodeType&&(t+="<![CDATA["+e.nodeValue+"]]>");return t},n=e.firstChild;n;n=n.nextSibling)t+=r(n);return t},escape:function(e){return e.replace(/[\\]/g,"\\\\").replace(/[\"]/g,'\\"').replace(/[\n]/g,"\\n").replace(/[\r]/g,"\\r")},removeWhite:function(e){e.normalize();for(var r=e.firstChild;r;)if(3==r.nodeType)if(r.nodeValue.match(/[^ \f\n\r\t\v]/))r=r.nextSibling;else{var n=r.nextSibling;e.removeChild(r),r=n}else 1==r.nodeType?(t.removeWhite(r),r=r.nextSibling):r=r.nextSibling;return e},removePrefix:function(e){return e.substring(e.indexOf(":")+1)}};return 9==e.nodeType&&(e=e.documentElement),t.toObj(t.removeWhite(e))}window.Modernizr=function(e,t,r){function n(e){d.cssText=e}function i(e,t){return typeof e===t}var a,s,o,l="2.7.1",c={},u=t.documentElement,p="modernizr",h=t.createElement(p),d=h.style,f=({}.toString," -webkit- -moz- -o- -ms- ".split(" ")),m={},y=[],g=y.slice,v=function(e,r,n,i){var a,s,o,l,c=t.createElement("div"),h=t.body,d=h||t.createElement("body");if(parseInt(n,10))for(;n--;)o=t.createElement("div"),o.id=i?i[n]:p+(n+1),c.appendChild(o);return a=["&#173;",'<style id="s',p,'">',e,"</style>"].join(""),c.id=p,(h?c:d).innerHTML+=a,d.appendChild(c),h||(d.style.background="",d.style.overflow="hidden",l=u.style.overflow,u.style.overflow="hidden",u.appendChild(d)),s=r(c,e),h?c.parentNode.removeChild(c):(d.parentNode.removeChild(d),u.style.overflow=l),!!s},C=function(t){var r=e.matchMedia||e.msMatchMedia;if(r)return r(t).matches;var n;return v("@media "+t+" { #"+p+" { position: absolute; } }",function(t){n="absolute"==(e.getComputedStyle?getComputedStyle(t,null):t.currentStyle).position}),n},T={}.hasOwnProperty;o=i(T,"undefined")||i(T.call,"undefined")?function(e,t){return t in e&&i(e.constructor.prototype[t],"undefined")}:function(e,t){return T.call(e,t)},Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var r=g.call(arguments,1),n=function(){if(this instanceof n){var i=function(){};i.prototype=t.prototype;var a=new i,s=t.apply(a,r.concat(g.call(arguments)));return Object(s)===s?s:a}return t.apply(e,r.concat(g.call(arguments)))};return n}),m.canvas=function(){var e=t.createElement("canvas");return!!e.getContext&&!!e.getContext("2d")},m.touch=function(){var r;return"ontouchstart"in e||e.DocumentTouch&&t instanceof DocumentTouch?r=!0:v(["@media (",f.join("touch-enabled),("),p,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(e){r=9===e.offsetTop}),r};for(var L in m)o(m,L)&&(s=L.toLowerCase(),c[s]=m[L](),y.push((c[s]?"":"no-")+s));return c.addTest=function(e,t){if("object"==typeof e)for(var n in e)o(e,n)&&c.addTest(n,e[n]);else{e=e.toLowerCase();if(c[e]!==r)return c;t="function"==typeof t?t():t,"undefined"!=typeof enableClasses&&enableClasses&&(u.className+=" "+(t?"":"no-")+e),c[e]=t}return c},n(""),h=a=null,function(e,t){function r(e,t){var r=e.createElement("p"),n=e.getElementsByTagName("head")[0]||e.documentElement;return r.innerHTML="x<style>"+t+"</style>",n.insertBefore(r.lastChild,n.firstChild)}function n(){var e=v.elements;return"string"==typeof e?e.split(" "):e}function i(e){var t=g[e[m]];return t||(t={},y++,e[m]=y,g[y]=t),t}function a(e,r,n){r||(r=t);if(u)return r.createElement(e);n||(n=i(r));var a;return a=n.cache[e]?n.cache[e].cloneNode():f.test(e)?(n.cache[e]=n.createElem(e)).cloneNode():n.createElem(e),!a.canHaveChildren||d.test(e)||a.tagUrn?a:n.frag.appendChild(a)}function s(e,r){e||(e=t);if(u)return e.createDocumentFragment();r=r||i(e);for(var a=r.frag.cloneNode(),s=0,o=n(),l=o.length;l>s;s++)a.createElement(o[s]);return a}function o(e,t){t.cache||(t.cache={},t.createElem=e.createElement,t.createFrag=e.createDocumentFragment,t.frag=t.createFrag()),e.createElement=function(r){return v.shivMethods?a(r,e,t):t.createElem(r)},e.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+n().join().replace(/[\w\-]+/g,function(e){return t.createElem(e),t.frag.createElement(e),'c("'+e+'")'})+");return n}")(v,t.frag)}function l(e){e||(e=t);var n=i(e);return v.shivCSS&&!c&&!n.hasCSS&&(n.hasCSS=!!r(e,"article,aside,dialog,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}mark{background:#FF0;color:#000}template{display:none}")),u||o(e,n),e}var c,u,p="3.7.0",h=e.html5||{},d=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,f=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,m="_html5shiv",y=0,g={};!function(){try{var e=t.createElement("a");e.innerHTML="<xyz></xyz>",c="hidden"in e,u=1==e.childNodes.length||function(){t.createElement("a");var e=t.createDocumentFragment();return"undefined"==typeof e.cloneNode||"undefined"==typeof e.createDocumentFragment||"undefined"==typeof e.createElement}()}catch(r){c=!0,u=!0}}();var v={elements:h.elements||"abbr article aside audio bdi canvas data datalist details dialog figcaption figure footer header hgroup main mark meter nav output progress section summary template time video",version:p,shivCSS:h.shivCSS!==!1,supportsUnknownElements:u,shivMethods:h.shivMethods!==!1,type:"default",shivDocument:l,createElement:a,createDocumentFragment:s};e.html5=v,l(t)}(this,t),c._version=l,c._prefixes=f,c.mq=C,c.testStyles=v,c}(this,this.document),function(e,t,r){function n(e){return"[object Function]"==y.call(e)}function i(e){return"string"==typeof e}function a(){}function s(e){return!e||"loaded"==e||"complete"==e||"uninitialized"==e}function o(){var e=g.shift();v=1,e?e.t?f(function(){("c"==e.t?h.injectCss:h.injectJs)(e.s,0,e.a,e.x,e.e,1)},0):(e(),o()):v=0}function l(e,r,n,i,a,l,c){function u(t){if(!d&&s(p.readyState)&&(C.r=d=1,!v&&o(),p.onload=p.onreadystatechange=null,t)){"img"!=e&&f(function(){L.removeChild(p)},50);for(var n in O[r])O[r].hasOwnProperty(n)&&O[r][n].onload()}}var c=c||h.errorTimeout,p=t.createElement(e),d=0,y=0,C={t:n,s:r,e:a,a:l,x:c};1===O[r]&&(y=1,O[r]=[]),"object"==e?p.data=r:(p.src=r,p.type=e),p.width=p.height="0",p.onerror=p.onload=p.onreadystatechange=function(){u.call(this,y)},g.splice(i,0,C),"img"!=e&&(y||2===O[r]?(L.insertBefore(p,T?null:m),f(u,c)):O[r].push(p))}function c(e,t,r,n,a){return v=0,t=t||"j",i(e)?l("c"==t?b:w,e,t,this.i++,r,n,a):(g.splice(this.i++,0,e),1==g.length&&o()),this}function u(){var e=h;return e.loader={load:c,i:0},e}var p,h,d=t.documentElement,f=e.setTimeout,m=t.getElementsByTagName("script")[0],y={}.toString,g=[],v=0,C="MozAppearance"in d.style,T=C&&!!t.createRange().compareNode,L=T?d:m.parentNode,d=e.opera&&"[object Opera]"==y.call(e.opera),d=!!t.attachEvent&&!d,w=C?"object":d?"script":"img",b=d?"script":w,S=Array.isArray||function(e){return"[object Array]"==y.call(e)},E=[],O={},A={timeout:function(e,t){return t.length&&(e.timeout=t[0]),e}};h=function(e){function t(e){var t,r,n,e=e.split("!"),i=E.length,a=e.pop(),s=e.length,a={url:a,origUrl:a,prefixes:e};for(r=0;s>r;r++)n=e[r].split("="),(t=A[n.shift()])&&(a=t(a,n));for(r=0;i>r;r++)a=E[r](a);return a}function s(e,i,a,s,o){var l=t(e),c=l.autoCallback;l.url.split(".").pop().split("?").shift(),l.bypass||(i&&(i=n(i)?i:i[e]||i[s]||i[e.split("/").pop().split("?")[0]]),l.instead?l.instead(e,i,a,s,o):(O[l.url]?l.noexec=!0:O[l.url]=1,a.load(l.url,l.forceCSS||!l.forceJS&&"css"==l.url.split(".").pop().split("?").shift()?"c":r,l.noexec,l.attrs,l.timeout),(n(i)||n(c))&&a.load(function(){u(),i&&i(l.origUrl,o,s),c&&c(l.origUrl,o,s),O[l.url]=2})))}function o(e,t){function r(e,r){if(e){if(i(e))r||(p=function(){var e=[].slice.call(arguments);h.apply(this,e),d()}),s(e,p,t,0,c);else if(Object(e)===e)for(l in o=function(){var t,r=0;for(t in e)e.hasOwnProperty(t)&&r++;return r}(),e)e.hasOwnProperty(l)&&(!r&&!--o&&(n(p)?p=function(){var e=[].slice.call(arguments);h.apply(this,e),d()}:p[l]=function(e){return function(){var t=[].slice.call(arguments);e&&e.apply(this,t),d()}}(h[l])),s(e[l],p,t,l,c))}else!r&&d()}var o,l,c=!!e.test,u=e.load||e.both,p=e.callback||a,h=p,d=e.complete||a;r(c?e.yep:e.nope,!!u),u&&r(u)}var l,c,p=this.yepnope.loader;if(i(e))s(e,0,p,0);else if(S(e))for(l=0;l<e.length;l++)c=e[l],i(c)?s(c,0,p,0):S(c)?h(c):Object(c)===c&&o(c,p);else Object(e)===e&&o(e,p)},h.addPrefix=function(e,t){A[e]=t},h.addFilter=function(e){E.push(e)},h.errorTimeout=1e4,null==t.readyState&&t.addEventListener&&(t.readyState="loading",t.addEventListener("DOMContentLoaded",p=function(){t.removeEventListener("DOMContentLoaded",p,0),t.readyState="complete"},0)),e.yepnope=u(),e.yepnope.executeStack=o,e.yepnope.injectJs=function(e,r,n,i,l,c){var u,p,d=t.createElement("script"),i=i||h.errorTimeout;d.src=e;for(p in n)d.setAttribute(p,n[p]);r=c?o:r||a,d.onreadystatechange=d.onload=function(){!u&&s(d.readyState)&&(u=1,r(),d.onload=d.onreadystatechange=null)},f(function(){u||(u=1,r(1))},i),l?d.onload():m.parentNode.insertBefore(d,m)},e.yepnope.injectCss=function(e,r,n,i,s,l){var c,i=t.createElement("link"),r=l?o:r||a;i.href=e,i.rel="stylesheet",i.type="text/css";for(c in n)i.setAttribute(c,n[c]);s||(m.parentNode.insertBefore(i,m),f(r,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))};!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.core",[],t):"object"==typeof exports?module.exports=t():e.dust=t()}(this,function(){function c(e,t){return e?"function"==typeof e&&e.template?e.template:n.isTemplateFn(e)?e:t!==!1?n.cache[e]:void 0:void 0}function o(e,t,r){if(!e)return t.setError(new Error("No template or template name provided to render"));var a=c(e,n.config.cache);return a?a(t,i.wrap(r,a.templateName)):n.onLoad?t.map(function(t){function a(e,a){var o;if(e)return t.setError(e);if(o=c(a,!1)||c(s,n.config.cache),!o){if(!n.compile)return t.setError(new Error("Dust compiler not available"));o=n.loadSource(n.compile(a,s))}o(t,i.wrap(r,o.templateName)).end()}var s=e;3===n.onLoad.length?n.onLoad(s,r.options,a):n.onLoad(s,a)}):t.setError(new Error("Template Not Found: "+e))}function i(e,t,r,n,i){void 0===e||e instanceof l||(e=new l(e));this.stack=e;this.global=t;this.options=r;this.blocks=n;this.templateName=i}function k(e,t,r){return function(n){return e.push(n)._get(t,r)}}function l(e,t,r,n){this.tail=t;this.isObject=e&&"object"==typeof e;this.head=e;this.index=r;this.of=n}function a(e){this.head=new t(this);this.callback=e;this.out=""}function e(){this.head=new t(this)}function t(e,t,r){this.root=e;this.next=t;this.data=[];this.flushable=!1;this.taps=r}function s(e,t){this.head=e;this.tail=t}var n={version:"2.7.1"},d="NONE",r="ERROR",u="WARN",v="INFO",f="DEBUG",y=function(){},h;n.config={whitespace:!1,amd:!1,cjs:!1,cache:!0};n._aliases={write:"w",end:"e",map:"m",render:"r",reference:"f",section:"s",exists:"x",notexists:"nx",block:"b",partial:"p",helper:"h"},function(){var e,t,r={DEBUG:0,INFO:1,WARN:2,ERROR:3,NONE:4};"undefined"!=typeof console&&console.log?(e=console.log,t="function"==typeof e?function(){e.apply(console,arguments)}:function(){e(Array.prototype.slice.apply(arguments).join(" "))}):t=y;n.log=function(e,i){i=i||v;r[i]>=r[n.debugLevel]&&t("[DUST:"+i+"]",e)};n.debugLevel=d;"undefined"!=typeof process&&process.env&&/\bdust\b/.test(process.env.DEBUG)&&(n.debugLevel=f)}();n.helpers={};n.cache={};n.register=function(e,t){e&&(t.templateName=e,n.config.cache!==!1&&(n.cache[e]=t))};n.render=function(e,t,r){var n=new a(r).head;try{o(e,n,t).end()}catch(i){n.setError(i)}};n.stream=function(t,r){var i=new e,a=i.head;return n.nextTick(function(){try{o(t,a,r).end()}catch(e){a.setError(e)}}),i};n.loadSource=function(source){return eval(source)};n.isArray=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};n.nextTick=function(){return function(e){setTimeout(e,0)}}();n.isEmpty=function(e){return 0===e?!1:n.isArray(e)&&!e.length?!0:!e};n.isEmptyObject=function(e){var t;if(null===e||void 0===e||e.length>0)return!1;for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0};n.isTemplateFn=function(e){return"function"==typeof e&&e.__dustBody};n.isThenable=function(e){return e&&"object"==typeof e&&"function"==typeof e.then};n.isStreamable=function(e){return e&&"function"==typeof e.on};n.filter=function(e,t,r){var i,a,s;if(r)for(i=0,a=r.length;a>i;i++)s=r[i],"s"===s?t=null:"function"==typeof n.filters[s]?e=n.filters[s](e):n.log("Invalid filter `"+s+"`",u);return t&&(e=n.filters[t](e)),e};n.filters={h:function(e){return n.escapeHtml(e)},j:function(e){return n.escapeJs(e)},u:encodeURI,uc:encodeURIComponent,js:function(e){return n.escapeJSON(e)},jp:function(e){return JSON?JSON.parse(e):(n.log("JSON is undefined; could not parse `"+e+"`",u),e)}};n.makeBase=n.context=function(e,t){return new i(void 0,e,t)};i.wrap=function(e,t){return e instanceof i?e:new i(e,{},{},null,t)};i.prototype.get=function(e,t){return"string"==typeof e&&("."===e[0]&&(t=!0,e=e.substr(1)),e=e.split(".")),this._get(t,e)};i.prototype._get=function(e,t){var i,a,s,o,l,c=this.stack||{},u=1;if(a=t[0],s=t.length,e&&0===s)o=c,c=c.head;else{if(e)c&&(c=c.head?c.head[a]:void 0);else{for(;c&&(!c.isObject||(o=c.head,i=c.head[a],void 0===i));)c=c.tail;c=void 0!==i?i:this.global&&this.global[a]}for(;c&&s>u;){if(n.isThenable(c))return c.then(k(this,e,t.slice(u)));o=c;c=c[t[u]];u++}}return"function"==typeof c?(l=function(){try{return c.apply(o,arguments)}catch(e){throw n.log(e,r),e}},l.__dustBody=!!c.__dustBody,l):(void 0===c&&n.log("Cannot find reference `{"+t.join(".")+"}` in template `"+this.getTemplateName()+"`",v),c)};i.prototype.getPath=function(e,t){return this._get(e,t)};i.prototype.push=function(e,t,r){return void 0===e?(n.log("Not pushing an undefined variable onto the context",v),this):this.rebase(new l(e,this.stack,t,r))};i.prototype.pop=function(){var e=this.current();return this.stack=this.stack&&this.stack.tail,e};i.prototype.rebase=function(e){return new i(e,this.global,this.options,this.blocks,this.getTemplateName())};i.prototype.clone=function(){var e=this.rebase();return e.stack=this.stack,e};i.prototype.current=function(){return this.stack&&this.stack.head};i.prototype.getBlock=function(e){var r,i,a;if("function"==typeof e&&(e=e(new t,this).data.join("")),r=this.blocks,!r)return n.log("No blocks for context `"+e+"` in template `"+this.getTemplateName()+"`",f),!1;for(i=r.length;i--;)if(a=r[i][e])return a;return n.log("Malformed template `"+this.getTemplateName()+"` was missing one or more blocks."),!1};i.prototype.shiftBlocks=function(e){var t,r=this.blocks;return e?(t=r?r.concat([e]):[e],new i(this.stack,this.global,this.options,t,this.getTemplateName())):this};i.prototype.resolve=function(e){var r;return"function"!=typeof e?e:(r=(new t).render(e,this),r instanceof t?r.data.join(""):r)};i.prototype.getTemplateName=function(){return this.templateName};a.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.callback(e.error),n.log("Rendering failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.out+=e.data.join("");e=e.next;this.head=e}this.callback(null,this.out)};e.prototype.flush=function(){for(var e=this.head;e;){if(!e.flushable)return e.error?(this.emit("error",e.error),this.emit("end"),n.log("Streaming failed with error `"+e.error+"`",r),void(this.flush=y)):void 0;this.emit("data",e.data.join(""));e=e.next;this.head=e}this.emit("end")};e.prototype.emit=function(e,t){var r,i,a=this.events||{},s=a[e]||[];if(!s.length)return n.log("Stream broadcasting, but no listeners for `"+e+"`",f),!1;for(s=s.slice(0),r=0,i=s.length;i>r;r++)s[r](t);return!0};e.prototype.on=function(e,t){var r=this.events=this.events||{},i=r[e]=r[e]||[];return"function"!=typeof t?n.log("No callback function provided for `"+e+"` event listener",u):i.push(t),this};e.prototype.pipe=function(e){if("function"!=typeof e.write||"function"!=typeof e.end)return n.log("Incompatible stream passed to `pipe`",u),this;var t=!1;return"function"==typeof e.emit&&e.emit("pipe",this),"function"==typeof e.on&&e.on("error",function(){t=!0}),this.on("data",function(i){if(!t)try{e.write(i,"utf8")}catch(a){n.log(a,r)}}).on("end",function(){if(!t)try{e.end();t=!0}catch(i){n.log(i,r)}})};t.prototype.write=function(e){var t=this.taps;return t&&(e=t.go(e)),this.data.push(e),this};t.prototype.end=function(e){return e&&this.write(e),this.flushable=!0,this.root.flush(),this};t.prototype.map=function(e){var i=new t(this.root,this.next,this.taps),a=new t(this.root,i,this.taps);this.next=a;this.flushable=!0;try{e(a)}catch(s){n.log(s,r);a.setError(s)}return i};t.prototype.tap=function(e){var t=this.taps;return this.taps=t?t.push(e):new s(e),this};t.prototype.untap=function(){return this.taps=this.taps.tail,this};t.prototype.render=function(e,t){return e(this,t)};t.prototype.reference=function(e,r,i,a){return"function"==typeof e?(e=e.apply(r.current(),[this,r,null,{auto:i,filters:a}]),e instanceof t?e:this.reference(e,r,i,a)):n.isThenable(e)?this.await(e,r,null,i,a):n.isStreamable(e)?this.stream(e,r,null,i,a):n.isEmpty(e)?this:this.write(n.filter(e,i,a))};t.prototype.section=function(e,i,a,s){var o,l,c,u=a.block,p=a["else"],h=this;if("function"==typeof e&&!n.isTemplateFn(e)){try{e=e.apply(i.current(),[this,i,a,s])}catch(d){return n.log(d,r),this.setError(d)}if(e instanceof t)return e}if(n.isEmptyObject(s)||(i=i.push(s)),n.isArray(e)){if(u){if(l=e.length,l>0){for(c=i.stack&&i.stack.head||{},c.$len=l,o=0;l>o;o++)c.$idx=o,h=u(h,i.push(e[o],o,l));return c.$idx=void 0,c.$len=void 0,h}if(p)return p(this,i)}}else{if(n.isThenable(e))return this.await(e,i,a);if(n.isStreamable(e))return this.stream(e,i,a);if(e===!0){if(u)return u(this,i)}else if(e||0===e){if(u)return u(this,i.push(e))}else if(p)return p(this,i)}return n.log("Section without corresponding key in template `"+i.getTemplateName()+"`",f),this};t.prototype.exists=function(e,t,r){var i=r.block,a=r["else"];if(n.isEmpty(e)){if(a)return a(this,t)}else{if(i)return i(this,t);n.log("No block for exists check in template `"+t.getTemplateName()+"`",f)}return this};t.prototype.notexists=function(e,t,r){var i=r.block,a=r["else"];if(n.isEmpty(e)){if(i)return i(this,t);n.log("No block for not-exists check in template `"+t.getTemplateName()+"`",f)}else if(a)return a(this,t);return this};t.prototype.block=function(e,t,r){var n=e||r.block;return n?n(this,t):this};t.prototype.partial=function(e,t,r,i){var a;return void 0===i&&(i=r,r=t),n.isEmptyObject(i)||(r=r.clone(),a=r.pop(),r=r.push(i).push(a)),n.isTemplateFn(e)?this.capture(e,t,function(e,t){r.templateName=e;o(e,t,r).end()}):(r.templateName=e,o(e,this,r))};t.prototype.helper=function(e,t,i,a){var s,o=this;if(!n.helpers[e])return n.log("Helper `"+e+"` does not exist",u),o;try{return s=n.helpers[e](o,t,i,a),n.isThenable(s)?this.await(s,t,i):s}catch(l){return n.log("Error in helper `"+e+"`: "+l.message,r),o.setError(l)}};t.prototype.await=function(e,t,r,i,a){var s=r&&r.block,o=r&&r.error;return this.map(function(r){e.then(function(e){s?r.render(s,t.push(e)).end():r.reference(e,t,i,a).end()},function(e){o?r.render(o,t.push(e)).end():(n.log("Unhandled promise rejection in `"+t.getTemplateName()+"`"),r.end())})})};t.prototype.stream=function(e,t,r,i,a){var s=r&&r.block,o=r&&r.error;return this.map(function(r){var l=!1;e.on("data",function(e){l||(r=s?r.map(function(r){r.render(s,t.push(e)).end()}):r.reference(e,t,i,a))}).on("error",function(e){l||(o?r.render(o,t.push(e)):n.log("Unhandled stream error in `"+t.getTemplateName()+"`"),l||(l=!0,r.end()))}).on("end",function(){l||(l=!0,r.end())})})};t.prototype.capture=function(e,t,r){return this.map(function(n){var i=new a(function(e,t){e?n.setError(e):r(t,n)});e(i.head,t).end()})};t.prototype.setError=function(e){return this.error=e,this.root.flush(),this};for(h in t.prototype)n._aliases[h]&&(t.prototype[n._aliases[h]]=t.prototype[h]);s.prototype.push=function(e){return new s(e,this)};s.prototype.go=function(e){for(var t=this;t;)e=t.head(e),t=t.tail;return e};var g=/[&<>"']/,nt=/&/g,p=/</g,tt=/>/g,it=/\"/g,rt=/\'/g;n.escapeHtml=function(e){return"string"==typeof e||e&&"function"==typeof e.toString?("string"!=typeof e&&(e=e.toString()),g.test(e)?e.replace(nt,"&amp;").replace(p,"&lt;").replace(tt,"&gt;").replace(it,"&quot;").replace(rt,"&#39;"):e):e};var ut=/\\/g,ft=/\//g,et=/\r/g,w=/\u2028/g,b=/\u2029/g,ot=/\n/g,st=/\f/g,ht=/'/g,ct=/"/g,lt=/\t/g;return n.escapeJs=function(e){return"string"==typeof e?e.replace(ut,"\\\\").replace(ft,"\\/").replace(ct,'\\"').replace(ht,"\\'").replace(et,"\\r").replace(w,"\\u2028").replace(b,"\\u2029").replace(ot,"\\n").replace(st,"\\f").replace(lt,"\\t"):e},n.escapeJSON=function(e){return JSON?JSON.stringify(e).replace(w,"\\u2028").replace(b,"\\u2029").replace(p,"\\u003c"):(n.log("JSON is undefined; could not escape `"+e+"`",u),e)},n}),function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.parse",["dust.core"],function(e){return t(e).parse}):"object"==typeof exports?module.exports=t(require("./dust")):t(e.dust)}(this,function(e){var t=function(){function e(e,t){function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r}function t(e,t,r,n,i,a){this.message=e;this.expected=t;this.found=r;this.offset=n;this.line=i;this.column=a;this.name="SyntaxError"}function r(e){function r(){return a(wr).line}function n(){return a(wr).column}function i(e){throw o(e,null,wr)}function a(t){function r(t,r,n){for(var i,a=r;n>a;a++)i=e.charAt(a),"\n"===i?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return br!==t&&(br>t&&(br=0,Sr={line:1,column:1,seenCR:!1}),r(Sr,br,t),br=t),Sr}function s(e){Er>Lr||(Lr>Er&&(Er=Lr,Or=[]),Or.push(e))}function o(r,n,i){function s(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function r(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}for(var n,i,a=new Array(e.length),s=0;s<e.length;s++)a[s]=e[s].description;return n=e.length>1?a.slice(0,-1).join(", ")+" or "+a[e.length-1]:a[0],i=t?'"'+r(t)+'"':"end of input","Expected "+n+" but "+i+" found."}var l=a(i),c=i<e.length?e.charAt(i):null;return null!==n&&s(n),new t(null!==r?r:o(n,c),n,c,i,l.line,l.column)}function l(){return c()}function c(){var e,t,r;for(e=Lr,t=[],r=u();r!==X;)t.push(r),r=u();return t!==X&&(wr=e,t=Z(t)),e=t}function u(){var e;return e=D(),e===X&&(e=F(),e===X&&(e=p(),e===X&&(e=v(),e===X&&(e=T(),e===X&&(e=g(),e===X&&(e=k())))))),e}function p(){var t,r,n,i,a,o,l,u;if(Ar++,t=Lr,r=h(),r!==X){for(n=[],i=H();i!==X;)n.push(i),i=H();n!==X?(i=j(),i!==X?(a=c(),a!==X?(o=y(),o!==X?(l=d(),l===X&&(l=te),l!==X?(wr=Lr,u=re(r,a,o,l),u=u?ne:ee,u!==X?(wr=t,r=ie(r,a,o,l),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee;if(t===X)if(t=Lr,r=h(),r!==X){for(n=[],i=H();i!==X;)n.push(i),i=H();n!==X?(47===e.charCodeAt(Lr)?(i=ae,Lr++):(i=X,0===Ar&&s(se)),i!==X?(a=j(),a!==X?(wr=t,r=oe(r),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee;return Ar--,t===X&&(r=X,0===Ar&&s(Q)),t}function h(){var t,r,n,i,a,o,l;if(t=Lr,r=B(),r!==X)if(le.test(e.charAt(Lr))?(n=e.charAt(Lr),Lr++):(n=X,0===Ar&&s(ce)),n!==X){for(i=[],a=H();a!==X;)i.push(a),a=H();i!==X?(a=L(),a!==X?(o=f(),o!==X?(l=m(),l!==X?(wr=t,r=ue(n,a,o,l),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee;else Lr=t,t=ee;return t}function d(){var t,r,n,i,a,o,l;if(Ar++,t=Lr,r=B(),r!==X)if(47===e.charCodeAt(Lr)?(n=ae,Lr++):(n=X,0===Ar&&s(se)),n!==X){for(i=[],a=H();a!==X;)i.push(a),a=H();if(i!==X)if(a=L(),a!==X){for(o=[],l=H();l!==X;)o.push(l),l=H();o!==X?(l=j(),l!==X?(wr=t,r=he(a),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee;else Lr=t,t=ee}else Lr=t,t=ee;else Lr=t,t=ee;return Ar--,t===X&&(r=X,0===Ar&&s(pe)),t}function f(){var t,r,n,i;return t=Lr,r=Lr,58===e.charCodeAt(Lr)?(n=de,Lr++):(n=X,0===Ar&&s(fe)),n!==X?(i=L(),i!==X?(wr=r,n=me(i),r=n):(Lr=r,r=ee)):(Lr=r,r=ee),r===X&&(r=te),r!==X&&(wr=t,r=ye(r)),t=r}function m(){var t,r,n,i,a,o,l;if(Ar++,t=Lr,r=[],n=Lr,i=[],a=H(),a!==X)for(;a!==X;)i.push(a),a=H();else i=ee;for(i!==X?(a=x(),a!==X?(61===e.charCodeAt(Lr)?(o=ve,Lr++):(o=X,0===Ar&&s(Ce)),o!==X?(l=w(),l===X&&(l=L(),l===X&&(l=N())),l!==X?(wr=n,i=Te(a,l),n=i):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee);n!==X;){if(r.push(n),n=Lr,i=[],a=H(),a!==X)for(;a!==X;)i.push(a),a=H();else i=ee;i!==X?(a=x(),a!==X?(61===e.charCodeAt(Lr)?(o=ve,Lr++):(o=X,0===Ar&&s(Ce)),o!==X?(l=w(),l===X&&(l=L(),l===X&&(l=N())),l!==X?(wr=n,i=Te(a,l),n=i):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)}return r!==X&&(wr=t,r=Le(r)),t=r,Ar--,t===X&&(r=X,0===Ar&&s(ge)),t}function y(){var t,r,n,i,a,o,l,u;for(Ar++,t=Lr,r=[],n=Lr,i=B(),i!==X?(58===e.charCodeAt(Lr)?(a=de,Lr++):(a=X,0===Ar&&s(fe)),a!==X?(o=x(),o!==X?(l=j(),l!==X?(u=c(),u!==X?(wr=n,i=Te(o,u),n=i):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee);n!==X;)r.push(n),n=Lr,i=B(),i!==X?(58===e.charCodeAt(Lr)?(a=de,Lr++):(a=X,0===Ar&&s(fe)),a!==X?(o=x(),o!==X?(l=j(),l!==X?(u=c(),u!==X?(wr=n,i=Te(o,u),n=i):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee);return r!==X&&(wr=t,r=be(r)),t=r,Ar--,t===X&&(r=X,0===Ar&&s(we)),t}function g(){var e,t,r,n,i;return Ar++,e=Lr,t=B(),t!==X?(r=L(),r!==X?(n=C(),n!==X?(i=j(),i!==X?(wr=e,t=Ee(r,n),e=t):(Lr=e,e=ee)):(Lr=e,e=ee)):(Lr=e,e=ee)):(Lr=e,e=ee),Ar--,e===X&&(t=X,0===Ar&&s(Se)),e}function v(){var t,r,n,i,a,o,l,c,u,p;if(Ar++,t=Lr,r=B(),r!==X)if(62===e.charCodeAt(Lr)?(n=Ae,Lr++):(n=X,0===Ar&&s(xe)),n===X&&(43===e.charCodeAt(Lr)?(n=Pe,Lr++):(n=X,0===Ar&&s(_e))),n!==X){for(i=[],a=H();a!==X;)i.push(a),a=H();if(i!==X)if(a=Lr,o=x(),o!==X&&(wr=a,o=Ne(o)),a=o,a===X&&(a=N()),a!==X)if(o=f(),o!==X)if(l=m(),l!==X){for(c=[],u=H();u!==X;)c.push(u),u=H();c!==X?(47===e.charCodeAt(Lr)?(u=ae,Lr++):(u=X,0===Ar&&s(se)),u!==X?(p=j(),p!==X?(wr=t,r=Me(n,a,o,l),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee;else Lr=t,t=ee;else Lr=t,t=ee;else Lr=t,t=ee}else Lr=t,t=ee;else Lr=t,t=ee;return Ar--,t===X&&(r=X,0===Ar&&s(Oe)),t}function C(){var t,r,n,i,a;for(Ar++,t=Lr,r=[],n=Lr,124===e.charCodeAt(Lr)?(i=Re,Lr++):(i=X,0===Ar&&s(Ie)),i!==X?(a=x(),a!==X?(wr=n,i=me(a),n=i):(Lr=n,n=ee)):(Lr=n,n=ee);n!==X;)r.push(n),n=Lr,124===e.charCodeAt(Lr)?(i=Re,Lr++):(i=X,0===Ar&&s(Ie)),i!==X?(a=x(),a!==X?(wr=n,i=me(a),n=i):(Lr=n,n=ee)):(Lr=n,n=ee);return r!==X&&(wr=t,r=De(r)),t=r,Ar--,t===X&&(r=X,0===Ar&&s(ke)),t}function T(){var t,r,n,i,a;return Ar++,t=Lr,r=B(),r!==X?(126===e.charCodeAt(Lr)?(n=$e,Lr++):(n=X,0===Ar&&s(Be)),n!==X?(i=x(),i!==X?(a=j(),a!==X?(wr=t,r=je(i),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee),Ar--,t===X&&(r=X,0===Ar&&s(Fe)),t}function L(){var e,t;return Ar++,e=Lr,t=A(),t!==X&&(wr=e,t=Ge(t)),e=t,e===X&&(e=Lr,t=x(),t!==X&&(wr=e,t=ze(t)),e=t),Ar--,e===X&&(t=X,0===Ar&&s(Ue)),e}function w(){var e,t;return Ar++,e=Lr,t=b(),t===X&&(t=O()),t!==X&&(wr=e,t=We(t)),e=t,Ar--,e===X&&(t=X,0===Ar&&s(He)),e}function b(){var t,r,n,i;return Ar++,t=Lr,r=O(),r!==X?(46===e.charCodeAt(Lr)?(n=qe,Lr++):(n=X,0===Ar&&s(Ye)),n!==X?(i=S(),i!==X?(wr=t,r=Xe(r,i),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee),Ar--,t===X&&(r=X,0===Ar&&s(Ve)),t}function S(){var t,r,n;if(Ar++,t=Lr,r=[],Je.test(e.charAt(Lr))?(n=e.charAt(Lr),Lr++):(n=X,0===Ar&&s(Ze)),n!==X)for(;n!==X;)r.push(n),Je.test(e.charAt(Lr))?(n=e.charAt(Lr),Lr++):(n=X,0===Ar&&s(Ze));else r=ee;return r!==X&&(wr=t,r=Qe(r)),t=r,Ar--,t===X&&(r=X,0===Ar&&s(Ke)),t}function E(){var t,r,n;return Ar++,t=Lr,45===e.charCodeAt(Lr)?(r=tt,Lr++):(r=X,0===Ar&&s(rt)),r!==X?(n=S(),n!==X?(wr=t,r=nt(r,n),t=r):(Lr=t,t=ee)):(Lr=t,t=ee),Ar--,t===X&&(r=X,0===Ar&&s(et)),t}function O(){var e,t;return Ar++,e=E(),e===X&&(e=S()),Ar--,e===X&&(t=X,0===Ar&&s(it)),e}function A(){var t,r,n,i;if(Ar++,t=Lr,r=x(),r===X&&(r=te),r!==X){if(n=[],i=_(),i===X&&(i=P()),i!==X)for(;i!==X;)n.push(i),i=_(),i===X&&(i=P());else n=ee;n!==X?(wr=t,r=st(r,n),t=r):(Lr=t,t=ee)}else Lr=t,t=ee;if(t===X)if(t=Lr,46===e.charCodeAt(Lr)?(r=qe,Lr++):(r=X,0===Ar&&s(Ye)),r!==X){for(n=[],i=_(),i===X&&(i=P());i!==X;)n.push(i),i=_(),i===X&&(i=P());n!==X?(wr=t,r=ot(n),t=r):(Lr=t,t=ee)}else Lr=t,t=ee;return Ar--,t===X&&(r=X,0===Ar&&s(at)),t}function x(){var t,r,n,i;if(Ar++,t=Lr,ct.test(e.charAt(Lr))?(r=e.charAt(Lr),Lr++):(r=X,0===Ar&&s(ut)),r!==X){for(n=[],pt.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=X,0===Ar&&s(ht));i!==X;)n.push(i),pt.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=X,0===Ar&&s(ht));n!==X?(wr=t,r=dt(r,n),t=r):(Lr=t,t=ee)}else Lr=t,t=ee;return Ar--,t===X&&(r=X,0===Ar&&s(lt)),t}function P(){var t,r,n,i,a,o;if(Ar++,t=Lr,r=Lr,n=U(),n!==X){if(i=Lr,a=[],Je.test(e.charAt(Lr))?(o=e.charAt(Lr),
Lr++):(o=X,0===Ar&&s(Ze)),o!==X)for(;o!==X;)a.push(o),Je.test(e.charAt(Lr))?(o=e.charAt(Lr),Lr++):(o=X,0===Ar&&s(Ze));else a=ee;a!==X&&(wr=i,a=mt(a));i=a;i===X&&(i=L());i!==X?(a=G(),a!==X?(wr=r,n=yt(i),r=n):(Lr=r,r=ee)):(Lr=r,r=ee)}else Lr=r,r=ee;return r!==X?(n=_(),n===X&&(n=te),n!==X?(wr=t,r=gt(r,n),t=r):(Lr=t,t=ee)):(Lr=t,t=ee),Ar--,t===X&&(r=X,0===Ar&&s(ft)),t}function _(){var t,r,n,i,a;if(Ar++,t=Lr,r=[],n=Lr,46===e.charCodeAt(Lr)?(i=qe,Lr++):(i=X,0===Ar&&s(Ye)),i!==X?(a=x(),a!==X?(wr=n,i=Ct(a),n=i):(Lr=n,n=ee)):(Lr=n,n=ee),n!==X)for(;n!==X;)r.push(n),n=Lr,46===e.charCodeAt(Lr)?(i=qe,Lr++):(i=X,0===Ar&&s(Ye)),i!==X?(a=x(),a!==X?(wr=n,i=Ct(a),n=i):(Lr=n,n=ee)):(Lr=n,n=ee);else r=ee;return r!==X?(n=P(),n===X&&(n=te),n!==X?(wr=t,r=Tt(r,n),t=r):(Lr=t,t=ee)):(Lr=t,t=ee),Ar--,t===X&&(r=X,0===Ar&&s(vt)),t}function N(){var t,r,n,i;if(Ar++,t=Lr,34===e.charCodeAt(Lr)?(r=wt,Lr++):(r=X,0===Ar&&s(bt)),r!==X?(34===e.charCodeAt(Lr)?(n=wt,Lr++):(n=X,0===Ar&&s(bt)),n!==X?(wr=t,r=St(),t=r):(Lr=t,t=ee)):(Lr=t,t=ee),t===X&&(t=Lr,34===e.charCodeAt(Lr)?(r=wt,Lr++):(r=X,0===Ar&&s(bt)),r!==X?(n=R(),n!==X?(34===e.charCodeAt(Lr)?(i=wt,Lr++):(i=X,0===Ar&&s(bt)),i!==X?(wr=t,r=Et(n),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)):(Lr=t,t=ee),t===X))if(t=Lr,34===e.charCodeAt(Lr)?(r=wt,Lr++):(r=X,0===Ar&&s(bt)),r!==X){if(n=[],i=M(),i!==X)for(;i!==X;)n.push(i),i=M();else n=ee;n!==X?(34===e.charCodeAt(Lr)?(i=wt,Lr++):(i=X,0===Ar&&s(bt)),i!==X?(wr=t,r=Ot(n),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee;return Ar--,t===X&&(r=X,0===Ar&&s(Lt)),t}function M(){var e,t;return e=T(),e===X&&(e=g(),e===X&&(e=Lr,t=R(),t!==X&&(wr=e,t=At(t)),e=t)),e}function k(){var t,r,n,i,a,o,l,c;if(Ar++,t=Lr,r=z(),r!==X){for(n=[],i=H();i!==X;)n.push(i),i=H();n!==X?(wr=t,r=Pt(r,n),t=r):(Lr=t,t=ee)}else Lr=t,t=ee;if(t===X){if(t=Lr,r=[],n=Lr,i=Lr,Ar++,a=$(),Ar--,a===X?i=ne:(Lr=i,i=ee),i!==X?(a=Lr,Ar++,o=D(),Ar--,o===X?a=ne:(Lr=a,a=ee),a!==X?(o=Lr,Ar++,l=F(),Ar--,l===X?o=ne:(Lr=o,o=ee),o!==X?(l=Lr,Ar++,c=z(),Ar--,c===X?l=ne:(Lr=l,l=ee),l!==X?(e.length>Lr?(c=e.charAt(Lr),Lr++):(c=X,0===Ar&&s(_t)),c!==X?(wr=n,i=Nt(c),n=i):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee),n!==X)for(;n!==X;)r.push(n),n=Lr,i=Lr,Ar++,a=$(),Ar--,a===X?i=ne:(Lr=i,i=ee),i!==X?(a=Lr,Ar++,o=D(),Ar--,o===X?a=ne:(Lr=a,a=ee),a!==X?(o=Lr,Ar++,l=F(),Ar--,l===X?o=ne:(Lr=o,o=ee),o!==X?(l=Lr,Ar++,c=z(),Ar--,c===X?l=ne:(Lr=l,l=ee),l!==X?(e.length>Lr?(c=e.charAt(Lr),Lr++):(c=X,0===Ar&&s(_t)),c!==X?(wr=n,i=Nt(c),n=i):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee)):(Lr=n,n=ee);else r=ee;r!==X&&(wr=t,r=Mt(r));t=r}return Ar--,t===X&&(r=X,0===Ar&&s(xt)),t}function R(){var t,r,n,i,a;if(Ar++,t=Lr,r=[],n=Lr,i=Lr,Ar++,a=$(),Ar--,a===X?i=ne:(Lr=i,i=ee),i!==X?(a=I(),a===X&&(Rt.test(e.charAt(Lr))?(a=e.charAt(Lr),Lr++):(a=X,0===Ar&&s(It))),a!==X?(wr=n,i=Nt(a),n=i):(Lr=n,n=ee)):(Lr=n,n=ee),n!==X)for(;n!==X;)r.push(n),n=Lr,i=Lr,Ar++,a=$(),Ar--,a===X?i=ne:(Lr=i,i=ee),i!==X?(a=I(),a===X&&(Rt.test(e.charAt(Lr))?(a=e.charAt(Lr),Lr++):(a=X,0===Ar&&s(It))),a!==X?(wr=n,i=Nt(a),n=i):(Lr=n,n=ee)):(Lr=n,n=ee);else r=ee;return r!==X&&(wr=t,r=Dt(r)),t=r,Ar--,t===X&&(r=X,0===Ar&&s(kt)),t}function I(){var t,r;return t=Lr,e.substr(Lr,2)===Ft?(r=Ft,Lr+=2):(r=X,0===Ar&&s($t)),r!==X&&(wr=t,r=Bt()),t=r}function D(){var t,r,n,i,a,o;if(Ar++,t=Lr,e.substr(Lr,2)===Ut?(r=Ut,Lr+=2):(r=X,0===Ar&&s(Gt)),r!==X){for(n=[],i=Lr,a=Lr,Ar++,e.substr(Lr,2)===zt?(o=zt,Lr+=2):(o=X,0===Ar&&s(Ht)),Ar--,o===X?a=ne:(Lr=a,a=ee),a!==X?(e.length>Lr?(o=e.charAt(Lr),Lr++):(o=X,0===Ar&&s(_t)),o!==X?(wr=i,a=Wt(o),i=a):(Lr=i,i=ee)):(Lr=i,i=ee);i!==X;)n.push(i),i=Lr,a=Lr,Ar++,e.substr(Lr,2)===zt?(o=zt,Lr+=2):(o=X,0===Ar&&s(Ht)),Ar--,o===X?a=ne:(Lr=a,a=ee),a!==X?(e.length>Lr?(o=e.charAt(Lr),Lr++):(o=X,0===Ar&&s(_t)),o!==X?(wr=i,a=Wt(o),i=a):(Lr=i,i=ee)):(Lr=i,i=ee);n!==X?(e.substr(Lr,2)===zt?(i=zt,Lr+=2):(i=X,0===Ar&&s(Ht)),i!==X?(wr=t,r=Vt(n),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee;return Ar--,t===X&&(r=X,0===Ar&&s(jt)),t}function F(){var t,r,n,i,a,o;if(Ar++,t=Lr,e.substr(Lr,2)===Yt?(r=Yt,Lr+=2):(r=X,0===Ar&&s(Xt)),r!==X){for(n=[],i=Lr,a=Lr,Ar++,e.substr(Lr,2)===Kt?(o=Kt,Lr+=2):(o=X,0===Ar&&s(Jt)),Ar--,o===X?a=ne:(Lr=a,a=ee),a!==X?(e.length>Lr?(o=e.charAt(Lr),Lr++):(o=X,0===Ar&&s(_t)),o!==X?(wr=i,a=Nt(o),i=a):(Lr=i,i=ee)):(Lr=i,i=ee);i!==X;)n.push(i),i=Lr,a=Lr,Ar++,e.substr(Lr,2)===Kt?(o=Kt,Lr+=2):(o=X,0===Ar&&s(Jt)),Ar--,o===X?a=ne:(Lr=a,a=ee),a!==X?(e.length>Lr?(o=e.charAt(Lr),Lr++):(o=X,0===Ar&&s(_t)),o!==X?(wr=i,a=Nt(o),i=a):(Lr=i,i=ee)):(Lr=i,i=ee);n!==X?(e.substr(Lr,2)===Kt?(i=Kt,Lr+=2):(i=X,0===Ar&&s(Jt)),i!==X?(wr=t,r=Zt(n),t=r):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee;return Ar--,t===X&&(r=X,0===Ar&&s(qt)),t}function $(){var t,r,n,i,a,o,l,c,u,p;if(t=Lr,r=B(),r!==X){for(n=[],i=H();i!==X;)n.push(i),i=H();if(n!==X)if(Qt.test(e.charAt(Lr))?(i=e.charAt(Lr),Lr++):(i=X,0===Ar&&s(er)),i!==X){for(a=[],o=H();o!==X;)a.push(o),o=H();if(a!==X){if(o=[],l=Lr,c=Lr,Ar++,u=j(),Ar--,u===X?c=ne:(Lr=c,c=ee),c!==X?(u=Lr,Ar++,p=z(),Ar--,p===X?u=ne:(Lr=u,u=ee),u!==X?(e.length>Lr?(p=e.charAt(Lr),Lr++):(p=X,0===Ar&&s(_t)),p!==X?(c=[c,u,p],l=c):(Lr=l,l=ee)):(Lr=l,l=ee)):(Lr=l,l=ee),l!==X)for(;l!==X;)o.push(l),l=Lr,c=Lr,Ar++,u=j(),Ar--,u===X?c=ne:(Lr=c,c=ee),c!==X?(u=Lr,Ar++,p=z(),Ar--,p===X?u=ne:(Lr=u,u=ee),u!==X?(e.length>Lr?(p=e.charAt(Lr),Lr++):(p=X,0===Ar&&s(_t)),p!==X?(c=[c,u,p],l=c):(Lr=l,l=ee)):(Lr=l,l=ee)):(Lr=l,l=ee);else o=ee;if(o!==X){for(l=[],c=H();c!==X;)l.push(c),c=H();l!==X?(c=j(),c!==X?(r=[r,n,i,a,o,l,c],t=r):(Lr=t,t=ee)):(Lr=t,t=ee)}else Lr=t,t=ee}else Lr=t,t=ee}else Lr=t,t=ee;else Lr=t,t=ee}else Lr=t,t=ee;return t===X&&(t=g()),t}function B(){var t;return 123===e.charCodeAt(Lr)?(t=tr,Lr++):(t=X,0===Ar&&s(rr)),t}function j(){var t;return 125===e.charCodeAt(Lr)?(t=nr,Lr++):(t=X,0===Ar&&s(ir)),t}function U(){var t;return 91===e.charCodeAt(Lr)?(t=ar,Lr++):(t=X,0===Ar&&s(sr)),t}function G(){var t;return 93===e.charCodeAt(Lr)?(t=or,Lr++):(t=X,0===Ar&&s(lr)),t}function z(){var t;return 10===e.charCodeAt(Lr)?(t=cr,Lr++):(t=X,0===Ar&&s(ur)),t===X&&(e.substr(Lr,2)===pr?(t=pr,Lr+=2):(t=X,0===Ar&&s(hr)),t===X&&(13===e.charCodeAt(Lr)?(t=dr,Lr++):(t=X,0===Ar&&s(fr)),t===X&&(8232===e.charCodeAt(Lr)?(t=mr,Lr++):(t=X,0===Ar&&s(yr)),t===X&&(8233===e.charCodeAt(Lr)?(t=gr,Lr++):(t=X,0===Ar&&s(vr)))))),t}function H(){var t;return Cr.test(e.charAt(Lr))?(t=e.charAt(Lr),Lr++):(t=X,0===Ar&&s(Tr)),t===X&&(t=z()),t}function W(e){return parseInt(e.join(""),10)}function V(e){return e.concat([["line",r()],["col",n()]])}var q,Y=arguments.length>1?arguments[1]:{},X={},K={start:l},J=l,Z=function(e){var t=["body"].concat(e);return V(t)},Q={type:"other",description:"section"},ee=X,te=null,re=function(e,t,r,n){return n&&e[1].text===n.text||i("Expected end tag for "+e[1].text+" but it was not found."),!0},ne=void 0,ie=function(e,t,r){return r.push(["param",["literal","block"],t]),e.push(r),V(e)},ae="/",se={type:"literal",value:"/",description:'"/"'},oe=function(e){return e.push(["bodies"]),V(e)},le=/^[#?\^<+@%]/,ce={type:"class",value:"[#?\\^<+@%]",description:"[#?\\^<+@%]"},ue=function(e,t,r,n){return[e,t,r,n]},pe={type:"other",description:"end tag"},he=function(e){return e},de=":",fe={type:"literal",value:":",description:'":"'},me=function(e){return e},ye=function(e){return e?["context",e]:["context"]},ge={type:"other",description:"params"},ve="=",Ce={type:"literal",value:"=",description:'"="'},Te=function(e,t){return["param",["literal",e],t]},Le=function(e){return["params"].concat(e)},we={type:"other",description:"bodies"},be=function(e){return["bodies"].concat(e)},Se={type:"other",description:"reference"},Ee=function(e,t){return V(["reference",e,t])},Oe={type:"other",description:"partial"},Ae=">",xe={type:"literal",value:">",description:'">"'},Pe="+",_e={type:"literal",value:"+",description:'"+"'},Ne=function(e){return["literal",e]},Me=function(e,t,r,n){var i=">"===e?"partial":e;return V([i,t,r,n])},ke={type:"other",description:"filters"},Re="|",Ie={type:"literal",value:"|",description:'"|"'},De=function(e){return["filters"].concat(e)},Fe={type:"other",description:"special"},$e="~",Be={type:"literal",value:"~",description:'"~"'},je=function(e){return V(["special",e])},Ue={type:"other",description:"identifier"},Ge=function(e){var t=["path"].concat(e);return t.text=e[1].join(".").replace(/,line,\d+,col,\d+/g,""),t},ze=function(e){var t=["key",e];return t.text=e,t},He={type:"other",description:"number"},We=function(e){return["literal",e]},Ve={type:"other",description:"float"},qe=".",Ye={type:"literal",value:".",description:'"."'},Xe=function(e,t){return parseFloat(e+"."+t)},Ke={type:"other",description:"unsigned_integer"},Je=/^[0-9]/,Ze={type:"class",value:"[0-9]",description:"[0-9]"},Qe=function(e){return W(e)},et={type:"other",description:"signed_integer"},tt="-",rt={type:"literal",value:"-",description:'"-"'},nt=function(e,t){return-1*t},it={type:"other",description:"integer"},at={type:"other",description:"path"},st=function(e,t){return t=t[0],e&&t?(t.unshift(e),V([!1,t])):V([!0,t])},ot=function(e){return V(e.length>0?[!0,e[0]]:[!0,[]])},lt={type:"other",description:"key"},ct=/^[a-zA-Z_$]/,ut={type:"class",value:"[a-zA-Z_$]",description:"[a-zA-Z_$]"},pt=/^[0-9a-zA-Z_$\-]/,ht={type:"class",value:"[0-9a-zA-Z_$\\-]",description:"[0-9a-zA-Z_$\\-]"},dt=function(e,t){return e+t.join("")},ft={type:"other",description:"array"},mt=function(e){return e.join("")},yt=function(e){return e},gt=function(e,t){return t?t.unshift(e):t=[e],t},vt={type:"other",description:"array_part"},Ct=function(e){return e},Tt=function(e,t){return t?e.concat(t):e},Lt={type:"other",description:"inline"},wt='"',bt={type:"literal",value:'"',description:'"\\""'},St=function(){return V(["literal",""])},Et=function(e){return V(["literal",e])},Ot=function(e){return V(["body"].concat(e))},At=function(e){return["buffer",e]},xt={type:"other",description:"buffer"},Pt=function(e,t){return V(["format",e,t.join("")])},_t={type:"any",description:"any character"},Nt=function(e){return e},Mt=function(e){return V(["buffer",e.join("")])},kt={type:"other",description:"literal"},Rt=/^[^"]/,It={type:"class",value:'[^"]',description:'[^"]'},Dt=function(e){return e.join("")},Ft='\\"',$t={type:"literal",value:'\\"',description:'"\\\\\\""'},Bt=function(){return'"'},jt={type:"other",description:"raw"},Ut="{`",Gt={type:"literal",value:"{`",description:'"{`"'},zt="`}",Ht={type:"literal",value:"`}",description:'"`}"'},Wt=function(e){return e},Vt=function(e){return V(["raw",e.join("")])},qt={type:"other",description:"comment"},Yt="{!",Xt={type:"literal",value:"{!",description:'"{!"'},Kt="!}",Jt={type:"literal",value:"!}",description:'"!}"'},Zt=function(e){return V(["comment",e.join("")])},Qt=/^[#?\^><+%:@\/~%]/,er={type:"class",value:"[#?\\^><+%:@\\/~%]",description:"[#?\\^><+%:@\\/~%]"},tr="{",rr={type:"literal",value:"{",description:'"{"'},nr="}",ir={type:"literal",value:"}",description:'"}"'},ar="[",sr={type:"literal",value:"[",description:'"["'},or="]",lr={type:"literal",value:"]",description:'"]"'},cr="\n",ur={type:"literal",value:"\n",description:'"\\n"'},pr="\r\n",hr={type:"literal",value:"\r\n",description:'"\\r\\n"'},dr="\r",fr={type:"literal",value:"\r",description:'"\\r"'},mr="\u2028",yr={type:"literal",value:"\u2028",description:'"\\u2028"'},gr="\u2029",vr={type:"literal",value:"\u2029",description:'"\\u2029"'},Cr=/^[\t\x0B\f \xA0\uFEFF]/,Tr={type:"class",value:"[\\t\\x0B\\f \\xA0\\uFEFF]",description:"[\\t\\x0B\\f \\xA0\\uFEFF]"},Lr=0,wr=0,br=0,Sr={line:1,column:1,seenCR:!1},Er=0,Or=[],Ar=0;if("startRule"in Y){if(!(Y.startRule in K))throw new Error("Can't start parsing from rule \""+Y.startRule+'".');J=K[Y.startRule]}if(q=J(),q!==X&&Lr===e.length)return q;throw q!==X&&Lr<e.length&&s({type:"end",description:"end of input"}),o(null,Or,Er)}return e(t,Error),{SyntaxError:t,parse:r}}();return e.parse=t.parse,t}),function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define("dust.compile",["dust.core","dust.parse"],function(e,r){return t(r,e).compile}):"object"==typeof exports?module.exports=t(require("./parser").parse,require("./dust")):t(e.dust.parse,e.dust)}(this,function(e,t){function r(e){return C.filterNode({},e)}function n(e,t){for(var r,n=[t[0]],i=1,a=t.length;a>i;i++)r=C.filterNode(e,t[i]),r&&n.push(r);return n}function i(e,t){for(var r,n,i=[t[0]],a=1,s=t.length;s>a;a++)n=C.filterNode(e,t[a]),n&&("buffer"===n[0]||"format"===n[0]?r?(r[0]="buffer"===n[0]?"buffer":r[0],r[1]+=n.slice(1,-2).join("")):(r=n,i.push(n)):(r=null,i.push(n)));return i}function a(e,t){return["buffer",v[t[1]],t[2],t[3]]}function s(e,t){return t}function o(){}function l(e,r){return t.config.whitespace?(r.splice(1,2,r.slice(1,-2).join("")),r):null}function c(e,r){var n,i={name:r,bodies:[],blocks:{},index:0,auto:"h"},a=t.escapeJs(r),s=r?'"'+a+'",':"",o="function(dust){",l=C.compileNode(i,e);return r&&(o+='dust.register("'+a+'",'+l+");"),o+=u(i)+p(i)+"return "+l+"}",n="("+o+"(dust));",t.config.amd?"define("+s+'["dust.core"],'+o+");":t.config.cjs?"module.exports=function(dust){var tmpl="+n+"var f="+g().toString()+";f.template=tmpl;return f}":n}function u(e){var t,r=[],n=e.blocks;for(t in n)r.push('"'+t+'":'+n[t]);return r.length?(e.blocks="ctx=ctx.shiftBlocks(blocks);","var blocks={"+r.join(",")+"};"):(e.blocks="",e.blocks)}function p(e){for(var t=[],r=e.bodies,n=e.blocks,i=0,a=r.length;a>i;i++)t[i]="function body_"+i+"(chk,ctx){"+n+"return chk"+r[i]+";}body_"+i+".__dustBody=!0;";return t.join("")}function h(e,t){for(var r="",n=1,i=t.length;i>n;n++)r+=C.compileNode(e,t[n]);return r}function d(e,r,n){return"."+(t._aliases[n]||n)+"("+C.compileNode(e,r[1])+","+C.compileNode(e,r[2])+","+C.compileNode(e,r[4])+","+C.compileNode(e,r[3])+")"}function f(e){return e.replace(L,"\\\\").replace(w,'\\"').replace(b,"\\f").replace(S,"\\n").replace(E,"\\r").replace(O,"\\t")}function m(e,r,n){var i=t.loadSource(t.compile(e));return g(i)(r,n)}function y(e,r){var n=t.loadSource(t.compile(e,r));return g(n)}function g(e){return function(r,n){var i=n?"render":"stream";return t[i](e,r,n)}}var v,C={},T=t.isArray;C.compile=function(t,n){try{var i=r(e(t));return c(i,n)}catch(a){if(!a.line||!a.column)throw a;throw new SyntaxError(a.message+" At line : "+a.line+", column : "+a.column)}};C.filterNode=function(e,t){return C.optimizers[t[0]](e,t)};C.optimizers={body:i,buffer:s,special:a,format:l,reference:n,"#":n,"?":n,"^":n,"<":n,"+":n,"@":n,"%":n,partial:n,context:n,params:n,bodies:n,param:n,filters:s,key:s,path:s,literal:s,raw:s,comment:o,line:o,col:o};C.pragmas={esc:function(e,t,r){var n,i=e.auto;return t||(t="h"),e.auto="s"===t?"":t,n=h(e,r.block),e.auto=i,n}};v={s:" ",n:"\n",r:"\r",lb:"{",rb:"}"};C.compileNode=function(e,t){return C.nodes[t[0]](e,t)};C.nodes={body:function(e,t){var r=e.index++,n="body_"+r;return e.bodies[r]=h(e,t),n},buffer:function(e,t){return".w("+A(t[1])+")"},format:function(e,t){return".w("+A(t[1])+")"},reference:function(e,t){return".f("+C.compileNode(e,t[1])+",ctx,"+C.compileNode(e,t[2])+")"},"#":function(e,t){return d(e,t,"section")},"?":function(e,t){return d(e,t,"exists")},"^":function(e,t){return d(e,t,"notexists")},"<":function(e,t){for(var r,n,i=t[4],a=1,s=i.length;s>a;a++)if(r=i[a],n=r[1][1],"block"===n)return e.blocks[t[1].text]=C.compileNode(e,r[2]),"";return""},"+":function(e,t){return"undefined"==typeof t[1].text&&"undefined"==typeof t[4]?".b(ctx.getBlock("+C.compileNode(e,t[1])+",chk, ctx),"+C.compileNode(e,t[2])+", {},"+C.compileNode(e,t[3])+")":".b(ctx.getBlock("+A(t[1].text)+"),"+C.compileNode(e,t[2])+","+C.compileNode(e,t[4])+","+C.compileNode(e,t[3])+")"},"@":function(e,t){return".h("+A(t[1].text)+","+C.compileNode(e,t[2])+","+C.compileNode(e,t[4])+","+C.compileNode(e,t[3])+")"},"%":function(e,t){var r,n,i,a,s,o,l,c,u,p=t[1][1];if(!C.pragmas[p])return"";for(r=t[4],n={},c=1,u=r.length;u>c;c++)o=r[c],n[o[1][1]]=o[2];for(i=t[3],a={},c=1,u=i.length;u>c;c++)l=i[c],a[l[1][1]]=l[2][1];return s=t[2][1]?t[2][1].text:null,C.pragmas[p](e,s,n,a)},partial:function(e,t){return".p("+C.compileNode(e,t[1])+",ctx,"+C.compileNode(e,t[2])+","+C.compileNode(e,t[3])+")"},context:function(e,t){return t[1]?"ctx.rebase("+C.compileNode(e,t[1])+")":"ctx"},params:function(e,t){for(var r=[],n=1,i=t.length;i>n;n++)r.push(C.compileNode(e,t[n]));return r.length?"{"+r.join(",")+"}":"{}"},bodies:function(e,t){for(var r=[],n=1,i=t.length;i>n;n++)r.push(C.compileNode(e,t[n]));return"{"+r.join(",")+"}"},param:function(e,t){return C.compileNode(e,t[1])+":"+C.compileNode(e,t[2])},filters:function(e,t){for(var r,n=[],i=1,a=t.length;a>i;i++)r=t[i],n.push('"'+r+'"');return'"'+e.auto+'"'+(n.length?",["+n.join(",")+"]":"")},key:function(e,t){return'ctx.get(["'+t[1]+'"], false)'},path:function(e,t){for(var r=t[1],n=t[2],i=[],a=0,s=n.length;s>a;a++)i.push(T(n[a])?C.compileNode(e,n[a]):'"'+n[a]+'"');return"ctx.getPath("+r+", ["+i.join(",")+"])"},literal:function(e,t){return A(t[1])},raw:function(e,t){return".w("+A(t[1])+")"}};var L=/\\/g,w=/"/g,b=/\f/g,S=/\n/g,E=/\r/g,O=/\t/g,A="undefined"==typeof JSON?function(e){return'"'+f(e)+'"'}:JSON.stringify;return t.compiler=C,t.compile=t.compiler.compile,t.renderSource=m,t.compileFn=y,t.filterNode=C.filterNode,t.optimizers=C.optimizers,t.pragmas=C.pragmas,t.compileNode=C.compileNode,t.nodes=C.nodes,C});"function"==typeof define&&define.amd&&define.amd.dust===!0&&define(["require","dust.core","dust.compile"],function(e,t){return t.onLoad=function(t,r){e([t],function(){r()})},t});!function(e,t){"function"==typeof define&&define.amd&&define.amd.dust===!0?define(["dust.core"],t):"object"==typeof exports?module.exports=t(require("dustjs-linkedin")):t(e.dust)}(this,function(e){function t(t,r,n){n=n||"INFO";t=t?"{@"+t+"}: ":"";e.log(t+r,n)}function r(e){p[e]||(t(e,"Deprecation warning: "+e+" is deprecated and will be removed in a future version of dustjs-helpers","WARN"),t(null,"For help and a deprecation timeline, see https://github.com/linkedin/dustjs-helpers/wiki/Deprecated-Features#"+e.replace(/\W+/g,""),"WARN"),p[e]=!0)}function n(e){return e.stack.tail&&e.stack.tail.head&&"undefined"!=typeof e.stack.tail.head.__select__}function i(e){return n(e)&&e.get("__select__")}function a(e,t){var r,n,i=e.stack.head,a=e.rebase();e.stack&&e.stack.tail&&(a.stack=e.stack.tail);n={isPending:!1,isResolved:!1,isDeferredComplete:!1,deferreds:[]};for(r in t)n[r]=t[r];return a.push({__select__:n}).push(i,e.stack.index,e.stack.of)}function s(e){var t,r;if(e.isDeferredPending=!0,e.deferreds.length)for(e.isDeferredComplete=!0,t=0,r=e.deferreds.length;r>t;t++)e.deferreds[t]();e.isDeferredPending=!1}function o(e,t){return"function"==typeof t?t.toString().replace(/(^\s+|\s+$)/gm,"").replace(/\n/gm,"").replace(/,\s*/gm,", ").replace(/\)\{/gm,") {"):t}function l(e,t){return function(r,n,i,a){return c(r,n,i,a,e,t)}}function c(e,r,n,a,s,o){var l,c,p,h,d=n.block,f=n["else"],m=i(r)||{};if(m.isResolved&&!m.isDeferredPending)return e;if(a.hasOwnProperty("key"))c=a.key;else{if(!m.hasOwnProperty("key"))return t(s,"No key specified","WARN"),e;c=m.key}return h=a.type||m.type,c=u(r.resolve(c),h),p=u(r.resolve(a.value),h),o(c,p)?(m.isPending||(l=!0,m.isPending=!0),d&&(e=e.render(d,r)),l&&(m.isResolved=!0)):f&&(e=e.render(f,r)),e}function u(e,t){t&&(t=t.toLowerCase());switch(t){case"number":return+e;case"string":return String(e);case"boolean":return e="false"===e?!1:e,Boolean(e);case"date":return new Date(e)}return e}var p={},h={tap:function(e,t,n){return r("tap"),n.resolve(e)},sep:function(e,t,r){var n=r.block;return t.stack.index===t.stack.of-1?e:n?n(e,t):e},first:function(e,t,r){return 0===t.stack.index?r.block(e,t):e},last:function(e,t,r){return t.stack.index===t.stack.of-1?r.block(e,t):e},contextDump:function(e,r,n,i){var a,s,l=r.resolve(i.to),c=r.resolve(i.key);switch(c){case"full":a=r.stack;break;default:a=r.stack.head}s=JSON.stringify(a,o,2);switch(l){case"console":t("contextDump",s);break;default:s=s.replace(/</g,"\\u003c");e=e.write(s)}return e},math:function(e,r,n,o){var l,c=o.key,u=o.method,p=o.operand,h=o.round;if(!o.hasOwnProperty("key")||!o.method)return t("math","`key` or `method` was not provided","ERROR"),e;c=parseFloat(r.resolve(c));p=parseFloat(r.resolve(p));switch(u){case"mod":0===p&&t("math","Division by 0","ERROR");l=c%p;break;case"add":l=c+p;break;case"subtract":l=c-p;break;case"multiply":l=c*p;break;case"divide":0===p&&t("math","Division by 0","ERROR");l=c/p;break;case"ceil":case"floor":case"round":case"abs":l=Math[u](c);break;case"toint":l=parseInt(c,10);break;default:t("math","Method `"+u+"` is not supported","ERROR")}return"undefined"!=typeof l&&(h&&(l=Math.round(l)),n&&n.block?(r=a(r,{key:l}),e=e.render(n.block,r),s(i(r))):e=e.write(l)),e},select:function(e,r,n,o){var l=n.block,c={};return o.hasOwnProperty("key")&&(c.key=r.resolve(o.key)),o.hasOwnProperty("type")&&(c.type=o.type),l?(r=a(r,c),e=e.render(l,r),s(i(r))):t("select","Missing body block","WARN"),e},eq:l("eq",function(e,t){return e===t}),ne:l("ne",function(e,t){return e!==t}),lt:l("lt",function(e,t){return t>e}),lte:l("lte",function(e,t){return t>=e}),gt:l("gt",function(e,t){return e>t}),gte:l("gte",function(e,t){return e>=t}),any:function(e,r,n){var a=i(r);return a?a.isDeferredComplete?t("any","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){a.deferreds.push(function(){a.isResolved&&(e=e.render(n.block,r));e.end()})}):t("any","Must be used inside a {@select} block","ERROR"),e},none:function(e,r,n){var a=i(r);return a?a.isDeferredComplete?t("none","Must not be nested inside {@any} or {@none} block","ERROR"):e=e.map(function(e){a.deferreds.push(function(){a.isResolved||(e=e.render(n.block,r));e.end()})}):t("none","Must be used inside a {@select} block","ERROR"),e},size:function(t,r,n,i){var a,s,o=i.key;if(o=r.resolve(i.key),o&&o!==!0)if(e.isArray(o))a=o.length;else if(!isNaN(parseFloat(o))&&isFinite(o))a=o;else if("object"==typeof o){a=0;for(s in o)o.hasOwnProperty(s)&&a++}else a=(o+"").length;else a=0;return t.write(a)}};for(var d in h)e.helpers[d]=h[d];return e});!function(e,t){"function"==typeof define&&define.amd?define(["dustjs-linkedin"],function(r){return t(r,e)}):"object"==typeof module&&module.exports?module.exports=t(require("dustjs-linkedin"),this):e.dust=t(e.dust,e)}(this,function(e,t,r){"use strict";var n=Object.prototype.toString,i=typeof console!==r?console:{log:function(){}},a={isArray:Array.isArray||function(e){return"[object Array]"===n.call(e)},isAvailable:function(e){return o[e]!==r},log:i.log},s={selected:r,languages:{},filters:{}},o=s.languages;return typeof String.prototype.trim===r&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),e.i18n={resetContext:function(){s.selected=r,Object.keys(o).forEach(function(e){delete o[e]})},setLanguage:function(e){if(!a.isAvailable(e))throw new Error("language '"+e+"' not available!");s.selected=e},setLanguages:function(e){a.isArray(e)&&e.forEach(function(e){a.isAvailable(e)||(o[e]={}),s.selected===r&&(s.selected=e)})},add:function(e,t){if(a.isAvailable(e)){var r=o[e];Object.keys(t).forEach(function(e){r[e]=t[e]})}},addFilter:function(e,t){e in s.filters||(s.filters[e]=t)}},e.helpers.i18n=function(t,n,i,l){if(l&&l.$key!==r){var c,u,p,h,d,f=s.selected,m=o[f],y=/\{(\s*[\w]+\s*)\}/g;h=e.helpers.tap(l.$key,t,n).split("|");var g=e.helpers.tap(h.shift(),t,n);for(d=m!==r&&m[g]!==r?m[g]:null;null!==(c=y.exec(d));)p=c[1].trim(),"$key"===p?(u="",a.log("$key can't be used as a parameter")):u=e.helpers.tap(l[c[1].trim()],t,n),d=d.replace(c[0],u);h.forEach(function(e){e in s.filters&&(d=s.filters[e](d))}),t.write(d)}else a.log("No key given in the i18n helper");return t},e});!function(){dust.helpers.iterate=function(e,t,r,n){n=n||{};var i=n.on||t.current(),a=null!=n.excludedKeys?n.excludedKeys.split(","):null;for(var s in i)(null==a||a.indexOf(s)<0)&&(e=e.render(r.block,t.push({key:s,value:i[s]})));return e}}();!function(){var e,t,r,n;!function(){var i={},a={};e=function(e,t,r){i[e]={deps:t,callback:r}},n=r=t=function(e){function r(t){if("."!==t.charAt(0))return t;for(var r=t.split("/"),n=e.split("/").slice(0,-1),i=0,a=r.length;a>i;i++){var s=r[i];if(".."===s)n.pop();else{if("."===s)continue;n.push(s)}}return n.join("/")}if(n._eak_seen=i,a[e])return a[e];if(a[e]={},!i[e])throw new Error("Could not find module "+e);for(var s,o=i[e],l=o.deps,c=o.callback,u=[],p=0,h=l.length;h>p;p++)u.push("exports"===l[p]?s={}:t(r(l[p])));var d=c.apply(this,u);return a[e]=s||d}}(),e("promise/all",["./utils","exports"],function(e,t){"use strict";function r(e){var t=this;if(!n(e))throw new TypeError("You must pass an array to all.");return new t(function(t,r){function n(e){return function(t){a(e,t)}}function a(e,r){o[e]=r,0===--l&&t(o)}var s,o=[],l=e.length;0===l&&t([]);for(var c=0;c<e.length;c++)s=e[c],s&&i(s.then)?s.then(n(c),r):a(c,s)})}var n=e.isArray,i=e.isFunction;t.all=r}),e("promise/asap",["exports"],function(e){"use strict";function t(){return function(){process.nextTick(i)}}function r(){var e=0,t=new l(i),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function n(){return function(){c.setTimeout(i,1)}}function i(){for(var e=0;e<u.length;e++){var t=u[e],r=t[0],n=t[1];r(n)}u=[]}function a(e,t){var r=u.push([e,t]);1===r&&s()}var s,o="undefined"!=typeof window?window:{},l=o.MutationObserver||o.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,u=[];s="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?t():l?r():n(),e.asap=a}),e("promise/config",["exports"],function(e){"use strict";function t(e,t){return 2!==arguments.length?r[e]:void(r[e]=t)}var r={instrument:!1};e.config=r,e.configure=t}),e("promise/polyfill",["./promise","./utils","exports"],function(e,t,r){"use strict";function n(){var e;e="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var t="Promise"in e&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var t;return new e.Promise(function(e){t=e}),a(t)}();t||(e.Promise=i)}var i=e.Promise,a=t.isFunction;r.polyfill=n}),e("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(e,t,r,n,i,a,s,o){"use strict";function l(e){if(!L(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof l))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],c(e,this)}function c(e,t){function r(e){f(t,e)}function n(e){y(t,e)}try{e(r,n)}catch(i){n(i)}}function u(e,t,r,n){var i,a,s,o,l=L(r);if(l)try{i=r(n),s=!0}catch(c){o=!0,a=c}else i=n,s=!0;d(t,i)||(l&&s?f(t,i):o?y(t,a):e===P?f(t,i):e===_&&y(t,i))}function p(e,t,r,n){var i=e._subscribers,a=i.length;i[a]=t,i[a+P]=r,i[a+_]=n}function h(e,t){for(var r,n,i=e._subscribers,a=e._detail,s=0;s<i.length;s+=3)r=i[s],n=i[s+t],u(t,r,n,a);e._subscribers=null}function d(e,t){var r,n=null;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(T(t)&&(n=t.then,L(n)))return n.call(t,function(n){return r?!0:(r=!0,void(t!==n?f(e,n):m(e,n)))},function(t){return r?!0:(r=!0,void y(e,t))}),!0}catch(i){return r?!0:(y(e,i),!0)}return!1}function f(e,t){e===t?m(e,t):d(e,t)||m(e,t)}function m(e,t){e._state===A&&(e._state=x,e._detail=t,C.async(g,e))}function y(e,t){e._state===A&&(e._state=x,e._detail=t,C.async(v,e))}function g(e){h(e,e._state=P)}function v(e){h(e,e._state=_)}var C=e.config,T=(e.configure,t.objectOrFunction),L=t.isFunction,w=(t.now,r.all),b=n.race,S=i.resolve,E=a.reject,O=s.asap;C.async=O;var A=void 0,x=0,P=1,_=2;l.prototype={constructor:l,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(e,t){var r=this,n=new this.constructor(function(){});if(this._state){var i=arguments;C.async(function(){u(r._state,n,i[r._state-1],r._detail)})}else p(this,n,e,t);return n},"catch":function(e){return this.then(null,e)}},l.all=w,l.race=b,l.resolve=S,l.reject=E,o.Promise=l}),e("promise/race",["./utils","exports"],function(e,t){"use strict";function r(e){var t=this;if(!n(e))throw new TypeError("You must pass an array to race.");return new t(function(t,r){for(var n,i=0;i<e.length;i++)n=e[i],n&&"function"==typeof n.then?n.then(t,r):t(n)})}var n=e.isArray;t.race=r}),e("promise/reject",["exports"],function(e){"use strict";function t(e){var t=this;return new t(function(t,r){r(e)})}e.reject=t}),e("promise/resolve",["exports"],function(e){"use strict";function t(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=this;return new t(function(t){t(e)})}e.resolve=t}),e("promise/utils",["exports"],function(e){"use strict";function t(e){return r(e)||"object"==typeof e&&null!==e}function r(e){return"function"==typeof e}function n(e){return"[object Array]"===Object.prototype.toString.call(e)}var i=Date.now||function(){return(new Date).getTime()};e.objectOrFunction=t,e.isFunction=r,e.isArray=n,e.now=i}),t("promise/polyfill").polyfill()}(),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.localforage=t():e.localforage=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var i=r[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var i=function(e){function t(e,t){e[t]=function(){var r=arguments;return e.ready().then(function(){return e[t].apply(e,r)})}}function i(){for(var e=1;e<arguments.length;e++){var t=arguments[e];if(t)for(var r in t)t.hasOwnProperty(r)&&(arguments[0][r]=h(t[r])?t[r].slice():t[r])}return arguments[0]}function a(e){for(var t in o)if(o.hasOwnProperty(t)&&o[t]===e)return!0;return!1}var s={},o={INDEXEDDB:"asyncStorage",LOCALSTORAGE:"localStorageWrapper",WEBSQL:"webSQLStorage"},l=[o.INDEXEDDB,o.WEBSQL,o.LOCALSTORAGE],c=["clear","getItem","iterate","key","keys","length","removeItem","setItem"],u={description:"",driver:l.slice(),name:"localforage",size:4980736,storeName:"keyvaluepairs",version:1},p=function(e){var t={};return t[o.INDEXEDDB]=!!function(){try{var t=t||e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.OIndexedDB||e.msIndexedDB;return"undefined"!=typeof e.openDatabase&&e.navigator&&e.navigator.userAgent&&/Safari/.test(e.navigator.userAgent)&&!/Chrome/.test(e.navigator.userAgent)?!1:t&&"function"==typeof t.open&&"undefined"!=typeof e.IDBKeyRange}catch(r){return!1}}(),t[o.WEBSQL]=!!function(){try{return e.openDatabase}catch(t){return!1}}(),t[o.LOCALSTORAGE]=!!function(){try{return e.localStorage&&"setItem"in e.localStorage&&e.localStorage.setItem}catch(t){return!1}}(),t}(e),h=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},d=function(){function e(t){n(this,e),this.INDEXEDDB=o.INDEXEDDB,this.LOCALSTORAGE=o.LOCALSTORAGE,this.WEBSQL=o.WEBSQL,this._defaultConfig=i({},u),this._config=i({},this._defaultConfig,t),this._driverSet=null,this._initDriver=null,this._ready=!1,this._dbInfo=null,this._wrapLibraryMethodsWithReady(),this.setDriver(this._config.driver)}return e.prototype.config=function(e){if("object"==typeof e){if(this._ready)return new Error("Can't call config() after localforage has been used.");for(var t in e)"storeName"===t&&(e[t]=e[t].replace(/\W/g,"_")),this._config[t]=e[t];return"driver"in e&&e.driver&&this.setDriver(this._config.driver),!0}return"string"==typeof e?this._config[e]:this._config},e.prototype.defineDriver=function(e,t,r){var n=new Promise(function(t,r){try{var n=e._driver,i=new Error("Custom driver not compliant; see https://mozilla.github.io/localForage/#definedriver"),o=new Error("Custom driver name already in use: "+e._driver);if(!e._driver)return void r(i);if(a(e._driver))return void r(o);for(var l=c.concat("_initStorage"),u=0;u<l.length;u++){var h=l[u];if(!h||!e[h]||"function"!=typeof e[h])return void r(i);

}var d=Promise.resolve(!0);"_support"in e&&(d=e._support&&"function"==typeof e._support?e._support():Promise.resolve(!!e._support)),d.then(function(r){p[n]=r,s[n]=e,t()},r)}catch(f){r(f)}});return n.then(t,r),n},e.prototype.driver=function(){return this._driver||null},e.prototype.getDriver=function(e,t,n){var i=this,o=function(){if(a(e))switch(e){case i.INDEXEDDB:return new Promise(function(e,t){e(r(1))});case i.LOCALSTORAGE:return new Promise(function(e,t){e(r(2))});case i.WEBSQL:return new Promise(function(e,t){e(r(4))})}else if(s[e])return Promise.resolve(s[e]);return Promise.reject(new Error("Driver not found."))}();return o.then(t,n),o},e.prototype.getSerializer=function(e){var t=new Promise(function(e,t){e(r(3))});return e&&"function"==typeof e&&t.then(function(t){e(t)}),t},e.prototype.ready=function(e){var t=this,r=t._driverSet.then(function(){return null===t._ready&&(t._ready=t._initDriver()),t._ready});return r.then(e,e),r},e.prototype.setDriver=function(e,t,r){function n(){a._config.driver=a.driver()}function i(e){return function(){function t(){for(;r<e.length;){var i=e[r];return r++,a._dbInfo=null,a._ready=null,a.getDriver(i).then(function(e){return a._extend(e),n(),a._ready=a._initStorage(a._config),a._ready})["catch"](t)}n();var s=new Error("No available storage method found.");return a._driverSet=Promise.reject(s),a._driverSet}var r=0;return t()}}var a=this;h(e)||(e=[e]);var s=this._getSupportedDrivers(e),o=null!==this._driverSet?this._driverSet["catch"](function(){return Promise.resolve()}):Promise.resolve();return this._driverSet=o.then(function(){var e=s[0];return a._dbInfo=null,a._ready=null,a.getDriver(e).then(function(e){a._driver=e._driver,n(),a._wrapLibraryMethodsWithReady(),a._initDriver=i(s)})})["catch"](function(){n();var e=new Error("No available storage method found.");return a._driverSet=Promise.reject(e),a._driverSet}),this._driverSet.then(t,r),this._driverSet},e.prototype.supports=function(e){return!!p[e]},e.prototype._extend=function(e){i(this,e)},e.prototype._getSupportedDrivers=function(e){for(var t=[],r=0,n=e.length;n>r;r++){var i=e[r];this.supports(i)&&t.push(i)}return t},e.prototype._wrapLibraryMethodsWithReady=function(){for(var e=0;e<c.length;e++)t(this,c[e])},e.prototype.createInstance=function(t){return new e(t)},e}();return new d}("undefined"!=typeof window?window:self);t["default"]=i,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var r=function(e){function t(t,r){t=t||[],r=r||{};try{return new Blob(t,r)}catch(n){if("TypeError"!==n.name)throw n;for(var i=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,a=new i,s=0;s<t.length;s+=1)a.append(t[s]);return a.getBlob(r.type)}}function r(e){for(var t=e.length,r=new ArrayBuffer(t),n=new Uint8Array(r),i=0;t>i;i++)n[i]=e.charCodeAt(i);return r}function n(e){return new Promise(function(t,r){var n=new XMLHttpRequest;n.open("GET",e),n.withCredentials=!0,n.responseType="arraybuffer",n.onreadystatechange=function(){return 4===n.readyState?200===n.status?t({response:n.response,type:n.getResponseHeader("Content-Type")}):void r({status:n.status,response:n.response}):void 0},n.send()})}function i(e){return new Promise(function(r,i){var a=t([""],{type:"image/png"}),s=e.transaction([P],"readwrite");s.objectStore(P).put(a,"key"),s.oncomplete=function(){var t=e.transaction([P],"readwrite"),a=t.objectStore(P).get("key");a.onerror=i,a.onsuccess=function(e){var t=e.target.result,i=URL.createObjectURL(t);n(i).then(function(e){r(!(!e||"image/png"!==e.type))},function(){r(!1)}).then(function(){URL.revokeObjectURL(i)})}},s.onerror=s.onabort=i})["catch"](function(){return!1})}function a(e){return"boolean"==typeof A?Promise.resolve(A):i(e).then(function(e){return A=e})}function s(e){return new Promise(function(t,r){var n=new FileReader;n.onerror=r,n.onloadend=function(r){var n=btoa(r.target.result||"");t({__local_forage_encoded_blob:!0,data:n,type:e.type})},n.readAsBinaryString(e)})}function o(e){var n=r(atob(e.data));return t([n],{type:e.type})}function l(e){return e&&e.__local_forage_encoded_blob}function c(e){var t=this,r=t._initReady().then(function(){var e=x[t._dbInfo.name];return e&&e.dbReady?e.dbReady:void 0});return r.then(e,e),r}function u(e){var t=x[e.name],r={};r.promise=new Promise(function(e){r.resolve=e}),t.deferredOperations.push(r),t.dbReady=t.dbReady?t.dbReady.then(function(){return r.promise}):r.promise}function p(e){var t=x[e.name],r=t.deferredOperations.pop();r&&r.resolve()}function h(e){function t(){return Promise.resolve()}var r=this,n={db:null};if(e)for(var i in e)n[i]=e[i];x||(x={});var a=x[n.name];a||(a={forages:[],db:null,dbReady:null,deferredOperations:[]},x[n.name]=a),a.forages.push(r),r._initReady||(r._initReady=r.ready,r.ready=c);for(var s=[],o=0;o<a.forages.length;o++){var l=a.forages[o];l!==r&&s.push(l._initReady()["catch"](t))}var u=a.forages.slice(0);return Promise.all(s).then(function(){return n.db=a.db,d(n)}).then(function(e){return n.db=e,y(n,r._defaultConfig.version)?f(n):e}).then(function(e){n.db=a.db=e,r._dbInfo=n;for(var t=0;t<u.length;t++){var i=u[t];i!==r&&(i._dbInfo.db=n.db,i._dbInfo.version=n.version)}})}function d(e){return m(e,!1)}function f(e){return m(e,!0)}function m(t,r){return new Promise(function(n,i){if(t.db){if(!r)return n(t.db);u(t),t.db.close()}var a=[t.name];r&&a.push(t.version);var s=O.open.apply(O,a);r&&(s.onupgradeneeded=function(r){var n=s.result;try{n.createObjectStore(t.storeName),r.oldVersion<=1&&n.createObjectStore(P)}catch(i){if("ConstraintError"!==i.name)throw i;e.console.warn('The database "'+t.name+'" has been upgraded from version '+r.oldVersion+" to version "+r.newVersion+', but the storage "'+t.storeName+'" already exists.')}}),s.onerror=function(){i(s.error)},s.onsuccess=function(){n(s.result),p(t)}})}function y(t,r){if(!t.db)return!0;var n=!t.db.objectStoreNames.contains(t.storeName),i=t.version<t.db.version,a=t.version>t.db.version;if(i&&(t.version!==r&&e.console.warn('The database "'+t.name+"\" can't be downgraded from version "+t.db.version+" to version "+t.version+"."),t.version=t.db.version),a||n){if(n){var s=t.db.version+1;s>t.version&&(t.version=s)}return!0}return!1}function g(t,r){var n=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,r){n.ready().then(function(){var i=n._dbInfo,a=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),s=a.get(t);s.onsuccess=function(){var t=s.result;void 0===t&&(t=null),l(t)&&(t=o(t)),e(t)},s.onerror=function(){r(s.error)}})["catch"](r)});return E(i,r),i}function v(e,t){var r=this,n=new Promise(function(t,n){r.ready().then(function(){var i=r._dbInfo,a=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),s=a.openCursor(),c=1;s.onsuccess=function(){var r=s.result;if(r){var n=r.value;l(n)&&(n=o(n));var i=e(n,r.key,c++);void 0!==i?t(i):r["continue"]()}else t()},s.onerror=function(){n(s.error)}})["catch"](n)});return E(n,t),n}function C(t,r,n){var i=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var o=new Promise(function(e,n){var o;i.ready().then(function(){return o=i._dbInfo,r instanceof Blob?a(o.db).then(function(e){return e?r:s(r)}):r}).then(function(r){var i=o.db.transaction(o.storeName,"readwrite"),a=i.objectStore(o.storeName);null===r&&(r=void 0),i.oncomplete=function(){void 0===r&&(r=null),e(r)},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;n(e)};var s=a.put(r,t)})["catch"](n)});return E(o,n),o}function T(t,r){var n=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,r){n.ready().then(function(){var i=n._dbInfo,a=i.db.transaction(i.storeName,"readwrite"),s=a.objectStore(i.storeName),o=s["delete"](t);a.oncomplete=function(){e()},a.onerror=function(){r(o.error)},a.onabort=function(){var e=o.error?o.error:o.transaction.error;r(e)}})["catch"](r)});return E(i,r),i}function L(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo,i=n.db.transaction(n.storeName,"readwrite"),a=i.objectStore(n.storeName),s=a.clear();i.oncomplete=function(){e()},i.onabort=i.onerror=function(){var e=s.error?s.error:s.transaction.error;r(e)}})["catch"](r)});return E(r,e),r}function w(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo,i=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName),a=i.count();a.onsuccess=function(){e(a.result)},a.onerror=function(){r(a.error)}})["catch"](r)});return E(r,e),r}function b(e,t){var r=this,n=new Promise(function(t,n){return 0>e?void t(null):void r.ready().then(function(){var i=r._dbInfo,a=i.db.transaction(i.storeName,"readonly").objectStore(i.storeName),s=!1,o=a.openCursor();o.onsuccess=function(){var r=o.result;return r?void(0===e?t(r.key):s?t(r.key):(s=!0,r.advance(e))):void t(null)},o.onerror=function(){n(o.error)}})["catch"](n)});return E(n,t),n}function S(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo,i=n.db.transaction(n.storeName,"readonly").objectStore(n.storeName),a=i.openCursor(),s=[];a.onsuccess=function(){var t=a.result;return t?(s.push(t.key),void t["continue"]()):void e(s)},a.onerror=function(){r(a.error)}})["catch"](r)});return E(r,e),r}function E(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var O=O||e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.OIndexedDB||e.msIndexedDB;if(O){var A,x,P="local-forage-detect-blob-support",_={_driver:"asyncStorage",_initStorage:h,iterate:v,getItem:g,setItem:C,removeItem:T,clear:L,length:w,key:b,keys:S};return _}}("undefined"!=typeof window?window:self);t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){function t(e){var t=this,n={};if(e)for(var i in e)n[i]=e[i];return n.keyPrefix=n.name+"/",n.storeName!==t._defaultConfig.storeName&&(n.keyPrefix+=n.storeName+"/"),t._dbInfo=n,new Promise(function(e,t){e(r(3))}).then(function(e){return n.serializer=e,Promise.resolve()})}function n(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo.keyPrefix,r=h.length-1;r>=0;r--){var n=h.key(r);0===n.indexOf(e)&&h.removeItem(n)}});return p(r,e),r}function i(t,r){var n=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=n.ready().then(function(){var e=n._dbInfo,r=h.getItem(e.keyPrefix+t);return r&&(r=e.serializer.deserialize(r)),r});return p(i,r),i}function a(e,t){var r=this,n=r.ready().then(function(){for(var t=r._dbInfo,n=t.keyPrefix,i=n.length,a=h.length,s=1,o=0;a>o;o++){var l=h.key(o);if(0===l.indexOf(n)){var c=h.getItem(l);if(c&&(c=t.serializer.deserialize(c)),c=e(c,l.substring(i),s++),void 0!==c)return c}}});return p(n,t),n}function s(e,t){var r=this,n=r.ready().then(function(){var t,n=r._dbInfo;try{t=h.key(e)}catch(i){t=null}return t&&(t=t.substring(n.keyPrefix.length)),t});return p(n,t),n}function o(e){var t=this,r=t.ready().then(function(){for(var e=t._dbInfo,r=h.length,n=[],i=0;r>i;i++)0===h.key(i).indexOf(e.keyPrefix)&&n.push(h.key(i).substring(e.keyPrefix.length));return n});return p(r,e),r}function l(e){var t=this,r=t.keys().then(function(e){return e.length});return p(r,e),r}function c(t,r){var n=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=n.ready().then(function(){var e=n._dbInfo;h.removeItem(e.keyPrefix+t)});return p(i,r),i}function u(t,r,n){var i=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var a=i.ready().then(function(){void 0===r&&(r=null);var e=r;return new Promise(function(n,a){var s=i._dbInfo;s.serializer.serialize(r,function(r,i){if(i)a(i);else try{h.setItem(s.keyPrefix+t,r),n(e)}catch(o){("QuotaExceededError"===o.name||"NS_ERROR_DOM_QUOTA_REACHED"===o.name)&&a(o),a(o)}})})});return p(a,n),a}function p(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var h=null;try{if(!(e.localStorage&&"setItem"in e.localStorage))return;h=e.localStorage}catch(d){return}var f={_driver:"localStorageWrapper",_initStorage:t,iterate:a,getItem:i,setItem:u,removeItem:c,clear:n,length:l,key:s,keys:o};return f}("undefined"!=typeof window?window:self);t["default"]=n,e.exports=t["default"]},function(e,t){"use strict";t.__esModule=!0;var r=function(e){function t(t,r){t=t||[],r=r||{};try{return new Blob(t,r)}catch(n){if("TypeError"!==n.name)throw n;for(var i=e.BlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder||e.WebKitBlobBuilder,a=new i,s=0;s<t.length;s+=1)a.append(t[s]);return a.getBlob(r.type)}}function r(e,t){var r="";if(e&&(r=e.toString()),e&&("[object ArrayBuffer]"===e.toString()||e.buffer&&"[object ArrayBuffer]"===e.buffer.toString())){var n,i=c;e instanceof ArrayBuffer?(n=e,i+=p):(n=e.buffer,"[object Int8Array]"===r?i+=d:"[object Uint8Array]"===r?i+=f:"[object Uint8ClampedArray]"===r?i+=m:"[object Int16Array]"===r?i+=y:"[object Uint16Array]"===r?i+=v:"[object Int32Array]"===r?i+=g:"[object Uint32Array]"===r?i+=C:"[object Float32Array]"===r?i+=T:"[object Float64Array]"===r?i+=L:t(new Error("Failed to get type for BinaryArray"))),t(i+a(n))}else if("[object Blob]"===r){var s=new FileReader;s.onload=function(){var r=o+e.type+"~"+a(this.result);t(c+h+r)},s.readAsArrayBuffer(e)}else try{t(JSON.stringify(e))}catch(l){console.error("Couldn't convert value into a JSON string: ",e),t(null,l)}}function n(e){if(e.substring(0,u)!==c)return JSON.parse(e);var r,n=e.substring(w),a=e.substring(u,w);if(a===h&&l.test(n)){var s=n.match(l);r=s[1],n=n.substring(s[0].length)}var o=i(n);switch(a){case p:return o;case h:return t([o],{type:r});case d:return new Int8Array(o);case f:return new Uint8Array(o);case m:return new Uint8ClampedArray(o);case y:return new Int16Array(o);case v:return new Uint16Array(o);case g:return new Int32Array(o);case C:return new Uint32Array(o);case T:return new Float32Array(o);case L:return new Float64Array(o);default:throw new Error("Unkown type: "+a)}}function i(e){var t,r,n,i,a,o=.75*e.length,l=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);var u=new ArrayBuffer(o),p=new Uint8Array(u);for(t=0;l>t;t+=4)r=s.indexOf(e[t]),n=s.indexOf(e[t+1]),i=s.indexOf(e[t+2]),a=s.indexOf(e[t+3]),p[c++]=r<<2|n>>4,p[c++]=(15&n)<<4|i>>2,p[c++]=(3&i)<<6|63&a;return u}function a(e){var t,r=new Uint8Array(e),n="";for(t=0;t<r.length;t+=3)n+=s[r[t]>>2],n+=s[(3&r[t])<<4|r[t+1]>>4],n+=s[(15&r[t+1])<<2|r[t+2]>>6],n+=s[63&r[t+2]];return r.length%3===2?n=n.substring(0,n.length-1)+"=":r.length%3===1&&(n=n.substring(0,n.length-2)+"=="),n}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o="~~local_forage_type~",l=/^~~local_forage_type~([^~]+)~/,c="__lfsc__:",u=c.length,p="arbf",h="blob",d="si08",f="ui08",m="uic8",y="si16",g="si32",v="ur16",C="ui32",T="fl32",L="fl64",w=u+p.length,b={serialize:r,deserialize:n,stringToBuffer:i,bufferToString:a};return b}("undefined"!=typeof window?window:self);t["default"]=r,e.exports=t["default"]},function(e,t,r){"use strict";t.__esModule=!0;var n=function(e){function t(e){var t=this,n={db:null};if(e)for(var i in e)n[i]="string"!=typeof e[i]?e[i].toString():e[i];var a=new Promise(function(e,r){try{n.db=h(n.name,String(n.version),n.description,n.size)}catch(i){return r(i)}n.db.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS "+n.storeName+" (id INTEGER PRIMARY KEY, key unique, value)",[],function(){t._dbInfo=n,e()},function(e,t){r(t)})})});return new Promise(function(e,t){e(r(3))}).then(function(e){return n.serializer=e,a})}function n(t,r){var n=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("SELECT * FROM "+i.storeName+" WHERE key = ? LIMIT 1",[t],function(t,r){var n=r.rows.length?r.rows.item(0).value:null;n&&(n=i.serializer.deserialize(n)),e(n)},function(e,t){r(t)})})})["catch"](r)});return p(i,r),i}function i(e,t){var r=this,n=new Promise(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT * FROM "+i.storeName,[],function(r,n){for(var a=n.rows,s=a.length,o=0;s>o;o++){var l=a.item(o),c=l.value;if(c&&(c=i.serializer.deserialize(c)),c=e(c,l.key,o+1),void 0!==c)return void t(c)}t()},function(e,t){n(t)})})})["catch"](n)});return p(n,t),n}function a(t,r,n){var i=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var a=new Promise(function(e,n){i.ready().then(function(){void 0===r&&(r=null);var a=r,s=i._dbInfo;s.serializer.serialize(r,function(r,i){i?n(i):s.db.transaction(function(i){i.executeSql("INSERT OR REPLACE INTO "+s.storeName+" (key, value) VALUES (?, ?)",[t,r],function(){e(a)},function(e,t){n(t)})},function(e){e.code===e.QUOTA_ERR&&n(e)})})})["catch"](n)});return p(a,n),a}function s(t,r){var n=this;"string"!=typeof t&&(e.console.warn(t+" used as a key, but it is not a string."),t=String(t));var i=new Promise(function(e,r){n.ready().then(function(){var i=n._dbInfo;i.db.transaction(function(n){n.executeSql("DELETE FROM "+i.storeName+" WHERE key = ?",[t],function(){e()},function(e,t){r(t)})})})["catch"](r)});return p(i,r),i}function o(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("DELETE FROM "+n.storeName,[],function(){e()},function(e,t){r(t)})})})["catch"](r)});return p(r,e),r}function l(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("SELECT COUNT(key) as c FROM "+n.storeName,[],function(t,r){var n=r.rows.item(0).c;e(n)},function(e,t){r(t)})})})["catch"](r)});return p(r,e),r}function c(e,t){var r=this,n=new Promise(function(t,n){r.ready().then(function(){var i=r._dbInfo;i.db.transaction(function(r){r.executeSql("SELECT key FROM "+i.storeName+" WHERE id = ? LIMIT 1",[e+1],function(e,r){var n=r.rows.length?r.rows.item(0).key:null;t(n)},function(e,t){n(t)})})})["catch"](n)});return p(n,t),n}function u(e){var t=this,r=new Promise(function(e,r){t.ready().then(function(){var n=t._dbInfo;n.db.transaction(function(t){t.executeSql("SELECT key FROM "+n.storeName,[],function(t,r){for(var n=[],i=0;i<r.rows.length;i++)n.push(r.rows.item(i).key);e(n)},function(e,t){r(t)})})})["catch"](r)});return p(r,e),r}function p(e,t){t&&e.then(function(e){t(null,e)},function(e){t(e)})}var h=e.openDatabase;if(h){var d={_driver:"webSQLStorage",_initStorage:t,iterate:i,getItem:n,setItem:a,removeItem:s,clear:o,length:l,key:c,keys:u};return d}}("undefined"!=typeof window?window:self);t["default"]=n,e.exports=t["default"]}])});var __extends=this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype;e.prototype=new r};!function(e){function t(e,t,r){void 0!==t[e]&&(null===t[e]?delete r[e]:r[e]=t[e])}function r(t){if(null!=e.enabled&&!e.enabled||null!=e.maxMessages&&1>e.maxMessages)return!1;try{if(t.userAgentRegex&&!RegExp(t.userAgentRegex).test(navigator.userAgent))return!1}catch(r){}try{if(t.ipRegex&&e.clientIP&&!RegExp(t.ipRegex).test(e.clientIP))return!1}catch(n){}return!0}function n(e,t){try{if(e.disallow&&RegExp(e.disallow).test(t))return!1}catch(r){}return!0}function i(e){return"function"==typeof e?e instanceof RegExp?e.toString():e():e}function a(e){e=i(e);switch(typeof e){case"string":return new s(e,null,e);case"number":return e=e.toString(),new s(e,null,e);case"boolean":return e=e.toString(),new s(e,null,e);case"undefined":return new s("undefined",null,"undefined");case"object":return e instanceof RegExp||e instanceof String||e instanceof Number||e instanceof Boolean?(e=e.toString(),new s(e,null,e)):new s(null,e,JSON.stringify(e));default:return new s("unknown",null,"unknown")}}e.enabled;e.maxMessages;e.defaultAjaxUrl;e.clientIP;e.defaultBeforeSend;e.requestId="";var s=function(){return function(e,t,r){this.msg=e;this.meta=t;this.finalString=r}}();e.setOptions=function(e){t("enabled",e,this);t("maxMessages",e,this);t("defaultAjaxUrl",e,this);t("clientIP",e,this);t("requestId",e,this);t("defaultBeforeSend",e,this);return this};e.getAllLevel=function(){return-2147483648};e.getTraceLevel=function(){return 1e3};e.getDebugLevel=function(){return 2e3};e.getInfoLevel=function(){return 3e3};e.getWarnLevel=function(){return 4e3};e.getErrorLevel=function(){return 5e3};e.getFatalLevel=function(){return 6e3};e.getOffLevel=function(){return 2147483647};var o=function(){return function(e,t){this.inner=t;this.name="JL.Exception";this.message=a(e).finalString}}();e.Exception=o;o.prototype=Error();var l=function(){return function(e,t,r,n){this.l=e;this.m=t;this.n=r;this.t=n}}();e.LogItem=l;o=function(){function i(t,r){this.appenderName=t;this.sendLogItems=r;this.level=e.getTraceLevel();this.sendWithBufferLevel=2147483647;this.storeInBufferLevel=-2147483648;this.bufferSize=0;this.batchSize=1;this.buffer=[];this.batchBuffer=[]}i.prototype.setOptions=function(e){t("level",e,this);t("ipRegex",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("sendWithBufferLevel",e,this);t("storeInBufferLevel",e,this);t("bufferSize",e,this);t("batchSize",e,this);this.bufferSize<this.buffer.length&&(this.buffer.length=this.bufferSize);return this};i.prototype.log=function(e,t,i,a,s,o,c){!r(this)||!n(this,o)||s<this.storeInBufferLevel||(e=new l(s,o,c,(new Date).getTime()),s<this.level?0<this.bufferSize&&(this.buffer.push(e),this.buffer.length>this.bufferSize&&this.buffer.shift()):(s<this.sendWithBufferLevel||!this.buffer.length||(this.batchBuffer=this.batchBuffer.concat(this.buffer),this.buffer.length=0),this.batchBuffer.push(e),this.batchBuffer.length>=this.batchSize&&this.sendBatch()))};i.prototype.sendBatch=function(){0==this.batchBuffer.length||null!=e.maxMessages&&1>e.maxMessages||(null!=e.maxMessages&&(e.maxMessages-=this.batchBuffer.length),this.sendLogItems(this.batchBuffer),this.batchBuffer.length=0)};return i}();e.Appender=o;var c=function(r){function n(e){r.call(this,e,n.prototype.sendLogItemsAjax)}__extends(n,r);n.prototype.setOptions=function(e){t("url",e,this);t("beforeSend",e,this);r.prototype.setOptions.call(this,e);return this};n.prototype.sendLogItemsAjax=function(t){try{var r="/jsnlog.logger";null!=e.defaultAjaxUrl&&(r=e.defaultAjaxUrl);this.url&&(r=this.url);var n=JSON.stringify({r:e.requestId,lg:t}),i=this.getXhr(r);"function"==typeof this.beforeSend?this.beforeSend.call(this,i):"function"==typeof e.defaultBeforeSend&&e.defaultBeforeSend.call(this,i);i.send(n)}catch(a){}};n.prototype.getXhr=function(t){var r=new XMLHttpRequest;if(!("withCredentials"in r)&&"undefined"!=typeof XDomainRequest)return r=new XDomainRequest,r.open("POST",t),r;r.open("POST",t);r.setRequestHeader("Content-Type","application/json");r.setRequestHeader("JSNLog-RequestId",e.requestId);return r};return n}(o);e.AjaxAppender=c;var u=function(t){function r(e){t.call(this,e,r.prototype.sendLogItemsConsole)}__extends(r,t);r.prototype.clog=function(e){console.log(e)};r.prototype.cerror=function(e){console.error?console.error(e):this.clog(e)};r.prototype.cwarn=function(e){console.warn?console.warn(e):this.clog(e)};r.prototype.cinfo=function(e){console.info?console.info(e):this.clog(e)};r.prototype.cdebug=function(e){console.debug?console.debug(e):this.cinfo(e)};r.prototype.sendLogItemsConsole=function(t){try{if(console){var r;for(r=0;r<t.length;++r){var n=t[r],i=n.n+": "+n.m;"undefined"==typeof window&&(i=new Date(n.t)+" | "+i);n.l<=e.getDebugLevel()?this.cdebug(i):n.l<=e.getInfoLevel()?this.cinfo(i):n.l<=e.getWarnLevel()?this.cwarn(i):this.cerror(i)}}}catch(a){}};return r}(o);e.ConsoleAppender=u;o=function(){function e(e){this.loggerName=e;this.seenRegexes=[]}e.prototype.setOptions=function(e){t("level",e,this);t("userAgentRegex",e,this);t("disallow",e,this);t("ipRegex",e,this);t("appenders",e,this);t("onceOnly",e,this);this.seenRegexes=[];return this};e.prototype.buildExceptionObject=function(e){var t={};e.stack?t.stack=e.stack:t.e=e;e.message&&(t.message=e.message);e.name&&(t.name=e.name);e.data&&(t.data=e.data);e.inner&&(t.inner=this.buildExceptionObject(e.inner));return t};e.prototype.log=function(e,t,s){var o=0;if(!this.appenders)return this;if(e>=this.level&&r(this)&&(s?(o=this.buildExceptionObject(s),o.logData=i(t)):o=t,t=a(o),n(this,t.finalString))){if(this.onceOnly)for(o=this.onceOnly.length-1;o>=0;){if(RegExp(this.onceOnly[o]).test(t.finalString)){if(this.seenRegexes[o])return this;this.seenRegexes[o]=!0}o--}t.meta=t.meta||{};t.meta.loggerName=this.loggerName;for(o=this.appenders.length-1;o>=0;)this.appenders[o].log(1e3>=e?"trace":2e3>=e?"debug":3e3>=e?"info":4e3>=e?"warn":5e3>=e?"error":"fatal",t.msg,t.meta,function(){},e,t.finalString,this.loggerName),o--}return this};e.prototype.trace=function(e){return this.log(1e3,e)};e.prototype.debug=function(e){return this.log(2e3,e)};e.prototype.info=function(e){return this.log(3e3,e)};e.prototype.warn=function(e){return this.log(4e3,e)};e.prototype.error=function(e){return this.log(5e3,e)};e.prototype.fatal=function(e){return this.log(6e3,e)};e.prototype.fatalException=function(e,t){return this.log(6e3,e,t)};return e}();e.Logger=o;e.createAjaxAppender=function(e){return new c(e)};e.createConsoleAppender=function(e){return new u(e)};o=new c("");"undefined"==typeof window&&(o=new u(""));e.__=new e.Logger("");e.__.setOptions({level:e.getDebugLevel(),appenders:[o]})}(JL||(JL={}));var exports;"undefined"!=typeof exports&&(exports.JL=JL);var define;"function"==typeof define&&define.amd&&define("jsnlog",[],function(){return JL});"function"==typeof __jsnlog_configure&&__jsnlog_configure(JL);var OpenLayers={VERSION_NUMBER:"Release 2.13.1",singleFile:!0,_getScriptLocation:function(){for(var e,t,r=new RegExp("(^|(.*?\\/))(OpenLayers[^\\/]*?\\.js)(\\?|$)"),n=document.getElementsByTagName("script"),i="",a=0,s=n.length;s>a;a++){e=n[a].getAttribute("src");if(e){t=e.match(r);if(t){i=t[1];break}}}return function(){return i}}(),ImgPath:""};OpenLayers.Class=function(){var e=arguments.length,t=arguments[0],r=arguments[e-1],n="function"==typeof r.initialize?r.initialize:function(){t.prototype.initialize.apply(this,arguments)};if(e>1){var i=[n,t].concat(Array.prototype.slice.call(arguments).slice(1,e-1),r);OpenLayers.inherit.apply(null,i)}else n.prototype=r;return n};OpenLayers.inherit=function(e,t){var r=function(){};r.prototype=t.prototype;e.prototype=new r;var n,i,a;for(n=2,i=arguments.length;i>n;n++){a=arguments[n];"function"==typeof a&&(a=a.prototype);OpenLayers.Util.extend(e.prototype,a)}};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.extend=function(e,t){e=e||{};if(t){for(var r in t){var n=t[r];void 0!==n&&(e[r]=n)}var i="function"==typeof window.Event&&t instanceof window.Event;!i&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e};OpenLayers.String={startsWith:function(e,t){return 0==e.indexOf(t)},contains:function(e,t){return-1!=e.indexOf(t)},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),r=t[0],n=1,i=t.length;i>n;n++){var a=t[n];r+=a.charAt(0).toUpperCase()+a.substring(1)}return r},format:function(e,t,r){t||(t=window);var n=function(e,n){for(var i,a=n.split(/\.+/),s=0;s<a.length;s++){0==s&&(i=t);if(void 0===i)break;i=i[a[s]]}"function"==typeof i&&(i=r?i.apply(null,r):i());return"undefined"==typeof i?"undefined":i};return e.replace(OpenLayers.String.tokenRegEx,n)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return OpenLayers.String.numberRegEx.test(e)},numericIf:function(e,t){var r=e;t===!0&&null!=e&&e.replace&&(e=e.replace(/^\s*|\s*$/g,""));return OpenLayers.String.isNumeric(e)?parseFloat(e):r}};OpenLayers.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var r=0;t>0&&(r=parseFloat(e.toPrecision(t)));return r},format:function(e,t,r,n){t="undefined"!=typeof t?t:0;r="undefined"!=typeof r?r:OpenLayers.Number.thousandsSeparator;n="undefined"!=typeof n?n:OpenLayers.Number.decimalSeparator;null!=t&&(e=parseFloat(e.toFixed(t)));var i=e.toString().split(".");1==i.length&&null==t&&(t=0);var a=i[0];if(r)for(var s=/(-?[0-9]+)([0-9]{3})/;s.test(a);)a=a.replace(s,"$1"+r+"$2");var o;if(0==t)o=a;else{var l=i.length>1?i[1]:"0";null!=t&&(l+=new Array(t-l.length+1).join("0"));o=a+n+l}return o},zeroPad:function(e,t,r){for(var n=e.toString(r||10);n.length<t;)n="0"+n;return n}};OpenLayers.Function={bind:function(e,t){var r=Array.prototype.slice.apply(arguments,[2]);return function(){var n=r.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,n)}},bindAsEventListener:function(e,t){return function(r){return e.call(t,r||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}};OpenLayers.Array={filter:function(e,t,r){var n=[];if(Array.prototype.filter)n=e.filter(t,r);else{var i=e.length;if("function"!=typeof t)throw new TypeError;for(var a=0;i>a;a++)if(a in e){var s=e[a];t.call(r,s,a,e)&&n.push(s)}}return n}};OpenLayers.Bounds=OpenLayers.Class({left:null,bottom:null,right:null,top:null,centerLonLat:null,initialize:function(e,t,r,n){if(OpenLayers.Util.isArray(e)){n=e[3];r=e[2];t=e[1];e=e[0]}null!=e&&(this.left=OpenLayers.Util.toFloat(e));null!=t&&(this.bottom=OpenLayers.Util.toFloat(t));null!=r&&(this.right=OpenLayers.Util.toFloat(r));null!=n&&(this.top=OpenLayers.Util.toFloat(n))},clone:function(){return new OpenLayers.Bounds(this.left,this.bottom,this.right,this.top)},equals:function(e){var t=!1;null!=e&&(t=this.left==e.left&&this.right==e.right&&this.top==e.top&&this.bottom==e.bottom);return t},toString:function(){return[this.left,this.bottom,this.right,this.top].join(",")},toArray:function(e){return e===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]},toBBOX:function(e,t){null==e&&(e=6);var r=Math.pow(10,e),n=Math.round(this.left*r)/r,i=Math.round(this.bottom*r)/r,a=Math.round(this.right*r)/r,s=Math.round(this.top*r)/r;return t===!0?i+","+n+","+s+","+a:n+","+i+","+a+","+s},toGeometry:function(){return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(this.left,this.bottom),new OpenLayers.Geometry.Point(this.right,this.bottom),new OpenLayers.Geometry.Point(this.right,this.top),new OpenLayers.Geometry.Point(this.left,this.top)])])},getWidth:function(){return this.right-this.left},getHeight:function(){return this.top-this.bottom},getSize:function(){return new OpenLayers.Size(this.getWidth(),this.getHeight())},getCenterPixel:function(){return new OpenLayers.Pixel((this.left+this.right)/2,(this.bottom+this.top)/2)},getCenterLonLat:function(){this.centerLonLat||(this.centerLonLat=new OpenLayers.LonLat((this.left+this.right)/2,(this.bottom+this.top)/2));return this.centerLonLat},scale:function(e,t){null==t&&(t=this.getCenterLonLat());var r,n;if("OpenLayers.LonLat"==t.CLASS_NAME){r=t.lon;n=t.lat}else{r=t.x;n=t.y}var i=(this.left-r)*e+r,a=(this.bottom-n)*e+n,s=(this.right-r)*e+r,o=(this.top-n)*e+n;return new OpenLayers.Bounds(i,a,s,o)},add:function(e,t){if(null==e||null==t)throw new TypeError("Bounds.add cannot receive null values");return new OpenLayers.Bounds(this.left+e,this.bottom+t,this.right+e,this.top+t)},extend:function(e){if(e)switch(e.CLASS_NAME){case"OpenLayers.LonLat":this.extendXY(e.lon,e.lat);break;case"OpenLayers.Geometry.Point":this.extendXY(e.x,e.y);break;case"OpenLayers.Bounds":this.centerLonLat=null;(null==this.left||e.left<this.left)&&(this.left=e.left);(null==this.bottom||e.bottom<this.bottom)&&(this.bottom=e.bottom);(null==this.right||e.right>this.right)&&(this.right=e.right);(null==this.top||e.top>this.top)&&(this.top=e.top)}},extendXY:function(e,t){this.centerLonLat=null;(null==this.left||e<this.left)&&(this.left=e);(null==this.bottom||t<this.bottom)&&(this.bottom=t);(null==this.right||e>this.right)&&(this.right=e);(null==this.top||t>this.top)&&(this.top=t)},containsLonLat:function(e,t){
"boolean"==typeof t&&(t={inclusive:t});t=t||{};var r=this.contains(e.lon,e.lat,t.inclusive),n=t.worldBounds;if(n&&!r){var i=n.getWidth(),a=(n.left+n.right)/2,s=Math.round((e.lon-a)/i);r=this.containsLonLat({lon:e.lon-s*i,lat:e.lat},{inclusive:t.inclusive})}return r},containsPixel:function(e,t){return this.contains(e.x,e.y,t)},contains:function(e,t,r){null==r&&(r=!0);if(null==e||null==t)return!1;e=OpenLayers.Util.toFloat(e);t=OpenLayers.Util.toFloat(t);var n=!1;n=r?e>=this.left&&e<=this.right&&t>=this.bottom&&t<=this.top:e>this.left&&e<this.right&&t>this.bottom&&t<this.top;return n},intersectsBounds:function(e,t){"boolean"==typeof t&&(t={inclusive:t});t=t||{};if(t.worldBounds){var r=this.wrapDateLine(t.worldBounds);e=e.wrapDateLine(t.worldBounds)}else r=this;null==t.inclusive&&(t.inclusive=!0);var n=!1,i=r.left==e.right||r.right==e.left||r.top==e.bottom||r.bottom==e.top;if(t.inclusive||!i){var a=e.bottom>=r.bottom&&e.bottom<=r.top||r.bottom>=e.bottom&&r.bottom<=e.top,s=e.top>=r.bottom&&e.top<=r.top||r.top>e.bottom&&r.top<e.top,o=e.left>=r.left&&e.left<=r.right||r.left>=e.left&&r.left<=e.right,l=e.right>=r.left&&e.right<=r.right||r.right>=e.left&&r.right<=e.right;n=(a||s)&&(o||l)}if(t.worldBounds&&!n){var c=t.worldBounds,u=c.getWidth(),p=!c.containsBounds(r),h=!c.containsBounds(e);if(p&&!h){e=e.add(-u,0);n=r.intersectsBounds(e,{inclusive:t.inclusive})}else if(h&&!p){r=r.add(-u,0);n=e.intersectsBounds(r,{inclusive:t.inclusive})}}return n},containsBounds:function(e,t,r){null==t&&(t=!1);null==r&&(r=!0);var n=this.contains(e.left,e.bottom,r),i=this.contains(e.right,e.bottom,r),a=this.contains(e.left,e.top,r),s=this.contains(e.right,e.top,r);return t?n||i||a||s:n&&i&&a&&s},determineQuadrant:function(e){var t="",r=this.getCenterLonLat();t+=e.lat<r.lat?"b":"t";t+=e.lon<r.lon?"l":"r";return t},transform:function(e,t){this.centerLonLat=null;var r=OpenLayers.Projection.transform({x:this.left,y:this.bottom},e,t),n=OpenLayers.Projection.transform({x:this.right,y:this.bottom},e,t),i=OpenLayers.Projection.transform({x:this.left,y:this.top},e,t),a=OpenLayers.Projection.transform({x:this.right,y:this.top},e,t);this.left=Math.min(r.x,i.x);this.bottom=Math.min(r.y,n.y);this.right=Math.max(n.x,a.x);this.top=Math.max(i.y,a.y);return this},wrapDateLine:function(e,t){t=t||{};var r=t.leftTolerance||0,n=t.rightTolerance||0,i=this.clone();if(e){for(var a=e.getWidth();i.left<e.left&&i.right-n<=e.left;)i=i.add(a,0);for(;i.left+r>=e.right&&i.right>e.right;)i=i.add(-a,0);var s=i.left+r;s<e.right&&s>e.left&&i.right-n>e.right&&(i=i.add(-a,0))}return i},CLASS_NAME:"OpenLayers.Bounds"});OpenLayers.Bounds.fromString=function(e,t){var r=e.split(",");return OpenLayers.Bounds.fromArray(r,t)};OpenLayers.Bounds.fromArray=function(e,t){return t===!0?new OpenLayers.Bounds(e[1],e[0],e[3],e[2]):new OpenLayers.Bounds(e[0],e[1],e[2],e[3])};OpenLayers.Bounds.fromSize=function(e){return new OpenLayers.Bounds(0,e.h,e.w,0)};OpenLayers.Bounds.oppositeQuadrant=function(e){var t="";t+="t"==e.charAt(0)?"b":"t";t+="l"==e.charAt(1)?"r":"l";return t};OpenLayers.Element={visible:function(e){return"none"!=OpenLayers.Util.getElement(e).style.display},toggle:function(){for(var e=0,t=arguments.length;t>e;e++){var r=OpenLayers.Util.getElement(arguments[e]),n=OpenLayers.Element.visible(r)?"none":"";r.style.display=n}},remove:function(e){e=OpenLayers.Util.getElement(e);e.parentNode.removeChild(e)},getHeight:function(e){e=OpenLayers.Util.getElement(e);return e.offsetHeight},hasClass:function(e,t){var r=e.className;return!!r&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(r)},addClass:function(e,t){OpenLayers.Element.hasClass(e,t)||(e.className+=(e.className?" ":"")+t);return e},removeClass:function(e,t){var r=e.className;r&&(e.className=OpenLayers.String.trim(r.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ")));return e},toggleClass:function(e,t){OpenLayers.Element.hasClass(e,t)?OpenLayers.Element.removeClass(e,t):OpenLayers.Element.addClass(e,t);return e},getStyle:function(e,t){e=OpenLayers.Util.getElement(e);var r=null;if(e&&e.style){r=e.style[OpenLayers.String.camelize(t)];if(!r)if(document.defaultView&&document.defaultView.getComputedStyle){var n=document.defaultView.getComputedStyle(e,null);r=n?n.getPropertyValue(t):null}else e.currentStyle&&(r=e.currentStyle[OpenLayers.String.camelize(t)]);var i=["left","top","right","bottom"];window.opera&&-1!=OpenLayers.Util.indexOf(i,t)&&"static"==OpenLayers.Element.getStyle(e,"position")&&(r="auto")}return"auto"==r?null:r}};OpenLayers.LonLat=OpenLayers.Class({lon:0,lat:0,initialize:function(e,t){if(OpenLayers.Util.isArray(e)){t=e[1];e=e[0]}this.lon=OpenLayers.Util.toFloat(e);this.lat=OpenLayers.Util.toFloat(t)},toString:function(){return"lon="+this.lon+",lat="+this.lat},toShortString:function(){return this.lon+", "+this.lat},clone:function(){return new OpenLayers.LonLat(this.lon,this.lat)},add:function(e,t){if(null==e||null==t)throw new TypeError("LonLat.add cannot receive null values");return new OpenLayers.LonLat(this.lon+OpenLayers.Util.toFloat(e),this.lat+OpenLayers.Util.toFloat(t))},equals:function(e){var t=!1;null!=e&&(t=this.lon==e.lon&&this.lat==e.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(e.lon)&&isNaN(e.lat));return t},transform:function(e,t){var r=OpenLayers.Projection.transform({x:this.lon,y:this.lat},e,t);this.lon=r.x;this.lat=r.y;return this},wrapDateLine:function(e){var t=this.clone();if(e){for(;t.lon<e.left;)t.lon+=e.getWidth();for(;t.lon>e.right;)t.lon-=e.getWidth()}return t},CLASS_NAME:"OpenLayers.LonLat"});OpenLayers.LonLat.fromString=function(e){var t=e.split(",");return new OpenLayers.LonLat(t[0],t[1])};OpenLayers.LonLat.fromArray=function(e){var t=OpenLayers.Util.isArray(e),r=t&&e[0],n=t&&e[1];return new OpenLayers.LonLat(r,n)};OpenLayers.Pixel=OpenLayers.Class({x:0,y:0,initialize:function(e,t){this.x=parseFloat(e);this.y=parseFloat(t)},toString:function(){return"x="+this.x+",y="+this.y},clone:function(){return new OpenLayers.Pixel(this.x,this.y)},equals:function(e){var t=!1;null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y));return t},distanceTo:function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))},add:function(e,t){if(null==e||null==t)throw new TypeError("Pixel.add cannot receive null values");return new OpenLayers.Pixel(this.x+e,this.y+t)},offset:function(e){var t=this.clone();e&&(t=this.add(e.x,e.y));return t},CLASS_NAME:"OpenLayers.Pixel"});OpenLayers.Size=OpenLayers.Class({w:0,h:0,initialize:function(e,t){this.w=parseFloat(e);this.h=parseFloat(t)},toString:function(){return"w="+this.w+",h="+this.h},clone:function(){return new OpenLayers.Size(this.w,this.h)},equals:function(e){var t=!1;null!=e&&(t=this.w==e.w&&this.h==e.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(e.w)&&isNaN(e.h));return t},CLASS_NAME:"OpenLayers.Size"});OpenLayers.Console={log:function(){},debug:function(){},info:function(){},warn:function(){},error:function(){},userError:function(e){alert(e)},assert:function(){},dir:function(){},dirxml:function(){},trace:function(){},group:function(){},groupEnd:function(){},time:function(){},timeEnd:function(){},profile:function(){},profileEnd:function(){},count:function(){},CLASS_NAME:"OpenLayers.Console"};!function(){for(var e=document.getElementsByTagName("script"),t=0,r=e.length;r>t;++t)if(-1!=e[t].src.indexOf("firebug.js")&&console){OpenLayers.Util.extend(OpenLayers.Console,console);break}}();OpenLayers.Lang={code:null,defaultCode:"en",getCode:function(){OpenLayers.Lang.code||OpenLayers.Lang.setCode();return OpenLayers.Lang.code},setCode:function(e){var t;e||(e="msie"==OpenLayers.BROWSER_NAME?navigator.userLanguage:navigator.language);var r=e.split("-");r[0]=r[0].toLowerCase();"object"==typeof OpenLayers.Lang[r[0]]&&(t=r[0]);if(r[1]){var n=r[0]+"-"+r[1].toUpperCase();"object"==typeof OpenLayers.Lang[n]&&(t=n)}if(!t){OpenLayers.Console.warn("Failed to find OpenLayers.Lang."+r.join("-")+" dictionary, falling back to default language");t=OpenLayers.Lang.defaultCode}OpenLayers.Lang.code=t},translate:function(e,t){var r=OpenLayers.Lang[OpenLayers.Lang.getCode()],n=r&&r[e];n||(n=e);t&&(n=OpenLayers.String.format(n,t));return n}};OpenLayers.i18n=OpenLayers.Lang.translate;OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.getElement=function(){for(var e=[],t=0,r=arguments.length;r>t;t++){var n=arguments[t];"string"==typeof n&&(n=document.getElementById(n));if(1==arguments.length)return n;e.push(n)}return e};OpenLayers.Util.isElement=function(e){return!(!e||1!==e.nodeType)};OpenLayers.Util.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)};OpenLayers.Util.removeItem=function(e,t){for(var r=e.length-1;r>=0;r--)e[r]==t&&e.splice(r,1);return e};OpenLayers.Util.indexOf=function(e,t){if("function"==typeof e.indexOf)return e.indexOf(t);for(var r=0,n=e.length;n>r;r++)if(e[r]==t)return r;return-1};OpenLayers.Util.dotless=/\./g;OpenLayers.Util.modifyDOMElement=function(e,t,r,n,i,a,s,o){t&&(e.id=t.replace(OpenLayers.Util.dotless,"_"));if(r){e.style.left=r.x+"px";e.style.top=r.y+"px"}if(n){e.style.width=n.w+"px";e.style.height=n.h+"px"}i&&(e.style.position=i);a&&(e.style.border=a);s&&(e.style.overflow=s);if(parseFloat(o)>=0&&parseFloat(o)<1){e.style.filter="alpha(opacity="+100*o+")";e.style.opacity=o}else if(1==parseFloat(o)){e.style.filter="";e.style.opacity=""}};OpenLayers.Util.createDiv=function(e,t,r,n,i,a,s,o){var l=document.createElement("div");n&&(l.style.backgroundImage="url("+n+")");e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv"));i||(i="absolute");OpenLayers.Util.modifyDOMElement(l,e,t,r,i,a,s,o);return l};OpenLayers.Util.createImage=function(e,t,r,n,i,a,s,o){function l(){c.style.display="";OpenLayers.Event.stopObservingElement(c)}var c=document.createElement("img");e||(e=OpenLayers.Util.createUniqueID("OpenLayersDiv"));i||(i="relative");OpenLayers.Util.modifyDOMElement(c,e,t,r,i,a,null,s);if(o){c.style.display="none";OpenLayers.Event.observe(c,"load",l);OpenLayers.Event.observe(c,"error",l)}c.style.alt=e;c.galleryImg="no";n&&(c.src=n);return c};OpenLayers.IMAGE_RELOAD_ATTEMPTS=0;OpenLayers.Util.alphaHackNeeded=null;OpenLayers.Util.alphaHack=function(){if(null==OpenLayers.Util.alphaHackNeeded){var e=navigator.appVersion.split("MSIE"),t=parseFloat(e[1]),r=!1;try{r=!!document.body.filters}catch(n){}OpenLayers.Util.alphaHackNeeded=r&&t>=5.5&&7>t}return OpenLayers.Util.alphaHackNeeded};OpenLayers.Util.modifyAlphaImageDiv=function(e,t,r,n,i,a,s,o,l){OpenLayers.Util.modifyDOMElement(e,t,r,n,a,null,null,l);var c=e.childNodes[0];i&&(c.src=i);OpenLayers.Util.modifyDOMElement(c,e.id+"_innerImage",null,n,"relative",s);if(OpenLayers.Util.alphaHack()){"none"!=e.style.display&&(e.style.display="inline-block");null==o&&(o="scale");e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+c.src+"', sizingMethod='"+o+"')";parseFloat(e.style.opacity)>=0&&parseFloat(e.style.opacity)<1&&(e.style.filter+=" alpha(opacity="+100*e.style.opacity+")");c.style.filter="alpha(opacity=0)"}};OpenLayers.Util.createAlphaImageDiv=function(e,t,r,n,i,a,s,o,l){var c=OpenLayers.Util.createDiv(),u=OpenLayers.Util.createImage(null,null,null,null,null,null,null,l);u.className="olAlphaImg";c.appendChild(u);OpenLayers.Util.modifyAlphaImageDiv(c,e,t,r,n,i,a,s,o);return c};OpenLayers.Util.upperCaseObject=function(e){var t={};for(var r in e)t[r.toUpperCase()]=e[r];return t};OpenLayers.Util.applyDefaults=function(e,t){e=e||{};var r="function"==typeof window.Event&&t instanceof window.Event;for(var n in t)(void 0===e[n]||!r&&t.hasOwnProperty&&t.hasOwnProperty(n)&&!e.hasOwnProperty(n))&&(e[n]=t[n]);!r&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString);return e};OpenLayers.Util.getParameterString=function(e){var t=[];for(var r in e){var n=e[r];if(null!=n&&"function"!=typeof n){var i;if("object"==typeof n&&n.constructor==Array){for(var a,s=[],o=0,l=n.length;l>o;o++){a=n[o];s.push(encodeURIComponent(null===a||void 0===a?"":a))}i=s.join(",")}else i=encodeURIComponent(n);t.push(encodeURIComponent(r)+"="+i)}}return t.join("&")};OpenLayers.Util.urlAppend=function(e,t){var r=e;if(t){var n=(e+" ").split(/[?&]/);r+=" "===n.pop()?t:n.length?"&"+t:"?"+t}return r};OpenLayers.Util.getImagesLocation=function(){return OpenLayers.ImgPath||OpenLayers._getScriptLocation()+"img/"};OpenLayers.Util.getImageLocation=function(e){return OpenLayers.Util.getImagesLocation()+e};OpenLayers.Util.Try=function(){for(var e=null,t=0,r=arguments.length;r>t;t++){var n=arguments[t];try{e=n();break}catch(i){}}return e};OpenLayers.Util.getXmlNodeValue=function(e){var t=null;OpenLayers.Util.Try(function(){t=e.text;t||(t=e.textContent);t||(t=e.firstChild.nodeValue)},function(){t=e.textContent});return t};OpenLayers.Util.mouseLeft=function(e,t){for(var r=e.relatedTarget?e.relatedTarget:e.toElement;r!=t&&null!=r;)r=r.parentNode;return r!=t};OpenLayers.Util.DEFAULT_PRECISION=14;OpenLayers.Util.toFloat=function(e,t){null==t&&(t=OpenLayers.Util.DEFAULT_PRECISION);"number"!=typeof e&&(e=parseFloat(e));return 0===t?e:parseFloat(e.toPrecision(t))};OpenLayers.Util.rad=function(e){return e*Math.PI/180};OpenLayers.Util.deg=function(e){return 180*e/Math.PI};OpenLayers.Util.VincentyConstants={a:6378137,b:6356752.3142,f:1/298.257223563};OpenLayers.Util.distVincenty=function(e,t){for(var r=OpenLayers.Util.VincentyConstants,n=r.a,i=r.b,a=r.f,s=OpenLayers.Util.rad(t.lon-e.lon),o=Math.atan((1-a)*Math.tan(OpenLayers.Util.rad(e.lat))),l=Math.atan((1-a)*Math.tan(OpenLayers.Util.rad(t.lat))),c=Math.sin(o),u=Math.cos(o),p=Math.sin(l),h=Math.cos(l),d=s,f=2*Math.PI,m=20;Math.abs(d-f)>1e-12&&--m>0;){var y=Math.sin(d),g=Math.cos(d),v=Math.sqrt(h*y*h*y+(u*p-c*h*g)*(u*p-c*h*g));if(0==v)return 0;var C=c*p+u*h*g,T=Math.atan2(v,C),L=Math.asin(u*h*y/v),w=Math.cos(L)*Math.cos(L),b=C-2*c*p/w,S=a/16*w*(4+a*(4-3*w));f=d;d=s+(1-S)*a*Math.sin(L)*(T+S*v*(b+S*C*(-1+2*b*b)))}if(0==m)return 0/0;var E=w*(n*n-i*i)/(i*i),O=1+E/16384*(4096+E*(-768+E*(320-175*E))),A=E/1024*(256+E*(-128+E*(74-47*E))),x=A*v*(b+A/4*(C*(-1+2*b*b)-A/6*b*(-3+4*v*v)*(-3+4*b*b))),P=i*O*(T-x),_=P.toFixed(3)/1e3;return _};OpenLayers.Util.destinationVincenty=function(e,t,r){for(var n=OpenLayers.Util,i=n.VincentyConstants,a=i.a,s=i.b,o=i.f,l=e.lon,c=e.lat,u=r,p=n.rad(t),h=Math.sin(p),d=Math.cos(p),f=(1-o)*Math.tan(n.rad(c)),m=1/Math.sqrt(1+f*f),y=f*m,g=Math.atan2(f,d),v=m*h,C=1-v*v,T=C*(a*a-s*s)/(s*s),L=1+T/16384*(4096+T*(-768+T*(320-175*T))),w=T/1024*(256+T*(-128+T*(74-47*T))),b=u/(s*L),S=2*Math.PI;Math.abs(b-S)>1e-12;){var E=Math.cos(2*g+b),O=Math.sin(b),A=Math.cos(b),x=w*O*(E+w/4*(A*(-1+2*E*E)-w/6*E*(-3+4*O*O)*(-3+4*E*E)));S=b;b=u/(s*L)+x}{var P=y*O-m*A*d,_=Math.atan2(y*A+m*O*d,(1-o)*Math.sqrt(v*v+P*P)),N=Math.atan2(O*h,m*A-y*O*d),M=o/16*C*(4+o*(4-3*C)),k=N-(1-M)*o*v*(b+M*O*(E+M*A*(-1+2*E*E)));Math.atan2(v,-P)}return new OpenLayers.LonLat(l+n.deg(k),n.deg(_))};OpenLayers.Util.getParameters=function(e,t){t=t||{};e=null===e||void 0===e?window.location.href:e;var r="";if(OpenLayers.String.contains(e,"?")){var n=e.indexOf("?")+1,i=OpenLayers.String.contains(e,"#")?e.indexOf("#"):e.length;r=e.substring(n,i)}for(var a={},s=r.split(/[&;]/),o=0,l=s.length;l>o;++o){var c=s[o].split("=");if(c[0]){var u=c[0];try{u=decodeURIComponent(u)}catch(p){u=unescape(u)}var h=(c[1]||"").replace(/\+/g," ");try{h=decodeURIComponent(h)}catch(p){h=unescape(h)}t.splitArgs!==!1&&(h=h.split(","));1==h.length&&(h=h[0]);a[u]=h}}return a};OpenLayers.Util.lastSeqID=0;OpenLayers.Util.createUniqueID=function(e){e=null==e?"id_":e.replace(OpenLayers.Util.dotless,"_");OpenLayers.Util.lastSeqID+=1;return e+OpenLayers.Util.lastSeqID};OpenLayers.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.37,km:39370,dd:4374754,yd:36};OpenLayers.INCHES_PER_UNIT["in"]=OpenLayers.INCHES_PER_UNIT.inches;OpenLayers.INCHES_PER_UNIT.degrees=OpenLayers.INCHES_PER_UNIT.dd;OpenLayers.INCHES_PER_UNIT.nmi=1852*OpenLayers.INCHES_PER_UNIT.m;OpenLayers.METERS_PER_INCH=.0254000508001016;OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{Inch:OpenLayers.INCHES_PER_UNIT.inches,Meter:1/OpenLayers.METERS_PER_INCH,Foot:.3048006096012192/OpenLayers.METERS_PER_INCH,IFoot:.3048/OpenLayers.METERS_PER_INCH,ClarkeFoot:.3047972651151/OpenLayers.METERS_PER_INCH,SearsFoot:.30479947153867626/OpenLayers.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/OpenLayers.METERS_PER_INCH,IInch:.0254/OpenLayers.METERS_PER_INCH,MicroInch:254e-7/OpenLayers.METERS_PER_INCH,Mil:2.54e-8/OpenLayers.METERS_PER_INCH,Centimeter:.01/OpenLayers.METERS_PER_INCH,Kilometer:1e3/OpenLayers.METERS_PER_INCH,Yard:.9144018288036576/OpenLayers.METERS_PER_INCH,SearsYard:.914398414616029/OpenLayers.METERS_PER_INCH,IndianYard:.9143985307444408/OpenLayers.METERS_PER_INCH,IndianYd37:.91439523/OpenLayers.METERS_PER_INCH,IndianYd62:.9143988/OpenLayers.METERS_PER_INCH,IndianYd75:.9143985/OpenLayers.METERS_PER_INCH,IndianFoot:.30479951/OpenLayers.METERS_PER_INCH,IndianFt37:.30479841/OpenLayers.METERS_PER_INCH,IndianFt62:.3047996/OpenLayers.METERS_PER_INCH,IndianFt75:.3047995/OpenLayers.METERS_PER_INCH,Mile:1609.3472186944373/OpenLayers.METERS_PER_INCH,IYard:.9144/OpenLayers.METERS_PER_INCH,IMile:1609.344/OpenLayers.METERS_PER_INCH,NautM:1852/OpenLayers.METERS_PER_INCH,"Lat-66":110943.31648893273/OpenLayers.METERS_PER_INCH,"Lat-83":110946.25736872235/OpenLayers.METERS_PER_INCH,Decimeter:.1/OpenLayers.METERS_PER_INCH,Millimeter:.001/OpenLayers.METERS_PER_INCH,Dekameter:10/OpenLayers.METERS_PER_INCH,Decameter:10/OpenLayers.METERS_PER_INCH,Hectometer:100/OpenLayers.METERS_PER_INCH,GermanMeter:1.0000135965/OpenLayers.METERS_PER_INCH,CaGrid:.999738/OpenLayers.METERS_PER_INCH,ClarkeChain:20.1166194976/OpenLayers.METERS_PER_INCH,GunterChain:20.11684023368047/OpenLayers.METERS_PER_INCH,BenoitChain:20.116782494375872/OpenLayers.METERS_PER_INCH,SearsChain:20.11676512155/OpenLayers.METERS_PER_INCH,ClarkeLink:.201166194976/OpenLayers.METERS_PER_INCH,GunterLink:.2011684023368047/OpenLayers.METERS_PER_INCH,BenoitLink:.20116782494375873/OpenLayers.METERS_PER_INCH,SearsLink:.2011676512155/OpenLayers.METERS_PER_INCH,Rod:5.02921005842012/OpenLayers.METERS_PER_INCH,IntnlChain:20.1168/OpenLayers.METERS_PER_INCH,IntnlLink:.201168/OpenLayers.METERS_PER_INCH,Perch:5.02921005842012/OpenLayers.METERS_PER_INCH,Pole:5.02921005842012/OpenLayers.METERS_PER_INCH,Furlong:201.1684023368046/OpenLayers.METERS_PER_INCH,Rood:3.778266898/OpenLayers.METERS_PER_INCH,CapeFoot:.3047972615/OpenLayers.METERS_PER_INCH,Brealey:375/OpenLayers.METERS_PER_INCH,ModAmFt:.304812252984506/OpenLayers.METERS_PER_INCH,Fathom:1.8288/OpenLayers.METERS_PER_INCH,"NautM-UK":1853.184/OpenLayers.METERS_PER_INCH,"50kilometers":5e4/OpenLayers.METERS_PER_INCH,"150kilometers":15e4/OpenLayers.METERS_PER_INCH});OpenLayers.Util.extend(OpenLayers.INCHES_PER_UNIT,{mm:OpenLayers.INCHES_PER_UNIT.Meter/1e3,cm:OpenLayers.INCHES_PER_UNIT.Meter/100,dm:100*OpenLayers.INCHES_PER_UNIT.Meter,km:1e3*OpenLayers.INCHES_PER_UNIT.Meter,kmi:OpenLayers.INCHES_PER_UNIT.nmi,fath:OpenLayers.INCHES_PER_UNIT.Fathom,ch:OpenLayers.INCHES_PER_UNIT.IntnlChain,link:OpenLayers.INCHES_PER_UNIT.IntnlLink,"us-in":OpenLayers.INCHES_PER_UNIT.inches,"us-ft":OpenLayers.INCHES_PER_UNIT.Foot,"us-yd":OpenLayers.INCHES_PER_UNIT.Yard,"us-ch":OpenLayers.INCHES_PER_UNIT.GunterChain,"us-mi":OpenLayers.INCHES_PER_UNIT.Mile,"ind-yd":OpenLayers.INCHES_PER_UNIT.IndianYd37,"ind-ft":OpenLayers.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/OpenLayers.METERS_PER_INCH});OpenLayers.DOTS_PER_INCH=72;OpenLayers.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t};OpenLayers.Util.getResolutionFromScale=function(e,t){var r;if(e){null==t&&(t="degrees");var n=OpenLayers.Util.normalizeScale(e);r=1/(n*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH)}return r};OpenLayers.Util.getScaleFromResolution=function(e,t){null==t&&(t="degrees");var r=e*OpenLayers.INCHES_PER_UNIT[t]*OpenLayers.DOTS_PER_INCH;return r};OpenLayers.Util.pagePosition=function(e){var t=[0,0],r=OpenLayers.Util.getViewportElement();if(!e||e==window||e==r)return t;var n,i=OpenLayers.IS_GECKO&&document.getBoxObjectFor&&"absolute"==OpenLayers.Element.getStyle(e,"position")&&(""==e.style.top||""==e.style.left),a=null;if(e.getBoundingClientRect){n=e.getBoundingClientRect();var s=window.pageYOffset||r.scrollTop,o=window.pageXOffset||r.scrollLeft;t[0]=n.left+o;t[1]=n.top+s}else if(document.getBoxObjectFor&&!i){n=document.getBoxObjectFor(e);var l=document.getBoxObjectFor(r);t[0]=n.screenX-l.screenX;t[1]=n.screenY-l.screenY}else{t[0]=e.offsetLeft;t[1]=e.offsetTop;a=e.offsetParent;if(a!=e)for(;a;){t[0]+=a.offsetLeft;t[1]+=a.offsetTop;a=a.offsetParent}var c=OpenLayers.BROWSER_NAME;("opera"==c||"safari"==c&&"absolute"==OpenLayers.Element.getStyle(e,"position"))&&(t[1]-=document.body.offsetTop);a=e.offsetParent;for(;a&&a!=document.body;){t[0]-=a.scrollLeft;("opera"!=c||"TR"!=a.tagName)&&(t[1]-=a.scrollTop);a=a.offsetParent}}return t};OpenLayers.Util.getViewportElement=function(){var e=arguments.callee.viewportElement;if(void 0==e){e="msie"==OpenLayers.BROWSER_NAME&&"CSS1Compat"!=document.compatMode?document.body:document.documentElement;arguments.callee.viewportElement=e}return e};OpenLayers.Util.isEquivalentUrl=function(e,t,r){r=r||{};OpenLayers.Util.applyDefaults(r,{ignoreCase:!0,ignorePort80:!0,ignoreHash:!0,splitArgs:!1});var n=OpenLayers.Util.createUrlObject(e,r),i=OpenLayers.Util.createUrlObject(t,r);for(var a in n)if("args"!==a&&n[a]!=i[a])return!1;for(var a in n.args){if(n.args[a]!=i.args[a])return!1;delete i.args[a]}for(var a in i.args)return!1;return!0};OpenLayers.Util.createUrlObject=function(e,t){t=t||{};if(!/^\w+:\/\//.test(e)){var r=window.location,n=r.port?":"+r.port:"",i=r.protocol+"//"+r.host.split(":").shift()+n;if(0===e.indexOf("/"))e=i+e;else{var a=r.pathname.split("/");a.pop();e=i+a.join("/")+"/"+e}}t.ignoreCase&&(e=e.toLowerCase());var s=document.createElement("a");s.href=e;var o={};o.host=s.host.split(":").shift();o.protocol=s.protocol;o.port=t.ignorePort80?"80"==s.port||"0"==s.port?"":s.port:""==s.port||"0"==s.port?"80":s.port;o.hash=t.ignoreHash||"#"===s.hash?"":s.hash;var l=s.search;if(!l){var c=e.indexOf("?");l=-1!=c?e.substr(c):""}o.args=OpenLayers.Util.getParameters(l,{splitArgs:t.splitArgs});o.pathname="/"==s.pathname.charAt(0)?s.pathname:"/"+s.pathname;return o};OpenLayers.Util.removeTail=function(e){var t=null,r=e.indexOf("?"),n=e.indexOf("#");t=-1==r?-1!=n?e.substr(0,n):e:-1!=n?e.substr(0,Math.min(r,n)):e.substr(0,r);return t};OpenLayers.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return-1==e.indexOf("webkit")&&-1!=e.indexOf("gecko")}();OpenLayers.CANVAS_SUPPORTED=function(){var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}();OpenLayers.BROWSER_NAME=function(){var e="",t=navigator.userAgent.toLowerCase();-1!=t.indexOf("opera")?e="opera":-1!=t.indexOf("msie")?e="msie":-1!=t.indexOf("safari")?e="safari":-1!=t.indexOf("mozilla")&&(e=-1!=t.indexOf("firefox")?"firefox":"mozilla");return e}();OpenLayers.Util.getBrowserName=function(){return OpenLayers.BROWSER_NAME};OpenLayers.Util.getRenderedDimensions=function(e,t,r){var n,i,a=document.createElement("div");a.style.visibility="hidden";for(var s=r&&r.containerElement?r.containerElement:document.body,o=!1,l=null,c=s;c&&"body"!=c.tagName.toLowerCase();){var u=OpenLayers.Element.getStyle(c,"position");if("absolute"==u){o=!0;break}if(u&&"static"!=u)break;c=c.parentNode}if(o&&(0===s.clientHeight||0===s.clientWidth)){l=document.createElement("div");l.style.visibility="hidden";l.style.position="absolute";l.style.overflow="visible";l.style.width=document.body.clientWidth+"px";l.style.height=document.body.clientHeight+"px";l.appendChild(a)}a.style.position="absolute";if(t)if(t.w){n=t.w;a.style.width=n+"px"}else if(t.h){i=t.h;a.style.height=i+"px"}r&&r.displayClass&&(a.className=r.displayClass);var p=document.createElement("div");p.innerHTML=e;p.style.overflow="visible";if(p.childNodes)for(var h=0,d=p.childNodes.length;d>h;h++)p.childNodes[h].style&&(p.childNodes[h].style.overflow="visible");a.appendChild(p);s.appendChild(l?l:a);if(!n){n=parseInt(p.scrollWidth);a.style.width=n+"px"}i||(i=parseInt(p.scrollHeight));a.removeChild(p);if(l){l.removeChild(a);s.removeChild(l)}else s.removeChild(a);return new OpenLayers.Size(n,i)};OpenLayers.Util.getScrollbarWidth=function(){var e=OpenLayers.Util._scrollbarWidth;if(null==e){var t=null,r=null,n=0,i=0;t=document.createElement("div");t.style.position="absolute";t.style.top="-1000px";t.style.left="-1000px";t.style.width="100px";t.style.height="50px";t.style.overflow="hidden";r=document.createElement("div");r.style.width="100%";r.style.height="200px";t.appendChild(r);document.body.appendChild(t);n=r.offsetWidth;t.style.overflow="scroll";i=r.offsetWidth;document.body.removeChild(document.body.lastChild);OpenLayers.Util._scrollbarWidth=n-i;e=OpenLayers.Util._scrollbarWidth}return e};OpenLayers.Util.getFormattedLonLat=function(e,t,r){r||(r="dms");e=(e+540)%360-180;var n=Math.abs(e),i=Math.floor(n),a=(n-i)/(1/60),s=a;a=Math.floor(a);var o=(s-a)/(1/60);o=Math.round(10*o);o/=10;if(o>=60){o-=60;a+=1;if(a>=60){a-=60;i+=1}}10>i&&(i="0"+i);var l=i+"\xb0";if(r.indexOf("dm")>=0){10>a&&(a="0"+a);l+=a+"'";if(r.indexOf("dms")>=0){10>o&&(o="0"+o);l+=o+'"'}}l+=OpenLayers.i18n("lon"==t?0>e?"W":"E":0>e?"S":"N");return l};OpenLayers.Util=OpenLayers.Util||{};OpenLayers.Util.vendorPrefix=function(){"use strict";function e(e){return e?e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()}).replace(/^ms-/,"-ms-"):null}function t(t){if(void 0===s[t]){var r=t.replace(/(-[\s\S])/g,function(e){return e.charAt(1).toUpperCase()}),i=n(r);s[t]=e(i)}return s[t]}function r(e,t){if(void 0===o[t]){var r,n,a=0,s=i.length,l="undefined"!=typeof e.cssText;o[t]=null;for(;s>a;a++){n=i[a];if(n){l||(n=n.toLowerCase());r=n+t.charAt(0).toUpperCase()+t.slice(1)}else r=t;if(void 0!==e[r]){o[t]=r;break}}}return o[t]}function n(e){return r(a,e)}var i=["","O","ms","Moz","Webkit"],a=document.createElement("div").style,s={},o={};return{css:t,js:r,style:n,cssCache:s,jsCache:o}}();OpenLayers.Event={observers:!1,KEY_SPACE:32,KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,element:function(e){return e.target||e.srcElement},isSingleTouch:function(e){return e.touches&&1==e.touches.length},isMultiTouch:function(e){return e.touches&&e.touches.length>1},isLeftClick:function(e){return e.which&&1==e.which||e.button&&1==e.button},isRightClick:function(e){return e.which&&3==e.which||e.button&&2==e.button},stop:function(e,t){t||OpenLayers.Event.preventDefault(e);e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},findElement:function(e,t){for(var r=OpenLayers.Event.element(e);r.parentNode&&(!r.tagName||r.tagName.toUpperCase()!=t.toUpperCase());)r=r.parentNode;return r},observe:function(e,t,r,n){var i=OpenLayers.Util.getElement(e);n=n||!1;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.attachEvent)&&(t="keydown");this.observers||(this.observers={});if(!i._eventCacheID){var a="eventCacheID_";i.id&&(a=i.id+"_"+a);i._eventCacheID=OpenLayers.Util.createUniqueID(a)}var s=i._eventCacheID;this.observers[s]||(this.observers[s]=[]);this.observers[s].push({element:i,name:t,observer:r,useCapture:n});i.addEventListener?i.addEventListener(t,r,n):i.attachEvent&&i.attachEvent("on"+t,r)},stopObservingElement:function(e){var t=OpenLayers.Util.getElement(e),r=t._eventCacheID;this._removeElementObservers(OpenLayers.Event.observers[r])},_removeElementObservers:function(e){if(e)for(var t=e.length-1;t>=0;t--){var r=e[t];OpenLayers.Event.stopObserving.apply(this,[r.element,r.name,r.observer,r.useCapture])}},stopObserving:function(e,t,r,n){n=n||!1;var i=OpenLayers.Util.getElement(e),a=i._eventCacheID;"keypress"==t&&(navigator.appVersion.match(/Konqueror|Safari|KHTML/)||i.detachEvent)&&(t="keydown");var s=!1,o=OpenLayers.Event.observers[a];if(o)for(var l=0;!s&&l<o.length;){var c=o[l];if(c.name==t&&c.observer==r&&c.useCapture==n){o.splice(l,1);0==o.length&&delete OpenLayers.Event.observers[a];s=!0;break}l++}s&&(i.removeEventListener?i.removeEventListener(t,r,n):i&&i.detachEvent&&i.detachEvent("on"+t,r));return s},unloadCache:function(){if(OpenLayers.Event&&OpenLayers.Event.observers){for(var e in OpenLayers.Event.observers){var t=OpenLayers.Event.observers[e];OpenLayers.Event._removeElementObservers.apply(this,[t])}OpenLayers.Event.observers=!1}},CLASS_NAME:"OpenLayers.Event"};OpenLayers.Event.observe(window,"unload",OpenLayers.Event.unloadCache,!1);OpenLayers.Events=OpenLayers.Class({BROWSER_EVENTS:["mouseover","mouseout","mousedown","mouseup","mousemove","click","dblclick","rightclick","dblrightclick","resize","focus","blur","touchstart","touchmove","touchend","keydown"],listeners:null,object:null,element:null,eventHandler:null,fallThrough:null,includeXY:!1,extensions:null,extensionCount:null,clearMouseListener:null,initialize:function(e,t,r,n,i){OpenLayers.Util.extend(this,i);this.object=e;this.fallThrough=n;this.listeners={};this.extensions={};this.extensionCount={};this._msTouches=[];null!=t&&this.attachToElement(t)},destroy:function(){for(var e in this.extensions)"boolean"!=typeof this.extensions[e]&&this.extensions[e].destroy();this.extensions=null;if(this.element){OpenLayers.Event.stopObservingElement(this.element);this.element.hasScrollEvent&&OpenLayers.Event.stopObserving(window,"scroll",this.clearMouseListener)}this.element=null;this.listeners=null;this.object=null;this.fallThrough=null;this.eventHandler=null},addEventType:function(e){},attachToElement:function(e){if(this.element)OpenLayers.Event.stopObservingElement(this.element);else{this.eventHandler=OpenLayers.Function.bindAsEventListener(this.handleBrowserEvent,this);this.clearMouseListener=OpenLayers.Function.bind(this.clearMouseCache,this)}this.element=e;for(var t,r=!!window.navigator.msMaxTouchPoints,n=0,i=this.BROWSER_EVENTS.length;i>n;n++){t=this.BROWSER_EVENTS[n];OpenLayers.Event.observe(e,t,this.eventHandler);r&&0===t.indexOf("touch")&&this.addMsTouchListener(e,t,this.eventHandler)}OpenLayers.Event.observe(e,"dragstart",OpenLayers.Event.stop)},on:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.register(t,e.scope,e[t])},register:function(e,t,r,n){e in OpenLayers.Events&&!this.extensions[e]&&(this.extensions[e]=new OpenLayers.Events[e](this));if(null!=r){null==t&&(t=this.object);var i=this.listeners[e];if(!i){i=[];this.listeners[e]=i;this.extensionCount[e]=0}var a={obj:t,func:r};if(n){i.splice(this.extensionCount[e],0,a);"object"==typeof n&&n.extension&&this.extensionCount[e]++}else i.push(a)}},registerPriority:function(e,t,r){this.register(e,t,r,!0)},un:function(e){for(var t in e)"scope"!=t&&e.hasOwnProperty(t)&&this.unregister(t,e.scope,e[t])},unregister:function(e,t,r){null==t&&(t=this.object);var n=this.listeners[e];if(null!=n)for(var i=0,a=n.length;a>i;i++)if(n[i].obj==t&&n[i].func==r){n.splice(i,1);break}},remove:function(e){null!=this.listeners[e]&&(this.listeners[e]=[])},triggerEvent:function(e,t){var r=this.listeners[e];if(!r||0==r.length)return void 0;null==t&&(t={});t.object=this.object;t.element=this.element;t.type||(t.type=e);r=r.slice();for(var n,i=0,a=r.length;a>i;i++){var s=r[i];n=s.func.apply(s.obj,[t]);if(void 0!=n&&0==n)break}this.fallThrough||OpenLayers.Event.stop(t,!0);return n},handleBrowserEvent:function(e){var t=e.type,r=this.listeners[t];if(r&&0!=r.length){var n=e.touches;if(n&&n[0]){for(var i,a=0,s=0,o=n.length,l=0;o>l;++l){i=this.getTouchClientXY(n[l]);a+=i.clientX;s+=i.clientY}e.clientX=a/o;e.clientY=s/o}this.includeXY&&(e.xy=this.getMousePosition(e));this.triggerEvent(t,e)}},getTouchClientXY:function(e){var t=window.olMockWin||window,r=t.pageXOffset,n=t.pageYOffset,i=e.clientX,a=e.clientY;if(0===e.pageY&&Math.floor(a)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(i)>Math.floor(e.pageX)){i-=r;a-=n}else if(a<e.pageY-n||i<e.pageX-r){i=e.pageX-r;a=e.pageY-n}e.olClientX=i;e.olClientY=a;return{clientX:i,clientY:a}},clearMouseCache:function(){
this.element.scrolls=null;this.element.lefttop=null;this.element.offsets=null},getMousePosition:function(e){if(this.includeXY){if(!this.element.hasScrollEvent){OpenLayers.Event.observe(window,"scroll",this.clearMouseListener);this.element.hasScrollEvent=!0}}else this.clearMouseCache();if(!this.element.scrolls){var t=OpenLayers.Util.getViewportElement();this.element.scrolls=[window.pageXOffset||t.scrollLeft,window.pageYOffset||t.scrollTop]}this.element.lefttop||(this.element.lefttop=[document.documentElement.clientLeft||0,document.documentElement.clientTop||0]);this.element.offsets||(this.element.offsets=OpenLayers.Util.pagePosition(this.element));return new OpenLayers.Pixel(e.clientX+this.element.scrolls[0]-this.element.offsets[0]-this.element.lefttop[0],e.clientY+this.element.scrolls[1]-this.element.offsets[1]-this.element.lefttop[1])},addMsTouchListener:function(e,t,r){function n(e){r(OpenLayers.Util.applyDefaults({stopPropagation:function(){for(var e=i.length-1;e>=0;--e)i[e].stopPropagation()},preventDefault:function(){for(var e=i.length-1;e>=0;--e)i[e].preventDefault()},type:t},e))}var i=(this.eventHandler,this._msTouches);switch(t){case"touchstart":return this.addMsTouchListenerStart(e,t,n);case"touchend":return this.addMsTouchListenerEnd(e,t,n);case"touchmove":return this.addMsTouchListenerMove(e,t,n);default:throw"Unknown touch event type"}},addMsTouchListenerStart:function(e,t,r){var n=this._msTouches,i=function(e){for(var t=!1,i=0,a=n.length;a>i;++i)if(n[i].pointerId==e.pointerId){t=!0;break}t||n.push(e);e.touches=n.slice();r(e)};OpenLayers.Event.observe(e,"MSPointerDown",i);var a=function(e){for(var t=0,r=n.length;r>t;++t)if(n[t].pointerId==e.pointerId){n.splice(t,1);break}};OpenLayers.Event.observe(e,"MSPointerUp",a)},addMsTouchListenerMove:function(e,t,r){var n=this._msTouches,i=function(e){if(!(e.pointerType==e.MSPOINTER_TYPE_MOUSE&&0==e.buttons||1==n.length&&n[0].pageX==e.pageX&&n[0].pageY==e.pageY)){for(var t=0,i=n.length;i>t;++t)if(n[t].pointerId==e.pointerId){n[t]=e;break}e.touches=n.slice();r(e)}};OpenLayers.Event.observe(e,"MSPointerMove",i)},addMsTouchListenerEnd:function(e,t,r){var n=this._msTouches,i=function(e){for(var t=0,i=n.length;i>t;++t)if(n[t].pointerId==e.pointerId){n.splice(t,1);break}e.touches=n.slice();r(e)};OpenLayers.Event.observe(e,"MSPointerUp",i)},CLASS_NAME:"OpenLayers.Events"});OpenLayers.Animation=function(e){function t(e,t,r){t=t>0?t:Number.POSITIVE_INFINITY;var n=++s,i=+new Date;o[n]=function(){if(o[n]&&+new Date-i<=t){e();o[n]&&a(o[n],r)}else delete o[n]};a(o[n],r);return n}function r(e){delete o[e]}var n=OpenLayers.Util.vendorPrefix.js(e,"requestAnimationFrame"),i=!!n,a=function(){var t=e[n]||function(t,r){e.setTimeout(t,16)};return function(r,n){t.apply(e,[r,n])}}(),s=0,o={};return{isNative:i,requestFrame:a,start:t,stop:r}}(window);OpenLayers.Tween=OpenLayers.Class({easing:null,begin:null,finish:null,duration:null,callbacks:null,time:null,minFrameRate:null,startTime:null,animationId:null,playing:!1,initialize:function(e){this.easing=e?e:OpenLayers.Easing.Expo.easeOut},start:function(e,t,r,n){this.playing=!0;this.begin=e;this.finish=t;this.duration=r;this.callbacks=n.callbacks;this.minFrameRate=n.minFrameRate||30;this.time=0;this.startTime=(new Date).getTime();OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.callbacks&&this.callbacks.start&&this.callbacks.start.call(this,this.begin);this.animationId=OpenLayers.Animation.start(OpenLayers.Function.bind(this.play,this))},stop:function(){if(this.playing){this.callbacks&&this.callbacks.done&&this.callbacks.done.call(this,this.finish);OpenLayers.Animation.stop(this.animationId);this.animationId=null;this.playing=!1}},play:function(){var e={};for(var t in this.begin){var r=this.begin[t],n=this.finish[t];if(null==r||null==n||isNaN(r)||isNaN(n))throw new TypeError("invalid value for Tween");var i=n-r;e[t]=this.easing.apply(this,[this.time,r,i,this.duration])}this.time++;this.callbacks&&this.callbacks.eachStep&&((new Date).getTime()-this.startTime)/this.time<=1e3/this.minFrameRate&&this.callbacks.eachStep.call(this,e);this.time>this.duration&&this.stop()},CLASS_NAME:"OpenLayers.Tween"});OpenLayers.Easing={CLASS_NAME:"OpenLayers.Easing"};OpenLayers.Easing.Linear={easeIn:function(e,t,r,n){return r*e/n+t},easeOut:function(e,t,r,n){return r*e/n+t},easeInOut:function(e,t,r,n){return r*e/n+t},CLASS_NAME:"OpenLayers.Easing.Linear"};OpenLayers.Easing.Expo={easeIn:function(e,t,r,n){return 0==e?t:r*Math.pow(2,10*(e/n-1))+t},easeOut:function(e,t,r,n){return e==n?t+r:r*(-Math.pow(2,-10*e/n)+1)+t},easeInOut:function(e,t,r,n){return 0==e?t:e==n?t+r:(e/=n/2)<1?r/2*Math.pow(2,10*(e-1))+t:r/2*(-Math.pow(2,-10*--e)+2)+t},CLASS_NAME:"OpenLayers.Easing.Expo"};OpenLayers.Easing.Quad={easeIn:function(e,t,r,n){return r*(e/=n)*e+t},easeOut:function(e,t,r,n){return-r*(e/=n)*(e-2)+t},easeInOut:function(e,t,r,n){return(e/=n/2)<1?r/2*e*e+t:-r/2*(--e*(e-2)-1)+t},CLASS_NAME:"OpenLayers.Easing.Quad"};OpenLayers.Projection=OpenLayers.Class({proj:null,projCode:null,titleRegEx:/\+title=[^\+]*/,initialize:function(e,t){OpenLayers.Util.extend(this,t);this.projCode=e;"object"==typeof Proj4js&&(this.proj=new Proj4js.Proj(e))},getCode:function(){return this.proj?this.proj.srsCode:this.projCode},getUnits:function(){return this.proj?this.proj.units:null},toString:function(){return this.getCode()},equals:function(e){var t=e,r=!1;if(t){t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t));if("object"==typeof Proj4js&&this.proj.defData&&t.proj.defData)r=this.proj.defData.replace(this.titleRegEx,"")==t.proj.defData.replace(this.titleRegEx,"");else if(t.getCode){var n=this.getCode(),i=t.getCode();r=n==i||!!OpenLayers.Projection.transforms[n]&&OpenLayers.Projection.transforms[n][i]===OpenLayers.Projection.nullTransform}}return r},destroy:function(){delete this.proj;delete this.projCode},CLASS_NAME:"OpenLayers.Projection"});OpenLayers.Projection.transforms={};OpenLayers.Projection.defaults={"EPSG:4326":{units:"degrees",maxExtent:[-180,-90,180,90],yx:!0},"CRS:84":{units:"degrees",maxExtent:[-180,-90,180,90]},"EPSG:900913":{units:"m",maxExtent:[-20037508.34,-20037508.34,20037508.34,20037508.34]}};OpenLayers.Projection.addTransform=function(e,t,r){if(r===OpenLayers.Projection.nullTransform){var n=OpenLayers.Projection.defaults[e];n&&!OpenLayers.Projection.defaults[t]&&(OpenLayers.Projection.defaults[t]=n)}OpenLayers.Projection.transforms[e]||(OpenLayers.Projection.transforms[e]={});OpenLayers.Projection.transforms[e][t]=r};OpenLayers.Projection.transform=function(e,t,r){if(t&&r){t instanceof OpenLayers.Projection||(t=new OpenLayers.Projection(t));r instanceof OpenLayers.Projection||(r=new OpenLayers.Projection(r));if(t.proj&&r.proj)e=Proj4js.transform(t.proj,r.proj,e);else{var n=t.getCode(),i=r.getCode(),a=OpenLayers.Projection.transforms;a[n]&&a[n][i]&&a[n][i](e)}}return e};OpenLayers.Projection.nullTransform=function(e){return e};!function(){function e(e){e.x=180*e.x/i;e.y=180/Math.PI*(2*Math.atan(Math.exp(e.y/i*Math.PI))-Math.PI/2);return e}function t(e){e.x=e.x*i/180;var t=Math.log(Math.tan((90+e.y)*Math.PI/360))/Math.PI*i;e.y=Math.max(-20037508.34,Math.min(t,20037508.34));return e}function r(r,n){var i,a,s,o,l,c=OpenLayers.Projection.addTransform,u=OpenLayers.Projection.nullTransform;for(i=0,a=n.length;a>i;++i){s=n[i];c(r,s,t);c(s,r,e);for(l=i+1;a>l;++l){o=n[l];c(s,o,u);c(o,s,u)}}}var n,i=20037508.34,a=["EPSG:900913","EPSG:3857","EPSG:102113","EPSG:102100"],s=["CRS:84","urn:ogc:def:crs:EPSG:6.6:4326","EPSG:4326"];for(n=a.length-1;n>=0;--n)r(a[n],s);for(n=s.length-1;n>=0;--n)r(s[n],a)}();OpenLayers.Map=OpenLayers.Class({Z_INDEX_BASE:{BaseLayer:100,Overlay:325,Feature:725,Popup:750,Control:1e3},id:null,fractionalZoom:!1,events:null,allOverlays:!1,div:null,dragging:!1,size:null,viewPortDiv:null,layerContainerOrigin:null,layerContainerDiv:null,layers:null,controls:null,popups:null,baseLayer:null,center:null,resolution:null,zoom:0,panRatio:1.5,options:null,tileSize:null,projection:"EPSG:4326",units:null,resolutions:null,maxResolution:null,minResolution:null,maxScale:null,minScale:null,maxExtent:null,minExtent:null,restrictedExtent:null,numZoomLevels:16,theme:null,displayProjection:null,fallThrough:!1,autoUpdateSize:!0,eventListeners:null,panTween:null,panMethod:OpenLayers.Easing.Expo.easeOut,panDuration:50,zoomTween:null,zoomMethod:OpenLayers.Easing.Quad.easeOut,zoomDuration:20,paddingForPopups:null,layerContainerOriginPx:null,minPx:null,maxPx:null,initialize:function(e,t){if(1===arguments.length&&"object"==typeof e){t=e;e=t&&t.div}this.tileSize=new OpenLayers.Size(OpenLayers.Map.TILE_WIDTH,OpenLayers.Map.TILE_HEIGHT);this.paddingForPopups=new OpenLayers.Bounds(15,15,15,15);this.theme=OpenLayers._getScriptLocation()+"theme/default/style.css";this.options=OpenLayers.Util.extend({},t);OpenLayers.Util.extend(this,t);var r=this.projection instanceof OpenLayers.Projection?this.projection.projCode:this.projection;OpenLayers.Util.applyDefaults(this,OpenLayers.Projection.defaults[r]);!this.maxExtent||this.maxExtent instanceof OpenLayers.Bounds||(this.maxExtent=new OpenLayers.Bounds(this.maxExtent));!this.minExtent||this.minExtent instanceof OpenLayers.Bounds||(this.minExtent=new OpenLayers.Bounds(this.minExtent));!this.restrictedExtent||this.restrictedExtent instanceof OpenLayers.Bounds||(this.restrictedExtent=new OpenLayers.Bounds(this.restrictedExtent));!this.center||this.center instanceof OpenLayers.LonLat||(this.center=new OpenLayers.LonLat(this.center));this.layers=[];this.id=OpenLayers.Util.createUniqueID("OpenLayers.Map_");this.div=OpenLayers.Util.getElement(e);if(!this.div){this.div=document.createElement("div");this.div.style.height="1px";this.div.style.width="1px"}OpenLayers.Element.addClass(this.div,"olMap");var n=this.id+"_OpenLayers_ViewPort";this.viewPortDiv=OpenLayers.Util.createDiv(n,null,null,null,"relative",null,"hidden");this.viewPortDiv.style.width="100%";this.viewPortDiv.style.height="100%";this.viewPortDiv.className="olMapViewport";this.div.appendChild(this.viewPortDiv);this.events=new OpenLayers.Events(this,this.viewPortDiv,null,this.fallThrough,{includeXY:!0});if(OpenLayers.TileManager&&null!==this.tileManager){this.tileManager instanceof OpenLayers.TileManager||(this.tileManager=new OpenLayers.TileManager(this.tileManager));this.tileManager.addMap(this)}n=this.id+"_OpenLayers_Container";this.layerContainerDiv=OpenLayers.Util.createDiv(n);this.layerContainerDiv.style.zIndex=this.Z_INDEX_BASE.Popup-1;this.layerContainerOriginPx={x:0,y:0};this.applyTransform();this.viewPortDiv.appendChild(this.layerContainerDiv);this.updateSize();this.eventListeners instanceof Object&&this.events.on(this.eventListeners);if(this.autoUpdateSize===!0){this.updateSizeDestroy=OpenLayers.Function.bind(this.updateSize,this);OpenLayers.Event.observe(window,"resize",this.updateSizeDestroy)}if(this.theme){for(var i=!0,a=document.getElementsByTagName("link"),s=0,o=a.length;o>s;++s)if(OpenLayers.Util.isEquivalentUrl(a.item(s).href,this.theme)){i=!1;break}if(i){var l=document.createElement("link");l.setAttribute("rel","stylesheet");l.setAttribute("type","text/css");l.setAttribute("href",this.theme);document.getElementsByTagName("head")[0].appendChild(l)}}if(null==this.controls){this.controls=[];if(null!=OpenLayers.Control){OpenLayers.Control.Navigation?this.controls.push(new OpenLayers.Control.Navigation):OpenLayers.Control.TouchNavigation&&this.controls.push(new OpenLayers.Control.TouchNavigation);OpenLayers.Control.Zoom?this.controls.push(new OpenLayers.Control.Zoom):OpenLayers.Control.PanZoom&&this.controls.push(new OpenLayers.Control.PanZoom);OpenLayers.Control.ArgParser&&this.controls.push(new OpenLayers.Control.ArgParser);OpenLayers.Control.Attribution&&this.controls.push(new OpenLayers.Control.Attribution)}}for(var s=0,o=this.controls.length;o>s;s++)this.addControlToMap(this.controls[s]);this.popups=[];this.unloadDestroy=OpenLayers.Function.bind(this.destroy,this);OpenLayers.Event.observe(window,"unload",this.unloadDestroy);if(t&&t.layers){delete this.center;delete this.zoom;this.addLayers(t.layers);t.center&&!this.getCenter()&&this.setCenter(t.center,t.zoom)}this.panMethod&&(this.panTween=new OpenLayers.Tween(this.panMethod));this.zoomMethod&&this.applyTransform.transform&&(this.zoomTween=new OpenLayers.Tween(this.zoomMethod))},getViewport:function(){return this.viewPortDiv},render:function(e){this.div=OpenLayers.Util.getElement(e);OpenLayers.Element.addClass(this.div,"olMap");this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.div.appendChild(this.viewPortDiv);this.updateSize()},unloadDestroy:null,updateSizeDestroy:null,destroy:function(){if(!this.unloadDestroy)return!1;if(this.panTween){this.panTween.stop();this.panTween=null}if(this.zoomTween){this.zoomTween.stop();this.zoomTween=null}OpenLayers.Event.stopObserving(window,"unload",this.unloadDestroy);this.unloadDestroy=null;this.updateSizeDestroy&&OpenLayers.Event.stopObserving(window,"resize",this.updateSizeDestroy);this.paddingForPopups=null;if(null!=this.controls){for(var e=this.controls.length-1;e>=0;--e)this.controls[e].destroy();this.controls=null}if(null!=this.layers){for(var e=this.layers.length-1;e>=0;--e)this.layers[e].destroy(!1);this.layers=null}this.viewPortDiv&&this.viewPortDiv.parentNode&&this.viewPortDiv.parentNode.removeChild(this.viewPortDiv);this.viewPortDiv=null;if(this.tileManager){this.tileManager.removeMap(this);this.tileManager=null}if(this.eventListeners){this.events.un(this.eventListeners);this.eventListeners=null}this.events.destroy();this.events=null;this.options=null},setOptions:function(e){var t=this.minPx&&e.restrictedExtent!=this.restrictedExtent;OpenLayers.Util.extend(this,e);t&&this.moveTo(this.getCachedCenter(),this.zoom,{forceZoomChange:!0})},getTileSize:function(){return this.tileSize},getBy:function(e,t,r){var n="function"==typeof r.test,i=OpenLayers.Array.filter(this[e],function(e){return e[t]==r||n&&r.test(e[t])});return i},getLayersBy:function(e,t){return this.getBy("layers",e,t)},getLayersByName:function(e){return this.getLayersBy("name",e)},getLayersByClass:function(e){return this.getLayersBy("CLASS_NAME",e)},getControlsBy:function(e,t){return this.getBy("controls",e,t)},getControlsByClass:function(e){return this.getControlsBy("CLASS_NAME",e)},getLayer:function(e){for(var t=null,r=0,n=this.layers.length;n>r;r++){var i=this.layers[r];if(i.id==e){t=i;break}}return t},setLayerZIndex:function(e,t){e.setZIndex(this.Z_INDEX_BASE[e.isBaseLayer?"BaseLayer":"Overlay"]+5*t)},resetLayersZIndex:function(){for(var e=0,t=this.layers.length;t>e;e++){var r=this.layers[e];this.setLayerZIndex(r,e)}},addLayer:function(e){for(var t=0,r=this.layers.length;r>t;t++)if(this.layers[t]==e)return!1;if(this.events.triggerEvent("preaddlayer",{layer:e})===!1)return!1;this.allOverlays&&(e.isBaseLayer=!1);e.div.className="olLayerDiv";e.div.style.overflow="";this.setLayerZIndex(e,this.layers.length);e.isFixed?this.viewPortDiv.appendChild(e.div):this.layerContainerDiv.appendChild(e.div);this.layers.push(e);e.setMap(this);e.isBaseLayer||this.allOverlays&&!this.baseLayer?null==this.baseLayer?this.setBaseLayer(e):e.setVisibility(!1):e.redraw();this.events.triggerEvent("addlayer",{layer:e});e.events.triggerEvent("added",{map:this,layer:e});e.afterAdd();return!0},addLayers:function(e){for(var t=0,r=e.length;r>t;t++)this.addLayer(e[t])},removeLayer:function(e,t){if(this.events.triggerEvent("preremovelayer",{layer:e})!==!1){null==t&&(t=!0);e.isFixed?this.viewPortDiv.removeChild(e.div):this.layerContainerDiv.removeChild(e.div);OpenLayers.Util.removeItem(this.layers,e);e.removeMap(this);e.map=null;if(this.baseLayer==e){this.baseLayer=null;if(t)for(var r=0,n=this.layers.length;n>r;r++){var i=this.layers[r];if(i.isBaseLayer||this.allOverlays){this.setBaseLayer(i);break}}}this.resetLayersZIndex();this.events.triggerEvent("removelayer",{layer:e});e.events.triggerEvent("removed",{map:this,layer:e})}},getNumLayers:function(){return this.layers.length},getLayerIndex:function(e){return OpenLayers.Util.indexOf(this.layers,e)},setLayerIndex:function(e,t){var r=this.getLayerIndex(e);0>t?t=0:t>this.layers.length&&(t=this.layers.length);if(r!=t){this.layers.splice(r,1);this.layers.splice(t,0,e);for(var n=0,i=this.layers.length;i>n;n++)this.setLayerZIndex(this.layers[n],n);this.events.triggerEvent("changelayer",{layer:e,property:"order"});this.allOverlays&&(0===t?this.setBaseLayer(e):this.baseLayer!==this.layers[0]&&this.setBaseLayer(this.layers[0]))}},raiseLayer:function(e,t){var r=this.getLayerIndex(e)+t;this.setLayerIndex(e,r)},setBaseLayer:function(e){if(e!=this.baseLayer&&-1!=OpenLayers.Util.indexOf(this.layers,e)){var t=this.getCachedCenter(),r=OpenLayers.Util.getResolutionFromScale(this.getScale(),e.units);null==this.baseLayer||this.allOverlays||this.baseLayer.setVisibility(!1);this.baseLayer=e;if(!this.allOverlays||this.baseLayer.visibility){this.baseLayer.setVisibility(!0);this.baseLayer.inRange===!1&&this.baseLayer.redraw()}if(null!=t){var n=this.getZoomForResolution(r||this.resolution,!0);this.setCenter(t,n,!1,!0)}this.events.triggerEvent("changebaselayer",{layer:this.baseLayer})}},addControl:function(e,t){this.controls.push(e);this.addControlToMap(e,t)},addControls:function(e,t){for(var r=1===arguments.length?[]:t,n=0,i=e.length;i>n;n++){var a=e[n],s=r[n]?r[n]:null;this.addControl(a,s)}},addControlToMap:function(e,t){e.outsideViewport=null!=e.div;this.displayProjection&&!e.displayProjection&&(e.displayProjection=this.displayProjection);e.setMap(this);var r=e.draw(t);if(r&&!e.outsideViewport){r.style.zIndex=this.Z_INDEX_BASE.Control+this.controls.length;this.viewPortDiv.appendChild(r)}e.autoActivate&&e.activate()},getControl:function(e){for(var t=null,r=0,n=this.controls.length;n>r;r++){var i=this.controls[r];if(i.id==e){t=i;break}}return t},removeControl:function(e){if(e&&e==this.getControl(e.id)){e.div&&e.div.parentNode==this.viewPortDiv&&this.viewPortDiv.removeChild(e.div);OpenLayers.Util.removeItem(this.controls,e)}},addPopup:function(e,t){if(t)for(var r=this.popups.length-1;r>=0;--r)this.removePopup(this.popups[r]);e.map=this;this.popups.push(e);var n=e.draw();if(n){n.style.zIndex=this.Z_INDEX_BASE.Popup+this.popups.length;this.layerContainerDiv.appendChild(n)}},removePopup:function(e){OpenLayers.Util.removeItem(this.popups,e);if(e.div)try{this.layerContainerDiv.removeChild(e.div)}catch(t){}e.map=null},getSize:function(){var e=null;null!=this.size&&(e=this.size.clone());return e},updateSize:function(){var e=this.getCurrentSize();if(e&&!isNaN(e.h)&&!isNaN(e.w)){this.events.clearMouseCache();var t=this.getSize();null==t&&(this.size=t=e);if(!e.equals(t)){this.size=e;for(var r=0,n=this.layers.length;n>r;r++)this.layers[r].onMapResize();var i=this.getCachedCenter();if(null!=this.baseLayer&&null!=i){var a=this.getZoom();this.zoom=null;this.setCenter(i,a)}}}this.events.triggerEvent("updatesize")},getCurrentSize:function(){var e=new OpenLayers.Size(this.div.clientWidth,this.div.clientHeight);if(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h)){e.w=this.div.offsetWidth;e.h=this.div.offsetHeight}if(0==e.w&&0==e.h||isNaN(e.w)&&isNaN(e.h)){e.w=parseInt(this.div.style.width);e.h=parseInt(this.div.style.height)}return e},calculateBounds:function(e,t){var r=null;null==e&&(e=this.getCachedCenter());null==t&&(t=this.getResolution());if(null!=e&&null!=t){var n=this.size.w*t/2,i=this.size.h*t/2;r=new OpenLayers.Bounds(e.lon-n,e.lat-i,e.lon+n,e.lat+i)}return r},getCenter:function(){var e=null,t=this.getCachedCenter();t&&(e=t.clone());return e},getCachedCenter:function(){!this.center&&this.size&&(this.center=this.getLonLatFromViewPortPx({x:this.size.w/2,y:this.size.h/2}));return this.center},getZoom:function(){return this.zoom},pan:function(e,t,r){r=OpenLayers.Util.applyDefaults(r,{animate:!0,dragging:!1});if(r.dragging)(0!=e||0!=t)&&this.moveByPx(e,t);else{var n=this.getViewPortPxFromLonLat(this.getCachedCenter()),i=n.add(e,t);if(this.dragging||!i.equals(n)){var a=this.getLonLatFromViewPortPx(i);if(r.animate)this.panTo(a);else{this.moveTo(a);if(this.dragging){this.dragging=!1;this.events.triggerEvent("moveend")}}}}},panTo:function(e){if(this.panTween&&this.getExtent().scale(this.panRatio).containsLonLat(e)){var t=this.getCachedCenter();if(e.equals(t))return;var r=this.getPixelFromLonLat(t),n=this.getPixelFromLonLat(e),i={x:n.x-r.x,y:n.y-r.y},a={x:0,y:0};this.panTween.start({x:0,y:0},i,this.panDuration,{callbacks:{eachStep:OpenLayers.Function.bind(function(e){var t=e.x-a.x,r=e.y-a.y;this.moveByPx(t,r);a.x=Math.round(e.x);a.y=Math.round(e.y)},this),done:OpenLayers.Function.bind(function(t){this.moveTo(e);this.dragging=!1;this.events.triggerEvent("moveend")},this)}})}else this.setCenter(e)},setCenter:function(e,t,r,n){this.panTween&&this.panTween.stop();this.zoomTween&&this.zoomTween.stop();this.moveTo(e,t,{dragging:r,forceZoomChange:n})},moveByPx:function(e,t){var r=this.size.w/2,n=this.size.h/2,i=r+e,a=n+t,s=this.baseLayer.wrapDateLine,o=0,l=0;if(this.restrictedExtent){o=r;l=n;s=!1}e=s||i<=this.maxPx.x-o&&i>=this.minPx.x+o?Math.round(e):0;t=a<=this.maxPx.y-l&&a>=this.minPx.y+l?Math.round(t):0;if(e||t){if(!this.dragging){this.dragging=!0;this.events.triggerEvent("movestart")}this.center=null;if(e){this.layerContainerOriginPx.x-=e;this.minPx.x-=e;this.maxPx.x-=e}if(t){this.layerContainerOriginPx.y-=t;this.minPx.y-=t;this.maxPx.y-=t}this.applyTransform();var c,u,p;for(u=0,p=this.layers.length;p>u;++u){c=this.layers[u];if(c.visibility&&(c===this.baseLayer||c.inRange)){c.moveByPx(e,t);c.events.triggerEvent("move")}}this.events.triggerEvent("move")}},adjustZoom:function(e){if(this.baseLayer&&this.baseLayer.wrapDateLine){var t=this.baseLayer.resolutions,r=this.getMaxExtent().getWidth()/this.size.w;if(this.getResolutionForZoom(e)>r)if(this.fractionalZoom)e=this.getZoomForResolution(r);else for(var n=0|e,i=t.length;i>n;++n)if(t[n]<=r){e=n;break}}return e},getMinZoom:function(){return this.adjustZoom(0)},moveTo:function(e,t,r){null==e||e instanceof OpenLayers.LonLat||(e=new OpenLayers.LonLat(e));r||(r={});if(null!=t){t=parseFloat(t);this.fractionalZoom||(t=Math.round(t))}var n=t;t=this.adjustZoom(t);t!==n&&(e=this.getCenter());var i=r.dragging||this.dragging,a=r.forceZoomChange;if(!this.getCachedCenter()&&!this.isValidLonLat(e)){e=this.maxExtent.getCenterLonLat();this.center=e.clone()}if(null!=this.restrictedExtent){null==e&&(e=this.center);null==t&&(t=this.getZoom());var s=this.getResolutionForZoom(t),o=this.calculateBounds(e,s);if(!this.restrictedExtent.containsBounds(o)){var l=this.restrictedExtent.getCenterLonLat();o.getWidth()>this.restrictedExtent.getWidth()?e=new OpenLayers.LonLat(l.lon,e.lat):o.left<this.restrictedExtent.left?e=e.add(this.restrictedExtent.left-o.left,0):o.right>this.restrictedExtent.right&&(e=e.add(this.restrictedExtent.right-o.right,0));o.getHeight()>this.restrictedExtent.getHeight()?e=new OpenLayers.LonLat(e.lon,l.lat):o.bottom<this.restrictedExtent.bottom?e=e.add(0,this.restrictedExtent.bottom-o.bottom):o.top>this.restrictedExtent.top&&(e=e.add(0,this.restrictedExtent.top-o.top))}}var c=a||this.isValidZoomLevel(t)&&t!=this.getZoom(),u=this.isValidLonLat(e)&&!e.equals(this.center);if(c||u||i){i||this.events.triggerEvent("movestart",{zoomChanged:c});if(u){!c&&this.center&&this.centerLayerContainer(e);this.center=e.clone()}var p=c?this.getResolutionForZoom(t):this.getResolution();if(c||null==this.layerContainerOrigin){this.layerContainerOrigin=this.getCachedCenter();this.layerContainerOriginPx.x=0;this.layerContainerOriginPx.y=0;this.applyTransform();var h=this.getMaxExtent({restricted:!0}),d=h.getCenterLonLat(),f=this.center.lon-d.lon,m=d.lat-this.center.lat,y=Math.round(h.getWidth()/p),g=Math.round(h.getHeight()/p);this.minPx={x:(this.size.w-y)/2-f/p,y:(this.size.h-g)/2-m/p};this.maxPx={x:this.minPx.x+Math.round(h.getWidth()/p),y:this.minPx.y+Math.round(h.getHeight()/p)}}if(c){this.zoom=t;this.resolution=p}var v=this.getExtent();if(this.baseLayer.visibility){this.baseLayer.moveTo(v,c,r.dragging);r.dragging||this.baseLayer.events.triggerEvent("moveend",{zoomChanged:c})}v=this.baseLayer.getExtent();for(var C=this.layers.length-1;C>=0;--C){var T=this.layers[C];if(T!==this.baseLayer&&!T.isBaseLayer){var L=T.calculateInRange();if(T.inRange!=L){T.inRange=L;L||T.display(!1);this.events.triggerEvent("changelayer",{layer:T,property:"visibility"})}if(L&&T.visibility){T.moveTo(v,c,r.dragging);r.dragging||T.events.triggerEvent("moveend",{zoomChanged:c})}}}this.events.triggerEvent("move");i||this.events.triggerEvent("moveend");if(c){for(var C=0,w=this.popups.length;w>C;C++)this.popups[C].updatePosition();this.events.triggerEvent("zoomend")}}},centerLayerContainer:function(e){var t=this.getViewPortPxFromLonLat(this.layerContainerOrigin),r=this.getViewPortPxFromLonLat(e);if(null!=t&&null!=r){var n=this.layerContainerOriginPx.x,i=this.layerContainerOriginPx.y,a=Math.round(t.x-r.x),s=Math.round(t.y-r.y);this.applyTransform(this.layerContainerOriginPx.x=a,this.layerContainerOriginPx.y=s);var o=n-a,l=i-s;this.minPx.x-=o;this.maxPx.x-=o;this.minPx.y-=l;this.maxPx.y-=l}},isValidZoomLevel:function(e){return null!=e&&e>=0&&e<this.getNumZoomLevels()},isValidLonLat:function(e){var t=!1;if(null!=e){var r=this.getMaxExtent(),n=this.baseLayer.wrapDateLine&&r;t=r.containsLonLat(e,{worldBounds:n})}return t},getProjection:function(){var e=this.getProjectionObject();return e?e.getCode():null},getProjectionObject:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.projection);return e},getMaxResolution:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.maxResolution);return e},getMaxExtent:function(e){var t=null;e&&e.restricted&&this.restrictedExtent?t=this.restrictedExtent:null!=this.baseLayer&&(t=this.baseLayer.maxExtent);return t},getNumZoomLevels:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.numZoomLevels);return e},getExtent:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.getExtent());return e},getResolution:function(){var e=null;null!=this.baseLayer?e=this.baseLayer.getResolution():this.allOverlays===!0&&this.layers.length>0&&(e=this.layers[0].getResolution());return e},getUnits:function(){var e=null;null!=this.baseLayer&&(e=this.baseLayer.units);return e},getScale:function(){var e=null;if(null!=this.baseLayer){var t=this.getResolution(),r=this.baseLayer.units;e=OpenLayers.Util.getScaleFromResolution(t,r)}return e},getZoomForExtent:function(e,t){var r=null;null!=this.baseLayer&&(r=this.baseLayer.getZoomForExtent(e,t));return r},getResolutionForZoom:function(e){var t=null;this.baseLayer&&(t=this.baseLayer.getResolutionForZoom(e));return t},getZoomForResolution:function(e,t){var r=null;null!=this.baseLayer&&(r=this.baseLayer.getZoomForResolution(e,t));return r},zoomTo:function(e,t){var r=this;if(r.isValidZoomLevel(e)){r.baseLayer.wrapDateLine&&(e=r.adjustZoom(e));if(r.zoomTween){var n=r.getResolution(),i=r.getResolutionForZoom(e),a={scale:1},s={scale:n/i};if(r.zoomTween.playing&&r.zoomTween.duration<3*r.zoomDuration)r.zoomTween.finish={scale:r.zoomTween.finish.scale*s.scale};else{if(!t){var o=r.getSize();t={x:o.w/2,y:o.h/2}}r.zoomTween.start(a,s,r.zoomDuration,{minFrameRate:50,callbacks:{eachStep:function(e){var n=r.layerContainerOriginPx,i=e.scale,a=(i-1)*(n.x-t.x)|0,s=(i-1)*(n.y-t.y)|0;r.applyTransform(n.x+a,n.y+s,i)},done:function(e){r.applyTransform();var n=r.getResolution()/e.scale,i=r.getZoomForResolution(n,!0);r.moveTo(r.getZoomTargetCenter(t,n),i,!0)}}})}}else{var l=t?r.getZoomTargetCenter(t,r.getResolutionForZoom(e)):null;r.setCenter(l,e)}}},zoomIn:function(){this.zoomTo(this.getZoom()+1)},zoomOut:function(){this.zoomTo(this.getZoom()-1)},zoomToExtent:function(e,t){e instanceof OpenLayers.Bounds||(e=new OpenLayers.Bounds(e));var r=e.getCenterLonLat();if(this.baseLayer.wrapDateLine){var n=this.getMaxExtent();e=e.clone();for(;e.right<e.left;)e.right+=n.getWidth();r=e.getCenterLonLat().wrapDateLine(n)}this.setCenter(r,this.getZoomForExtent(e,t))},zoomToMaxExtent:function(e){var t=e?e.restricted:!0,r=this.getMaxExtent({restricted:t});this.zoomToExtent(r)},zoomToScale:function(e,t){var r=OpenLayers.Util.getResolutionFromScale(e,this.baseLayer.units),n=this.size.w*r/2,i=this.size.h*r/2,a=this.getCachedCenter(),s=new OpenLayers.Bounds(a.lon-n,a.lat-i,a.lon+n,a.lat+i);this.zoomToExtent(s,t)},getLonLatFromViewPortPx:function(e){var t=null;null!=this.baseLayer&&(t=this.baseLayer.getLonLatFromViewPortPx(e));return t},getViewPortPxFromLonLat:function(e){var t=null;null!=this.baseLayer&&(t=this.baseLayer.getViewPortPxFromLonLat(e));return t},getZoomTargetCenter:function(e,t){var r=null,n=this.getSize(),i=n.w/2-e.x,a=e.y-n.h/2,s=this.getLonLatFromPixel(e);s&&(r=new OpenLayers.LonLat(s.lon+i*t,s.lat+a*t));return r},getLonLatFromPixel:function(e){return this.getLonLatFromViewPortPx(e)},getPixelFromLonLat:function(e){var t=this.getViewPortPxFromLonLat(e);t.x=Math.round(t.x);t.y=Math.round(t.y);return t},getGeodesicPixelSize:function(e){var t=e?this.getLonLatFromPixel(e):this.getCachedCenter()||new OpenLayers.LonLat(0,0),r=this.getResolution(),n=t.add(-r/2,0),i=t.add(r/2,0),a=t.add(0,-r/2),s=t.add(0,r/2),o=new OpenLayers.Projection("EPSG:4326"),l=this.getProjectionObject()||o;if(!l.equals(o)){n.transform(l,o);i.transform(l,o);a.transform(l,o);s.transform(l,o)}return new OpenLayers.Size(OpenLayers.Util.distVincenty(n,i),OpenLayers.Util.distVincenty(a,s))},getViewPortPxFromLayerPx:function(e){var t=null;if(null!=e){var r=this.layerContainerOriginPx.x,n=this.layerContainerOriginPx.y;t=e.add(r,n)}return t},getLayerPxFromViewPortPx:function(e){var t=null;if(null!=e){var r=-this.layerContainerOriginPx.x,n=-this.layerContainerOriginPx.y;t=e.add(r,n);(isNaN(t.x)||isNaN(t.y))&&(t=null)}return t},getLonLatFromLayerPx:function(e){e=this.getViewPortPxFromLayerPx(e);return this.getLonLatFromViewPortPx(e)},getLayerPxFromLonLat:function(e){var t=this.getPixelFromLonLat(e);return this.getLayerPxFromViewPortPx(t)},applyTransform:function(e,t,r){r=r||1;var n=this.layerContainerOriginPx,i=1!==r;e=e||n.x;t=t||n.y;var a=this.layerContainerDiv.style,s=this.applyTransform.transform,o=this.applyTransform.template;if(void 0===s){s=OpenLayers.Util.vendorPrefix.style("transform");this.applyTransform.transform=s;if(s){var l=OpenLayers.Element.getStyle(this.viewPortDiv,OpenLayers.Util.vendorPrefix.css("transform"));if(!l||"none"!==l){o=["translate3d(",",0) ","scale3d(",",1)"];a[s]=[o[0],"0,0",o[1]].join("")}o&&~a[s].indexOf(o[0])||(o=["translate(",") ","scale(",")"]);this.applyTransform.template=o}}if(null===s||"translate3d("!==o[0]&&i!==!0){a.left=e+"px";a.top=t+"px";null!==s&&(a[s]="")}else{if(i===!0&&"translate("===o[0]){e-=n.x;t-=n.y;a.left=n.x+"px";a.top=n.y+"px"}a[s]=[o[0],e,"px,",t,"px",o[1],o[2],r,",",r,o[3]].join("")}},CLASS_NAME:"OpenLayers.Map"});OpenLayers.Map.TILE_WIDTH=256;OpenLayers.Map.TILE_HEIGHT=256;OpenLayers.Layer=OpenLayers.Class({id:null,name:null,div:null,opacity:1,alwaysInRange:null,RESOLUTION_PROPERTIES:["scales","resolutions","maxScale","minScale","maxResolution","minResolution","numZoomLevels","maxZoomLevel"],events:null,map:null,isBaseLayer:!1,alpha:!1,displayInLayerSwitcher:!0,visibility:!0,attribution:null,inRange:!1,imageSize:null,options:null,eventListeners:null,gutter:0,projection:null,units:null,scales:null,resolutions:null,maxExtent:null,minExtent:null,maxResolution:null,minResolution:null,numZoomLevels:null,minScale:null,maxScale:null,displayOutsideMaxExtent:!1,wrapDateLine:!1,metadata:null,initialize:function(e,t){this.metadata={};t=OpenLayers.Util.extend({},t);null!=this.alwaysInRange&&(t.alwaysInRange=this.alwaysInRange);this.addOptions(t);this.name=e;if(null==this.id){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_");this.div=OpenLayers.Util.createDiv(this.id);this.div.style.width="100%";this.div.style.height="100%";this.div.dir="ltr";this.events=new OpenLayers.Events(this,this.div);this.eventListeners instanceof Object&&this.events.on(this.eventListeners)}},destroy:function(e){null==e&&(e=!0);null!=this.map&&this.map.removeLayer(this,e);

this.projection=null;this.map=null;this.name=null;this.div=null;this.options=null;if(this.events){this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy()}this.eventListeners=null;this.events=null},clone:function(e){null==e&&(e=new OpenLayers.Layer(this.name,this.getOptions()));OpenLayers.Util.applyDefaults(e,this);e.map=null;return e},getOptions:function(){var e={};for(var t in this.options)e[t]=this[t];return e},setName:function(e){if(e!=this.name){this.name=e;null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"name"})}},addOptions:function(e,t){null==this.options&&(this.options={});if(e){"string"==typeof e.projection&&(e.projection=new OpenLayers.Projection(e.projection));e.projection&&OpenLayers.Util.applyDefaults(e,OpenLayers.Projection.defaults[e.projection.getCode()]);!e.maxExtent||e.maxExtent instanceof OpenLayers.Bounds||(e.maxExtent=new OpenLayers.Bounds(e.maxExtent));!e.minExtent||e.minExtent instanceof OpenLayers.Bounds||(e.minExtent=new OpenLayers.Bounds(e.minExtent))}OpenLayers.Util.extend(this.options,e);OpenLayers.Util.extend(this,e);this.projection&&this.projection.getUnits()&&(this.units=this.projection.getUnits());if(this.map){var r=this.map.getResolution(),n=this.RESOLUTION_PROPERTIES.concat(["projection","units","minExtent","maxExtent"]);for(var i in e)if(e.hasOwnProperty(i)&&OpenLayers.Util.indexOf(n,i)>=0){this.initResolutions();if(t&&this.map.baseLayer===this){this.map.setCenter(this.map.getCenter(),this.map.getZoomForResolution(r),!1,!0);this.map.events.triggerEvent("changebaselayer",{layer:this})}break}}},onMapResize:function(){},redraw:function(){var e=!1;if(this.map){this.inRange=this.calculateInRange();var t=this.getExtent();if(t&&this.inRange&&this.visibility){var r=!0;this.moveTo(t,r,!1);this.events.triggerEvent("moveend",{zoomChanged:r});e=!0}}return e},moveTo:function(e,t,r){var n=this.visibility;this.isBaseLayer||(n=n&&this.inRange);this.display(n)},moveByPx:function(e,t){},setMap:function(e){if(null==this.map){this.map=e;this.maxExtent=this.maxExtent||this.map.maxExtent;this.minExtent=this.minExtent||this.map.minExtent;this.projection=this.projection||this.map.projection;"string"==typeof this.projection&&(this.projection=new OpenLayers.Projection(this.projection));this.units=this.projection.getUnits()||this.units||this.map.units;this.initResolutions();if(!this.isBaseLayer){this.inRange=this.calculateInRange();var t=this.visibility&&this.inRange;this.div.style.display=t?"":"none"}this.setTileSize()}},afterAdd:function(){},removeMap:function(e){},getImageSize:function(e){return this.imageSize||this.tileSize},setTileSize:function(e){var t=e?e:this.tileSize?this.tileSize:this.map.getTileSize();this.tileSize=t;this.gutter&&(this.imageSize=new OpenLayers.Size(t.w+2*this.gutter,t.h+2*this.gutter))},getVisibility:function(){return this.visibility},setVisibility:function(e){if(e!=this.visibility){this.visibility=e;this.display(e);this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"visibility"});this.events.triggerEvent("visibilitychanged")}},display:function(e){e!=("none"!=this.div.style.display)&&(this.div.style.display=e&&this.calculateInRange()?"block":"none")},calculateInRange:function(){var e=!1;if(this.alwaysInRange)e=!0;else if(this.map){var t=this.map.getResolution();e=t>=this.minResolution&&t<=this.maxResolution}return e},setIsBaseLayer:function(e){if(e!=this.isBaseLayer){this.isBaseLayer=e;null!=this.map&&this.map.events.triggerEvent("changebaselayer",{layer:this})}},initResolutions:function(){var e,t,r,n={},i=!0;for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++){r=this.RESOLUTION_PROPERTIES[e];n[r]=this.options[r];i&&this.options[r]&&(i=!1)}null==this.options.alwaysInRange&&(this.alwaysInRange=i);null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales));null==n.resolutions&&(n.resolutions=this.calculateResolutions(n));if(null==n.resolutions){for(e=0,t=this.RESOLUTION_PROPERTIES.length;t>e;e++){r=this.RESOLUTION_PROPERTIES[e];n[r]=null!=this.options[r]?this.options[r]:this.map[r]}null==n.resolutions&&(n.resolutions=this.resolutionsFromScales(n.scales));null==n.resolutions&&(n.resolutions=this.calculateResolutions(n))}var a;this.options.maxResolution&&"auto"!==this.options.maxResolution&&(a=this.options.maxResolution);this.options.minScale&&(a=OpenLayers.Util.getResolutionFromScale(this.options.minScale,this.units));var s;this.options.minResolution&&"auto"!==this.options.minResolution&&(s=this.options.minResolution);this.options.maxScale&&(s=OpenLayers.Util.getResolutionFromScale(this.options.maxScale,this.units));if(n.resolutions){n.resolutions.sort(function(e,t){return t-e});a||(a=n.resolutions[0]);if(!s){var o=n.resolutions.length-1;s=n.resolutions[o]}}this.resolutions=n.resolutions;if(this.resolutions){t=this.resolutions.length;this.scales=new Array(t);for(e=0;t>e;e++)this.scales[e]=OpenLayers.Util.getScaleFromResolution(this.resolutions[e],this.units);this.numZoomLevels=t}this.minResolution=s;s&&(this.maxScale=OpenLayers.Util.getScaleFromResolution(s,this.units));this.maxResolution=a;a&&(this.minScale=OpenLayers.Util.getScaleFromResolution(a,this.units))},resolutionsFromScales:function(e){if(null!=e){var t,r,n;n=e.length;t=new Array(n);for(r=0;n>r;r++)t[r]=OpenLayers.Util.getResolutionFromScale(e[r],this.units);return t}},calculateResolutions:function(e){var t,r,n,i=e.maxResolution;if(null!=e.minScale)i=OpenLayers.Util.getResolutionFromScale(e.minScale,this.units);else if("auto"==i&&null!=this.maxExtent){t=this.map.getSize();r=this.maxExtent.getWidth()/t.w;n=this.maxExtent.getHeight()/t.h;i=Math.max(r,n)}var a=e.minResolution;if(null!=e.maxScale)a=OpenLayers.Util.getResolutionFromScale(e.maxScale,this.units);else if("auto"==e.minResolution&&null!=this.minExtent){t=this.map.getSize();r=this.minExtent.getWidth()/t.w;n=this.minExtent.getHeight()/t.h;a=Math.max(r,n)}if("number"!=typeof i&&"number"!=typeof a&&null!=this.maxExtent){var s=this.map.getTileSize();i=Math.max(this.maxExtent.getWidth()/s.w,this.maxExtent.getHeight()/s.h)}var o=e.maxZoomLevel,l=e.numZoomLevels;if("number"==typeof a&&"number"==typeof i&&void 0===l){var c=i/a;l=Math.floor(Math.log(c)/Math.log(2))+1}else void 0===l&&null!=o&&(l=o+1);if(!("number"!=typeof l||0>=l||"number"!=typeof i&&"number"!=typeof a)){var u=new Array(l),p=2;"number"==typeof a&&"number"==typeof i&&(p=Math.pow(i/a,1/(l-1)));var h;if("number"==typeof i)for(h=0;l>h;h++)u[h]=i/Math.pow(p,h);else for(h=0;l>h;h++)u[l-1-h]=a*Math.pow(p,h);return u}},getResolution:function(){var e=this.map.getZoom();return this.getResolutionForZoom(e)},getExtent:function(){return this.map.calculateBounds()},getZoomForExtent:function(e,t){var r=this.map.getSize(),n=Math.max(e.getWidth()/r.w,e.getHeight()/r.h);return this.getZoomForResolution(n,t)},getDataExtent:function(){},getResolutionForZoom:function(e){e=Math.max(0,Math.min(e,this.resolutions.length-1));var t;if(this.map.fractionalZoom){var r=Math.floor(e),n=Math.ceil(e);t=this.resolutions[r]-(e-r)*(this.resolutions[r]-this.resolutions[n])}else t=this.resolutions[Math.round(e)];return t},getZoomForResolution:function(e,t){var r,n,i;if(this.map.fractionalZoom){var a,s=0,o=this.resolutions.length-1,l=this.resolutions[s],c=this.resolutions[o];for(n=0,i=this.resolutions.length;i>n;++n){a=this.resolutions[n];if(a>=e){l=a;s=n}if(e>=a){c=a;o=n;break}}var u=l-c;r=u>0?s+(l-e)/u:s}else{var p,h=Number.POSITIVE_INFINITY;for(n=0,i=this.resolutions.length;i>n;n++)if(t){p=Math.abs(this.resolutions[n]-e);if(p>h)break;h=p}else if(this.resolutions[n]<e)break;r=Math.max(0,n-1)}return r},getLonLatFromViewPortPx:function(e){var t=null,r=this.map;if(null!=e&&r.minPx){var n=r.getResolution(),i=r.getMaxExtent({restricted:!0}),a=(e.x-r.minPx.x)*n+i.left,s=(r.minPx.y-e.y)*n+i.top;t=new OpenLayers.LonLat(a,s);this.wrapDateLine&&(t=t.wrapDateLine(this.maxExtent))}return t},getViewPortPxFromLonLat:function(e,t){var r=null;if(null!=e){t=t||this.map.getResolution();var n=this.map.calculateBounds(null,t);r=new OpenLayers.Pixel(1/t*(e.lon-n.left),1/t*(n.top-e.lat))}return r},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=this.div.childNodes,r=0,n=t.length;n>r;++r){var i=t[r].firstChild||t[r],a=t[r].lastChild;a&&"iframe"===a.nodeName.toLowerCase()&&(i=a.parentNode);OpenLayers.Util.modifyDOMElement(i,null,null,null,null,null,null,e)}null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"opacity"})}},getZIndex:function(){return this.div.style.zIndex},setZIndex:function(e){this.div.style.zIndex=e},adjustBounds:function(e){if(this.gutter){var t=this.gutter*this.map.getResolution();e=new OpenLayers.Bounds(e.left-t,e.bottom-t,e.right+t,e.top+t)}if(this.wrapDateLine){var r={rightTolerance:this.getResolution(),leftTolerance:this.getResolution()};e=e.wrapDateLine(this.maxExtent,r)}return e},CLASS_NAME:"OpenLayers.Layer"});OpenLayers.Layer.HTTPRequest=OpenLayers.Class(OpenLayers.Layer,{URL_HASH_FACTOR:(Math.sqrt(5)-1)/2,url:null,params:null,reproject:!1,initialize:function(e,t,r,n){OpenLayers.Layer.prototype.initialize.apply(this,[e,n]);this.url=t;this.params||(this.params=OpenLayers.Util.extend({},r))},destroy:function(){this.url=null;this.params=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.HTTPRequest(this.name,this.url,this.params,this.getOptions()));e=OpenLayers.Layer.prototype.clone.apply(this,[e]);return e},setUrl:function(e){this.url=e},mergeNewParams:function(e){this.params=OpenLayers.Util.extend(this.params,e);var t=this.redraw();null!=this.map&&this.map.events.triggerEvent("changelayer",{layer:this,property:"params"});return t},redraw:function(e){return e?this.mergeNewParams({_olSalt:Math.random()}):OpenLayers.Layer.prototype.redraw.apply(this,[])},selectUrl:function(e,t){for(var r=1,n=0,i=e.length;i>n;n++){r*=e.charCodeAt(n)*this.URL_HASH_FACTOR;r-=Math.floor(r)}return t[Math.floor(r*t.length)]},getFullRequestString:function(e,t){var r=t||this.url,n=OpenLayers.Util.extend({},this.params);n=OpenLayers.Util.extend(n,e);var i=OpenLayers.Util.getParameterString(n);OpenLayers.Util.isArray(r)&&(r=this.selectUrl(i,r));var a=OpenLayers.Util.upperCaseObject(OpenLayers.Util.getParameters(r));for(var s in n)s.toUpperCase()in a&&delete n[s];i=OpenLayers.Util.getParameterString(n);return OpenLayers.Util.urlAppend(r,i)},CLASS_NAME:"OpenLayers.Layer.HTTPRequest"});OpenLayers.Tile=OpenLayers.Class({events:null,eventListeners:null,id:null,layer:null,url:null,bounds:null,size:null,position:null,isLoading:!1,initialize:function(e,t,r,n,i,a){this.layer=e;this.position=t.clone();this.setBounds(r);this.url=n;i&&(this.size=i.clone());this.id=OpenLayers.Util.createUniqueID("Tile_");OpenLayers.Util.extend(this,a);this.events=new OpenLayers.Events(this);this.eventListeners instanceof Object&&this.events.on(this.eventListeners)},unload:function(){if(this.isLoading){this.isLoading=!1;this.events.triggerEvent("unload")}},destroy:function(){this.layer=null;this.bounds=null;this.size=null;this.position=null;this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.eventListeners=null;this.events=null},draw:function(e){e||this.clear();var t=this.shouldDraw();t&&!e&&this.events.triggerEvent("beforedraw")===!1&&(t=null);return t},shouldDraw:function(){var e=!1,t=this.layer.maxExtent;if(t){var r=this.layer.map,n=r.baseLayer.wrapDateLine&&r.getMaxExtent();this.bounds.intersectsBounds(t,{inclusive:!1,worldBounds:n})&&(e=!0)}return e||this.layer.displayOutsideMaxExtent},setBounds:function(e){e=e.clone();if(this.layer.map.baseLayer.wrapDateLine){var t=this.layer.map.getMaxExtent(),r=this.layer.map.getResolution();e=e.wrapDateLine(t,{leftTolerance:r,rightTolerance:r})}this.bounds=e},moveTo:function(e,t,r){null==r&&(r=!0);this.setBounds(e);this.position=t.clone();r&&this.draw()},clear:function(e){},CLASS_NAME:"OpenLayers.Tile"});OpenLayers.Tile.Image=OpenLayers.Class(OpenLayers.Tile,{url:null,imgDiv:null,frame:null,imageReloadAttempts:null,layerAlphaHack:null,asyncRequestId:null,maxGetUrlLength:null,canvasContext:null,crossOriginKeyword:null,initialize:function(e,t,r,n,i,a){OpenLayers.Tile.prototype.initialize.apply(this,arguments);this.url=n;this.layerAlphaHack=this.layer.alpha&&OpenLayers.Util.alphaHack();if(null!=this.maxGetUrlLength||this.layer.gutter||this.layerAlphaHack){this.frame=document.createElement("div");this.frame.style.position="absolute";this.frame.style.overflow="hidden"}null!=this.maxGetUrlLength&&OpenLayers.Util.extend(this,OpenLayers.Tile.Image.IFrame)},destroy:function(){if(this.imgDiv){this.clear();this.imgDiv=null;this.frame=null}this.asyncRequestId=null;OpenLayers.Tile.prototype.destroy.apply(this,arguments)},draw:function(){var e=OpenLayers.Tile.prototype.draw.apply(this,arguments);if(e){this.layer!=this.layer.map.baseLayer&&this.layer.reproject&&(this.bounds=this.getBoundsFromBaseLayer(this.position));if(this.isLoading)this._loadEvent="reload";else{this.isLoading=!0;this._loadEvent="loadstart"}this.renderTile();this.positionTile()}else e===!1&&this.unload();return e},renderTile:function(){if(this.layer.async){var e=this.asyncRequestId=(this.asyncRequestId||0)+1;this.layer.getURLasync(this.bounds,function(t){if(e==this.asyncRequestId){this.url=t;this.initImage()}},this)}else{this.url=this.layer.getURL(this.bounds);this.initImage()}},positionTile:function(){var e=this.getTile().style,t=this.frame?this.size:this.layer.getImageSize(this.bounds),r=1;this.layer instanceof OpenLayers.Layer.Grid&&(r=this.layer.getServerResolution()/this.layer.map.getResolution());e.left=this.position.x+"px";e.top=this.position.y+"px";e.width=Math.round(r*t.w)+"px";e.height=Math.round(r*t.h)+"px"},clear:function(){OpenLayers.Tile.prototype.clear.apply(this,arguments);var e=this.imgDiv;if(e){var t=this.getTile();t.parentNode===this.layer.div&&this.layer.div.removeChild(t);this.setImgSrc();this.layerAlphaHack===!0&&(e.style.filter="");OpenLayers.Element.removeClass(e,"olImageLoadError")}this.canvasContext=null},getImage:function(){if(!this.imgDiv){this.imgDiv=OpenLayers.Tile.Image.IMAGE.cloneNode(!1);var e=this.imgDiv.style;if(this.frame){var t=0,r=0;if(this.layer.gutter){t=this.layer.gutter/this.layer.tileSize.w*100;r=this.layer.gutter/this.layer.tileSize.h*100}e.left=-t+"%";e.top=-r+"%";e.width=2*t+100+"%";e.height=2*r+100+"%"}e.visibility="hidden";e.opacity=0;this.layer.opacity<1&&(e.filter="alpha(opacity="+100*this.layer.opacity+")");e.position="absolute";if(this.layerAlphaHack){e.paddingTop=e.height;e.height="0";e.width="100%"}this.frame&&this.frame.appendChild(this.imgDiv)}return this.imgDiv},setImage:function(e){this.imgDiv=e},initImage:function(){if(this.url||this.imgDiv){this.events.triggerEvent("beforeload");this.layer.div.appendChild(this.getTile());this.events.triggerEvent(this._loadEvent);var e=this.getImage(),t=e.getAttribute("src")||"";if(this.url&&OpenLayers.Util.isEquivalentUrl(t,this.url))this._loadTimeout=window.setTimeout(OpenLayers.Function.bind(this.onImageLoad,this),0);else{this.stopLoading();this.crossOriginKeyword&&e.removeAttribute("crossorigin");OpenLayers.Event.observe(e,"load",OpenLayers.Function.bind(this.onImageLoad,this));OpenLayers.Event.observe(e,"error",OpenLayers.Function.bind(this.onImageError,this));this.imageReloadAttempts=0;this.setImgSrc(this.url)}}else this.isLoading=!1},setImgSrc:function(e){var t=this.imgDiv;if(e){t.style.visibility="hidden";t.style.opacity=0;this.crossOriginKeyword&&("data:"!==e.substr(0,5)?t.setAttribute("crossorigin",this.crossOriginKeyword):t.removeAttribute("crossorigin"));t.src=e}else{this.stopLoading();this.imgDiv=null;t.parentNode&&t.parentNode.removeChild(t)}},getTile:function(){return this.frame?this.frame:this.getImage()},createBackBuffer:function(){if(this.imgDiv&&!this.isLoading){var e;if(this.frame){e=this.frame.cloneNode(!1);e.appendChild(this.imgDiv)}else e=this.imgDiv;this.imgDiv=null;return e}},onImageLoad:function(){var e=this.imgDiv;this.stopLoading();e.style.visibility="inherit";e.style.opacity=this.layer.opacity;this.isLoading=!1;this.canvasContext=null;this.events.triggerEvent("loadend");this.layerAlphaHack===!0&&(e.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e.src+"', sizingMethod='scale')")},onImageError:function(){var e=this.imgDiv;if(null!=e.src){this.imageReloadAttempts++;if(this.imageReloadAttempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS)this.setImgSrc(this.layer.getURL(this.bounds));else{OpenLayers.Element.addClass(e,"olImageLoadError");this.events.triggerEvent("loaderror");this.onImageLoad()}}},stopLoading:function(){OpenLayers.Event.stopObservingElement(this.imgDiv);window.clearTimeout(this._loadTimeout);delete this._loadTimeout},getCanvasContext:function(){if(OpenLayers.CANVAS_SUPPORTED&&this.imgDiv&&!this.isLoading){if(!this.canvasContext){var e=document.createElement("canvas");e.width=this.size.w;e.height=this.size.h;this.canvasContext=e.getContext("2d");this.canvasContext.drawImage(this.imgDiv,0,0)}return this.canvasContext}},CLASS_NAME:"OpenLayers.Tile.Image"});OpenLayers.Tile.Image.IMAGE=function(){var e=new Image;e.className="olTileImage";e.galleryImg="no";return e}();OpenLayers.Layer.Grid=OpenLayers.Class(OpenLayers.Layer.HTTPRequest,{tileSize:null,tileOriginCorner:"bl",tileOrigin:null,tileOptions:null,tileClass:OpenLayers.Tile.Image,grid:null,singleTile:!1,ratio:1.5,buffer:0,transitionEffect:"resize",numLoadingTiles:0,serverResolutions:null,loading:!1,backBuffer:null,gridResolution:null,backBufferResolution:null,backBufferLonLat:null,backBufferTimerId:null,removeBackBufferDelay:null,className:null,gridLayout:null,rowSign:null,transitionendEvents:["transitionend","webkitTransitionEnd","otransitionend","oTransitionEnd"],initialize:function(e,t,r,n){OpenLayers.Layer.HTTPRequest.prototype.initialize.apply(this,arguments);this.grid=[];this._removeBackBuffer=OpenLayers.Function.bind(this.removeBackBuffer,this);this.initProperties();this.rowSign="t"===this.tileOriginCorner.substr(0,1)?1:-1},initProperties:function(){void 0===this.options.removeBackBufferDelay&&(this.removeBackBufferDelay=this.singleTile?0:2500);void 0===this.options.className&&(this.className=this.singleTile?"olLayerGridSingleTile":"olLayerGrid")},setMap:function(e){OpenLayers.Layer.HTTPRequest.prototype.setMap.call(this,e);OpenLayers.Element.addClass(this.div,this.className)},removeMap:function(e){this.removeBackBuffer()},destroy:function(){this.removeBackBuffer();this.clearGrid();this.grid=null;this.tileSize=null;OpenLayers.Layer.HTTPRequest.prototype.destroy.apply(this,arguments)},clearGrid:function(){if(this.grid){for(var e=0,t=this.grid.length;t>e;e++)for(var r=this.grid[e],n=0,i=r.length;i>n;n++){var a=r[n];this.destroyTile(a)}this.grid=[];this.gridResolution=null;this.gridLayout=null}},addOptions:function(e,t){var r=void 0!==e.singleTile&&e.singleTile!==this.singleTile;OpenLayers.Layer.HTTPRequest.prototype.addOptions.apply(this,arguments);if(this.map&&r){this.initProperties();this.clearGrid();this.tileSize=this.options.tileSize;this.setTileSize();this.moveTo(null,!0)}},clone:function(e){null==e&&(e=new OpenLayers.Layer.Grid(this.name,this.url,this.params,this.getOptions()));e=OpenLayers.Layer.HTTPRequest.prototype.clone.apply(this,[e]);null!=this.tileSize&&(e.tileSize=this.tileSize.clone());e.grid=[];e.gridResolution=null;e.backBuffer=null;e.backBufferTimerId=null;e.loading=!1;e.numLoadingTiles=0;return e},moveTo:function(e,t,r){OpenLayers.Layer.HTTPRequest.prototype.moveTo.apply(this,arguments);e=e||this.map.getExtent();if(null!=e){{var n=!this.grid.length||t,i=this.getTilesBounds(),a=this.map.getResolution();this.getServerResolution(a)}if(this.singleTile){if(n||!r&&!i.containsBounds(e)){t&&"resize"!==this.transitionEffect&&this.removeBackBuffer();t&&"resize"!==this.transitionEffect||this.applyBackBuffer(a);this.initSingleTile(e)}}else{n=n||!i.intersectsBounds(e,{worldBounds:this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent()});if(n){!t||"resize"!==this.transitionEffect&&this.gridResolution!==a||this.applyBackBuffer(a);this.initGriddedTiles(e)}else this.moveGriddedTiles()}}},getTileData:function(e){var t=null,r=e.lon,n=e.lat,i=this.grid.length;if(this.map&&i){var a=this.map.getResolution(),s=this.tileSize.w,o=this.tileSize.h,l=this.grid[0][0].bounds,c=l.left,u=l.top;if(c>r&&this.map.baseLayer.wrapDateLine){var p=this.map.getMaxExtent().getWidth(),h=Math.ceil((c-r)/p);r+=p*h}var d=(r-c)/(a*s),f=(u-n)/(a*o),m=Math.floor(d),y=Math.floor(f);if(y>=0&&i>y){var g=this.grid[y][m];g&&(t={tile:g,i:Math.floor((d-m)*s),j:Math.floor((f-y)*o)})}}return t},destroyTile:function(e){this.removeTileMonitoringHooks(e);e.destroy()},getServerResolution:function(e){var t=Number.POSITIVE_INFINITY;e=e||this.map.getResolution();if(this.serverResolutions&&-1===OpenLayers.Util.indexOf(this.serverResolutions,e)){var r,n,i,a;for(r=this.serverResolutions.length-1;r>=0;r--){i=this.serverResolutions[r];n=Math.abs(i-e);if(n>t)break;t=n;a=i}e=a}return e},getServerZoom:function(){var e=this.getServerResolution();return this.serverResolutions?OpenLayers.Util.indexOf(this.serverResolutions,e):this.map.getZoomForResolution(e)+(this.zoomOffset||0)},applyBackBuffer:function(e){null!==this.backBufferTimerId&&this.removeBackBuffer();var t=this.backBuffer;if(!t){t=this.createBackBuffer();if(!t)return;e===this.gridResolution?this.div.insertBefore(t,this.div.firstChild):this.map.baseLayer.div.parentNode.insertBefore(t,this.map.baseLayer.div);this.backBuffer=t;var r=this.grid[0][0].bounds;this.backBufferLonLat={lon:r.left,lat:r.top};this.backBufferResolution=this.gridResolution}for(var n,i=this.backBufferResolution/e,a=t.childNodes,s=a.length-1;s>=0;--s){n=a[s];n.style.top=(i*n._i*n._h|0)+"px";n.style.left=(i*n._j*n._w|0)+"px";n.style.width=Math.round(i*n._w)+"px";n.style.height=Math.round(i*n._h)+"px"}var o=this.getViewPortPxFromLonLat(this.backBufferLonLat,e),l=this.map.layerContainerOriginPx.x,c=this.map.layerContainerOriginPx.y;t.style.left=Math.round(o.x-l)+"px";t.style.top=Math.round(o.y-c)+"px"},createBackBuffer:function(){var e;if(this.grid.length>0){e=document.createElement("div");e.id=this.div.id+"_bb";e.className="olBackBuffer";e.style.position="absolute";var t=this.map;e.style.zIndex="resize"===this.transitionEffect?this.getZIndex()-1:t.Z_INDEX_BASE.BaseLayer-(t.getNumLayers()-t.getLayerIndex(this));for(var r=0,n=this.grid.length;n>r;r++)for(var i=0,a=this.grid[r].length;a>i;i++){var s=this.grid[r][i],o=this.grid[r][i].createBackBuffer();if(o){o._i=r;o._j=i;o._w=s.size.w;o._h=s.size.h;o.id=s.id+"_bb";e.appendChild(o)}}}return e},removeBackBuffer:function(){if(this._transitionElement){for(var e=this.transitionendEvents.length-1;e>=0;--e)OpenLayers.Event.stopObserving(this._transitionElement,this.transitionendEvents[e],this._removeBackBuffer);delete this._transitionElement}if(this.backBuffer){this.backBuffer.parentNode&&this.backBuffer.parentNode.removeChild(this.backBuffer);this.backBuffer=null;this.backBufferResolution=null;if(null!==this.backBufferTimerId){window.clearTimeout(this.backBufferTimerId);this.backBufferTimerId=null}}},moveByPx:function(e,t){this.singleTile||this.moveGriddedTiles()},setTileSize:function(e){if(this.singleTile){e=this.map.getSize();e.h=parseInt(e.h*this.ratio,10);e.w=parseInt(e.w*this.ratio,10)}OpenLayers.Layer.HTTPRequest.prototype.setTileSize.apply(this,[e])},getTilesBounds:function(){var e=null,t=this.grid.length;if(t){var r=this.grid[t-1][0].bounds,n=this.grid[0].length*r.getWidth(),i=this.grid.length*r.getHeight();e=new OpenLayers.Bounds(r.left,r.bottom,r.left+n,r.bottom+i)}return e},initSingleTile:function(e){this.events.triggerEvent("retile");var t=e.getCenterLonLat(),r=e.getWidth()*this.ratio,n=e.getHeight()*this.ratio,i=new OpenLayers.Bounds(t.lon-r/2,t.lat-n/2,t.lon+r/2,t.lat+n/2),a=this.map.getLayerPxFromLonLat({lon:i.left,lat:i.top});this.grid.length||(this.grid[0]=[]);var s=this.grid[0][0];if(s)s.moveTo(i,a);else{s=this.addTile(i,a);this.addTileMonitoringHooks(s);s.draw();this.grid[0][0]=s}this.removeExcessTiles(1,1);this.gridResolution=this.getServerResolution()},calculateGridLayout:function(e,t,r){var n=r*this.tileSize.w,i=r*this.tileSize.h,a=e.left-t.lon,s=Math.floor(a/n)-this.buffer,o=this.rowSign,l=o*(t.lat-e.top+i),c=Math[~o?"floor":"ceil"](l/i)-this.buffer*o;return{tilelon:n,tilelat:i,startcol:s,startrow:c}},getTileOrigin:function(){var e=this.tileOrigin;if(!e){var t=this.getMaxExtent(),r={tl:["left","top"],tr:["right","top"],bl:["left","bottom"],br:["right","bottom"]}[this.tileOriginCorner];e=new OpenLayers.LonLat(t[r[0]],t[r[1]])}return e},getTileBoundsForGridIndex:function(e,t){var r=this.getTileOrigin(),n=this.gridLayout,i=n.tilelon,a=n.tilelat,s=n.startcol,o=n.startrow,l=this.rowSign;return new OpenLayers.Bounds(r.lon+(s+t)*i,r.lat-(o+e*l)*a*l,r.lon+(s+t+1)*i,r.lat-(o+(e-1)*l)*a*l)},initGriddedTiles:function(e){this.events.triggerEvent("retile");var t=this.map.getSize(),r=this.getTileOrigin(),n=this.map.getResolution(),i=this.getServerResolution(),a=n/i,s={w:this.tileSize.w/a,h:this.tileSize.h/a},o=Math.ceil(t.h/s.h)+2*this.buffer+1,l=Math.ceil(t.w/s.w)+2*this.buffer+1,c=this.calculateGridLayout(e,r,i);this.gridLayout=c;var u=c.tilelon,p=c.tilelat,h=this.map.layerContainerOriginPx.x,d=this.map.layerContainerOriginPx.y,f=this.getTileBoundsForGridIndex(0,0),m=this.map.getViewPortPxFromLonLat(new OpenLayers.LonLat(f.left,f.top));m.x=Math.round(m.x)-h;m.y=Math.round(m.y)-d;var y=[],g=this.map.getCenter(),v=0;do{var C=this.grid[v];if(!C){C=[];this.grid.push(C)}var T=0;do{f=this.getTileBoundsForGridIndex(v,T);var L=m.clone();L.x=L.x+T*Math.round(s.w);L.y=L.y+v*Math.round(s.h);var w=C[T];if(w)w.moveTo(f,L,!1);else{w=this.addTile(f,L);this.addTileMonitoringHooks(w);C.push(w)}var b=f.getCenterLonLat();y.push({tile:w,distance:Math.pow(b.lon-g.lon,2)+Math.pow(b.lat-g.lat,2)});T+=1}while(f.right<=e.right+u*this.buffer||l>T);v+=1}while(f.bottom>=e.bottom-p*this.buffer||o>v);this.removeExcessTiles(v,T);var n=this.getServerResolution();this.gridResolution=n;y.sort(function(e,t){return e.distance-t.distance});for(var S=0,E=y.length;E>S;++S)y[S].tile.draw()},getMaxExtent:function(){return this.maxExtent},addTile:function(e,t){var r=new this.tileClass(this,t,e,null,this.tileSize,this.tileOptions);this.events.triggerEvent("addtile",{tile:r});return r},addTileMonitoringHooks:function(e){var t="olTileReplacing";e.onLoadStart=function(){if(this.loading===!1){this.loading=!0;this.events.triggerEvent("loadstart")}this.events.triggerEvent("tileloadstart",{tile:e});this.numLoadingTiles++;!this.singleTile&&this.backBuffer&&this.gridResolution===this.backBufferResolution&&OpenLayers.Element.addClass(e.getTile(),t)};e.onLoadEnd=function(r){this.numLoadingTiles--;var n="unload"===r.type;this.events.triggerEvent("tileloaded",{tile:e,aborted:n});if(!this.singleTile&&!n&&this.backBuffer&&this.gridResolution===this.backBufferResolution){var i=e.getTile();if("none"===OpenLayers.Element.getStyle(i,"display")){var a=document.getElementById(e.id+"_bb");a&&a.parentNode.removeChild(a)}OpenLayers.Element.removeClass(i,t)}if(0===this.numLoadingTiles){if(this.backBuffer)if(0===this.backBuffer.childNodes.length)this.removeBackBuffer();else{this._transitionElement=n?this.div.lastChild:e.imgDiv;for(var s=this.transitionendEvents,o=s.length-1;o>=0;--o)OpenLayers.Event.observe(this._transitionElement,s[o],this._removeBackBuffer);this.backBufferTimerId=window.setTimeout(this._removeBackBuffer,this.removeBackBufferDelay)}this.loading=!1;this.events.triggerEvent("loadend")}};e.onLoadError=function(){this.events.triggerEvent("tileerror",{tile:e})};e.events.on({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},removeTileMonitoringHooks:function(e){e.unload();e.events.un({loadstart:e.onLoadStart,loadend:e.onLoadEnd,unload:e.onLoadEnd,loaderror:e.onLoadError,scope:this})},moveGriddedTiles:function(){for(var e=this.buffer+1;;){var t=this.grid[0][0],r={x:t.position.x+this.map.layerContainerOriginPx.x,y:t.position.y+this.map.layerContainerOriginPx.y},n=this.getServerResolution()/this.map.getResolution(),i={w:Math.round(this.tileSize.w*n),h:Math.round(this.tileSize.h*n)};if(r.x>-i.w*(e-1))this.shiftColumn(!0,i);else if(r.x<-i.w*e)this.shiftColumn(!1,i);else if(r.y>-i.h*(e-1))this.shiftRow(!0,i);else{if(!(r.y<-i.h*e))break;this.shiftRow(!1,i)}}},shiftRow:function(e,t){var r=this.grid,n=e?0:r.length-1,i=e?-1:1,a=this.rowSign,s=this.gridLayout;s.startrow+=i*a;for(var o=r[n],l=r[e?"pop":"shift"](),c=0,u=l.length;u>c;c++){var p=l[c],h=o[c].position.clone();h.y+=t.h*i;p.moveTo(this.getTileBoundsForGridIndex(n,c),h)}r[e?"unshift":"push"](l)},shiftColumn:function(e,t){var r=this.grid,n=e?0:r[0].length-1,i=e?-1:1,a=this.gridLayout;a.startcol+=i;for(var s=0,o=r.length;o>s;s++){var l=r[s],c=l[n].position.clone(),u=l[e?"pop":"shift"]();c.x+=t.w*i;u.moveTo(this.getTileBoundsForGridIndex(s,n),c);l[e?"unshift":"push"](u)}},removeExcessTiles:function(e,t){for(var r,n;this.grid.length>e;){var i=this.grid.pop();for(r=0,n=i.length;n>r;r++){var a=i[r];this.destroyTile(a)}}for(r=0,n=this.grid.length;n>r;r++)for(;this.grid[r].length>t;){var i=this.grid[r],a=i.pop();this.destroyTile(a)}},onMapResize:function(){if(this.singleTile){this.clearGrid();this.setTileSize()}},getTileBounds:function(e){var t=this.maxExtent,r=this.getResolution(),n=r*this.tileSize.w,i=r*this.tileSize.h,a=this.getLonLatFromViewPortPx(e),s=t.left+n*Math.floor((a.lon-t.left)/n),o=t.bottom+i*Math.floor((a.lat-t.bottom)/i);return new OpenLayers.Bounds(s,o,s+n,o+i)},CLASS_NAME:"OpenLayers.Layer.Grid"});OpenLayers.Layer.WMTS=OpenLayers.Class(OpenLayers.Layer.Grid,{isBaseLayer:!0,version:"1.0.0",requestEncoding:"KVP",url:null,layer:null,matrixSet:null,style:null,format:"image/jpeg",tileOrigin:null,tileFullExtent:null,formatSuffix:null,matrixIds:null,dimensions:null,params:null,zoomOffset:0,serverResolutions:null,formatSuffixMap:{"image/png":"png","image/png8":"png","image/png24":"png","image/png32":"png",png:"png","image/jpeg":"jpg","image/jpg":"jpg",jpeg:"jpg",jpg:"jpg"},matrix:null,initialize:function(e){var t={url:!0,layer:!0,style:!0,matrixSet:!0};for(var r in t)if(!(r in e))throw new Error("Missing property '"+r+"' in layer configuration.");e.params=OpenLayers.Util.upperCaseObject(e.params);var n=[e.name,e.url,e.params,e];OpenLayers.Layer.Grid.prototype.initialize.apply(this,n);this.formatSuffix||(this.formatSuffix=this.formatSuffixMap[this.format]||this.format.split("/").pop());if(this.matrixIds){var i=this.matrixIds.length;if(i&&"string"==typeof this.matrixIds[0]){var a=this.matrixIds;this.matrixIds=new Array(i);for(var s=0;i>s;++s)this.matrixIds[s]={identifier:a[s]}}}},setMap:function(){OpenLayers.Layer.Grid.prototype.setMap.apply(this,arguments)},updateMatrixProperties:function(){this.matrix=this.getMatrix();if(this.matrix){this.matrix.topLeftCorner&&(this.tileOrigin=this.matrix.topLeftCorner);this.matrix.tileWidth&&this.matrix.tileHeight&&(this.tileSize=new OpenLayers.Size(this.matrix.tileWidth,this.matrix.tileHeight));this.tileOrigin||(this.tileOrigin=new OpenLayers.LonLat(this.maxExtent.left,this.maxExtent.top));this.tileFullExtent||(this.tileFullExtent=this.maxExtent)}},moveTo:function(e,t,r){(t||!this.matrix)&&this.updateMatrixProperties();return OpenLayers.Layer.Grid.prototype.moveTo.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.WMTS(this.options));e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]);return e},getIdentifier:function(){return this.getServerZoom()},getMatrix:function(){var e;if(this.matrixIds&&0!==this.matrixIds.length)if("scaleDenominator"in this.matrixIds[0])for(var t,r=OpenLayers.METERS_PER_INCH*OpenLayers.INCHES_PER_UNIT[this.units]*this.getServerResolution()/28e-5,n=Number.POSITIVE_INFINITY,i=0,a=this.matrixIds.length;a>i;++i){t=Math.abs(1-this.matrixIds[i].scaleDenominator/r);if(n>t){n=t;e=this.matrixIds[i]}}else e=this.matrixIds[this.getIdentifier()];else e={identifier:this.getIdentifier()
};return e},getTileInfo:function(e){var t=this.getServerResolution(),r=(e.lon-this.tileOrigin.lon)/(t*this.tileSize.w),n=(this.tileOrigin.lat-e.lat)/(t*this.tileSize.h),i=Math.floor(r),a=Math.floor(n);return{col:i,row:a,i:Math.floor((r-i)*this.tileSize.w),j:Math.floor((n-a)*this.tileSize.h)}},getURL:function(e){e=this.adjustBounds(e);var t="";if(!this.tileFullExtent||this.tileFullExtent.intersectsBounds(e)){var r,n=e.getCenterLonLat(),i=this.getTileInfo(n),a=(this.matrix.identifier,this.dimensions);t=OpenLayers.Util.isArray(this.url)?this.selectUrl([this.version,this.style,this.matrixSet,this.matrix.identifier,i.row,i.col].join(","),this.url):this.url;if("REST"===this.requestEncoding.toUpperCase()){r=this.params;if(-1!==t.indexOf("{")){var s=t.replace(/\{/g,"${"),o={style:this.style,Style:this.style,TileMatrixSet:this.matrixSet,TileMatrix:this.matrix.identifier,TileRow:i.row,TileCol:i.col};if(a){var l,c;for(c=a.length-1;c>=0;--c){l=a[c];o[l]=r[l.toUpperCase()]}}t=OpenLayers.String.format(s,o)}else{var u=this.version+"/"+this.layer+"/"+this.style+"/";if(a)for(var c=0;c<a.length;c++)r[a[c]]&&(u=u+r[a[c]]+"/");u=u+this.matrixSet+"/"+this.matrix.identifier+"/"+i.row+"/"+i.col+"."+this.formatSuffix;t.match(/\/$/)||(t+="/");t+=u}}else if("KVP"===this.requestEncoding.toUpperCase()){r={SERVICE:"WMTS",REQUEST:"GetTile",VERSION:this.version,LAYER:this.layer,STYLE:this.style,TILEMATRIXSET:this.matrixSet,TILEMATRIX:this.matrix.identifier,TILEROW:i.row,TILECOL:i.col,FORMAT:this.format};t=OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,[r])}}return t},mergeNewParams:function(e){return"KVP"===this.requestEncoding.toUpperCase()?OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,[OpenLayers.Util.upperCaseObject(e)]):void 0},CLASS_NAME:"OpenLayers.Layer.WMTS"});OpenLayers.Events.buttonclick=OpenLayers.Class({target:null,events:["mousedown","mouseup","click","dblclick","touchstart","touchmove","touchend","keydown"],startRegEx:/^mousedown|touchstart$/,cancelRegEx:/^touchmove$/,completeRegEx:/^mouseup|touchend$/,initialize:function(e){this.target=e;for(var t=this.events.length-1;t>=0;--t)this.target.register(this.events[t],this,this.buttonClick,{extension:!0})},destroy:function(){for(var e=this.events.length-1;e>=0;--e)this.target.unregister(this.events[e],this,this.buttonClick);delete this.target},getPressedButton:function(e){var t,r=3;do{if(OpenLayers.Element.hasClass(e,"olButton")){t=e;break}e=e.parentNode}while(--r>0&&e);return t},ignore:function(e){var t=3,r=!1;do{if("a"===e.nodeName.toLowerCase()){r=!0;break}e=e.parentNode}while(--t>0&&e);return r},buttonClick:function(e){var t=!0,r=OpenLayers.Event.element(e);if(r&&(OpenLayers.Event.isLeftClick(e)||!~e.type.indexOf("mouse"))){var n=this.getPressedButton(r);if(n){if("keydown"===e.type)switch(e.keyCode){case OpenLayers.Event.KEY_RETURN:case OpenLayers.Event.KEY_SPACE:this.target.triggerEvent("buttonclick",{buttonElement:n});OpenLayers.Event.stop(e);t=!1}else if(this.startEvt){if(this.completeRegEx.test(e.type)){var i=OpenLayers.Util.pagePosition(n),a=OpenLayers.Util.getViewportElement(),s=window.pageYOffset||a.scrollTop,o=window.pageXOffset||a.scrollLeft;i[0]=i[0]-o;i[1]=i[1]-s;this.target.triggerEvent("buttonclick",{buttonElement:n,buttonXY:{x:this.startEvt.clientX-i[0],y:this.startEvt.clientY-i[1]}})}this.cancelRegEx.test(e.type)&&delete this.startEvt;OpenLayers.Event.stop(e);t=!1}if(this.startRegEx.test(e.type)){this.startEvt=e;OpenLayers.Event.stop(e);t=!1}}else{t=!this.ignore(OpenLayers.Event.element(e));delete this.startEvt}}return t}});OpenLayers.Format=OpenLayers.Class({options:null,externalProjection:null,internalProjection:null,data:null,keepData:!1,initialize:function(e){OpenLayers.Util.extend(this,e);this.options=e},destroy:function(){},read:function(e){throw new Error("Read not implemented.")},write:function(e){throw new Error("Write not implemented.")},CLASS_NAME:"OpenLayers.Format"});OpenLayers.Format.XML=OpenLayers.Class(OpenLayers.Format,{namespaces:null,namespaceAlias:null,defaultPrefix:null,readers:{},writers:{},xmldom:null,initialize:function(e){window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM"));OpenLayers.Format.prototype.initialize.apply(this,[e]);this.namespaces=OpenLayers.Util.extend({},this.namespaces);this.namespaceAlias={};for(var t in this.namespaces)this.namespaceAlias[this.namespaces[t]]=t},destroy:function(){this.xmldom=null;OpenLayers.Format.prototype.destroy.apply(this,arguments)},setNamespace:function(e,t){this.namespaces[e]=t;this.namespaceAlias[t]=e},read:function(e){var t=e.indexOf("<");t>0&&(e=e.substring(t));var r=OpenLayers.Util.Try(OpenLayers.Function.bind(function(){var t;t=window.ActiveXObject&&!this.xmldom?new ActiveXObject("Microsoft.XMLDOM"):this.xmldom;t.loadXML(e);return t},this),function(){return(new DOMParser).parseFromString(e,"text/xml")},function(){var t=new XMLHttpRequest;t.open("GET","data:text/xml;charset=utf-8,"+encodeURIComponent(e),!1);t.overrideMimeType&&t.overrideMimeType("text/xml");t.send(null);return t.responseXML});this.keepData&&(this.data=r);return r},write:function(e){var t;if(this.xmldom)t=e.xml;else{var r=new XMLSerializer;if(1==e.nodeType){var n=document.implementation.createDocument("","",null);n.importNode&&(e=n.importNode(e,!0));n.appendChild(e);t=r.serializeToString(n)}else t=r.serializeToString(e)}return t},createElementNS:function(e,t){var r;r=this.xmldom?"string"==typeof e?this.xmldom.createNode(1,t,e):this.xmldom.createNode(1,t,""):document.createElementNS(e,t);return r},createDocumentFragment:function(){var e;e=this.xmldom?this.xmldom.createDocumentFragment():document.createDocumentFragment();return e},createTextNode:function(e){var t;"string"!=typeof e&&(e=String(e));t=this.xmldom?this.xmldom.createTextNode(e):document.createTextNode(e);return t},getElementsByTagNameNS:function(e,t,r){var n=[];if(e.getElementsByTagNameNS)n=e.getElementsByTagNameNS(t,r);else for(var i,a,s=e.getElementsByTagName("*"),o=0,l=s.length;l>o;++o){i=s[o];a=i.prefix?i.prefix+":"+r:r;("*"==r||a==i.nodeName)&&("*"==t||t==i.namespaceURI)&&n.push(i)}return n},getAttributeNodeNS:function(e,t,r){var n=null;if(e.getAttributeNodeNS)n=e.getAttributeNodeNS(t,r);else for(var i,a,s=e.attributes,o=0,l=s.length;l>o;++o){i=s[o];if(i.namespaceURI==t){a=i.prefix?i.prefix+":"+r:r;if(a==i.nodeName){n=i;break}}}return n},getAttributeNS:function(e,t,r){var n="";if(e.getAttributeNS)n=e.getAttributeNS(t,r)||"";else{var i=this.getAttributeNodeNS(e,t,r);i&&(n=i.nodeValue)}return n},getChildValue:function(e,t){var r=t||"";if(e)for(var n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 3:case 4:r+=n.nodeValue}return r},isSimpleContent:function(e){for(var t=!0,r=e.firstChild;r;r=r.nextSibling)if(1===r.nodeType){t=!1;break}return t},contentType:function(e){for(var t=!1,r=!1,n=OpenLayers.Format.XML.CONTENT_TYPE.EMPTY,i=e.firstChild;i;i=i.nextSibling){switch(i.nodeType){case 1:r=!0;break;case 8:break;default:t=!0}if(r&&t)break}if(r&&t)n=OpenLayers.Format.XML.CONTENT_TYPE.MIXED;else{if(r)return OpenLayers.Format.XML.CONTENT_TYPE.COMPLEX;if(t)return OpenLayers.Format.XML.CONTENT_TYPE.SIMPLE}return n},hasAttributeNS:function(e,t,r){var n=!1;n=e.hasAttributeNS?e.hasAttributeNS(t,r):!!this.getAttributeNodeNS(e,t,r);return n},setAttributeNS:function(e,t,r,n){if(e.setAttributeNS)e.setAttributeNS(t,r,n);else{if(!this.xmldom)throw"setAttributeNS not implemented";if(t){var i=e.ownerDocument.createNode(2,r,t);i.nodeValue=n;e.setAttributeNode(i)}else e.setAttribute(r,n)}},createElementNSPlus:function(e,t){t=t||{};var r=t.uri||this.namespaces[t.prefix];if(!r){var n=e.indexOf(":");r=this.namespaces[e.substring(0,n)]}r||(r=this.namespaces[this.defaultPrefix]);var i=this.createElementNS(r,e);t.attributes&&this.setAttributes(i,t.attributes);var a=t.value;null!=a&&i.appendChild(this.createTextNode(a));return i},setAttributes:function(e,t){var r,n;for(var i in t)if(null!=t[i]&&t[i].toString){r=t[i].toString();n=this.namespaces[i.substring(0,i.indexOf(":"))]||null;this.setAttributeNS(e,n,i,r)}},readNode:function(e,t){t||(t={});var r=this.readers[e.namespaceURI?this.namespaceAlias[e.namespaceURI]:this.defaultPrefix];if(r){var n=e.localName||e.nodeName.split(":").pop(),i=r[n]||r["*"];i&&i.apply(this,[e,t])}return t},readChildNodes:function(e,t){t||(t={});for(var r,n=e.childNodes,i=0,a=n.length;a>i;++i){r=n[i];1==r.nodeType&&this.readNode(r,t)}return t},writeNode:function(e,t,r){var n,i,a=e.indexOf(":");if(a>0){n=e.substring(0,a);i=e.substring(a+1)}else{n=r?this.namespaceAlias[r.namespaceURI]:this.defaultPrefix;i=e}var s=this.writers[n][i].apply(this,[t]);r&&r.appendChild(s);return s},getChildEl:function(e,t,r){return e&&this.getThisOrNextEl(e.firstChild,t,r)},getNextEl:function(e,t,r){return e&&this.getThisOrNextEl(e.nextSibling,t,r)},getThisOrNextEl:function(e,t,r){e:for(var n=e;n;n=n.nextSibling)switch(n.nodeType){case 1:if(!(t&&t!==(n.localName||n.nodeName.split(":").pop())||r&&r!==n.namespaceURI))break e;n=null;break e;case 3:if(/^\s*$/.test(n.nodeValue))break;case 4:case 6:case 12:case 10:case 11:n=null;break e}return n||null},lookupNamespaceURI:function(e,t){var r=null;if(e)if(e.lookupNamespaceURI)r=e.lookupNamespaceURI(t);else e:switch(e.nodeType){case 1:if(null!==e.namespaceURI&&e.prefix===t){r=e.namespaceURI;break e}var n=e.attributes.length;if(n)for(var i,a=0;n>a;++a){i=e.attributes[a];if("xmlns"===i.prefix&&i.name==="xmlns:"+t){r=i.value||null;break e}if("xmlns"===i.name&&null===t){r=i.value||null;break e}}r=this.lookupNamespaceURI(e.parentNode,t);break e;case 2:r=this.lookupNamespaceURI(e.ownerElement,t);break e;case 9:r=this.lookupNamespaceURI(e.documentElement,t);break e;case 6:case 12:case 10:case 11:break e;default:r=this.lookupNamespaceURI(e.parentNode,t)}return r},getXMLDoc:function(){OpenLayers.Format.XML.document||this.xmldom||(document.implementation&&document.implementation.createDocument?OpenLayers.Format.XML.document=document.implementation.createDocument("","",null):!this.xmldom&&window.ActiveXObject&&(this.xmldom=new ActiveXObject("Microsoft.XMLDOM")));return OpenLayers.Format.XML.document||this.xmldom},CLASS_NAME:"OpenLayers.Format.XML"});OpenLayers.Format.XML.CONTENT_TYPE={EMPTY:0,SIMPLE:1,COMPLEX:2,MIXED:3};OpenLayers.Format.XML.lookupNamespaceURI=OpenLayers.Function.bind(OpenLayers.Format.XML.prototype.lookupNamespaceURI,OpenLayers.Format.XML.prototype);OpenLayers.Format.XML.document=null;OpenLayers.Format.WFST=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Format.WFST.DEFAULTS);var t=OpenLayers.Format.WFST["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFST version: "+e.version;return new t(e)};OpenLayers.Format.WFST.DEFAULTS={version:"1.0.0"};OpenLayers.Feature=OpenLayers.Class({layer:null,id:null,lonlat:null,data:null,marker:null,popupClass:null,popup:null,initialize:function(e,t,r){this.layer=e;this.lonlat=t;this.data=null!=r?r:{};this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){null!=this.layer&&null!=this.layer.map&&null!=this.popup&&this.layer.map.removePopup(this.popup);null!=this.layer&&null!=this.marker&&this.layer.removeMarker(this.marker);this.layer=null;this.id=null;this.lonlat=null;this.data=null;if(null!=this.marker){this.destroyMarker(this.marker);this.marker=null}if(null!=this.popup){this.destroyPopup(this.popup);this.popup=null}},onScreen:function(){var e=!1;if(null!=this.layer&&null!=this.layer.map){var t=this.layer.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},createMarker:function(){null!=this.lonlat&&(this.marker=new OpenLayers.Marker(this.lonlat,this.data.icon));return this.marker},destroyMarker:function(){this.marker.destroy()},createPopup:function(e){if(null!=this.lonlat){if(!this.popup){var t=this.marker?this.marker.icon:null,r=this.popupClass?this.popupClass:OpenLayers.Popup.Anchored;this.popup=new r(this.id+"_popup",this.lonlat,this.data.popupSize,this.data.popupContentHTML,t,e)}null!=this.data.overflow&&(this.popup.contentDiv.style.overflow=this.data.overflow);this.popup.feature=this}return this.popup},destroyPopup:function(){if(this.popup){this.popup.feature=null;this.popup.destroy();this.popup=null}},CLASS_NAME:"OpenLayers.Feature"});OpenLayers.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};OpenLayers.Feature.Vector=OpenLayers.Class(OpenLayers.Feature,{fid:null,geometry:null,attributes:null,bounds:null,state:null,style:null,url:null,renderIntent:"default",modified:null,initialize:function(e,t,r){OpenLayers.Feature.prototype.initialize.apply(this,[null,null,t]);this.lonlat=null;this.geometry=e?e:null;this.state=null;this.attributes={};t&&(this.attributes=OpenLayers.Util.extend(this.attributes,t));this.style=r?r:null},destroy:function(){if(this.layer){this.layer.removeFeatures(this);this.layer=null}this.geometry=null;this.modified=null;OpenLayers.Feature.prototype.destroy.apply(this,arguments)},clone:function(){return new OpenLayers.Feature.Vector(this.geometry?this.geometry.clone():null,this.attributes,this.style)},onScreen:function(e){var t=!1;if(this.layer&&this.layer.map){var r=this.layer.map.getExtent();if(e){var n=this.geometry.getBounds();t=r.intersectsBounds(n)}else{var i=r.toGeometry();t=i.intersects(this.geometry)}}return t},getVisibility:function(){return!(this.style&&"none"==this.style.display||!this.layer||this.layer&&this.layer.styleMap&&"none"==this.layer.styleMap.createSymbolizer(this,this.renderIntent).display||this.layer&&!this.layer.getVisibility())},createMarker:function(){return null},destroyMarker:function(){},createPopup:function(){return null},atPoint:function(e,t,r){var n=!1;this.geometry&&(n=this.geometry.atPoint(e,t,r));return n},destroyPopup:function(){},move:function(e){if(!this.layer||!this.geometry.move)return void 0;var t;t="OpenLayers.LonLat"==e.CLASS_NAME?this.layer.getViewPortPxFromLonLat(e):e;var r=this.layer.getViewPortPxFromLonLat(this.geometry.getBounds().getCenterLonLat()),n=this.layer.map.getResolution();this.geometry.move(n*(t.x-r.x),n*(r.y-t.y));this.layer.drawFeature(this);return r},toState:function(e){if(e==OpenLayers.State.UPDATE)switch(this.state){case OpenLayers.State.UNKNOWN:case OpenLayers.State.DELETE:this.state=e;break;case OpenLayers.State.UPDATE:case OpenLayers.State.INSERT:}else if(e==OpenLayers.State.INSERT)switch(this.state){case OpenLayers.State.UNKNOWN:break;default:this.state=e}else if(e==OpenLayers.State.DELETE)switch(this.state){case OpenLayers.State.INSERT:break;case OpenLayers.State.DELETE:break;case OpenLayers.State.UNKNOWN:case OpenLayers.State.UPDATE:this.state=e}else e==OpenLayers.State.UNKNOWN&&(this.state=e)},CLASS_NAME:"OpenLayers.Feature.Vector"});OpenLayers.Feature.Vector.style={"default":{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},"delete":{display:"none"}};OpenLayers.Style=OpenLayers.Class({id:null,name:null,title:null,description:null,layerName:null,isDefault:!1,rules:null,context:null,defaultStyle:null,defaultsPerSymbolizer:!1,propertyStyles:null,initialize:function(e,t){OpenLayers.Util.extend(this,t);this.rules=[];t&&t.rules&&this.addRules(t.rules);this.setDefaultStyle(e||OpenLayers.Feature.Vector.style["default"]);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){for(var e=0,t=this.rules.length;t>e;e++){this.rules[e].destroy();this.rules[e]=null}this.rules=null;this.defaultStyle=null},createSymbolizer:function(e){for(var t,r=this.defaultsPerSymbolizer?{}:this.createLiterals(OpenLayers.Util.extend({},this.defaultStyle),e),n=this.rules,i=[],a=!1,s=0,o=n.length;o>s;s++){t=n[s];var l=t.evaluate(e);if(l)if(t instanceof OpenLayers.Rule&&t.elseFilter)i.push(t);else{a=!0;this.applySymbolizer(t,r,e)}}if(0==a&&i.length>0){a=!0;for(var s=0,o=i.length;o>s;s++)this.applySymbolizer(i[s],r,e)}n.length>0&&0==a&&(r.display="none");null!=r.label&&"string"!=typeof r.label&&(r.label=String(r.label));return r},applySymbolizer:function(e,t,r){var n=r.geometry?this.getSymbolizerPrefix(r.geometry):OpenLayers.Style.SYMBOLIZER_PREFIXES[0],i=e.symbolizer[n]||e.symbolizer;if(this.defaultsPerSymbolizer===!0){var a=this.defaultStyle;OpenLayers.Util.applyDefaults(i,{pointRadius:a.pointRadius});(i.stroke===!0||i.graphic===!0)&&OpenLayers.Util.applyDefaults(i,{strokeWidth:a.strokeWidth,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeDashstyle:a.strokeDashstyle,strokeLinecap:a.strokeLinecap});(i.fill===!0||i.graphic===!0)&&OpenLayers.Util.applyDefaults(i,{fillColor:a.fillColor,fillOpacity:a.fillOpacity});i.graphic===!0&&OpenLayers.Util.applyDefaults(i,{pointRadius:this.defaultStyle.pointRadius,externalGraphic:this.defaultStyle.externalGraphic,graphicName:this.defaultStyle.graphicName,graphicOpacity:this.defaultStyle.graphicOpacity,graphicWidth:this.defaultStyle.graphicWidth,graphicHeight:this.defaultStyle.graphicHeight,graphicXOffset:this.defaultStyle.graphicXOffset,graphicYOffset:this.defaultStyle.graphicYOffset})}return this.createLiterals(OpenLayers.Util.extend(t,i),r)},createLiterals:function(e,t){var r=OpenLayers.Util.extend({},t.attributes||t.data);OpenLayers.Util.extend(r,this.context);for(var n in this.propertyStyles)e[n]=OpenLayers.Style.createLiteral(e[n],r,t,n);return e},findPropertyStyles:function(){var e={},t=this.defaultStyle;this.addPropertyStyles(e,t);for(var r,n,i=this.rules,a=0,s=i.length;s>a;a++){r=i[a].symbolizer;for(var o in r){n=r[o];if("object"!=typeof n){this.addPropertyStyles(e,r);break}this.addPropertyStyles(e,n)}}return e},addPropertyStyles:function(e,t){var r;for(var n in t){r=t[n];"string"==typeof r&&r.match(/\$\{\w+\}/)&&(e[n]=!0)}return e},addRules:function(e){Array.prototype.push.apply(this.rules,e);this.propertyStyles=this.findPropertyStyles()},setDefaultStyle:function(e){this.defaultStyle=e;this.propertyStyles=this.findPropertyStyles()},getSymbolizerPrefix:function(e){for(var t=OpenLayers.Style.SYMBOLIZER_PREFIXES,r=0,n=t.length;n>r;r++)if(-1!=e.CLASS_NAME.indexOf(t[r]))return t[r]},clone:function(){var e=OpenLayers.Util.extend({},this);if(this.rules){e.rules=[];for(var t=0,r=this.rules.length;r>t;++t)e.rules.push(this.rules[t].clone())}e.context=this.context&&OpenLayers.Util.extend({},this.context);var n=OpenLayers.Util.extend({},this.defaultStyle);return new OpenLayers.Style(n,e)},CLASS_NAME:"OpenLayers.Style"});OpenLayers.Style.createLiteral=function(e,t,r,n){if("string"==typeof e&&-1!=e.indexOf("${")){e=OpenLayers.String.format(e,t,[r,n]);e=isNaN(e)||!e?e:parseFloat(e)}return e};OpenLayers.Style.SYMBOLIZER_PREFIXES=["Point","Line","Polygon","Text","Raster"];OpenLayers.Filter=OpenLayers.Class({initialize:function(e){OpenLayers.Util.extend(this,e)},destroy:function(){},evaluate:function(e){return!0},clone:function(){return null},toString:function(){var e;e=OpenLayers.Format&&OpenLayers.Format.CQL?OpenLayers.Format.CQL.prototype.write(this):Object.prototype.toString.call(this);return e},CLASS_NAME:"OpenLayers.Filter"});OpenLayers.Filter.Spatial=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,distance:null,distanceUnits:null,evaluate:function(e){var t=!1;switch(this.type){case OpenLayers.Filter.Spatial.BBOX:case OpenLayers.Filter.Spatial.INTERSECTS:if(e.geometry){var r=this.value;"OpenLayers.Bounds"==this.value.CLASS_NAME&&(r=this.value.toGeometry());e.geometry.intersects(r)&&(t=!0)}break;default:throw new Error("evaluate is not implemented for this filter type.")}return t},clone:function(){var e=OpenLayers.Util.applyDefaults({value:this.value&&this.value.clone&&this.value.clone()},this);return new OpenLayers.Filter.Spatial(e)},CLASS_NAME:"OpenLayers.Filter.Spatial"});OpenLayers.Filter.Spatial.BBOX="BBOX";OpenLayers.Filter.Spatial.INTERSECTS="INTERSECTS";OpenLayers.Filter.Spatial.DWITHIN="DWITHIN";OpenLayers.Filter.Spatial.WITHIN="WITHIN";OpenLayers.Filter.Spatial.CONTAINS="CONTAINS";OpenLayers.Filter.FeatureId=OpenLayers.Class(OpenLayers.Filter,{fids:null,type:"FID",initialize:function(e){this.fids=[];OpenLayers.Filter.prototype.initialize.apply(this,[e])},evaluate:function(e){for(var t=0,r=this.fids.length;r>t;t++){var n=e.fid||e.id;if(n==this.fids[t])return!0}return!1},clone:function(){var e=new OpenLayers.Filter.FeatureId;OpenLayers.Util.extend(e,this);e.fids=this.fids.slice();return e},CLASS_NAME:"OpenLayers.Filter.FeatureId"});OpenLayers.Format.WFST.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs",gml:"http://www.opengis.net/gml",ogc:"http://www.opengis.net/ogc",ows:"http://www.opengis.net/ows"},defaultPrefix:"wfs",version:null,schemaLocations:null,srsName:null,extractAttributes:!0,xy:!0,stateName:null,initialize:function(e){this.stateName={};this.stateName[OpenLayers.State.INSERT]="wfs:Insert";this.stateName[OpenLayers.State.UPDATE]="wfs:Update";this.stateName[OpenLayers.State.DELETE]="wfs:Delete";OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},getSrsName:function(e,t){var r=t&&t.srsName;r||(r=e&&e.layer?e.layer.projection.getCode():this.srsName);return r},read:function(e,t){t=t||{};OpenLayers.Util.applyDefaults(t,{output:"features"});"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var r={};e&&this.readNode(e,r,!0);r.features&&"features"===t.output&&(r=r.features);return r},readers:{wfs:{FeatureCollection:function(e,t){t.features=[];this.readChildNodes(e,t)}}},write:function(e,t){var r=this.writeNode("wfs:Transaction",{features:e,options:t}),n=this.schemaLocationAttr();n&&this.setAttributeNS(r,this.namespaces.xsi,"xsi:schemaLocation",n);return OpenLayers.Format.XML.prototype.write.apply(this,[r])},writers:{wfs:{GetFeature:function(e){var t=this.createElementNSPlus("wfs:GetFeature",{attributes:{service:"WFS",version:this.version,handle:e&&e.handle,outputFormat:e&&e.outputFormat,maxFeatures:e&&e.maxFeatures,"xsi:schemaLocation":this.schemaLocationAttr(e)}});if("string"==typeof this.featureType)this.writeNode("Query",e,t);else for(var r=0,n=this.featureType.length;n>r;r++){e.featureType=this.featureType[r];this.writeNode("Query",e,t)}return t},Transaction:function(e){e=e||{};var t,r,n=e.options||{},i=this.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version,handle:n.handle}}),a=e.features;if(a){n.multi===!0&&OpenLayers.Util.extend(this.geometryTypes,{"OpenLayers.Geometry.Point":"MultiPoint","OpenLayers.Geometry.LineString":this.multiCurve===!0?"MultiCurve":"MultiLineString","OpenLayers.Geometry.Polygon":this.multiSurface===!0?"MultiSurface":"MultiPolygon"});var s,o;for(t=0,r=a.length;r>t;++t){o=a[t];s=this.stateName[o.state];s&&this.writeNode(s,{feature:o,options:n},i)}n.multi===!0&&this.setGeometryTypes()}if(n.nativeElements)for(t=0,r=n.nativeElements.length;r>t;++t)this.writeNode("wfs:Native",n.nativeElements[t],i);return i},Native:function(e){var t=this.createElementNSPlus("wfs:Native",{attributes:{vendorId:e.vendorId,safeToIgnore:e.safeToIgnore},value:e.value});return t},Insert:function(e){var t=e.feature,r=e.options,n=this.createElementNSPlus("wfs:Insert",{attributes:{handle:r&&r.handle}});this.srsName=this.getSrsName(t);this.writeNode("feature:_typeName",t,n);return n},Update:function(e){var t=e.feature,r=e.options,n=this.createElementNSPlus("wfs:Update",{attributes:{handle:r&&r.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);var i=t.modified;if(null!==this.geometryName&&(!i||void 0!==i.geometry)){this.srsName=this.getSrsName(t);this.writeNode("Property",{name:this.geometryName,value:t.geometry},n)}for(var a in t.attributes)void 0===t.attributes[a]||i&&i.attributes&&(!i.attributes||void 0===i.attributes[a])||this.writeNode("Property",{name:a,value:t.attributes[a]},n);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n);return n},Property:function(e){var t=this.createElementNSPlus("wfs:Property");this.writeNode("Name",e.name,t);null!==e.value&&this.writeNode("Value",e.value,t);return t},Name:function(e){return this.createElementNSPlus("wfs:Name",{value:e})},Value:function(e){var t;if(e instanceof OpenLayers.Geometry){t=this.createElementNSPlus("wfs:Value");var r=this.writeNode("feature:_geometry",e).firstChild;t.appendChild(r)}else t=this.createElementNSPlus("wfs:Value",{value:e});return t},Delete:function(e){var t=e.feature,r=e.options,n=this.createElementNSPlus("wfs:Delete",{attributes:{handle:r&&r.handle,typeName:(this.featureNS?this.featurePrefix+":":"")+this.featureType}});this.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,this.featureNS);this.writeNode("ogc:Filter",new OpenLayers.Filter.FeatureId({fids:[t.fid]}),n);return n}}},schemaLocationAttr:function(e){e=OpenLayers.Util.extend({featurePrefix:this.featurePrefix,schema:this.schema},e);var t=OpenLayers.Util.extend({},this.schemaLocations);e.schema&&(t[e.featurePrefix]=e.schema);var r,n=[];for(var i in t){r=this.namespaces[i];r&&n.push(r+" "+t[i])}var a=n.join(" ")||void 0;return a},setFilterProperty:function(e){if(e.filters)for(var t=0,r=e.filters.length;r>t;++t)OpenLayers.Format.WFST.v1.prototype.setFilterProperty.call(this,e.filters[t]);else e instanceof OpenLayers.Filter.Spatial&&!e.property&&(e.property=this.geometryName)},CLASS_NAME:"OpenLayers.Format.WFST.v1"});OpenLayers.Format.OGCExceptionReport=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc"},regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},defaultPrefix:"ogc",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e.documentElement,r={exceptionReport:null};if(t){this.readChildNodes(e,r);null===r.exceptionReport&&(r=(new OpenLayers.Format.OWSCommon).read(e))}return r},readers:{ogc:{ServiceExceptionReport:function(e,t){t.exceptionReport={exceptions:[]};this.readChildNodes(e,t.exceptionReport)},ServiceException:function(e,t){var r={code:e.getAttribute("code"),locator:e.getAttribute("locator"),text:this.getChildValue(e)};t.exceptions.push(r)}}},CLASS_NAME:"OpenLayers.Format.OGCExceptionReport"});OpenLayers.Format.XML.VersionedOGC=OpenLayers.Class(OpenLayers.Format.XML,{defaultVersion:null,version:null,profile:null,allowFallback:!1,name:null,stringifyOutput:!1,parser:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);var t=this.CLASS_NAME;this.name=t.substring(t.lastIndexOf(".")+1)},getVersion:function(e,t){var r;if(e){r=this.version;if(!r){r=e.getAttribute("version");r||(r=this.defaultVersion)}}else r=t&&t.version||this.version||this.defaultVersion;return r},getParser:function(e){e=e||this.defaultVersion;var t=this.profile?"_"+this.profile:"";if(!this.parser||this.parser.VERSION!=e){var r=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")+t];if(!r){if(""!==t&&this.allowFallback){t="";r=OpenLayers.Format[this.name]["v"+e.replace(/\./g,"_")]}if(!r)throw"Can't find a "+this.name+" parser for version "+e+t}this.parser=new r(this.options)}return this.parser},write:function(e,t){var r=this.getVersion(null,t);this.parser=this.getParser(r);var n=this.parser.write(e,t);return this.stringifyOutput===!1?n:OpenLayers.Format.XML.prototype.write.apply(this,[n])},read:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var r=e.documentElement,n=this.getVersion(r);this.parser=this.getParser(n);var i=this.parser.read(e,t),a=this.parser.errorProperty||null;if(null!==a&&void 0===i[a]){var s=new OpenLayers.Format.OGCExceptionReport;i.error=s.read(e)}i.version=n;return i},CLASS_NAME:"OpenLayers.Format.XML.VersionedOGC"});OpenLayers.Filter.Logical=OpenLayers.Class(OpenLayers.Filter,{filters:null,type:null,initialize:function(e){this.filters=[];OpenLayers.Filter.prototype.initialize.apply(this,[e])},destroy:function(){this.filters=null;OpenLayers.Filter.prototype.destroy.apply(this)},evaluate:function(e){var t,r;switch(this.type){case OpenLayers.Filter.Logical.AND:for(t=0,r=this.filters.length;r>t;t++)if(0==this.filters[t].evaluate(e))return!1;return!0;case OpenLayers.Filter.Logical.OR:for(t=0,r=this.filters.length;r>t;t++)if(1==this.filters[t].evaluate(e))return!0;return!1;case OpenLayers.Filter.Logical.NOT:return!this.filters[0].evaluate(e)}return void 0},clone:function(){for(var e=[],t=0,r=this.filters.length;r>t;++t)e.push(this.filters[t].clone());return new OpenLayers.Filter.Logical({type:this.type,filters:e})},CLASS_NAME:"OpenLayers.Filter.Logical"});OpenLayers.Filter.Logical.AND="&&";OpenLayers.Filter.Logical.OR="||";OpenLayers.Filter.Logical.NOT="!";OpenLayers.Filter.Comparison=OpenLayers.Class(OpenLayers.Filter,{type:null,property:null,value:null,matchCase:!0,lowerBoundary:null,upperBoundary:null,initialize:function(e){OpenLayers.Filter.prototype.initialize.apply(this,[e]);this.type===OpenLayers.Filter.Comparison.LIKE&&void 0===e.matchCase&&(this.matchCase=null)},evaluate:function(e){e instanceof OpenLayers.Feature.Vector&&(e=e.attributes);var t,r=!1,n=e[this.property];switch(this.type){case OpenLayers.Filter.Comparison.EQUAL_TO:t=this.value;r=this.matchCase||"string"!=typeof n||"string"!=typeof t?n==t:n.toUpperCase()==t.toUpperCase();break;case OpenLayers.Filter.Comparison.NOT_EQUAL_TO:t=this.value;r=this.matchCase||"string"!=typeof n||"string"!=typeof t?n!=t:n.toUpperCase()!=t.toUpperCase();break;case OpenLayers.Filter.Comparison.LESS_THAN:r=n<this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN:r=n>this.value;break;case OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO:r=n<=this.value;break;case OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO:r=n>=this.value;break;case OpenLayers.Filter.Comparison.BETWEEN:r=n>=this.lowerBoundary&&n<=this.upperBoundary;break;case OpenLayers.Filter.Comparison.LIKE:var i=new RegExp(this.value,"gi");r=i.test(n);break;case OpenLayers.Filter.Comparison.IS_NULL:r=null===n}return r},value2regex:function(e,t,r){if("."==e)throw new Error("'.' is an unsupported wildCard character for OpenLayers.Filter.Comparison");e=e?e:"*";t=t?t:".";r=r?r:"!";this.value=this.value.replace(new RegExp("\\"+r+"(.|$)","g"),"\\$1");this.value=this.value.replace(new RegExp("\\"+t,"g"),".");this.value=this.value.replace(new RegExp("\\"+e,"g"),".*");this.value=this.value.replace(new RegExp("\\\\.\\*","g"),"\\"+e);this.value=this.value.replace(new RegExp("\\\\\\.","g"),"\\"+t);return this.value},regex2value:function(){var e=this.value;e=e.replace(/!/g,"!!");e=e.replace(/(\\)?\\\./g,function(e,t){return t?e:"!."});e=e.replace(/(\\)?\\\*/g,function(e,t){return t?e:"!*"});e=e.replace(/\\\\/g,"\\");e=e.replace(/\.\*/g,"*");return e},clone:function(){return OpenLayers.Util.extend(new OpenLayers.Filter.Comparison,this)},CLASS_NAME:"OpenLayers.Filter.Comparison"});OpenLayers.Filter.Comparison.EQUAL_TO="==";

OpenLayers.Filter.Comparison.NOT_EQUAL_TO="!=";OpenLayers.Filter.Comparison.LESS_THAN="<";OpenLayers.Filter.Comparison.GREATER_THAN=">";OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO="<=";OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO=">=";OpenLayers.Filter.Comparison.BETWEEN="..";OpenLayers.Filter.Comparison.LIKE="~";OpenLayers.Filter.Comparison.IS_NULL="NULL";OpenLayers.Format.Filter=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",CLASS_NAME:"OpenLayers.Format.Filter"});OpenLayers.Filter.Function=OpenLayers.Class(OpenLayers.Filter,{name:null,params:null,CLASS_NAME:"OpenLayers.Filter.Function"});OpenLayers.Date={dateRegEx:/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:(?:T(\d{1,2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(?:[+-]\d{1,2}(?::(\d{2}))?)))|Z)?$/,toISOString:function(){return"toISOString"in Date.prototype?function(e){return e.toISOString()}:function(e){var t;t=isNaN(e.getTime())?"Invalid Date":e.getUTCFullYear()+"-"+OpenLayers.Number.zeroPad(e.getUTCMonth()+1,2)+"-"+OpenLayers.Number.zeroPad(e.getUTCDate(),2)+"T"+OpenLayers.Number.zeroPad(e.getUTCHours(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCMinutes(),2)+":"+OpenLayers.Number.zeroPad(e.getUTCSeconds(),2)+"."+OpenLayers.Number.zeroPad(e.getUTCMilliseconds(),3)+"Z";return t}}(),parse:function(e){var t,r=e.match(this.dateRegEx);if(r&&(r[1]||r[7])){var n=parseInt(r[1],10)||0,i=parseInt(r[2],10)-1||0,a=parseInt(r[3],10)||1;t=new Date(Date.UTC(n,i,a));var s=r[7];if(s){var o=parseInt(r[4],10),l=parseInt(r[5],10),c=parseFloat(r[6]),u=0|c,p=Math.round(1e3*(c-u));t.setUTCHours(o,l,u,p);if("Z"!==s){var h=parseInt(s,10),d=parseInt(r[8],10)||0,f=-1e3*(3600*h+60*d);t=new Date(t.getTime()+f)}}}else t=new Date("invalid");return t}};OpenLayers.Format.Filter.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{ogc:"http://www.opengis.net/ogc",gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"ogc",schemaLocation:null,initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){var t={};this.readers.ogc.Filter.apply(this,[e,t]);return t.filter},readers:{ogc:{_expression:function(e){for(var t,r="",n=e.firstChild;n;n=n.nextSibling)switch(n.nodeType){case 1:t=this.readNode(n);t.property?r+="${"+t.property+"}":void 0!==t.value&&(r+=t.value);break;case 3:case 4:r+=n.nodeValue}return r},Filter:function(e,t){var r={fids:[],filters:[]};this.readChildNodes(e,r);r.fids.length>0?t.filter=new OpenLayers.Filter.FeatureId({fids:r.fids}):r.filters.length>0&&(t.filter=r.filters[0])},FeatureId:function(e,t){var r=e.getAttribute("fid");r&&t.fids.push(r)},And:function(e,t){var r=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND});this.readChildNodes(e,r);t.filters.push(r)},Or:function(e,t){var r=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR});this.readChildNodes(e,r);t.filters.push(r)},Not:function(e,t){var r=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.NOT});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsLessThan:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsGreaterThan:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsLessThanOrEqualTo:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LESS_THAN_OR_EQUAL_TO});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsGreaterThanOrEqualTo:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.GREATER_THAN_OR_EQUAL_TO});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsBetween:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.BETWEEN});this.readChildNodes(e,r);t.filters.push(r)},Literal:function(e,t){t.value=OpenLayers.String.numericIf(this.getChildValue(e),!0)},PropertyName:function(e,t){t.property=this.getChildValue(e)},LowerBoundary:function(e,t){t.lowerBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},UpperBoundary:function(e,t){t.upperBoundary=OpenLayers.String.numericIf(this.readers.ogc._expression.call(this,e),!0)},Intersects:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.INTERSECTS)},Within:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.WITHIN)},Contains:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.CONTAINS)},DWithin:function(e,t){this.readSpatial(e,t,OpenLayers.Filter.Spatial.DWITHIN)},Distance:function(e,t){t.distance=parseInt(this.getChildValue(e));t.distanceUnits=e.getAttribute("units")},Function:function(e,t){},PropertyIsNull:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.IS_NULL});this.readChildNodes(e,r);t.filters.push(r)}}},readSpatial:function(e,t,r){var n=new OpenLayers.Filter.Spatial({type:r});this.readChildNodes(e,n);n.value=n.components[0];delete n.components;t.filters.push(n)},encodeLiteral:function(e){e instanceof Date&&(e=OpenLayers.Date.toISOString(e));return e},writeOgcExpression:function(e,t){e instanceof OpenLayers.Filter.Function?this.writeNode("Function",e,t):this.writeNode("Literal",e,t);return t},write:function(e){return this.writers.ogc.Filter.apply(this,[e])},writers:{ogc:{Filter:function(e){var t=this.createElementNSPlus("ogc:Filter");this.writeNode(this.getFilterType(e),e,t);return t},_featureIds:function(e){for(var t=this.createDocumentFragment(),r=0,n=e.fids.length;n>r;++r)this.writeNode("ogc:FeatureId",e.fids[r],t);return t},FeatureId:function(e){return this.createElementNSPlus("ogc:FeatureId",{attributes:{fid:e}})},And:function(e){for(var t,r=this.createElementNSPlus("ogc:And"),n=0,i=e.filters.length;i>n;++n){t=e.filters[n];this.writeNode(this.getFilterType(t),t,r)}return r},Or:function(e){for(var t,r=this.createElementNSPlus("ogc:Or"),n=0,i=e.filters.length;i>n;++n){t=e.filters[n];this.writeNode(this.getFilterType(t),t,r)}return r},Not:function(e){var t=this.createElementNSPlus("ogc:Not"),r=e.filters[0];this.writeNode(this.getFilterType(r),r,t);return t},PropertyIsLessThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThan");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsGreaterThan:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThan");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLessThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLessThanOrEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsGreaterThanOrEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsGreaterThanOrEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsBetween:function(e){var t=this.createElementNSPlus("ogc:PropertyIsBetween");this.writeNode("PropertyName",e,t);this.writeNode("LowerBoundary",e,t);this.writeNode("UpperBoundary",e,t);return t},PropertyName:function(e){return this.createElementNSPlus("ogc:PropertyName",{value:e.property})},Literal:function(e){var t=this.encodeLiteral||OpenLayers.Format.Filter.v1.prototype.encodeLiteral;return this.createElementNSPlus("ogc:Literal",{value:t(e)})},LowerBoundary:function(e){var t=this.createElementNSPlus("ogc:LowerBoundary");this.writeOgcExpression(e.lowerBoundary,t);return t},UpperBoundary:function(e){var t=this.createElementNSPlus("ogc:UpperBoundary");this.writeNode("Literal",e.upperBoundary,t);return t},INTERSECTS:function(e){return this.writeSpatial(e,"Intersects")},WITHIN:function(e){return this.writeSpatial(e,"Within")},CONTAINS:function(e){return this.writeSpatial(e,"Contains")},DWITHIN:function(e){var t=this.writeSpatial(e,"DWithin");this.writeNode("Distance",e,t);return t},Distance:function(e){return this.createElementNSPlus("ogc:Distance",{attributes:{units:e.distanceUnits},value:e.distance})},Function:function(e){for(var t=this.createElementNSPlus("ogc:Function",{attributes:{name:e.name}}),r=e.params,n=0,i=r.length;i>n;n++)this.writeOgcExpression(r[n],t);return t},PropertyIsNull:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNull");this.writeNode("PropertyName",e,t);return t}}},getFilterType:function(e){var t=this.filterMap[e.type];if(!t)throw"Filter writing not supported for rule type: "+e.type;return t},filterMap:{"&&":"And","||":"Or","!":"Not","==":"PropertyIsEqualTo","!=":"PropertyIsNotEqualTo","<":"PropertyIsLessThan",">":"PropertyIsGreaterThan","<=":"PropertyIsLessThanOrEqualTo",">=":"PropertyIsGreaterThanOrEqualTo","..":"PropertyIsBetween","~":"PropertyIsLike",NULL:"PropertyIsNull",BBOX:"BBOX",DWITHIN:"DWITHIN",WITHIN:"WITHIN",CONTAINS:"CONTAINS",INTERSECTS:"INTERSECTS",FID:"_featureIds"},CLASS_NAME:"OpenLayers.Format.Filter.v1"});OpenLayers.Geometry=OpenLayers.Class({id:null,parent:null,bounds:null,initialize:function(){this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},destroy:function(){this.id=null;this.bounds=null},clone:function(){return new OpenLayers.Geometry},setBounds:function(e){e&&(this.bounds=e.clone())},clearBounds:function(){this.bounds=null;this.parent&&this.parent.clearBounds()},extendBounds:function(e){var t=this.getBounds();t?this.bounds.extend(e):this.setBounds(e)},getBounds:function(){null==this.bounds&&this.calculateBounds();return this.bounds},calculateBounds:function(){},distanceTo:function(e,t){},getVertices:function(e){},atPoint:function(e,t,r){var n=!1,i=this.getBounds();if(null!=i&&null!=e){var a=null!=t?t:0,s=null!=r?r:0,o=new OpenLayers.Bounds(this.bounds.left-a,this.bounds.bottom-s,this.bounds.right+a,this.bounds.top+s);n=o.containsLonLat(e)}return n},getLength:function(){return 0},getArea:function(){return 0},getCentroid:function(){return null},toString:function(){var e;e=OpenLayers.Format&&OpenLayers.Format.WKT?OpenLayers.Format.WKT.prototype.write(new OpenLayers.Feature.Vector(this)):Object.prototype.toString.call(this);return e},CLASS_NAME:"OpenLayers.Geometry"});OpenLayers.Geometry.fromWKT=function(e){var t;if(OpenLayers.Format&&OpenLayers.Format.WKT){var r=OpenLayers.Geometry.fromWKT.format;if(!r){r=new OpenLayers.Format.WKT;OpenLayers.Geometry.fromWKT.format=r}var n=r.read(e);if(n instanceof OpenLayers.Feature.Vector)t=n.geometry;else if(OpenLayers.Util.isArray(n)){for(var i=n.length,a=new Array(i),s=0;i>s;++s)a[s]=n[s].geometry;t=new OpenLayers.Geometry.Collection(a)}}return t};OpenLayers.Geometry.segmentsIntersect=function(e,t,r){var n=r&&r.point,i=r&&r.tolerance,a=!1,s=e.x1-t.x1,o=e.y1-t.y1,l=e.x2-e.x1,c=e.y2-e.y1,u=t.y2-t.y1,p=t.x2-t.x1,h=u*l-p*c,d=p*o-u*s,f=l*o-c*s;if(0==h)0==d&&0==f&&(a=!0);else{var m=d/h,y=f/h;if(m>=0&&1>=m&&y>=0&&1>=y)if(n){var g=e.x1+m*l,v=e.y1+m*c;a=new OpenLayers.Geometry.Point(g,v)}else a=!0}if(i){var C;if(a){if(n){var T,g,v,L=[e,t];e:for(var w=0;2>w;++w){T=L[w];for(var b=1;3>b;++b){g=T["x"+b];v=T["y"+b];C=Math.sqrt(Math.pow(g-a.x,2)+Math.pow(v-a.y,2));if(i>C){a.x=g;a.y=v;break e}}}}}else{var S,E,g,v,O,A,L=[e,t];e:for(var w=0;2>w;++w){S=L[w];E=L[(w+1)%2];for(var b=1;3>b;++b){O={x:S["x"+b],y:S["y"+b]};A=OpenLayers.Geometry.distanceToSegment(O,E);if(A.distance<i){a=n?new OpenLayers.Geometry.Point(O.x,O.y):!0;break e}}}}}return a};OpenLayers.Geometry.distanceToSegment=function(e,t){var r=OpenLayers.Geometry.distanceSquaredToSegment(e,t);r.distance=Math.sqrt(r.distance);return r};OpenLayers.Geometry.distanceSquaredToSegment=function(e,t){var r,n,i=e.x,a=e.y,s=t.x1,o=t.y1,l=t.x2,c=t.y2,u=l-s,p=c-o,h=(u*(i-s)+p*(a-o))/(Math.pow(u,2)+Math.pow(p,2));if(0>=h){r=s;n=o}else if(h>=1){r=l;n=c}else{r=s+h*u;n=o+h*p}return{distance:Math.pow(r-i,2)+Math.pow(n-a,2),x:r,y:n,along:h}};OpenLayers.Geometry.Point=OpenLayers.Class(OpenLayers.Geometry,{x:null,y:null,initialize:function(e,t){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.x=parseFloat(e);this.y=parseFloat(t)},clone:function(e){null==e&&(e=new OpenLayers.Geometry.Point(this.x,this.y));OpenLayers.Util.applyDefaults(e,this);return e},calculateBounds:function(){this.bounds=new OpenLayers.Bounds(this.x,this.y,this.x,this.y)},distanceTo:function(e,t){var r,n,i,a,s,o,l=!(t&&t.edge===!1),c=l&&t&&t.details;if(e instanceof OpenLayers.Geometry.Point){n=this.x;i=this.y;a=e.x;s=e.y;r=Math.sqrt(Math.pow(n-a,2)+Math.pow(i-s,2));o=c?{x0:n,y0:i,x1:a,y1:s,distance:r}:r}else{o=e.distanceTo(this,t);c&&(o={x0:o.x1,y0:o.y1,x1:o.x0,y1:o.y0,distance:o.distance})}return o},equals:function(e){var t=!1;null!=e&&(t=this.x==e.x&&this.y==e.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(e.x)&&isNaN(e.y));return t},toShortString:function(){return this.x+", "+this.y},move:function(e,t){this.x=this.x+e;this.y=this.y+t;this.clearBounds()},rotate:function(e,t){e*=Math.PI/180;var r=this.distanceTo(t),n=e+Math.atan2(this.y-t.y,this.x-t.x);this.x=t.x+r*Math.cos(n);this.y=t.y+r*Math.sin(n);this.clearBounds()},getCentroid:function(){return new OpenLayers.Geometry.Point(this.x,this.y)},resize:function(e,t,r){r=void 0==r?1:r;this.x=t.x+e*r*(this.x-t.x);this.y=t.y+e*(this.y-t.y);this.clearBounds();return this},intersects:function(e){var t=!1;t="OpenLayers.Geometry.Point"==e.CLASS_NAME?this.equals(e):e.intersects(this);return t},transform:function(e,t){if(e&&t){OpenLayers.Projection.transform(this,e,t);this.bounds=null}return this},getVertices:function(e){return[this]},CLASS_NAME:"OpenLayers.Geometry.Point"});OpenLayers.Geometry.Collection=OpenLayers.Class(OpenLayers.Geometry,{components:null,componentTypes:null,initialize:function(e){OpenLayers.Geometry.prototype.initialize.apply(this,arguments);this.components=[];null!=e&&this.addComponents(e)},destroy:function(){this.components.length=0;this.components=null;OpenLayers.Geometry.prototype.destroy.apply(this,arguments)},clone:function(){for(var geometry=eval("new "+this.CLASS_NAME+"()"),i=0,len=this.components.length;len>i;i++)geometry.addComponent(this.components[i].clone());OpenLayers.Util.applyDefaults(geometry,this);return geometry},getComponentsString:function(){for(var e=[],t=0,r=this.components.length;r>t;t++)e.push(this.components[t].toShortString());return e.join(",")},calculateBounds:function(){this.bounds=null;var e=new OpenLayers.Bounds,t=this.components;if(t)for(var r=0,n=t.length;n>r;r++)e.extend(t[r].getBounds());null!=e.left&&null!=e.bottom&&null!=e.right&&null!=e.top&&this.setBounds(e)},addComponents:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,r=e.length;r>t;t++)this.addComponent(e[t])},addComponent:function(e,t){var r=!1;if(e&&(null==this.componentTypes||OpenLayers.Util.indexOf(this.componentTypes,e.CLASS_NAME)>-1)){if(null!=t&&t<this.components.length){var n=this.components.slice(0,t),i=this.components.slice(t,this.components.length);n.push(e);this.components=n.concat(i)}else this.components.push(e);e.parent=this;this.clearBounds();r=!0}return r},removeComponents:function(e){var t=!1;OpenLayers.Util.isArray(e)||(e=[e]);for(var r=e.length-1;r>=0;--r)t=this.removeComponent(e[r])||t;return t},removeComponent:function(e){OpenLayers.Util.removeItem(this.components,e);this.clearBounds();return!0},getLength:function(){for(var e=0,t=0,r=this.components.length;r>t;t++)e+=this.components[t].getLength();return e},getArea:function(){for(var e=0,t=0,r=this.components.length;r>t;t++)e+=this.components[t].getArea();return e},getGeodesicArea:function(e){for(var t=0,r=0,n=this.components.length;n>r;r++)t+=this.components[r].getGeodesicArea(e);return t},getCentroid:function(e){if(!e)return this.components.length&&this.components[0].getCentroid();var t=this.components.length;if(!t)return!1;for(var r,n=[],i=[],a=0,s=Number.MAX_VALUE,o=0;t>o;++o){r=this.components[o];var l=r.getArea(),c=r.getCentroid(!0);if(!(isNaN(l)||isNaN(c.x)||isNaN(c.y))){n.push(l);a+=l;s=s>l&&l>0?l:s;i.push(c)}}t=n.length;if(0===a){for(var o=0;t>o;++o)n[o]=1;a=n.length}else{for(var o=0;t>o;++o)n[o]/=s;a/=s}for(var c,l,u=0,p=0,o=0;t>o;++o){c=i[o];l=n[o];u+=c.x*l;p+=c.y*l}return new OpenLayers.Geometry.Point(u/a,p/a)},getGeodesicLength:function(e){for(var t=0,r=0,n=this.components.length;n>r;r++)t+=this.components[r].getGeodesicLength(e);return t},move:function(e,t){for(var r=0,n=this.components.length;n>r;r++)this.components[r].move(e,t)},rotate:function(e,t){for(var r=0,n=this.components.length;n>r;++r)this.components[r].rotate(e,t)},resize:function(e,t,r){for(var n=0;n<this.components.length;++n)this.components[n].resize(e,t,r);return this},distanceTo:function(e,t){for(var r,n,i,a=!(t&&t.edge===!1),s=a&&t&&t.details,o=Number.POSITIVE_INFINITY,l=0,c=this.components.length;c>l;++l){r=this.components[l].distanceTo(e,t);i=s?r.distance:r;if(o>i){o=i;n=r;if(0==o)break}}return n},equals:function(e){var t=!0;if(e&&e.CLASS_NAME&&this.CLASS_NAME==e.CLASS_NAME)if(OpenLayers.Util.isArray(e.components)&&e.components.length==this.components.length){for(var r=0,n=this.components.length;n>r;++r)if(!this.components[r].equals(e.components[r])){t=!1;break}}else t=!1;else t=!1;return t},transform:function(e,t){if(e&&t){for(var r=0,n=this.components.length;n>r;r++){var i=this.components[r];i.transform(e,t)}this.bounds=null}return this},intersects:function(e){for(var t=!1,r=0,n=this.components.length;n>r;++r){t=e.intersects(this.components[r]);if(t)break}return t},getVertices:function(e){for(var t=[],r=0,n=this.components.length;n>r;++r)Array.prototype.push.apply(t,this.components[r].getVertices(e));return t},CLASS_NAME:"OpenLayers.Geometry.Collection"});OpenLayers.Geometry.MultiPoint=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Point"],addPoint:function(e,t){this.addComponent(e,t)},removePoint:function(e){this.removeComponent(e)},CLASS_NAME:"OpenLayers.Geometry.MultiPoint"});OpenLayers.Geometry.Curve=OpenLayers.Class(OpenLayers.Geometry.MultiPoint,{componentTypes:["OpenLayers.Geometry.Point"],getLength:function(){var e=0;if(this.components&&this.components.length>1)for(var t=1,r=this.components.length;r>t;t++)e+=this.components[t-1].distanceTo(this.components[t]);return e},getGeodesicLength:function(e){var t=this;if(e){var r=new OpenLayers.Projection("EPSG:4326");r.equals(e)||(t=this.clone().transform(e,r))}var n=0;if(t.components&&t.components.length>1)for(var i,a,s=1,o=t.components.length;o>s;s++){i=t.components[s-1];a=t.components[s];n+=OpenLayers.Util.distVincenty({lon:i.x,lat:i.y},{lon:a.x,lat:a.y})}return 1e3*n},CLASS_NAME:"OpenLayers.Geometry.Curve"});OpenLayers.Geometry.LineString=OpenLayers.Class(OpenLayers.Geometry.Curve,{removeComponent:function(e){var t=this.components&&this.components.length>2;t&&OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);return t},intersects:function(e){var t=!1,r=e.CLASS_NAME;if("OpenLayers.Geometry.LineString"==r||"OpenLayers.Geometry.LinearRing"==r||"OpenLayers.Geometry.Point"==r){var n,i=this.getSortedSegments();n="OpenLayers.Geometry.Point"==r?[{x1:e.x,y1:e.y,x2:e.x,y2:e.y}]:e.getSortedSegments();var a,s,o,l,c,u,p,h;e:for(var d=0,f=i.length;f>d;++d){a=i[d];s=a.x1;o=a.x2;l=a.y1;c=a.y2;for(var m=0,y=n.length;y>m;++m){u=n[m];if(u.x1>o)break;if(!(u.x2<s)){p=u.y1;h=u.y2;if(!(Math.min(p,h)>Math.max(l,c)||Math.max(p,h)<Math.min(l,c)||!OpenLayers.Geometry.segmentsIntersect(a,u))){t=!0;break e}}}}}else t=e.intersects(this);return t},getSortedSegments:function(){function e(e,t){return e.x1-t.x1}for(var t,r,n=this.components.length-1,i=new Array(n),a=0;n>a;++a){t=this.components[a];r=this.components[a+1];i[a]=t.x<r.x?{x1:t.x,y1:t.y,x2:r.x,y2:r.y}:{x1:r.x,y1:r.y,x2:t.x,y2:t.y}}return i.sort(e)},splitWithSegment:function(e,t){for(var r,n,i,a,s,o=!(t&&t.edge===!1),l=t&&t.tolerance,c=[],u=this.getVertices(),p=[],h=[],d=!1,f={point:!0,tolerance:l},m=null,y=0,g=u.length-2;g>=y;++y){r=u[y];p.push(r.clone());n=u[y+1];s={x1:r.x,y1:r.y,x2:n.x,y2:n.y};i=OpenLayers.Geometry.segmentsIntersect(e,s,f);if(i instanceof OpenLayers.Geometry.Point){a=i.x===e.x1&&i.y===e.y1||i.x===e.x2&&i.y===e.y2||i.equals(r)||i.equals(n)?!0:!1;if(a||o){i.equals(h[h.length-1])||h.push(i.clone());if(0===y&&i.equals(r))continue;if(i.equals(n))continue;d=!0;i.equals(r)||p.push(i);c.push(new OpenLayers.Geometry.LineString(p));p=[i.clone()]}}}if(d){p.push(n.clone());c.push(new OpenLayers.Geometry.LineString(p))}if(h.length>0){var v=e.x1<e.x2?1:-1,C=e.y1<e.y2?1:-1;m={lines:c,points:h.sort(function(e,t){return v*e.x-v*t.x||C*e.y-C*t.y})}}return m},split:function(e,t){var r,n,i,a,s=null,o=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){var l,c,u,p,h,d,f=this.getVertices(),m=[];i=[];for(var y=0,g=f.length-2;g>=y;++y){l=f[y];c=f[y+1];u={x1:l.x,y1:l.y,x2:c.x,y2:c.y};a=a||[e];o&&m.push(l.clone());for(var v=0;v<a.length;++v){p=a[v].splitWithSegment(u,t);if(p){h=p.lines;if(h.length>0){h.unshift(v,1);Array.prototype.splice.apply(a,h);v+=h.length-2}if(o)for(var C=0,T=p.points.length;T>C;++C){d=p.points[C];if(!d.equals(l)){m.push(d);i.push(new OpenLayers.Geometry.LineString(m));m=d.equals(c)?[]:[d.clone()]}}}}}if(o&&i.length>0&&m.length>0){m.push(c.clone());i.push(new OpenLayers.Geometry.LineString(m))}}else s=e.splitWith(this,t);a&&a.length>1?n=!0:a=[];i&&i.length>1?r=!0:i=[];(n||r)&&(s=o?[i,a]:a);return s},splitWith:function(e,t){return e.split(this,t)},getVertices:function(e){var t;t=e===!0?[this.components[0],this.components[this.components.length-1]]:e===!1?this.components.slice(1,this.components.length-1):this.components.slice();return t},distanceTo:function(e,t){var r,n=!(t&&t.edge===!1),i=n&&t&&t.details,a={},s=Number.POSITIVE_INFINITY;if(e instanceof OpenLayers.Geometry.Point){for(var o,l=this.getSortedSegments(),c=e.x,u=e.y,p=0,h=l.length;h>p;++p){o=l[p];r=OpenLayers.Geometry.distanceToSegment(e,o);if(r.distance<s){s=r.distance;a=r;if(0===s)break}else if(o.x2>c&&(u>o.y1&&u<o.y2||u<o.y1&&u>o.y2))break}a=i?{distance:a.distance,x0:a.x,y0:a.y,x1:c,y1:u}:a.distance}else if(e instanceof OpenLayers.Geometry.LineString){var d,f,m,y,g,v=this.getSortedSegments(),C=e.getSortedSegments(),T=C.length,L={point:!0};e:for(var p=0,h=v.length;h>p;++p){d=v[p];y=d.x1;g=d.y1;for(var w=0;T>w;++w){f=C[w];m=OpenLayers.Geometry.segmentsIntersect(d,f,L);if(m){s=0;a={distance:0,x0:m.x,y0:m.y,x1:m.x,y1:m.y};break e}r=OpenLayers.Geometry.distanceToSegment({x:y,y:g},f);if(r.distance<s){s=r.distance;a={distance:s,x0:y,y0:g,x1:r.x,y1:r.y}}}}i||(a=a.distance);if(0!==s&&d){r=e.distanceTo(new OpenLayers.Geometry.Point(d.x2,d.y2),t);var b=i?r.distance:r;s>b&&(a=i?{distance:s,x0:r.x1,y0:r.y1,x1:r.x0,y1:r.y0}:b)}}else{a=e.distanceTo(this,t);i&&(a={distance:a.distance,x0:a.x1,y0:a.y1,x1:a.x0,y1:a.y0})}return a},simplify:function(e){if(this&&null!==this){var t=this.getVertices();if(t.length<3)return this;var r=function(e,t){return e-t},n=function(e,t,r,a){for(var s,l=0,c=0,u=t;r>u;u++){s=i(e[t],e[r],e[u]);if(s>l){l=s;c=u}}if(l>a&&c!=t){o.push(c);n(e,t,c,a);n(e,c,r,a)}},i=function(e,t,r){var n=Math.abs(.5*(e.x*t.y+t.x*r.y+r.x*e.y-t.x*e.y-r.x*t.y-e.x*r.y)),i=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),a=n/i*2;return a},a=0,s=t.length-1,o=[];o.push(a);o.push(s);for(;t[a].equals(t[s]);){s--;o.push(s)}n(t,a,s,e);var l=[];o.sort(r);for(var c=0;c<o.length;c++)l.push(t[o[c]]);return new OpenLayers.Geometry.LineString(l)}return this},CLASS_NAME:"OpenLayers.Geometry.LineString"});OpenLayers.Geometry.MultiLineString=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LineString"],split:function(e,t){for(var r,n,i,a,s,o=null,l=t&&t.mutual,c=[],u=[e],p=0,h=this.components.length;h>p;++p){n=this.components[p];a=!1;for(var d=0;d<u.length;++d){r=n.split(u[d],t);if(r){if(l){i=r[0];for(var f=0,m=i.length;m>f;++f)0===f&&c.length?c[c.length-1].addComponent(i[f]):c.push(new OpenLayers.Geometry.MultiLineString([i[f]]));a=!0;r=r[1]}if(r.length){r.unshift(d,1);Array.prototype.splice.apply(u,r);break}}}a||(c.length?c[c.length-1].addComponent(n.clone()):c=[new OpenLayers.Geometry.MultiLineString(n.clone())])}c&&c.length>1?a=!0:c=[];u&&u.length>1?s=!0:u=[];(a||s)&&(o=l?[c,u]:u);return o},splitWith:function(e,t){var r,n,i,a,s,o,l,c=null,u=t&&t.mutual;if(e instanceof OpenLayers.Geometry.LineString){l=[];o=[e];for(var p=0,h=this.components.length;h>p;++p){s=!1;n=this.components[p];for(var d=0;d<o.length;++d){r=o[d].split(n,t);if(r){if(u){i=r[0];if(i.length){i.unshift(d,1);Array.prototype.splice.apply(o,i);d+=i.length-2}r=r[1];0===r.length&&(r=[n.clone()])}for(var f=0,m=r.length;m>f;++f)0===f&&l.length?l[l.length-1].addComponent(r[f]):l.push(new OpenLayers.Geometry.MultiLineString([r[f]]));s=!0}}s||(l.length?l[l.length-1].addComponent(n.clone()):l=[new OpenLayers.Geometry.MultiLineString([n.clone()])])}}else c=e.split(this);o&&o.length>1?a=!0:o=[];l&&l.length>1?s=!0:l=[];(a||s)&&(c=u?[o,l]:l);return c},CLASS_NAME:"OpenLayers.Geometry.MultiLineString"});OpenLayers.Geometry.LinearRing=OpenLayers.Class(OpenLayers.Geometry.LineString,{componentTypes:["OpenLayers.Geometry.Point"],addComponent:function(e,t){var r=!1,n=this.components.pop();null==t&&e.equals(n)||(r=OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,arguments));var i=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[i]);return r},removeComponent:function(e){var t=this.components&&this.components.length>3;if(t){this.components.pop();OpenLayers.Geometry.Collection.prototype.removeComponent.apply(this,arguments);var r=this.components[0];OpenLayers.Geometry.Collection.prototype.addComponent.apply(this,[r])}return t},move:function(e,t){for(var r=0,n=this.components.length;n-1>r;r++)this.components[r].move(e,t)},rotate:function(e,t){for(var r=0,n=this.components.length;n-1>r;++r)this.components[r].rotate(e,t)},resize:function(e,t,r){for(var n=0,i=this.components.length;i-1>n;++n)this.components[n].resize(e,t,r);return this},transform:function(e,t){if(e&&t){for(var r=0,n=this.components.length;n-1>r;r++){var i=this.components[r];i.transform(e,t)}this.bounds=null}return this},getCentroid:function(){if(this.components){var e=this.components.length;if(e>0&&2>=e)return this.components[0].clone();if(e>2){var t=0,r=0,n=this.components[0].x,i=this.components[0].y,a=-1*this.getArea();if(0!=a){for(var s=0;e-1>s;s++){var o=this.components[s],l=this.components[s+1];t+=(o.x+l.x-2*n)*((o.x-n)*(l.y-i)-(l.x-n)*(o.y-i));r+=(o.y+l.y-2*i)*((o.x-n)*(l.y-i)-(l.x-n)*(o.y-i))}var c=n+t/(6*a),u=i+r/(6*a)}else{for(var s=0;e-1>s;s++){t+=this.components[s].x;r+=this.components[s].y}var c=t/(e-1),u=r/(e-1)}return new OpenLayers.Geometry.Point(c,u)}return null}},getArea:function(){var e=0;if(this.components&&this.components.length>2){for(var t=0,r=0,n=this.components.length;n-1>r;r++){var i=this.components[r],a=this.components[r+1];t+=(i.x+a.x)*(a.y-i.y)}e=-t/2}return e},getGeodesicArea:function(e){var t=this;if(e){var r=new OpenLayers.Projection("EPSG:4326");r.equals(e)||(t=this.clone().transform(e,r))}var n=0,i=t.components&&t.components.length;if(i>2){for(var a,s,o=0;i-1>o;o++){a=t.components[o];s=t.components[o+1];n+=OpenLayers.Util.rad(s.x-a.x)*(2+Math.sin(OpenLayers.Util.rad(a.y))+Math.sin(OpenLayers.Util.rad(s.y)))}n=6378137*n*6378137/2}return n},containsPoint:function(e){function t(e,t,r,n,i){return(e-i)*((n-t)/(i-r))+n}for(var r,n,i,a,s,o,l,c=OpenLayers.Number.limitSigDigs,u=14,p=c(e.x,u),h=c(e.y,u),d=this.components.length-1,f=0,m=0;d>m;++m){r=this.components[m];i=c(r.x,u);a=c(r.y,u);n=this.components[m+1];s=c(n.x,u);o=c(n.y,u);if(a!=o){l=c(t(h,i,a,s,o),u);if(l==p&&(o>a&&h>=a&&o>=h||a>o&&a>=h&&h>=o)){f=-1;break}p>=l||i!=s&&(l<Math.min(i,s)||l>Math.max(i,s))||(o>a&&h>=a&&o>h||a>o&&a>h&&h>=o)&&++f}else if(h==a&&(s>=i&&p>=i&&s>=p||i>=s&&i>=p&&p>=s)){f=-1;break}}var y=-1==f?1:!!(1&f);return y},intersects:function(e){var t=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)t=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME)t=e.intersects(this);else if("OpenLayers.Geometry.LinearRing"==e.CLASS_NAME)t=OpenLayers.Geometry.LineString.prototype.intersects.apply(this,[e]);else for(var r=0,n=e.components.length;n>r;++r){t=e.components[r].intersects(this);if(t)break}return t},getVertices:function(e){return e===!0?[]:this.components.slice(0,this.components.length-1)},CLASS_NAME:"OpenLayers.Geometry.LinearRing"});OpenLayers.Geometry.Polygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.LinearRing"],getArea:function(){var e=0;if(this.components&&this.components.length>0){e+=Math.abs(this.components[0].getArea());for(var t=1,r=this.components.length;r>t;t++)e-=Math.abs(this.components[t].getArea())}return e},getGeodesicArea:function(e){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getGeodesicArea(e));for(var r=1,n=this.components.length;n>r;r++)t-=Math.abs(this.components[r].getGeodesicArea(e))}return t},containsPoint:function(e){var t=this.components.length,r=!1;if(t>0){r=this.components[0].containsPoint(e);if(1!==r&&r&&t>1)for(var n,i=1;t>i;++i){n=this.components[i].containsPoint(e);if(n){r=1===n?1:!1;break}}}return r},intersects:function(e){var t,r,n=!1;if("OpenLayers.Geometry.Point"==e.CLASS_NAME)n=this.containsPoint(e);else if("OpenLayers.Geometry.LineString"==e.CLASS_NAME||"OpenLayers.Geometry.LinearRing"==e.CLASS_NAME){for(t=0,r=this.components.length;r>t;++t){n=e.intersects(this.components[t]);if(n)break}if(!n)for(t=0,r=e.components.length;r>t;++t){n=this.containsPoint(e.components[t]);if(n)break}}else for(t=0,r=e.components.length;r>t;++t){n=this.intersects(e.components[t]);if(n)break}if(!n&&"OpenLayers.Geometry.Polygon"==e.CLASS_NAME){var i=this.components[0];for(t=0,r=i.components.length;r>t;++t){n=e.containsPoint(i.components[t]);if(n)break}}return n},distanceTo:function(e,t){var r,n=!(t&&t.edge===!1);r=!n&&this.intersects(e)?0:OpenLayers.Geometry.Collection.prototype.distanceTo.apply(this,[e,t]);return r},CLASS_NAME:"OpenLayers.Geometry.Polygon"});OpenLayers.Geometry.Polygon.createRegularPolygon=function(e,t,r,n){var i=Math.PI*(1/r-.5);n&&(i+=n/180*Math.PI);for(var a,s,o,l=[],c=0;r>c;++c){a=i+2*c*Math.PI/r;s=e.x+t*Math.cos(a);o=e.y+t*Math.sin(a);l.push(new OpenLayers.Geometry.Point(s,o))}var u=new OpenLayers.Geometry.LinearRing(l);return new OpenLayers.Geometry.Polygon([u])};OpenLayers.Geometry.MultiPolygon=OpenLayers.Class(OpenLayers.Geometry.Collection,{componentTypes:["OpenLayers.Geometry.Polygon"],CLASS_NAME:"OpenLayers.Geometry.MultiPolygon"});OpenLayers.Format.GML=OpenLayers.Class(OpenLayers.Format.XML,{featureNS:"http://mapserver.gis.umn.edu/mapserver",featurePrefix:"feature",featureName:"featureMember",layerName:"features",geometryName:"geometry",collectionName:"FeatureCollection",gmlns:"http://www.opengis.net/gml",extractAttributes:!0,xy:!0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g};OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var t=this.getElementsByTagNameNS(e.documentElement,this.gmlns,this.featureName),r=[],n=0;n<t.length;n++){var i=this.parseFeature(t[n]);i&&r.push(i)}return r},parseFeature:function(e){for(var t,r,n,i,a=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],s=0;s<a.length;++s){t=a[s];r=this.getElementsByTagNameNS(e,this.gmlns,t);if(r.length>0){i=this.parseGeometry[t.toLowerCase()];if(!i)throw new TypeError("Unsupported geometry type: "+t);n=i.apply(this,[r[0]]);this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}}var o,l=this.getElementsByTagNameNS(e,this.gmlns,"Box");for(s=0;s<l.length;++s){var c=l[s],u=this.parseGeometry.box.apply(this,[c]),p=c.parentNode,h=p.localName||p.nodeName.split(":").pop();"boundedBy"===h?o=u:n=u.toGeometry()}var d;this.extractAttributes&&(d=this.parseAttributes(e));var f=new OpenLayers.Feature.Vector(n,d);f.bounds=o;f.gml={featureType:e.firstChild.nodeName.split(":")[1],featureNS:e.firstChild.namespaceURI,
featureNSPrefix:e.firstChild.prefix};for(var m,y=e.firstChild;y;){if(1==y.nodeType){m=y.getAttribute("fid")||y.getAttribute("id");if(m)break}y=y.nextSibling}f.fid=m;return f},parseGeometry:{point:function(e){var t,r,n=[],t=this.getElementsByTagNameNS(e,this.gmlns,"pos");if(t.length>0){r=t[0].firstChild.nodeValue;r=r.replace(this.regExes.trimSpace,"");n=r.split(this.regExes.splitSpace)}if(0==n.length){t=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");if(t.length>0){r=t[0].firstChild.nodeValue;r=r.replace(this.regExes.removeSpace,"");n=r.split(",")}}if(0==n.length){t=this.getElementsByTagNameNS(e,this.gmlns,"coord");if(t.length>0){var i=this.getElementsByTagNameNS(t[0],this.gmlns,"X"),a=this.getElementsByTagNameNS(t[0],this.gmlns,"Y");i.length>0&&a.length>0&&(n=[i[0].firstChild.nodeValue,a[0].firstChild.nodeValue])}}2==n.length&&(n[2]=null);return this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])},multipoint:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Point"),r=[];if(t.length>0)for(var n,i=0;i<t.length;++i){n=this.parseGeometry.point.apply(this,[t[i]]);n&&r.push(n)}return new OpenLayers.Geometry.MultiPoint(r)},linestring:function(e,t){var r,n,i=[],a=[];r=this.getElementsByTagNameNS(e,this.gmlns,"posList");if(r.length>0){n=this.getChildValue(r[0]);n=n.replace(this.regExes.trimSpace,"");i=n.split(this.regExes.splitSpace);for(var s,o,l,c,u=parseInt(r[0].getAttribute("dimension")),p=0;p<i.length/u;++p){s=p*u;o=i[s];l=i[s+1];c=2==u?null:i[s+2];a.push(this.xy?new OpenLayers.Geometry.Point(o,l,c):new OpenLayers.Geometry.Point(l,o,c))}}if(0==i.length){r=this.getElementsByTagNameNS(e,this.gmlns,"coordinates");if(r.length>0){n=this.getChildValue(r[0]);n=n.replace(this.regExes.trimSpace,"");n=n.replace(this.regExes.trimComma,",");for(var h=n.split(this.regExes.splitSpace),p=0;p<h.length;++p){i=h[p].split(",");2==i.length&&(i[2]=null);a.push(this.xy?new OpenLayers.Geometry.Point(i[0],i[1],i[2]):new OpenLayers.Geometry.Point(i[1],i[0],i[2]))}}}var d=null;0!=a.length&&(d=t?new OpenLayers.Geometry.LinearRing(a):new OpenLayers.Geometry.LineString(a));return d},multilinestring:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LineString"),r=[];if(t.length>0)for(var n,i=0;i<t.length;++i){n=this.parseGeometry.linestring.apply(this,[t[i]]);n&&r.push(n)}return new OpenLayers.Geometry.MultiLineString(r)},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"LinearRing"),r=[];if(t.length>0)for(var n,i=0;i<t.length;++i){n=this.parseGeometry.linestring.apply(this,[t[i],!0]);n&&r.push(n)}return new OpenLayers.Geometry.Polygon(r)},multipolygon:function(e){var t=this.getElementsByTagNameNS(e,this.gmlns,"Polygon"),r=[];if(t.length>0)for(var n,i=0;i<t.length;++i){n=this.parseGeometry.polygon.apply(this,[t[i]]);n&&r.push(n)}return new OpenLayers.Geometry.MultiPolygon(r)},envelope:function(e){var t,r,n=[],i=this.getElementsByTagNameNS(e,this.gmlns,"lowerCorner");if(i.length>0){var a=[];if(i.length>0){t=i[0].firstChild.nodeValue;t=t.replace(this.regExes.trimSpace,"");a=t.split(this.regExes.splitSpace)}2==a.length&&(a[2]=null);if(this.xy)var s=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);else var s=new OpenLayers.Geometry.Point(a[1],a[0],a[2])}var o=this.getElementsByTagNameNS(e,this.gmlns,"upperCorner");if(o.length>0){var a=[];if(o.length>0){t=o[0].firstChild.nodeValue;t=t.replace(this.regExes.trimSpace,"");a=t.split(this.regExes.splitSpace)}2==a.length&&(a[2]=null);if(this.xy)var l=new OpenLayers.Geometry.Point(a[0],a[1],a[2]);else var l=new OpenLayers.Geometry.Point(a[1],a[0],a[2])}if(s&&l){n.push(new OpenLayers.Geometry.Point(s.x,s.y));n.push(new OpenLayers.Geometry.Point(l.x,s.y));n.push(new OpenLayers.Geometry.Point(l.x,l.y));n.push(new OpenLayers.Geometry.Point(s.x,l.y));n.push(new OpenLayers.Geometry.Point(s.x,s.y));var c=new OpenLayers.Geometry.LinearRing(n);r=new OpenLayers.Geometry.Polygon([c])}return r},box:function(e){var t,r,n=this.getElementsByTagNameNS(e,this.gmlns,"coordinates"),i=null,a=null;if(n.length>0){t=n[0].firstChild.nodeValue;r=t.split(" ");if(2==r.length){i=r[0].split(",");a=r[1].split(",")}}return null!==i&&null!==a?new OpenLayers.Bounds(parseFloat(i[0]),parseFloat(i[1]),parseFloat(a[0]),parseFloat(a[1])):void 0}},parseAttributes:function(e){for(var t,r,n,i,a,s,o,l={},c=e.firstChild;c;){if(1==c.nodeType){t=c.childNodes;for(r=0;r<t.length;++r){n=t[r];if(1==n.nodeType){i=n.childNodes;if(1==i.length){a=i[0];if(3==a.nodeType||4==a.nodeType){s=n.prefix?n.nodeName.split(":")[1]:n.nodeName;o=a.nodeValue.replace(this.regExes.trimSpace,"");l[s]=o}}else l[n.nodeName.split(":").pop()]=null}}break}c=c.nextSibling}return l},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS("http://www.opengis.net/wfs","wfs:"+this.collectionName),r=0;r<e.length;r++)t.appendChild(this.createFeatureXML(e[r]));return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFeatureXML:function(e){var t=e.geometry,r=this.buildGeometryNode(t),n=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.geometryName);n.appendChild(r);var i=this.createElementNS(this.gmlns,"gml:"+this.featureName),a=this.createElementNS(this.featureNS,this.featurePrefix+":"+this.layerName),s=e.fid||e.id;a.setAttribute("fid",s);a.appendChild(n);for(var o in e.attributes){var l=this.createTextNode(e.attributes[o]),c=o.substring(o.lastIndexOf(":")+1),u=this.createElementNS(this.featureNS,this.featurePrefix+":"+c);u.appendChild(l);a.appendChild(u)}i.appendChild(a);return i},buildGeometryNode:function(e){if(this.externalProjection&&this.internalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var t=e.CLASS_NAME,r=t.substring(t.lastIndexOf(".")+1),n=this.buildGeometry[r.toLowerCase()];return n.apply(this,[e])},buildGeometry:{point:function(e){var t=this.createElementNS(this.gmlns,"gml:Point");t.appendChild(this.buildCoordinatesNode(e));return t},multipoint:function(e){for(var t,r,n=this.createElementNS(this.gmlns,"gml:MultiPoint"),i=e.components,a=0;a<i.length;a++){t=this.createElementNS(this.gmlns,"gml:pointMember");r=this.buildGeometry.point.apply(this,[i[a]]);t.appendChild(r);n.appendChild(t)}return n},linestring:function(e){var t=this.createElementNS(this.gmlns,"gml:LineString");t.appendChild(this.buildCoordinatesNode(e));return t},multilinestring:function(e){for(var t,r,n=this.createElementNS(this.gmlns,"gml:MultiLineString"),i=e.components,a=0;a<i.length;++a){t=this.createElementNS(this.gmlns,"gml:lineStringMember");r=this.buildGeometry.linestring.apply(this,[i[a]]);t.appendChild(r);n.appendChild(t)}return n},linearring:function(e){var t=this.createElementNS(this.gmlns,"gml:LinearRing");t.appendChild(this.buildCoordinatesNode(e));return t},polygon:function(e){for(var t,r,n,i=this.createElementNS(this.gmlns,"gml:Polygon"),a=e.components,s=0;s<a.length;++s){n=0==s?"outerBoundaryIs":"innerBoundaryIs";t=this.createElementNS(this.gmlns,"gml:"+n);r=this.buildGeometry.linearring.apply(this,[a[s]]);t.appendChild(r);i.appendChild(t)}return i},multipolygon:function(e){for(var t,r,n=this.createElementNS(this.gmlns,"gml:MultiPolygon"),i=e.components,a=0;a<i.length;++a){t=this.createElementNS(this.gmlns,"gml:polygonMember");r=this.buildGeometry.polygon.apply(this,[i[a]]);t.appendChild(r);n.appendChild(t)}return n},bounds:function(e){var t=this.createElementNS(this.gmlns,"gml:Box");t.appendChild(this.buildCoordinatesNode(e));return t}},buildCoordinatesNode:function(e){var t=this.createElementNS(this.gmlns,"gml:coordinates");t.setAttribute("decimal",".");t.setAttribute("cs",",");t.setAttribute("ts"," ");var r=[];if(e instanceof OpenLayers.Bounds){r.push(e.left+","+e.bottom);r.push(e.right+","+e.top)}else for(var n=e.components?e.components:[e],i=0;i<n.length;i++)r.push(n[i].x+","+n[i].y);var a=this.createTextNode(r.join(" "));t.appendChild(a);return t},CLASS_NAME:"OpenLayers.Format.GML"});OpenLayers.Format.GML||(OpenLayers.Format.GML={});OpenLayers.Format.GML.Base=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{gml:"http://www.opengis.net/gml",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance",wfs:"http://www.opengis.net/wfs"},defaultPrefix:"gml",schemaLocation:null,featureType:null,featureNS:null,geometryName:"geometry",extractAttributes:!0,srsName:null,xy:!0,geometryTypes:null,singleFeatureType:null,regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,featureMember:/^(.*:)?featureMembers?$/},initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);this.setGeometryTypes();e&&e.featureNS&&this.setNamespace("feature",e.featureNS);this.singleFeatureType=!e||"string"==typeof e.featureType},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t=[];this.readNode(e,{features:t},!0);if(0==t.length){var r=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMember");if(r.length)for(var n=0,i=r.length;i>n;++n)this.readNode(r[n],{features:t},!0);else{var r=this.getElementsByTagNameNS(e,this.namespaces.gml,"featureMembers");r.length&&this.readNode(r[0],{features:t},!0)}}return t},readNode:function(e,t,r){if(r===!0&&this.autoConfig===!0){this.featureType=null;delete this.namespaceAlias[this.featureNS];delete this.namespaces.feature;this.featureNS=null}if(!this.featureNS&&!(e.prefix in this.namespaces)&&e.parentNode.namespaceURI==this.namespaces.gml&&this.regExes.featureMember.test(e.parentNode.nodeName)){this.featureType=e.nodeName.split(":").pop();this.setNamespace("feature",e.namespaceURI);this.featureNS=e.namespaceURI;this.autoConfig=!0}return OpenLayers.Format.XML.prototype.readNode.apply(this,[e,t])},readers:{gml:{_inherit:function(e,t,r){},featureMember:function(e,t){this.readChildNodes(e,t)},featureMembers:function(e,t){this.readChildNodes(e,t)},name:function(e,t){t.name=this.getChildValue(e)},boundedBy:function(e,t){var r={};this.readChildNodes(e,r);r.components&&r.components.length>0&&(t.bounds=r.components[0])},Point:function(e,t){var r={points:[]};this.readChildNodes(e,r);t.components||(t.components=[]);t.components.push(r.points[0])},coordinates:function(e,t){var r=this.getChildValue(e).replace(this.regExes.trimSpace,"");r=r.replace(this.regExes.trimComma,",");for(var n,i=r.split(this.regExes.splitSpace),a=i.length,s=new Array(a),o=0;a>o;++o){n=i[o].split(",");s[o]=this.xy?new OpenLayers.Geometry.Point(n[0],n[1],n[2]):new OpenLayers.Geometry.Point(n[1],n[0],n[2])}t.points=s},coord:function(e,t){var r={};this.readChildNodes(e,r);t.points||(t.points=[]);t.points.push(new OpenLayers.Geometry.Point(r.x,r.y,r.z))},X:function(e,t){t.x=this.getChildValue(e)},Y:function(e,t){t.y=this.getChildValue(e)},Z:function(e,t){t.z=this.getChildValue(e)},MultiPoint:function(e,t){var r={components:[]};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);t.components=[new OpenLayers.Geometry.MultiPoint(r.components)]},pointMember:function(e,t){this.readChildNodes(e,t)},LineString:function(e,t){var r={};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.LineString(r.points))},MultiLineString:function(e,t){var r={components:[]};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);t.components=[new OpenLayers.Geometry.MultiLineString(r.components)]},lineStringMember:function(e,t){this.readChildNodes(e,t)},Polygon:function(e,t){var r={outer:null,inner:[]};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);r.inner.unshift(r.outer);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.Polygon(r.inner))},LinearRing:function(e,t){var r={};this.readers.gml._inherit.apply(this,[e,r]);this.readChildNodes(e,r);t.components=[new OpenLayers.Geometry.LinearRing(r.points)]},MultiPolygon:function(e,t){var r={components:[]};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);t.components=[new OpenLayers.Geometry.MultiPolygon(r.components)]},polygonMember:function(e,t){this.readChildNodes(e,t)},GeometryCollection:function(e,t){var r={components:[]};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);t.components=[new OpenLayers.Geometry.Collection(r.components)]},geometryMember:function(e,t){this.readChildNodes(e,t)}},feature:{"*":function(e,t){var r,n=e.localName||e.nodeName.split(":").pop();t.features?this.singleFeatureType||-1===OpenLayers.Util.indexOf(this.featureType,n)?n===this.featureType&&(r="_typeName"):r="_typeName":0==e.childNodes.length||1==e.childNodes.length&&3==e.firstChild.nodeType?this.extractAttributes&&(r="_attribute"):r="_geometry";r&&this.readers.feature[r].apply(this,[e,t])},_typeName:function(e,t){var r={components:[],attributes:{}};this.readChildNodes(e,r);r.name&&(r.attributes.name=r.name);var n=new OpenLayers.Feature.Vector(r.components[0],r.attributes);if(!this.singleFeatureType){n.type=e.nodeName.split(":").pop();n.namespace=e.namespaceURI}var i=e.getAttribute("fid")||this.getAttributeNS(e,this.namespaces.gml,"id");i&&(n.fid=i);this.internalProjection&&this.externalProjection&&n.geometry&&n.geometry.transform(this.externalProjection,this.internalProjection);r.bounds&&(n.bounds=r.bounds);t.features.push(n)},_geometry:function(e,t){this.geometryName||(this.geometryName=e.nodeName.split(":").pop());this.readChildNodes(e,t)},_attribute:function(e,t){var r=e.localName||e.nodeName.split(":").pop(),n=this.getChildValue(e);t.attributes[r]=n}},wfs:{FeatureCollection:function(e,t){this.readChildNodes(e,t)}}},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var r=this.writeNode("gml:"+t,e);this.setAttributeNS(r,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[r])},writers:{gml:{featureMember:function(e){var t=this.createElementNSPlus("gml:featureMember");this.writeNode("feature:_typeName",e,t);return t},MultiPoint:function(e){for(var t=this.createElementNSPlus("gml:MultiPoint"),r=e.components||[e],n=0,i=r.length;i>n;++n)this.writeNode("pointMember",r[n],t);return t},pointMember:function(e){var t=this.createElementNSPlus("gml:pointMember");this.writeNode("Point",e,t);return t},MultiLineString:function(e){for(var t=this.createElementNSPlus("gml:MultiLineString"),r=e.components||[e],n=0,i=r.length;i>n;++n)this.writeNode("lineStringMember",r[n],t);return t},lineStringMember:function(e){var t=this.createElementNSPlus("gml:lineStringMember");this.writeNode("LineString",e,t);return t},MultiPolygon:function(e){for(var t=this.createElementNSPlus("gml:MultiPolygon"),r=e.components||[e],n=0,i=r.length;i>n;++n)this.writeNode("polygonMember",r[n],t);return t},polygonMember:function(e){var t=this.createElementNSPlus("gml:polygonMember");this.writeNode("Polygon",e,t);return t},GeometryCollection:function(e){for(var t=this.createElementNSPlus("gml:GeometryCollection"),r=0,n=e.components.length;n>r;++r)this.writeNode("geometryMember",e.components[r],t);return t},geometryMember:function(e){var t=this.createElementNSPlus("gml:geometryMember"),r=this.writeNode("feature:_geometry",e);t.appendChild(r.firstChild);return t}},feature:{_typeName:function(e){var t=this.createElementNSPlus("feature:"+this.featureType,{attributes:{fid:e.fid}});e.geometry&&this.writeNode("feature:_geometry",e.geometry,t);for(var r in e.attributes){var n=e.attributes[r];null!=n&&this.writeNode("feature:_attribute",{name:r,value:n},t)}return t},_geometry:function(e){this.externalProjection&&this.internalProjection&&(e=e.clone().transform(this.internalProjection,this.externalProjection));var t=this.createElementNSPlus("feature:"+this.geometryName),r=this.geometryTypes[e.CLASS_NAME],n=this.writeNode("gml:"+r,e,t);this.srsName&&n.setAttribute("srsName",this.srsName);return t},_attribute:function(e){return this.createElementNSPlus("feature:"+e.name,{value:e.value})}},wfs:{FeatureCollection:function(e){for(var t=this.createElementNSPlus("wfs:FeatureCollection"),r=0,n=e.length;n>r;++r)this.writeNode("gml:featureMember",e[r],t);return t}}},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":"LineString","OpenLayers.Geometry.MultiLineString":"MultiLineString","OpenLayers.Geometry.Polygon":"Polygon","OpenLayers.Geometry.MultiPolygon":"MultiPolygon","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.Base"});OpenLayers.Format.GML.v3=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",curve:!1,multiCurve:!0,surface:!1,multiSurface:!0,initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({_inherit:function(e,t,r){var n=parseInt(e.getAttribute("srsDimension"),10)||r&&r.srsDimension;n&&(t.srsDimension=n)},featureMembers:function(e,t){this.readChildNodes(e,t)},Curve:function(e,t){var r={points:[]};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);t.components||(t.components=[]);t.components.push(new OpenLayers.Geometry.LineString(r.points))},segments:function(e,t){this.readChildNodes(e,t)},LineStringSegment:function(e,t){var r={};this.readChildNodes(e,r);r.points&&Array.prototype.push.apply(t.points,r.points)},pos:function(e,t){var r,n=this.getChildValue(e).replace(this.regExes.trimSpace,""),i=n.split(this.regExes.splitSpace);r=this.xy?new OpenLayers.Geometry.Point(i[0],i[1],i[2]):new OpenLayers.Geometry.Point(i[1],i[0],i[2]);t.points=[r]},posList:function(e,t){for(var r,n,i,a=this.getChildValue(e).replace(this.regExes.trimSpace,""),s=a.split(this.regExes.splitSpace),o=t.srsDimension||parseInt(e.getAttribute("srsDimension")||e.getAttribute("dimension"),10)||2,l=s.length/o,c=new Array(l),u=0,p=s.length;p>u;u+=o){r=s[u];n=s[u+1];i=2==o?void 0:s[u+2];c[u/o]=this.xy?new OpenLayers.Geometry.Point(r,n,i):new OpenLayers.Geometry.Point(n,r,i)}t.points=c},Surface:function(e,t){this.readChildNodes(e,t)},patches:function(e,t){this.readChildNodes(e,t)},PolygonPatch:function(e,t){this.readers.gml.Polygon.apply(this,[e,t])},exterior:function(e,t){var r={};this.readChildNodes(e,r);t.outer=r.components[0]},interior:function(e,t){var r={};this.readChildNodes(e,r);t.inner.push(r.components[0])},MultiCurve:function(e,t){var r={components:[]};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);r.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiLineString(r.components)])},curveMember:function(e,t){this.readChildNodes(e,t)},MultiSurface:function(e,t){var r={components:[]};this.readers.gml._inherit.apply(this,[e,r,t]);this.readChildNodes(e,r);r.components.length>0&&(t.components=[new OpenLayers.Geometry.MultiPolygon(r.components)])},surfaceMember:function(e,t){this.readChildNodes(e,t)},surfaceMembers:function(e,t){this.readChildNodes(e,t)},pointMembers:function(e,t){this.readChildNodes(e,t)},lineStringMembers:function(e,t){this.readChildNodes(e,t)},polygonMembers:function(e,t){this.readChildNodes(e,t)},geometryMembers:function(e,t){this.readChildNodes(e,t)},Envelope:function(e,t){var r={points:new Array(2)};this.readChildNodes(e,r);t.components||(t.components=[]);var n=r.points[0],i=r.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,i.x,i.y))},lowerCorner:function(e,t){var r={};this.readers.gml.pos.apply(this,[e,r]);t.points[0]=r.points[0]},upperCorner:function(e,t){var r={};this.readers.gml.pos.apply(this,[e,r]);t.points[1]=r.points[0]}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"featureMembers":"featureMember";var r=this.writeNode("gml:"+t,e);this.setAttributeNS(r,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[r])},writers:{gml:OpenLayers.Util.applyDefaults({featureMembers:function(e){for(var t=this.createElementNSPlus("gml:featureMembers"),r=0,n=e.length;n>r;++r)this.writeNode("feature:_typeName",e[r],t);return t},Point:function(e){var t=this.createElementNSPlus("gml:Point");this.writeNode("pos",e,t);return t},pos:function(e){var t=this.xy?e.x+" "+e.y:e.y+" "+e.x;return this.createElementNSPlus("gml:pos",{value:t})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");this.writeNode("posList",e.components,t);return t},Curve:function(e){var t=this.createElementNSPlus("gml:Curve");this.writeNode("segments",e,t);return t},segments:function(e){var t=this.createElementNSPlus("gml:segments");this.writeNode("LineStringSegment",e,t);return t},LineStringSegment:function(e){var t=this.createElementNSPlus("gml:LineStringSegment");this.writeNode("posList",e.components,t);return t},posList:function(e){for(var t,r=e.length,n=new Array(r),i=0;r>i;++i){t=e[i];n[i]=this.xy?t.x+" "+t.y:t.y+" "+t.x}return this.createElementNSPlus("gml:posList",{value:n.join(" ")})},Surface:function(e){var t=this.createElementNSPlus("gml:Surface");this.writeNode("patches",e,t);return t},patches:function(e){var t=this.createElementNSPlus("gml:patches");this.writeNode("PolygonPatch",e,t);return t},PolygonPatch:function(e){var t=this.createElementNSPlus("gml:PolygonPatch",{attributes:{interpolation:"planar"}});this.writeNode("exterior",e.components[0],t);for(var r=1,n=e.components.length;n>r;++r)this.writeNode("interior",e.components[r],t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("exterior",e.components[0],t);for(var r=1,n=e.components.length;n>r;++r)this.writeNode("interior",e.components[r],t);return t},exterior:function(e){var t=this.createElementNSPlus("gml:exterior");this.writeNode("LinearRing",e,t);return t},interior:function(e){var t=this.createElementNSPlus("gml:interior");this.writeNode("LinearRing",e,t);return t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");this.writeNode("posList",e.components,t);return t},MultiCurve:function(e){for(var t=this.createElementNSPlus("gml:MultiCurve"),r=e.components||[e],n=0,i=r.length;i>n;++n)this.writeNode("curveMember",r[n],t);return t},curveMember:function(e){var t=this.createElementNSPlus("gml:curveMember");this.curve?this.writeNode("Curve",e,t):this.writeNode("LineString",e,t);return t},MultiSurface:function(e){for(var t=this.createElementNSPlus("gml:MultiSurface"),r=e.components||[e],n=0,i=r.length;i>n;++n)this.writeNode("surfaceMember",r[n],t);return t},surfaceMember:function(e){var t=this.createElementNSPlus("gml:surfaceMember");this.surface?this.writeNode("Surface",e,t):this.writeNode("Polygon",e,t);return t},Envelope:function(e){var t=this.createElementNSPlus("gml:Envelope");this.writeNode("lowerCorner",e,t);this.writeNode("upperCorner",e,t);this.srsName&&t.setAttribute("srsName",this.srsName);return t},lowerCorner:function(e){var t=this.xy?e.left+" "+e.bottom:e.bottom+" "+e.left;return this.createElementNSPlus("gml:lowerCorner",{value:t})},upperCorner:function(e){var t=this.xy?e.right+" "+e.top:e.top+" "+e.right;return this.createElementNSPlus("gml:upperCorner",{value:t})}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},setGeometryTypes:function(){this.geometryTypes={"OpenLayers.Geometry.Point":"Point","OpenLayers.Geometry.MultiPoint":"MultiPoint","OpenLayers.Geometry.LineString":this.curve===!0?"Curve":"LineString","OpenLayers.Geometry.MultiLineString":this.multiCurve===!1?"MultiLineString":"MultiCurve","OpenLayers.Geometry.Polygon":this.surface===!0?"Surface":"Polygon","OpenLayers.Geometry.MultiPolygon":this.multiSurface===!1?"MultiPolygon":"MultiSurface","OpenLayers.Geometry.Collection":"GeometryCollection"}},CLASS_NAME:"OpenLayers.Format.GML.v3"});OpenLayers.Format.Filter.v1_1_0=OpenLayers.Class(OpenLayers.Format.GML.v3,OpenLayers.Format.Filter.v1,{VERSION:"1.1.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.1.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v3.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var r=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,matchCase:!("false"===r||"0"===r)});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsNotEqualTo:function(e,t){var r=e.getAttribute("matchCase"),n=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO,matchCase:!("false"===r||"0"===r)});this.readChildNodes(e,n);t.filters.push(n)},PropertyIsLike:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,r);var n=e.getAttribute("wildCard"),i=e.getAttribute("singleChar"),a=e.getAttribute("escapeChar");r.value2regex(n,i,a);t.filters.push(r)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo",{attributes:{matchCase:e.matchCase}});this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{matchCase:e.matchCase,wildCard:"*",singleChar:".",escapeChar:"!"}});this.writeNode("PropertyName",e,t);this.writeNode("Literal",e.regex2value(),t);return t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var r=this.writeNode("gml:Envelope",e.value);e.projection&&r.setAttribute("srsName",e.projection);t.appendChild(r);return t},SortBy:function(e){for(var t=this.createElementNSPlus("ogc:SortBy"),r=0,n=e.length;n>r;r++)this.writeNode("ogc:SortProperty",e[r],t);return t},SortProperty:function(e){var t=this.createElementNSPlus("ogc:SortProperty");this.writeNode("ogc:PropertyName",e,t);this.writeNode("ogc:SortOrder","DESC"==e.order?"DESC":"ASC",t);return t},SortOrder:function(e){var t=this.createElementNSPlus("ogc:SortOrder",{value:e});return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature},writeSpatial:function(e,t){var r=this.createElementNSPlus("ogc:"+t);this.writeNode("PropertyName",e,r);if(e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,r);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Envelope",e.value);e.projection&&n.setAttribute("srsName",e.projection);r.appendChild(n)}return r},CLASS_NAME:"OpenLayers.Format.Filter.v1_1_0"});OpenLayers.Format.OWSCommon=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",getVersion:function(e,t){var r=this.version;if(!r){var n=e.getAttribute("xmlns:ows");n&&"1.1"===n.substring(n.lastIndexOf("/")+1)&&(r="1.1.0");r||(r=this.defaultVersion)}return r},CLASS_NAME:"OpenLayers.Format.OWSCommon"});OpenLayers.Format.OWSCommon.v1=OpenLayers.Class(OpenLayers.Format.XML,{regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},read:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var r={};this.readChildNodes(e,r);return r},readers:{ows:{Exception:function(e,t){var r={code:e.getAttribute("exceptionCode"),locator:e.getAttribute("locator"),texts:[]};t.exceptions.push(r);this.readChildNodes(e,r)},ExceptionText:function(e,t){var r=this.getChildValue(e);t.texts.push(r)},ServiceIdentification:function(e,t){t.serviceIdentification={};this.readChildNodes(e,t.serviceIdentification)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},Keywords:function(e,t){t.keywords={};this.readChildNodes(e,t.keywords)},Keyword:function(e,t){t[this.getChildValue(e)]=!0},ServiceType:function(e,t){t.serviceType={codeSpace:e.getAttribute("codeSpace"),value:this.getChildValue(e)}},ServiceTypeVersion:function(e,t){t.serviceTypeVersion=this.getChildValue(e)},Fees:function(e,t){t.fees=this.getChildValue(e)},AccessConstraints:function(e,t){t.accessConstraints=this.getChildValue(e)},ServiceProvider:function(e,t){t.serviceProvider={};this.readChildNodes(e,t.serviceProvider)},ProviderName:function(e,t){t.providerName=this.getChildValue(e)},ProviderSite:function(e,t){t.providerSite=this.getAttributeNS(e,this.namespaces.xlink,"href")},ServiceContact:function(e,t){t.serviceContact={};this.readChildNodes(e,t.serviceContact)},IndividualName:function(e,t){t.individualName=this.getChildValue(e)},PositionName:function(e,t){t.positionName=this.getChildValue(e)},ContactInfo:function(e,t){t.contactInfo={};this.readChildNodes(e,t.contactInfo)},Phone:function(e,t){t.phone={};this.readChildNodes(e,t.phone)},Voice:function(e,t){t.voice=this.getChildValue(e)},Address:function(e,t){t.address={};this.readChildNodes(e,t.address)},DeliveryPoint:function(e,t){t.deliveryPoint=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},AdministrativeArea:function(e,t){t.administrativeArea=this.getChildValue(e)},PostalCode:function(e,t){t.postalCode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ElectronicMailAddress:function(e,t){t.electronicMailAddress=this.getChildValue(e)},Role:function(e,t){t.role=this.getChildValue(e)},OperationsMetadata:function(e,t){t.operationsMetadata={};this.readChildNodes(e,t.operationsMetadata)},Operation:function(e,t){var r=e.getAttribute("name");t[r]={};this.readChildNodes(e,t[r])},DCP:function(e,t){t.dcp={};this.readChildNodes(e,t.dcp)},HTTP:function(e,t){t.http={};this.readChildNodes(e,t.http)},Get:function(e,t){t.get||(t.get=[]);var r={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,r);t.get.push(r)},Post:function(e,t){t.post||(t.post=[]);var r={url:this.getAttributeNS(e,this.namespaces.xlink,"href")};this.readChildNodes(e,r);t.post.push(r)},Parameter:function(e,t){t.parameters||(t.parameters={});var r=e.getAttribute("name");t.parameters[r]={};this.readChildNodes(e,t.parameters[r])},Constraint:function(e,t){t.constraints||(t.constraints={});var r=e.getAttribute("name");t.constraints[r]={};this.readChildNodes(e,t.constraints[r])},Value:function(e,t){t[this.getChildValue(e)]=!0},OutputFormat:function(e,t){t.formats.push({value:this.getChildValue(e)});this.readChildNodes(e,t)},WGS84BoundingBox:function(e,t){var r={};r.crs=e.getAttribute("crs");if(t.BoundingBox)t.BoundingBox.push(r);else{t.projection=r.crs;r=t}this.readChildNodes(e,r)},BoundingBox:function(e,t){this.readers.ows.WGS84BoundingBox.apply(this,[e,t])},LowerCorner:function(e,t){var r=this.getChildValue(e).replace(this.regExes.trimSpace,"");r=r.replace(this.regExes.trimComma,",");var n=r.split(this.regExes.splitSpace);t.left=n[0];t.bottom=n[1]},UpperCorner:function(e,t){var r=this.getChildValue(e).replace(this.regExes.trimSpace,"");r=r.replace(this.regExes.trimComma,",");var n=r.split(this.regExes.splitSpace);t.right=n[0];t.top=n[1];t.bounds=new OpenLayers.Bounds(t.left,t.bottom,t.right,t.top);delete t.left;delete t.bottom;delete t.right;delete t.top},Language:function(e,t){t.language=this.getChildValue(e)}}},writers:{ows:{BoundingBox:function(e,t){var r=this.createElementNSPlus(t||"ows:BoundingBox",{attributes:{crs:e.projection}});this.writeNode("ows:LowerCorner",e,r);this.writeNode("ows:UpperCorner",e,r);return r},LowerCorner:function(e){
var t=this.createElementNSPlus("ows:LowerCorner",{value:e.bounds.left+" "+e.bounds.bottom});return t},UpperCorner:function(e){var t=this.createElementNSPlus("ows:UpperCorner",{value:e.bounds.right+" "+e.bounds.top});return t},Identifier:function(e){var t=this.createElementNSPlus("ows:Identifier",{value:e});return t},Title:function(e){var t=this.createElementNSPlus("ows:Title",{value:e});return t},Abstract:function(e){var t=this.createElementNSPlus("ows:Abstract",{value:e});return t},OutputFormat:function(e){var t=this.createElementNSPlus("ows:OutputFormat",{value:e});return t}}},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1"});OpenLayers.Format.OWSCommon.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.success=!1;t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("language"),exceptions:[]};this.readChildNodes(e,t.exceptionReport)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Format.OWSCommon.v1.prototype.writers.ows},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_0_0"});OpenLayers.Format.WFST.v1_1_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_1_0,OpenLayers.Format.WFST.v1,{version:"1.1.0",schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.1.0/wfs.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_1_0.prototype.initialize.apply(this,[e]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,r){return OpenLayers.Format.GML.v3.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({FeatureCollection:function(e,t){t.numberOfFeatures=parseInt(e.getAttribute("numberOfFeatures"));OpenLayers.Format.WFST.v1.prototype.readers.wfs.FeatureCollection.apply(this,arguments)},TransactionResponse:function(e,t){t.insertIds=[];t.success=!1;this.readChildNodes(e,t)},TransactionSummary:function(e,t){t.success=!0},InsertResults:function(e,t){this.readChildNodes(e,t)},Feature:function(e,t){var r={fids:[]};this.readChildNodes(e,r);t.insertIds.push(r.fids[0])}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v3.prototype.readers.gml,feature:OpenLayers.Format.GML.v3.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.readers.ogc,ows:OpenLayers.Format.OWSCommon.v1_0_0.prototype.readers.ows},writers:{wfs:OpenLayers.Util.applyDefaults({GetFeature:function(e){var t=OpenLayers.Format.WFST.v1.prototype.writers.wfs.GetFeature.apply(this,arguments);e&&this.setAttributes(t,{resultType:e.resultType,startIndex:e.startIndex,count:e.count});return t},Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName},e);var t=e.featurePrefix,r=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType,srsName:e.srsName}});e.featureNS&&r.setAttribute("xmlns:"+t,e.featureNS);if(e.propertyNames)for(var n=0,i=e.propertyNames.length;i>n;n++)this.writeNode("wfs:PropertyName",{property:e.propertyNames[n]},r);if(e.filter){OpenLayers.Format.WFST.v1_1_0.prototype.setFilterProperty.call(this,e.filter);this.writeNode("ogc:Filter",e.filter,r)}return r},PropertyName:function(e){return this.createElementNSPlus("wfs:PropertyName",{value:e.property})}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v3.prototype.writers.gml,feature:OpenLayers.Format.GML.v3.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_1_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_1_0"});OpenLayers.Control=OpenLayers.Class({id:null,map:null,div:null,type:null,allowSelection:!1,displayClass:"",title:"",autoActivate:!1,active:null,handlerOptions:null,handler:null,eventListeners:null,events:null,initialize:function(e){this.displayClass=this.CLASS_NAME.replace("OpenLayers.","ol").replace(/\./g,"");OpenLayers.Util.extend(this,e);this.events=new OpenLayers.Events(this);this.eventListeners instanceof Object&&this.events.on(this.eventListeners);null==this.id&&(this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"))},destroy:function(){if(this.events){this.eventListeners&&this.events.un(this.eventListeners);this.events.destroy();this.events=null}this.eventListeners=null;if(this.handler){this.handler.destroy();this.handler=null}if(this.handlers){for(var e in this.handlers)this.handlers.hasOwnProperty(e)&&"function"==typeof this.handlers[e].destroy&&this.handlers[e].destroy();this.handlers=null}if(this.map){this.map.removeControl(this);this.map=null}this.div=null},setMap:function(e){this.map=e;this.handler&&this.handler.setMap(e)},draw:function(e){if(null==this.div){this.div=OpenLayers.Util.createDiv(this.id);this.div.className=this.displayClass;if(!this.allowSelection){this.div.className+=" olControlNoSelect";this.div.setAttribute("unselectable","on",0);this.div.onselectstart=OpenLayers.Function.False}""!=this.title&&(this.div.title=this.title)}null!=e&&(this.position=e.clone());this.moveTo(this.position);return this.div},moveTo:function(e){if(null!=e&&null!=this.div){this.div.style.left=e.x+"px";this.div.style.top=e.y+"px"}},activate:function(){if(this.active)return!1;this.handler&&this.handler.activate();this.active=!0;this.map&&OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("activate");return!0},deactivate:function(){if(this.active){this.handler&&this.handler.deactivate();this.active=!1;this.map&&OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass.replace(/ /g,"")+"Active");this.events.triggerEvent("deactivate");return!0}return!1},CLASS_NAME:"OpenLayers.Control"});OpenLayers.Control.TYPE_BUTTON=1;OpenLayers.Control.TYPE_TOGGLE=2;OpenLayers.Control.TYPE_TOOL=3;OpenLayers.Control.PanZoom=OpenLayers.Class(OpenLayers.Control,{slideFactor:50,slideRatio:null,buttons:null,position:null,initialize:function(e){this.position=new OpenLayers.Pixel(OpenLayers.Control.PanZoom.X,OpenLayers.Control.PanZoom.Y);OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.map&&this.map.events.unregister("buttonclick",this,this.onButtonClick);this.removeButtons();this.buttons=null;this.position=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},setMap:function(e){OpenLayers.Control.prototype.setMap.apply(this,arguments);this.map.events.register("buttonclick",this,this.onButtonClick)},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position;this.buttons=[];var t={w:18,h:18},r=new OpenLayers.Pixel(e.x+t.w/2,e.y);this._addButton("panup","north-mini.png",r,t);e.y=r.y+t.h;this._addButton("panleft","west-mini.png",e,t);this._addButton("panright","east-mini.png",e.add(t.w,0),t);this._addButton("pandown","south-mini.png",r.add(0,2*t.h),t);this._addButton("zoomin","zoom-plus-mini.png",r.add(0,3*t.h+5),t);this._addButton("zoomworld","zoom-world-mini.png",r.add(0,4*t.h+5),t);this._addButton("zoomout","zoom-minus-mini.png",r.add(0,5*t.h+5),t);return this.div},_addButton:function(e,t,r,n){var i=OpenLayers.Util.getImageLocation(t),a=OpenLayers.Util.createAlphaImageDiv(this.id+"_"+e,r,n,i,"absolute");a.style.cursor="pointer";this.div.appendChild(a);a.action=e;a.className="olButton";this.buttons.push(a);return a},_removeButton:function(e){this.div.removeChild(e);OpenLayers.Util.removeItem(this.buttons,e)},removeButtons:function(){for(var e=this.buttons.length-1;e>=0;--e)this._removeButton(this.buttons[e])},onButtonClick:function(e){var t=e.buttonElement;switch(t.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToMaxExtent()}},getSlideFactor:function(e){return this.slideRatio?this.map.getSize()[e]*this.slideRatio:this.slideFactor},CLASS_NAME:"OpenLayers.Control.PanZoom"});OpenLayers.Control.PanZoom.X=4;OpenLayers.Control.PanZoom.Y=4;OpenLayers.Control.PanZoomBar=OpenLayers.Class(OpenLayers.Control.PanZoom,{zoomStopWidth:18,zoomStopHeight:11,slider:null,sliderEvents:null,zoombarDiv:null,zoomWorldIcon:!1,panIcons:!0,forceFixedZoomLevel:!1,mouseDragStart:null,deltaY:null,zoomStart:null,destroy:function(){this._removeZoomBar();this.map.events.un({changebaselayer:this.redraw,updatesize:this.redraw,scope:this});OpenLayers.Control.PanZoom.prototype.destroy.apply(this,arguments);delete this.mouseDragStart;delete this.zoomStart},setMap:function(e){OpenLayers.Control.PanZoom.prototype.setMap.apply(this,arguments);this.map.events.on({changebaselayer:this.redraw,updatesize:this.redraw,scope:this})},redraw:function(){if(null!=this.div){this.removeButtons();this._removeZoomBar()}this.draw()},draw:function(e){OpenLayers.Control.prototype.draw.apply(this,arguments);e=this.position.clone();this.buttons=[];var t={w:18,h:18};if(this.panIcons){var r=new OpenLayers.Pixel(e.x+t.w/2,e.y),n=t.w;this.zoomWorldIcon&&(r=new OpenLayers.Pixel(e.x+t.w,e.y));this._addButton("panup","north-mini.png",r,t);e.y=r.y+t.h;this._addButton("panleft","west-mini.png",e,t);if(this.zoomWorldIcon){this._addButton("zoomworld","zoom-world-mini.png",e.add(t.w,0),t);n*=2}this._addButton("panright","east-mini.png",e.add(n,0),t);this._addButton("pandown","south-mini.png",r.add(0,2*t.h),t);this._addButton("zoomin","zoom-plus-mini.png",r.add(0,3*t.h+5),t);r=this._addZoomBar(r.add(0,4*t.h+5));this._addButton("zoomout","zoom-minus-mini.png",r,t)}else{this._addButton("zoomin","zoom-plus-mini.png",e,t);r=this._addZoomBar(e.add(0,t.h));this._addButton("zoomout","zoom-minus-mini.png",r,t);if(this.zoomWorldIcon){r=r.add(0,t.h+3);this._addButton("zoomworld","zoom-world-mini.png",r,t)}}return this.div},_addZoomBar:function(e){var t=OpenLayers.Util.getImageLocation("slider.png"),r=this.id+"_"+this.map.id,n=this.map.getMinZoom(),i=this.map.getNumZoomLevels()-1-this.map.getZoom(),a=OpenLayers.Util.createAlphaImageDiv(r,e.add(-1,i*this.zoomStopHeight),{w:20,h:9},t,"absolute");a.style.cursor="move";this.slider=a;this.sliderEvents=new OpenLayers.Events(this,a,null,!0,{includeXY:!0});this.sliderEvents.on({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});var s={w:this.zoomStopWidth,h:this.zoomStopHeight*(this.map.getNumZoomLevels()-n)},t=OpenLayers.Util.getImageLocation("zoombar.png"),o=null;if(OpenLayers.Util.alphaHack()){var r=this.id+"_"+this.map.id;o=OpenLayers.Util.createAlphaImageDiv(r,e,{w:s.w,h:this.zoomStopHeight},t,"absolute",null,"crop");o.style.height=s.h+"px"}else o=OpenLayers.Util.createDiv("OpenLayers_Control_PanZoomBar_Zoombar"+this.map.id,e,s,t);o.style.cursor="pointer";o.className="olButton";this.zoombarDiv=o;this.div.appendChild(o);this.startTop=parseInt(o.style.top);this.div.appendChild(a);this.map.events.register("zoomend",this,this.moveZoomBar);e=e.add(0,this.zoomStopHeight*(this.map.getNumZoomLevels()-n));return e},_removeZoomBar:function(){this.sliderEvents.un({touchstart:this.zoomBarDown,touchmove:this.zoomBarDrag,touchend:this.zoomBarUp,mousedown:this.zoomBarDown,mousemove:this.zoomBarDrag,mouseup:this.zoomBarUp});this.sliderEvents.destroy();this.div.removeChild(this.zoombarDiv);this.zoombarDiv=null;this.div.removeChild(this.slider);this.slider=null;this.map.events.unregister("zoomend",this,this.moveZoomBar)},onButtonClick:function(e){OpenLayers.Control.PanZoom.prototype.onButtonClick.apply(this,arguments);if(e.buttonElement===this.zoombarDiv){var t=e.buttonXY.y/this.zoomStopHeight;(this.forceFixedZoomLevel||!this.map.fractionalZoom)&&(t=Math.floor(t));var r=this.map.getNumZoomLevels()-1-t;r=Math.min(Math.max(r,0),this.map.getNumZoomLevels()-1);this.map.zoomTo(r)}},passEventToSlider:function(e){this.sliderEvents.handleBrowserEvent(e)},zoomBarDown:function(e){if(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e)){this.map.events.on({touchmove:this.passEventToSlider,mousemove:this.passEventToSlider,mouseup:this.passEventToSlider,scope:this});this.mouseDragStart=e.xy.clone();this.zoomStart=e.xy.clone();this.div.style.cursor="move";this.zoombarDiv.offsets=null;OpenLayers.Event.stop(e)}},zoomBarDrag:function(e){if(null!=this.mouseDragStart){var t=this.mouseDragStart.y-e.xy.y,r=OpenLayers.Util.pagePosition(this.zoombarDiv);if(e.clientY-r[1]>0&&e.clientY-r[1]<parseInt(this.zoombarDiv.style.height)-2){var n=parseInt(this.slider.style.top)-t;this.slider.style.top=n+"px";this.mouseDragStart=e.xy.clone()}this.deltaY=this.zoomStart.y-e.xy.y;OpenLayers.Event.stop(e)}},zoomBarUp:function(e){if((OpenLayers.Event.isLeftClick(e)||"touchend"===e.type)&&this.mouseDragStart){this.div.style.cursor="";this.map.events.un({touchmove:this.passEventToSlider,mouseup:this.passEventToSlider,mousemove:this.passEventToSlider,scope:this});var t=this.map.zoom;if(!this.forceFixedZoomLevel&&this.map.fractionalZoom){t+=this.deltaY/this.zoomStopHeight;t=Math.min(Math.max(t,0),this.map.getNumZoomLevels()-1)}else{t+=this.deltaY/this.zoomStopHeight;t=Math.max(Math.round(t),0)}this.map.zoomTo(t);this.mouseDragStart=null;this.zoomStart=null;this.deltaY=0;OpenLayers.Event.stop(e)}},moveZoomBar:function(){var e=(this.map.getNumZoomLevels()-1-this.map.getZoom())*this.zoomStopHeight+this.startTop+1;this.slider.style.top=e+"px"},CLASS_NAME:"OpenLayers.Control.PanZoomBar"});OpenLayers.Events.featureclick=OpenLayers.Class({cache:null,map:null,provides:["featureclick","nofeatureclick","featureover","featureout"],initialize:function(e){this.target=e;if(e.object instanceof OpenLayers.Map)this.setMap(e.object);else{if(!(e.object instanceof OpenLayers.Layer.Vector))throw"Listeners for '"+this.provides.join("', '")+"' events can only be registered for OpenLayers.Layer.Vector or OpenLayers.Map instances";e.object.map?this.setMap(e.object.map):e.object.events.register("added",this,function(t){this.setMap(e.object.map)})}for(var t=this.provides.length-1;t>=0;--t)e.extensions[this.provides[t]]=!0},setMap:function(e){this.map=e;this.cache={};e.events.register("mousedown",this,this.start,{extension:!0});e.events.register("mouseup",this,this.onClick,{extension:!0});e.events.register("touchstart",this,this.start,{extension:!0});e.events.register("touchmove",this,this.cancel,{extension:!0});e.events.register("touchend",this,this.onClick,{extension:!0});e.events.register("mousemove",this,this.onMousemove,{extension:!0})},start:function(e){this.startEvt=e},cancel:function(e){delete this.startEvt},onClick:function(e){if(this.startEvt&&("touchend"===e.type||OpenLayers.Event.isLeftClick(e))){var t=this.getFeatures(this.startEvt);delete this.startEvt;for(var r,n,i,a={},s=0,o=t.length;o>s;++s){r=t[s];n=r.layer;a[n.id]=!0;i=this.triggerEvent("featureclick",{feature:r});if(i===!1)break}for(s=0,o=this.map.layers.length;o>s;++s){n=this.map.layers[s];n instanceof OpenLayers.Layer.Vector&&!a[n.id]&&this.triggerEvent("nofeatureclick",{layer:n})}}},onMousemove:function(e){delete this.startEvt;for(var t,r=this.getFeatures(e),n={},i=[],a=0,s=r.length;s>a;++a){t=r[a];n[t.id]=t;this.cache[t.id]||i.push(t)}var o=[];for(var l in this.cache){t=this.cache[l];t.layer&&t.layer.map?n[t.id]||o.push(t):delete this.cache[l]}var c;for(a=0,s=i.length;s>a;++a){t=i[a];this.cache[t.id]=t;c=this.triggerEvent("featureover",{feature:t});if(c===!1)break}for(a=0,s=o.length;s>a;++a){t=o[a];delete this.cache[t.id];c=this.triggerEvent("featureout",{feature:t});if(c===!1)break}},triggerEvent:function(e,t){var r=t.feature?t.feature.layer:t.layer,n=this.target.object;return n instanceof OpenLayers.Map||n===r?this.target.triggerEvent(e,t):void 0},getFeatures:function(e){var t,r,n,i,a,s=e.clientX,o=e.clientY,l=[],c=[],u=[];for(i=this.map.layers.length-1;i>=0;--i){t=this.map.layers[i];if("none"!==t.div.style.display)if(t.renderer instanceof OpenLayers.Renderer.Elements){if(t instanceof OpenLayers.Layer.Vector){r=document.elementFromPoint(s,o);for(;r&&r._featureId;){n=t.getFeatureById(r._featureId);if(n){l.push(n);r.style.display="none";c.push(r);r=document.elementFromPoint(s,o)}else r=!1}}u.push(t);t.div.style.display="none"}else if(t.renderer instanceof OpenLayers.Renderer.Canvas){n=t.renderer.getFeatureIdFromEvent(e);if(n){l.push(n);u.push(t)}}}for(i=0,a=c.length;a>i;++i)c[i].style.display="";for(i=u.length-1;i>=0;--i)u[i].div.style.display="block";return l},destroy:function(){for(var e=this.provides.length-1;e>=0;--e)delete this.target.extensions[this.provides[e]];this.map.events.un({mousemove:this.onMousemove,mousedown:this.start,mouseup:this.onClick,touchstart:this.start,touchmove:this.cancel,touchend:this.onClick,scope:this});delete this.cache;delete this.map;delete this.target}});OpenLayers.Events.nofeatureclick=OpenLayers.Events.featureclick;OpenLayers.Events.featureover=OpenLayers.Events.featureclick;OpenLayers.Events.featureout=OpenLayers.Events.featureclick;OpenLayers.Handler=OpenLayers.Class({id:null,control:null,map:null,keyMask:null,active:!1,evt:null,touch:!1,initialize:function(e,t,r){OpenLayers.Util.extend(this,r);this.control=e;this.callbacks=t;var n=this.map||e.map;n&&this.setMap(n);this.id=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_")},setMap:function(e){this.map=e},checkModifiers:function(e){if(null==this.keyMask)return!0;var t=(e.shiftKey?OpenLayers.Handler.MOD_SHIFT:0)|(e.ctrlKey?OpenLayers.Handler.MOD_CTRL:0)|(e.altKey?OpenLayers.Handler.MOD_ALT:0)|(e.metaKey?OpenLayers.Handler.MOD_META:0);return t==this.keyMask},activate:function(){if(this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,r=e.length;r>t;t++)this[e[t]]&&this.register(e[t],this[e[t]]);this.active=!0;return!0},deactivate:function(){if(!this.active)return!1;for(var e=OpenLayers.Events.prototype.BROWSER_EVENTS,t=0,r=e.length;r>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]]);this.touch=!1;this.active=!1;return!0},startTouch:function(){if(!this.touch){this.touch=!0;for(var e=["mousedown","mouseup","mousemove","click","dblclick","mouseout"],t=0,r=e.length;r>t;t++)this[e[t]]&&this.unregister(e[t],this[e[t]])}},callback:function(e,t){e&&this.callbacks[e]&&this.callbacks[e].apply(this.control,t)},register:function(e,t){this.map.events.registerPriority(e,this,t);this.map.events.registerPriority(e,this,this.setEvent)},unregister:function(e,t){this.map.events.unregister(e,this,t);this.map.events.unregister(e,this,this.setEvent)},setEvent:function(e){this.evt=e;return!0},destroy:function(){this.deactivate();this.control=this.map=null},CLASS_NAME:"OpenLayers.Handler"});OpenLayers.Handler.MOD_NONE=0;OpenLayers.Handler.MOD_SHIFT=1;OpenLayers.Handler.MOD_CTRL=2;OpenLayers.Handler.MOD_ALT=4;OpenLayers.Handler.MOD_META=8;OpenLayers.Handler.Point=OpenLayers.Class(OpenLayers.Handler,{point:null,layer:null,multi:!1,citeCompliant:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,layerOptions:null,pixelTolerance:5,lastTouchPx:null,initialize:function(e,t,r){r&&r.layerOptions&&r.layerOptions.styleMap||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;var e=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True,wrapDateLine:this.citeCompliant},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,e);this.map.addLayer(this.layer);return!0},createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),r=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(r);this.callback("create",[this.point.geometry,this.point]);this.point.geometry.clearBounds();this.layer.addFeatures([this.point],{silent:!0})},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments))return!1;this.cancel();if(null!=this.layer.map){this.destroyFeature(!0);this.layer.destroy(!1)}this.layer=null;return!0},destroyFeature:function(e){!this.layer||!e&&this.persist||this.layer.destroyFeatures();this.point=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>1&&this.layer.features[0].destroy()},finalize:function(e){var t=e?"cancel":"done";this.mouseDown=!1;this.lastDown=null;this.lastUp=null;this.lastTouchPx=null;this.callback(t,[this.geometryClone()]);this.destroyFeature(e)},cancel:function(){this.finalize(!0)},click:function(e){OpenLayers.Event.stop(e);return!1},dblclick:function(e){OpenLayers.Event.stop(e);return!1},modifyFeature:function(e){this.point||this.createFeature(e);var t=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=t.lon;this.point.geometry.y=t.lat;this.callback("modify",[this.point.geometry,this.point,!1]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.point,this.style)},getGeometry:function(){var e=this.point&&this.point.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiPoint([e]));return e},geometryClone:function(){var e=this.getGeometry();return e&&e.clone()},mousedown:function(e){return this.down(e)},touchstart:function(e){this.startTouch();this.lastTouchPx=e.xy;return this.down(e)},mousemove:function(e){return this.move(e)},touchmove:function(e){this.lastTouchPx=e.xy;return this.move(e)},mouseup:function(e){return this.up(e)},touchend:function(e){e.xy=this.lastTouchPx;return this.up(e)},down:function(e){this.mouseDown=!0;this.lastDown=e.xy;this.touch||this.modifyFeature(e.xy);this.stoppedDown=this.stopDown;return!this.stopDown},move:function(e){this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy);return!0},up:function(e){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(!this.checkModifiers(e))return!0;if(this.lastUp&&this.lastUp.equals(e.xy))return!0;if(this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy);this.persist&&this.destroyPersistedFeature();this.lastUp=e.xy;this.finalize();return!this.stopUp}return!0},mouseout:function(e){if(OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){this.stoppedDown=this.stopDown;this.mouseDown=!1}},passesTolerance:function(e,t,r){var n=!0;if(null!=r&&e&&t){var i=e.distanceTo(t);i>r&&(n=!1)}return n},CLASS_NAME:"OpenLayers.Handler.Point"});OpenLayers.Handler.Path=OpenLayers.Class(OpenLayers.Handler.Point,{line:null,maxVertices:null,doubleTouchTolerance:20,freehand:!1,freehandToggle:"shiftKey",timerId:null,redoStack:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),r=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(r);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString([this.point.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.line,this.point],{silent:!0})},destroyFeature:function(e){OpenLayers.Handler.Point.prototype.destroyFeature.call(this,e);this.line=null},destroyPersistedFeature:function(){var e=this.layer;e&&e.features.length>2&&this.layer.features[0].destroy()},removePoint:function(){this.point&&this.layer.removeFeatures([this.point])},addPoint:function(e){this.layer.removeFeatures([this.point]);var t=this.layer.getLonLatFromViewPortPx(e);this.point=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat));this.line.geometry.addComponent(this.point.geometry,this.line.geometry.components.length);this.layer.addFeatures([this.point]);this.callback("point",[this.point.geometry,this.getGeometry()]);this.callback("modify",[this.point.geometry,this.getSketch()]);this.drawFeature();delete this.redoStack},insertXY:function(e,t){this.line.geometry.addComponent(new OpenLayers.Geometry.Point(e,t),this.getCurrentPointIndex());this.drawFeature();delete this.redoStack},insertDeltaXY:function(e,t){var r=this.getCurrentPointIndex()-1,n=this.line.geometry.components[r];!n||isNaN(n.x)||isNaN(n.y)||this.insertXY(n.x+e,n.y+t)},insertDirectionLength:function(e,t){e*=Math.PI/180;var r=t*Math.cos(e),n=t*Math.sin(e);this.insertDeltaXY(r,n)},insertDeflectionLength:function(e,t){var r=this.getCurrentPointIndex()-1;if(r>0){var n=this.line.geometry.components[r],i=this.line.geometry.components[r-1],a=Math.atan2(n.y-i.y,n.x-i.x);this.insertDirectionLength(180*a/Math.PI+e,t)}},getCurrentPointIndex:function(){return this.line.geometry.components.length-1},undo:function(){var e=this.line.geometry,t=e.components,r=this.getCurrentPointIndex()-1,n=t[r],i=e.removeComponent(n);if(i){if(this.touch&&r>0){t=e.components;var a=t[r-1],s=this.getCurrentPointIndex(),o=t[s];o.x=a.x;o.y=a.y}this.redoStack||(this.redoStack=[]);this.redoStack.push(n);this.drawFeature()}return i},redo:function(){var e=this.redoStack&&this.redoStack.pop();if(e){this.line.geometry.addComponent(e,this.getCurrentPointIndex());this.drawFeature()}return!!e},freehandMode:function(e){return this.freehandToggle&&e[this.freehandToggle]?!this.freehand:this.freehand},modifyFeature:function(e,t){this.line||this.createFeature(e);var r=this.layer.getLonLatFromViewPortPx(e);this.point.geometry.x=r.lon;this.point.geometry.y=r.lat;this.callback("modify",[this.point.geometry,this.getSketch(),t]);this.point.geometry.clearBounds();this.drawFeature()},drawFeature:function(){this.layer.drawFeature(this.line,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.line},getGeometry:function(){var e=this.line&&this.line.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiLineString([e]));return e},touchstart:function(e){if(this.timerId&&this.passesTolerance(this.lastTouchPx,e.xy,this.doubleTouchTolerance)){this.finishGeometry();window.clearTimeout(this.timerId);this.timerId=null;return!1}if(this.timerId){window.clearTimeout(this.timerId);this.timerId=null}this.timerId=window.setTimeout(OpenLayers.Function.bind(function(){this.timerId=null},this),300);return OpenLayers.Handler.Point.prototype.touchstart.call(this,e)},down:function(e){var t=this.stopDown;if(this.freehandMode(e)){t=!0;if(this.touch){this.modifyFeature(e.xy,!!this.lastUp);OpenLayers.Event.stop(e)}}this.touch||this.lastDown&&this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)||this.modifyFeature(e.xy,!!this.lastUp);this.mouseDown=!0;this.lastDown=e.xy;this.stoppedDown=t;return!t},move:function(e){if(this.stoppedDown&&this.freehandMode(e)){this.persist&&this.destroyPersistedFeature();if(this.maxVertices&&this.line&&this.line.geometry.components.length===this.maxVertices){this.removePoint();this.finalize()}else this.addPoint(e.xy);return!1}this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(e.xy,!!this.lastUp);return!0},up:function(e){if(this.mouseDown&&(!this.lastUp||!this.lastUp.equals(e.xy)))if(this.stoppedDown&&this.freehandMode(e)){this.persist&&this.destroyPersistedFeature();this.removePoint();this.finalize()}else if(this.passesTolerance(this.lastDown,e.xy,this.pixelTolerance)){this.touch&&this.modifyFeature(e.xy);null==this.lastUp&&this.persist&&this.destroyPersistedFeature();this.addPoint(e.xy);this.lastUp=e.xy;this.line.geometry.components.length===this.maxVertices+1&&this.finishGeometry()}this.stoppedDown=this.stopDown;this.mouseDown=!1;return!this.stopUp},finishGeometry:function(){var e=this.line.geometry.components.length-1;this.line.geometry.removeComponent(this.line.geometry.components[e]);this.removePoint();this.finalize()},dblclick:function(e){this.freehandMode(e)||this.finishGeometry();return!1},CLASS_NAME:"OpenLayers.Handler.Path"});OpenLayers.Handler.Polygon=OpenLayers.Class(OpenLayers.Handler.Path,{holeModifier:null,drawingHole:!1,polygon:null,createFeature:function(e){var t=this.layer.getLonLatFromViewPortPx(e),r=new OpenLayers.Geometry.Point(t.lon,t.lat);this.point=new OpenLayers.Feature.Vector(r);this.line=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LinearRing([this.point.geometry]));this.polygon=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon([this.line.geometry]));this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds();this.layer.addFeatures([this.polygon,this.point],{silent:!0})},addPoint:function(e){if(!this.drawingHole&&this.holeModifier&&this.evt&&this.evt[this.holeModifier])for(var t,r,n=this.point.geometry,i=this.control.layer.features,a=i.length-1;a>=0;--a){t=i[a].geometry;if((t instanceof OpenLayers.Geometry.Polygon||t instanceof OpenLayers.Geometry.MultiPolygon)&&t.intersects(n)){r=i[a];this.control.layer.removeFeatures([r],{silent:!0});this.control.layer.events.registerPriority("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.registerPriority("sketchmodified",this,this.enforceTopology);r.geometry.addComponent(this.line.geometry);this.polygon=r;this.drawingHole=!0;break}}OpenLayers.Handler.Path.prototype.addPoint.apply(this,arguments)},getCurrentPointIndex:function(){return this.line.geometry.components.length-2},enforceTopology:function(e){var t=e.vertex,r=this.line.geometry.components;if(!this.polygon.geometry.intersects(t)){var n=r[r.length-3];t.x=n.x;t.y=n.y}},finishGeometry:function(){var e=this.line.geometry.components.length-2;this.line.geometry.removeComponent(this.line.geometry.components[e]);this.removePoint();this.finalize()},finalizeInteriorRing:function(){var e=this.line.geometry,t=0!==e.getArea();if(t){for(var r=this.polygon.geometry.components,n=r.length-2;n>=0;--n)if(e.intersects(r[n])){t=!1;break}if(t){e:for(var n=r.length-2;n>0;--n)for(var i=r[n].components,a=0,s=i.length;s>a;++a)if(e.containsPoint(i[a])){t=!1;break e}}}t?this.polygon.state!==OpenLayers.State.INSERT&&(this.polygon.state=OpenLayers.State.UPDATE):this.polygon.geometry.removeComponent(e);this.restoreFeature();return!1},cancel:function(){if(this.drawingHole){this.polygon.geometry.removeComponent(this.line.geometry);this.restoreFeature(!0)}return OpenLayers.Handler.Path.prototype.cancel.apply(this,arguments)},restoreFeature:function(e){this.control.layer.events.unregister("sketchcomplete",this,this.finalizeInteriorRing);this.control.layer.events.unregister("sketchmodified",this,this.enforceTopology);this.layer.removeFeatures([this.polygon],{silent:!0});this.control.layer.addFeatures([this.polygon],{silent:!0});this.drawingHole=!1;e||this.control.layer.events.triggerEvent("sketchcomplete",{feature:this.polygon})},destroyFeature:function(e){OpenLayers.Handler.Path.prototype.destroyFeature.call(this,e);this.polygon=null},drawFeature:function(){this.layer.drawFeature(this.polygon,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.polygon},getGeometry:function(){var e=this.polygon&&this.polygon.geometry;e&&this.multi&&(e=new OpenLayers.Geometry.MultiPolygon([e]));return e},CLASS_NAME:"OpenLayers.Handler.Polygon"});OpenLayers.Renderer=OpenLayers.Class({container:null,root:null,extent:null,locked:!1,size:null,resolution:null,map:null,featureDx:0,initialize:function(e,t){this.container=OpenLayers.Util.getElement(e);OpenLayers.Util.extend(this,t)},destroy:function(){this.container=null;this.extent=null;this.size=null;this.resolution=null;this.map=null},supported:function(){return!1},setExtent:function(e,t){this.extent=e.clone();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var r=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/r);this.extent=e.wrapDateLine(this.map.getMaxExtent()).scale(r)}t&&(this.resolution=null);return!0},setSize:function(e){this.size=e.clone();this.resolution=null},getResolution:function(){this.resolution=this.resolution||this.map.getResolution();return this.resolution},drawFeature:function(e,t){null==t&&(t=e.style);if(e.geometry){var r=e.geometry.getBounds();if(r){var n;this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent());

r.intersectsBounds(this.extent,{worldBounds:n})?this.calculateFeatureDx(r,n):t={display:"none"};var i=this.drawGeometry(e.geometry,t,e.id);if("none"!=t.display&&t.label&&i!==!1){var a=e.geometry.getCentroid();if(t.labelXOffset||t.labelYOffset){var s=isNaN(t.labelXOffset)?0:t.labelXOffset,o=isNaN(t.labelYOffset)?0:t.labelYOffset,l=this.getResolution();a.move(s*l,o*l)}this.drawText(e.id,t,a)}else this.removeText(e.id);return i}}},calculateFeatureDx:function(e,t){this.featureDx=0;if(t){var r=t.getWidth(),n=(this.extent.left+this.extent.right)/2,i=(e.left+e.right)/2,a=Math.round((i-n)/r);this.featureDx=a*r}},drawGeometry:function(e,t,r){},drawText:function(e,t,r){},removeText:function(e){},clear:function(){},getFeatureIdFromEvent:function(e){},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0,r=e.length;r>t;++t){var n=e[t];this.eraseGeometry(n.geometry,n.id);this.removeText(n.id)}},eraseGeometry:function(e,t){},moveRoot:function(e){},getRenderLayerId:function(){return this.container.id},applyDefaultSymbolizer:function(e){var t=OpenLayers.Util.extend({},OpenLayers.Renderer.defaultSymbolizer);if(e.stroke===!1){delete t.strokeWidth;delete t.strokeColor}e.fill===!1&&delete t.fillColor;OpenLayers.Util.extend(t,e);return t},CLASS_NAME:"OpenLayers.Renderer"});OpenLayers.Renderer.defaultSymbolizer={fillColor:"#000000",strokeColor:"#000000",strokeWidth:2,fillOpacity:1,strokeOpacity:1,pointRadius:0,labelAlign:"cm"};OpenLayers.Renderer.symbol={star:[350,75,379,161,469,161,397,215,423,301,350,250,277,301,303,215,231,161,321,161,350,75],cross:[4,0,6,0,6,4,10,4,10,6,6,6,6,10,4,10,4,6,0,6,0,4,4,4,4,0],x:[0,0,25,0,50,35,75,0,100,0,65,50,100,100,75,100,50,65,25,100,0,100,35,50,0,0],square:[0,0,0,1,1,1,1,0,0,0],triangle:[0,10,10,10,5,0,0,10]};OpenLayers.Renderer.Canvas=OpenLayers.Class(OpenLayers.Renderer,{hitDetection:!0,hitOverflow:0,canvas:null,features:null,pendingRedraw:!1,cachedSymbolBounds:{},initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.root=document.createElement("canvas");this.container.appendChild(this.root);this.canvas=this.root.getContext("2d");this.features={};if(this.hitDetection){this.hitCanvas=document.createElement("canvas");this.hitContext=this.hitCanvas.getContext("2d")}},setExtent:function(){OpenLayers.Renderer.prototype.setExtent.apply(this,arguments);return!1},eraseGeometry:function(e,t){this.eraseFeatures(this.features[t][0])},supported:function(){return OpenLayers.CANVAS_SUPPORTED},setSize:function(e){this.size=e.clone();var t=this.root;t.style.width=e.w+"px";t.style.height=e.h+"px";t.width=e.w;t.height=e.h;this.resolution=null;if(this.hitDetection){var r=this.hitCanvas;r.style.width=e.w+"px";r.style.height=e.h+"px";r.width=e.w;r.height=e.h}},drawFeature:function(e,t){var r;if(e.geometry){t=this.applyDefaultSymbolizer(t||e.style);var n,i=e.geometry.getBounds();this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&(n=this.map.getMaxExtent());var a=i&&i.intersectsBounds(this.extent,{worldBounds:n});r="none"!==t.display&&!!i&&a;r?this.features[e.id]=[e,t]:delete this.features[e.id];this.pendingRedraw=!0}if(this.pendingRedraw&&!this.locked){this.redraw();this.pendingRedraw=!1}return r},drawGeometry:function(e,t,r){var n=e.CLASS_NAME;if("OpenLayers.Geometry.Collection"!=n&&"OpenLayers.Geometry.MultiPoint"!=n&&"OpenLayers.Geometry.MultiLineString"!=n&&"OpenLayers.Geometry.MultiPolygon"!=n)switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":this.drawPoint(e,t,r);break;case"OpenLayers.Geometry.LineString":this.drawLineString(e,t,r);break;case"OpenLayers.Geometry.LinearRing":this.drawLinearRing(e,t,r);break;case"OpenLayers.Geometry.Polygon":this.drawPolygon(e,t,r)}else for(var i=0;i<e.components.length;i++)this.drawGeometry(e.components[i],t,r)},drawExternalGraphic:function(e,t,r){var n=new Image,i=t.title||t.graphicTitle;i&&(n.title=i);var a=t.graphicWidth||t.graphicHeight,s=t.graphicHeight||t.graphicWidth;a=a?a:2*t.pointRadius;s=s?s:2*t.pointRadius;var o=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*a),l=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*s),c=t.graphicOpacity||t.fillOpacity,u=function(){if(this.features[r]){var t=this.getLocalXY(e),i=t[0],u=t[1];if(!isNaN(i)&&!isNaN(u)){var p=i+o|0,h=u+l|0,d=this.canvas;d.globalAlpha=c;var f=OpenLayers.Renderer.Canvas.drawImageScaleFactor||(OpenLayers.Renderer.Canvas.drawImageScaleFactor=/android 2.1/.test(navigator.userAgent.toLowerCase())?320/window.screen.width:1);d.drawImage(n,p*f,h*f,a*f,s*f);if(this.hitDetection){this.setHitContextStyle("fill",r);this.hitContext.fillRect(p,h,a,s)}}}};n.onload=OpenLayers.Function.bind(u,this);n.src=t.externalGraphic},drawNamedSymbol:function(e,t,r){var n,i,a,s,o,l,c,u,p,h=Math.PI/180,d=OpenLayers.Renderer.symbol[t.graphicName];if(!d)throw new Error(t.graphicName+" is not a valid symbol name");if(d.length&&!(d.length<2)){var f=this.getLocalXY(e),m=f[0],y=f[1];if(!isNaN(m)&&!isNaN(y)){this.canvas.lineCap="round";this.canvas.lineJoin="round";if(this.hitDetection){this.hitContext.lineCap="round";this.hitContext.lineJoin="round"}if(t.graphicName in this.cachedSymbolBounds)l=this.cachedSymbolBounds[t.graphicName];else{l=new OpenLayers.Bounds;for(o=0;o<d.length;o+=2)l.extend(new OpenLayers.LonLat(d[o],d[o+1]));this.cachedSymbolBounds[t.graphicName]=l}this.canvas.save();this.hitDetection&&this.hitContext.save();this.canvas.translate(m,y);this.hitDetection&&this.hitContext.translate(m,y);u=h*t.rotation;if(!isNaN(u)){this.canvas.rotate(u);this.hitDetection&&this.hitContext.rotate(u)}c=2*t.pointRadius/Math.max(l.getWidth(),l.getHeight());this.canvas.scale(c,c);this.hitDetection&&this.hitContext.scale(c,c);a=l.getCenterLonLat().lon;s=l.getCenterLonLat().lat;this.canvas.translate(-a,-s);this.hitDetection&&this.hitContext.translate(-a,-s);p=t.strokeWidth;t.strokeWidth=p/c;if(t.fill!==!1){this.setCanvasStyle("fill",t);this.canvas.beginPath();for(o=0;o<d.length;o+=2){n=d[o];i=d[o+1];0==o&&this.canvas.moveTo(n,i);this.canvas.lineTo(n,i)}this.canvas.closePath();this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",r,t);this.hitContext.beginPath();for(o=0;o<d.length;o+=2){n=d[o];i=d[o+1];0==o&&this.canvas.moveTo(n,i);this.hitContext.lineTo(n,i)}this.hitContext.closePath();this.hitContext.fill()}}if(t.stroke!==!1){this.setCanvasStyle("stroke",t);this.canvas.beginPath();for(o=0;o<d.length;o+=2){n=d[o];i=d[o+1];0==o&&this.canvas.moveTo(n,i);this.canvas.lineTo(n,i)}this.canvas.closePath();this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",r,t,c);this.hitContext.beginPath();for(o=0;o<d.length;o+=2){n=d[o];i=d[o+1];0==o&&this.hitContext.moveTo(n,i);this.hitContext.lineTo(n,i)}this.hitContext.closePath();this.hitContext.stroke()}}t.strokeWidth=p;this.canvas.restore();this.hitDetection&&this.hitContext.restore();this.setCanvasStyle("reset")}}},setCanvasStyle:function(e,t){if("fill"===e){this.canvas.globalAlpha=t.fillOpacity;this.canvas.fillStyle=t.fillColor}else if("stroke"===e){this.canvas.globalAlpha=t.strokeOpacity;this.canvas.strokeStyle=t.strokeColor;this.canvas.lineWidth=t.strokeWidth}else{this.canvas.globalAlpha=0;this.canvas.lineWidth=1}},featureIdToHex:function(e){var t=Number(e.split("_").pop())+1;if(t>=16777216){this.hitOverflow=t-16777215;t=t%16777216+1}var r="000000"+t.toString(16),n=r.length;r="#"+r.substring(n-6,n);return r},setHitContextStyle:function(e,t,r,n){var i=this.featureIdToHex(t);if("fill"==e){this.hitContext.globalAlpha=1;this.hitContext.fillStyle=i}else if("stroke"==e){this.hitContext.globalAlpha=1;this.hitContext.strokeStyle=i;"undefined"==typeof n?this.hitContext.lineWidth=r.strokeWidth+2:isNaN(n)||(this.hitContext.lineWidth=r.strokeWidth+2/n)}else{this.hitContext.globalAlpha=0;this.hitContext.lineWidth=1}},drawPoint:function(e,t,r){if(t.graphic!==!1)if(t.externalGraphic)this.drawExternalGraphic(e,t,r);else if(t.graphicName&&"circle"!=t.graphicName)this.drawNamedSymbol(e,t,r);else{var n=this.getLocalXY(e),i=n[0],a=n[1];if(!isNaN(i)&&!isNaN(a)){var s=2*Math.PI,o=t.pointRadius;if(t.fill!==!1){this.setCanvasStyle("fill",t);this.canvas.beginPath();this.canvas.arc(i,a,o,0,s,!0);this.canvas.fill();if(this.hitDetection){this.setHitContextStyle("fill",r,t);this.hitContext.beginPath();this.hitContext.arc(i,a,o,0,s,!0);this.hitContext.fill()}}if(t.stroke!==!1){this.setCanvasStyle("stroke",t);this.canvas.beginPath();this.canvas.arc(i,a,o,0,s,!0);this.canvas.stroke();if(this.hitDetection){this.setHitContextStyle("stroke",r,t);this.hitContext.beginPath();this.hitContext.arc(i,a,o,0,s,!0);this.hitContext.stroke()}this.setCanvasStyle("reset")}}}},drawLineString:function(e,t,r){t=OpenLayers.Util.applyDefaults({fill:!1},t);this.drawLinearRing(e,t,r)},drawLinearRing:function(e,t,r){if(t.fill!==!1){this.setCanvasStyle("fill",t);this.renderPath(this.canvas,e,t,r,"fill");if(this.hitDetection){this.setHitContextStyle("fill",r,t);this.renderPath(this.hitContext,e,t,r,"fill")}}if(t.stroke!==!1){this.setCanvasStyle("stroke",t);this.renderPath(this.canvas,e,t,r,"stroke");if(this.hitDetection){this.setHitContextStyle("stroke",r,t);this.renderPath(this.hitContext,e,t,r,"stroke")}}this.setCanvasStyle("reset")},renderPath:function(e,t,r,n,i){var a=t.components,s=a.length;e.beginPath();var o=this.getLocalXY(a[0]),l=o[0],c=o[1];if(!isNaN(l)&&!isNaN(c)){e.moveTo(o[0],o[1]);for(var u=1;s>u;++u){var p=this.getLocalXY(a[u]);e.lineTo(p[0],p[1])}"fill"===i?e.fill():e.stroke()}},drawPolygon:function(e,t,r){var n=e.components,i=n.length;this.drawLinearRing(n[0],t,r);for(var a=1;i>a;++a){this.canvas.globalCompositeOperation="destination-out";this.hitDetection&&(this.hitContext.globalCompositeOperation="destination-out");this.drawLinearRing(n[a],OpenLayers.Util.applyDefaults({stroke:!1,fillOpacity:1},t),r);this.canvas.globalCompositeOperation="source-over";this.hitDetection&&(this.hitContext.globalCompositeOperation="source-over");this.drawLinearRing(n[a],OpenLayers.Util.applyDefaults({fill:!1},t),r)}},drawText:function(e,t){var r=this.getLocalXY(e);this.setCanvasStyle("reset");this.canvas.fillStyle=t.fontColor;this.canvas.globalAlpha=t.fontOpacity||1;var n=[t.fontStyle?t.fontStyle:"normal","normal",t.fontWeight?t.fontWeight:"normal",t.fontSize?t.fontSize:"1em",t.fontFamily?t.fontFamily:"sans-serif"].join(" "),i=t.label.split("\n"),a=i.length;if(this.canvas.fillText){this.canvas.font=n;this.canvas.textAlign=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[0]]||"center";this.canvas.textBaseline=OpenLayers.Renderer.Canvas.LABEL_ALIGN[t.labelAlign[1]]||"middle";var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var o=this.canvas.measureText("Mg").height||this.canvas.measureText("xx").width;r[1]+=o*s*(a-1);for(var l=0;a>l;l++){if(t.labelOutlineWidth){this.canvas.save();this.canvas.globalAlpha=t.labelOutlineOpacity||t.fontOpacity||1;this.canvas.strokeStyle=t.labelOutlineColor;this.canvas.lineWidth=t.labelOutlineWidth;this.canvas.strokeText(i[l],r[0],r[1]+o*l+1);this.canvas.restore()}this.canvas.fillText(i[l],r[0],r[1]+o*l)}}else if(this.canvas.mozDrawText){this.canvas.mozTextStyle=n;var c=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[0]];null==c&&(c=-.5);var s=OpenLayers.Renderer.Canvas.LABEL_FACTOR[t.labelAlign[1]];null==s&&(s=-.5);var o=this.canvas.mozMeasureText("xx");r[1]+=o*(1+s*a);for(var l=0;a>l;l++){var u=r[0]+c*this.canvas.mozMeasureText(i[l]),p=r[1]+l*o;this.canvas.translate(u,p);this.canvas.mozDrawText(i[l]);this.canvas.translate(-u,-p)}}this.setCanvasStyle("reset")},getLocalXY:function(e){var t=this.getResolution(),r=this.extent,n=(e.x-this.featureDx)/t+-r.left/t,i=r.top/t-e.y/t;return[n,i]},clear:function(){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e);this.features={};this.hitDetection&&this.hitContext.clearRect(0,0,t,e)},getFeatureIdFromEvent:function(e){var t,r;if(this.hitDetection&&"none"!==this.root.style.display&&!this.map.dragging){var n=e.xy,i=0|n.x,a=0|n.y,s=this.hitContext.getImageData(i,a,1,1).data;if(255===s[3]){var o=s[2]+256*(s[1]+256*s[0]);if(o){t="OpenLayers_Feature_Vector_"+(o-1+this.hitOverflow);try{r=this.features[t][0]}catch(l){}}}}return r},eraseFeatures:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t)delete this.features[e[t].id];this.redraw()},redraw:function(){if(!this.locked){var e=this.root.height,t=this.root.width;this.canvas.clearRect(0,0,t,e);this.hitDetection&&this.hitContext.clearRect(0,0,t,e);var r,n,i,a=[],s=this.map.baseLayer&&this.map.baseLayer.wrapDateLine&&this.map.getMaxExtent();for(var o in this.features)if(this.features.hasOwnProperty(o)){r=this.features[o][0];n=r.geometry;this.calculateFeatureDx(n.getBounds(),s);i=this.features[o][1];this.drawGeometry(n,i,r.id);i.label&&a.push([r,i])}for(var l,c=0,u=a.length;u>c;++c){l=a[c];this.drawText(l[0].geometry.getCentroid(),l[1])}}},CLASS_NAME:"OpenLayers.Renderer.Canvas"});OpenLayers.Renderer.Canvas.LABEL_ALIGN={l:"left",r:"right",t:"top",b:"bottom"};OpenLayers.Renderer.Canvas.LABEL_FACTOR={l:0,r:-1,t:0,b:-1};OpenLayers.Renderer.Canvas.drawImageScaleFactor=null;OpenLayers.Handler.MouseWheel=OpenLayers.Class(OpenLayers.Handler,{wheelListener:null,interval:0,maxDelta:Number.POSITIVE_INFINITY,delta:0,cumulative:!0,initialize:function(e,t,r){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.wheelListener=OpenLayers.Function.bindAsEventListener(this.onWheelEvent,this)},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);this.wheelListener=null},onWheelEvent:function(e){if(this.map&&this.checkModifiers(e)){for(var t=!1,r=!1,n=!1,i=OpenLayers.Event.element(e);null!=i&&!n&&!t;){if(!t)try{var a;if(i.currentStyle)a=i.currentStyle.overflow;else{var s=document.defaultView.getComputedStyle(i,null);a=s.getPropertyValue("overflow")}t=a&&"auto"==a||"scroll"==a}catch(o){}if(!r){r=OpenLayers.Element.hasClass(i,"olScrollable");if(!r)for(var l=0,c=this.map.layers.length;c>l;l++){var u=this.map.layers[l];if(i==u.div||i==u.pane){r=!0;break}}}n=i==this.map.div;i=i.parentNode}if(!t&&n){if(r){var p=0;if(e.wheelDelta){p=e.wheelDelta;p%160===0&&(p=.75*p);p/=120}else e.detail&&(p=-(e.detail/Math.abs(e.detail)));this.delta+=p;window.clearTimeout(this._timeoutId);if(this.interval&&Math.abs(this.delta)<this.maxDelta){var h=OpenLayers.Util.extend({},e);this._timeoutId=window.setTimeout(OpenLayers.Function.bind(function(){this.wheelZoom(h)},this),this.interval)}else this.wheelZoom(e)}OpenLayers.Event.stop(e)}}},wheelZoom:function(e){var t=this.delta;this.delta=0;if(t){e.xy=this.map.events.getMousePosition(e);0>t?this.callback("down",[e,this.cumulative?Math.max(-this.maxDelta,t):-1]):this.callback("up",[e,this.cumulative?Math.min(this.maxDelta,t):1])}},activate:function(e){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){var t=this.wheelListener;OpenLayers.Event.observe(window,"DOMMouseScroll",t);OpenLayers.Event.observe(window,"mousewheel",t);OpenLayers.Event.observe(document,"mousewheel",t);return!0}return!1},deactivate:function(e){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){var t=this.wheelListener;OpenLayers.Event.stopObserving(window,"DOMMouseScroll",t);OpenLayers.Event.stopObserving(window,"mousewheel",t);OpenLayers.Event.stopObserving(document,"mousewheel",t);return!0}return!1},CLASS_NAME:"OpenLayers.Handler.MouseWheel"});OpenLayers.Format.WMSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.1.1",profile:null,CLASS_NAME:"OpenLayers.Format.WMSCapabilities"});OpenLayers.Format.WMSCapabilities.v1=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{wms:"http://www.opengis.net/wms",xlink:"http://www.w3.org/1999/xlink",xsi:"http://www.w3.org/2001/XMLSchema-instance"},defaultPrefix:"wms",read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var t=e;e&&9==e.nodeType&&(e=e.documentElement);var r={};this.readNode(e,r);if(void 0===r.service){var n=new OpenLayers.Format.OGCExceptionReport;r.error=n.read(t)}return r},readers:{wms:{Service:function(e,t){t.service={};this.readChildNodes(e,t.service)},Name:function(e,t){t.name=this.getChildValue(e)},Title:function(e,t){t.title=this.getChildValue(e)},Abstract:function(e,t){t["abstract"]=this.getChildValue(e)},BoundingBox:function(e,t){var r={};r.bbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))];var n={x:parseFloat(e.getAttribute("resx")),y:parseFloat(e.getAttribute("resy"))};isNaN(n.x)&&isNaN(n.y)||(r.res=n);return r},OnlineResource:function(e,t){t.href=this.getAttributeNS(e,this.namespaces.xlink,"href")},ContactInformation:function(e,t){t.contactInformation={};this.readChildNodes(e,t.contactInformation)},ContactPersonPrimary:function(e,t){t.personPrimary={};this.readChildNodes(e,t.personPrimary)},ContactPerson:function(e,t){t.person=this.getChildValue(e)},ContactOrganization:function(e,t){t.organization=this.getChildValue(e)},ContactPosition:function(e,t){t.position=this.getChildValue(e)},ContactAddress:function(e,t){t.contactAddress={};this.readChildNodes(e,t.contactAddress)},AddressType:function(e,t){t.type=this.getChildValue(e)},Address:function(e,t){t.address=this.getChildValue(e)},City:function(e,t){t.city=this.getChildValue(e)},StateOrProvince:function(e,t){t.stateOrProvince=this.getChildValue(e)},PostCode:function(e,t){t.postcode=this.getChildValue(e)},Country:function(e,t){t.country=this.getChildValue(e)},ContactVoiceTelephone:function(e,t){t.phone=this.getChildValue(e)},ContactFacsimileTelephone:function(e,t){t.fax=this.getChildValue(e)},ContactElectronicMailAddress:function(e,t){t.email=this.getChildValue(e)},Fees:function(e,t){var r=this.getChildValue(e);r&&"none"!=r.toLowerCase()&&(t.fees=r)},AccessConstraints:function(e,t){var r=this.getChildValue(e);r&&"none"!=r.toLowerCase()&&(t.accessConstraints=r)},Capability:function(e,t){t.capability={nestedLayers:[],layers:[]};this.readChildNodes(e,t.capability)},Request:function(e,t){t.request={};this.readChildNodes(e,t.request)},GetCapabilities:function(e,t){t.getcapabilities={formats:[]};this.readChildNodes(e,t.getcapabilities)},Format:function(e,t){OpenLayers.Util.isArray(t.formats)?t.formats.push(this.getChildValue(e)):t.format=this.getChildValue(e)},DCPType:function(e,t){this.readChildNodes(e,t)},HTTP:function(e,t){this.readChildNodes(e,t)},Get:function(e,t){t.get={};this.readChildNodes(e,t.get);t.href||(t.href=t.get.href)},Post:function(e,t){t.post={};this.readChildNodes(e,t.post);t.href||(t.href=t.get.href)},GetMap:function(e,t){t.getmap={formats:[]};this.readChildNodes(e,t.getmap)},GetFeatureInfo:function(e,t){t.getfeatureinfo={formats:[]};this.readChildNodes(e,t.getfeatureinfo)},Exception:function(e,t){t.exception={formats:[]};this.readChildNodes(e,t.exception)},Layer:function(e,t){var r,n;if(t.capability){n=t.capability;r=t}else n=t;var i=e.getAttributeNode("queryable"),a=i&&i.specified?e.getAttribute("queryable"):null;i=e.getAttributeNode("cascaded");var s=i&&i.specified?e.getAttribute("cascaded"):null;i=e.getAttributeNode("opaque");var o=i&&i.specified?e.getAttribute("opaque"):null,l=e.getAttribute("noSubsets"),c=e.getAttribute("fixedWidth"),u=e.getAttribute("fixedHeight"),p=r||{},h=OpenLayers.Util.extend,d={nestedLayers:[],styles:r?[].concat(r.styles):[],srs:r?h({},p.srs):{},metadataURLs:[],bbox:r?h({},p.bbox):{},llbbox:p.llbbox,dimensions:r?h({},p.dimensions):{},authorityURLs:r?h({},p.authorityURLs):{},identifiers:{},keywords:[],queryable:a&&""!==a?"1"===a||"true"===a:p.queryable||!1,cascaded:null!==s?parseInt(s):p.cascaded||0,opaque:o?"1"===o||"true"===o:p.opaque||!1,noSubsets:null!==l?"1"===l||"true"===l:p.noSubsets||!1,fixedWidth:null!=c?parseInt(c):p.fixedWidth||0,fixedHeight:null!=u?parseInt(u):p.fixedHeight||0,minScale:p.minScale,maxScale:p.maxScale,attribution:p.attribution};t.nestedLayers.push(d);d.capability=n;this.readChildNodes(e,d);delete d.capability;if(d.name){var f=d.name.split(":"),m=n.request,y=m.getfeatureinfo;f.length>0&&(d.prefix=f[0]);n.layers.push(d);void 0===d.formats&&(d.formats=m.getmap.formats);void 0===d.infoFormats&&y&&(d.infoFormats=y.formats)}},Attribution:function(e,t){t.attribution={};this.readChildNodes(e,t.attribution)},LogoURL:function(e,t){t.logo={width:e.getAttribute("width"),height:e.getAttribute("height")};this.readChildNodes(e,t.logo)},Style:function(e,t){var r={};t.styles.push(r);this.readChildNodes(e,r)},LegendURL:function(e,t){var r={width:e.getAttribute("width"),height:e.getAttribute("height")};t.legend=r;this.readChildNodes(e,r)},MetadataURL:function(e,t){var r={type:e.getAttribute("type")};t.metadataURLs.push(r);this.readChildNodes(e,r)},DataURL:function(e,t){t.dataURL={};this.readChildNodes(e,t.dataURL)},FeatureListURL:function(e,t){t.featureListURL={};this.readChildNodes(e,t.featureListURL)},AuthorityURL:function(e,t){var r=e.getAttribute("name"),n={};this.readChildNodes(e,n);t.authorityURLs[r]=n.href},Identifier:function(e,t){var r=e.getAttribute("authority");t.identifiers[r]=this.getChildValue(e)},KeywordList:function(e,t){this.readChildNodes(e,t)},SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1"});OpenLayers.Format.WMSCapabilities.v1_3=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMS_Capabilities:function(e,t){this.readChildNodes(e,t)},LayerLimit:function(e,t){t.layerLimit=parseInt(this.getChildValue(e))},MaxWidth:function(e,t){t.maxWidth=parseInt(this.getChildValue(e))},MaxHeight:function(e,t){t.maxHeight=parseInt(this.getChildValue(e))},BoundingBox:function(e,t){var r=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);r.srs=e.getAttribute("CRS");t.bbox[r.srs]=r},CRS:function(e,t){this.readers.wms.SRS.apply(this,[e,t])},EX_GeographicBoundingBox:function(e,t){t.llbbox=[];this.readChildNodes(e,t.llbbox)},westBoundLongitude:function(e,t){t[0]=this.getChildValue(e)},eastBoundLongitude:function(e,t){t[2]=this.getChildValue(e)},southBoundLatitude:function(e,t){t[1]=this.getChildValue(e)},northBoundLatitude:function(e,t){t[3]=this.getChildValue(e)},MinScaleDenominator:function(e,t){t.maxScale=parseFloat(this.getChildValue(e)).toPrecision(16)},MaxScaleDenominator:function(e,t){t.minScale=parseFloat(this.getChildValue(e)).toPrecision(16)},Dimension:function(e,t){var r=e.getAttribute("name").toLowerCase(),n={name:r,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol"),nearestVal:"1"===e.getAttribute("nearestValue"),multipleVal:"1"===e.getAttribute("multipleValues"),"default":e.getAttribute("default")||"",current:"1"===e.getAttribute("current"),values:this.getChildValue(e).split(",")};t.dimensions[n.name]=n},Keyword:function(e,t){var r={value:this.getChildValue(e),vocabulary:e.getAttribute("vocabulary")};t.keywords&&t.keywords.push(r)}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms),sld:{UserDefinedSymbolization:function(e,t){this.readers.wms.UserDefinedSymbolization.apply(this,[e,t]);t.userSymbols.inlineFeature=1==parseInt(e.getAttribute("InlineFeature"));t.userSymbols.remoteWCS=1==parseInt(e.getAttribute("RemoteWCS"))},DescribeLayer:function(e,t){this.readers.wms.DescribeLayer.apply(this,[e,t])},GetLegendGraphic:function(e,t){this.readers.wms.GetLegendGraphic.apply(this,[e,t])}}},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3"});OpenLayers.Format.WMSCapabilities.v1_3_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_3,{version:"1.3.0",CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_3_0"});OpenLayers.Format.GML.v2=OpenLayers.Class(OpenLayers.Format.GML.Base,{schemaLocation:"http://www.opengis.net/gml http://schemas.opengis.net/gml/2.1.2/feature.xsd",initialize:function(e){OpenLayers.Format.GML.Base.prototype.initialize.apply(this,[e])},readers:{gml:OpenLayers.Util.applyDefaults({outerBoundaryIs:function(e,t){var r={};this.readChildNodes(e,r);t.outer=r.components[0]},innerBoundaryIs:function(e,t){var r={};this.readChildNodes(e,r);t.inner.push(r.components[0])},Box:function(e,t){var r={};this.readChildNodes(e,r);t.components||(t.components=[]);var n=r.points[0],i=r.points[1];t.components.push(new OpenLayers.Bounds(n.x,n.y,i.x,i.y))}},OpenLayers.Format.GML.Base.prototype.readers.gml),feature:OpenLayers.Format.GML.Base.prototype.readers.feature,wfs:OpenLayers.Format.GML.Base.prototype.readers.wfs},write:function(e){var t;t=OpenLayers.Util.isArray(e)?"wfs:FeatureCollection":"gml:featureMember";var r=this.writeNode(t,e);this.setAttributeNS(r,this.namespaces.xsi,"xsi:schemaLocation",this.schemaLocation);return OpenLayers.Format.XML.prototype.write.apply(this,[r])},writers:{gml:OpenLayers.Util.applyDefaults({Point:function(e){var t=this.createElementNSPlus("gml:Point");this.writeNode("coordinates",[e],t);return t},coordinates:function(e){for(var t,r=e.length,n=new Array(r),i=0;r>i;++i){t=e[i];n[i]=this.xy?t.x+","+t.y:t.y+","+t.x;void 0!=t.z&&(n[i]+=","+t.z)}return this.createElementNSPlus("gml:coordinates",{attributes:{decimal:".",cs:",",ts:" "},value:1==r?n[0]:n.join(" ")})},LineString:function(e){var t=this.createElementNSPlus("gml:LineString");this.writeNode("coordinates",e.components,t);return t},Polygon:function(e){var t=this.createElementNSPlus("gml:Polygon");this.writeNode("outerBoundaryIs",e.components[0],t);for(var r=1;r<e.components.length;++r)this.writeNode("innerBoundaryIs",e.components[r],t);return t},outerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:outerBoundaryIs");this.writeNode("LinearRing",e,t);return t},innerBoundaryIs:function(e){var t=this.createElementNSPlus("gml:innerBoundaryIs");this.writeNode("LinearRing",e,t);return t},LinearRing:function(e){var t=this.createElementNSPlus("gml:LinearRing");this.writeNode("coordinates",e.components,t);return t},Box:function(e){var t=this.createElementNSPlus("gml:Box");this.writeNode("coordinates",[{x:e.left,y:e.bottom},{x:e.right,y:e.top}],t);this.srsName&&t.setAttribute("srsName",this.srsName);return t}},OpenLayers.Format.GML.Base.prototype.writers.gml),feature:OpenLayers.Format.GML.Base.prototype.writers.feature,wfs:OpenLayers.Format.GML.Base.prototype.writers.wfs},CLASS_NAME:"OpenLayers.Format.GML.v2"});OpenLayers.Format.Filter.v1_0_0=OpenLayers.Class(OpenLayers.Format.GML.v2,OpenLayers.Format.Filter.v1,{VERSION:"1.0.0",schemaLocation:"http://www.opengis.net/ogc/filter/1.0.0/filter.xsd",initialize:function(e){OpenLayers.Format.GML.v2.prototype.initialize.apply(this,[e])},readers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsNotEqualTo:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.NOT_EQUAL_TO});this.readChildNodes(e,r);t.filters.push(r)},PropertyIsLike:function(e,t){var r=new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.LIKE});this.readChildNodes(e,r);var n=e.getAttribute("wildCard"),i=e.getAttribute("singleChar"),a=e.getAttribute("escape");r.value2regex(n,i,a);t.filters.push(r)}},OpenLayers.Format.Filter.v1.prototype.readers.ogc),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature},writers:{ogc:OpenLayers.Util.applyDefaults({PropertyIsEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsNotEqualTo:function(e){var t=this.createElementNSPlus("ogc:PropertyIsNotEqualTo");this.writeNode("PropertyName",e,t);this.writeOgcExpression(e.value,t);return t},PropertyIsLike:function(e){var t=this.createElementNSPlus("ogc:PropertyIsLike",{attributes:{wildCard:"*",singleChar:".",escape:"!"}});this.writeNode("PropertyName",e,t);this.writeNode("Literal",e.regex2value(),t);return t},BBOX:function(e){var t=this.createElementNSPlus("ogc:BBOX");e.property&&this.writeNode("PropertyName",e,t);var r=this.writeNode("gml:Box",e.value,t);e.projection&&r.setAttribute("srsName",e.projection);return t}},OpenLayers.Format.Filter.v1.prototype.writers.ogc),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature},writeSpatial:function(e,t){var r=this.createElementNSPlus("ogc:"+t);this.writeNode("PropertyName",e,r);if(e.value instanceof OpenLayers.Filter.Function)this.writeNode("Function",e.value,r);else{var n;n=e.value instanceof OpenLayers.Geometry?this.writeNode("feature:_geometry",e.value).firstChild:this.writeNode("gml:Box",e.value);e.projection&&n.setAttribute("srsName",e.projection);r.appendChild(n)}return r},CLASS_NAME:"OpenLayers.Format.Filter.v1_0_0"});OpenLayers.Format.WFST.v1_0_0=OpenLayers.Class(OpenLayers.Format.Filter.v1_0_0,OpenLayers.Format.WFST.v1,{version:"1.0.0",srsNameInQuery:!1,schemaLocations:{wfs:"http://schemas.opengis.net/wfs/1.0.0/WFS-transaction.xsd"},initialize:function(e){OpenLayers.Format.Filter.v1_0_0.prototype.initialize.apply(this,[e]);OpenLayers.Format.WFST.v1.prototype.initialize.apply(this,[e])},readNode:function(e,t,r){return OpenLayers.Format.GML.v2.prototype.readNode.apply(this,arguments)},readers:{wfs:OpenLayers.Util.applyDefaults({WFS_TransactionResponse:function(e,t){t.insertIds=[];t.success=!1;this.readChildNodes(e,t)},InsertResult:function(e,t){var r={fids:[]};this.readChildNodes(e,r);t.insertIds=t.insertIds.concat(r.fids)},TransactionResult:function(e,t){this.readChildNodes(e,t)},Status:function(e,t){this.readChildNodes(e,t)},SUCCESS:function(e,t){t.success=!0}},OpenLayers.Format.WFST.v1.prototype.readers.wfs),gml:OpenLayers.Format.GML.v2.prototype.readers.gml,feature:OpenLayers.Format.GML.v2.prototype.readers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.readers.ogc},writers:{wfs:OpenLayers.Util.applyDefaults({Query:function(e){e=OpenLayers.Util.extend({featureNS:this.featureNS,featurePrefix:this.featurePrefix,featureType:this.featureType,srsName:this.srsName,srsNameInQuery:this.srsNameInQuery},e);var t=e.featurePrefix,r=this.createElementNSPlus("wfs:Query",{attributes:{typeName:(t?t+":":"")+e.featureType}});e.srsNameInQuery&&e.srsName&&r.setAttribute("srsName",e.srsName);e.featureNS&&r.setAttribute("xmlns:"+t,e.featureNS);if(e.propertyNames)for(var n=0,i=e.propertyNames.length;i>n;n++)this.writeNode("ogc:PropertyName",{property:e.propertyNames[n]},r);if(e.filter){this.setFilterProperty(e.filter);this.writeNode("ogc:Filter",e.filter,r)}return r}},OpenLayers.Format.WFST.v1.prototype.writers.wfs),gml:OpenLayers.Format.GML.v2.prototype.writers.gml,feature:OpenLayers.Format.GML.v2.prototype.writers.feature,ogc:OpenLayers.Format.Filter.v1_0_0.prototype.writers.ogc},CLASS_NAME:"OpenLayers.Format.WFST.v1_0_0"});OpenLayers.ElementsIndexer=OpenLayers.Class({maxZIndex:null,order:null,indices:null,compare:null,initialize:function(e){this.compare=e?OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_Y_ORDER:OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER_DRAWING_ORDER;this.clear()},insert:function(e){this.exists(e)&&this.remove(e);var t=e.id;this.determineZIndex(e);for(var r,n=-1,i=this.order.length;i-n>1;){r=parseInt((n+i)/2);var a=this.compare(this,e,OpenLayers.Util.getElement(this.order[r]));a>0?n=r:i=r}this.order.splice(i,0,t);this.indices[t]=this.getZIndex(e);return this.getNextElement(i)},remove:function(e){var t=e.id,r=OpenLayers.Util.indexOf(this.order,t);if(r>=0){this.order.splice(r,1);delete this.indices[t];if(this.order.length>0){var n=this.order[this.order.length-1];this.maxZIndex=this.indices[n]}else this.maxZIndex=0}},clear:function(){this.order=[];this.indices={};this.maxZIndex=0},exists:function(e){return null!=this.indices[e.id]},getZIndex:function(e){return e._style.graphicZIndex},determineZIndex:function(e){var t=e._style.graphicZIndex;if(null==t){t=this.maxZIndex;e._style.graphicZIndex=t}else t>this.maxZIndex&&(this.maxZIndex=t)},getNextElement:function(e){var t=e+1;if(t<this.order.length){var r=OpenLayers.Util.getElement(this.order[t]);void 0==r&&(r=this.getNextElement(t));

return r}return null},CLASS_NAME:"OpenLayers.ElementsIndexer"});OpenLayers.ElementsIndexer.IndexingMethods={Z_ORDER:function(e,t,r){var n=e.getZIndex(t),i=0;if(r){var a=e.getZIndex(r);i=n-a}return i},Z_ORDER_DRAWING_ORDER:function(e,t,r){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,r);r&&0==n&&(n=1);return n},Z_ORDER_Y_ORDER:function(e,t,r){var n=OpenLayers.ElementsIndexer.IndexingMethods.Z_ORDER(e,t,r);if(r&&0===n){var i=r._boundsBottom-t._boundsBottom;n=0===i?1:i}return n}};OpenLayers.Renderer.Elements=OpenLayers.Class(OpenLayers.Renderer,{rendererRoot:null,root:null,vectorRoot:null,textRoot:null,xmlns:null,xOffset:0,indexer:null,BACKGROUND_ID_SUFFIX:"_background",LABEL_ID_SUFFIX:"_label",LABEL_OUTLINE_SUFFIX:"_outline",initialize:function(e,t){OpenLayers.Renderer.prototype.initialize.apply(this,arguments);this.rendererRoot=this.createRenderRoot();this.root=this.createRoot("_root");this.vectorRoot=this.createRoot("_vroot");this.textRoot=this.createRoot("_troot");this.root.appendChild(this.vectorRoot);this.root.appendChild(this.textRoot);this.rendererRoot.appendChild(this.root);this.container.appendChild(this.rendererRoot);t&&(t.zIndexing||t.yOrdering)&&(this.indexer=new OpenLayers.ElementsIndexer(t.yOrdering))},destroy:function(){this.clear();this.rendererRoot=null;this.root=null;this.xmlns=null;OpenLayers.Renderer.prototype.destroy.apply(this,arguments)},clear:function(){var e,t=this.vectorRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);t=this.textRoot;if(t)for(;e=t.firstChild;)t.removeChild(e);this.indexer&&this.indexer.clear()},setExtent:function(e,t){var r=OpenLayers.Renderer.prototype.setExtent.apply(this,arguments),n=this.getResolution();if(this.map.baseLayer&&this.map.baseLayer.wrapDateLine){var i,a=e.getWidth()/this.map.getExtent().getWidth(),e=e.scale(1/a),s=this.map.getMaxExtent();s.right>e.left&&s.right<e.right?i=!0:s.left>e.left&&s.left<e.right&&(i=!1);if(i!==this.rightOfDateLine||t){r=!1;this.xOffset=i===!0?s.getWidth()/n:0}this.rightOfDateLine=i}return r},getNodeType:function(e,t){},drawGeometry:function(e,t,r){var n=e.CLASS_NAME,i=!0;if("OpenLayers.Geometry.Collection"==n||"OpenLayers.Geometry.MultiPoint"==n||"OpenLayers.Geometry.MultiLineString"==n||"OpenLayers.Geometry.MultiPolygon"==n){for(var a=0,s=e.components.length;s>a;a++)i=this.drawGeometry(e.components[a],t,r)&&i;return i}i=!1;var o=!1;if("none"!=t.display){t.backgroundGraphic?this.redrawBackgroundNode(e.id,e,t,r):o=!0;i=this.redrawNode(e.id,e,t,r)}if(0==i){var l=document.getElementById(e.id);if(l){l._style.backgroundGraphic&&(o=!0);l.parentNode.removeChild(l)}}if(o){var l=document.getElementById(e.id+this.BACKGROUND_ID_SUFFIX);l&&l.parentNode.removeChild(l)}return i},redrawNode:function(e,t,r,n){r=this.applyDefaultSymbolizer(r);var i=this.nodeFactory(e,this.getNodeType(t,r));i._featureId=n;i._boundsBottom=t.getBounds().bottom;i._geometryClass=t.CLASS_NAME;i._style=r;var a=this.drawGeometryNode(i,t,r);if(a===!1)return!1;i=a.node;if(this.indexer){var s=this.indexer.insert(i);s?this.vectorRoot.insertBefore(i,s):this.vectorRoot.appendChild(i)}else i.parentNode!==this.vectorRoot&&this.vectorRoot.appendChild(i);this.postDraw(i);return a.complete},redrawBackgroundNode:function(e,t,r,n){var i=OpenLayers.Util.extend({},r);i.externalGraphic=i.backgroundGraphic;i.graphicXOffset=i.backgroundXOffset;i.graphicYOffset=i.backgroundYOffset;i.graphicZIndex=i.backgroundGraphicZIndex;i.graphicWidth=i.backgroundWidth||i.graphicWidth;i.graphicHeight=i.backgroundHeight||i.graphicHeight;i.backgroundGraphic=null;i.backgroundXOffset=null;i.backgroundYOffset=null;i.backgroundGraphicZIndex=null;return this.redrawNode(e+this.BACKGROUND_ID_SUFFIX,t,i,null)},drawGeometryNode:function(e,t,r){r=r||e._style;var n,i={isFilled:void 0===r.fill?!0:r.fill,isStroked:void 0===r.stroke?!!r.strokeWidth:r.stroke};switch(t.CLASS_NAME){case"OpenLayers.Geometry.Point":if(r.graphic===!1){i.isFilled=!1;i.isStroked=!1}n=this.drawPoint(e,t);break;case"OpenLayers.Geometry.LineString":i.isFilled=!1;n=this.drawLineString(e,t);break;case"OpenLayers.Geometry.LinearRing":n=this.drawLinearRing(e,t);break;case"OpenLayers.Geometry.Polygon":n=this.drawPolygon(e,t);break;case"OpenLayers.Geometry.Rectangle":n=this.drawRectangle(e,t)}e._options=i;return 0!=n?{node:this.setStyle(e,r,i,t),complete:n}:!1},postDraw:function(e){},drawPoint:function(e,t){},drawLineString:function(e,t){},drawLinearRing:function(e,t){},drawPolygon:function(e,t){},drawRectangle:function(e,t){},drawCircle:function(e,t){},removeText:function(e){var t=document.getElementById(e+this.LABEL_ID_SUFFIX);t&&this.textRoot.removeChild(t);var r=document.getElementById(e+this.LABEL_OUTLINE_SUFFIX);r&&this.textRoot.removeChild(r)},getFeatureIdFromEvent:function(e){var t=e.target,r=t&&t.correspondingUseElement,n=r?r:t||e.srcElement;return n._featureId},eraseGeometry:function(e,t){if("OpenLayers.Geometry.MultiPoint"==e.CLASS_NAME||"OpenLayers.Geometry.MultiLineString"==e.CLASS_NAME||"OpenLayers.Geometry.MultiPolygon"==e.CLASS_NAME||"OpenLayers.Geometry.Collection"==e.CLASS_NAME)for(var r=0,n=e.components.length;n>r;r++)this.eraseGeometry(e.components[r],t);else{var i=OpenLayers.Util.getElement(e.id);if(i&&i.parentNode){if(i.geometry){i.geometry.destroy();i.geometry=null}i.parentNode.removeChild(i);this.indexer&&this.indexer.remove(i);if(i._style.backgroundGraphic){var a=e.id+this.BACKGROUND_ID_SUFFIX,s=OpenLayers.Util.getElement(a);s&&s.parentNode&&s.parentNode.removeChild(s)}}}},nodeFactory:function(e,t){var r=OpenLayers.Util.getElement(e);if(r){if(!this.nodeTypeCompare(r,t)){r.parentNode.removeChild(r);r=this.nodeFactory(e,t)}}else r=this.createNode(t,e);return r},nodeTypeCompare:function(e,t){},createNode:function(e,t){},moveRoot:function(e){var t=this.root;e.root.parentNode==this.rendererRoot&&(t=e.root);t.parentNode.removeChild(t);e.rendererRoot.appendChild(t)},getRenderLayerId:function(){return this.root.parentNode.parentNode.id},isComplexSymbol:function(e){return"circle"!=e&&!!e},CLASS_NAME:"OpenLayers.Renderer.Elements"});OpenLayers.Strategy=OpenLayers.Class({layer:null,options:null,active:null,autoActivate:!0,autoDestroy:!0,initialize:function(e){OpenLayers.Util.extend(this,e);this.options=e;this.active=!1},destroy:function(){this.deactivate();this.layer=null;this.options=null},setLayer:function(e){this.layer=e},activate:function(){if(!this.active){this.active=!0;return!0}return!1},deactivate:function(){if(this.active){this.active=!1;return!0}return!1},CLASS_NAME:"OpenLayers.Strategy"});OpenLayers.Strategy.Fixed=OpenLayers.Class(OpenLayers.Strategy,{preload:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(e){this.layer.events.on({refresh:this.load,scope:this});1==this.layer.visibility||this.preload?this.load():this.layer.events.on({visibilitychanged:this.load,scope:this})}return e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);e&&this.layer.events.un({refresh:this.load,visibilitychanged:this.load,scope:this});return e},load:function(e){var t=this.layer;t.events.triggerEvent("loadstart",{filter:t.filter});t.protocol.read(OpenLayers.Util.applyDefaults({callback:this.merge,filter:t.filter,scope:this},e));t.events.un({visibilitychanged:this.load,scope:this})},merge:function(e){var t=this.layer;t.destroyFeatures();var r=e.features;if(r&&r.length>0){var n=t.projection,i=t.map.getProjectionObject();if(!i.equals(n))for(var a,s=0,o=r.length;o>s;++s){a=r[s].geometry;a&&a.transform(n,i)}t.addFeatures(r)}t.events.triggerEvent("loadend",{response:e})},CLASS_NAME:"OpenLayers.Strategy.Fixed"});OpenLayers.Protocol=OpenLayers.Class({format:null,options:null,autoDestroy:!0,defaultFilter:null,initialize:function(e){e=e||{};OpenLayers.Util.extend(this,e);this.options=e},mergeWithDefaultFilter:function(e){var t;t=e&&this.defaultFilter?new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:[this.defaultFilter,e]}):e||this.defaultFilter||void 0;return t},destroy:function(){this.options=null;this.format=null},read:function(e){e=e||{};e.filter=this.mergeWithDefaultFilter(e.filter)},create:function(){},update:function(){},"delete":function(){},commit:function(){},abort:function(e){},createCallback:function(e,t,r){return OpenLayers.Function.bind(function(){e.apply(this,[t,r])},this)},CLASS_NAME:"OpenLayers.Protocol"});OpenLayers.Protocol.Response=OpenLayers.Class({code:null,requestType:null,last:!0,features:null,data:null,reqFeatures:null,priv:null,error:null,initialize:function(e){OpenLayers.Util.extend(this,e)},success:function(){return this.code>0},CLASS_NAME:"OpenLayers.Protocol.Response"});OpenLayers.Protocol.Response.SUCCESS=1;OpenLayers.Protocol.Response.FAILURE=0;OpenLayers.Protocol.WFS=function(e){e=OpenLayers.Util.applyDefaults(e,OpenLayers.Protocol.WFS.DEFAULTS);var t=OpenLayers.Protocol.WFS["v"+e.version.replace(/\./g,"_")];if(!t)throw"Unsupported WFS version: "+e.version;return new t(e)};OpenLayers.Protocol.WFS.fromWMSLayer=function(e,t){var r,n,i=e.params.LAYERS,a=(OpenLayers.Util.isArray(i)?i[0]:i).split(":");a.length>1&&(n=a[0]);r=a.pop();var s={url:e.url,featureType:r,featurePrefix:n,srsName:e.projection&&e.projection.getCode()||e.map&&e.map.getProjectionObject().getCode(),version:"1.1.0"};return new OpenLayers.Protocol.WFS(OpenLayers.Util.applyDefaults(t,s))};OpenLayers.Protocol.WFS.DEFAULTS={version:"1.0.0"};OpenLayers.Layer.Markers=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,markers:null,drawn:!1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.markers=[]},destroy:function(){this.clearMarkers();this.markers=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},setOpacity:function(e){if(e!=this.opacity){this.opacity=e;for(var t=0,r=this.markers.length;r>t;t++)this.markers[t].setOpacity(this.opacity)}},moveTo:function(e,t,r){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);if(t||!this.drawn){for(var n=0,i=this.markers.length;i>n;n++)this.drawMarker(this.markers[n]);this.drawn=!0}},addMarker:function(e){this.markers.push(e);this.opacity<1&&e.setOpacity(this.opacity);if(this.map&&this.map.getExtent()){e.map=this.map;this.drawMarker(e)}},removeMarker:function(e){if(this.markers&&this.markers.length){OpenLayers.Util.removeItem(this.markers,e);e.erase()}},clearMarkers:function(){if(null!=this.markers)for(;this.markers.length>0;)this.removeMarker(this.markers[0])},drawMarker:function(e){var t=this.map.getLayerPxFromLonLat(e.lonlat);if(null==t)e.display(!1);else if(e.isDrawn())e.icon&&e.icon.moveTo(t);else{var r=e.draw(t);this.div.appendChild(r)}},getDataExtent:function(){var e=null;if(this.markers&&this.markers.length>0)for(var e=new OpenLayers.Bounds,t=0,r=this.markers.length;r>t;t++){var n=this.markers[t];e.extend(n.lonlat)}return e},CLASS_NAME:"OpenLayers.Layer.Markers"});OpenLayers.ProxyHost="";OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Util.extend(OpenLayers.Request,{DEFAULT_CONFIG:{method:"GET",url:window.location.href,async:!0,user:void 0,password:void 0,params:null,proxy:OpenLayers.ProxyHost,headers:{},data:null,callback:function(){},success:null,failure:null,scope:null},URL_SPLIT_REGEX:/([^:]*:)\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,events:new OpenLayers.Events(this),makeSameOrigin:function(e,t){var r=0!==e.indexOf("http"),n=!r&&e.match(this.URL_SPLIT_REGEX);if(n){var i=window.location;r=n[1]==i.protocol&&n[3]==i.hostname;var a=n[4],s=i.port;(80!=a&&""!=a||"80"!=s&&""!=s)&&(r=r&&a==s)}r||t&&(e="function"==typeof t?t(e):t+encodeURIComponent(e));return e},issue:function(e){var t=OpenLayers.Util.extend(this.DEFAULT_CONFIG,{proxy:OpenLayers.ProxyHost});e=e||{};e.headers=e.headers||{};e=OpenLayers.Util.applyDefaults(e,t);e.headers=OpenLayers.Util.applyDefaults(e.headers,t.headers);var r,n=!1;for(r in e.headers)e.headers.hasOwnProperty(r)&&"x-requested-with"===r.toLowerCase()&&(n=!0);n===!1&&(e.headers["X-Requested-With"]="XMLHttpRequest");var i=new OpenLayers.Request.XMLHttpRequest,a=OpenLayers.Util.urlAppend(e.url,OpenLayers.Util.getParameterString(e.params||{}));a=OpenLayers.Request.makeSameOrigin(a,e.proxy);i.open(e.method,a,e.async,e.user,e.password);for(var s in e.headers)i.setRequestHeader(s,e.headers[s]);var o=this.events,l=this;i.onreadystatechange=function(){if(i.readyState==OpenLayers.Request.XMLHttpRequest.DONE){var t=o.triggerEvent("complete",{request:i,config:e,requestUrl:a});t!==!1&&l.runCallbacks({request:i,config:e,requestUrl:a})}};e.async===!1?i.send(e.data):window.setTimeout(function(){0!==i.readyState&&i.send(e.data)},0);return i},runCallbacks:function(e){var t,r=e.request,n=e.config,i=n.scope?OpenLayers.Function.bind(n.callback,n.scope):n.callback;n.success&&(t=n.scope?OpenLayers.Function.bind(n.success,n.scope):n.success);var a;n.failure&&(a=n.scope?OpenLayers.Function.bind(n.failure,n.scope):n.failure);"file:"==OpenLayers.Util.createUrlObject(n.url).protocol&&r.responseText&&(r.status=200);i(r);if(!r.status||r.status>=200&&r.status<300){this.events.triggerEvent("success",e);t&&t(r)}if(r.status&&(r.status<200||r.status>=300)){this.events.triggerEvent("failure",e);a&&a(r)}},GET:function(e){e=OpenLayers.Util.extend(e,{method:"GET"});return OpenLayers.Request.issue(e)},POST:function(e){e=OpenLayers.Util.extend(e,{method:"POST"});e.headers=e.headers?e.headers:{};"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(e)},PUT:function(e){e=OpenLayers.Util.extend(e,{method:"PUT"});e.headers=e.headers?e.headers:{};"CONTENT-TYPE"in OpenLayers.Util.upperCaseObject(e.headers)||(e.headers["Content-Type"]="application/xml");return OpenLayers.Request.issue(e)},DELETE:function(e){e=OpenLayers.Util.extend(e,{method:"DELETE"});return OpenLayers.Request.issue(e)},HEAD:function(e){e=OpenLayers.Util.extend(e,{method:"HEAD"});return OpenLayers.Request.issue(e)},OPTIONS:function(e){e=OpenLayers.Util.extend(e,{method:"OPTIONS"});return OpenLayers.Request.issue(e)}});!function(){function e(){this._object=o&&!u?new o:new window.ActiveXObject("Microsoft.XMLHTTP");this._listeners=[]}function t(){return new e}function r(e){e._object.send(e._data);if(l&&!e._async){e.readyState=t.OPENED;a(e);for(;e.readyState<t.DONE;){e.readyState++;n(e);if(e._aborted)return}}}function n(e){t.onreadystatechange&&t.onreadystatechange.apply(e);e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function i(e){var t=e.responseXML,r=e.responseText;if(c&&r&&t&&!t.documentElement&&e.getResponseHeader("Content-Type").match(/[^\/]+\/[^\+]+\+xml/)){t=new window.ActiveXObject("Microsoft.XMLDOM");t.async=!1;t.validateOnParse=!1;t.loadXML(r)}return t&&(c&&0!=t.parseError||!t.documentElement||t.documentElement&&"parsererror"==t.documentElement.tagName)?null:t}function a(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=i(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function s(e){e._object.onreadystatechange=new window.Function}var o=window.XMLHttpRequest,l=!!window.controllers,c=window.document.all&&!window.opera,u=c&&window.navigator.userAgent.match(/MSIE 7.0/);t.prototype=e.prototype;l&&o.wrapped&&(t.wrapped=o.wrapped);t.UNSENT=0;t.OPENED=1;t.HEADERS_RECEIVED=2;t.LOADING=3;t.DONE=4;t.prototype.readyState=t.UNSENT;t.prototype.responseText="";t.prototype.responseXML=null;t.prototype.status=0;t.prototype.statusText="";t.prototype.priority="NORMAL";t.prototype.onreadystatechange=null;t.onreadystatechange=null;t.onopen=null;t.onsend=null;t.onabort=null;t.prototype.open=function(e,r,i,o,u){delete this._headers;arguments.length<3&&(i=!0);this._async=i;var p,h=this,d=this.readyState;if(c&&i){p=function(){if(d!=t.DONE){s(h);h.abort()}};window.attachEvent("onunload",p)}t.onopen&&t.onopen.apply(this,arguments);arguments.length>4?this._object.open(e,r,i,o,u):arguments.length>3?this._object.open(e,r,i,o):this._object.open(e,r,i);this.readyState=t.OPENED;n(this);this._object.onreadystatechange=function(){if(!l||i){h.readyState=h._object.readyState;a(h);if(h._aborted)h.readyState=t.UNSENT;else{if(h.readyState==t.DONE){delete h._data;s(h);c&&i&&window.detachEvent("onunload",p)}d!=h.readyState&&n(h);d=h.readyState}}}};t.prototype.send=function(e){t.onsend&&t.onsend.apply(this,arguments);arguments.length||(e=null);if(e&&e.nodeType){e=window.XMLSerializer?(new window.XMLSerializer).serializeToString(e):e.xml;this._headers["Content-Type"]||this._object.setRequestHeader("Content-Type","application/xml")}this._data=e;r(this)};t.prototype.abort=function(){t.onabort&&t.onabort.apply(this,arguments);this.readyState>t.UNSENT&&(this._aborted=!0);this._object.abort();s(this);this.readyState=t.UNSENT;delete this._data};t.prototype.getAllResponseHeaders=function(){return this._object.getAllResponseHeaders()};t.prototype.getResponseHeader=function(e){return this._object.getResponseHeader(e)};t.prototype.setRequestHeader=function(e,t){this._headers||(this._headers={});this._headers[e]=t;return this._object.setRequestHeader(e,t)};t.prototype.addEventListener=function(e,t,r){for(var n,i=0;n=this._listeners[i];i++)if(n[0]==e&&n[1]==t&&n[2]==r)return;this._listeners.push([e,t,r])};t.prototype.removeEventListener=function(e,t,r){for(var n,i=0;(n=this._listeners[i])&&(n[0]!=e||n[1]!=t||n[2]!=r);i++);n&&this._listeners.splice(i,1)};t.prototype.dispatchEvent=function(e){var t={type:e.type,target:this,currentTarget:this,eventPhase:2,bubbles:e.bubbles,cancelable:e.cancelable,timeStamp:e.timeStamp,stopPropagation:function(){},preventDefault:function(){},initEvent:function(){}};"readystatechange"==t.type&&this.onreadystatechange&&(this.onreadystatechange.handleEvent||this.onreadystatechange).apply(this,[t]);for(var r,n=0;r=this._listeners[n];n++)r[0]!=t.type||r[2]||(r[1].handleEvent||r[1]).apply(this,[t])};t.prototype.toString=function(){return"[object XMLHttpRequest]"};t.toString=function(){return"[XMLHttpRequest]"};window.Function.prototype.apply||(window.Function.prototype.apply=function(e,t){t||(t=[]);e.__func=this;e.__func(t[0],t[1],t[2],t[3],t[4]);delete e.__func});OpenLayers.Request||(OpenLayers.Request={});OpenLayers.Request.XMLHttpRequest=t}();OpenLayers.Format.KML=OpenLayers.Class(OpenLayers.Format.XML,{namespaces:{kml:"http://www.opengis.net/kml/2.2",gx:"http://www.google.com/kml/ext/2.2"},kmlns:"http://earth.google.com/kml/2.0",placemarksDesc:"No description available",foldersName:"OpenLayers export",foldersDesc:"Exported on "+new Date,extractAttributes:!0,kvpAttributes:!1,extractStyles:!1,extractTracks:!1,trackAttributes:null,internalns:null,features:null,styles:null,styleBaseUrl:"",fetched:null,maxDepth:0,initialize:function(e){this.regExes={trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g,kmlColor:/(\w{2})(\w{2})(\w{2})(\w{2})/,kmlIconPalette:/root:\/\/icons\/palette-(\d+)(\.\w+)/,straightBracket:/\$\[(.*?)\]/g};this.externalProjection=new OpenLayers.Projection("EPSG:4326");OpenLayers.Format.XML.prototype.initialize.apply(this,[e])},read:function(e){this.features=[];this.styles={};this.fetched={};var t={depth:0,styleBaseUrl:this.styleBaseUrl};return this.parseData(e,t)},parseData:function(e,t){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));for(var r=["Link","NetworkLink","Style","StyleMap","Placemark"],n=0,i=r.length;i>n;++n){var a=r[n],s=this.getElementsByTagNameNS(e,"*",a);if(0!=s.length)switch(a.toLowerCase()){case"link":case"networklink":this.parseLinks(s,t);break;case"style":this.extractStyles&&this.parseStyles(s,t);break;case"stylemap":this.extractStyles&&this.parseStyleMaps(s,t);break;case"placemark":this.parseFeatures(s,t)}}return this.features},parseLinks:function(e,t){if(t.depth>=this.maxDepth)return!1;var r=OpenLayers.Util.extend({},t);r.depth++;for(var n=0,i=e.length;i>n;n++){var a=this.parseProperty(e[n],"*","href");if(a&&!this.fetched[a]){this.fetched[a]=!0;var s=this.fetchLink(a);s&&this.parseData(s,r)}}},fetchLink:function(e){var t=OpenLayers.Request.GET({url:e,async:!1});return t?t.responseText:void 0},parseStyles:function(e,t){for(var r=0,n=e.length;n>r;r++){var i=this.parseStyle(e[r]);if(i){var a=(t.styleBaseUrl||"")+"#"+i.id;this.styles[a]=i}}},parseKmlColor:function(e){var t=null;if(e){var r=e.match(this.regExes.kmlColor);r&&(t={color:"#"+r[4]+r[3]+r[2],opacity:parseInt(r[1],16)/255})}return t},parseStyle:function(e){for(var t,r,n={},i=["LineStyle","PolyStyle","IconStyle","BalloonStyle","LabelStyle"],a=0,s=i.length;s>a;++a){t=i[a];r=this.getElementsByTagNameNS(e,"*",t)[0];if(r)switch(t.toLowerCase()){case"linestyle":var o=this.parseProperty(r,"*","color"),l=this.parseKmlColor(o);if(l){n.strokeColor=l.color;n.strokeOpacity=l.opacity}var c=this.parseProperty(r,"*","width");c&&(n.strokeWidth=c);break;case"polystyle":var o=this.parseProperty(r,"*","color"),l=this.parseKmlColor(o);if(l){n.fillOpacity=l.opacity;n.fillColor=l.color}var u=this.parseProperty(r,"*","fill");"0"==u&&(n.fillColor="none");var p=this.parseProperty(r,"*","outline");"0"==p&&(n.strokeWidth="0");break;case"iconstyle":var h=parseFloat(this.parseProperty(r,"*","scale")||1),c=32*h,d=32*h,f=this.getElementsByTagNameNS(r,"*","Icon")[0];if(f){var m=this.parseProperty(f,"*","href");if(m){var y=this.parseProperty(f,"*","w"),g=this.parseProperty(f,"*","h"),v="http://maps.google.com/mapfiles/kml";if(OpenLayers.String.startsWith(m,v)&&!y&&!g){y=64;g=64;h/=2}y=y||g;g=g||y;y&&(c=parseInt(y)*h);g&&(d=parseInt(g)*h);var C=m.match(this.regExes.kmlIconPalette);if(C){var T=C[1],L=C[2],w=this.parseProperty(f,"*","x"),b=this.parseProperty(f,"*","y"),S=w?w/32:0,E=b?7-b/32:7,O=8*E+S;m="http://maps.google.com/mapfiles/kml/pal"+T+"/icon"+O+L}n.graphicOpacity=1;n.externalGraphic=m}}var A=this.getElementsByTagNameNS(r,"*","hotSpot")[0];if(A){var w=parseFloat(A.getAttribute("x")),b=parseFloat(A.getAttribute("y")),x=A.getAttribute("xunits");"pixels"==x?n.graphicXOffset=-w*h:"insetPixels"==x?n.graphicXOffset=-c+w*h:"fraction"==x&&(n.graphicXOffset=-c*w);var P=A.getAttribute("yunits");"pixels"==P?n.graphicYOffset=-d+b*h+1:"insetPixels"==P?n.graphicYOffset=-(b*h)+1:"fraction"==P&&(n.graphicYOffset=-d*(1-b)+1)}n.graphicWidth=c;n.graphicHeight=d;break;case"balloonstyle":var _=OpenLayers.Util.getXmlNodeValue(r);_&&(n.balloonStyle=_.replace(this.regExes.straightBracket,"${$1}"));break;case"labelstyle":var o=this.parseProperty(r,"*","color"),l=this.parseKmlColor(o);if(l){n.fontColor=l.color;n.fontOpacity=l.opacity}}}!n.strokeColor&&n.fillColor&&(n.strokeColor=n.fillColor);var N=e.getAttribute("id");N&&n&&(n.id=N);return n},parseStyleMaps:function(e,t){for(var r=0,n=e.length;n>r;r++)for(var i=e[r],a=this.getElementsByTagNameNS(i,"*","Pair"),s=i.getAttribute("id"),o=0,l=a.length;l>o;o++){var c=a[o],u=this.parseProperty(c,"*","key"),p=this.parseProperty(c,"*","styleUrl");p&&"normal"==u&&(this.styles[(t.styleBaseUrl||"")+"#"+s]=this.styles[(t.styleBaseUrl||"")+p])}},parseFeatures:function(e,t){for(var r=[],n=0,i=e.length;i>n;n++){var a=e[n],s=this.parseFeature.apply(this,[a]);if(!s)throw"Bad Placemark: "+n;this.extractStyles&&s.attributes&&s.attributes.styleUrl&&(s.style=this.getStyle(s.attributes.styleUrl,t));if(this.extractStyles){var o=this.getElementsByTagNameNS(a,"*","Style")[0];if(o){var l=this.parseStyle(o);l&&(s.style=OpenLayers.Util.extend(s.style,l))}}if(this.extractTracks){var c=this.getElementsByTagNameNS(a,this.namespaces.gx,"Track");if(c&&c.length>0){var u=c[0],p={features:[],feature:s};this.readNode(u,p);p.features.length>0&&r.push.apply(r,p.features)}}else r.push(s)}this.features=this.features.concat(r)},readers:{kml:{when:function(e,t){t.whens.push(OpenLayers.Date.parse(this.getChildValue(e)))},_trackPointAttribute:function(e,t){var r=e.nodeName.split(":").pop();t.attributes[r].push(this.getChildValue(e))}},gx:{Track:function(e,t){var r={whens:[],points:[],angles:[]};if(this.trackAttributes){var n;r.attributes={};for(var i=0,a=this.trackAttributes.length;a>i;++i){n=this.trackAttributes[i];r.attributes[n]=[];n in this.readers.kml||(this.readers.kml[n]=this.readers.kml._trackPointAttribute)}}this.readChildNodes(e,r);if(r.whens.length!==r.points.length)throw new Error("gx:Track with unequal number of when ("+r.whens.length+") and gx:coord ("+r.points.length+") elements.");var s=r.angles.length>0;if(s&&r.whens.length!==r.angles.length)throw new Error("gx:Track with unequal number of when ("+r.whens.length+") and gx:angles ("+r.angles.length+") elements.");for(var o,l,c,i=0,a=r.whens.length;a>i;++i){o=t.feature.clone();o.fid=t.feature.fid||t.feature.id;l=r.points[i];o.geometry=l;"z"in l&&(o.attributes.altitude=l.z);this.internalProjection&&this.externalProjection&&o.geometry.transform(this.externalProjection,this.internalProjection);if(this.trackAttributes)for(var u=0,p=this.trackAttributes.length;p>u;++u){var n=this.trackAttributes[u];o.attributes[n]=r.attributes[n][i]}o.attributes.when=r.whens[i];o.attributes.trackId=t.feature.id;if(s){c=r.angles[i];o.attributes.heading=parseFloat(c[0]);o.attributes.tilt=parseFloat(c[1]);o.attributes.roll=parseFloat(c[2])}t.features.push(o)}},coord:function(e,t){var r=this.getChildValue(e),n=r.replace(this.regExes.trimSpace,"").split(/\s+/),i=new OpenLayers.Geometry.Point(n[0],n[1]);n.length>2&&(i.z=parseFloat(n[2]));t.points.push(i)},angles:function(e,t){var r=this.getChildValue(e),n=r.replace(this.regExes.trimSpace,"").split(/\s+/);t.angles.push(n)}}},parseFeature:function(e){for(var t,r,n,i,a=["MultiGeometry","Polygon","LineString","Point"],s=0,o=a.length;o>s;++s){t=a[s];this.internalns=e.namespaceURI?e.namespaceURI:this.kmlns;r=this.getElementsByTagNameNS(e,this.internalns,t);if(r.length>0){var i=this.parseGeometry[t.toLowerCase()];if(!i)throw new TypeError("Unsupported geometry type: "+t);n=i.apply(this,[r[0]]);this.internalProjection&&this.externalProjection&&n.transform(this.externalProjection,this.internalProjection);break}}var l;this.extractAttributes&&(l=this.parseAttributes(e));var c=new OpenLayers.Feature.Vector(n,l),u=e.getAttribute("id")||e.getAttribute("name");null!=u&&(c.fid=u);return c},getStyle:function(e,t){var r=OpenLayers.Util.removeTail(e),n=OpenLayers.Util.extend({},t);n.depth++;n.styleBaseUrl=r;if(!this.styles[e]&&!OpenLayers.String.startsWith(e,"#")&&n.depth<=this.maxDepth&&!this.fetched[r]){var i=this.fetchLink(r);i&&this.parseData(i,n)}var a=OpenLayers.Util.extend({},this.styles[e]);return a},parseGeometry:{point:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),r=[];if(t.length>0){var n=t[0].firstChild.nodeValue;n=n.replace(this.regExes.removeSpace,"");r=n.split(",")}var i=null;if(!(r.length>1))throw"Bad coordinate string: "+n;2==r.length&&(r[2]=null);i=new OpenLayers.Geometry.Point(r[0],r[1],r[2]);return i},linestring:function(e,t){var r=this.getElementsByTagNameNS(e,this.internalns,"coordinates"),n=null;if(r.length>0){var i=this.getChildValue(r[0]);i=i.replace(this.regExes.trimSpace,"");i=i.replace(this.regExes.trimComma,",");for(var a,s,o=i.split(this.regExes.splitSpace),l=o.length,c=new Array(l),u=0;l>u;++u){a=o[u].split(",");s=a.length;if(!(s>1))throw"Bad LineString point coordinates: "+o[u];2==a.length&&(a[2]=null);c[u]=new OpenLayers.Geometry.Point(a[0],a[1],a[2])}if(!l)throw"Bad LineString coordinates: "+i;n=t?new OpenLayers.Geometry.LinearRing(c):new OpenLayers.Geometry.LineString(c)}return n},polygon:function(e){var t=this.getElementsByTagNameNS(e,this.internalns,"LinearRing"),r=t.length,n=new Array(r);if(r>0)for(var i,a=0,s=t.length;s>a;++a){i=this.parseGeometry.linestring.apply(this,[t[a],!0]);if(!i)throw"Bad LinearRing geometry: "+a;n[a]=i}return new OpenLayers.Geometry.Polygon(n)},multigeometry:function(e){for(var t,r,n=[],i=e.childNodes,a=0,s=i.length;s>a;++a){t=i[a];if(1==t.nodeType){var o=t.prefix?t.nodeName.split(":")[1]:t.nodeName,r=this.parseGeometry[o.toLowerCase()];r&&n.push(r.apply(this,[t]))}}return new OpenLayers.Geometry.Collection(n)}},parseAttributes:function(e){var t={},r=e.getElementsByTagName("ExtendedData");r.length&&(t=this.parseExtendedData(r[0]));for(var n,i,a,s=e.childNodes,o=0,l=s.length;l>o;++o){n=s[o];if(1==n.nodeType){i=n.childNodes;if(i.length>=1&&i.length<=3){var a;switch(i.length){case 1:a=i[0];break;case 2:var c=i[0],u=i[1];a=3==c.nodeType||4==c.nodeType?c:u;break;case 3:default:a=i[1]}if(3==a.nodeType||4==a.nodeType){var p=n.prefix?n.nodeName.split(":")[1]:n.nodeName,h=OpenLayers.Util.getXmlNodeValue(a);if(h){h=h.replace(this.regExes.trimSpace,"");t[p]=h}}}}}return t},parseExtendedData:function(e){var t,r,n,i,a={},s=e.getElementsByTagName("Data");for(t=0,r=s.length;r>t;t++){n=s[t];i=n.getAttribute("name");var o={},l=n.getElementsByTagName("value");l.length&&(o.value=this.getChildValue(l[0]));if(this.kvpAttributes)a[i]=o.value;else{var c=n.getElementsByTagName("displayName");c.length&&(o.displayName=this.getChildValue(c[0]));a[i]=o}}var u=e.getElementsByTagName("SimpleData");for(t=0,r=u.length;r>t;t++){var o={};n=u[t];i=n.getAttribute("name");o.value=this.getChildValue(n);if(this.kvpAttributes)a[i]=o.value;else{o.displayName=i;a[i]=o}}return a},parseProperty:function(e,t,r){var n,i=this.getElementsByTagNameNS(e,t,r);try{n=OpenLayers.Util.getXmlNodeValue(i[0])}catch(a){n=null}return n},write:function(e){OpenLayers.Util.isArray(e)||(e=[e]);for(var t=this.createElementNS(this.kmlns,"kml"),r=this.createFolderXML(),n=0,i=e.length;i>n;++n)r.appendChild(this.createPlacemarkXML(e[n]));t.appendChild(r);return OpenLayers.Format.XML.prototype.write.apply(this,[t])},createFolderXML:function(){var e=this.createElementNS(this.kmlns,"Folder");if(this.foldersName){var t=this.createElementNS(this.kmlns,"name"),r=this.createTextNode(this.foldersName);t.appendChild(r);e.appendChild(t)}if(this.foldersDesc){var n=this.createElementNS(this.kmlns,"description"),i=this.createTextNode(this.foldersDesc);n.appendChild(i);e.appendChild(n)}return e},createPlacemarkXML:function(e){var t=this.createElementNS(this.kmlns,"name"),r=e.style&&e.style.label?e.style.label:e.id,n=e.attributes.name||r;t.appendChild(this.createTextNode(n));var i=this.createElementNS(this.kmlns,"description"),a=e.attributes.description||this.placemarksDesc;i.appendChild(this.createTextNode(a));var s=this.createElementNS(this.kmlns,"Placemark");null!=e.fid&&s.setAttribute("id",e.fid);s.appendChild(t);s.appendChild(i);var o=this.buildGeometryNode(e.geometry);s.appendChild(o);if(e.attributes){var l=this.buildExtendedData(e.attributes);l&&s.appendChild(l)}return s},buildGeometryNode:function(e){var t=e.CLASS_NAME,r=t.substring(t.lastIndexOf(".")+1),n=this.buildGeometry[r.toLowerCase()],i=null;n&&(i=n.apply(this,[e]));return i},buildGeometry:{point:function(e){var t=this.createElementNS(this.kmlns,"Point");t.appendChild(this.buildCoordinatesNode(e));return t},multipoint:function(e){return this.buildGeometry.collection.apply(this,[e])},linestring:function(e){var t=this.createElementNS(this.kmlns,"LineString");t.appendChild(this.buildCoordinatesNode(e));return t},multilinestring:function(e){return this.buildGeometry.collection.apply(this,[e])},linearring:function(e){var t=this.createElementNS(this.kmlns,"LinearRing");t.appendChild(this.buildCoordinatesNode(e));return t},polygon:function(e){for(var t,r,n,i=this.createElementNS(this.kmlns,"Polygon"),a=e.components,s=0,o=a.length;o>s;++s){n=0==s?"outerBoundaryIs":"innerBoundaryIs";t=this.createElementNS(this.kmlns,n);r=this.buildGeometry.linearring.apply(this,[a[s]]);t.appendChild(r);i.appendChild(t)}return i},multipolygon:function(e){return this.buildGeometry.collection.apply(this,[e])},collection:function(e){for(var t,r=this.createElementNS(this.kmlns,"MultiGeometry"),n=0,i=e.components.length;i>n;++n){t=this.buildGeometryNode.apply(this,[e.components[n]]);t&&r.appendChild(t)}return r}},buildCoordinatesNode:function(e){var t,r=this.createElementNS(this.kmlns,"coordinates"),n=e.components;if(n){for(var i,a=n.length,s=new Array(a),o=0;a>o;++o){i=n[o];s[o]=this.buildCoordinates(i)}t=s.join(" ")}else t=this.buildCoordinates(e);var l=this.createTextNode(t);

r.appendChild(l);return r},buildCoordinates:function(e){if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}return e.x+","+e.y},buildExtendedData:function(e){var t=this.createElementNS(this.kmlns,"ExtendedData");for(var r in e)if(e[r]&&"name"!=r&&"description"!=r&&"styleUrl"!=r){var n=this.createElementNS(this.kmlns,"Data");n.setAttribute("name",r);var i=this.createElementNS(this.kmlns,"value");if("object"==typeof e[r]){e[r].value&&i.appendChild(this.createTextNode(e[r].value));if(e[r].displayName){var a=this.createElementNS(this.kmlns,"displayName");a.appendChild(this.getXMLDoc().createCDATASection(e[r].displayName));n.appendChild(a)}}else i.appendChild(this.createTextNode(e[r]));n.appendChild(i);t.appendChild(n)}return this.isSimpleContent(t)?null:t},CLASS_NAME:"OpenLayers.Format.KML"});OpenLayers.Format.WMSCapabilities.v1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1,{readers:{wms:OpenLayers.Util.applyDefaults({WMT_MS_Capabilities:function(e,t){this.readChildNodes(e,t)},Keyword:function(e,t){t.keywords&&t.keywords.push(this.getChildValue(e))},DescribeLayer:function(e,t){t.describelayer={formats:[]};this.readChildNodes(e,t.describelayer)},GetLegendGraphic:function(e,t){t.getlegendgraphic={formats:[]};this.readChildNodes(e,t.getlegendgraphic)},GetStyles:function(e,t){t.getstyles={formats:[]};this.readChildNodes(e,t.getstyles)},PutStyles:function(e,t){t.putstyles={formats:[]};this.readChildNodes(e,t.putstyles)},UserDefinedSymbolization:function(e,t){var r={supportSLD:1==parseInt(e.getAttribute("SupportSLD")),userLayer:1==parseInt(e.getAttribute("UserLayer")),userStyle:1==parseInt(e.getAttribute("UserStyle")),remoteWFS:1==parseInt(e.getAttribute("RemoteWFS"))};t.userSymbols=r},LatLonBoundingBox:function(e,t){t.llbbox=[parseFloat(e.getAttribute("minx")),parseFloat(e.getAttribute("miny")),parseFloat(e.getAttribute("maxx")),parseFloat(e.getAttribute("maxy"))]},BoundingBox:function(e,t){var r=OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms.BoundingBox.apply(this,[e,t]);r.srs=e.getAttribute("SRS");t.bbox[r.srs]=r},ScaleHint:function(e,t){var r=e.getAttribute("min"),n=e.getAttribute("max"),i=Math.pow(2,.5),a=OpenLayers.INCHES_PER_UNIT.m;0!=r&&(t.maxScale=parseFloat((r/i*a*OpenLayers.DOTS_PER_INCH).toPrecision(13)));n!=Number.POSITIVE_INFINITY&&(t.minScale=parseFloat((n/i*a*OpenLayers.DOTS_PER_INCH).toPrecision(13)))},Dimension:function(e,t){var r=e.getAttribute("name").toLowerCase(),n={name:r,units:e.getAttribute("units"),unitsymbol:e.getAttribute("unitSymbol")};t.dimensions[n.name]=n},Extent:function(e,t){var r=e.getAttribute("name").toLowerCase();if(r in t.dimensions){var n=t.dimensions[r];n.nearestVal="1"===e.getAttribute("nearestValue");n.multipleVal="1"===e.getAttribute("multipleValues");n.current="1"===e.getAttribute("current");n["default"]=e.getAttribute("default")||"";var i=this.getChildValue(e);n.values=i.split(",")}}},OpenLayers.Format.WMSCapabilities.v1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1"});OpenLayers.Format.WMSCapabilities.v1_1_0=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.0",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){for(var r=this.getChildValue(e),n=r.split(/ +/),i=0,a=n.length;a>i;i++)t.srs[n[i]]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_0"});OpenLayers.Protocol.WFS.v1=OpenLayers.Class(OpenLayers.Protocol,{version:null,srsName:"EPSG:4326",featureType:null,featureNS:null,geometryName:"the_geom",schema:null,featurePrefix:"feature",formatOptions:null,readFormat:null,readOptions:null,initialize:function(e){OpenLayers.Protocol.prototype.initialize.apply(this,[e]);e.format||(this.format=OpenLayers.Format.WFST(OpenLayers.Util.extend({version:this.version,featureType:this.featureType,featureNS:this.featureNS,featurePrefix:this.featurePrefix,geometryName:this.geometryName,srsName:this.srsName,schema:this.schema},this.formatOptions)));!e.geometryName&&parseFloat(this.format.version)>1&&this.setGeometryName(null)},destroy:function(){this.options&&!this.options.format&&this.format.destroy();this.format=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=OpenLayers.Util.extend({},e);OpenLayers.Util.applyDefaults(e,this.options||{});var t=new OpenLayers.Protocol.Response({requestType:"read"}),r=OpenLayers.Format.XML.prototype.write.apply(this.format,[this.format.writeNode("wfs:GetFeature",e)]);t.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,t,e),params:e.params,headers:e.headers,data:r});return t},setFeatureType:function(e){this.featureType=e;this.format.featureType=e},setGeometryName:function(e){this.geometryName=e;this.format.geometryName=e},handleRead:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);if(t.callback){var r=e.priv;if(r.status>=200&&r.status<300){var n=this.parseResponse(r,t.readOptions);if(n&&n.success!==!1){t.readOptions&&"object"==t.readOptions.output?OpenLayers.Util.extend(e,n):e.features=n;e.code=OpenLayers.Protocol.Response.SUCCESS}else{e.code=OpenLayers.Protocol.Response.FAILURE;e.error=n}}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseResponse:function(e,t){var r=e.responseXML;r&&r.documentElement||(r=e.responseText);if(!r||r.length<=0)return null;var n=null!==this.readFormat?this.readFormat.read(r):this.format.read(r,t);if(!this.featureNS){var i=this.readFormat||this.format;this.featureNS=i.featureNS;i.autoConfig=!1;this.geometryName||this.setGeometryName(i.geometryName)}return n},commit:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({requestType:"commit",reqFeatures:e});r.priv=OpenLayers.Request.POST({url:t.url,headers:t.headers,data:this.format.write(e,t),callback:this.createCallback(this.handleCommit,r,t)});return r},handleCommit:function(e,t){if(t.callback){var r=e.priv,n=r.responseXML;n&&n.documentElement||(n=r.responseText);var i=this.format.read(n)||{};e.insertIds=i.insertIds||[];if(i.success)e.code=OpenLayers.Protocol.Response.SUCCESS;else{e.code=OpenLayers.Protocol.Response.FAILURE;e.error=i}t.callback.call(t.scope,e)}},filterDelete:function(e,t){t=OpenLayers.Util.extend({},t);OpenLayers.Util.applyDefaults(t,this.options);var r=(new OpenLayers.Protocol.Response({requestType:"commit"}),this.format.createElementNSPlus("wfs:Transaction",{attributes:{service:"WFS",version:this.version}})),n=this.format.createElementNSPlus("wfs:Delete",{attributes:{typeName:(t.featureNS?this.featurePrefix+":":"")+t.featureType}});t.featureNS&&n.setAttribute("xmlns:"+this.featurePrefix,t.featureNS);var i=this.format.writeNode("ogc:Filter",e);n.appendChild(i);r.appendChild(n);var a=OpenLayers.Format.XML.prototype.write.apply(this.format,[r]);return OpenLayers.Request.POST({url:this.url,callback:t.callback||function(){},data:a})},abort:function(e){e&&e.priv.abort()},CLASS_NAME:"OpenLayers.Protocol.WFS.v1"});OpenLayers.Format.OWSCommon.v1_1_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1,{namespaces:{ows:"http://www.opengis.net/ows/1.1",xlink:"http://www.w3.org/1999/xlink"},readers:{ows:OpenLayers.Util.applyDefaults({ExceptionReport:function(e,t){t.exceptionReport={version:e.getAttribute("version"),language:e.getAttribute("xml:lang"),exceptions:[]};this.readChildNodes(e,t.exceptionReport)},AllowedValues:function(e,t){t.allowedValues={};this.readChildNodes(e,t.allowedValues)},AnyValue:function(e,t){t.anyValue=!0},DataType:function(e,t){t.dataType=this.getChildValue(e)},Range:function(e,t){t.range={};this.readChildNodes(e,t.range)},MinimumValue:function(e,t){t.minValue=this.getChildValue(e)},MaximumValue:function(e,t){t.maxValue=this.getChildValue(e)},Identifier:function(e,t){t.identifier=this.getChildValue(e)},SupportedCRS:function(e,t){t.supportedCRS=this.getChildValue(e)}},OpenLayers.Format.OWSCommon.v1.prototype.readers.ows)},writers:{ows:OpenLayers.Util.applyDefaults({Range:function(e){var t=this.createElementNSPlus("ows:Range",{attributes:{"ows:rangeClosure":e.closure}});this.writeNode("ows:MinimumValue",e.minValue,t);this.writeNode("ows:MaximumValue",e.maxValue,t);return t},MinimumValue:function(e){var t=this.createElementNSPlus("ows:MinimumValue",{value:e});return t},MaximumValue:function(e){var t=this.createElementNSPlus("ows:MaximumValue",{value:e});return t},Value:function(e){var t=this.createElementNSPlus("ows:Value",{value:e});return t}},OpenLayers.Format.OWSCommon.v1.prototype.writers.ows)},CLASS_NAME:"OpenLayers.Format.OWSCommon.v1_1_0"});OpenLayers.Kinetic=OpenLayers.Class({threshold:0,deceleration:.0035,nbPoints:100,delay:200,points:void 0,timerId:void 0,initialize:function(e){OpenLayers.Util.extend(this,e)},begin:function(){OpenLayers.Animation.stop(this.timerId);this.timerId=void 0;this.points=[]},update:function(e){this.points.unshift({xy:e,tick:(new Date).getTime()});this.points.length>this.nbPoints&&this.points.pop()},end:function(e){for(var t,r,n=(new Date).getTime(),i=0,a=this.points.length;a>i;i++){r=this.points[i];if(n-r.tick>this.delay)break;t=r}if(t){var s=(new Date).getTime()-t.tick,o=Math.sqrt(Math.pow(e.x-t.xy.x,2)+Math.pow(e.y-t.xy.y,2)),l=o/s;if(!(0==l||l<this.threshold)){var c=Math.asin((e.y-t.xy.y)/o);t.xy.x<=e.x&&(c=Math.PI-c);return{speed:l,theta:c}}}},move:function(e,t){var r=e.speed,n=Math.cos(e.theta),i=-Math.sin(e.theta),a=(new Date).getTime(),s=0,o=0,l=function(){if(null!=this.timerId){var e=(new Date).getTime()-a,l=-this.deceleration*Math.pow(e,2)/2+r*e,c=l*n,u=l*i,p={};p.end=!1;var h=-this.deceleration*e+r;if(0>=h){OpenLayers.Animation.stop(this.timerId);this.timerId=null;p.end=!0}p.x=c-s;p.y=u-o;s=c;o=u;t(p.x,p.y,p.end)}};this.timerId=OpenLayers.Animation.start(OpenLayers.Function.bind(l,this))},CLASS_NAME:"OpenLayers.Kinetic"});OpenLayers.Strategy.Filter=OpenLayers.Class(OpenLayers.Strategy,{filter:null,cache:null,caching:!1,activate:function(){var e=OpenLayers.Strategy.prototype.activate.apply(this,arguments);if(e){this.cache=[];this.layer.events.on({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this})}return e},deactivate:function(){this.cache=null;this.layer&&this.layer.events&&this.layer.events.un({beforefeaturesadded:this.handleAdd,beforefeaturesremoved:this.handleRemove,scope:this});return OpenLayers.Strategy.prototype.deactivate.apply(this,arguments)},handleAdd:function(e){if(!this.caching&&this.filter){var t=e.features;e.features=[];for(var r,n=0,i=t.length;i>n;++n){r=t[n];this.filter.evaluate(r)?e.features.push(r):this.cache.push(r)}}},handleRemove:function(e){this.caching||(this.cache=[])},setFilter:function(e){this.filter=e;var t=this.cache;this.cache=[];this.handleAdd({features:this.layer.features});if(this.cache.length>0){this.caching=!0;this.layer.removeFeatures(this.cache.slice());this.caching=!1}if(t.length>0){var r={features:t};this.handleAdd(r);if(r.features.length>0){this.caching=!0;this.layer.addFeatures(r.features);this.caching=!1}}},CLASS_NAME:"OpenLayers.Strategy.Filter"});OpenLayers.Handler.Drag=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!0,dragging:!1,last:null,start:null,lastMoveEvt:null,oldOnselectstart:null,interval:0,timeoutId:null,documentDrag:!1,documentEvents:null,initialize:function(e,t,r){OpenLayers.Handler.prototype.initialize.apply(this,arguments);if(this.documentDrag===!0){var n=this;this._docMove=function(e){n.mousemove({xy:{x:e.clientX,y:e.clientY},element:document})};this._docUp=function(e){n.mouseup({xy:{x:e.clientX,y:e.clientY}})}}},dragstart:function(e){var t=!0;this.dragging=!1;if(this.checkModifiers(e)&&(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))){this.started=!0;this.start=e.xy;this.last=e.xy;OpenLayers.Element.addClass(this.map.viewPortDiv,"olDragDown");this.down(e);this.callback("down",[e.xy]);OpenLayers.Event.preventDefault(e);this.oldOnselectstart||(this.oldOnselectstart=document.onselectstart?document.onselectstart:OpenLayers.Function.True);document.onselectstart=OpenLayers.Function.False;t=!this.stopDown}else{this.started=!1;this.start=null;this.last=null}return t},dragmove:function(e){this.lastMoveEvt=e;if(this.started&&!this.timeoutId&&(e.xy.x!=this.last.x||e.xy.y!=this.last.y)){if(this.documentDrag===!0&&this.documentEvents)if(e.element===document){this.adjustXY(e);this.setEvent(e)}else this.removeDocumentEvents();this.interval>0&&(this.timeoutId=setTimeout(OpenLayers.Function.bind(this.removeTimeout,this),this.interval));this.dragging=!0;this.move(e);this.callback("move",[e.xy]);if(!this.oldOnselectstart){this.oldOnselectstart=document.onselectstart;document.onselectstart=OpenLayers.Function.False}this.last=e.xy}return!0},dragend:function(e){if(this.started){if(this.documentDrag===!0&&this.documentEvents){this.adjustXY(e);this.removeDocumentEvents()}var t=this.start!=this.last;this.started=!1;this.dragging=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.up(e);this.callback("up",[e.xy]);t&&this.callback("done",[e.xy]);document.onselectstart=this.oldOnselectstart}return!0},down:function(e){},move:function(e){},up:function(e){},out:function(e){},mousedown:function(e){return this.dragstart(e)},touchstart:function(e){this.startTouch();return this.dragstart(e)},mousemove:function(e){return this.dragmove(e)},touchmove:function(e){return this.dragmove(e)},removeTimeout:function(){this.timeoutId=null;this.dragging&&this.mousemove(this.lastMoveEvt)},mouseup:function(e){return this.dragend(e)},touchend:function(e){e.xy=this.last;return this.dragend(e)},mouseout:function(e){if(this.started&&OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv))if(this.documentDrag===!0)this.addDocumentEvents();else{var t=this.start!=this.last;this.started=!1;this.dragging=!1;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown");this.out(e);this.callback("out",[]);t&&this.callback("done",[e.xy]);document.onselectstart&&(document.onselectstart=this.oldOnselectstart)}return!0},click:function(e){return this.start==this.last},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragging=!1;e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=!1;this.dragging=!1;this.start=null;this.last=null;e=!0;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDragDown")}return e},adjustXY:function(e){var t=OpenLayers.Util.pagePosition(this.map.viewPortDiv);e.xy.x-=t[0];e.xy.y-=t[1]},addDocumentEvents:function(){OpenLayers.Element.addClass(document.body,"olDragDown");this.documentEvents=!0;OpenLayers.Event.observe(document,"mousemove",this._docMove);OpenLayers.Event.observe(document,"mouseup",this._docUp)},removeDocumentEvents:function(){OpenLayers.Element.removeClass(document.body,"olDragDown");this.documentEvents=!1;OpenLayers.Event.stopObserving(document,"mousemove",this._docMove);OpenLayers.Event.stopObserving(document,"mouseup",this._docUp)},CLASS_NAME:"OpenLayers.Handler.Drag"});OpenLayers.Handler.Box=OpenLayers.Class(OpenLayers.Handler,{dragHandler:null,boxDivClassName:"olHandlerBoxZoomBox",boxOffsets:null,initialize:function(e,t,r){OpenLayers.Handler.prototype.initialize.apply(this,arguments);this.dragHandler=new OpenLayers.Handler.Drag(this,{down:this.startBox,move:this.moveBox,out:this.removeBox,up:this.endBox},{keyMask:this.keyMask})},destroy:function(){OpenLayers.Handler.prototype.destroy.apply(this,arguments);if(this.dragHandler){this.dragHandler.destroy();this.dragHandler=null}},setMap:function(e){OpenLayers.Handler.prototype.setMap.apply(this,arguments);this.dragHandler&&this.dragHandler.setMap(e)},startBox:function(e){this.callback("start",[]);this.zoomBox=OpenLayers.Util.createDiv("zoomBox",{x:-9999,y:-9999});this.zoomBox.className=this.boxDivClassName;this.zoomBox.style.zIndex=this.map.Z_INDEX_BASE.Popup-1;this.map.viewPortDiv.appendChild(this.zoomBox);OpenLayers.Element.addClass(this.map.viewPortDiv,"olDrawBox")},moveBox:function(e){var t=this.dragHandler.start.x,r=this.dragHandler.start.y,n=Math.abs(t-e.x),i=Math.abs(r-e.y),a=this.getBoxOffsets();this.zoomBox.style.width=n+a.width+1+"px";this.zoomBox.style.height=i+a.height+1+"px";this.zoomBox.style.left=(e.x<t?t-n-a.left:t-a.left)+"px";this.zoomBox.style.top=(e.y<r?r-i-a.top:r-a.top)+"px"},endBox:function(e){var t;if(Math.abs(this.dragHandler.start.x-e.x)>5||Math.abs(this.dragHandler.start.y-e.y)>5){var r=this.dragHandler.start,n=Math.min(r.y,e.y),i=Math.max(r.y,e.y),a=Math.min(r.x,e.x),s=Math.max(r.x,e.x);t=new OpenLayers.Bounds(a,i,s,n)}else t=this.dragHandler.start.clone();this.removeBox();this.callback("done",[t])},removeBox:function(){this.map.viewPortDiv.removeChild(this.zoomBox);this.zoomBox=null;this.boxOffsets=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,"olDrawBox")},activate:function(){if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.dragHandler.activate();return!0}return!1},deactivate:function(){if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.dragHandler.deactivate()&&this.zoomBox&&this.removeBox();return!0}return!1},getBoxOffsets:function(){if(!this.boxOffsets){var e=document.createElement("div");e.style.position="absolute";e.style.border="1px solid black";e.style.width="3px";document.body.appendChild(e);var t=3==e.clientWidth;document.body.removeChild(e);var r=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-left-width")),n=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-right-width")),i=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-top-width")),a=parseInt(OpenLayers.Element.getStyle(this.zoomBox,"border-bottom-width"));this.boxOffsets={left:r,right:n,top:i,bottom:a,width:t===!1?r+n:0,height:t===!1?i+a:0}}return this.boxOffsets},CLASS_NAME:"OpenLayers.Handler.Box"});OpenLayers.Control.ZoomBox=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,out:!1,keyMask:null,alwaysZoom:!1,zoomOnClick:!0,draw:function(){this.handler=new OpenLayers.Handler.Box(this,{done:this.zoomBox},{keyMask:this.keyMask})},zoomBox:function(e){if(e instanceof OpenLayers.Bounds){var t,r=e.getCenterPixel();if(this.out){var n=e.right-e.left,i=e.bottom-e.top,a=Math.min(this.map.size.h/i,this.map.size.w/n),s=this.map.getExtent(),o=this.map.getLonLatFromPixel(r),l=o.lon-s.getWidth()/2*a,c=o.lon+s.getWidth()/2*a,u=o.lat-s.getHeight()/2*a,p=o.lat+s.getHeight()/2*a;t=new OpenLayers.Bounds(l,u,c,p)}else{var h=this.map.getLonLatFromPixel({x:e.left,y:e.bottom}),d=this.map.getLonLatFromPixel({x:e.right,y:e.top});t=new OpenLayers.Bounds(h.lon,h.lat,d.lon,d.lat)}var f=this.map.getZoom(),m=this.map.getSize(),y={x:m.w/2,y:m.h/2},g=this.map.getZoomForExtent(t),v=this.map.getResolution(),C=this.map.getResolutionForZoom(g);if(v==C)this.map.setCenter(this.map.getLonLatFromPixel(r));else{var T={x:(v*r.x-C*y.x)/(v-C),y:(v*r.y-C*y.y)/(v-C)};this.map.zoomTo(g,T)}f==this.map.getZoom()&&1==this.alwaysZoom&&this.map.zoomTo(f+(this.out?-1:1))}else this.zoomOnClick&&(this.out?this.map.zoomTo(this.map.getZoom()-1,e):this.map.zoomTo(this.map.getZoom()+1,e))},CLASS_NAME:"OpenLayers.Control.ZoomBox"});OpenLayers.Control.DragPan=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,panned:!1,interval:0,documentDrag:!1,kinetic:null,enableKinetic:!0,kineticInterval:10,draw:function(){if(this.enableKinetic&&OpenLayers.Kinetic){var e={interval:this.kineticInterval};"object"==typeof this.enableKinetic&&(e=OpenLayers.Util.extend(e,this.enableKinetic));this.kinetic=new OpenLayers.Kinetic(e)}this.handler=new OpenLayers.Handler.Drag(this,{move:this.panMap,done:this.panMapDone,down:this.panMapStart},{interval:this.interval,documentDrag:this.documentDrag})},panMapStart:function(){this.kinetic&&this.kinetic.begin()},panMap:function(e){this.kinetic&&this.kinetic.update(e);this.panned=!0;this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!0,animate:!1})},panMapDone:function(e){if(this.panned){var t=null;this.kinetic&&(t=this.kinetic.end(e));this.map.pan(this.handler.last.x-e.x,this.handler.last.y-e.y,{dragging:!!t,animate:!1});if(t){var r=this;this.kinetic.move(t,function(e,t,n){r.map.pan(e,t,{dragging:!n,animate:!1})})}this.panned=!1}},CLASS_NAME:"OpenLayers.Control.DragPan"});OpenLayers.Handler.Click=OpenLayers.Class(OpenLayers.Handler,{delay:300,single:!0,"double":!1,pixelTolerance:0,dblclickTolerance:13,stopSingle:!1,stopDouble:!1,timerId:null,down:null,last:null,first:null,rightclickTimerId:null,touchstart:function(e){this.startTouch();this.down=this.getEventInfo(e);this.last=this.getEventInfo(e);return!0},touchmove:function(e){this.last=this.getEventInfo(e);return!0},touchend:function(e){if(this.down){e.xy=this.last.xy;e.lastTouches=this.last.touches;this.handleSingle(e);this.down=null}return!0},mousedown:function(e){this.down=this.getEventInfo(e);this.last=this.getEventInfo(e);return!0},mouseup:function(e){var t=!0;this.checkModifiers(e)&&this.control.handleRightClicks&&OpenLayers.Event.isRightClick(e)&&(t=this.rightclick(e));return t},rightclick:function(e){if(this.passesTolerance(e)){if(null!=this.rightclickTimerId){this.clearTimer();this.callback("dblrightclick",[e]);return!this.stopDouble}var t=this["double"]?OpenLayers.Util.extend({},e):this.callback("rightclick",[e]),r=OpenLayers.Function.bind(this.delayedRightCall,this,t);this.rightclickTimerId=window.setTimeout(r,this.delay)}return!this.stopSingle},delayedRightCall:function(e){this.rightclickTimerId=null;e&&this.callback("rightclick",[e])},click:function(e){this.last||(this.last=this.getEventInfo(e));this.handleSingle(e);return!this.stopSingle},dblclick:function(e){this.handleDouble(e);return!this.stopDouble},handleDouble:function(e){if(this.passesDblclickTolerance(e)){this["double"]&&this.callback("dblclick",[e]);this.clearTimer()}},handleSingle:function(e){if(this.passesTolerance(e))if(null!=this.timerId){if(this.last.touches&&1===this.last.touches.length){this["double"]&&OpenLayers.Event.preventDefault(e);this.handleDouble(e)}this.last.touches&&2===this.last.touches.length||this.clearTimer()}else{this.first=this.getEventInfo(e);var t=this.single?OpenLayers.Util.extend({},e):null;this.queuePotentialClick(t)}},queuePotentialClick:function(e){this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)},passesTolerance:function(e){var t=!0;if(null!=this.pixelTolerance&&this.down&&this.down.xy){t=this.pixelTolerance>=this.down.xy.distanceTo(e.xy);if(t&&this.touch&&this.down.touches.length===this.last.touches.length)for(var r=0,n=this.down.touches.length;n>r;++r)if(this.getTouchDistance(this.down.touches[r],this.last.touches[r])>this.pixelTolerance){t=!1;break}}return t},getTouchDistance:function(e,t){return Math.sqrt(Math.pow(e.clientX-t.clientX,2)+Math.pow(e.clientY-t.clientY,2))},passesDblclickTolerance:function(e){var t=!0;this.down&&this.first&&(t=this.down.xy.distanceTo(this.first.xy)<=this.dblclickTolerance);return t},clearTimer:function(){if(null!=this.timerId){window.clearTimeout(this.timerId);this.timerId=null}if(null!=this.rightclickTimerId){window.clearTimeout(this.rightclickTimerId);this.rightclickTimerId=null}},delayedCall:function(e){this.timerId=null;e&&this.callback("click",[e])},getEventInfo:function(e){var t;if(e.touches){var r=e.touches.length;t=new Array(r);for(var n,i=0;r>i;i++){n=e.touches[i];t[i]={clientX:n.olClientX,clientY:n.olClientY}}}return{xy:e.xy,touches:t}},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();this.down=null;this.first=null;this.last=null;e=!0}return e},CLASS_NAME:"OpenLayers.Handler.Click"});OpenLayers.Control.Navigation=OpenLayers.Class(OpenLayers.Control,{dragPan:null,dragPanOptions:null,pinchZoom:null,pinchZoomOptions:null,documentDrag:!1,zoomBox:null,zoomBoxEnabled:!0,zoomWheelEnabled:!0,mouseWheelOptions:null,handleRightClicks:!1,zoomBoxKeyMask:OpenLayers.Handler.MOD_SHIFT,autoActivate:!0,initialize:function(e){this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,arguments)},destroy:function(){this.deactivate();this.dragPan&&this.dragPan.destroy();this.dragPan=null;this.zoomBox&&this.zoomBox.destroy();this.zoomBox=null;this.pinchZoom&&this.pinchZoom.destroy();this.pinchZoom=null;OpenLayers.Control.prototype.destroy.apply(this,arguments)},activate:function(){this.dragPan.activate();this.zoomWheelEnabled&&this.handlers.wheel.activate();this.handlers.click.activate();this.zoomBoxEnabled&&this.zoomBox.activate();this.pinchZoom&&this.pinchZoom.activate();return OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.pinchZoom&&this.pinchZoom.deactivate();this.zoomBox.deactivate();this.dragPan.deactivate();this.handlers.click.deactivate();this.handlers.wheel.deactivate();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},draw:function(){this.handleRightClicks&&(this.map.viewPortDiv.oncontextmenu=OpenLayers.Function.False);var e={click:this.defaultClick,dblclick:this.defaultDblClick,dblrightclick:this.defaultDblRightClick},t={"double":!0,stopDouble:!0};this.handlers.click=new OpenLayers.Handler.Click(this,e,t);this.dragPan=new OpenLayers.Control.DragPan(OpenLayers.Util.extend({map:this.map,documentDrag:this.documentDrag},this.dragPanOptions));this.zoomBox=new OpenLayers.Control.ZoomBox({map:this.map,keyMask:this.zoomBoxKeyMask});this.dragPan.draw();this.zoomBox.draw();var r=this.map.fractionalZoom?{}:{cumulative:!1,interval:50,maxDelta:6};this.handlers.wheel=new OpenLayers.Handler.MouseWheel(this,{up:this.wheelUp,down:this.wheelDown},OpenLayers.Util.extend(r,this.mouseWheelOptions));OpenLayers.Control.PinchZoom&&(this.pinchZoom=new OpenLayers.Control.PinchZoom(OpenLayers.Util.extend({map:this.map},this.pinchZoomOptions)))},defaultClick:function(e){e.lastTouches&&2==e.lastTouches.length&&this.map.zoomOut()},defaultDblClick:function(e){this.map.zoomTo(this.map.zoom+1,e.xy)},defaultDblRightClick:function(e){this.map.zoomTo(this.map.zoom-1,e.xy)},wheelChange:function(e,t){this.map.fractionalZoom||(t=Math.round(t));var r=this.map.getZoom(),n=r+t;n=Math.max(n,0);n=Math.min(n,this.map.getNumZoomLevels());n!==r&&this.map.zoomTo(n,e.xy)},wheelUp:function(e,t){this.wheelChange(e,t||1)},wheelDown:function(e,t){this.wheelChange(e,t||-1)},disableZoomBox:function(){this.zoomBoxEnabled=!1;this.zoomBox.deactivate()},enableZoomBox:function(){this.zoomBoxEnabled=!0;this.active&&this.zoomBox.activate()},disableZoomWheel:function(){this.zoomWheelEnabled=!1;this.handlers.wheel.deactivate()},enableZoomWheel:function(){this.zoomWheelEnabled=!0;this.active&&this.handlers.wheel.activate()},CLASS_NAME:"OpenLayers.Control.Navigation"});OpenLayers.Layer.WMS=OpenLayers.Class(OpenLayers.Layer.Grid,{DEFAULT_PARAMS:{service:"WMS",version:"1.1.1",request:"GetMap",styles:"",format:"image/jpeg"},isBaseLayer:!0,encodeBBOX:!1,noMagic:!1,yx:{},initialize:function(e,t,r,n){var i=[];r=OpenLayers.Util.upperCaseObject(r);parseFloat(r.VERSION)>=1.3&&!r.EXCEPTIONS&&(r.EXCEPTIONS="INIMAGE");i.push(e,t,r,n);OpenLayers.Layer.Grid.prototype.initialize.apply(this,i);OpenLayers.Util.applyDefaults(this.params,OpenLayers.Util.upperCaseObject(this.DEFAULT_PARAMS));if(!this.noMagic&&this.params.TRANSPARENT&&"true"==this.params.TRANSPARENT.toString().toLowerCase()){null!=n&&n.isBaseLayer||(this.isBaseLayer=!1);"image/jpeg"==this.params.FORMAT&&(this.params.FORMAT=OpenLayers.Util.alphaHack()?"image/gif":"image/png")}},clone:function(e){null==e&&(e=new OpenLayers.Layer.WMS(this.name,this.url,this.params,this.getOptions()));e=OpenLayers.Layer.Grid.prototype.clone.apply(this,[e]);return e},reverseAxisOrder:function(){var e=this.projection.getCode();return parseFloat(this.params.VERSION)>=1.3&&!!(this.yx[e]||OpenLayers.Projection.defaults[e]&&OpenLayers.Projection.defaults[e].yx)},getURL:function(e){e=this.adjustBounds(e);var t=this.getImageSize(),r={},n=this.reverseAxisOrder();r.BBOX=this.encodeBBOX?e.toBBOX(null,n):e.toArray(n);r.WIDTH=t.w;r.HEIGHT=t.h;var i=this.getFullRequestString(r);return i},mergeNewParams:function(e){var t=OpenLayers.Util.upperCaseObject(e),r=[t];return OpenLayers.Layer.Grid.prototype.mergeNewParams.apply(this,r)},getFullRequestString:function(e,t){var r=this.map.getProjectionObject(),n=this.projection&&this.projection.equals(r)?this.projection.getCode():r.getCode(),i="none"==n?null:n;parseFloat(this.params.VERSION)>=1.3?this.params.CRS=i:this.params.SRS=i;"boolean"==typeof this.params.TRANSPARENT&&(e.TRANSPARENT=this.params.TRANSPARENT?"TRUE":"FALSE");return OpenLayers.Layer.Grid.prototype.getFullRequestString.apply(this,arguments)},CLASS_NAME:"OpenLayers.Layer.WMS"});OpenLayers.StyleMap=OpenLayers.Class({styles:null,extendDefault:!0,initialize:function(e,t){this.styles={"default":new OpenLayers.Style(OpenLayers.Feature.Vector.style["default"]),select:new OpenLayers.Style(OpenLayers.Feature.Vector.style.select),temporary:new OpenLayers.Style(OpenLayers.Feature.Vector.style.temporary),"delete":new OpenLayers.Style(OpenLayers.Feature.Vector.style["delete"])};if(e instanceof OpenLayers.Style){this.styles["default"]=e;this.styles.select=e;this.styles.temporary=e;this.styles["delete"]=e}else if("object"==typeof e)for(var r in e)if(e[r]instanceof OpenLayers.Style)this.styles[r]=e[r];else{if("object"!=typeof e[r]){this.styles["default"]=new OpenLayers.Style(e);this.styles.select=new OpenLayers.Style(e);this.styles.temporary=new OpenLayers.Style(e);this.styles["delete"]=new OpenLayers.Style(e);break}this.styles[r]=new OpenLayers.Style(e[r])}OpenLayers.Util.extend(this,t)},destroy:function(){for(var e in this.styles)this.styles[e].destroy();this.styles=null},createSymbolizer:function(e,t){e||(e=new OpenLayers.Feature.Vector);this.styles[t]||(t="default");e.renderIntent=t;var r={};this.extendDefault&&"default"!=t&&(r=this.styles["default"].createSymbolizer(e));return OpenLayers.Util.extend(r,this.styles[t].createSymbolizer(e))},addUniqueValueRules:function(e,t,r,n){var i=[];for(var a in r)i.push(new OpenLayers.Rule({symbolizer:r[a],context:n,filter:new OpenLayers.Filter.Comparison({type:OpenLayers.Filter.Comparison.EQUAL_TO,property:t,value:a})}));this.styles[e].addRules(i)},CLASS_NAME:"OpenLayers.StyleMap"});OpenLayers.Layer.Vector=OpenLayers.Class(OpenLayers.Layer,{isBaseLayer:!1,isFixed:!1,features:null,filter:null,selectedFeatures:null,unrenderedFeatures:null,reportError:!0,style:null,styleMap:null,strategies:null,protocol:null,renderers:["SVG","VML","Canvas"],renderer:null,rendererOptions:null,geometryType:null,drawn:!1,ratio:1,initialize:function(e,t){OpenLayers.Layer.prototype.initialize.apply(this,arguments);this.renderer&&this.renderer.supported()||this.assignRenderer();if(!this.renderer||!this.renderer.supported()){this.renderer=null;this.displayError()}this.styleMap||(this.styleMap=new OpenLayers.StyleMap);this.features=[];this.selectedFeatures=[];this.unrenderedFeatures={};if(this.strategies)for(var r=0,n=this.strategies.length;n>r;r++)this.strategies[r].setLayer(this)},destroy:function(){if(this.strategies){var e,t,r;for(t=0,r=this.strategies.length;r>t;t++){e=this.strategies[t];e.autoDestroy&&e.destroy()}this.strategies=null}if(this.protocol){this.protocol.autoDestroy&&this.protocol.destroy();this.protocol=null}this.destroyFeatures();this.features=null;this.selectedFeatures=null;this.unrenderedFeatures=null;this.renderer&&this.renderer.destroy();this.renderer=null;this.geometryType=null;this.drawn=null;OpenLayers.Layer.prototype.destroy.apply(this,arguments)},clone:function(e){null==e&&(e=new OpenLayers.Layer.Vector(this.name,this.getOptions()));e=OpenLayers.Layer.prototype.clone.apply(this,[e]);for(var t=this.features,r=t.length,n=new Array(r),i=0;r>i;++i)n[i]=t[i].clone();e.features=n;return e},refresh:function(e){this.calculateInRange()&&this.visibility&&this.events.triggerEvent("refresh",e);

},assignRenderer:function(){for(var e=0,t=this.renderers.length;t>e;e++){var r=this.renderers[e],n="function"==typeof r?r:OpenLayers.Renderer[r];if(n&&n.prototype.supported()){this.renderer=new n(this.div,this.rendererOptions);break}}},displayError:function(){this.reportError&&OpenLayers.Console.userError(OpenLayers.i18n("browserNotSupported",{renderers:this.renderers.join("\n")}))},setMap:function(e){OpenLayers.Layer.prototype.setMap.apply(this,arguments);if(this.renderer){this.renderer.map=this.map;var t=this.map.getSize();t.w=t.w*this.ratio;t.h=t.h*this.ratio;this.renderer.setSize(t)}else this.map.removeLayer(this)},afterAdd:function(){if(this.strategies){var e,t,r;for(t=0,r=this.strategies.length;r>t;t++){e=this.strategies[t];e.autoActivate&&e.activate()}}},removeMap:function(e){this.drawn=!1;if(this.strategies){var t,r,n;for(r=0,n=this.strategies.length;n>r;r++){t=this.strategies[r];t.autoActivate&&t.deactivate()}}},onMapResize:function(){OpenLayers.Layer.prototype.onMapResize.apply(this,arguments);var e=this.map.getSize();e.w=e.w*this.ratio;e.h=e.h*this.ratio;this.renderer.setSize(e)},moveTo:function(e,t,r){OpenLayers.Layer.prototype.moveTo.apply(this,arguments);var n=!0;if(!r){this.renderer.root.style.visibility="hidden";var i=this.map.getSize(),a=i.w,s=i.h,o=a/2*this.ratio-a/2,l=s/2*this.ratio-s/2;o+=this.map.layerContainerOriginPx.x;o=-Math.round(o);l+=this.map.layerContainerOriginPx.y;l=-Math.round(l);this.div.style.left=o+"px";this.div.style.top=l+"px";var c=this.map.getExtent().scale(this.ratio);n=this.renderer.setExtent(c,t);this.renderer.root.style.visibility="visible";OpenLayers.IS_GECKO===!0&&(this.div.scrollLeft=this.div.scrollLeft);if(!t&&n)for(var u in this.unrenderedFeatures){var p=this.unrenderedFeatures[u];this.drawFeature(p)}}if(!this.drawn||t||!n){this.drawn=!0;for(var p,u=0,h=this.features.length;h>u;u++){this.renderer.locked=u!==h-1;p=this.features[u];this.drawFeature(p)}}},display:function(e){OpenLayers.Layer.prototype.display.apply(this,arguments);var t=this.div.style.display;t!=this.renderer.root.style.display&&(this.renderer.root.style.display=t)},addFeatures:function(e,t){OpenLayers.Util.isArray(e)||(e=[e]);var r=!t||!t.silent;if(r){var n={features:e},i=this.events.triggerEvent("beforefeaturesadded",n);if(i===!1)return;e=n.features}for(var a=[],s=0,o=e.length;o>s;s++){this.renderer.locked=s!=e.length-1?!0:!1;var l=e[s];if(this.geometryType&&!(l.geometry instanceof this.geometryType))throw new TypeError("addFeatures: component should be an "+this.geometryType.prototype.CLASS_NAME);l.layer=this;!l.style&&this.style&&(l.style=OpenLayers.Util.extend({},this.style));if(r){if(this.events.triggerEvent("beforefeatureadded",{feature:l})===!1)continue;this.preFeatureInsert(l)}a.push(l);this.features.push(l);this.drawFeature(l);if(r){this.events.triggerEvent("featureadded",{feature:l});this.onFeatureInsert(l)}}r&&this.events.triggerEvent("featuresadded",{features:a})},removeFeatures:function(e,t){if(e&&0!==e.length){if(e===this.features)return this.removeAllFeatures(t);OpenLayers.Util.isArray(e)||(e=[e]);e===this.selectedFeatures&&(e=e.slice());var r=!t||!t.silent;r&&this.events.triggerEvent("beforefeaturesremoved",{features:e});for(var n=e.length-1;n>=0;n--){this.renderer.locked=0!=n&&e[n-1].geometry?!0:!1;var i=e[n];delete this.unrenderedFeatures[i.id];r&&this.events.triggerEvent("beforefeatureremoved",{feature:i});this.features=OpenLayers.Util.removeItem(this.features,i);i.layer=null;i.geometry&&this.renderer.eraseFeatures(i);-1!=OpenLayers.Util.indexOf(this.selectedFeatures,i)&&OpenLayers.Util.removeItem(this.selectedFeatures,i);r&&this.events.triggerEvent("featureremoved",{feature:i})}r&&this.events.triggerEvent("featuresremoved",{features:e})}},removeAllFeatures:function(e){var t=!e||!e.silent,r=this.features;t&&this.events.triggerEvent("beforefeaturesremoved",{features:r});for(var n,i=r.length-1;i>=0;i--){n=r[i];t&&this.events.triggerEvent("beforefeatureremoved",{feature:n});n.layer=null;t&&this.events.triggerEvent("featureremoved",{feature:n})}this.renderer.clear();this.features=[];this.unrenderedFeatures={};this.selectedFeatures=[];t&&this.events.triggerEvent("featuresremoved",{features:r})},destroyFeatures:function(e,t){var r=void 0==e;r&&(e=this.features);if(e){this.removeFeatures(e,t);for(var n=e.length-1;n>=0;n--)e[n].destroy()}},drawFeature:function(e,t){if(this.drawn){if("object"!=typeof t){t||e.state!==OpenLayers.State.DELETE||(t="delete");var r=t||e.renderIntent;t=e.style||this.style;t||(t=this.styleMap.createSymbolizer(e,r))}var n=this.renderer.drawFeature(e,t);n===!1||null===n?this.unrenderedFeatures[e.id]=e:delete this.unrenderedFeatures[e.id]}},eraseFeatures:function(e){this.renderer.eraseFeatures(e)},getFeatureFromEvent:function(e){if(!this.renderer)throw new Error("getFeatureFromEvent called on layer with no renderer. This usually means you destroyed a layer, but not some handler which is associated with it.");var t=null,r=this.renderer.getFeatureIdFromEvent(e);r&&(t="string"==typeof r?this.getFeatureById(r):r);return t},getFeatureBy:function(e,t){for(var r=null,n=0,i=this.features.length;i>n;++n)if(this.features[n][e]==t){r=this.features[n];break}return r},getFeatureById:function(e){return this.getFeatureBy("id",e)},getFeatureByFid:function(e){return this.getFeatureBy("fid",e)},getFeaturesByAttribute:function(e,t){var r,n,i=this.features.length,a=[];for(r=0;i>r;r++){n=this.features[r];n&&n.attributes&&n.attributes[e]===t&&a.push(n)}return a},onFeatureInsert:function(e){},preFeatureInsert:function(e){},getDataExtent:function(){var e=null,t=this.features;if(t&&t.length>0)for(var r=null,n=0,i=t.length;i>n;n++){r=t[n].geometry;if(r){null===e&&(e=new OpenLayers.Bounds);e.extend(r.getBounds())}}return e},CLASS_NAME:"OpenLayers.Layer.Vector"});OpenLayers.Renderer.SVG=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",MAX_PIXEL:15e3,translationParameters:null,symbolMetrics:null,initialize:function(e){if(this.supported()){OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments);this.translationParameters={x:0,y:0};this.symbolMetrics={}}},supported:function(){var e="http://www.w3.org/TR/SVG11/feature#";return document.implementation&&(document.implementation.hasFeature("org.w3c.svg","1.0")||document.implementation.hasFeature(e+"SVG","1.1")||document.implementation.hasFeature(e+"BasicStructure","1.1"))},inValidRange:function(e,t,r){var n=e+(r?0:this.translationParameters.x),i=t+(r?0:this.translationParameters.y);return n>=-this.MAX_PIXEL&&n<=this.MAX_PIXEL&&i>=-this.MAX_PIXEL&&i<=this.MAX_PIXEL},setExtent:function(e,t){var r=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),i=-e.left/n,a=e.top/n;if(t){this.left=i;this.top=a;var s="0 0 "+this.size.w+" "+this.size.h;this.rendererRoot.setAttributeNS(null,"viewBox",s);this.translate(this.xOffset,0);return!0}var o=this.translate(i-this.left+this.xOffset,a-this.top);o||this.setExtent(e,!0);return r&&o},translate:function(e,t){if(this.inValidRange(e,t,!0)){var r="";(e||t)&&(r="translate("+e+","+t+")");this.root.setAttributeNS(null,"transform",r);this.translationParameters={x:e,y:t};return!0}return!1},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);this.rendererRoot.setAttributeNS(null,"width",this.size.w);this.rendererRoot.setAttributeNS(null,"height",this.size.h)},getNodeType:function(e,t){var r=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":r=t.externalGraphic?"image":this.isComplexSymbol(t.graphicName)?"svg":"circle";break;case"OpenLayers.Geometry.Rectangle":r="rect";break;case"OpenLayers.Geometry.LineString":r="polyline";break;case"OpenLayers.Geometry.LinearRing":r="polygon";break;case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":r="path"}return r},setStyle:function(e,t,r){t=t||e._style;r=r||e._options;var n=t.title||t.graphicTitle;if(n){e.setAttributeNS(null,"title",n);var i=e.getElementsByTagName("title");if(i.length>0)i[0].firstChild.textContent=n;else{var a=this.nodeFactory(null,"title");a.textContent=n;e.appendChild(a)}}var s,o=parseFloat(e.getAttributeNS(null,"r")),l=1;if("OpenLayers.Geometry.Point"==e._geometryClass&&o){e.style.visibility="";if(t.graphic===!1)e.style.visibility="hidden";else if(t.externalGraphic){s=this.getPosition(e);t.graphicWidth&&t.graphicHeight&&e.setAttributeNS(null,"preserveAspectRatio","none");var c=t.graphicWidth||t.graphicHeight,u=t.graphicHeight||t.graphicWidth;c=c?c:2*t.pointRadius;u=u?u:2*t.pointRadius;var p=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*c),h=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*u),d=t.graphicOpacity||t.fillOpacity;e.setAttributeNS(null,"x",(s.x+p).toFixed());e.setAttributeNS(null,"y",(s.y+h).toFixed());e.setAttributeNS(null,"width",c);e.setAttributeNS(null,"height",u);e.setAttributeNS(this.xlinkns,"xlink:href",t.externalGraphic);e.setAttributeNS(null,"style","opacity: "+d);e.onclick=OpenLayers.Event.preventDefault}else if(this.isComplexSymbol(t.graphicName)){var f=3*t.pointRadius,m=2*f,y=this.importSymbol(t.graphicName);s=this.getPosition(e);l=3*this.symbolMetrics[y.id][0]/m;var g=e.parentNode,v=e.nextSibling;g&&g.removeChild(e);e.firstChild&&e.removeChild(e.firstChild);e.appendChild(y.firstChild.cloneNode(!0));e.setAttributeNS(null,"viewBox",y.getAttributeNS(null,"viewBox"));e.setAttributeNS(null,"width",m);e.setAttributeNS(null,"height",m);e.setAttributeNS(null,"x",s.x-f);e.setAttributeNS(null,"y",s.y-f);v?g.insertBefore(e,v):g&&g.appendChild(e)}else e.setAttributeNS(null,"r",t.pointRadius);var C=t.rotation;if((void 0!==C||void 0!==e._rotation)&&s){e._rotation=C;C|=0;if("svg"!==e.nodeName)e.setAttributeNS(null,"transform","rotate("+C+" "+s.x+" "+s.y+")");else{var T=this.symbolMetrics[y.id];e.firstChild.setAttributeNS(null,"transform","rotate("+C+" "+T[1]+" "+T[2]+")")}}}if(r.isFilled){e.setAttributeNS(null,"fill",t.fillColor);e.setAttributeNS(null,"fill-opacity",t.fillOpacity)}else e.setAttributeNS(null,"fill","none");if(r.isStroked){e.setAttributeNS(null,"stroke",t.strokeColor);e.setAttributeNS(null,"stroke-opacity",t.strokeOpacity);e.setAttributeNS(null,"stroke-width",t.strokeWidth*l);e.setAttributeNS(null,"stroke-linecap",t.strokeLinecap||"round");e.setAttributeNS(null,"stroke-linejoin","round");t.strokeDashstyle&&e.setAttributeNS(null,"stroke-dasharray",this.dashStyle(t,l))}else e.setAttributeNS(null,"stroke","none");t.pointerEvents&&e.setAttributeNS(null,"pointer-events",t.pointerEvents);null!=t.cursor&&e.setAttributeNS(null,"cursor",t.cursor);return e},dashStyle:function(e,t){var r=e.strokeWidth*t,n=e.strokeDashstyle;switch(n){case"solid":return"none";case"dot":return[1,4*r].join();case"dash":return[4*r,4*r].join();case"dashdot":return[4*r,4*r,1,4*r].join();case"longdash":return[8*r,4*r].join();case"longdashdot":return[8*r,4*r,1,4*r].join();default:return OpenLayers.String.trim(n).replace(/\s+/g,",")}},createNode:function(e,t){var r=document.createElementNS(this.xmlns,e);t&&r.setAttributeNS(null,"id",t);return r},nodeTypeCompare:function(e,t){return t==e.nodeName},createRenderRoot:function(){var e=this.nodeFactory(this.container.id+"_svgRoot","svg");e.style.display="block";return e},createRoot:function(e){return this.nodeFactory(this.container.id+e,"g")},createDefs:function(){var e=this.nodeFactory(this.container.id+"_defs","defs");this.rendererRoot.appendChild(e);return e},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,r){var n=this.getResolution(),i=(t.x-this.featureDx)/n+this.left,a=this.top-t.y/n;if(this.inValidRange(i,a)){e.setAttributeNS(null,"cx",i);e.setAttributeNS(null,"cy",a);e.setAttributeNS(null,"r",r);return e}return!1},drawLineString:function(e,t){var r=this.getComponentsString(t.components);if(r.path){e.setAttributeNS(null,"points",r.path);return r.complete?e:null}return!1},drawLinearRing:function(e,t){var r=this.getComponentsString(t.components);if(r.path){e.setAttributeNS(null,"points",r.path);return r.complete?e:null}return!1},drawPolygon:function(e,t){for(var r,n,i="",a=!0,s=!0,o=0,l=t.components.length;l>o;o++){i+=" M";r=this.getComponentsString(t.components[o].components," ");n=r.path;if(n){i+=" "+n;s=r.complete&&s}else a=!1}i+=" z";if(a){e.setAttributeNS(null,"d",i);e.setAttributeNS(null,"fill-rule","evenodd");return s?e:null}return!1},drawRectangle:function(e,t){var r=this.getResolution(),n=(t.x-this.featureDx)/r+this.left,i=this.top-t.y/r;if(this.inValidRange(n,i)){e.setAttributeNS(null,"x",n);e.setAttributeNS(null,"y",i);e.setAttributeNS(null,"width",t.width/r);e.setAttributeNS(null,"height",t.height/r);return e}return!1},drawText:function(e,t,r){var n=!!t.labelOutlineWidth;if(n){var i=OpenLayers.Util.extend({},t);i.fontColor=i.labelOutlineColor;i.fontStrokeColor=i.labelOutlineColor;i.fontStrokeWidth=t.labelOutlineWidth;t.labelOutlineOpacity&&(i.fontOpacity=t.labelOutlineOpacity);delete i.labelOutlineWidth;this.drawText(e,i,r)}var a=this.getResolution(),s=(r.x-this.featureDx)/a+this.left,o=r.y/a-this.top,l=n?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,c=this.nodeFactory(e+l,"text");c.setAttributeNS(null,"x",s);c.setAttributeNS(null,"y",-o);t.fontColor&&c.setAttributeNS(null,"fill",t.fontColor);t.fontStrokeColor&&c.setAttributeNS(null,"stroke",t.fontStrokeColor);t.fontStrokeWidth&&c.setAttributeNS(null,"stroke-width",t.fontStrokeWidth);t.fontOpacity&&c.setAttributeNS(null,"opacity",t.fontOpacity);t.fontFamily&&c.setAttributeNS(null,"font-family",t.fontFamily);t.fontSize&&c.setAttributeNS(null,"font-size",t.fontSize);t.fontWeight&&c.setAttributeNS(null,"font-weight",t.fontWeight);t.fontStyle&&c.setAttributeNS(null,"font-style",t.fontStyle);if(t.labelSelect===!0){c.setAttributeNS(null,"pointer-events","visible");c._featureId=e}else c.setAttributeNS(null,"pointer-events","none");var u=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;c.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[u[0]]||"middle");OpenLayers.IS_GECKO===!0&&c.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[u[1]]||"central");for(var p=t.label.split("\n"),h=p.length;c.childNodes.length>h;)c.removeChild(c.lastChild);for(var d=0;h>d;d++){var f=this.nodeFactory(e+l+"_tspan_"+d,"tspan");if(t.labelSelect===!0){f._featureId=e;f._geometry=r;f._geometryClass=r.CLASS_NAME}OpenLayers.IS_GECKO===!1&&f.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[u[1]]||"-35%");f.setAttribute("x",s);if(0==d){var m=OpenLayers.Renderer.SVG.LABEL_VFACTOR[u[1]];null==m&&(m=-.5);f.setAttribute("dy",m*(h-1)+"em")}else f.setAttribute("dy","1em");f.textContent=""===p[d]?" ":p[d];f.parentNode||c.appendChild(f)}c.parentNode||this.textRoot.appendChild(c)},getComponentsString:function(e,t){for(var r,n,i=[],a=!0,s=e.length,o=[],l=0;s>l;l++){n=e[l];i.push(n);r=this.getShortString(n);if(r)o.push(r);else{l>0&&this.getShortString(e[l-1])&&o.push(this.clipLine(e[l],e[l-1]));s-1>l&&this.getShortString(e[l+1])&&o.push(this.clipLine(e[l],e[l+1]));a=!1}}return{path:o.join(t||","),complete:a}},clipLine:function(e,t){if(t.equals(e))return"";var r,n=this.getResolution(),i=this.MAX_PIXEL-this.translationParameters.x,a=this.MAX_PIXEL-this.translationParameters.y,s=(t.x-this.featureDx)/n+this.left,o=this.top-t.y/n,l=(e.x-this.featureDx)/n+this.left,c=this.top-e.y/n;if(-i>l||l>i){r=(c-o)/(l-s);l=0>l?-i:i;c=o+(l-s)*r}if(-a>c||c>a){r=(l-s)/(c-o);c=0>c?-a:a;l=s+(c-o)*r}return l+","+c},getShortString:function(e){var t=this.getResolution(),r=(e.x-this.featureDx)/t+this.left,n=this.top-e.y/t;return this.inValidRange(r,n)?r+","+n:!1},getPosition:function(e){return{x:parseFloat(e.getAttributeNS(null,"cx")),y:parseFloat(e.getAttributeNS(null,"cy"))}},importSymbol:function(e){this.defs||(this.defs=this.createDefs());var t=this.container.id+"-"+e,r=document.getElementById(t);if(null!=r)return r;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");var i=this.nodeFactory(t,"symbol"),a=this.nodeFactory(null,"polygon");i.appendChild(a);for(var s,o,l=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),c=[],u=0;u<n.length;u+=2){s=n[u];o=n[u+1];l.left=Math.min(l.left,s);l.bottom=Math.min(l.bottom,o);l.right=Math.max(l.right,s);l.top=Math.max(l.top,o);c.push(s,",",o)}a.setAttributeNS(null,"points",c.join(" "));var p=l.getWidth(),h=l.getHeight(),d=[l.left-p,l.bottom-h,3*p,3*h];i.setAttributeNS(null,"viewBox",d.join(" "));this.symbolMetrics[t]=[Math.max(p,h),l.getCenterLonLat().lon,l.getCenterLonLat().lat];this.defs.appendChild(i);return i},getFeatureIdFromEvent:function(e){var t=OpenLayers.Renderer.Elements.prototype.getFeatureIdFromEvent.apply(this,arguments);if(!t){var r=e.target;t=r.parentNode&&r!=this.rendererRoot?r.parentNode._featureId:void 0}return t},CLASS_NAME:"OpenLayers.Renderer.SVG"});OpenLayers.Renderer.SVG.LABEL_ALIGN={l:"start",r:"end",b:"bottom",t:"hanging"};OpenLayers.Renderer.SVG.LABEL_VSHIFT={t:"-70%",b:"0"};OpenLayers.Renderer.SVG.LABEL_VFACTOR={t:0,b:-1};OpenLayers.Renderer.SVG.preventDefault=function(e){OpenLayers.Event.preventDefault(e)};OpenLayers.Control.ScaleLine=OpenLayers.Class(OpenLayers.Control,{maxWidth:100,topOutUnits:"km",topInUnits:"m",bottomOutUnits:"mi",bottomInUnits:"ft",eTop:null,eBottom:null,geodesic:!1,draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(!this.eTop){this.eTop=document.createElement("div");this.eTop.className=this.displayClass+"Top";{this.topInUnits.length}this.div.appendChild(this.eTop);this.eTop.style.visibility=""==this.topOutUnits||""==this.topInUnits?"hidden":"visible";this.eBottom=document.createElement("div");this.eBottom.className=this.displayClass+"Bottom";this.div.appendChild(this.eBottom);this.eBottom.style.visibility=""==this.bottomOutUnits||""==this.bottomInUnits?"hidden":"visible"}this.map.events.register("moveend",this,this.update);this.update();return this.div},getBarLen:function(e){var t,r=parseInt(Math.log(e)/Math.log(10)),n=Math.pow(10,r),i=parseInt(e/n);t=i>5?5:i>2?2:1;return t*n},update:function(){var e=this.map.getResolution();if(e){var t=this.map.getUnits(),r=OpenLayers.INCHES_PER_UNIT,n=this.maxWidth*e*r[t],i=1;if(this.geodesic===!0){var a=(this.map.getGeodesicPixelSize().w||1e-6)*this.maxWidth,s=n/r.km;i=a/s;n*=i}var o,l;if(n>1e5){o=this.topOutUnits;l=this.bottomOutUnits}else{o=this.topInUnits;l=this.bottomInUnits}var c=n/r[o],u=n/r[l],p=this.getBarLen(c),h=this.getBarLen(u);c=p/r[t]*r[o];u=h/r[t]*r[l];var d=c/e/i,f=u/e/i;if("visible"==this.eBottom.style.visibility){this.eBottom.style.width=Math.round(f)+"px";this.eBottom.innerHTML=h+" "+l}if("visible"==this.eTop.style.visibility){this.eTop.style.width=Math.round(d)+"px";this.eTop.innerHTML=p+" "+o}}},CLASS_NAME:"OpenLayers.Control.ScaleLine"});OpenLayers.Icon=OpenLayers.Class({url:null,size:null,offset:null,calculateOffset:null,imageDiv:null,px:null,initialize:function(e,t,r,n){this.url=e;this.size=t||{w:20,h:20};this.offset=r||{x:-(this.size.w/2),y:-(this.size.h/2)};this.calculateOffset=n;var i=OpenLayers.Util.createUniqueID("OL_Icon_");this.imageDiv=OpenLayers.Util.createAlphaImageDiv(i)},destroy:function(){this.erase();OpenLayers.Event.stopObservingElement(this.imageDiv.firstChild);this.imageDiv.innerHTML="";this.imageDiv=null},clone:function(){return new OpenLayers.Icon(this.url,this.size,this.offset,this.calculateOffset)},setSize:function(e){null!=e&&(this.size=e);this.draw()},setUrl:function(e){null!=e&&(this.url=e);this.draw()},draw:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,this.size,this.url,"absolute");this.moveTo(e);return this.imageDiv},erase:function(){null!=this.imageDiv&&null!=this.imageDiv.parentNode&&OpenLayers.Element.remove(this.imageDiv)},setOpacity:function(e){OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,null,null,null,null,null,null,e)},moveTo:function(e){null!=e&&(this.px=e);if(null!=this.imageDiv)if(null==this.px)this.display(!1);else{this.calculateOffset&&(this.offset=this.calculateOffset(this.size));OpenLayers.Util.modifyAlphaImageDiv(this.imageDiv,null,{x:this.px.x+this.offset.x,y:this.px.y+this.offset.y})}},display:function(e){this.imageDiv.style.display=e?"":"none"},isDrawn:function(){var e=this.imageDiv&&this.imageDiv.parentNode&&11!=this.imageDiv.parentNode.nodeType;return e},CLASS_NAME:"OpenLayers.Icon"});OpenLayers.Marker=OpenLayers.Class({icon:null,lonlat:null,events:null,map:null,initialize:function(e,t){this.lonlat=e;var r=t?t:OpenLayers.Marker.defaultIcon();if(null==this.icon)this.icon=r;else{this.icon.url=r.url;this.icon.size=r.size;this.icon.offset=r.offset;this.icon.calculateOffset=r.calculateOffset}this.events=new OpenLayers.Events(this,this.icon.imageDiv)},destroy:function(){this.erase();this.map=null;this.events.destroy();this.events=null;if(null!=this.icon){this.icon.destroy();this.icon=null}},draw:function(e){return this.icon.draw(e)},erase:function(){null!=this.icon&&this.icon.erase()},moveTo:function(e){null!=e&&null!=this.icon&&this.icon.moveTo(e);this.lonlat=this.map.getLonLatFromLayerPx(e)},isDrawn:function(){var e=this.icon&&this.icon.isDrawn();return e},onScreen:function(){var e=!1;if(this.map){var t=this.map.getExtent();e=t.containsLonLat(this.lonlat)}return e},inflate:function(e){this.icon&&this.icon.setSize({w:this.icon.size.w*e,h:this.icon.size.h*e})},setOpacity:function(e){this.icon.setOpacity(e)},setUrl:function(e){this.icon.setUrl(e)},display:function(e){this.icon.display(e)},CLASS_NAME:"OpenLayers.Marker"});OpenLayers.Marker.defaultIcon=function(){return new OpenLayers.Icon(OpenLayers.Util.getImageLocation("marker.png"),{w:21,h:25},{x:-10.5,y:-25})};OpenLayers.Format.JSON=OpenLayers.Class(OpenLayers.Format,{indent:"    ",space:" ",newline:"\n",level:0,pretty:!1,nativeJSON:function(){return!(!window.JSON||"function"!=typeof JSON.parse||"function"!=typeof JSON.stringify)}(),read:function(json,filter){function walk(e,t){if(t&&"object"==typeof t)for(var r in t)t.hasOwnProperty(r)&&(t[r]=walk(r,t[r]));return filter(e,t)}var object;if(this.nativeJSON)object=JSON.parse(json,filter);else try{if(/^[\],:{}\s]*$/.test(json.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){object=eval("("+json+")");"function"==typeof filter&&(object=walk("",object))}}catch(e){}this.keepData&&(this.data=object);return object},write:function(e,t){this.pretty=!!t;var r=null,n=typeof e;if(this.serialize[n])try{r=!this.pretty&&this.nativeJSON?JSON.stringify(e):this.serialize[n].apply(this,[e])}catch(i){OpenLayers.Console.error("Trouble serializing: "+i)}return r},writeIndent:function(){var e=[];if(this.pretty)for(var t=0;t<this.level;++t)e.push(this.indent);return e.join("")},writeNewline:function(){return this.pretty?this.newline:""},writeSpace:function(){return this.pretty?this.space:""},serialize:{object:function(e){if(null==e)return"null";if(e.constructor==Date)return this.serialize.date.apply(this,[e]);if(e.constructor==Array)return this.serialize.array.apply(this,[e]);var t=["{"];this.level+=1;var r,n,i,a=!1;for(r in e)if(e.hasOwnProperty(r)){n=OpenLayers.Format.JSON.prototype.write.apply(this,[r,this.pretty]);i=OpenLayers.Format.JSON.prototype.write.apply(this,[e[r],this.pretty]);if(null!=n&&null!=i){a&&t.push(",");t.push(this.writeNewline(),this.writeIndent(),n,":",this.writeSpace(),i);a=!0}}this.level-=1;t.push(this.writeNewline(),this.writeIndent(),"}");return t.join("")},array:function(e){var t,r=["["];this.level+=1;for(var n=0,i=e.length;i>n;++n){t=OpenLayers.Format.JSON.prototype.write.apply(this,[e[n],this.pretty]);if(null!=t){n>0&&r.push(",");r.push(this.writeNewline(),this.writeIndent(),t)}}this.level-=1;r.push(this.writeNewline(),this.writeIndent(),"]");return r.join("")},string:function(e){var t={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(e,r){var n=t[r];if(n)return n;n=r.charCodeAt();return"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16)})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},"boolean":function(e){return String(e)},date:function(e){function t(e){return 10>e?"0"+e:e}return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}},CLASS_NAME:"OpenLayers.Format.JSON"});OpenLayers.Format.GeoJSON=OpenLayers.Class(OpenLayers.Format.JSON,{ignoreExtraDims:!1,read:function(e,t,r){t=t?t:"FeatureCollection";var n=null,i=null;i="string"==typeof e?OpenLayers.Format.JSON.prototype.read.apply(this,[e,r]):e;if(i){if("string"!=typeof i.type)OpenLayers.Console.error("Bad GeoJSON - no type: "+e);else if(this.isValidType(i,t))switch(t){case"Geometry":try{n=this.parseGeometry(i)}catch(a){OpenLayers.Console.error(a)}break;case"Feature":try{n=this.parseFeature(i);n.type="Feature"}catch(a){OpenLayers.Console.error(a)}break;case"FeatureCollection":n=[];switch(i.type){case"Feature":try{n.push(this.parseFeature(i))}catch(a){n=null;OpenLayers.Console.error(a)}break;case"FeatureCollection":for(var s=0,o=i.features.length;o>s;++s)try{n.push(this.parseFeature(i.features[s]))}catch(a){n=null;OpenLayers.Console.error(a)}break;default:try{var l=this.parseGeometry(i);n.push(new OpenLayers.Feature.Vector(l))}catch(a){n=null;OpenLayers.Console.error(a)}}}}else OpenLayers.Console.error("Bad JSON: "+e);return n},isValidType:function(e,t){var r=!1;switch(t){case"Geometry":-1==OpenLayers.Util.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],e.type)?OpenLayers.Console.error("Unsupported geometry type: "+e.type):r=!0;break;case"FeatureCollection":r=!0;break;default:e.type==t?r=!0:OpenLayers.Console.error("Cannot convert types from "+e.type+" to "+t)}return r},parseFeature:function(e){var t,r,n,i;n=e.properties?e.properties:{};i=e.geometry&&e.geometry.bbox||e.bbox;try{r=this.parseGeometry(e.geometry)}catch(a){throw a}t=new OpenLayers.Feature.Vector(r,n);i&&(t.bounds=OpenLayers.Bounds.fromArray(i));e.id&&(t.fid=e.id);return t},parseGeometry:function(e){if(null==e)return null;var t,r=!1;if("GeometryCollection"==e.type){if(!OpenLayers.Util.isArray(e.geometries))throw"GeometryCollection must have geometries array: "+e;for(var n=e.geometries.length,i=new Array(n),a=0;n>a;++a)i[a]=this.parseGeometry.apply(this,[e.geometries[a]]);t=new OpenLayers.Geometry.Collection(i);r=!0}else{if(!OpenLayers.Util.isArray(e.coordinates))throw"Geometry must have coordinates array: "+e;if(!this.parseCoords[e.type.toLowerCase()])throw"Unsupported geometry type: "+e.type;try{t=this.parseCoords[e.type.toLowerCase()].apply(this,[e.coordinates])}catch(s){throw s}}this.internalProjection&&this.externalProjection&&!r&&t.transform(this.externalProjection,this.internalProjection);return t},parseCoords:{point:function(e){if(0==this.ignoreExtraDims&&2!=e.length)throw"Only 2D points are supported: "+e;return new OpenLayers.Geometry.Point(e[0],e[1])},multipoint:function(e){for(var t=[],r=null,n=0,i=e.length;i>n;++n){try{r=this.parseCoords.point.apply(this,[e[n]])}catch(a){throw a}t.push(r)}return new OpenLayers.Geometry.MultiPoint(t)},linestring:function(e){for(var t=[],r=null,n=0,i=e.length;i>n;++n){try{r=this.parseCoords.point.apply(this,[e[n]])}catch(a){throw a}t.push(r)}return new OpenLayers.Geometry.LineString(t)},multilinestring:function(e){for(var t=[],r=null,n=0,i=e.length;i>n;++n){try{r=this.parseCoords.linestring.apply(this,[e[n]])}catch(a){throw a}t.push(r)}return new OpenLayers.Geometry.MultiLineString(t)},polygon:function(e){for(var t,r,n=[],i=0,a=e.length;a>i;++i){try{r=this.parseCoords.linestring.apply(this,[e[i]])}catch(s){throw s}t=new OpenLayers.Geometry.LinearRing(r.components);n.push(t)}return new OpenLayers.Geometry.Polygon(n)},multipolygon:function(e){for(var t=[],r=null,n=0,i=e.length;i>n;++n){try{r=this.parseCoords.polygon.apply(this,[e[n]])}catch(a){throw a}t.push(r)}return new OpenLayers.Geometry.MultiPolygon(t)},box:function(e){if(2!=e.length)throw"GeoJSON box coordinates must have 2 elements";return new OpenLayers.Geometry.Polygon([new OpenLayers.Geometry.LinearRing([new OpenLayers.Geometry.Point(e[0][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[0][1]),new OpenLayers.Geometry.Point(e[1][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[1][1]),new OpenLayers.Geometry.Point(e[0][0],e[0][1])])])}},write:function(e,t){var r={type:null};if(OpenLayers.Util.isArray(e)){r.type="FeatureCollection";var n=e.length;r.features=new Array(n);for(var i=0;n>i;++i){var a=e[i];if(!a instanceof OpenLayers.Feature.Vector){var s="FeatureCollection only supports collections of features: "+a;throw s}r.features[i]=this.extract.feature.apply(this,[a])}}else if(0==e.CLASS_NAME.indexOf("OpenLayers.Geometry"))r=this.extract.geometry.apply(this,[e]);else if(e instanceof OpenLayers.Feature.Vector){r=this.extract.feature.apply(this,[e]);e.layer&&e.layer.projection&&(r.crs=this.createCRSObject(e))}return OpenLayers.Format.JSON.prototype.write.apply(this,[r,t])},createCRSObject:function(e){var t=e.layer.projection.toString(),r={};if(t.match(/epsg:/i)){var n=parseInt(t.substring(t.indexOf(":")+1));r=4326==n?{type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:{type:"name",properties:{name:"EPSG:"+n}}}return r},extract:{feature:function(e){var t=this.extract.geometry.apply(this,[e.geometry]),r={type:"Feature",properties:e.attributes,geometry:t};null!=e.fid&&(r.id=e.fid);return r},geometry:function(e){if(null==e)return null;if(this.internalProjection&&this.externalProjection){e=e.clone();e.transform(this.internalProjection,this.externalProjection)}var t,r=e.CLASS_NAME.split(".")[2],n=this.extract[r.toLowerCase()].apply(this,[e]);t="Collection"==r?{type:"GeometryCollection",geometries:n}:{type:r,coordinates:n};return t},point:function(e){return[e.x,e.y]},multipoint:function(e){for(var t=[],r=0,n=e.components.length;n>r;++r)t.push(this.extract.point.apply(this,[e.components[r]]));return t},linestring:function(e){for(var t=[],r=0,n=e.components.length;n>r;++r)t.push(this.extract.point.apply(this,[e.components[r]]));return t},multilinestring:function(e){for(var t=[],r=0,n=e.components.length;n>r;++r)t.push(this.extract.linestring.apply(this,[e.components[r]]));return t},polygon:function(e){for(var t=[],r=0,n=e.components.length;n>r;++r)t.push(this.extract.linestring.apply(this,[e.components[r]]));return t},multipolygon:function(e){for(var t=[],r=0,n=e.components.length;n>r;++r)t.push(this.extract.polygon.apply(this,[e.components[r]]));return t},collection:function(e){for(var t=e.components.length,r=new Array(t),n=0;t>n;++n)r[n]=this.extract.geometry.apply(this,[e.components[n]]);return r}},CLASS_NAME:"OpenLayers.Format.GeoJSON"});OpenLayers.Popup=OpenLayers.Class({events:null,id:"",lonlat:null,div:null,contentSize:null,size:null,contentHTML:null,backgroundColor:"",opacity:"",border:"",contentDiv:null,groupDiv:null,closeDiv:null,autoSize:!1,minSize:null,maxSize:null,displayClass:"olPopup",contentDisplayClass:"olPopupContent",padding:0,disableFirefoxOverflowHack:!1,fixPadding:function(){"number"==typeof this.padding&&(this.padding=new OpenLayers.Bounds(this.padding,this.padding,this.padding,this.padding))},panMapIfOutOfView:!1,keepInMap:!1,closeOnMove:!1,map:null,initialize:function(e,t,r,n,i,a){null==e&&(e=OpenLayers.Util.createUniqueID(this.CLASS_NAME+"_"));this.id=e;this.lonlat=t;this.contentSize=null!=r?r:new OpenLayers.Size(OpenLayers.Popup.WIDTH,OpenLayers.Popup.HEIGHT);null!=n&&(this.contentHTML=n);this.backgroundColor=OpenLayers.Popup.COLOR;this.opacity=OpenLayers.Popup.OPACITY;this.border=OpenLayers.Popup.BORDER;this.div=OpenLayers.Util.createDiv(this.id,null,null,null,null,null,"hidden");this.div.className=this.displayClass;var s=this.id+"_GroupDiv";this.groupDiv=OpenLayers.Util.createDiv(s,null,null,null,"relative",null,"hidden");var e=this.div.id+"_contentDiv";this.contentDiv=OpenLayers.Util.createDiv(e,null,this.contentSize.clone(),null,"relative");

this.contentDiv.className=this.contentDisplayClass;this.groupDiv.appendChild(this.contentDiv);this.div.appendChild(this.groupDiv);i&&this.addCloseBox(a);this.registerEvents()},destroy:function(){this.id=null;this.lonlat=null;this.size=null;this.contentHTML=null;this.backgroundColor=null;this.opacity=null;this.border=null;this.closeOnMove&&this.map&&this.map.events.unregister("movestart",this,this.hide);this.events.destroy();this.events=null;if(this.closeDiv){OpenLayers.Event.stopObservingElement(this.closeDiv);this.groupDiv.removeChild(this.closeDiv)}this.closeDiv=null;this.div.removeChild(this.groupDiv);this.groupDiv=null;null!=this.map&&this.map.removePopup(this);this.map=null;this.div=null;this.autoSize=null;this.minSize=null;this.maxSize=null;this.padding=null;this.panMapIfOutOfView=null},draw:function(e){null==e&&null!=this.lonlat&&null!=this.map&&(e=this.map.getLayerPxFromLonLat(this.lonlat));this.closeOnMove&&this.map.events.register("movestart",this,this.hide);if(!this.disableFirefoxOverflowHack&&"firefox"==OpenLayers.BROWSER_NAME){this.map.events.register("movestart",this,function(){var e=document.defaultView.getComputedStyle(this.contentDiv,null),t=e.getPropertyValue("overflow");if("hidden"!=t){this.contentDiv._oldOverflow=t;this.contentDiv.style.overflow="hidden"}});this.map.events.register("moveend",this,function(){var e=this.contentDiv._oldOverflow;if(e){this.contentDiv.style.overflow=e;this.contentDiv._oldOverflow=null}})}this.moveTo(e);this.autoSize||this.size||this.setSize(this.contentSize);this.setBackgroundColor();this.setOpacity();this.setBorder();this.setContentHTML();this.panMapIfOutOfView&&this.panIntoView();return this.div},updatePosition:function(){if(this.lonlat&&this.map){var e=this.map.getLayerPxFromLonLat(this.lonlat);e&&this.moveTo(e)}},moveTo:function(e){if(null!=e&&null!=this.div){this.div.style.left=e.x+"px";this.div.style.top=e.y+"px"}},visible:function(){return OpenLayers.Element.visible(this.div)},toggle:function(){this.visible()?this.hide():this.show()},show:function(){this.div.style.display="";this.panMapIfOutOfView&&this.panIntoView()},hide:function(){this.div.style.display="none"},setSize:function(e){this.size=e.clone();var t=this.getContentDivPadding(),r=t.left+t.right,n=t.top+t.bottom;this.fixPadding();r+=this.padding.left+this.padding.right;n+=this.padding.top+this.padding.bottom;if(this.closeDiv){var i=parseInt(this.closeDiv.style.width);r+=i+t.right}this.size.w+=r;this.size.h+=n;if("msie"==OpenLayers.BROWSER_NAME){this.contentSize.w+=t.left+t.right;this.contentSize.h+=t.bottom+t.top}if(null!=this.div){this.div.style.width=this.size.w+"px";this.div.style.height=this.size.h+"px"}if(null!=this.contentDiv){this.contentDiv.style.width=e.w+"px";this.contentDiv.style.height=e.h+"px"}},updateSize:function(){var e="<div class='"+this.contentDisplayClass+"'>"+this.contentDiv.innerHTML+"</div>",t=this.map?this.map.div:document.body,r=OpenLayers.Util.getRenderedDimensions(e,null,{displayClass:this.displayClass,containerElement:t}),n=this.getSafeContentSize(r),i=null;if(n.equals(r))i=r;else{var a={w:n.w<r.w?n.w:null,h:n.h<r.h?n.h:null};if(a.w&&a.h)i=n;else{var s=OpenLayers.Util.getRenderedDimensions(e,a,{displayClass:this.contentDisplayClass,containerElement:t}),o=OpenLayers.Element.getStyle(this.contentDiv,"overflow");if("hidden"!=o&&s.equals(n)){var l=OpenLayers.Util.getScrollbarWidth();a.w?s.h+=l:s.w+=l}i=this.getSafeContentSize(s)}}this.setSize(i)},setBackgroundColor:function(e){void 0!=e&&(this.backgroundColor=e);null!=this.div&&(this.div.style.backgroundColor=this.backgroundColor)},setOpacity:function(e){void 0!=e&&(this.opacity=e);if(null!=this.div){this.div.style.opacity=this.opacity;this.div.style.filter="alpha(opacity="+100*this.opacity+")"}},setBorder:function(e){void 0!=e&&(this.border=e);null!=this.div&&(this.div.style.border=this.border)},setContentHTML:function(e){null!=e&&(this.contentHTML=e);if(null!=this.contentDiv&&null!=this.contentHTML&&this.contentHTML!=this.contentDiv.innerHTML){this.contentDiv.innerHTML=this.contentHTML;if(this.autoSize){this.registerImageListeners();this.updateSize()}}},registerImageListeners:function(){for(var e=function(){if(null!==this.popup.id){this.popup.updateSize();this.popup.visible()&&this.popup.panMapIfOutOfView&&this.popup.panIntoView();OpenLayers.Event.stopObserving(this.img,"load",this.img._onImgLoad)}},t=this.contentDiv.getElementsByTagName("img"),r=0,n=t.length;n>r;r++){var i=t[r];if(0==i.width||0==i.height){var a={popup:this,img:i};i._onImgLoad=OpenLayers.Function.bind(e,a);OpenLayers.Event.observe(i,"load",i._onImgLoad)}}},getSafeContentSize:function(e){var t=e.clone(),r=this.getContentDivPadding(),n=r.left+r.right,i=r.top+r.bottom;this.fixPadding();n+=this.padding.left+this.padding.right;i+=this.padding.top+this.padding.bottom;if(this.closeDiv){var a=parseInt(this.closeDiv.style.width);n+=a+r.right}if(this.minSize){t.w=Math.max(t.w,this.minSize.w-n);t.h=Math.max(t.h,this.minSize.h-i)}if(this.maxSize){t.w=Math.min(t.w,this.maxSize.w-n);t.h=Math.min(t.h,this.maxSize.h-i)}if(this.map&&this.map.size){var s=0,o=0;if(this.keepInMap&&!this.panMapIfOutOfView){var l=this.map.getPixelFromLonLat(this.lonlat);switch(this.relativePosition){case"tr":s=l.x;o=this.map.size.h-l.y;break;case"tl":s=this.map.size.w-l.x;o=this.map.size.h-l.y;break;case"bl":s=this.map.size.w-l.x;o=l.y;break;case"br":s=l.x;o=l.y;break;default:s=l.x;o=this.map.size.h-l.y}}var c=this.map.size.h-this.map.paddingForPopups.top-this.map.paddingForPopups.bottom-i-o,u=this.map.size.w-this.map.paddingForPopups.left-this.map.paddingForPopups.right-n-s;t.w=Math.min(t.w,u);t.h=Math.min(t.h,c)}return t},getContentDivPadding:function(){var e=this._contentDivPadding;if(!e){if(null==this.div.parentNode){this.div.style.display="none";document.body.appendChild(this.div)}e=new OpenLayers.Bounds(OpenLayers.Element.getStyle(this.contentDiv,"padding-left"),OpenLayers.Element.getStyle(this.contentDiv,"padding-bottom"),OpenLayers.Element.getStyle(this.contentDiv,"padding-right"),OpenLayers.Element.getStyle(this.contentDiv,"padding-top"));this._contentDivPadding=e;if(this.div.parentNode==document.body){document.body.removeChild(this.div);this.div.style.display=""}}return e},addCloseBox:function(e){this.closeDiv=OpenLayers.Util.createDiv(this.id+"_close",null,{w:17,h:17});this.closeDiv.className="olPopupCloseBox";var t=this.getContentDivPadding();this.closeDiv.style.right=t.right+"px";this.closeDiv.style.top=t.top+"px";this.groupDiv.appendChild(this.closeDiv);var r=e||function(e){this.hide();OpenLayers.Event.stop(e)};OpenLayers.Event.observe(this.closeDiv,"touchend",OpenLayers.Function.bindAsEventListener(r,this));OpenLayers.Event.observe(this.closeDiv,"click",OpenLayers.Function.bindAsEventListener(r,this))},panIntoView:function(){var e=this.map.getSize(),t=this.map.getViewPortPxFromLayerPx(new OpenLayers.Pixel(parseInt(this.div.style.left),parseInt(this.div.style.top))),r=t.clone();t.x<this.map.paddingForPopups.left?r.x=this.map.paddingForPopups.left:t.x+this.size.w>e.w-this.map.paddingForPopups.right&&(r.x=e.w-this.map.paddingForPopups.right-this.size.w);t.y<this.map.paddingForPopups.top?r.y=this.map.paddingForPopups.top:t.y+this.size.h>e.h-this.map.paddingForPopups.bottom&&(r.y=e.h-this.map.paddingForPopups.bottom-this.size.h);var n=t.x-r.x,i=t.y-r.y;this.map.pan(n,i)},registerEvents:function(){function e(e){OpenLayers.Event.stop(e,!0)}this.events=new OpenLayers.Events(this,this.div,null,!0);this.events.on({mousedown:this.onmousedown,mousemove:this.onmousemove,mouseup:this.onmouseup,click:this.onclick,mouseout:this.onmouseout,dblclick:this.ondblclick,touchstart:e,scope:this})},onmousedown:function(e){this.mousedown=!0;OpenLayers.Event.stop(e,!0)},onmousemove:function(e){this.mousedown&&OpenLayers.Event.stop(e,!0)},onmouseup:function(e){if(this.mousedown){this.mousedown=!1;OpenLayers.Event.stop(e,!0)}},onclick:function(e){OpenLayers.Event.stop(e,!0)},onmouseout:function(e){this.mousedown=!1},ondblclick:function(e){OpenLayers.Event.stop(e,!0)},CLASS_NAME:"OpenLayers.Popup"});OpenLayers.Popup.WIDTH=200;OpenLayers.Popup.HEIGHT=200;OpenLayers.Popup.COLOR="white";OpenLayers.Popup.OPACITY=1;OpenLayers.Popup.BORDER="0px";OpenLayers.Popup.Anchored=OpenLayers.Class(OpenLayers.Popup,{relativePosition:null,keepInMap:!0,anchor:null,initialize:function(e,t,r,n,i,a,s){var o=[e,t,r,n,a,s];OpenLayers.Popup.prototype.initialize.apply(this,o);this.anchor=null!=i?i:{size:new OpenLayers.Size(0,0),offset:new OpenLayers.Pixel(0,0)}},destroy:function(){this.anchor=null;this.relativePosition=null;OpenLayers.Popup.prototype.destroy.apply(this,arguments)},show:function(){this.updatePosition();OpenLayers.Popup.prototype.show.apply(this,arguments)},moveTo:function(e){var t=this.relativePosition;this.relativePosition=this.calculateRelativePosition(e);OpenLayers.Popup.prototype.moveTo.call(this,this.calculateNewPx(e));this.relativePosition!=t&&this.updateRelativePosition()},setSize:function(e){OpenLayers.Popup.prototype.setSize.apply(this,arguments);if(this.lonlat&&this.map){var t=this.map.getLayerPxFromLonLat(this.lonlat);this.moveTo(t)}},calculateRelativePosition:function(e){var t=this.map.getLonLatFromLayerPx(e),r=this.map.getExtent(),n=r.determineQuadrant(t);return OpenLayers.Bounds.oppositeQuadrant(n)},updateRelativePosition:function(){},calculateNewPx:function(e){var t=e.offset(this.anchor.offset),r=this.size||this.contentSize,n="t"==this.relativePosition.charAt(0);t.y+=n?-r.h:this.anchor.size.h;var i="l"==this.relativePosition.charAt(1);t.x+=i?-r.w:this.anchor.size.w;return t},CLASS_NAME:"OpenLayers.Popup.Anchored"});OpenLayers.Popup.Framed=OpenLayers.Class(OpenLayers.Popup.Anchored,{imageSrc:null,imageSize:null,isAlphaImage:!1,positionBlocks:null,blocks:null,fixedRelativePosition:!1,initialize:function(e,t,r,n,i,a,s){OpenLayers.Popup.Anchored.prototype.initialize.apply(this,arguments);if(this.fixedRelativePosition){this.updateRelativePosition();this.calculateRelativePosition=function(e){return this.relativePosition}}this.contentDiv.style.position="absolute";this.contentDiv.style.zIndex=1;a&&(this.closeDiv.style.zIndex=1);this.groupDiv.style.position="absolute";this.groupDiv.style.top="0px";this.groupDiv.style.left="0px";this.groupDiv.style.height="100%";this.groupDiv.style.width="100%"},destroy:function(){this.imageSrc=null;this.imageSize=null;this.isAlphaImage=null;this.fixedRelativePosition=!1;this.positionBlocks=null;for(var e=0;e<this.blocks.length;e++){var t=this.blocks[e];t.image&&t.div.removeChild(t.image);t.image=null;t.div&&this.groupDiv.removeChild(t.div);t.div=null}this.blocks=null;OpenLayers.Popup.Anchored.prototype.destroy.apply(this,arguments)},setBackgroundColor:function(e){},setBorder:function(){},setOpacity:function(e){},setSize:function(e){OpenLayers.Popup.Anchored.prototype.setSize.apply(this,arguments);this.updateBlocks()},updateRelativePosition:function(){this.padding=this.positionBlocks[this.relativePosition].padding;if(this.closeDiv){var e=this.getContentDivPadding();this.closeDiv.style.right=e.right+this.padding.right+"px";this.closeDiv.style.top=e.top+this.padding.top+"px"}this.updateBlocks()},calculateNewPx:function(e){var t=OpenLayers.Popup.Anchored.prototype.calculateNewPx.apply(this,arguments);t=t.offset(this.positionBlocks[this.relativePosition].offset);return t},createBlocks:function(){this.blocks=[];var e=null;for(var t in this.positionBlocks){e=t;break}for(var r=this.positionBlocks[e],n=0;n<r.blocks.length;n++){var i={};this.blocks.push(i);var a=this.id+"_FrameDecorationDiv_"+n;i.div=OpenLayers.Util.createDiv(a,null,null,null,"absolute",null,"hidden",null);var s=this.id+"_FrameDecorationImg_"+n,o=this.isAlphaImage?OpenLayers.Util.createAlphaImageDiv:OpenLayers.Util.createImage;i.image=o(s,null,this.imageSize,this.imageSrc,"absolute",null,null,null);i.div.appendChild(i.image);this.groupDiv.appendChild(i.div)}},updateBlocks:function(){this.blocks||this.createBlocks();if(this.size&&this.relativePosition){for(var e=this.positionBlocks[this.relativePosition],t=0;t<e.blocks.length;t++){var r=e.blocks[t],n=this.blocks[t],i=r.anchor.left,a=r.anchor.bottom,s=r.anchor.right,o=r.anchor.top,l=isNaN(r.size.w)?this.size.w-(s+i):r.size.w,c=isNaN(r.size.h)?this.size.h-(a+o):r.size.h;n.div.style.width=(0>l?0:l)+"px";n.div.style.height=(0>c?0:c)+"px";n.div.style.left=null!=i?i+"px":"";n.div.style.bottom=null!=a?a+"px":"";n.div.style.right=null!=s?s+"px":"";n.div.style.top=null!=o?o+"px":"";n.image.style.left=r.position.x+"px";n.image.style.top=r.position.y+"px"}this.contentDiv.style.left=this.padding.left+"px";this.contentDiv.style.top=this.padding.top+"px"}},CLASS_NAME:"OpenLayers.Popup.Framed"});OpenLayers.Format.WMTSCapabilities=OpenLayers.Class(OpenLayers.Format.XML.VersionedOGC,{defaultVersion:"1.0.0",yx:{"urn:ogc:def:crs:EPSG::4326":!0},createLayer:function(e,t){if(!("layer"in t))throw new Error("Missing property 'layer' in configuration.");for(var r,n=e.contents,i=(n.layers,0),a=n.layers.length;a>i;++i)if(n.layers[i].identifier===t.layer){r=n.layers[i];break}if(!r)throw new Error("Layer not found");var s=t.format;!s&&r.formats&&r.formats.length&&(s=r.formats[0]);var o;t.matrixSet?o=n.tileMatrixSets[t.matrixSet]:r.tileMatrixSetLinks.length>=1&&(o=n.tileMatrixSets[r.tileMatrixSetLinks[0].tileMatrixSet]);if(!o)throw new Error("matrixSet not found");for(var l,i=0,a=r.styles.length;a>i;++i){l=r.styles[i];if(l.isDefault)break}var c=t.requestEncoding;if(!c){c="KVP";if(e.operationsMetadata.GetTile.dcp.http){var u=e.operationsMetadata.GetTile.dcp.http;if(u.get[0].constraints){var p=u.get[0].constraints,h=p.GetEncoding.allowedValues;h.KVP||!h.REST&&!h.RESTful||(c="REST")}}}var d=[],f=t.params||{};delete t.params;for(var m=0,y=r.dimensions.length;y>m;m++){var g=r.dimensions[m];d.push(g.identifier);f.hasOwnProperty(g.identifier)||(f[g.identifier]=g["default"])}var v=t.projection||o.supportedCRS.replace(/urn:ogc:def:crs:(\w+):(.*:)?(\w+)$/,"$1:$3"),C=t.units||("EPSG:4326"===v?"degrees":"m"),T=[];for(var L in o.matrixIds)o.matrixIds.hasOwnProperty(L)&&T.push(28e-5*o.matrixIds[L].scaleDenominator/OpenLayers.METERS_PER_INCH/OpenLayers.INCHES_PER_UNIT[C]);var w;if("REST"===c&&r.resourceUrls){w=[];for(var b,S=(r.resourceUrls,0),E=r.resourceUrls.length;E>S;++S){b=r.resourceUrls[S];b.format===s&&"tile"===b.resourceType&&w.push(b.template)}}else{var O=e.operationsMetadata.GetTile.dcp.http.get;w=[];for(var A,i=0,a=O.length;a>i;i++){A=O[i].constraints;(!A||A&&A.GetEncoding.allowedValues[c])&&w.push(O[i].url)}}return new OpenLayers.Layer.WMTS(OpenLayers.Util.applyDefaults(t,{url:w,requestEncoding:c,name:r.title,style:l.identifier,format:s,matrixIds:o.matrixIds,matrixSet:o.identifier,projection:v,units:C,resolutions:t.isBaseLayer===!1?void 0:T,serverResolutions:T,tileFullExtent:o.bounds,dimensions:d,params:f}))},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities"});OpenLayers.Control.Button=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_BUTTON,trigger:function(){},CLASS_NAME:"OpenLayers.Control.Button"});OpenLayers.Control.Measure=OpenLayers.Class(OpenLayers.Control,{callbacks:null,displaySystem:"metric",geodesic:!1,displaySystemUnits:{geographic:["dd"],english:["mi","ft","in"],metric:["km","m"]},partialDelay:300,delayedTrigger:null,persist:!1,immediate:!1,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);var r={done:this.measureComplete,point:this.measurePartial};this.immediate&&(r.modify=this.measureImmediate);this.callbacks=OpenLayers.Util.extend(r,this.callbacks);this.handlerOptions=OpenLayers.Util.extend({persist:this.persist},this.handlerOptions);this.handler=new e(this,this.callbacks,this.handlerOptions)},deactivate:function(){this.cancelDelay();return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},cancel:function(){this.cancelDelay();this.handler.cancel()},setImmediate:function(e){this.immediate=e;this.immediate?this.callbacks.modify=this.measureImmediate:delete this.callbacks.modify},updateHandler:function(e,t){var r=this.active;r&&this.deactivate();this.handler=new e(this,this.callbacks,t);r&&this.activate()},measureComplete:function(e){this.cancelDelay();this.measure(e,"measure")},measurePartial:function(e,t){this.cancelDelay();t=t.clone();this.handler.freehandMode(this.handler.evt)?this.measure(t,"measurepartial"):this.delayedTrigger=window.setTimeout(OpenLayers.Function.bind(function(){this.delayedTrigger=null;this.measure(t,"measurepartial")},this),this.partialDelay)},measureImmediate:function(e,t,r){if(r&&!this.handler.freehandMode(this.handler.evt)){this.cancelDelay();this.measure(t.geometry,"measurepartial")}},cancelDelay:function(){if(null!==this.delayedTrigger){window.clearTimeout(this.delayedTrigger);this.delayedTrigger=null}},measure:function(e,t){var r,n;if(e.CLASS_NAME.indexOf("LineString")>-1){r=this.getBestLength(e);n=1}else{r=this.getBestArea(e);n=2}this.events.triggerEvent(t,{measure:r[0],units:r[1],order:n,geometry:e})},getBestArea:function(e){for(var t,r,n=this.displaySystemUnits[this.displaySystem],i=0,a=n.length;a>i;++i){t=n[i];r=this.getArea(e,t);if(r>1)break}return[r,t]},getArea:function(e,t){var r,n;if(this.geodesic){r=e.getGeodesicArea(this.map.getProjectionObject());n="m"}else{r=e.getArea();n=this.map.getUnits()}var i=OpenLayers.INCHES_PER_UNIT[t];if(i){var a=OpenLayers.INCHES_PER_UNIT[n];r*=Math.pow(a/i,2)}return r},getBestLength:function(e){for(var t,r,n=this.displaySystemUnits[this.displaySystem],i=0,a=n.length;a>i;++i){t=n[i];r=this.getLength(e,t);if(r>1)break}return[r,t]},getLength:function(e,t){var r,n;if(this.geodesic){r=e.getGeodesicLength(this.map.getProjectionObject());n="m"}else{r=e.getLength();n=this.map.getUnits()}var i=OpenLayers.INCHES_PER_UNIT[t];if(i){var a=OpenLayers.INCHES_PER_UNIT[n];r*=a/i}return r},CLASS_NAME:"OpenLayers.Control.Measure"});OpenLayers.Format.WMTSCapabilities.v1_0_0=OpenLayers.Class(OpenLayers.Format.OWSCommon.v1_1_0,{version:"1.0.0",namespaces:{ows:"http://www.opengis.net/ows/1.1",wmts:"http://www.opengis.net/wmts/1.0",xlink:"http://www.w3.org/1999/xlink"},yx:null,defaultPrefix:"wmts",initialize:function(e){OpenLayers.Format.XML.prototype.initialize.apply(this,[e]);this.options=e;var t=OpenLayers.Util.extend({},OpenLayers.Format.WMTSCapabilities.prototype.yx);this.yx=OpenLayers.Util.extend(t,this.yx)},read:function(e){"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));e&&9==e.nodeType&&(e=e.documentElement);var t={};this.readNode(e,t);t.version=this.version;return t},readers:{wmts:{Capabilities:function(e,t){this.readChildNodes(e,t)},Contents:function(e,t){t.contents={};t.contents.layers=[];t.contents.tileMatrixSets={};this.readChildNodes(e,t.contents)},Layer:function(e,t){var r={styles:[],formats:[],dimensions:[],tileMatrixSetLinks:[]};r.layers=[];this.readChildNodes(e,r);t.layers.push(r)},Style:function(e,t){var r={};r.isDefault="true"===e.getAttribute("isDefault");this.readChildNodes(e,r);t.styles.push(r)},Format:function(e,t){t.formats.push(this.getChildValue(e))},TileMatrixSetLink:function(e,t){var r={};this.readChildNodes(e,r);t.tileMatrixSetLinks.push(r)},TileMatrixSet:function(e,t){if(t.layers){var r={matrixIds:[]};this.readChildNodes(e,r);t.tileMatrixSets[r.identifier]=r}else t.tileMatrixSet=this.getChildValue(e)},TileMatrix:function(e,t){var r={supportedCRS:t.supportedCRS};this.readChildNodes(e,r);t.matrixIds.push(r)},ScaleDenominator:function(e,t){t.scaleDenominator=parseFloat(this.getChildValue(e))},TopLeftCorner:function(e,t){var r,n=this.getChildValue(e),i=n.split(" ");if(t.supportedCRS){var a=t.supportedCRS.replace(/urn:ogc:def:crs:(\w+):.+:(\w+)$/,"urn:ogc:def:crs:$1::$2");r=!!this.yx[a]}t.topLeftCorner=r?new OpenLayers.LonLat(i[1],i[0]):new OpenLayers.LonLat(i[0],i[1])},TileWidth:function(e,t){t.tileWidth=parseInt(this.getChildValue(e))},TileHeight:function(e,t){t.tileHeight=parseInt(this.getChildValue(e))},MatrixWidth:function(e,t){t.matrixWidth=parseInt(this.getChildValue(e))},MatrixHeight:function(e,t){t.matrixHeight=parseInt(this.getChildValue(e))},ResourceURL:function(e,t){t.resourceUrl=t.resourceUrl||{};var r=e.getAttribute("resourceType");t.resourceUrls||(t.resourceUrls=[]);var n=t.resourceUrl[r]={format:e.getAttribute("format"),template:e.getAttribute("template"),resourceType:r};t.resourceUrls.push(n)},WSDL:function(e,t){t.wsdl={};t.wsdl.href=e.getAttribute("xlink:href")},ServiceMetadataURL:function(e,t){t.serviceMetadataUrl={};t.serviceMetadataUrl.href=e.getAttribute("xlink:href")},LegendURL:function(e,t){t.legend={};t.legend.href=e.getAttribute("xlink:href");t.legend.format=e.getAttribute("format")},Dimension:function(e,t){var r={values:[]};this.readChildNodes(e,r);t.dimensions.push(r)},Default:function(e,t){t["default"]=this.getChildValue(e)},Value:function(e,t){t.values.push(this.getChildValue(e))}},ows:OpenLayers.Format.OWSCommon.v1_1_0.prototype.readers.ows},CLASS_NAME:"OpenLayers.Format.WMTSCapabilities.v1_0_0"});OpenLayers.Popup.FramedCloud=OpenLayers.Class(OpenLayers.Popup.Framed,{contentDisplayClass:"olFramedCloudPopupContent",autoSize:!0,panMapIfOutOfView:!0,imageSize:new OpenLayers.Size(1276,736),isAlphaImage:!1,fixedRelativePosition:!1,positionBlocks:{tl:{offset:new OpenLayers.Pixel(44,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,18),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-632)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(0,-688)}]},tr:{offset:new OpenLayers.Pixel(-45,0),padding:new OpenLayers.Bounds(8,40,8,9),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,51,22,0),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,50,0,0),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",19),anchor:new OpenLayers.Bounds(0,32,22,null),position:new OpenLayers.Pixel(0,-631)},{size:new OpenLayers.Size(22,19),anchor:new OpenLayers.Bounds(null,32,0,null),position:new OpenLayers.Pixel(-1238,-631)},{size:new OpenLayers.Size(81,35),anchor:new OpenLayers.Bounds(0,0,null,null),position:new OpenLayers.Pixel(-215,-687)}]},bl:{offset:new OpenLayers.Pixel(45,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(null,null,0,0),position:new OpenLayers.Pixel(-101,-674)}]},br:{offset:new OpenLayers.Pixel(-44,0),padding:new OpenLayers.Bounds(8,9,8,40),blocks:[{size:new OpenLayers.Size("auto","auto"),anchor:new OpenLayers.Bounds(0,21,22,32),position:new OpenLayers.Pixel(0,0)},{size:new OpenLayers.Size(22,"auto"),anchor:new OpenLayers.Bounds(null,21,0,32),position:new OpenLayers.Pixel(-1238,0)},{size:new OpenLayers.Size("auto",21),anchor:new OpenLayers.Bounds(0,0,22,null),position:new OpenLayers.Pixel(0,-629)},{size:new OpenLayers.Size(22,21),anchor:new OpenLayers.Bounds(null,0,0,null),position:new OpenLayers.Pixel(-1238,-629)},{size:new OpenLayers.Size(81,33),anchor:new OpenLayers.Bounds(0,null,null,0),position:new OpenLayers.Pixel(-311,-674)}]}},minSize:new OpenLayers.Size(105,10),maxSize:new OpenLayers.Size(1200,660),initialize:function(e,t,r,n,i,a,s){this.imageSrc=OpenLayers.Util.getImageLocation("cloud-popup-relative.png");OpenLayers.Popup.Framed.prototype.initialize.apply(this,arguments);this.contentDiv.className=this.contentDisplayClass},CLASS_NAME:"OpenLayers.Popup.FramedCloud"});OpenLayers.Handler.Pinch=OpenLayers.Class(OpenLayers.Handler,{started:!1,stopDown:!1,pinching:!1,last:null,start:null,touchstart:function(e){var t=!0;this.pinching=!1;if(OpenLayers.Event.isMultiTouch(e)){this.started=!0;this.last=this.start={distance:this.getDistance(e.touches),delta:0,scale:1};this.callback("start",[e,this.start]);t=!this.stopDown}else{if(this.started)return!1;this.started=!1;this.start=null;this.last=null}OpenLayers.Event.preventDefault(e);return t},touchmove:function(e){if(this.started&&OpenLayers.Event.isMultiTouch(e)){this.pinching=!0;var t=this.getPinchData(e);this.callback("move",[e,t]);this.last=t;OpenLayers.Event.stop(e)}else if(this.started)return!1;return!0},touchend:function(e){if(this.started&&!OpenLayers.Event.isMultiTouch(e)){this.started=!1;this.pinching=!1;this.callback("done",[e,this.start,this.last]);this.start=null;this.last=null;return!1}return!0},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.pinching=!1;e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.started=!1;this.pinching=!1;this.start=null;this.last=null;e=!0}return e},getDistance:function(e){var t=e[0],r=e[1];return Math.sqrt(Math.pow(t.olClientX-r.olClientX,2)+Math.pow(t.olClientY-r.olClientY,2))},getPinchData:function(e){var t=this.getDistance(e.touches),r=t/this.start.distance;return{distance:t,delta:this.last.distance-t,scale:r}},CLASS_NAME:"OpenLayers.Handler.Pinch"});OpenLayers.Handler.Hover=OpenLayers.Class(OpenLayers.Handler,{delay:500,pixelTolerance:null,stopMove:!1,px:null,timerId:null,mousemove:function(e){if(this.passesTolerance(e.xy)){this.clearTimer();this.callback("move",[e]);this.px=e.xy;e=OpenLayers.Util.extend({},e);this.timerId=window.setTimeout(OpenLayers.Function.bind(this.delayedCall,this,e),this.delay)}return!this.stopMove},mouseout:function(e){if(OpenLayers.Util.mouseLeft(e,this.map.viewPortDiv)){this.clearTimer();this.callback("move",[e])}return!0},passesTolerance:function(e){var t=!0;if(this.pixelTolerance&&this.px){var r=Math.sqrt(Math.pow(this.px.x-e.x,2)+Math.pow(this.px.y-e.y,2));r<this.pixelTolerance&&(t=!1)}return t},clearTimer:function(){if(null!=this.timerId){window.clearTimeout(this.timerId);this.timerId=null}},delayedCall:function(e){this.callback("pause",[e])},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.clearTimer();e=!0}return e},CLASS_NAME:"OpenLayers.Handler.Hover"});OpenLayers.Control.NavigationHistory=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOGGLE,previous:null,previousOptions:null,next:null,nextOptions:null,limit:50,autoActivate:!0,clearOnDeactivate:!1,registry:null,nextStack:null,previousStack:null,listeners:null,restoring:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,[e]);this.registry=OpenLayers.Util.extend({moveend:this.getState},this.registry);var t={trigger:OpenLayers.Function.bind(this.previousTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Previous"};OpenLayers.Util.extend(t,this.previousOptions);this.previous=new OpenLayers.Control.Button(t);var r={trigger:OpenLayers.Function.bind(this.nextTrigger,this),displayClass:this.displayClass+" "+this.displayClass+"Next"};OpenLayers.Util.extend(r,this.nextOptions);this.next=new OpenLayers.Control.Button(r);this.clear()},onPreviousChange:function(e,t){e&&!this.previous.active?this.previous.activate():!e&&this.previous.active&&this.previous.deactivate()},onNextChange:function(e,t){e&&!this.next.active?this.next.activate():!e&&this.next.active&&this.next.deactivate()},destroy:function(){OpenLayers.Control.prototype.destroy.apply(this);this.previous.destroy();this.next.destroy();this.deactivate();for(var e in this)this[e]=null},setMap:function(e){this.map=e;this.next.setMap(e);this.previous.setMap(e)},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);this.next.draw();this.previous.draw()},previousTrigger:function(){var e=this.previousStack.shift(),t=this.previousStack.shift();if(void 0!=t){this.nextStack.unshift(e);this.previousStack.unshift(t);this.restoring=!0;this.restore(t);this.restoring=!1;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}else this.previousStack.unshift(e);return t},nextTrigger:function(){var e=this.nextStack.shift();if(void 0!=e){this.previousStack.unshift(e);this.restoring=!0;this.restore(e);this.restoring=!1;this.onNextChange(this.nextStack[0],this.nextStack.length);this.onPreviousChange(this.previousStack[1],this.previousStack.length-1)}return e},clear:function(){this.previousStack=[];this.previous.deactivate();this.nextStack=[];this.next.deactivate()},getState:function(){return{center:this.map.getCenter(),resolution:this.map.getResolution(),projection:this.map.getProjectionObject(),units:this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units}},restore:function(e){var t,r;if(this.map.getProjectionObject()==e.projection){r=this.map.getZoomForResolution(e.resolution);t=e.center}else{t=e.center.clone();t.transform(e.projection,this.map.getProjectionObject());var n=e.units,i=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,a=n&&i?OpenLayers.INCHES_PER_UNIT[n]/OpenLayers.INCHES_PER_UNIT[i]:1;r=this.map.getZoomForResolution(a*e.resolution)}this.map.setCenter(t,r)},setListeners:function(){this.listeners={};for(var e in this.registry)this.listeners[e]=OpenLayers.Function.bind(function(){if(!this.restoring){var t=this.registry[e].apply(this,arguments);this.previousStack.unshift(t);this.previousStack.length>1&&this.onPreviousChange(this.previousStack[1],this.previousStack.length-1);this.previousStack.length>this.limit+1&&this.previousStack.pop();if(this.nextStack.length>0){this.nextStack=[];this.onNextChange(null,0)}}return!0},this)},activate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.activate.apply(this)){null==this.listeners&&this.setListeners();for(var t in this.listeners)this.map.events.register(t,this,this.listeners[t]);e=!0;0==this.previousStack.length&&this.initStack()}return e},initStack:function(){this.map.getCenter()&&this.listeners.moveend()},deactivate:function(){var e=!1;if(this.map&&OpenLayers.Control.prototype.deactivate.apply(this)){for(var t in this.listeners)this.map.events.unregister(t,this,this.listeners[t]);this.clearOnDeactivate&&this.clear();e=!0}return e},CLASS_NAME:"OpenLayers.Control.NavigationHistory"});OpenLayers.Protocol.WFS.v1_0_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.0.0",CLASS_NAME:"OpenLayers.Protocol.WFS.v1_0_0"});OpenLayers.Strategy.Cluster=OpenLayers.Class(OpenLayers.Strategy,{distance:20,threshold:null,features:null,clusters:null,clustering:!1,resolution:null,activate:function(){var e=OpenLayers.Strategy.prototype.activate.call(this);e&&this.layer.events.on({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this});return e},deactivate:function(){var e=OpenLayers.Strategy.prototype.deactivate.call(this);if(e){this.clearCache();this.layer.events.un({beforefeaturesadded:this.cacheFeatures,featuresremoved:this.clearCache,moveend:this.cluster,scope:this})}return e},cacheFeatures:function(e){var t=!0;if(!this.clustering){this.clearCache();this.features=e.features;this.cluster();t=!1}return t},clearCache:function(){this.clustering||(this.features=null)},cluster:function(e){if((!e||e.zoomChanged)&&this.features){var t=this.layer.map.getResolution();if(t!=this.resolution||!this.clustersExist()){this.resolution=t;for(var r,n,i,a=[],s=0;s<this.features.length;++s){r=this.features[s];if(r.geometry){
n=!1;for(var o=a.length-1;o>=0;--o){i=a[o];if(this.shouldCluster(i,r)){this.addToCluster(i,r);n=!0;break}}n||a.push(this.createCluster(this.features[s]))}}this.clustering=!0;this.layer.removeAllFeatures();this.clustering=!1;if(a.length>0){if(this.threshold>1){var l=a.slice();a=[];for(var c,s=0,u=l.length;u>s;++s){c=l[s];c.attributes.count<this.threshold?Array.prototype.push.apply(a,c.cluster):a.push(c)}}this.clustering=!0;this.layer.addFeatures(a);this.clustering=!1}this.clusters=a}}},clustersExist:function(){var e=!1;if(this.clusters&&this.clusters.length>0&&this.clusters.length==this.layer.features.length){e=!0;for(var t=0;t<this.clusters.length;++t)if(this.clusters[t]!=this.layer.features[t]){e=!1;break}}return e},shouldCluster:function(e,t){var r=e.geometry.getBounds().getCenterLonLat(),n=t.geometry.getBounds().getCenterLonLat(),i=Math.sqrt(Math.pow(r.lon-n.lon,2)+Math.pow(r.lat-n.lat,2))/this.resolution;return i<=this.distance},addToCluster:function(e,t){e.cluster.push(t);e.attributes.count+=1},createCluster:function(e){var t=e.geometry.getBounds().getCenterLonLat(),r=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(t.lon,t.lat),{count:1});r.cluster=[e];return r},CLASS_NAME:"OpenLayers.Strategy.Cluster"});OpenLayers.Control.OverviewMap=OpenLayers.Class(OpenLayers.Control,{element:null,ovmap:null,size:{w:180,h:90},layers:null,minRectSize:15,minRectDisplayClass:"RectReplacement",minRatio:8,maxRatio:32,mapOptions:null,autoPan:!1,handlers:null,resolutionFactor:1,maximized:!1,maximizeTitle:"",minimizeTitle:"",initialize:function(e){this.layers=[];this.handlers={};OpenLayers.Control.prototype.initialize.apply(this,[e])},destroy:function(){if(this.mapDiv){this.handlers.click&&this.handlers.click.destroy();this.handlers.drag&&this.handlers.drag.destroy();this.ovmap&&this.ovmap.viewPortDiv.removeChild(this.extentRectangle);this.extentRectangle=null;if(this.rectEvents){this.rectEvents.destroy();this.rectEvents=null}if(this.ovmap){this.ovmap.destroy();this.ovmap=null}this.element.removeChild(this.mapDiv);this.mapDiv=null;this.div.removeChild(this.element);this.element=null;if(this.maximizeDiv){this.div.removeChild(this.maximizeDiv);this.maximizeDiv=null}if(this.minimizeDiv){this.div.removeChild(this.minimizeDiv);this.minimizeDiv=null}this.map.events.un({buttonclick:this.onButtonClick,moveend:this.update,changebaselayer:this.baseLayerDraw,scope:this});OpenLayers.Control.prototype.destroy.apply(this,arguments)}},draw:function(){OpenLayers.Control.prototype.draw.apply(this,arguments);if(0===this.layers.length){if(!this.map.baseLayer){this.map.events.register("changebaselayer",this,this.baseLayerDraw);return this.div}var e=this.map.baseLayer.clone();this.layers=[e]}this.element=document.createElement("div");this.element.className=this.displayClass+"Element";this.element.style.display="none";this.mapDiv=document.createElement("div");this.mapDiv.style.width=this.size.w+"px";this.mapDiv.style.height=this.size.h+"px";this.mapDiv.style.position="relative";this.mapDiv.style.overflow="hidden";this.mapDiv.id=OpenLayers.Util.createUniqueID("overviewMap");this.extentRectangle=document.createElement("div");this.extentRectangle.style.position="absolute";this.extentRectangle.style.zIndex=1e3;this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.element.appendChild(this.mapDiv);this.div.appendChild(this.element);if(this.outsideViewport)this.element.style.display="";else{this.div.className+=" "+this.displayClass+"Container";var t=OpenLayers.Util.getImageLocation("layer-switcher-maximize.png");this.maximizeDiv=OpenLayers.Util.createAlphaImageDiv(this.displayClass+"MaximizeButton",null,null,t,"absolute");this.maximizeDiv.style.display="none";this.maximizeDiv.className=this.displayClass+"MaximizeButton olButton";this.maximizeTitle&&(this.maximizeDiv.title=this.maximizeTitle);this.div.appendChild(this.maximizeDiv);var t=OpenLayers.Util.getImageLocation("layer-switcher-minimize.png");this.minimizeDiv=OpenLayers.Util.createAlphaImageDiv("OpenLayers_Control_minimizeDiv",null,null,t,"absolute");this.minimizeDiv.style.display="none";this.minimizeDiv.className=this.displayClass+"MinimizeButton olButton";this.minimizeTitle&&(this.minimizeDiv.title=this.minimizeTitle);this.div.appendChild(this.minimizeDiv);this.minimizeControl()}this.map.getExtent()&&this.update();this.map.events.on({buttonclick:this.onButtonClick,moveend:this.update,scope:this});this.maximized&&this.maximizeControl();return this.div},baseLayerDraw:function(){this.draw();this.map.events.unregister("changebaselayer",this,this.baseLayerDraw)},rectDrag:function(e){var t=this.handlers.drag.last.x-e.x,r=this.handlers.drag.last.y-e.y;if(0!=t||0!=r){var n=this.rectPxBounds.top,i=this.rectPxBounds.left,a=Math.abs(this.rectPxBounds.getHeight()),s=this.rectPxBounds.getWidth(),o=Math.max(0,n-r);o=Math.min(o,this.ovmap.size.h-this.hComp-a);var l=Math.max(0,i-t);l=Math.min(l,this.ovmap.size.w-this.wComp-s);this.setRectPxBounds(new OpenLayers.Bounds(l,o+a,l+s,o))}},mapDivClick:function(e){var t=this.rectPxBounds.getCenterPixel(),r=e.xy.x-t.x,n=e.xy.y-t.y,i=this.rectPxBounds.top,a=this.rectPxBounds.left,s=Math.abs(this.rectPxBounds.getHeight()),o=this.rectPxBounds.getWidth(),l=Math.max(0,i+n);l=Math.min(l,this.ovmap.size.h-s);var c=Math.max(0,a+r);c=Math.min(c,this.ovmap.size.w-o);this.setRectPxBounds(new OpenLayers.Bounds(c,l+s,c+o,l));this.updateMapToRect()},onButtonClick:function(e){e.buttonElement===this.minimizeDiv?this.minimizeControl():e.buttonElement===this.maximizeDiv&&this.maximizeControl()},maximizeControl:function(e){this.element.style.display="";this.showToggle(!1);null!=e&&OpenLayers.Event.stop(e)},minimizeControl:function(e){this.element.style.display="none";this.showToggle(!0);null!=e&&OpenLayers.Event.stop(e)},showToggle:function(e){this.maximizeDiv&&(this.maximizeDiv.style.display=e?"":"none");this.minimizeDiv&&(this.minimizeDiv.style.display=e?"none":"")},update:function(){null==this.ovmap&&this.createMap();(this.autoPan||!this.isSuitableOverview())&&this.updateOverview();this.updateRectToMap()},isSuitableOverview:function(){var e=this.map.getExtent(),t=this.map.getMaxExtent(),r=new OpenLayers.Bounds(Math.max(e.left,t.left),Math.max(e.bottom,t.bottom),Math.min(e.right,t.right),Math.min(e.top,t.top));this.ovmap.getProjection()!=this.map.getProjection()&&(r=r.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()));var n=this.ovmap.getResolution()/this.map.getResolution();return n>this.minRatio&&n<=this.maxRatio&&this.ovmap.getExtent().containsBounds(r)},updateOverview:function(){var e=this.map.getResolution(),t=this.ovmap.getResolution(),r=t/e;r>this.maxRatio?t=this.minRatio*e:r<=this.minRatio&&(t=this.maxRatio*e);var n;if(this.ovmap.getProjection()!=this.map.getProjection()){n=this.map.center.clone();n.transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject())}else n=this.map.center;this.ovmap.setCenter(n,this.ovmap.getZoomForResolution(t*this.resolutionFactor));this.updateRectToMap()},createMap:function(){var e=OpenLayers.Util.extend({controls:[],maxResolution:"auto",fallThrough:!1},this.mapOptions);this.ovmap=new OpenLayers.Map(this.mapDiv,e);this.ovmap.viewPortDiv.appendChild(this.extentRectangle);OpenLayers.Event.stopObserving(window,"unload",this.ovmap.unloadDestroy);this.ovmap.addLayers(this.layers);this.ovmap.zoomToMaxExtent();this.wComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-left-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-right-width"));this.wComp=this.wComp?this.wComp:2;this.hComp=parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-top-width"))+parseInt(OpenLayers.Element.getStyle(this.extentRectangle,"border-bottom-width"));this.hComp=this.hComp?this.hComp:2;this.handlers.drag=new OpenLayers.Handler.Drag(this,{move:this.rectDrag,done:this.updateMapToRect},{map:this.ovmap});this.handlers.click=new OpenLayers.Handler.Click(this,{click:this.mapDivClick},{single:!0,"double":!1,stopSingle:!0,stopDouble:!0,pixelTolerance:1,map:this.ovmap});this.handlers.click.activate();this.rectEvents=new OpenLayers.Events(this,this.extentRectangle,null,!0);this.rectEvents.register("mouseover",this,function(e){this.handlers.drag.active||this.map.dragging||this.handlers.drag.activate()});this.rectEvents.register("mouseout",this,function(e){this.handlers.drag.dragging||this.handlers.drag.deactivate()});if(this.ovmap.getProjection()!=this.map.getProjection()){var t=this.map.getProjectionObject().getUnits()||this.map.units||this.map.baseLayer.units,r=this.ovmap.getProjectionObject().getUnits()||this.ovmap.units||this.ovmap.baseLayer.units;this.resolutionFactor=t&&r?OpenLayers.INCHES_PER_UNIT[t]/OpenLayers.INCHES_PER_UNIT[r]:1}},updateRectToMap:function(){var e;e=this.ovmap.getProjection()!=this.map.getProjection()?this.map.getExtent().transform(this.map.getProjectionObject(),this.ovmap.getProjectionObject()):this.map.getExtent();var t=this.getRectBoundsFromMapBounds(e);t&&this.setRectPxBounds(t)},updateMapToRect:function(){var e=this.getMapBoundsFromRectBounds(this.rectPxBounds);this.ovmap.getProjection()!=this.map.getProjection()&&(e=e.transform(this.ovmap.getProjectionObject(),this.map.getProjectionObject()));this.map.panTo(e.getCenterLonLat())},setRectPxBounds:function(e){var t=Math.max(e.top,0),r=Math.max(e.left,0),n=Math.min(e.top+Math.abs(e.getHeight()),this.ovmap.size.h-this.hComp),i=Math.min(e.left+e.getWidth(),this.ovmap.size.w-this.wComp),a=Math.max(i-r,0),s=Math.max(n-t,0);if(a<this.minRectSize||s<this.minRectSize){this.extentRectangle.className=this.displayClass+this.minRectDisplayClass;var o=r+a/2-this.minRectSize/2,l=t+s/2-this.minRectSize/2;this.extentRectangle.style.top=Math.round(l)+"px";this.extentRectangle.style.left=Math.round(o)+"px";this.extentRectangle.style.height=this.minRectSize+"px";this.extentRectangle.style.width=this.minRectSize+"px"}else{this.extentRectangle.className=this.displayClass+"ExtentRectangle";this.extentRectangle.style.top=Math.round(t)+"px";this.extentRectangle.style.left=Math.round(r)+"px";this.extentRectangle.style.height=Math.round(s)+"px";this.extentRectangle.style.width=Math.round(a)+"px"}this.rectPxBounds=new OpenLayers.Bounds(Math.round(r),Math.round(n),Math.round(i),Math.round(t))},getRectBoundsFromMapBounds:function(e){var t=this.getOverviewPxFromLonLat({lon:e.left,lat:e.bottom}),r=this.getOverviewPxFromLonLat({lon:e.right,lat:e.top}),n=null;t&&r&&(n=new OpenLayers.Bounds(t.x,t.y,r.x,r.y));return n},getMapBoundsFromRectBounds:function(e){var t=this.getLonLatFromOverviewPx({x:e.left,y:e.bottom}),r=this.getLonLatFromOverviewPx({x:e.right,y:e.top});return new OpenLayers.Bounds(t.lon,t.lat,r.lon,r.lat)},getLonLatFromOverviewPx:function(e){var t=this.ovmap.size,r=this.ovmap.getResolution(),n=this.ovmap.getExtent().getCenterLonLat(),i=e.x-t.w/2,a=e.y-t.h/2;return{lon:n.lon+i*r,lat:n.lat-a*r}},getOverviewPxFromLonLat:function(e){var t=this.ovmap.getResolution(),r=this.ovmap.getExtent();return r?{x:Math.round(1/t*(e.lon-r.left)),y:Math.round(1/t*(r.top-e.lat))}:void 0},CLASS_NAME:"OpenLayers.Control.OverviewMap"});OpenLayers.Renderer.VML=OpenLayers.Class(OpenLayers.Renderer.Elements,{xmlns:"urn:schemas-microsoft-com:vml",symbolCache:{},offset:null,initialize:function(e){if(this.supported()){if(!document.namespaces.olv){document.namespaces.add("olv",this.xmlns);for(var t=document.createStyleSheet(),r=["shape","rect","oval","fill","stroke","imagedata","group","textbox"],n=0,i=r.length;i>n;n++)t.addRule("olv\\:"+r[n],"behavior: url(#default#VML); position: absolute; display: inline-block;")}OpenLayers.Renderer.Elements.prototype.initialize.apply(this,arguments)}},supported:function(){return!!document.namespaces},setExtent:function(e,t){var r=OpenLayers.Renderer.Elements.prototype.setExtent.apply(this,arguments),n=this.getResolution(),i=e.left/n|0,a=e.top/n-this.size.h|0;if(t||!this.offset){this.offset={x:i,y:a};i=0;a=0}else{i-=this.offset.x;a-=this.offset.y}var s=i-this.xOffset+" "+a;this.root.coordorigin=s;for(var o,l=[this.root,this.vectorRoot,this.textRoot],c=0,u=l.length;u>c;++c){o=l[c];var p=this.size.w+" "+this.size.h;o.coordsize=p}this.root.style.flip="y";return r},setSize:function(e){OpenLayers.Renderer.prototype.setSize.apply(this,arguments);for(var t,r=[this.rendererRoot,this.root,this.vectorRoot,this.textRoot],n=this.size.w+"px",i=this.size.h+"px",a=0,s=r.length;s>a;++a){t=r[a];t.style.width=n;t.style.height=i}},getNodeType:function(e,t){var r=null;switch(e.CLASS_NAME){case"OpenLayers.Geometry.Point":r=t.externalGraphic?"olv:rect":this.isComplexSymbol(t.graphicName)?"olv:shape":"olv:oval";break;case"OpenLayers.Geometry.Rectangle":r="olv:rect";break;case"OpenLayers.Geometry.LineString":case"OpenLayers.Geometry.LinearRing":case"OpenLayers.Geometry.Polygon":case"OpenLayers.Geometry.Curve":r="olv:shape"}return r},setStyle:function(e,t,r,n){t=t||e._style;r=r||e._options;var i=t.fillColor,a=t.title||t.graphicTitle;a&&(e.title=a);if("OpenLayers.Geometry.Point"===e._geometryClass)if(t.externalGraphic){r.isFilled=!0;var s=t.graphicWidth||t.graphicHeight,o=t.graphicHeight||t.graphicWidth;s=s?s:2*t.pointRadius;o=o?o:2*t.pointRadius;var l=this.getResolution(),c=void 0!=t.graphicXOffset?t.graphicXOffset:-(.5*s),u=void 0!=t.graphicYOffset?t.graphicYOffset:-(.5*o);e.style.left=((n.x-this.featureDx)/l-this.offset.x+c|0)+"px";e.style.top=(n.y/l-this.offset.y-(u+o)|0)+"px";e.style.width=s+"px";e.style.height=o+"px";e.style.flip="y";i="none";r.isStroked=!1}else if(this.isComplexSymbol(t.graphicName)){var p=this.importSymbol(t.graphicName);e.path=p.path;e.coordorigin=p.left+","+p.bottom;var h=p.size;e.coordsize=h+","+h;this.drawCircle(e,n,t.pointRadius);e.style.flip="y"}else this.drawCircle(e,n,t.pointRadius);r.isFilled?e.fillcolor=i:e.filled="false";var d=e.getElementsByTagName("fill"),f=0==d.length?null:d[0];if(r.isFilled){f||(f=this.createNode("olv:fill",e.id+"_fill"));f.opacity=t.fillOpacity;if("OpenLayers.Geometry.Point"===e._geometryClass&&t.externalGraphic){t.graphicOpacity&&(f.opacity=t.graphicOpacity);f.src=t.externalGraphic;f.type="frame";t.graphicWidth&&t.graphicHeight||(f.aspect="atmost")}f.parentNode!=e&&e.appendChild(f)}else f&&e.removeChild(f);var m=t.rotation;if(void 0!==m||void 0!==e._rotation){e._rotation=m;if(t.externalGraphic){this.graphicRotate(e,c,u,t);f.opacity=0}else"OpenLayers.Geometry.Point"===e._geometryClass&&(e.style.rotation=m||0)}var y=e.getElementsByTagName("stroke"),g=0==y.length?null:y[0];if(r.isStroked){if(!g){g=this.createNode("olv:stroke",e.id+"_stroke");e.appendChild(g)}g.on=!0;g.color=t.strokeColor;g.weight=t.strokeWidth+"px";g.opacity=t.strokeOpacity;g.endcap="butt"==t.strokeLinecap?"flat":t.strokeLinecap||"round";t.strokeDashstyle&&(g.dashstyle=this.dashStyle(t))}else{e.stroked=!1;g&&(g.on=!1)}"inherit"!=t.cursor&&null!=t.cursor&&(e.style.cursor=t.cursor);return e},graphicRotate:function(e,t,r,n){var i,a,n=n||e._style,s=n.rotation||0;if(n.graphicWidth&&n.graphicHeight){a=Math.max(n.graphicWidth,n.graphicHeight);i=n.graphicWidth/n.graphicHeight;var o=Math.round(n.graphicWidth||a*i),l=Math.round(n.graphicHeight||a);e.style.width=o+"px";e.style.height=l+"px";var c=document.getElementById(e.id+"_image");if(!c){c=this.createNode("olv:imagedata",e.id+"_image");e.appendChild(c)}c.style.width=o+"px";c.style.height=l+"px";c.src=n.externalGraphic;c.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='', sizingMethod='scale')";var u=s*Math.PI/180,p=Math.sin(u),h=Math.cos(u),d="progid:DXImageTransform.Microsoft.Matrix(M11="+h+",M12="+-p+",M21="+p+",M22="+h+",SizingMethod='auto expand')\n",f=n.graphicOpacity||n.fillOpacity;f&&1!=f&&(d+="progid:DXImageTransform.Microsoft.BasicImage(opacity="+f+")\n");e.style.filter=d;var m=new OpenLayers.Geometry.Point(-t,-r),y=new OpenLayers.Bounds(0,0,o,l).toGeometry();y.rotate(n.rotation,m);var g=y.getBounds();e.style.left=Math.round(parseInt(e.style.left)+g.left)+"px";e.style.top=Math.round(parseInt(e.style.top)-g.bottom)+"px"}else{var v=new Image;v.onreadystatechange=OpenLayers.Function.bind(function(){if("complete"==v.readyState||"interactive"==v.readyState){i=v.width/v.height;a=Math.max(2*n.pointRadius,n.graphicWidth||0,n.graphicHeight||0);t*=i;n.graphicWidth=a*i;n.graphicHeight=a;this.graphicRotate(e,t,r,n)}},this);v.src=n.externalGraphic}},postDraw:function(e){e.style.visibility="visible";var t=e._style.fillColor,r=e._style.strokeColor;"none"==t&&e.fillcolor!=t&&(e.fillcolor=t);"none"==r&&e.strokecolor!=r&&(e.strokecolor=r)},setNodeDimension:function(e,t){var r=t.getBounds();if(r){var n=this.getResolution(),i=new OpenLayers.Bounds((r.left-this.featureDx)/n-this.offset.x|0,r.bottom/n-this.offset.y|0,(r.right-this.featureDx)/n-this.offset.x|0,r.top/n-this.offset.y|0);e.style.left=i.left+"px";e.style.top=i.top+"px";e.style.width=i.getWidth()+"px";e.style.height=i.getHeight()+"px";e.coordorigin=i.left+" "+i.top;e.coordsize=i.getWidth()+" "+i.getHeight()}},dashStyle:function(e){var t=e.strokeDashstyle;switch(t){case"solid":case"dot":case"dash":case"dashdot":case"longdash":case"longdashdot":return t;default:var r=t.split(/[ ,]/);return 2==r.length?1*r[0]>=2*r[1]?"longdash":1==r[0]||1==r[1]?"dot":"dash":4==r.length?1*r[0]>=2*r[1]?"longdashdot":"dashdot":"solid"}},createNode:function(e,t){var r=document.createElement(e);t&&(r.id=t);r.unselectable="on";r.onselectstart=OpenLayers.Function.False;return r},nodeTypeCompare:function(e,t){var r=t,n=r.indexOf(":");-1!=n&&(r=r.substr(n+1));var i=e.nodeName;n=i.indexOf(":");-1!=n&&(i=i.substr(n+1));return r==i},createRenderRoot:function(){return this.nodeFactory(this.container.id+"_vmlRoot","div")},createRoot:function(e){return this.nodeFactory(this.container.id+e,"olv:group")},drawPoint:function(e,t){return this.drawCircle(e,t,1)},drawCircle:function(e,t,r){if(!isNaN(t.x)&&!isNaN(t.y)){var n=this.getResolution();e.style.left=((t.x-this.featureDx)/n-this.offset.x|0)-r+"px";e.style.top=(t.y/n-this.offset.y|0)-r+"px";var i=2*r;e.style.width=i+"px";e.style.height=i+"px";return e}return!1},drawLineString:function(e,t){return this.drawLine(e,t,!1)},drawLinearRing:function(e,t){return this.drawLine(e,t,!0)},drawLine:function(e,t,r){this.setNodeDimension(e,t);for(var n,i,a,s=this.getResolution(),o=t.components.length,l=new Array(o),c=0;o>c;c++){n=t.components[c];i=(n.x-this.featureDx)/s-this.offset.x|0;a=n.y/s-this.offset.y|0;l[c]=" "+i+","+a+" l "}var u=r?" x e":" e";e.path="m"+l.join("")+u;return e},drawPolygon:function(e,t){this.setNodeDimension(e,t);var r,n,i,a,s,o,l,c,u,p,h,d,f=this.getResolution(),m=[];for(r=0,n=t.components.length;n>r;r++){m.push("m");i=t.components[r].components;a=0===r;s=null;o=null;for(l=0,c=i.length;c>l;l++){u=i[l];h=(u.x-this.featureDx)/f-this.offset.x|0;d=u.y/f-this.offset.y|0;p=" "+h+","+d;m.push(p);0==l&&m.push(" l");a||(s?s!=p&&(o?o!=p&&(a=!0):o=p):s=p)}m.push(a?" x ":" ")}m.push("e");e.path=m.join("");return e},drawRectangle:function(e,t){var r=this.getResolution();e.style.left=((t.x-this.featureDx)/r-this.offset.x|0)+"px";e.style.top=(t.y/r-this.offset.y|0)+"px";e.style.width=(t.width/r|0)+"px";e.style.height=(t.height/r|0)+"px";return e},drawText:function(e,t,r){var n=this.nodeFactory(e+this.LABEL_ID_SUFFIX,"olv:rect"),i=this.nodeFactory(e+this.LABEL_ID_SUFFIX+"_textbox","olv:textbox"),a=this.getResolution();n.style.left=((r.x-this.featureDx)/a-this.offset.x|0)+"px";n.style.top=(r.y/a-this.offset.y|0)+"px";n.style.flip="y";i.innerText=t.label;"inherit"!=t.cursor&&null!=t.cursor&&(i.style.cursor=t.cursor);t.fontColor&&(i.style.color=t.fontColor);t.fontOpacity&&(i.style.filter="alpha(opacity="+100*t.fontOpacity+")");t.fontFamily&&(i.style.fontFamily=t.fontFamily);t.fontSize&&(i.style.fontSize=t.fontSize);t.fontWeight&&(i.style.fontWeight=t.fontWeight);t.fontStyle&&(i.style.fontStyle=t.fontStyle);if(t.labelSelect===!0){n._featureId=e;i._featureId=e;i._geometry=r;i._geometryClass=r.CLASS_NAME}i.style.whiteSpace="nowrap";i.inset="1px,0px,0px,0px";if(!n.parentNode){n.appendChild(i);this.textRoot.appendChild(n)}var s=t.labelAlign||"cm";1==s.length&&(s+="m");var o=i.clientWidth*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(0,1)],l=i.clientHeight*OpenLayers.Renderer.VML.LABEL_SHIFT[s.substr(1,1)];n.style.left=parseInt(n.style.left)-o-1+"px";n.style.top=parseInt(n.style.top)+l+"px"},moveRoot:function(e){var t=this.map.getLayer(e.container.id);t instanceof OpenLayers.Layer.Vector.RootContainer&&(t=this.map.getLayer(this.container.id));t&&t.renderer.clear();OpenLayers.Renderer.Elements.prototype.moveRoot.apply(this,arguments);t&&t.redraw()},importSymbol:function(e){var t=this.container.id+"-"+e,r=this.symbolCache[t];if(r)return r;var n=OpenLayers.Renderer.symbol[e];if(!n)throw new Error(e+" is not a valid symbol name");for(var i=new OpenLayers.Bounds(Number.MAX_VALUE,Number.MAX_VALUE,0,0),a=["m"],s=0;s<n.length;s+=2){var o=n[s],l=n[s+1];i.left=Math.min(i.left,o);i.bottom=Math.min(i.bottom,l);i.right=Math.max(i.right,o);i.top=Math.max(i.top,l);a.push(o);a.push(l);0==s&&a.push("l")}a.push("x e");var c=a.join(" "),u=(i.getWidth()-i.getHeight())/2;if(u>0){i.bottom=i.bottom-u;i.top=i.top+u}else{i.left=i.left+u;i.right=i.right-u}r={path:c,size:i.getWidth(),left:i.left,bottom:i.bottom};this.symbolCache[t]=r;return r},CLASS_NAME:"OpenLayers.Renderer.VML"});OpenLayers.Renderer.VML.LABEL_SHIFT={l:0,c:.5,r:1,t:0,m:.5,b:1};OpenLayers.Protocol.HTTP=OpenLayers.Class(OpenLayers.Protocol,{url:null,headers:null,params:null,callback:null,scope:null,readWithPOST:!1,updateWithPOST:!1,deleteWithPOST:!1,wildcarded:!1,srsInBBOX:!1,initialize:function(e){e=e||{};this.params={};this.headers={};OpenLayers.Protocol.prototype.initialize.apply(this,arguments);if(!this.filterToParams&&OpenLayers.Format.QueryStringFilter){var t=new OpenLayers.Format.QueryStringFilter({wildcarded:this.wildcarded,srsInBBOX:this.srsInBBOX});this.filterToParams=function(e,r){return t.write(e,r)}}},destroy:function(){this.params=null;this.headers=null;OpenLayers.Protocol.prototype.destroy.apply(this)},read:function(e){OpenLayers.Protocol.prototype.read.apply(this,arguments);e=e||{};e.params=OpenLayers.Util.applyDefaults(e.params,this.options.params);e=OpenLayers.Util.applyDefaults(e,this.options);e.filter&&this.filterToParams&&(e.params=this.filterToParams(e.filter,e.params));var t=void 0!==e.readWithPOST?e.readWithPOST:this.readWithPOST,r=new OpenLayers.Protocol.Response({requestType:"read"});if(t){var n=e.headers||{};n["Content-Type"]="application/x-www-form-urlencoded";r.priv=OpenLayers.Request.POST({url:e.url,callback:this.createCallback(this.handleRead,r,e),data:OpenLayers.Util.getParameterString(e.params),headers:n})}else r.priv=OpenLayers.Request.GET({url:e.url,callback:this.createCallback(this.handleRead,r,e),params:e.params,headers:e.headers});return r},handleRead:function(e,t){this.handleResponse(e,t)},create:function(e,t){t=OpenLayers.Util.applyDefaults(t,this.options);var r=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"create"});r.priv=OpenLayers.Request.POST({url:t.url,callback:this.createCallback(this.handleCreate,r,t),headers:t.headers,data:this.format.write(e)});return r},handleCreate:function(e,t){this.handleResponse(e,t)},update:function(e,t){t=t||{};var r=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"update"}),i=this.updateWithPOST?"POST":"PUT";n.priv=OpenLayers.Request[i]({url:r,callback:this.createCallback(this.handleUpdate,n,t),headers:t.headers,data:this.format.write(e)});return n},handleUpdate:function(e,t){this.handleResponse(e,t)},"delete":function(e,t){t=t||{};var r=t.url||e.url||this.options.url+"/"+e.fid;t=OpenLayers.Util.applyDefaults(t,this.options);var n=new OpenLayers.Protocol.Response({reqFeatures:e,requestType:"delete"}),i=this.deleteWithPOST?"POST":"DELETE",a={url:r,callback:this.createCallback(this.handleDelete,n,t),headers:t.headers};this.deleteWithPOST&&(a.data=this.format.write(e));n.priv=OpenLayers.Request[i](a);return n},handleDelete:function(e,t){this.handleResponse(e,t)},handleResponse:function(e,t){var r=e.priv;if(t.callback){if(r.status>=200&&r.status<300){"delete"!=e.requestType&&(e.features=this.parseFeatures(r));e.code=OpenLayers.Protocol.Response.SUCCESS}else e.code=OpenLayers.Protocol.Response.FAILURE;t.callback.call(t.scope,e)}},parseFeatures:function(e){var t=e.responseXML;t&&t.documentElement||(t=e.responseText);return!t||t.length<=0?null:this.format.read(t)},commit:function(e,t){function r(e){for(var t=e.features?e.features.length:0,r=new Array(t),i=0;t>i;++i)r[i]=e.features[i].fid;f.insertIds=r;n.apply(this,[e])}function n(e){this.callUserCallback(e,t);d=d&&e.success();a++;if(a>=h&&t.callback){f.code=d?OpenLayers.Protocol.Response.SUCCESS:OpenLayers.Protocol.Response.FAILURE;t.callback.apply(t.scope,[f])}}t=OpenLayers.Util.applyDefaults(t,this.options);var i=[],a=0,s={};s[OpenLayers.State.INSERT]=[];s[OpenLayers.State.UPDATE]=[];s[OpenLayers.State.DELETE]=[];for(var o,l,c=[],u=0,p=e.length;p>u;++u){o=e[u];l=s[o.state];if(l){l.push(o);c.push(o)}}var h=(s[OpenLayers.State.INSERT].length>0?1:0)+s[OpenLayers.State.UPDATE].length+s[OpenLayers.State.DELETE].length,d=!0,f=new OpenLayers.Protocol.Response({reqFeatures:c}),m=s[OpenLayers.State.INSERT];m.length>0&&i.push(this.create(m,OpenLayers.Util.applyDefaults({callback:r,scope:this},t.create)));m=s[OpenLayers.State.UPDATE];for(var u=m.length-1;u>=0;--u)i.push(this.update(m[u],OpenLayers.Util.applyDefaults({callback:n,scope:this},t.update)));m=s[OpenLayers.State.DELETE];for(var u=m.length-1;u>=0;--u)i.push(this["delete"](m[u],OpenLayers.Util.applyDefaults({callback:n,scope:this},t["delete"])));return i},abort:function(e){e&&e.priv.abort()},callUserCallback:function(e,t){var r=t[e.requestType];r&&r.callback&&r.callback.call(r.scope,e)},CLASS_NAME:"OpenLayers.Protocol.HTTP"});OpenLayers.Handler.Feature=OpenLayers.Class(OpenLayers.Handler,{EVENTMAP:{click:{"in":"click",out:"clickout"},mousemove:{"in":"over",out:"out"},dblclick:{"in":"dblclick",out:null},mousedown:{"in":null,out:null},mouseup:{"in":null,out:null},touchstart:{"in":"click",out:"clickout"}},feature:null,lastFeature:null,down:null,up:null,clickTolerance:4,geometryTypes:null,stopClick:!0,stopDown:!0,stopUp:!1,initialize:function(e,t,r,n){OpenLayers.Handler.prototype.initialize.apply(this,[e,r,n]);this.layer=t},touchstart:function(e){this.startTouch();return OpenLayers.Event.isMultiTouch(e)?!0:this.mousedown(e)},touchmove:function(e){OpenLayers.Event.preventDefault(e)},mousedown:function(e){(OpenLayers.Event.isLeftClick(e)||OpenLayers.Event.isSingleTouch(e))&&(this.down=e.xy);return this.handle(e)?!this.stopDown:!0},mouseup:function(e){this.up=e.xy;return this.handle(e)?!this.stopUp:!0},click:function(e){return this.handle(e)?!this.stopClick:!0},mousemove:function(e){if(!this.callbacks.over&&!this.callbacks.out)return!0;this.handle(e);return!0},dblclick:function(e){return!this.handle(e)},geometryTypeMatches:function(e){return null==this.geometryTypes||OpenLayers.Util.indexOf(this.geometryTypes,e.geometry.CLASS_NAME)>-1},handle:function(e){this.feature&&!this.feature.layer&&(this.feature=null);var t=e.type,r=!1,n=!!this.feature,i="click"==t||"dblclick"==t||"touchstart"==t;this.feature=this.layer.getFeatureFromEvent(e);this.feature&&!this.feature.layer&&(this.feature=null);this.lastFeature&&!this.lastFeature.layer&&(this.lastFeature=null);if(this.feature){"touchstart"===t&&OpenLayers.Event.preventDefault(e);var a=this.feature!=this.lastFeature;if(this.geometryTypeMatches(this.feature)){if(n&&a){this.lastFeature&&this.triggerCallback(t,"out",[this.lastFeature]);this.triggerCallback(t,"in",[this.feature])}else(!n||i)&&this.triggerCallback(t,"in",[this.feature]);this.lastFeature=this.feature;r=!0}else{this.lastFeature&&(n&&a||i)&&this.triggerCallback(t,"out",[this.lastFeature]);this.feature=null}}else this.lastFeature&&(n||i)&&this.triggerCallback(t,"out",[this.lastFeature]);return r},triggerCallback:function(e,t,r){var n=this.EVENTMAP[e][t];if(n)if("click"==e&&this.up&&this.down){var i=Math.sqrt(Math.pow(this.up.x-this.down.x,2)+Math.pow(this.up.y-this.down.y,2));i<=this.clickTolerance&&this.callback(n,r);this.up=this.down=null}else this.callback(n,r)},activate:function(){var e=!1;if(OpenLayers.Handler.prototype.activate.apply(this,arguments)){this.moveLayerToTop();this.map.events.on({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});e=!0}return e},deactivate:function(){var e=!1;if(OpenLayers.Handler.prototype.deactivate.apply(this,arguments)){this.moveLayerBack();this.feature=null;this.lastFeature=null;this.down=null;this.up=null;this.map.events.un({removelayer:this.handleMapEvents,changelayer:this.handleMapEvents,scope:this});e=!0}return e},handleMapEvents:function(e){("removelayer"==e.type||"order"==e.property)&&this.moveLayerToTop()},moveLayerToTop:function(){var e=Math.max(this.map.Z_INDEX_BASE.Feature-1,this.layer.getZIndex())+1;this.layer.setZIndex(e)},moveLayerBack:function(){var e=this.layer.getZIndex()-1;e>=this.map.Z_INDEX_BASE.Feature?this.layer.setZIndex(e):this.map.setLayerZIndex(this.layer,this.map.getLayerIndex(this.layer))},CLASS_NAME:"OpenLayers.Handler.Feature"});OpenLayers.Control.DragFeature=OpenLayers.Class(OpenLayers.Control,{geometryTypes:null,onStart:function(e,t){},onDrag:function(e,t){},onComplete:function(e,t){},onEnter:function(e){},onLeave:function(e){},documentDrag:!1,layer:null,feature:null,dragCallbacks:{},featureCallbacks:{},lastPixel:null,initialize:function(e,t){OpenLayers.Control.prototype.initialize.apply(this,[t]);this.layer=e;this.handlers={drag:new OpenLayers.Handler.Drag(this,OpenLayers.Util.extend({down:this.downFeature,move:this.moveFeature,up:this.upFeature,out:this.cancel,done:this.doneDragging},this.dragCallbacks),{documentDrag:this.documentDrag}),feature:new OpenLayers.Handler.Feature(this,this.layer,OpenLayers.Util.extend({click:this.clickFeature,clickout:this.clickoutFeature,over:this.overFeature,out:this.outFeature},this.featureCallbacks),{geometryTypes:this.geometryTypes})}},clickFeature:function(e){if(this.handlers.feature.touch&&!this.over&&this.overFeature(e)){this.handlers.drag.dragstart(this.handlers.feature.evt);this.handlers.drag.stopDown=!1}},clickoutFeature:function(e){if(this.handlers.feature.touch&&this.over){this.outFeature(e);this.handlers.drag.stopDown=!0}},destroy:function(){this.layer=null;OpenLayers.Control.prototype.destroy.apply(this,[])},activate:function(){return this.handlers.feature.activate()&&OpenLayers.Control.prototype.activate.apply(this,arguments)},deactivate:function(){this.handlers.drag.deactivate();this.handlers.feature.deactivate();this.feature=null;this.dragging=!1;this.lastPixel=null;OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");return OpenLayers.Control.prototype.deactivate.apply(this,arguments)},overFeature:function(e){var t=!1;if(this.handlers.drag.dragging)this.over=this.feature.id==e.id?!0:!1;else{this.feature=e;this.handlers.drag.activate();t=!0;this.over=!0;OpenLayers.Element.addClass(this.map.viewPortDiv,this.displayClass+"Over");this.onEnter(e)}return t},downFeature:function(e){this.lastPixel=e;this.onStart(this.feature,e)},moveFeature:function(e){var t=this.map.getResolution();this.feature.geometry.move(t*(e.x-this.lastPixel.x),t*(this.lastPixel.y-e.y));this.layer.drawFeature(this.feature);this.lastPixel=e;this.onDrag(this.feature,e)},upFeature:function(e){this.over||this.handlers.drag.deactivate()},doneDragging:function(e){this.onComplete(this.feature,e)},outFeature:function(e){if(this.handlers.drag.dragging)this.feature.id==e.id&&(this.over=!1);else{this.over=!1;this.handlers.drag.deactivate();OpenLayers.Element.removeClass(this.map.viewPortDiv,this.displayClass+"Over");this.onLeave(e);this.feature=null}},cancel:function(){this.handlers.drag.deactivate();this.over=!1},setMap:function(e){this.handlers.drag.setMap(e);this.handlers.feature.setMap(e);OpenLayers.Control.prototype.setMap.apply(this,arguments);

},CLASS_NAME:"OpenLayers.Control.DragFeature"});OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var r=e.documentElement;if(r){var n=this["read_"+r.nodeName];t=n?n.call(this,r):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],r=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(r)for(var n=0,i=r.length;i>n;++n){var a=r[n],s=a.nodeName;a.prefix&&(s=s.split(":")[1]);var s=s.replace(this.layerIdentifier,""),o=this.getSiblingNodesByTagCriteria(a,this.featureIdentifier);if(o)for(var l=0;l<o.length;l++){var c=o[l],u=this.parseGeometry(c),p=this.parseAttributes(c),h=new OpenLayers.Feature.Vector(u.geometry,p,null);h.bounds=u.bounds;h.type=s;t.push(h)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],r=this.getElementsByTagNameNS(e,"*","FIELDS"),n=0,i=r.length;i>n;n++){var a,s=r[n],o=null,l={},c=s.attributes.length;if(c>0)for(a=0;c>a;a++){var u=s.attributes[a];l[u.nodeName]=u.nodeValue}else{var p=s.childNodes;for(a=0,c=p.length;c>a;++a){var h=p[a];3!=h.nodeType&&(l[h.getAttribute("name")]=h.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(o,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var r,n,i,a,s,o=[];if(e&&e.hasChildNodes()){r=e.childNodes;i=r.length;for(var l=0;i>l;l++){s=r[l];for(;s&&1!=s.nodeType;){s=s.nextSibling;l++}n=s?s.nodeName:"";if(n.length>0&&n.indexOf(t)>-1)o.push(s);else{a=this.getSiblingNodesByTagCriteria(s,t);a.length>0&&(0==o.length?o=a:o.push(a))}}}return o},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var r=e.childNodes,n=r.length,i=0;n>i;++i){var a=r[i];if(1==a.nodeType){var s=a.childNodes,o=a.prefix?a.nodeName.split(":")[1]:a.nodeName;if(0==s.length)t[o]=null;else if(1==s.length){var l=s[0];if(3==l.nodeType||4==l.nodeType){var c=l.nodeValue.replace(this.regExes.trimSpace,"");t[o]=c}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,r=this.gmlFormat.parseFeature(e),n=null;if(r){t=r.geometry&&r.geometry.clone();n=r.bounds&&r.bounds.clone();r.destroy()}return{geometry:t,bounds:n}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){e=e||{};e.handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions));this.drillDown===!0&&(this.hover=!1);if(this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});this.request(e.xy,{hover:!0})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){for(var e,t,r=this.layers||this.map.layers,n=[],i=r.length-1;i>=0;--i){e=r[i];if(e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url;this.drillDown!==!1||this.url||(this.url=t);(this.drillDown===!0||this.urlMatches(t))&&n.push(e)}}return n},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var r=0,n=this.layerUrls.length;n>r;++r)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[r],e)){t=!0;break}return t},buildWMSOptions:function(e,t,r,n){for(var i=[],a=[],s=0,o=t.length;o>s;s++)if(null!=t[s].params.LAYERS){i=i.concat(t[s].params.LAYERS);a=a.concat(this.getStyleNames(t[s]))}var l=t[0],c=this.map.getProjection(),u=l.projection;u&&u.equals(this.map.getProjectionObject())&&(c=u.getCode());var p=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:n,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:c,i:parseInt(r.x),j:parseInt(r.y)}:{srs:c,x:parseInt(r.x),y:parseInt(r.y)});0!=i.length&&(p=OpenLayers.Util.extend({layers:i,query_layers:i,styles:a},p));OpenLayers.Util.applyDefaults(p,this.vendorParams);return{url:e,params:OpenLayers.Util.upperCaseObject(p),callback:function(t){this.handleResponse(r,t,e)},scope:this}},getStyleNames:function(e){var t;t=e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"");return t},request:function(e,t){var r=this.findLayers();if(0!=r.length){t=t||{};if(this.drillDown===!1){var n=this.buildWMSOptions(this.url,r,e,r[0].params.FORMAT),i=OpenLayers.Request.GET(n);t.hover===!0&&(this.hoverRequest=i)}else{this._requestCount=0;this._numRequests=0;this.features=[];for(var a,s={},o=0,l=r.length;l>o;o++){var c=r[o];a=OpenLayers.Util.isArray(c.url)?c.url[0]:c.url;if(a in s)s[a].push(c);else{this._numRequests++;s[a]=[c]}}var r;for(var a in s){r=s[a];var n=this.buildWMSOptions(a,r,e,r[0].params.FORMAT);OpenLayers.Request.GET(n)}}}else{this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},triggerGetFeatureInfo:function(e,t,r){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:r,request:e,xy:t});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,r){var n=t.responseXML;n&&n.documentElement||(n=t.responseText);var i=this.format.read(n);if(this.drillDown===!1)this.triggerGetFeatureInfo(t,e,i);else{this._requestCount++;this._features=(this._features||[]).concat("object"===this.output?{url:r,features:i}:i);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(t,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Protocol.WFS.v1_1_0=OpenLayers.Class(OpenLayers.Protocol.WFS.v1,{version:"1.1.0",initialize:function(e){OpenLayers.Protocol.WFS.v1.prototype.initialize.apply(this,arguments);this.outputFormat&&!this.readFormat&&("gml2"==this.outputFormat.toLowerCase()?this.readFormat=new OpenLayers.Format.GML.v2({featureType:this.featureType,featureNS:this.featureNS,geometryName:this.geometryName}):"json"==this.outputFormat.toLowerCase()&&(this.readFormat=new OpenLayers.Format.GeoJSON))},CLASS_NAME:"OpenLayers.Protocol.WFS.v1_1_0"});OpenLayers.Control.PinchZoom=OpenLayers.Class(OpenLayers.Control,{type:OpenLayers.Control.TYPE_TOOL,pinchOrigin:null,currentCenter:null,autoActivate:!0,preserveCenter:!1,initialize:function(e){OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Pinch(this,{start:this.pinchStart,move:this.pinchMove,done:this.pinchDone},this.handlerOptions)},pinchStart:function(e,t){var r=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy;this.pinchOrigin=r;this.currentCenter=r},pinchMove:function(e,t){var r=t.scale,n=this.map.layerContainerOriginPx,i=this.pinchOrigin,a=this.preserveCenter?this.map.getPixelFromLonLat(this.map.getCenter()):e.xy,s=Math.round(n.x+a.x-i.x+(r-1)*(n.x-i.x)),o=Math.round(n.y+a.y-i.y+(r-1)*(n.y-i.y));this.map.applyTransform(s,o,r);this.currentCenter=a},pinchDone:function(e,t,r){this.map.applyTransform();var n=this.map.getZoomForResolution(this.map.getResolution()/r.scale,!0);if(n!==this.map.getZoom()||!this.currentCenter.equals(this.pinchOrigin)){var i=this.map.getResolutionForZoom(n),a=this.map.getLonLatFromPixel(this.pinchOrigin),s=this.currentCenter,o=this.map.getSize();a.lon+=i*(o.w/2-s.x);a.lat-=i*(o.h/2-s.y);this.map.div.clientWidth=this.map.div.clientWidth;this.map.setCenter(a,n)}},CLASS_NAME:"OpenLayers.Control.PinchZoom"});OpenLayers.Format.WMSCapabilities.v1_1_1=OpenLayers.Class(OpenLayers.Format.WMSCapabilities.v1_1,{version:"1.1.1",readers:{wms:OpenLayers.Util.applyDefaults({SRS:function(e,t){t.srs[this.getChildValue(e)]=!0}},OpenLayers.Format.WMSCapabilities.v1_1.prototype.readers.wms)},CLASS_NAME:"OpenLayers.Format.WMSCapabilities.v1_1_1"});var Proj4js={defaultDatum:"WGS84",transform:function(e,t,r){if(!e.readyToUse){this.reportError("Proj4js initialization for:"+e.srsCode+" not yet complete");return r}if(!t.readyToUse){this.reportError("Proj4js initialization for:"+t.srsCode+" not yet complete");return r}if(e.datum&&t.datum&&((e.datum.datum_type==Proj4js.common.PJD_3PARAM||e.datum.datum_type==Proj4js.common.PJD_7PARAM)&&"WGS84"!=t.datumCode||(t.datum.datum_type==Proj4js.common.PJD_3PARAM||t.datum.datum_type==Proj4js.common.PJD_7PARAM)&&"WGS84"!=e.datumCode)){var n=Proj4js.WGS84;this.transform(e,n,r);e=n}"enu"!=e.axis&&this.adjust_axis(e,!1,r);if("longlat"==e.projName){r.x*=Proj4js.common.D2R;r.y*=Proj4js.common.D2R}else{if(e.to_meter){r.x*=e.to_meter;r.y*=e.to_meter}e.inverse(r)}e.from_greenwich&&(r.x+=e.from_greenwich);r=this.datum_transform(e.datum,t.datum,r);t.from_greenwich&&(r.x-=t.from_greenwich);if("longlat"==t.projName){r.x*=Proj4js.common.R2D;r.y*=Proj4js.common.R2D}else{t.forward(r);if(t.to_meter){r.x/=t.to_meter;r.y/=t.to_meter}}"enu"!=t.axis&&this.adjust_axis(t,!0,r);return r},datum_transform:function(e,t,r){if(e.compare_datums(t))return r;if(e.datum_type==Proj4js.common.PJD_NODATUM||t.datum_type==Proj4js.common.PJD_NODATUM)return r;if(e.es!=t.es||e.a!=t.a||e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM||t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM){e.geodetic_to_geocentric(r);(e.datum_type==Proj4js.common.PJD_3PARAM||e.datum_type==Proj4js.common.PJD_7PARAM)&&e.geocentric_to_wgs84(r);(t.datum_type==Proj4js.common.PJD_3PARAM||t.datum_type==Proj4js.common.PJD_7PARAM)&&t.geocentric_from_wgs84(r);t.geocentric_to_geodetic(r)}return r},adjust_axis:function(e,t,r){for(var n,i,a=r.x,s=r.y,o=r.z||0,l=0;3>l;l++)if(!t||2!=l||void 0!==r.z){if(0==l){n=a;i="x"}else if(1==l){n=s;i="y"}else{n=o;i="z"}switch(e.axis[l]){case"e":r[i]=n;break;case"w":r[i]=-n;break;case"n":r[i]=n;break;case"s":r[i]=-n;break;case"u":void 0!==r[i]&&(r.z=n);break;case"d":void 0!==r[i]&&(r.z=-n);break;default:alert("ERROR: unknow axis ("+e.axis[l]+") - check definition of "+e.projName);return null}}return r},reportError:function(e){},extend:function(e,t){e=e||{};if(t)for(var r in t){var n=t[r];void 0!==n&&(e[r]=n)}return e},Class:function(){for(var e,t=function(){this.initialize.apply(this,arguments)},r={},n=0;n<arguments.length;++n){e="function"==typeof arguments[n]?arguments[n].prototype:arguments[n];Proj4js.extend(r,e)}t.prototype=r;return t},bind:function(e,t){var r=Array.prototype.slice.apply(arguments,[2]);return function(){var n=r.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,n)}},scriptName:"proj4js-combined.js",defsLookupService:"http://spatialreference.org/ref",libPath:null,getScriptLocation:function(){if(this.libPath)return this.libPath;for(var e=this.scriptName,t=e.length,r=document.getElementsByTagName("script"),n=0;n<r.length;n++){var i=r[n].getAttribute("src");if(i){var a=i.lastIndexOf(e);if(a>-1&&a+t==i.length){this.libPath=i.slice(0,-t);break}}}return this.libPath||""},loadScript:function(e,t,r,n){var i=document.createElement("script");i.defer=!1;i.type="text/javascript";i.id=e;i.src=e;i.onload=t;i.onerror=r;i.loadCheck=n;/MSIE/.test(navigator.userAgent)&&(i.onreadystatechange=this.checkReadyState);document.getElementsByTagName("head")[0].appendChild(i)},checkReadyState:function(){"loaded"==this.readyState&&(this.loadCheck()?this.onload():this.onerror())}};Proj4js.Proj=Proj4js.Class({readyToUse:!1,title:null,projName:null,units:null,datum:null,x0:0,y0:0,localCS:!1,queue:null,initialize:function(e,t){this.srsCodeInput=e;this.queue=[];t&&this.queue.push(t);if(e.indexOf("GEOGCS")>=0||e.indexOf("GEOCCS")>=0||e.indexOf("PROJCS")>=0||e.indexOf("LOCAL_CS")>=0){this.parseWKT(e);this.deriveConstants();this.loadProjCode(this.projName)}else{if(0==e.indexOf("urn:")){var r=e.split(":");"ogc"!=r[1]&&"x-ogc"!=r[1]||"def"!=r[2]||"crs"!=r[3]||(e=r[4]+":"+r[r.length-1])}else if(0==e.indexOf("http://")){var n=e.split("#");n[0].match(/epsg.org/)?e="EPSG:"+n[1]:n[0].match(/RIG.xml/)&&(e="IGNF:"+n[1])}this.srsCode=e.toUpperCase();if(0==this.srsCode.indexOf("EPSG")){this.srsCode=this.srsCode;this.srsAuth="epsg";this.srsProjNumber=this.srsCode.substring(5)}else if(0==this.srsCode.indexOf("IGNF")){this.srsCode=this.srsCode;this.srsAuth="IGNF";this.srsProjNumber=this.srsCode.substring(5)}else if(0==this.srsCode.indexOf("CRS")){this.srsCode=this.srsCode;this.srsAuth="CRS";this.srsProjNumber=this.srsCode.substring(4)}else{this.srsAuth="";this.srsProjNumber=this.srsCode}this.loadProjDefinition()}},loadProjDefinition:function(){if(Proj4js.defs[this.srsCode])this.defsLoaded();else{var e=Proj4js.getScriptLocation()+"defs/"+this.srsAuth.toUpperCase()+this.srsProjNumber+".js";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.loadFromService,this),Proj4js.bind(this.checkDefsLoaded,this))}},loadFromService:function(){var e=Proj4js.defsLookupService+"/"+this.srsAuth+"/"+this.srsProjNumber+"/proj4js/";Proj4js.loadScript(e,Proj4js.bind(this.defsLoaded,this),Proj4js.bind(this.defsFailed,this),Proj4js.bind(this.checkDefsLoaded,this))},defsLoaded:function(){this.parseDefs();this.loadProjCode(this.projName)},checkDefsLoaded:function(){return Proj4js.defs[this.srsCode]?!0:!1},defsFailed:function(){Proj4js.reportError("failed to load projection definition for: "+this.srsCode);Proj4js.defs[this.srsCode]=Proj4js.defs.WGS84;this.defsLoaded()},loadProjCode:function(e){if(Proj4js.Proj[e])this.initTransforms();else{var t=Proj4js.getScriptLocation()+"projCode/"+e+".js";Proj4js.loadScript(t,Proj4js.bind(this.loadProjCodeSuccess,this,e),Proj4js.bind(this.loadProjCodeFailure,this,e),Proj4js.bind(this.checkCodeLoaded,this,e))}},loadProjCodeSuccess:function(e){Proj4js.Proj[e].dependsOn?this.loadProjCode(Proj4js.Proj[e].dependsOn):this.initTransforms()},loadProjCodeFailure:function(e){Proj4js.reportError("failed to find projection file for: "+e)},checkCodeLoaded:function(e){return Proj4js.Proj[e]?!0:!1},initTransforms:function(){Proj4js.extend(this,Proj4js.Proj[this.projName]);this.init();this.readyToUse=!0;if(this.queue)for(var e;e=this.queue.shift();)e.call(this,this)},wktRE:/^(\w+)\[(.*)\]$/,parseWKT:function(e){var t=e.match(this.wktRE);if(t){var r,n=t[1],i=t[2],a=i.split(",");r="TOWGS84"==n.toUpperCase()?n:a.shift();r=r.replace(/^\"/,"");r=r.replace(/\"$/,"");for(var s=new Array,o=0,l="",c=0;c<a.length;++c){for(var u=a[c],p=0;p<u.length;++p){"["==u.charAt(p)&&++o;"]"==u.charAt(p)&&--o}l+=u;if(0===o){s.push(l);l=""}else l+=","}switch(n){case"LOCAL_CS":this.projName="identity";this.localCS=!0;this.srsCode=r;break;case"GEOGCS":this.projName="longlat";this.geocsCode=r;this.srsCode||(this.srsCode=r);break;case"PROJCS":this.srsCode=r;break;case"GEOCCS":break;case"PROJECTION":this.projName=Proj4js.wktProjections[r];break;case"DATUM":this.datumName=r;break;case"LOCAL_DATUM":this.datumCode="none";break;case"SPHEROID":this.ellps=r;this.a=parseFloat(s.shift());this.rf=parseFloat(s.shift());break;case"PRIMEM":this.from_greenwich=parseFloat(s.shift());break;case"UNIT":this.units=r;this.unitsPerMeter=parseFloat(s.shift());break;case"PARAMETER":var h=r.toLowerCase(),d=parseFloat(s.shift());switch(h){case"false_easting":this.x0=d;break;case"false_northing":this.y0=d;break;case"scale_factor":this.k0=d;break;case"central_meridian":this.long0=d*Proj4js.common.D2R;break;case"latitude_of_origin":this.lat0=d*Proj4js.common.D2R;break;case"more_here":}break;case"TOWGS84":this.datum_params=s;break;case"AXIS":var h=r.toLowerCase(),d=s.shift();switch(d){case"EAST":d="e";break;case"WEST":d="w";break;case"NORTH":d="n";break;case"SOUTH":d="s";break;case"UP":d="u";break;case"DOWN":d="d";break;case"OTHER":default:d=" "}this.axis||(this.axis="enu");switch(h){case"x":this.axis=d+this.axis.substr(1,2);break;case"y":this.axis=this.axis.substr(0,1)+d+this.axis.substr(2,1);break;case"z":this.axis=this.axis.substr(0,2)+d}case"MORE_HERE":}for(var c=0;c<s.length;++c)this.parseWKT(s[c])}},parseDefs:function(){this.defData=Proj4js.defs[this.srsCode];var e,t;if(this.defData){for(var r=this.defData.split("+"),n=0;n<r.length;n++){var i=r[n].split("=");e=i[0].toLowerCase();t=i[1];switch(e.replace(/\s/gi,"")){case"":break;case"title":this.title=t;break;case"proj":this.projName=t.replace(/\s/gi,"");break;case"units":this.units=t.replace(/\s/gi,"");break;case"datum":this.datumCode=t.replace(/\s/gi,"");break;case"nadgrids":this.nagrids=t.replace(/\s/gi,"");break;case"ellps":this.ellps=t.replace(/\s/gi,"");break;case"a":this.a=parseFloat(t);break;case"b":this.b=parseFloat(t);break;case"rf":this.rf=parseFloat(t);break;case"lat_0":this.lat0=t*Proj4js.common.D2R;break;case"lat_1":this.lat1=t*Proj4js.common.D2R;break;case"lat_2":this.lat2=t*Proj4js.common.D2R;break;case"lat_ts":this.lat_ts=t*Proj4js.common.D2R;break;case"lon_0":this.long0=t*Proj4js.common.D2R;break;case"alpha":this.alpha=parseFloat(t)*Proj4js.common.D2R;break;case"lonc":this.longc=t*Proj4js.common.D2R;break;case"x_0":this.x0=parseFloat(t);break;case"y_0":this.y0=parseFloat(t);break;case"k_0":this.k0=parseFloat(t);break;case"k":this.k0=parseFloat(t);break;case"r_a":this.R_A=!0;break;case"zone":this.zone=parseInt(t,10);break;case"south":this.utmSouth=!0;break;case"towgs84":this.datum_params=t.split(",");break;case"to_meter":this.to_meter=parseFloat(t);break;case"from_greenwich":this.from_greenwich=t*Proj4js.common.D2R;break;case"pm":t=t.replace(/\s/gi,"");this.from_greenwich=Proj4js.PrimeMeridian[t]?Proj4js.PrimeMeridian[t]:parseFloat(t);this.from_greenwich*=Proj4js.common.D2R;break;case"axis":t=t.replace(/\s/gi,"");var a="ewnsud";3==t.length&&-1!=a.indexOf(t.substr(0,1))&&-1!=a.indexOf(t.substr(1,1))&&-1!=a.indexOf(t.substr(2,1))&&(this.axis=t);break;case"no_defs":}}this.deriveConstants()}},deriveConstants:function(){"@null"==this.nagrids&&(this.datumCode="none");if(this.datumCode&&"none"!=this.datumCode){var e=Proj4js.Datum[this.datumCode];if(e){this.datum_params=e.towgs84?e.towgs84.split(","):null;this.ellps=e.ellipse;this.datumName=e.datumName?e.datumName:this.datumCode}}if(!this.a){var t=Proj4js.Ellipsoid[this.ellps]?Proj4js.Ellipsoid[this.ellps]:Proj4js.Ellipsoid.WGS84;Proj4js.extend(this,t)}this.rf&&!this.b&&(this.b=(1-1/this.rf)*this.a);if(0===this.rf||Math.abs(this.a-this.b)<Proj4js.common.EPSLN){this.sphere=!0;this.b=this.a}this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=(this.a2-this.b2)/this.a2;this.e=Math.sqrt(this.es);if(this.R_A){this.a*=1-this.es*(Proj4js.common.SIXTH+this.es*(Proj4js.common.RA4+this.es*Proj4js.common.RA6));this.a2=this.a*this.a;this.b2=this.b*this.b;this.es=0}this.ep2=(this.a2-this.b2)/this.b2;this.k0||(this.k0=1);this.axis||(this.axis="enu");this.datum=new Proj4js.datum(this)}});Proj4js.Proj.longlat={init:function(){},forward:function(e){return e},inverse:function(e){return e}};Proj4js.Proj.identity=Proj4js.Proj.longlat;Proj4js.defs={WGS84:"+title=long/lat:WGS84 +proj=longlat +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4326":"+title=long/lat:WGS84 +proj=longlat +a=6378137.0 +b=6356752.31424518 +ellps=WGS84 +datum=WGS84 +units=degrees","EPSG:4269":"+title=long/lat:NAD83 +proj=longlat +a=6378137.0 +b=6356752.31414036 +ellps=GRS80 +datum=NAD83 +units=degrees","EPSG:3875":"+title= Google Mercator +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs"};Proj4js.defs["EPSG:3785"]=Proj4js.defs["EPSG:3875"];Proj4js.defs.GOOGLE=Proj4js.defs["EPSG:3875"];Proj4js.defs["EPSG:900913"]=Proj4js.defs["EPSG:3875"];Proj4js.defs["EPSG:102113"]=Proj4js.defs["EPSG:3875"];Proj4js.common={PI:3.141592653589793,HALF_PI:1.5707963267948966,TWO_PI:6.283185307179586,FORTPI:.7853981633974483,R2D:57.29577951308232,D2R:.017453292519943295,SEC_TO_RAD:484813681109536e-20,EPSLN:1e-10,MAX_ITER:20,COS_67P5:.3826834323650898,AD_C:1.0026,PJD_UNKNOWN:0,PJD_3PARAM:1,PJD_7PARAM:2,PJD_GRIDSHIFT:3,PJD_WGS84:4,PJD_NODATUM:5,SRS_WGS84_SEMIMAJOR:6378137,SIXTH:.16666666666666666,RA4:.04722222222222222,RA6:.022156084656084655,RV4:.06944444444444445,RV6:.04243827160493827,msfnz:function(e,t,r){var n=e*t;return r/Math.sqrt(1-n*n)},tsfnz:function(e,t,r){var n=e*r,i=.5*e;n=Math.pow((1-n)/(1+n),i);return Math.tan(.5*(this.HALF_PI-t))/n},phi2z:function(e,t){for(var r,n,i=.5*e,a=this.HALF_PI-2*Math.atan(t),s=0;15>=s;s++){r=e*Math.sin(a);n=this.HALF_PI-2*Math.atan(t*Math.pow((1-r)/(1+r),i))-a;a+=n;if(Math.abs(n)<=1e-10)return a}alert("phi2z has NoConvergence");return-9999},qsfnz:function(e,t){var r;if(e>1e-7){r=e*t;return(1-e*e)*(t/(1-r*r)-.5/e*Math.log((1-r)/(1+r)))}return 2*t},asinz:function(e){Math.abs(e)>1&&(e=e>1?1:-1);return Math.asin(e)},e0fn:function(e){return 1-.25*e*(1+e/16*(3+1.25*e))},e1fn:function(e){return.375*e*(1+.25*e*(1+.46875*e))},e2fn:function(e){return.05859375*e*e*(1+.75*e)},e3fn:function(e){return e*e*e*(35/3072)},mlfn:function(e,t,r,n,i){return e*i-t*Math.sin(2*i)+r*Math.sin(4*i)-n*Math.sin(6*i)},srat:function(e,t){return Math.pow((1-e)/(1+e),t)},sign:function(e){return 0>e?-1:1},adjust_lon:function(e){e=Math.abs(e)<this.PI?e:e-this.sign(e)*this.TWO_PI;return e},adjust_lat:function(e){e=Math.abs(e)<this.HALF_PI?e:e-this.sign(e)*this.PI;return e},latiso:function(e,t,r){if(Math.abs(t)>this.HALF_PI)return+Number.NaN;if(t==this.HALF_PI)return Number.POSITIVE_INFINITY;if(t==-1*this.HALF_PI)return-1*Number.POSITIVE_INFINITY;var n=e*r;return Math.log(Math.tan((this.HALF_PI+t)/2))+e*Math.log((1-n)/(1+n))/2},fL:function(e,t){return 2*Math.atan(e*Math.exp(t))-this.HALF_PI},invlatiso:function(e,t){var r=this.fL(1,t),n=0,i=0;do{n=r;i=e*Math.sin(n);r=this.fL(Math.exp(e*Math.log((1+i)/(1-i))/2),t)}while(Math.abs(r-n)>1e-12);return r},sinh:function(e){var t=Math.exp(e);t=(t-1/t)/2;return t},cosh:function(e){var t=Math.exp(e);t=(t+1/t)/2;return t},tanh:function(e){var t=Math.exp(e);t=(t-1/t)/(t+1/t);return t},asinh:function(e){var t=e>=0?1:-1;return t*Math.log(Math.abs(e)+Math.sqrt(e*e+1))},acosh:function(e){return 2*Math.log(Math.sqrt((e+1)/2)+Math.sqrt((e-1)/2))},atanh:function(e){return Math.log((e-1)/(e+1))/2},gN:function(e,t,r){var n=t*r;return e/Math.sqrt(1-n*n)},pj_enfn:function(e){var t=new Array;t[0]=this.C00-e*(this.C02+e*(this.C04+e*(this.C06+e*this.C08)));t[1]=e*(this.C22-e*(this.C04+e*(this.C06+e*this.C08)));var r=e*e;t[2]=r*(this.C44-e*(this.C46+e*this.C48));r*=e;t[3]=r*(this.C66-e*this.C68);t[4]=r*e*this.C88;return t},pj_mlfn:function(e,t,r,n){r*=t;t*=t;return n[0]*e-r*(n[1]+t*(n[2]+t*(n[3]+t*n[4])))},pj_inv_mlfn:function(e,t,r){for(var n=1/(1-t),i=e,a=Proj4js.common.MAX_ITER;a;--a){var s=Math.sin(i),o=1-t*s*s;o=(this.pj_mlfn(i,s,Math.cos(i),r)-e)*o*Math.sqrt(o)*n;i-=o;if(Math.abs(o)<Proj4js.common.EPSLN)return i}Proj4js.reportError("cass:pj_inv_mlfn: Convergence error");return i},C00:1,C02:.25,C04:.046875,C06:.01953125,C08:.01068115234375,C22:.75,C44:.46875,C46:.013020833333333334,C48:.007120768229166667,C66:.3645833333333333,C68:.005696614583333333,C88:.3076171875};Proj4js.datum=Proj4js.Class({initialize:function(e){this.datum_type=Proj4js.common.PJD_WGS84;e.datumCode&&"none"==e.datumCode&&(this.datum_type=Proj4js.common.PJD_NODATUM);if(e&&e.datum_params){for(var t=0;t<e.datum_params.length;t++)e.datum_params[t]=parseFloat(e.datum_params[t]);(0!=e.datum_params[0]||0!=e.datum_params[1]||0!=e.datum_params[2])&&(this.datum_type=Proj4js.common.PJD_3PARAM);if(e.datum_params.length>3&&(0!=e.datum_params[3]||0!=e.datum_params[4]||0!=e.datum_params[5]||0!=e.datum_params[6])){this.datum_type=Proj4js.common.PJD_7PARAM;e.datum_params[3]*=Proj4js.common.SEC_TO_RAD;e.datum_params[4]*=Proj4js.common.SEC_TO_RAD;e.datum_params[5]*=Proj4js.common.SEC_TO_RAD;e.datum_params[6]=e.datum_params[6]/1e6+1}}if(e){this.a=e.a;this.b=e.b;this.es=e.es;this.ep2=e.ep2;this.datum_params=e.datum_params}},compare_datums:function(e){if(this.datum_type!=e.datum_type)return!1;if(this.a!=e.a||Math.abs(this.es-e.es)>5e-11)return!1;if(this.datum_type==Proj4js.common.PJD_3PARAM)return this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2];if(this.datum_type==Proj4js.common.PJD_7PARAM)return this.datum_params[0]==e.datum_params[0]&&this.datum_params[1]==e.datum_params[1]&&this.datum_params[2]==e.datum_params[2]&&this.datum_params[3]==e.datum_params[3]&&this.datum_params[4]==e.datum_params[4]&&this.datum_params[5]==e.datum_params[5]&&this.datum_params[6]==e.datum_params[6];if(this.datum_type==Proj4js.common.PJD_GRIDSHIFT||e.datum_type==Proj4js.common.PJD_GRIDSHIFT){alert("ERROR: Grid shift transformations are not implemented.");return!1}return!0},geodetic_to_geocentric:function(e){var t,r,n,i,a,s,o,l=e.x,c=e.y,u=e.z?e.z:0,p=0;if(c<-Proj4js.common.HALF_PI&&c>-1.001*Proj4js.common.HALF_PI)c=-Proj4js.common.HALF_PI;else if(c>Proj4js.common.HALF_PI&&c<1.001*Proj4js.common.HALF_PI)c=Proj4js.common.HALF_PI;else if(c<-Proj4js.common.HALF_PI||c>Proj4js.common.HALF_PI){Proj4js.reportError("geocent:lat out of range:"+c);return null}l>Proj4js.common.PI&&(l-=2*Proj4js.common.PI);a=Math.sin(c);o=Math.cos(c);s=a*a;i=this.a/Math.sqrt(1-this.es*s);t=(i+u)*o*Math.cos(l);r=(i+u)*o*Math.sin(l);n=(i*(1-this.es)+u)*a;e.x=t;e.y=r;e.z=n;return p},geocentric_to_geodetic:function(e){var t,r,n,i,a,s,o,l,c,u,p,h,d,f,m,y,g,v=1e-12,C=v*v,T=30,L=e.x,w=e.y,b=e.z?e.z:0;d=!1;t=Math.sqrt(L*L+w*w);r=Math.sqrt(L*L+w*w+b*b);if(t/this.a<v){d=!0;m=0;if(r/this.a<v){y=Proj4js.common.HALF_PI;g=-this.b;return}}else m=Math.atan2(w,L);n=b/r;i=t/r;a=1/Math.sqrt(1-this.es*(2-this.es)*i*i);l=i*(1-this.es)*a;c=n*a;f=0;do{f++;o=this.a/Math.sqrt(1-this.es*c*c);g=t*l+b*c-o*(1-this.es*c*c);s=this.es*o/(o+g);a=1/Math.sqrt(1-s*(2-s)*i*i);u=i*(1-s)*a;p=n*a;h=p*l-u*c;l=u;c=p}while(h*h>C&&T>f);y=Math.atan(p/Math.abs(u));e.x=m;e.y=y;e.z=g;return e},geocentric_to_geodetic_noniter:function(e){var t,r,n,i,a,s,o,l,c,u,p,h,d,f,m,y,g,v=e.x,C=e.y,T=e.z?e.z:0;v=parseFloat(v);C=parseFloat(C);T=parseFloat(T);g=!1;if(0!=v)t=Math.atan2(C,v);else if(C>0)t=Proj4js.common.HALF_PI;else if(0>C)t=-Proj4js.common.HALF_PI;else{g=!0;t=0;if(T>0)r=Proj4js.common.HALF_PI;else{if(!(0>T)){r=Proj4js.common.HALF_PI;n=-this.b;return}r=-Proj4js.common.HALF_PI}}a=v*v+C*C;i=Math.sqrt(a);s=T*Proj4js.common.AD_C;l=Math.sqrt(s*s+a);u=s/l;h=i/l;p=u*u*u;o=T+this.b*this.ep2*p;y=i-this.a*this.es*h*h*h;c=Math.sqrt(o*o+y*y);d=o/c;f=y/c;m=this.a/Math.sqrt(1-this.es*d*d);n=f>=Proj4js.common.COS_67P5?i/f-m:f<=-Proj4js.common.COS_67P5?i/-f-m:T/d+m*(this.es-1);0==g&&(r=Math.atan(d/f));e.x=t;e.y=r;e.z=n;return e},geocentric_to_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM){e.x+=this.datum_params[0];e.y+=this.datum_params[1];e.z+=this.datum_params[2]}else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],r=this.datum_params[1],n=this.datum_params[2],i=this.datum_params[3],a=this.datum_params[4],s=this.datum_params[5],o=this.datum_params[6],l=o*(e.x-s*e.y+a*e.z)+t,c=o*(s*e.x+e.y-i*e.z)+r,u=o*(-a*e.x+i*e.y+e.z)+n;e.x=l;e.y=c;e.z=u}},geocentric_from_wgs84:function(e){if(this.datum_type==Proj4js.common.PJD_3PARAM){e.x-=this.datum_params[0];e.y-=this.datum_params[1];e.z-=this.datum_params[2]}else if(this.datum_type==Proj4js.common.PJD_7PARAM){var t=this.datum_params[0],r=this.datum_params[1],n=this.datum_params[2],i=this.datum_params[3],a=this.datum_params[4],s=this.datum_params[5],o=this.datum_params[6],l=(e.x-t)/o,c=(e.y-r)/o,u=(e.z-n)/o;e.x=l+s*c-a*u;e.y=-s*l+c+i*u;e.z=a*l-i*c+u}}});Proj4js.Point=Proj4js.Class({initialize:function(e,t,r){if("object"==typeof e){this.x=e[0];this.y=e[1];this.z=e[2]||0}else if("string"==typeof e&&"undefined"==typeof t){var n=e.split(",");this.x=parseFloat(n[0]);this.y=parseFloat(n[1]);this.z=parseFloat(n[2])||0}else{this.x=e;this.y=t;this.z=r||0}},clone:function(){return new Proj4js.Point(this.x,this.y,this.z)},toString:function(){return"x="+this.x+",y="+this.y},toShortString:function(){return this.x+", "+this.y}});Proj4js.PrimeMeridian={greenwich:0,lisbon:-9.131906111111,paris:2.337229166667,bogota:-74.080916666667,madrid:-3.687938888889,rome:12.452333333333,bern:7.439583333333,jakarta:106.807719444444,ferro:-17.666666666667,brussels:4.367975,stockholm:18.058277777778,athens:23.7163375,oslo:10.722916666667};Proj4js.Ellipsoid={MERIT:{a:6378137,rf:298.257,ellipseName:"MERIT 1983"},SGS85:{a:6378136,rf:298.257,ellipseName:"Soviet Geodetic System 85"},GRS80:{a:6378137,rf:298.257222101,ellipseName:"GRS 1980(IUGG, 1980)"},IAU76:{a:6378140,rf:298.257,ellipseName:"IAU 1976"},airy:{a:6377563.396,b:6356256.91,ellipseName:"Airy 1830"},"APL4.":{a:6378137,rf:298.25,ellipseName:"Appl. Physics. 1965"},NWL9D:{a:6378145,rf:298.25,ellipseName:"Naval Weapons Lab., 1965"},mod_airy:{a:6377340.189,b:6356034.446,ellipseName:"Modified Airy"},andrae:{a:6377104.43,rf:300,ellipseName:"Andrae 1876 (Den., Iclnd.)"},aust_SA:{a:6378160,rf:298.25,ellipseName:"Australian Natl & S. Amer. 1969"},GRS67:{a:6378160,rf:298.247167427,ellipseName:"GRS 67(IUGG 1967)"},bessel:{a:6377397.155,rf:299.1528128,ellipseName:"Bessel 1841"},bess_nam:{a:6377483.865,rf:299.1528128,ellipseName:"Bessel 1841 (Namibia)"},clrk66:{a:6378206.4,b:6356583.8,ellipseName:"Clarke 1866"},clrk80:{a:6378249.145,rf:293.4663,ellipseName:"Clarke 1880 mod."},CPM:{a:6375738.7,rf:334.29,ellipseName:"Comm. des Poids et Mesures 1799"},delmbr:{a:6376428,rf:311.5,ellipseName:"Delambre 1810 (Belgium)"},engelis:{a:6378136.05,rf:298.2566,ellipseName:"Engelis 1985"},evrst30:{a:6377276.345,rf:300.8017,ellipseName:"Everest 1830"},evrst48:{a:6377304.063,rf:300.8017,ellipseName:"Everest 1948"},evrst56:{a:6377301.243,rf:300.8017,ellipseName:"Everest 1956"},evrst69:{a:6377295.664,rf:300.8017,ellipseName:"Everest 1969"},evrstSS:{a:6377298.556,rf:300.8017,ellipseName:"Everest (Sabah & Sarawak)"},fschr60:{a:6378166,rf:298.3,ellipseName:"Fischer (Mercury Datum) 1960"},fschr60m:{a:6378155,rf:298.3,ellipseName:"Fischer 1960"},fschr68:{a:6378150,rf:298.3,ellipseName:"Fischer 1968"},helmert:{a:6378200,rf:298.3,ellipseName:"Helmert 1906"},hough:{a:6378270,rf:297,ellipseName:"Hough"},intl:{a:6378388,rf:297,ellipseName:"International 1909 (Hayford)"},kaula:{a:6378163,rf:298.24,ellipseName:"Kaula 1961"},lerch:{a:6378139,rf:298.257,ellipseName:"Lerch 1979"},mprts:{a:6397300,rf:191,ellipseName:"Maupertius 1738"},new_intl:{a:6378157.5,b:6356772.2,ellipseName:"New International 1967"},plessis:{a:6376523,rf:6355863,ellipseName:"Plessis 1817 (France)"},krass:{a:6378245,rf:298.3,ellipseName:"Krassovsky, 1942"},SEasia:{a:6378155,b:6356773.3205,ellipseName:"Southeast Asia"},walbeck:{a:6376896,b:6355834.8467,ellipseName:"Walbeck"},WGS60:{a:6378165,rf:298.3,ellipseName:"WGS 60"},WGS66:{a:6378145,rf:298.25,ellipseName:"WGS 66"},WGS72:{a:6378135,rf:298.26,ellipseName:"WGS 72"},WGS84:{a:6378137,rf:298.257223563,ellipseName:"WGS 84"},sphere:{a:6370997,b:6370997,ellipseName:"Normal Sphere (r=6370997)"}};Proj4js.Datum={WGS84:{towgs84:"0,0,0",ellipse:"WGS84",datumName:"WGS84"},GGRS87:{towgs84:"-199.87,74.79,246.62",ellipse:"GRS80",datumName:"Greek_Geodetic_Reference_System_1987"},NAD83:{towgs84:"0,0,0",
ellipse:"GRS80",datumName:"North_American_Datum_1983"},NAD27:{nadgrids:"@conus,@alaska,@ntv2_0.gsb,@ntv1_can.dat",ellipse:"clrk66",datumName:"North_American_Datum_1927"},potsdam:{towgs84:"606.0,23.0,413.0",ellipse:"bessel",datumName:"Potsdam Rauenberg 1950 DHDN"},carthage:{towgs84:"-263.0,6.0,431.0",ellipse:"clark80",datumName:"Carthage 1934 Tunisia"},hermannskogel:{towgs84:"653.0,-212.0,449.0",ellipse:"bessel",datumName:"Hermannskogel"},ire65:{towgs84:"482.530,-130.596,564.557,-1.042,-0.214,-0.631,8.15",ellipse:"mod_airy",datumName:"Ireland 1965"},nzgd49:{towgs84:"59.47,-5.04,187.44,0.47,-0.1,1.024,-4.5993",ellipse:"intl",datumName:"New Zealand Geodetic Datum 1949"},OSGB36:{towgs84:"446.448,-125.157,542.060,0.1502,0.2470,0.8421,-20.4894",ellipse:"airy",datumName:"Airy 1830"}};Proj4js.WGS84=new Proj4js.Proj("WGS84");Proj4js.Datum.OSB36=Proj4js.Datum.OSGB36;Proj4js.wktProjections={"Lambert Tangential Conformal Conic Projection":"lcc",Mercator:"merc","Popular Visualisation Pseudo Mercator":"merc",Mercator_1SP:"merc",Transverse_Mercator:"tmerc","Transverse Mercator":"tmerc","Lambert Azimuthal Equal Area":"laea","Universal Transverse Mercator System":"utm"};Proj4js.Proj.aea={init:function(){if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)Proj4js.reportError("aeaInitEqualLatitudes");else{this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e3=Math.sqrt(this.es);this.sin_po=Math.sin(this.lat1);this.cos_po=Math.cos(this.lat1);this.t1=this.sin_po;this.con=this.sin_po;this.ms1=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs1=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat2);this.cos_po=Math.cos(this.lat2);this.t2=this.sin_po;this.ms2=Proj4js.common.msfnz(this.e3,this.sin_po,this.cos_po);this.qs2=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.sin_po=Math.sin(this.lat0);this.cos_po=Math.cos(this.lat0);this.t3=this.sin_po;this.qs0=Proj4js.common.qsfnz(this.e3,this.sin_po,this.cos_po);this.ns0=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?(this.ms1*this.ms1-this.ms2*this.ms2)/(this.qs2-this.qs1):this.con;this.c=this.ms1*this.ms1+this.ns0*this.qs1;this.rh=this.a*Math.sqrt(this.c-this.ns0*this.qs0)/this.ns0}},forward:function(e){var t=e.x,r=e.y;this.sin_phi=Math.sin(r);this.cos_phi=Math.cos(r);var n=Proj4js.common.qsfnz(this.e3,this.sin_phi,this.cos_phi),i=this.a*Math.sqrt(this.c-this.ns0*n)/this.ns0,a=this.ns0*Proj4js.common.adjust_lon(t-this.long0),s=i*Math.sin(a)+this.x0,o=this.rh-i*Math.cos(a)+this.y0;e.x=s;e.y=o;return e},inverse:function(e){var t,r,n,i,a,s;e.x-=this.x0;e.y=this.rh-e.y+this.y0;if(this.ns0>=0){t=Math.sqrt(e.x*e.x+e.y*e.y);n=1}else{t=-Math.sqrt(e.x*e.x+e.y*e.y);n=-1}i=0;0!=t&&(i=Math.atan2(n*e.x,n*e.y));n=t*this.ns0/this.a;r=(this.c-n*n)/this.ns0;if(this.e3>=1e-10){n=1-.5*(1-this.es)*Math.log((1-this.e3)/(1+this.e3))/this.e3;s=Math.abs(Math.abs(n)-Math.abs(r))>1e-10?this.phi1z(this.e3,r):r>=0?.5*Proj4js.common.PI:-.5*Proj4js.common.PI}else s=this.phi1z(this.e3,r);a=Proj4js.common.adjust_lon(i/this.ns0+this.long0);e.x=a;e.y=s;return e},phi1z:function(e,t){var r,n,i,a,s,o=Proj4js.common.asinz(.5*t);if(e<Proj4js.common.EPSLN)return o;for(var l=e*e,c=1;25>=c;c++){r=Math.sin(o);n=Math.cos(o);i=e*r;a=1-i*i;s=.5*a*a/n*(t/(1-l)-r/a+.5/e*Math.log((1-i)/(1+i)));o+=s;if(Math.abs(s)<=1e-7)return o}Proj4js.reportError("aea:phi1z:Convergence error");return null}};Proj4js.Proj.sterea={dependsOn:"gauss",init:function(){Proj4js.Proj.gauss.init.apply(this);if(this.rc){this.sinc0=Math.sin(this.phic0);this.cosc0=Math.cos(this.phic0);this.R2=2*this.rc;this.title||(this.title="Oblique Stereographic Alternative")}else Proj4js.reportError("sterea:init:E_ERROR_0")},forward:function(e){var t,r,n,i;e.x=Proj4js.common.adjust_lon(e.x-this.long0);Proj4js.Proj.gauss.forward.apply(this,[e]);t=Math.sin(e.y);r=Math.cos(e.y);n=Math.cos(e.x);i=this.k0*this.R2/(1+this.sinc0*t+this.cosc0*r*n);e.x=i*r*Math.sin(e.x);e.y=i*(this.cosc0*t-this.sinc0*r*n);e.x=this.a*e.x+this.x0;e.y=this.a*e.y+this.y0;return e},inverse:function(e){var t,r,n,i,a;e.x=(e.x-this.x0)/this.a;e.y=(e.y-this.y0)/this.a;e.x/=this.k0;e.y/=this.k0;if(a=Math.sqrt(e.x*e.x+e.y*e.y)){var s=2*Math.atan2(a,this.R2);t=Math.sin(s);r=Math.cos(s);i=Math.asin(r*this.sinc0+e.y*t*this.cosc0/a);n=Math.atan2(e.x*t,a*this.cosc0*r-e.y*this.sinc0*t)}else{i=this.phic0;n=0}e.x=n;e.y=i;Proj4js.Proj.gauss.inverse.apply(this,[e]);e.x=Proj4js.common.adjust_lon(e.x+this.long0);return e}};Proj4js.Proj.poly={init:function(){0==this.lat0&&(this.lat0=90);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,r,n,i,a,s,o,l=e.x,c=e.y;n=Proj4js.common.adjust_lon(l-this.long0);if(Math.abs(c)<=1e-7){s=this.x0+this.a*n;o=this.y0-this.a*this.ml0}else{t=Math.sin(c);r=Math.cos(c);i=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,c);a=Proj4js.common.msfnz(this.e,t,r);n=t;s=this.x0+this.a*a*Math.sin(n)/t;o=this.y0+this.a*(i-this.ml0+a*(1-Math.cos(n))/t)}e.x=s;e.y=o;return e},inverse:function(e){var t,r,n,i,a,s;e.x-=this.x0;e.y-=this.y0;t=this.ml0+e.y/this.a;i=0;if(Math.abs(t)<=1e-7){a=e.x/this.a+this.long0;s=0}else{r=t*t+e.x/this.a*(e.x/this.a);i=phi4z(this.es,this.e0,this.e1,this.e2,this.e3,this.al,r,n,s);if(1!=i)return i;a=Proj4js.common.adjust_lon(Proj4js.common.asinz(e.x*n/this.a)/Math.sin(s)+this.long0)}e.x=a;e.y=s;return e}};Proj4js.Proj.equi={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0)},forward:function(e){var t=e.x,r=e.y,n=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*n*Math.cos(this.lat0),a=this.y0+this.a*r;this.t1=i;this.t2=Math.cos(this.lat0);e.x=i;e.y=a;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=e.y/this.a;Math.abs(t)>Proj4js.common.HALF_PI&&Proj4js.reportError("equi:Inv:DataError");var r=Proj4js.common.adjust_lon(this.long0+e.x/(this.a*Math.cos(this.lat0)));e.x=r;e.y=t}};Proj4js.Proj.merc={init:function(){this.lat_ts&&(this.k0=this.sphere?Math.cos(this.lat_ts):Proj4js.common.msfnz(this.es,Math.sin(this.lat_ts),Math.cos(this.lat_ts)))},forward:function(e){var t=e.x,r=e.y;if(r*Proj4js.common.R2D>90&&r*Proj4js.common.R2D<-90&&t*Proj4js.common.R2D>180&&t*Proj4js.common.R2D<-180){Proj4js.reportError("merc:forward: llInputOutOfRange: "+t+" : "+r);return null}var n,i;if(Math.abs(Math.abs(r)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){Proj4js.reportError("merc:forward: ll2mAtPoles");return null}if(this.sphere){n=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0);i=this.y0+this.a*this.k0*Math.log(Math.tan(Proj4js.common.FORTPI+.5*r))}else{var a=Math.sin(r),s=Proj4js.common.tsfnz(this.e,r,a);n=this.x0+this.a*this.k0*Proj4js.common.adjust_lon(t-this.long0);i=this.y0-this.a*this.k0*Math.log(s)}e.x=n;e.y=i;return e},inverse:function(e){var t,r,n=e.x-this.x0,i=e.y-this.y0;if(this.sphere)r=Proj4js.common.HALF_PI-2*Math.atan(Math.exp(-i/this.a*this.k0));else{var a=Math.exp(-i/(this.a*this.k0));r=Proj4js.common.phi2z(this.e,a);if(-9999==r){Proj4js.reportError("merc:inverse: lat = -9999");return null}}t=Proj4js.common.adjust_lon(this.long0+n/(this.a*this.k0));e.x=t;e.y=r;return e}};Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(this.zone){this.lat0=0;this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R;this.x0=5e5;this.y0=this.utmSouth?1e7:0;this.k0=.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}else Proj4js.reportError("utm:init: zone must be specified for UTM")}};Proj4js.Proj.eqdc={init:function(){this.mode||(this.mode=0);this.temp=this.b/this.a;this.es=1-Math.pow(this.temp,2);this.e=Math.sqrt(this.es);this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.sinphi=Math.sin(this.lat1);this.cosphi=Math.cos(this.lat1);this.ms1=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml1=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat1);if(0!=this.mode){Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN&&Proj4js.reportError("eqdc:Init:EqualLatitudes");this.sinphi=Math.sin(this.lat2);this.cosphi=Math.cos(this.lat2);this.ms2=Proj4js.common.msfnz(this.e,this.sinphi,this.cosphi);this.ml2=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat2);this.ns=Math.abs(this.lat1-this.lat2)>=Proj4js.common.EPSLN?(this.ms1-this.ms2)/(this.ml2-this.ml1):this.sinphi}else this.ns=this.sinphi;this.g=this.ml1+this.ms1/this.ns;this.ml0=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0);this.rh=this.a*(this.g-this.ml0)},forward:function(e){var t=e.x,r=e.y,n=Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,r),i=this.a*(this.g-n),a=this.ns*Proj4js.common.adjust_lon(t-this.long0),s=this.x0+i*Math.sin(a),o=this.y0+this.rh-i*Math.cos(a);e.x=s;e.y=o;return e},inverse:function(e){e.x-=this.x0;e.y=this.rh-e.y+this.y0;var t,r;if(this.ns>=0){r=Math.sqrt(e.x*e.x+e.y*e.y);t=1}else{r=-Math.sqrt(e.x*e.x+e.y*e.y);t=-1}var n=0;0!=r&&(n=Math.atan2(t*e.x,t*e.y));var i=this.g-r/this.a,a=this.phi3z(i,this.e0,this.e1,this.e2,this.e3),s=Proj4js.common.adjust_lon(this.long0+n/this.ns);e.x=s;e.y=a;return e},phi3z:function(e,t,r,n,i){var a,s;a=e;for(var o=0;15>o;o++){s=(e+r*Math.sin(2*a)-n*Math.sin(4*a)+i*Math.sin(6*a))/t-a;a+=s;if(Math.abs(s)<=1e-10)return a}Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}};Proj4js.Proj.tmerc={init:function(){this.e0=Proj4js.common.e0fn(this.es);this.e1=Proj4js.common.e1fn(this.es);this.e2=Proj4js.common.e2fn(this.es);this.e3=Proj4js.common.e3fn(this.es);this.ml0=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,this.lat0)},forward:function(e){var t,r,n,i=e.x,a=e.y,s=Proj4js.common.adjust_lon(i-this.long0),o=Math.sin(a),l=Math.cos(a);if(this.sphere){var c=l*Math.sin(s);if(Math.abs(Math.abs(c)-1)<1e-10){Proj4js.reportError("tmerc:forward: Point projects into infinity");return 93}r=.5*this.a*this.k0*Math.log((1+c)/(1-c));t=Math.acos(l*Math.cos(s)/Math.sqrt(1-c*c));0>a&&(t=-t);n=this.a*this.k0*(t-this.lat0)}else{var u=l*s,p=Math.pow(u,2),h=this.ep2*Math.pow(l,2),d=Math.tan(a),f=Math.pow(d,2);t=1-this.es*Math.pow(o,2);var m=this.a/Math.sqrt(t),y=this.a*Proj4js.common.mlfn(this.e0,this.e1,this.e2,this.e3,a);r=this.k0*m*u*(1+p/6*(1-f+h+p/20*(5-18*f+Math.pow(f,2)+72*h-58*this.ep2)))+this.x0;n=this.k0*(y-this.ml0+m*d*p*(.5+p/24*(5-f+9*h+4*Math.pow(h,2)+p/30*(61-58*f+Math.pow(f,2)+600*h-330*this.ep2))))+this.y0}e.x=r;e.y=n;return e},inverse:function(e){var t,r,n,i,a,s,o=6;if(this.sphere){var l=Math.exp(e.x/(this.a*this.k0)),c=.5*(l-1/l),u=this.lat0+e.y/(this.a*this.k0),p=Math.cos(u);t=Math.sqrt((1-p*p)/(1+c*c));a=Proj4js.common.asinz(t);0>u&&(a=-a);s=0==c&&0==p?this.long0:Proj4js.common.adjust_lon(Math.atan2(c,p)+this.long0)}else{var h=e.x-this.x0,d=e.y-this.y0;t=(this.ml0+d/this.k0)/this.a;r=t;for(i=0;!0;i++){n=(t+this.e1*Math.sin(2*r)-this.e2*Math.sin(4*r)+this.e3*Math.sin(6*r))/this.e0-r;r+=n;if(Math.abs(n)<=Proj4js.common.EPSLN)break;if(i>=o){Proj4js.reportError("tmerc:inverse: Latitude failed to converge");return 95}}if(Math.abs(r)<Proj4js.common.HALF_PI){var f=Math.sin(r),m=Math.cos(r),y=Math.tan(r),g=this.ep2*Math.pow(m,2),v=Math.pow(g,2),C=Math.pow(y,2),T=Math.pow(C,2);t=1-this.es*Math.pow(f,2);var L=this.a/Math.sqrt(t),w=L*(1-this.es)/t,b=h/(L*this.k0),S=Math.pow(b,2);a=r-L*y*S/w*(.5-S/24*(5+3*C+10*g-4*v-9*this.ep2-S/30*(61+90*C+298*g+45*T-252*this.ep2-3*v)));s=Proj4js.common.adjust_lon(this.long0+b*(1-S/6*(1+2*C+g-S/20*(5-2*g+28*C-3*v+8*this.ep2+24*T)))/m)}else{a=Proj4js.common.HALF_PI*Proj4js.common.sign(d);s=this.long0}}e.x=s;e.y=a;return e}};Proj4js.defs.GOOGLE="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";Proj4js.defs["EPSG:900913"]=Proj4js.defs.GOOGLE;Proj4js.Proj.gstmerc={init:function(){var e=this.b/this.a;this.e=Math.sqrt(1-e*e);this.lc=this.long0;this.rs=Math.sqrt(1+this.e*this.e*Math.pow(Math.cos(this.lat0),4)/(1-this.e*this.e));var t=Math.sin(this.lat0),r=Math.asin(t/this.rs),n=Math.sin(r);this.cp=Proj4js.common.latiso(0,r,n)-this.rs*Proj4js.common.latiso(this.e,this.lat0,t);this.n2=this.k0*this.a*Math.sqrt(1-this.e*this.e)/(1-this.e*this.e*t*t);this.xs=this.x0;this.ys=this.y0-this.n2*r;this.title||(this.title="Gauss Schreiber transverse mercator")},forward:function(e){var t=e.x,r=e.y,n=this.rs*(t-this.lc),i=this.cp+this.rs*Proj4js.common.latiso(this.e,r,Math.sin(r)),a=Math.asin(Math.sin(n)/Proj4js.common.cosh(i)),s=Proj4js.common.latiso(0,a,Math.sin(a));e.x=this.xs+this.n2*s;e.y=this.ys+this.n2*Math.atan(Proj4js.common.sinh(i)/Math.cos(n));return e},inverse:function(e){var t=e.x,r=e.y,n=Math.atan(Proj4js.common.sinh((t-this.xs)/this.n2)/Math.cos((r-this.ys)/this.n2)),i=Math.asin(Math.sin((r-this.ys)/this.n2)/Proj4js.common.cosh((t-this.xs)/this.n2)),a=Proj4js.common.latiso(0,i,Math.sin(i));e.x=this.lc+n/this.rs;e.y=Proj4js.common.invlatiso(this.e,(a-this.cp)/this.rs);return e}};Proj4js.Proj.ortho={init:function(e){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0)},forward:function(e){var t,r,n,i,a,s,o=e.x,l=e.y;n=Proj4js.common.adjust_lon(o-this.long0);t=Math.sin(l);r=Math.cos(l);i=Math.cos(n);s=this.sin_p14*t+this.cos_p14*r*i;a=1;if(s>0||Math.abs(s)<=Proj4js.common.EPSLN)var c=this.a*a*r*Math.sin(n),u=this.y0+this.a*a*(this.cos_p14*t-this.sin_p14*r*i);else Proj4js.reportError("orthoFwdPointError");e.x=c;e.y=u;return e},inverse:function(e){var t,r,n,i,a,s,o;e.x-=this.x0;e.y-=this.y0;t=Math.sqrt(e.x*e.x+e.y*e.y);t>this.a+1e-7&&Proj4js.reportError("orthoInvDataError");r=Proj4js.common.asinz(t/this.a);n=Math.sin(r);i=Math.cos(r);s=this.long0;Math.abs(t)<=Proj4js.common.EPSLN&&(o=this.lat0);o=Proj4js.common.asinz(i*this.sin_p14+e.y*n*this.cos_p14/t);a=Math.abs(this.lat0)-Proj4js.common.HALF_PI;Math.abs(a)<=Proj4js.common.EPSLN&&(s=Proj4js.common.adjust_lon(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y)));a=i-this.sin_p14*Math.sin(o);e.x=s;e.y=o;return e}};Proj4js.Proj.krovak={init:function(){this.a=6377397.155;this.es=.006674372230614;this.e=Math.sqrt(this.es);this.lat0||(this.lat0=.863937979737193);this.long0||(this.long0=.4334234309119251);this.k0||(this.k0=.9999);this.s45=.785398163397448;this.s90=2*this.s45;this.fi0=this.lat0;this.e2=this.es;this.e=Math.sqrt(this.e2);this.alfa=Math.sqrt(1+this.e2*Math.pow(Math.cos(this.fi0),4)/(1-this.e2));this.uq=1.04216856380474;this.u0=Math.asin(Math.sin(this.fi0)/this.alfa);this.g=Math.pow((1+this.e*Math.sin(this.fi0))/(1-this.e*Math.sin(this.fi0)),this.alfa*this.e/2);this.k=Math.tan(this.u0/2+this.s45)/Math.pow(Math.tan(this.fi0/2+this.s45),this.alfa)*this.g;this.k1=this.k0;this.n0=this.a*Math.sqrt(1-this.e2)/(1-this.e2*Math.pow(Math.sin(this.fi0),2));this.s0=1.37008346281555;this.n=Math.sin(this.s0);this.ro0=this.k1*this.n0/Math.tan(this.s0);this.ad=this.s90-this.uq},forward:function(e){var t,r,n,i,a,s,o,l=e.x,c=e.y,u=Proj4js.common.adjust_lon(l-this.long0);t=Math.pow((1+this.e*Math.sin(c))/(1-this.e*Math.sin(c)),this.alfa*this.e/2);r=2*(Math.atan(this.k*Math.pow(Math.tan(c/2+this.s45),this.alfa)/t)-this.s45);n=-u*this.alfa;i=Math.asin(Math.cos(this.ad)*Math.sin(r)+Math.sin(this.ad)*Math.cos(r)*Math.cos(n));a=Math.asin(Math.cos(r)*Math.sin(n)/Math.cos(i));s=this.n*a;o=this.ro0*Math.pow(Math.tan(this.s0/2+this.s45),this.n)/Math.pow(Math.tan(i/2+this.s45),this.n);e.y=o*Math.cos(s)/1;e.x=o*Math.sin(s)/1;if(this.czech){e.y*=-1;e.x*=-1}return e},inverse:function(e){var t,r,n,i,a,s,o,l,c=e.x;e.x=e.y;e.y=c;if(this.czech){e.y*=-1;e.x*=-1}s=Math.sqrt(e.x*e.x+e.y*e.y);a=Math.atan2(e.y,e.x);i=a/Math.sin(this.s0);n=2*(Math.atan(Math.pow(this.ro0/s,1/this.n)*Math.tan(this.s0/2+this.s45))-this.s45);t=Math.asin(Math.cos(this.ad)*Math.sin(n)-Math.sin(this.ad)*Math.cos(n)*Math.cos(i));r=Math.asin(Math.cos(n)*Math.sin(i)/Math.cos(t));e.x=this.long0-r/this.alfa;o=t;l=0;var u=0;do{e.y=2*(Math.atan(Math.pow(this.k,-1/this.alfa)*Math.pow(Math.tan(t/2+this.s45),1/this.alfa)*Math.pow((1+this.e*Math.sin(o))/(1-this.e*Math.sin(o)),this.e/2))-this.s45);Math.abs(o-e.y)<1e-10&&(l=1);o=e.y;u+=1}while(0==l&&15>u);if(u>=15){Proj4js.reportError("PHI3Z-CONV:Latitude failed to converge after 15 iterations");return null}return e}};Proj4js.Proj.somerc={init:function(){var e=this.lat0;this.lambda0=this.long0;var t=Math.sin(e),r=this.a,n=this.rf,i=1/n,a=2*i-Math.pow(i,2),s=this.e=Math.sqrt(a);this.R=this.k0*r*Math.sqrt(1-a)/(1-a*Math.pow(t,2));this.alpha=Math.sqrt(1+a/(1-a)*Math.pow(Math.cos(e),4));this.b0=Math.asin(t/this.alpha);this.K=Math.log(Math.tan(Math.PI/4+this.b0/2))-this.alpha*Math.log(Math.tan(Math.PI/4+e/2))+this.alpha*s/2*Math.log((1+s*t)/(1-s*t))},forward:function(e){var t=Math.log(Math.tan(Math.PI/4-e.y/2)),r=this.e/2*Math.log((1+this.e*Math.sin(e.y))/(1-this.e*Math.sin(e.y))),n=-this.alpha*(t+r)+this.K,i=2*(Math.atan(Math.exp(n))-Math.PI/4),a=this.alpha*(e.x-this.lambda0),s=Math.atan(Math.sin(a)/(Math.sin(this.b0)*Math.tan(i)+Math.cos(this.b0)*Math.cos(a))),o=Math.asin(Math.cos(this.b0)*Math.sin(i)-Math.sin(this.b0)*Math.cos(i)*Math.cos(a));e.y=this.R/2*Math.log((1+Math.sin(o))/(1-Math.sin(o)))+this.y0;e.x=this.R*s+this.x0;return e},inverse:function(e){for(var t=e.x-this.x0,r=e.y-this.y0,n=t/this.R,i=2*(Math.atan(Math.exp(r/this.R))-Math.PI/4),a=Math.asin(Math.cos(this.b0)*Math.sin(i)+Math.sin(this.b0)*Math.cos(i)*Math.cos(n)),s=Math.atan(Math.sin(n)/(Math.cos(this.b0)*Math.cos(n)-Math.sin(this.b0)*Math.tan(i))),o=this.lambda0+s/this.alpha,l=0,c=a,u=-1e3,p=0;Math.abs(c-u)>1e-7;){if(++p>20){Proj4js.reportError("omercFwdInfinity");return}l=1/this.alpha*(Math.log(Math.tan(Math.PI/4+a/2))-this.K)+this.e*Math.log(Math.tan(Math.PI/4+Math.asin(this.e*Math.sin(c))/2));u=c;c=2*Math.atan(Math.exp(l))-Math.PI/2}e.x=o;e.y=c;return e}};Proj4js.Proj.stere={ssfn_:function(e,t,r){t*=r;return Math.tan(.5*(Proj4js.common.HALF_PI+e))*Math.pow((1-t)/(1+t),.5*r)},TOL:1e-8,NITER:8,CONV:1e-10,S_POLE:0,N_POLE:1,OBLIQ:2,EQUIT:3,init:function(){this.phits=this.lat_ts?this.lat_ts:Proj4js.common.HALF_PI;var e=Math.abs(this.lat0);this.mode=Math.abs(e)-Proj4js.common.HALF_PI<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:e>Proj4js.common.EPSLN?this.OBLIQ:this.EQUIT;this.phits=Math.abs(this.phits);if(this.es){var t;switch(this.mode){case this.N_POLE:case this.S_POLE:if(Math.abs(this.phits-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN)this.akm1=2*this.k0/Math.sqrt(Math.pow(1+this.e,1+this.e)*Math.pow(1-this.e,1-this.e));else{e=Math.sin(this.phits);this.akm1=Math.cos(this.phits)/Proj4js.common.tsfnz(this.e,this.phits,e);e*=this.e;this.akm1/=Math.sqrt(1-e*e)}break;case this.EQUIT:this.akm1=2*this.k0;break;case this.OBLIQ:e=Math.sin(this.lat0);t=2*Math.atan(this.ssfn_(this.lat0,e,this.e))-Proj4js.common.HALF_PI;e*=this.e;this.akm1=2*this.k0*Math.cos(this.lat0)/Math.sqrt(1-e*e);this.sinX1=Math.sin(t);this.cosX1=Math.cos(t)}}else switch(this.mode){case this.OBLIQ:this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0);case this.EQUIT:this.akm1=2*this.k0;break;case this.S_POLE:case this.N_POLE:this.akm1=Math.abs(this.phits-Proj4js.common.HALF_PI)>=Proj4js.common.EPSLN?Math.cos(this.phits)/Math.tan(Proj4js.common.FORTPI-.5*this.phits):2*this.k0}},forward:function(e){var t=e.x;t=Proj4js.common.adjust_lon(t-this.long0);var r,n,i=e.y;if(this.sphere){var a,s,o,l;a=Math.sin(i);s=Math.cos(i);o=Math.cos(t);l=Math.sin(t);switch(this.mode){case this.EQUIT:n=1+s*o;n<=Proj4js.common.EPSLN&&Proj4js.reportError("stere:forward:Equit");n=this.akm1/n;r=n*s*l;n*=a;break;case this.OBLIQ:n=1+this.sinph0*a+this.cosph0*s*o;n<=Proj4js.common.EPSLN&&Proj4js.reportError("stere:forward:Obliq");n=this.akm1/n;r=n*s*l;n*=this.cosph0*a-this.sinph0*s*o;break;case this.N_POLE:o=-o;i=-i;case this.S_POLE:Math.abs(i-Proj4js.common.HALF_PI)<this.TOL&&Proj4js.reportError("stere:forward:S_POLE");n=this.akm1*Math.tan(Proj4js.common.FORTPI+.5*i);r=l*n;n*=o}}else{o=Math.cos(t);l=Math.sin(t);a=Math.sin(i);var c,u;if(this.mode==this.OBLIQ||this.mode==this.EQUIT){var p=2*Math.atan(this.ssfn_(i,a,this.e));c=Math.sin(p-Proj4js.common.HALF_PI);u=Math.cos(p)}switch(this.mode){case this.OBLIQ:var h=this.akm1/(this.cosX1*(1+this.sinX1*c+this.cosX1*u*o));n=h*(this.cosX1*c-this.sinX1*u*o);r=h*u;break;case this.EQUIT:var h=2*this.akm1/(1+u*o);n=h*c;r=h*u;break;case this.S_POLE:i=-i;o=-o;a=-a;case this.N_POLE:r=this.akm1*Proj4js.common.tsfnz(this.e,i,a);n=-r*o}r*=l}e.x=r*this.a+this.x0;e.y=n*this.a+this.y0;return e},inverse:function(e){var t,r,n,i,a,s,o=(e.x-this.x0)/this.a,l=(e.y-this.y0)/this.a,c=0,u=0,p=0,h=0;if(this.sphere){var d,f,m,y;f=Math.sqrt(o*o+l*l);d=2*Math.atan(f/this.akm1);m=Math.sin(d);y=Math.cos(d);t=0;switch(this.mode){case this.EQUIT:r=Math.abs(f)<=Proj4js.common.EPSLN?0:Math.asin(l*m/f);(0!=y||0!=o)&&(t=Math.atan2(o*m,y*f));break;case this.OBLIQ:r=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(y*this.sinph0+l*m*this.cosph0/f);d=y-this.sinph0*Math.sin(r);(0!=d||0!=o)&&(t=Math.atan2(o*m*this.cosph0,d*f));break;case this.N_POLE:l=-l;case this.S_POLE:r=Math.abs(f)<=Proj4js.common.EPSLN?this.phi0:Math.asin(this.mode==this.S_POLE?-y:y);t=0==o&&0==l?0:Math.atan2(o,l)}e.x=Proj4js.common.adjust_lon(t+this.long0);e.y=r}else{a=Math.sqrt(o*o+l*l);switch(this.mode){case this.OBLIQ:case this.EQUIT:c=2*Math.atan2(a*this.cosX1,this.akm1);n=Math.cos(c);i=Math.sin(c);u=Math.asin(0==a?n*this.sinX1:n*this.sinX1+l*i*this.cosX1/a);c=Math.tan(.5*(Proj4js.common.HALF_PI+u));o*=i;l=a*this.cosX1*n-l*this.sinX1*i;h=Proj4js.common.HALF_PI;p=.5*this.e;break;case this.N_POLE:l=-l;case this.S_POLE:c=-a/this.akm1;u=Proj4js.common.HALF_PI-2*Math.atan(c);h=-Proj4js.common.HALF_PI;p=-.5*this.e}for(s=this.NITER;s--;u=r){i=this.e*Math.sin(u);r=2*Math.atan(c*Math.pow((1+i)/(1-i),p))-h;if(Math.abs(u-r)<this.CONV){this.mode==this.S_POLE&&(r=-r);t=0==o&&0==l?0:Math.atan2(o,l);e.x=Proj4js.common.adjust_lon(t+this.long0);e.y=r;return e}}}}};Proj4js.Proj.nzmg={iterations:1,init:function(){this.A=new Array;this.A[1]=.6399175073;this.A[2]=-.1358797613;this.A[3]=.063294409;this.A[4]=-.02526853;this.A[5]=.0117879;this.A[6]=-.0055161;this.A[7]=.0026906;this.A[8]=-.001333;this.A[9]=67e-5;this.A[10]=-34e-5;this.B_re=new Array;this.B_im=new Array;this.B_re[1]=.7557853228;this.B_im[1]=0;this.B_re[2]=.249204646;this.B_im[2]=.003371507;this.B_re[3]=-.001541739;this.B_im[3]=.04105856;this.B_re[4]=-.10162907;this.B_im[4]=.01727609;this.B_re[5]=-.26623489;this.B_im[5]=-.36249218;this.B_re[6]=-.6870983;this.B_im[6]=-1.1651967;this.C_re=new Array;this.C_im=new Array;this.C_re[1]=1.3231270439;this.C_im[1]=0;this.C_re[2]=-.577245789;this.C_im[2]=-.007809598;this.C_re[3]=.508307513;this.C_im[3]=-.112208952;this.C_re[4]=-.15094762;this.C_im[4]=.18200602;this.C_re[5]=1.01418179;this.C_im[5]=1.64497696;this.C_re[6]=1.9660549;this.C_im[6]=2.5127645;this.D=new Array;this.D[1]=1.5627014243;this.D[2]=.5185406398;this.D[3]=-.03333098;this.D[4]=-.1052906;this.D[5]=-.0368594;this.D[6]=.007317;this.D[7]=.0122;this.D[8]=.00394;this.D[9]=-.0013},forward:function(e){for(var t=e.x,r=e.y,n=r-this.lat0,i=t-this.long0,a=n/Proj4js.common.SEC_TO_RAD*1e-5,s=i,o=1,l=0,c=1;10>=c;c++){o*=a;l+=this.A[c]*o}for(var u,p,h=l,d=s,f=1,m=0,y=0,g=0,c=1;6>=c;c++){u=f*h-m*d;p=m*h+f*d;f=u;m=p;y=y+this.B_re[c]*f-this.B_im[c]*m;g=g+this.B_im[c]*f+this.B_re[c]*m}e.x=g*this.a+this.x0;e.y=y*this.a+this.y0;return e},inverse:function(e){for(var t,r,n=e.x,i=e.y,a=n-this.x0,s=i-this.y0,o=s/this.a,l=a/this.a,c=1,u=0,p=0,h=0,d=1;6>=d;d++){t=c*o-u*l;r=u*o+c*l;c=t;u=r;p=p+this.C_re[d]*c-this.C_im[d]*u;h=h+this.C_im[d]*c+this.C_re[d]*u}for(var f=0;f<this.iterations;f++){for(var m,y,g=p,v=h,C=o,T=l,d=2;6>=d;d++){m=g*p-v*h;y=v*p+g*h;g=m;v=y;C+=(d-1)*(this.B_re[d]*g-this.B_im[d]*v);T+=(d-1)*(this.B_im[d]*g+this.B_re[d]*v)}g=1;v=0;for(var L=this.B_re[1],w=this.B_im[1],d=2;6>=d;d++){m=g*p-v*h;y=v*p+g*h;g=m;v=y;L+=d*(this.B_re[d]*g-this.B_im[d]*v);w+=d*(this.B_im[d]*g+this.B_re[d]*v)}var b=L*L+w*w;p=(C*L+T*w)/b;h=(T*L-C*w)/b}for(var S=p,E=h,O=1,A=0,d=1;9>=d;d++){O*=S;A+=this.D[d]*O}var x=this.lat0+A*Proj4js.common.SEC_TO_RAD*1e5,P=this.long0+E;e.x=P;e.y=x;return e}};Proj4js.Proj.mill={init:function(){},forward:function(e){var t=e.x,r=e.y,n=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*n,a=this.y0+this.a*Math.log(Math.tan(Proj4js.common.PI/4+r/2.5))*1.25;e.x=i;e.y=a;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a),r=2.5*(Math.atan(Math.exp(.8*e.y/this.a))-Proj4js.common.PI/4);e.x=t;e.y=r;return e}};Proj4js.Proj.gnom={init:function(e){this.sin_p14=Math.sin(this.lat0);this.cos_p14=Math.cos(this.lat0);this.infinity_dist=1e3*this.a;this.rc=1},forward:function(e){var t,r,n,i,a,s,o,l,c=e.x,u=e.y;n=Proj4js.common.adjust_lon(c-this.long0);t=Math.sin(u);r=Math.cos(u);i=Math.cos(n);s=this.sin_p14*t+this.cos_p14*r*i;a=1;if(s>0||Math.abs(s)<=Proj4js.common.EPSLN){o=this.x0+this.a*a*r*Math.sin(n)/s;l=this.y0+this.a*a*(this.cos_p14*t-this.sin_p14*r*i)/s}else{Proj4js.reportError("orthoFwdPointError");o=this.x0+this.infinity_dist*r*Math.sin(n);l=this.y0+this.infinity_dist*(this.cos_p14*t-this.sin_p14*r*i)}e.x=o;e.y=l;return e},inverse:function(e){var t,r,n,i,a,s;e.x=(e.x-this.x0)/this.a;e.y=(e.y-this.y0)/this.a;e.x/=this.k0;e.y/=this.k0;if(t=Math.sqrt(e.x*e.x+e.y*e.y)){i=Math.atan2(t,this.rc);r=Math.sin(i);n=Math.cos(i);s=Proj4js.common.asinz(n*this.sin_p14+e.y*r*this.cos_p14/t);a=Math.atan2(e.x*r,t*this.cos_p14*n-e.y*this.sin_p14*r);a=Proj4js.common.adjust_lon(this.long0+a)}else{s=this.phic0;a=0}e.x=a;e.y=s;return e}};Proj4js.Proj.sinu={init:function(){if(this.sphere){this.n=1;this.m=0;this.es=0;this.C_y=Math.sqrt((this.m+1)/this.n);this.C_x=this.C_y/(this.m+1)}else this.en=Proj4js.common.pj_enfn(this.es)},forward:function(e){var t,r,n=e.x,i=e.y;n=Proj4js.common.adjust_lon(n-this.long0);if(this.sphere){if(this.m)for(var a=this.n*Math.sin(i),s=Proj4js.common.MAX_ITER;s;--s){var o=(this.m*i+Math.sin(i)-a)/(this.m+Math.cos(i));i-=o;if(Math.abs(o)<Proj4js.common.EPSLN)break}else i=1!=this.n?Math.asin(this.n*Math.sin(i)):i;t=this.a*this.C_x*n*(this.m+Math.cos(i));r=this.a*this.C_y*i}else{var l=Math.sin(i),c=Math.cos(i);r=this.a*Proj4js.common.pj_mlfn(i,l,c,this.en);t=this.a*n*c/Math.sqrt(1-this.es*l*l)}e.x=t;e.y=r;return e},inverse:function(e){var t,r,n;e.x-=this.x0;e.y-=this.y0;t=e.y/this.a;if(this.sphere){e.y/=this.C_y;t=this.m?Math.asin((this.m*e.y+Math.sin(e.y))/this.n):1!=this.n?Math.asin(Math.sin(e.y)/this.n):e.y;n=e.x/(this.C_x*(this.m+Math.cos(e.y)))}else{t=Proj4js.common.pj_inv_mlfn(e.y/this.a,this.es,this.en);var i=Math.abs(t);if(i<Proj4js.common.HALF_PI){i=Math.sin(t);r=this.long0+e.x*Math.sqrt(1-this.es*i*i)/(this.a*Math.cos(t));n=Proj4js.common.adjust_lon(r)}else i-Proj4js.common.EPSLN<Proj4js.common.HALF_PI&&(n=this.long0)}e.x=n;e.y=t;return e}};Proj4js.Proj.vandg={init:function(){this.R=6370997},forward:function(e){var t,r,n=e.x,i=e.y,a=Proj4js.common.adjust_lon(n-this.long0);if(Math.abs(i)<=Proj4js.common.EPSLN){t=this.x0+this.R*a;r=this.y0}var s=Proj4js.common.asinz(2*Math.abs(i/Proj4js.common.PI));if(Math.abs(a)<=Proj4js.common.EPSLN||Math.abs(Math.abs(i)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN){t=this.x0;r=i>=0?this.y0+Proj4js.common.PI*this.R*Math.tan(.5*s):this.y0+Proj4js.common.PI*this.R*-Math.tan(.5*s)}var o=.5*Math.abs(Proj4js.common.PI/a-a/Proj4js.common.PI),l=o*o,c=Math.sin(s),u=Math.cos(s),p=u/(c+u-1),h=p*p,d=p*(2/c-1),f=d*d,m=Proj4js.common.PI*this.R*(o*(p-f)+Math.sqrt(l*(p-f)*(p-f)-(f+l)*(h-f)))/(f+l);0>a&&(m=-m);t=this.x0+m;m=Math.abs(m/(Proj4js.common.PI*this.R));r=i>=0?this.y0+Proj4js.common.PI*this.R*Math.sqrt(1-m*m-2*o*m):this.y0-Proj4js.common.PI*this.R*Math.sqrt(1-m*m-2*o*m);e.x=t;e.y=r;return e},inverse:function(e){var t,r,n,i,a,s,o,l,c,u,p,h,d;e.x-=this.x0;e.y-=this.y0;p=Proj4js.common.PI*this.R;n=e.x/p;i=e.y/p;a=n*n+i*i;s=-Math.abs(i)*(1+a);o=s-2*i*i+n*n;l=-2*s+1+2*i*i+a*a;d=i*i/l+(2*o*o*o/l/l/l-9*s*o/l/l)/27;c=(s-o*o/3/l)/l;u=2*Math.sqrt(-c/3);p=3*d/c/u;Math.abs(p)>1&&(p=p>=0?1:-1);h=Math.acos(p)/3;r=e.y>=0?(-u*Math.cos(h+Proj4js.common.PI/3)-o/3/l)*Proj4js.common.PI:-(-u*Math.cos(h+Proj4js.common.PI/3)-o/3/l)*Proj4js.common.PI;Math.abs(n)<Proj4js.common.EPSLN&&(t=this.long0);t=Proj4js.common.adjust_lon(this.long0+Proj4js.common.PI*(a-1+Math.sqrt(1+2*(n*n-i*i)+a*a))/2/n);e.x=t;e.y=r;return e}};Proj4js.Proj.cea={init:function(){},forward:function(e){var t=e.x,r=e.y,n=Proj4js.common.adjust_lon(t-this.long0),i=this.x0+this.a*n*Math.cos(this.lat_ts),a=this.y0+this.a*Math.sin(r)/Math.cos(this.lat_ts);e.x=i;e.y=a;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Proj4js.common.adjust_lon(this.long0+e.x/this.a/Math.cos(this.lat_ts)),r=Math.asin(e.y/this.a*Math.cos(this.lat_ts));e.x=t;e.y=r;return e}};Proj4js.Proj.eqc={init:function(){this.x0||(this.x0=0);this.y0||(this.y0=0);this.lat0||(this.lat0=0);this.long0||(this.long0=0);this.lat_ts||(this.lat_ts=0);this.title||(this.title="Equidistant Cylindrical (Plate Carre)");this.rc=Math.cos(this.lat_ts)},forward:function(e){var t=e.x,r=e.y,n=Proj4js.common.adjust_lon(t-this.long0),i=Proj4js.common.adjust_lat(r-this.lat0);e.x=this.x0+this.a*n*this.rc;e.y=this.y0+this.a*i;return e},inverse:function(e){var t=e.x,r=e.y;e.x=Proj4js.common.adjust_lon(this.long0+(t-this.x0)/(this.a*this.rc));e.y=Proj4js.common.adjust_lat(this.lat0+(r-this.y0)/this.a);return e}};Proj4js.Proj.cass={init:function(){if(!this.sphere){this.en=Proj4js.common.pj_enfn(this.es);this.m0=Proj4js.common.pj_mlfn(this.lat0,Math.sin(this.lat0),Math.cos(this.lat0),this.en)}},C1:.16666666666666666,C2:.008333333333333333,C3:.041666666666666664,C4:.3333333333333333,C5:.06666666666666667,forward:function(e){var t,r,n=e.x,i=e.y;n=Proj4js.common.adjust_lon(n-this.long0);if(this.sphere){t=Math.asin(Math.cos(i)*Math.sin(n));r=Math.atan2(Math.tan(i),Math.cos(n))-this.phi0}else{this.n=Math.sin(i);this.c=Math.cos(i);r=Proj4js.common.pj_mlfn(i,this.n,this.c,this.en);this.n=1/Math.sqrt(1-this.es*this.n*this.n);this.tn=Math.tan(i);this.t=this.tn*this.tn;this.a1=n*this.c;this.c*=this.es*this.c/(1-this.es);this.a2=this.a1*this.a1;t=this.n*this.a1*(1-this.a2*this.t*(this.C1-(8-this.t+8*this.c)*this.a2*this.C2));r-=this.m0-this.n*this.tn*this.a2*(.5+(5-this.t+6*this.c)*this.a2*this.C3)}e.x=this.a*t+this.x0;e.y=this.a*r+this.y0;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t,r,n=e.x/this.a,i=e.y/this.a;if(this.sphere){this.dd=i+this.lat0;t=Math.asin(Math.sin(this.dd)*Math.cos(n));r=Math.atan2(Math.tan(n),Math.cos(this.dd))}else{var a=Proj4js.common.pj_inv_mlfn(this.m0+i,this.es,this.en);this.tn=Math.tan(a);this.t=this.tn*this.tn;this.n=Math.sin(a);this.r=1/(1-this.es*this.n*this.n);this.n=Math.sqrt(this.r);this.r*=(1-this.es)*this.n;this.dd=n/this.n;this.d2=this.dd*this.dd;t=a-this.n*this.tn/this.r*this.d2*(.5-(1+3*this.t)*this.d2*this.C3);r=this.dd*(1+this.t*this.d2*(-this.C4+(1+3*this.t)*this.d2*this.C5))/Math.cos(a)}e.x=Proj4js.common.adjust_lon(this.long0+r);e.y=t;return e}};Proj4js.Proj.gauss={init:function(){var e=Math.sin(this.lat0),t=Math.cos(this.lat0);t*=t;this.rc=Math.sqrt(1-this.es)/(1-this.es*e*e);this.C=Math.sqrt(1+this.es*t*t/(1-this.es));this.phic0=Math.asin(e/this.C);this.ratexp=.5*this.C*this.e;this.K=Math.tan(.5*this.phic0+Proj4js.common.FORTPI)/(Math.pow(Math.tan(.5*this.lat0+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*e,this.ratexp))},forward:function(e){var t=e.x,r=e.y;e.y=2*Math.atan(this.K*Math.pow(Math.tan(.5*r+Proj4js.common.FORTPI),this.C)*Proj4js.common.srat(this.e*Math.sin(r),this.ratexp))-Proj4js.common.HALF_PI;e.x=this.C*t;return e},inverse:function(e){for(var t=1e-14,r=e.x/this.C,n=e.y,i=Math.pow(Math.tan(.5*n+Proj4js.common.FORTPI)/this.K,1/this.C),a=Proj4js.common.MAX_ITER;a>0;--a){n=2*Math.atan(i*Proj4js.common.srat(this.e*Math.sin(e.y),-.5*this.e))-Proj4js.common.HALF_PI;

if(Math.abs(n-e.y)<t)break;e.y=n}if(!a){Proj4js.reportError("gauss:inverse:convergence failed");return null}e.x=r;e.y=n;return e}};Proj4js.Proj.omerc={init:function(){this.mode||(this.mode=0);if(!this.lon1){this.lon1=0;this.mode=1}this.lon2||(this.lon2=0);this.lat2||(this.lat2=0);{var e=this.b/this.a,t=1-Math.pow(e,2);Math.sqrt(t)}this.sin_p20=Math.sin(this.lat0);this.cos_p20=Math.cos(this.lat0);this.con=1-this.es*this.sin_p20*this.sin_p20;this.com=Math.sqrt(1-t);this.bl=Math.sqrt(1+this.es*Math.pow(this.cos_p20,4)/(1-t));this.al=this.a*this.bl*this.k0*this.com/this.con;if(Math.abs(this.lat0)<Proj4js.common.EPSLN){this.ts=1;this.d=1;this.el=1}else{this.ts=Proj4js.common.tsfnz(this.e,this.lat0,this.sin_p20);this.con=Math.sqrt(this.con);this.d=this.bl*this.com/(this.cos_p20*this.con);this.f=this.d*this.d-1>0?this.lat0>=0?this.d+Math.sqrt(this.d*this.d-1):this.d-Math.sqrt(this.d*this.d-1):this.d;this.el=this.f*Math.pow(this.ts,this.bl)}if(0!=this.mode){this.g=.5*(this.f-1/this.f);this.gama=Proj4js.common.asinz(Math.sin(this.alpha)/this.d);this.longc=this.longc-Proj4js.common.asinz(this.g*Math.tan(this.gama))/this.bl;this.con=Math.abs(this.lat0);if(this.con>Proj4js.common.EPSLN&&Math.abs(this.con-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){this.singam=Math.sin(this.gama);this.cosgam=Math.cos(this.gama);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}else Proj4js.reportError("omerc:Init:DataError")}else{this.sinphi=Math.sin(this.at1);this.ts1=Proj4js.common.tsfnz(this.e,this.lat1,this.sinphi);this.sinphi=Math.sin(this.lat2);this.ts2=Proj4js.common.tsfnz(this.e,this.lat2,this.sinphi);this.h=Math.pow(this.ts1,this.bl);this.l=Math.pow(this.ts2,this.bl);this.f=this.el/this.h;this.g=.5*(this.f-1/this.f);this.j=(this.el*this.el-this.l*this.h)/(this.el*this.el+this.l*this.h);this.p=(this.l-this.h)/(this.l+this.h);this.dlon=this.lon1-this.lon2;this.dlon<-Proj4js.common.PI&&(this.lon2=this.lon2-2*Proj4js.common.PI);this.dlon>Proj4js.common.PI&&(this.lon2=this.lon2+2*Proj4js.common.PI);this.dlon=this.lon1-this.lon2;this.longc=.5*(this.lon1+this.lon2)-Math.atan(this.j*Math.tan(.5*this.bl*this.dlon)/this.p)/this.bl;this.dlon=Proj4js.common.adjust_lon(this.lon1-this.longc);this.gama=Math.atan(Math.sin(this.bl*this.dlon)/this.g);this.alpha=Proj4js.common.asinz(this.d*Math.sin(this.gama));Math.abs(this.lat1-this.lat2)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):this.con=Math.abs(this.lat1);this.con<=Proj4js.common.EPSLN||Math.abs(this.con-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN?Proj4js.reportError("omercInitDataError"):Math.abs(Math.abs(this.lat0)-Proj4js.common.HALF_PI)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercInitDataError");this.singam=Math.sin(this.gam);this.cosgam=Math.cos(this.gam);this.sinaz=Math.sin(this.alpha);this.cosaz=Math.cos(this.alpha);this.u=this.lat0>=0?this.al/this.bl*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz):-(this.al/this.bl)*Math.atan(Math.sqrt(this.d*this.d-1)/this.cosaz)}},forward:function(e){var t,r,n,i,a,s,o,l,c,u,p,h=e.x,d=e.y;t=Math.sin(d);u=Proj4js.common.adjust_lon(h-this.longc);s=Math.sin(this.bl*u);if(Math.abs(Math.abs(d)-Proj4js.common.HALF_PI)>Proj4js.common.EPSLN){p=Proj4js.common.tsfnz(this.e,d,t);i=this.el/Math.pow(p,this.bl);c=.5*(i-1/i);r=.5*(i+1/i);o=(c*this.singam-s*this.cosgam)/r;n=Math.cos(this.bl*u);if(Math.abs(n)<1e-7)a=this.al*this.bl*u;else{a=this.al*Math.atan((c*this.cosgam+s*this.singam)/n)/this.bl;0>n&&(a+=Proj4js.common.PI*this.al/this.bl)}}else{o=d>=0?this.singam:-this.singam;a=this.al*d/this.bl}Math.abs(Math.abs(o)-1)<=Proj4js.common.EPSLN&&Proj4js.reportError("omercFwdInfinity");l=.5*this.al*Math.log((1-o)/(1+o))/this.bl;a-=this.u;var f=this.x0+l*this.cosaz+a*this.sinaz,m=this.y0+a*this.cosaz-l*this.sinaz;e.x=f;e.y=m;return e},inverse:function(e){var t,r,n,i,a,s,o,l,c,u,p,h,d;e.x-=this.x0;e.y-=this.y0;d=0;i=e.x*this.cosaz-e.y*this.sinaz;a=e.y*this.cosaz+e.x*this.sinaz;a+=this.u;s=Math.exp(-this.bl*i/this.al);o=.5*(s-1/s);r=.5*(s+1/s);c=Math.sin(this.bl*a/this.al);u=(c*this.cosgam+o*this.singam)/r;if(Math.abs(Math.abs(u)-1)<=Proj4js.common.EPSLN){p=this.longc;h=u>=0?Proj4js.common.HALF_PI:-Proj4js.common.HALF_PI}else{n=1/this.bl;l=Math.pow(this.el/Math.sqrt((1+u)/(1-u)),n);h=Proj4js.common.phi2z(this.e,l);t=this.longc-Math.atan2(o*this.cosgam-c*this.singam,n)/this.bl;p=Proj4js.common.adjust_lon(t)}e.x=p;e.y=h;return e}};Proj4js.Proj.lcc={init:function(){this.lat2||(this.lat2=this.lat0);this.k0||(this.k0=1);if(Math.abs(this.lat1+this.lat2)<Proj4js.common.EPSLN)Proj4js.reportError("lcc:init: Equal Latitudes");else{var e=this.b/this.a;this.e=Math.sqrt(1-e*e);var t=Math.sin(this.lat1),r=Math.cos(this.lat1),n=Proj4js.common.msfnz(this.e,t,r),i=Proj4js.common.tsfnz(this.e,this.lat1,t),a=Math.sin(this.lat2),s=Math.cos(this.lat2),o=Proj4js.common.msfnz(this.e,a,s),l=Proj4js.common.tsfnz(this.e,this.lat2,a),c=Proj4js.common.tsfnz(this.e,this.lat0,Math.sin(this.lat0));this.ns=Math.abs(this.lat1-this.lat2)>Proj4js.common.EPSLN?Math.log(n/o)/Math.log(i/l):t;this.f0=n/(this.ns*Math.pow(i,this.ns));this.rh=this.a*this.f0*Math.pow(c,this.ns);this.title||(this.title="Lambert Conformal Conic")}},forward:function(e){var t=e.x,r=e.y;if(!(90>=r&&r>=-90&&180>=t&&t>=-180)){Proj4js.reportError("lcc:forward: llInputOutOfRange: "+t+" : "+r);return null}var n,i,a=Math.abs(Math.abs(r)-Proj4js.common.HALF_PI);if(a>Proj4js.common.EPSLN){n=Proj4js.common.tsfnz(this.e,r,Math.sin(r));i=this.a*this.f0*Math.pow(n,this.ns)}else{a=r*this.ns;if(0>=a){Proj4js.reportError("lcc:forward: No Projection");return null}i=0}var s=this.ns*Proj4js.common.adjust_lon(t-this.long0);e.x=this.k0*i*Math.sin(s)+this.x0;e.y=this.k0*(this.rh-i*Math.cos(s))+this.y0;return e},inverse:function(e){var t,r,n,i,a,s=(e.x-this.x0)/this.k0,o=this.rh-(e.y-this.y0)/this.k0;if(this.ns>0){t=Math.sqrt(s*s+o*o);r=1}else{t=-Math.sqrt(s*s+o*o);r=-1}var l=0;0!=t&&(l=Math.atan2(r*s,r*o));if(0!=t||this.ns>0){r=1/this.ns;n=Math.pow(t/(this.a*this.f0),r);i=Proj4js.common.phi2z(this.e,n);if(-9999==i)return null}else i=-Proj4js.common.HALF_PI;a=Proj4js.common.adjust_lon(l/this.ns+this.long0);e.x=a;e.y=i;return e}};Proj4js.Proj.laea={S_POLE:1,N_POLE:2,EQUIT:3,OBLIQ:4,init:function(){var e=Math.abs(this.lat0);this.mode=Math.abs(e-Proj4js.common.HALF_PI)<Proj4js.common.EPSLN?this.lat0<0?this.S_POLE:this.N_POLE:Math.abs(e)<Proj4js.common.EPSLN?this.EQUIT:this.OBLIQ;if(this.es>0){var t;this.qp=Proj4js.common.qsfnz(this.e,1);this.mmf=.5/(1-this.es);this.apa=this.authset(this.es);switch(this.mode){case this.N_POLE:case this.S_POLE:this.dd=1;break;case this.EQUIT:this.rq=Math.sqrt(.5*this.qp);this.dd=1/this.rq;this.xmf=1;this.ymf=.5*this.qp;break;case this.OBLIQ:this.rq=Math.sqrt(.5*this.qp);t=Math.sin(this.lat0);this.sinb1=Proj4js.common.qsfnz(this.e,t)/this.qp;this.cosb1=Math.sqrt(1-this.sinb1*this.sinb1);this.dd=Math.cos(this.lat0)/(Math.sqrt(1-this.es*t*t)*this.rq*this.cosb1);this.ymf=(this.xmf=this.rq)/this.dd;this.xmf*=this.dd}}else if(this.mode==this.OBLIQ){this.sinph0=Math.sin(this.lat0);this.cosph0=Math.cos(this.lat0)}},forward:function(e){var t,r,n=e.x,i=e.y;n=Proj4js.common.adjust_lon(n-this.long0);if(this.sphere){var a,s,o;o=Math.sin(i);s=Math.cos(i);a=Math.cos(n);switch(this.mode){case this.OBLIQ:case this.EQUIT:r=this.mode==this.EQUIT?1+s*a:1+this.sinph0*o+this.cosph0*s*a;if(r<=Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:y less than eps");return null}r=Math.sqrt(2/r);t=r*s*Math.sin(n);r*=this.mode==this.EQUIT?o:this.cosph0*o-this.sinph0*s*a;break;case this.N_POLE:a=-a;case this.S_POLE:if(Math.abs(i+this.phi0)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:phi < eps");return null}r=Proj4js.common.FORTPI-.5*i;r=2*(this.mode==this.S_POLE?Math.cos(r):Math.sin(r));t=r*Math.sin(n);r*=a}}else{var a,l,o,c,u=0,p=0,h=0;a=Math.cos(n);l=Math.sin(n);o=Math.sin(i);c=Proj4js.common.qsfnz(this.e,o);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){u=c/this.qp;p=Math.sqrt(1-u*u)}switch(this.mode){case this.OBLIQ:h=1+this.sinb1*u+this.cosb1*p*a;break;case this.EQUIT:h=1+p*a;break;case this.N_POLE:h=Proj4js.common.HALF_PI+i;c=this.qp-c;break;case this.S_POLE:h=i-Proj4js.common.HALF_PI;c=this.qp+c}if(Math.abs(h)<Proj4js.common.EPSLN){Proj4js.reportError("laea:fwd:b < eps");return null}switch(this.mode){case this.OBLIQ:case this.EQUIT:h=Math.sqrt(2/h);r=this.mode==this.OBLIQ?this.ymf*h*(this.cosb1*u-this.sinb1*p*a):(h=Math.sqrt(2/(1+p*a)))*u*this.ymf;t=this.xmf*h*p*l;break;case this.N_POLE:case this.S_POLE:if(c>=0){t=(h=Math.sqrt(c))*l;r=a*(this.mode==this.S_POLE?h:-h)}else t=r=0}}e.x=this.a*t+this.x0;e.y=this.a*r+this.y0;return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t,r,n=e.x/this.a,i=e.y/this.a;if(this.sphere){var a,s=0,o=0;a=Math.sqrt(n*n+i*i);r=.5*a;if(r>1){Proj4js.reportError("laea:Inv:DataError");return null}r=2*Math.asin(r);if(this.mode==this.OBLIQ||this.mode==this.EQUIT){o=Math.sin(r);s=Math.cos(r)}switch(this.mode){case this.EQUIT:r=Math.abs(a)<=Proj4js.common.EPSLN?0:Math.asin(i*o/a);n*=o;i=s*a;break;case this.OBLIQ:r=Math.abs(a)<=Proj4js.common.EPSLN?this.phi0:Math.asin(s*this.sinph0+i*o*this.cosph0/a);n*=o*this.cosph0;i=(s-Math.sin(r)*this.sinph0)*a;break;case this.N_POLE:i=-i;r=Proj4js.common.HALF_PI-r;break;case this.S_POLE:r-=Proj4js.common.HALF_PI}t=0!=i||this.mode!=this.EQUIT&&this.mode!=this.OBLIQ?Math.atan2(n,i):0}else{var l,c,u,p,h=0;switch(this.mode){case this.EQUIT:case this.OBLIQ:n/=this.dd;i*=this.dd;p=Math.sqrt(n*n+i*i);if(p<Proj4js.common.EPSLN){e.x=0;e.y=this.phi0;return e}c=2*Math.asin(.5*p/this.rq);l=Math.cos(c);n*=c=Math.sin(c);if(this.mode==this.OBLIQ){h=l*this.sinb1+i*c*this.cosb1/p;u=this.qp*h;i=p*this.cosb1*l-i*this.sinb1*c}else{h=i*c/p;u=this.qp*h;i=p*l}break;case this.N_POLE:i=-i;case this.S_POLE:u=n*n+i*i;if(!u){e.x=0;e.y=this.phi0;return e}h=1-u/this.qp;this.mode==this.S_POLE&&(h=-h)}t=Math.atan2(n,i);r=this.authlat(Math.asin(h),this.apa)}e.x=Proj4js.common.adjust_lon(this.long0+t);e.y=r;return e},P00:.3333333333333333,P01:.17222222222222222,P02:.10257936507936508,P10:.06388888888888888,P11:.0664021164021164,P20:.016415012942191543,authset:function(e){var t,r=new Array;r[0]=e*this.P00;t=e*e;r[0]+=t*this.P01;r[1]=t*this.P10;t*=e;r[0]+=t*this.P02;r[1]+=t*this.P11;r[2]=t*this.P20;return r},authlat:function(e,t){var r=e+e;return e+t[0]*Math.sin(r)+t[1]*Math.sin(r+r)+t[2]*Math.sin(r+r+r)}};Proj4js.Proj.aeqd={init:function(){this.sin_p12=Math.sin(this.lat0);this.cos_p12=Math.cos(this.lat0)},forward:function(e){var t,r=e.x,n=(e.y,Math.sin(e.y)),i=Math.cos(e.y),a=Proj4js.common.adjust_lon(r-this.long0),s=Math.cos(a),o=this.sin_p12*n+this.cos_p12*i*s;if(Math.abs(Math.abs(o)-1)<Proj4js.common.EPSLN){t=1;if(0>o){Proj4js.reportError("aeqd:Fwd:PointError");return}}else{var l=Math.acos(o);t=l/Math.sin(l)}e.x=this.x0+this.a*t*i*Math.sin(a);e.y=this.y0+this.a*t*(this.cos_p12*n-this.sin_p12*i*s);return e},inverse:function(e){e.x-=this.x0;e.y-=this.y0;var t=Math.sqrt(e.x*e.x+e.y*e.y);if(!(t>2*Proj4js.common.HALF_PI*this.a)){var r,n=t/this.a,i=Math.sin(n),a=Math.cos(n),s=this.long0;if(Math.abs(t)<=Proj4js.common.EPSLN)r=this.lat0;else{r=Proj4js.common.asinz(a*this.sin_p12+e.y*i*this.cos_p12/t);var o=Math.abs(this.lat0)-Proj4js.common.HALF_PI;if(Math.abs(o)<=Proj4js.common.EPSLN)s=Proj4js.common.adjust_lon(this.lat0>=0?this.long0+Math.atan2(e.x,-e.y):this.long0-Math.atan2(-e.x,e.y));else{o=a-this.sin_p12*Math.sin(r);if(Math.abs(o)<Proj4js.common.EPSLN&&Math.abs(e.x)<Proj4js.common.EPSLN);else{{Math.atan2(e.x*i*this.cos_p12,o*t)}s=Proj4js.common.adjust_lon(this.long0+Math.atan2(e.x*i*this.cos_p12,o*t))}}}e.x=s;e.y=r;return e}Proj4js.reportError("aeqdInvDataError")}};Proj4js.Proj.moll={init:function(){},forward:function(e){for(var t=e.x,r=e.y,n=Proj4js.common.adjust_lon(t-this.long0),i=r,a=Proj4js.common.PI*Math.sin(r),s=0;!0;s++){var o=-(i+Math.sin(i)-a)/(1+Math.cos(i));i+=o;if(Math.abs(o)<Proj4js.common.EPSLN)break;s>=50&&Proj4js.reportError("moll:Fwd:IterationError")}i/=2;Proj4js.common.PI/2-Math.abs(r)<Proj4js.common.EPSLN&&(n=0);var l=.900316316158*this.a*n*Math.cos(i)+this.x0,c=1.4142135623731*this.a*Math.sin(i)+this.y0;e.x=l;e.y=c;return e},inverse:function(e){var t,r;e.x-=this.x0;var r=e.y/(1.4142135623731*this.a);Math.abs(r)>.999999999999&&(r=.999999999999);var t=Math.asin(r),n=Proj4js.common.adjust_lon(this.long0+e.x/(.900316316158*this.a*Math.cos(t)));n<-Proj4js.common.PI&&(n=-Proj4js.common.PI);n>Proj4js.common.PI&&(n=Proj4js.common.PI);r=(2*t+Math.sin(2*t))/Proj4js.common.PI;Math.abs(r)>1&&(r=1);var i=Math.asin(r);e.x=n;e.y=i;return e}};Proj4js.defs["EPSG:25830"]="+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs";Proj4js.Proj.utm={dependsOn:"tmerc",init:function(){if(this.zone){this.lat0=0;this.long0=(6*Math.abs(this.zone)-183)*Proj4js.common.D2R;this.x0=5e5;this.y0=this.utmSouth?1e7:0;this.k0=.9996;Proj4js.Proj.tmerc.init.apply(this);this.forward=Proj4js.Proj.tmerc.forward;this.inverse=Proj4js.Proj.tmerc.inverse}else Proj4js.reportError("utm:init: zone must be specified for UTM")}};!function(e,t){function r(e){var t=e.length,r=ue.type(e);return ue.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||"function"!==r&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function n(e){var t=Ee[e]={};ue.each(e.match(he)||[],function(e,r){t[r]=!0});return t}function i(e,r,n,i){if(ue.acceptData(e)){var a,s,o=ue.expando,l=e.nodeType,c=l?ue.cache:e,u=l?e[o]:e[o]&&o;if(u&&c[u]&&(i||c[u].data)||n!==t||"string"!=typeof r){u||(u=l?e[o]=te.pop()||ue.guid++:o);c[u]||(c[u]=l?{}:{toJSON:ue.noop});("object"==typeof r||"function"==typeof r)&&(i?c[u]=ue.extend(c[u],r):c[u].data=ue.extend(c[u].data,r));s=c[u];if(!i){s.data||(s.data={});s=s.data}n!==t&&(s[ue.camelCase(r)]=n);if("string"==typeof r){a=s[r];null==a&&(a=s[ue.camelCase(r)])}else a=s;return a}}}function a(e,t,r){if(ue.acceptData(e)){var n,i,a=e.nodeType,s=a?ue.cache:e,l=a?e[ue.expando]:ue.expando;if(s[l]){if(t){n=r?s[l]:s[l].data;if(n){if(ue.isArray(t))t=t.concat(ue.map(t,ue.camelCase));else if(t in n)t=[t];else{t=ue.camelCase(t);t=t in n?[t]:t.split(" ")}i=t.length;for(;i--;)delete n[t[i]];if(r?!o(n):!ue.isEmptyObject(n))return}}if(!r){delete s[l].data;if(!o(s[l]))return}a?ue.cleanData([e],!0):ue.support.deleteExpando||s!=s.window?delete s[l]:s[l]=null}}}function s(e,r,n){if(n===t&&1===e.nodeType){var i="data-"+r.replace(Ae,"-$1").toLowerCase();n=e.getAttribute(i);if("string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:Oe.test(n)?ue.parseJSON(n):n}catch(a){}ue.data(e,r,n)}else n=t}return n}function o(e){var t;for(t in e)if(("data"!==t||!ue.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function l(){return!0}function c(){return!1}function u(){try{return K.activeElement}catch(e){}}function p(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function h(e,t,r){if(ue.isFunction(t))return ue.grep(e,function(e,n){return!!t.call(e,n,e)!==r});if(t.nodeType)return ue.grep(e,function(e){return e===t!==r});if("string"==typeof t){if(Ge.test(t))return ue.filter(t,e,r);t=ue.filter(t,e)}return ue.grep(e,function(e){return ue.inArray(e,t)>=0!==r})}function d(e){var t=Ve.split("|"),r=e.createDocumentFragment();if(r.createElement)for(;t.length;)r.createElement(t.pop());return r}function f(e,t){return ue.nodeName(e,"table")&&ue.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function m(e){e.type=(null!==ue.find.attr(e,"type"))+"/"+e.type;return e}function y(e){var t=it.exec(e.type);t?e.type=t[1]:e.removeAttribute("type");return e}function g(e,t){for(var r,n=0;null!=(r=e[n]);n++)ue._data(r,"globalEval",!t||ue._data(t[n],"globalEval"))}function v(e,t){if(1===t.nodeType&&ue.hasData(e)){var r,n,i,a=ue._data(e),s=ue._data(t,a),o=a.events;if(o){delete s.handle;s.events={};for(r in o)for(n=0,i=o[r].length;i>n;n++)ue.event.add(t,r,o[r][n])}s.data&&(s.data=ue.extend({},s.data))}}function C(e,t){var r,n,i;if(1===t.nodeType){r=t.nodeName.toLowerCase();if(!ue.support.noCloneEvent&&t[ue.expando]){i=ue._data(t);for(n in i.events)ue.removeEvent(t,n,i.handle);t.removeAttribute(ue.expando)}if("script"===r&&t.text!==e.text){m(t).text=e.text;y(t)}else if("object"===r){t.parentNode&&(t.outerHTML=e.outerHTML);ue.support.html5Clone&&e.innerHTML&&!ue.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)}else if("input"===r&&tt.test(e.type)){t.defaultChecked=t.checked=e.checked;t.value!==e.value&&(t.value=e.value)}else"option"===r?t.defaultSelected=t.selected=e.defaultSelected:("input"===r||"textarea"===r)&&(t.defaultValue=e.defaultValue)}}function T(e,r){var n,i,a=0,s=typeof e.getElementsByTagName!==Y?e.getElementsByTagName(r||"*"):typeof e.querySelectorAll!==Y?e.querySelectorAll(r||"*"):t;if(!s)for(s=[],n=e.childNodes||e;null!=(i=n[a]);a++)!r||ue.nodeName(i,r)?s.push(i):ue.merge(s,T(i,r));return r===t||r&&ue.nodeName(e,r)?ue.merge([e],s):s}function L(e){tt.test(e.type)&&(e.defaultChecked=e.checked)}function w(e,t){if(t in e)return t;for(var r=t.charAt(0).toUpperCase()+t.slice(1),n=t,i=St.length;i--;){t=St[i]+r;if(t in e)return t}return n}function b(e,t){e=t||e;return"none"===ue.css(e,"display")||!ue.contains(e.ownerDocument,e)}function S(e,t){for(var r,n,i,a=[],s=0,o=e.length;o>s;s++){n=e[s];if(n.style){a[s]=ue._data(n,"olddisplay");r=n.style.display;if(t){a[s]||"none"!==r||(n.style.display="");""===n.style.display&&b(n)&&(a[s]=ue._data(n,"olddisplay",x(n.nodeName)))}else if(!a[s]){i=b(n);(r&&"none"!==r||!i)&&ue._data(n,"olddisplay",i?r:ue.css(n,"display"))}}}for(s=0;o>s;s++){n=e[s];n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?a[s]||"":"none"))}return e}function E(e,t,r){var n=gt.exec(t);return n?Math.max(0,n[1]-(r||0))+(n[2]||"px"):t}function O(e,t,r,n,i){for(var a=r===(n?"border":"content")?4:"width"===t?1:0,s=0;4>a;a+=2){"margin"===r&&(s+=ue.css(e,r+bt[a],!0,i));if(n){"content"===r&&(s-=ue.css(e,"padding"+bt[a],!0,i));"margin"!==r&&(s-=ue.css(e,"border"+bt[a]+"Width",!0,i))}else{s+=ue.css(e,"padding"+bt[a],!0,i);"padding"!==r&&(s+=ue.css(e,"border"+bt[a]+"Width",!0,i))}}return s}function A(e,t,r){var n=!0,i="width"===t?e.offsetWidth:e.offsetHeight,a=ut(e),s=ue.support.boxSizing&&"border-box"===ue.css(e,"boxSizing",!1,a);if(0>=i||null==i){i=pt(e,t,a);(0>i||null==i)&&(i=e.style[t]);if(vt.test(i))return i;n=s&&(ue.support.boxSizingReliable||i===e.style[t]);i=parseFloat(i)||0}return i+O(e,t,r||(s?"border":"content"),n,a)+"px"}function x(e){var t=K,r=Tt[e];if(!r){r=P(e,t);if("none"===r||!r){ct=(ct||ue("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement);t=(ct[0].contentWindow||ct[0].contentDocument).document;t.write("<!doctype html><html><body>");t.close();r=P(e,t);ct.detach()}Tt[e]=r}return r}function P(e,t){var r=ue(t.createElement(e)).appendTo(t.body),n=ue.css(r[0],"display");r.remove();return n}function _(e,t,r,n){var i;if(ue.isArray(t))ue.each(t,function(t,i){r||Ot.test(e)?n(e,i):_(e+"["+("object"==typeof i?t:"")+"]",i,r,n)});else if(r||"object"!==ue.type(t))n(e,t);else for(i in t)_(e+"["+i+"]",t[i],r,n)}function N(e){return function(t,r){if("string"!=typeof t){r=t;t="*"}var n,i=0,a=t.toLowerCase().match(he)||[];if(ue.isFunction(r))for(;n=a[i++];)if("+"===n[0]){n=n.slice(1)||"*";(e[n]=e[n]||[]).unshift(r)}else(e[n]=e[n]||[]).push(r)}}function M(e,t,r,n){function i(o){var l;a[o]=!0;ue.each(e[o]||[],function(e,o){var c=o(t,r,n);if("string"==typeof c&&!s&&!a[c]){t.dataTypes.unshift(c);i(c);return!1}return s?!(l=c):void 0});return l}var a={},s=e===zt;return i(t.dataTypes[0])||!a["*"]&&i("*")}function k(e,r){var n,i,a=ue.ajaxSettings.flatOptions||{};for(i in r)r[i]!==t&&((a[i]?e:n||(n={}))[i]=r[i]);n&&ue.extend(!0,e,n);return e}function R(e,r,n){for(var i,a,s,o,l=e.contents,c=e.dataTypes;"*"===c[0];){c.shift();a===t&&(a=e.mimeType||r.getResponseHeader("Content-Type"))}if(a)for(o in l)if(l[o]&&l[o].test(a)){c.unshift(o);break}if(c[0]in n)s=c[0];else{for(o in n){if(!c[0]||e.converters[o+" "+c[0]]){s=o;break}i||(i=o)}s=s||i}if(s){s!==c[0]&&c.unshift(s);return n[s]}}function I(e,t,r,n){var i,a,s,o,l,c={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];a=u.shift();for(;a;){e.responseFields[a]&&(r[e.responseFields[a]]=t);!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType));l=a;a=u.shift();if(a)if("*"===a)a=l;else if("*"!==l&&l!==a){s=c[l+" "+a]||c["* "+a];if(!s)for(i in c){o=i.split(" ");if(o[1]===a){s=c[l+" "+o[0]]||c["* "+o[0]];if(s){if(s===!0)s=c[i];else if(c[i]!==!0){a=o[0];u.unshift(o[1])}break}}}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(p){return{state:"parsererror",error:s?p:"No conversion from "+l+" to "+a}}}}return{state:"success",data:t}}function D(){try{return new e.XMLHttpRequest}catch(t){}}function F(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function $(){setTimeout(function(){Zt=t});return Zt=ue.now()}function B(e,t,r){for(var n,i=(ir[t]||[]).concat(ir["*"]),a=0,s=i.length;s>a;a++)if(n=i[a].call(r,t,e))return n}function j(e,t,r){var n,i,a=0,s=nr.length,o=ue.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;for(var t=Zt||$(),r=Math.max(0,c.startTime+c.duration-t),n=r/c.duration||0,a=1-n,s=0,l=c.tweens.length;l>s;s++)c.tweens[s].run(a);o.notifyWith(e,[c,a,r]);if(1>a&&l)return r;o.resolveWith(e,[c]);return!1},c=o.promise({elem:e,props:ue.extend({},t),opts:ue.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:Zt||$(),duration:r.duration,tweens:[],createTween:function(t,r){var n=ue.Tween(e,c.opts,t,r,c.opts.specialEasing[t]||c.opts.easing);c.tweens.push(n);return n},stop:function(t){var r=0,n=t?c.tweens.length:0;if(i)return this;i=!0;for(;n>r;r++)c.tweens[r].run(1);t?o.resolveWith(e,[c,t]):o.rejectWith(e,[c,t]);return this}}),u=c.props;U(u,c.opts.specialEasing);for(;s>a;a++){n=nr[a].call(c,e,u,c.opts);if(n)return n}ue.map(u,B,c);ue.isFunction(c.opts.start)&&c.opts.start.call(e,c);ue.fx.timer(ue.extend(l,{elem:e,anim:c,queue:c.opts.queue}));return c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function U(e,t){var r,n,i,a,s;for(r in e){n=ue.camelCase(r);i=t[n];a=e[r];if(ue.isArray(a)){i=a[1];a=e[r]=a[0]}if(r!==n){e[n]=a;delete e[r]}s=ue.cssHooks[n];if(s&&"expand"in s){a=s.expand(a);delete e[n];for(r in a)if(!(r in e)){e[r]=a[r];t[r]=i}}else t[n]=i}}function G(e,t,r){var n,i,a,s,o,l,c=this,u={},p=e.style,h=e.nodeType&&b(e),d=ue._data(e,"fxshow");if(!r.queue){o=ue._queueHooks(e,"fx");if(null==o.unqueued){o.unqueued=0;l=o.empty.fire;o.empty.fire=function(){o.unqueued||l()}}o.unqueued++;c.always(function(){c.always(function(){o.unqueued--;ue.queue(e,"fx").length||o.empty.fire()})})}if(1===e.nodeType&&("height"in t||"width"in t)){r.overflow=[p.overflow,p.overflowX,p.overflowY];"inline"===ue.css(e,"display")&&"none"===ue.css(e,"float")&&(ue.support.inlineBlockNeedsLayout&&"inline"!==x(e.nodeName)?p.zoom=1:p.display="inline-block")}if(r.overflow){p.overflow="hidden";ue.support.shrinkWrapBlocks||c.always(function(){p.overflow=r.overflow[0];p.overflowX=r.overflow[1];p.overflowY=r.overflow[2]})}for(n in t){i=t[n];if(er.exec(i)){delete t[n];a=a||"toggle"===i;if(i===(h?"hide":"show"))continue;u[n]=d&&d[n]||ue.style(e,n)}}if(!ue.isEmptyObject(u)){d?"hidden"in d&&(h=d.hidden):d=ue._data(e,"fxshow",{});a&&(d.hidden=!h);h?ue(e).show():c.done(function(){ue(e).hide()});c.done(function(){var t;ue._removeData(e,"fxshow");for(t in u)ue.style(e,t,u[t])});for(n in u){s=B(h?d[n]:0,n,c);if(!(n in d)){d[n]=s.start;if(h){s.end=s.start;s.start="width"===n||"height"===n?1:0}}}}}function z(e,t,r,n,i){return new z.prototype.init(e,t,r,n,i)}function H(e,t){var r,n={height:e},i=0;t=t?1:0;for(;4>i;i+=2-t){r=bt[i];n["margin"+r]=n["padding"+r]=e}t&&(n.opacity=n.width=e);return n}function W(e){return ue.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var V,q,Y=typeof t,X=e.location,K=e.document,J=K.documentElement,Z=e.jQuery,Q=e.$,ee={},te=[],re="1.10.2",ne=te.concat,ie=te.push,ae=te.slice,se=te.indexOf,oe=ee.toString,le=ee.hasOwnProperty,ce=re.trim,ue=function(e,t){return new ue.fn.init(e,t,q)},pe=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,he=/\S+/g,de=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,fe=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,me=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ye=/^[\],:{}\s]*$/,ge=/(?:^|:|,)(?:\s*\[)+/g,ve=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,Ce=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,Te=/^-ms-/,Le=/-([\da-z])/gi,we=function(e,t){return t.toUpperCase()},be=function(e){if(K.addEventListener||"load"===e.type||"complete"===K.readyState){Se();ue.ready()}},Se=function(){if(K.addEventListener){K.removeEventListener("DOMContentLoaded",be,!1);e.removeEventListener("load",be,!1)}else{K.detachEvent("onreadystatechange",be);e.detachEvent("onload",be)}};ue.fn=ue.prototype={jquery:re,constructor:ue,init:function(e,r,n){var i,a;if(!e)return this;if("string"==typeof e){i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:fe.exec(e);if(!i||!i[1]&&r)return!r||r.jquery?(r||n).find(e):this.constructor(r).find(e);if(i[1]){r=r instanceof ue?r[0]:r;ue.merge(this,ue.parseHTML(i[1],r&&r.nodeType?r.ownerDocument||r:K,!0));if(me.test(i[1])&&ue.isPlainObject(r))for(i in r)ue.isFunction(this[i])?this[i](r[i]):this.attr(i,r[i]);return this}a=K.getElementById(i[2]);if(a&&a.parentNode){if(a.id!==i[2])return n.find(e);this.length=1;this[0]=a}this.context=K;this.selector=e;return this}if(e.nodeType){this.context=this[0]=e;this.length=1;return this}if(ue.isFunction(e))return n.ready(e);if(e.selector!==t){this.selector=e.selector;this.context=e.context}return ue.makeArray(e,this)},selector:"",length:0,toArray:function(){return ae.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=ue.merge(this.constructor(),e);t.prevObject=this;t.context=this.context;return t},each:function(e,t){return ue.each(this,e,t)},ready:function(e){ue.ready.promise().done(e);return this},slice:function(){return this.pushStack(ae.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,r=+e+(0>e?t:0);return this.pushStack(r>=0&&t>r?[this[r]]:[])},map:function(e){return this.pushStack(ue.map(this,function(t,r){return e.call(t,r,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ie,sort:[].sort,splice:[].splice};ue.fn.init.prototype=ue.fn;ue.extend=ue.fn.extend=function(){var e,r,n,i,a,s,o=arguments[0]||{},l=1,c=arguments.length,u=!1;if("boolean"==typeof o){u=o;o=arguments[1]||{};l=2}"object"==typeof o||ue.isFunction(o)||(o={});if(c===l){o=this;--l}for(;c>l;l++)if(null!=(a=arguments[l]))for(i in a){e=o[i];n=a[i];if(o!==n)if(u&&n&&(ue.isPlainObject(n)||(r=ue.isArray(n)))){if(r){r=!1;s=e&&ue.isArray(e)?e:[]}else s=e&&ue.isPlainObject(e)?e:{};o[i]=ue.extend(u,s,n)}else n!==t&&(o[i]=n)}return o};ue.extend({expando:"jQuery"+(re+Math.random()).replace(/\D/g,""),noConflict:function(t){e.$===ue&&(e.$=Q);t&&e.jQuery===ue&&(e.jQuery=Z);return ue},isReady:!1,readyWait:1,holdReady:function(e){e?ue.readyWait++:ue.ready(!0)},ready:function(e){if(e===!0?!--ue.readyWait:!ue.isReady){if(!K.body)return setTimeout(ue.ready);ue.isReady=!0;if(!(e!==!0&&--ue.readyWait>0)){V.resolveWith(K,[ue]);ue.fn.trigger&&ue(K).trigger("ready").off("ready")}}},isFunction:function(e){return"function"===ue.type(e)},isArray:Array.isArray||function(e){return"array"===ue.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?ee[oe.call(e)]||"object":typeof e},isPlainObject:function(e){var r;if(!e||"object"!==ue.type(e)||e.nodeType||ue.isWindow(e))return!1;try{if(e.constructor&&!le.call(e,"constructor")&&!le.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}if(ue.support.ownLast)for(r in e)return le.call(e,r);for(r in e);return r===t||le.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,r){if(!e||"string"!=typeof e)return null;if("boolean"==typeof t){r=t;t=!1}t=t||K;var n=me.exec(e),i=!r&&[];if(n)return[t.createElement(n[1])];n=ue.buildFragment([e],t,i);i&&ue(i).remove();return ue.merge([],n.childNodes)},parseJSON:function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(null===t)return t;if("string"==typeof t){t=ue.trim(t);if(t&&ye.test(t.replace(ve,"@").replace(Ce,"]").replace(ge,"")))return new Function("return "+t)()}ue.error("Invalid JSON: "+t)},parseXML:function(r){var n,i;if(!r||"string"!=typeof r)return null;try{if(e.DOMParser){i=new DOMParser;n=i.parseFromString(r,"text/xml")}else{n=new ActiveXObject("Microsoft.XMLDOM");n.async="false";n.loadXML(r)}}catch(a){n=t}n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||ue.error("Invalid XML: "+r);return n},noop:function(){},globalEval:function(t){t&&ue.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(Te,"ms-").replace(Le,we)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var i,a=0,s=e.length,o=r(e);if(n)if(o)for(;s>a;a++){i=t.apply(e[a],n);if(i===!1)break}else for(a in e){i=t.apply(e[a],n);if(i===!1)break}else if(o)for(;s>a;a++){i=t.call(e[a],a,e[a]);if(i===!1)break}else for(a in e){i=t.call(e[a],a,e[a]);if(i===!1)break}return e},trim:ce&&!ce.call("\ufeff\xa0")?function(e){return null==e?"":ce.call(e)}:function(e){return null==e?"":(e+"").replace(de,"")},makeArray:function(e,t){var n=t||[];null!=e&&(r(Object(e))?ue.merge(n,"string"==typeof e?[e]:e):ie.call(n,e));return n},inArray:function(e,t,r){var n;if(t){if(se)return se.call(t,e,r);n=t.length;r=r?0>r?Math.max(0,n+r):r:0;for(;n>r;r++)if(r in t&&t[r]===e)return r}return-1},merge:function(e,r){var n=r.length,i=e.length,a=0;if("number"==typeof n)for(;n>a;a++)e[i++]=r[a];else for(;r[a]!==t;)e[i++]=r[a++];e.length=i;return e},grep:function(e,t,r){var n,i=[],a=0,s=e.length;r=!!r;for(;s>a;a++){n=!!t(e[a],a);r!==n&&i.push(e[a])}return i},map:function(e,t,n){var i,a=0,s=e.length,o=r(e),l=[];if(o)for(;s>a;a++){i=t(e[a],a,n);null!=i&&(l[l.length]=i)}else for(a in e){i=t(e[a],a,n);null!=i&&(l[l.length]=i)}return ne.apply([],l)},guid:1,proxy:function(e,r){var n,i,a;if("string"==typeof r){a=e[r];r=e;e=a}if(!ue.isFunction(e))return t;n=ae.call(arguments,2);i=function(){return e.apply(r||this,n.concat(ae.call(arguments)))};i.guid=e.guid=e.guid||ue.guid++;return i},access:function(e,r,n,i,a,s,o){var l=0,c=e.length,u=null==n;if("object"===ue.type(n)){a=!0;for(l in n)ue.access(e,r,l,n[l],!0,s,o)}else if(i!==t){a=!0;ue.isFunction(i)||(o=!0);if(u)if(o){r.call(e,i);r=null}else{u=r;r=function(e,t,r){return u.call(ue(e),r)}}if(r)for(;c>l;l++)r(e[l],n,o?i:i.call(e[l],l,r(e[l],n)))}return a?e:u?r.call(e):c?r(e[0],n):s},now:function(){return(new Date).getTime()},swap:function(e,t,r,n){var i,a,s={};for(a in t){s[a]=e.style[a];e.style[a]=t[a]}i=r.apply(e,n||[]);for(a in t)e.style[a]=s[a];return i}});ue.ready.promise=function(t){if(!V){V=ue.Deferred();if("complete"===K.readyState)setTimeout(ue.ready);else if(K.addEventListener){K.addEventListener("DOMContentLoaded",be,!1);e.addEventListener("load",be,!1)}else{K.attachEvent("onreadystatechange",be);e.attachEvent("onload",be);var r=!1;try{r=null==e.frameElement&&K.documentElement}catch(n){}r&&r.doScroll&&!function i(){if(!ue.isReady){try{r.doScroll("left")}catch(e){return setTimeout(i,50)}Se();ue.ready()}}()}}return V.promise(t)};ue.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){ee["[object "+t+"]"]=t.toLowerCase()});q=ue(K);!function(e,t){function r(e,t,r,n){var i,a,s,o,l,c,u,p,f,m;(t?t.ownerDocument||t:j)!==M&&N(t);t=t||M;r=r||[];if(!e||"string"!=typeof e)return r;

if(1!==(o=t.nodeType)&&9!==o)return[];if(R&&!n){if(i=Ce.exec(e))if(s=i[1]){if(9===o){a=t.getElementById(s);if(!a||!a.parentNode)return r;if(a.id===s){r.push(a);return r}}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(s))&&$(t,a)&&a.id===s){r.push(a);return r}}else{if(i[2]){ee.apply(r,t.getElementsByTagName(e));return r}if((s=i[3])&&b.getElementsByClassName&&t.getElementsByClassName){ee.apply(r,t.getElementsByClassName(s));return r}}if(b.qsa&&(!I||!I.test(e))){p=u=B;f=t;m=9===o&&e;if(1===o&&"object"!==t.nodeName.toLowerCase()){c=h(e);(u=t.getAttribute("id"))?p=u.replace(we,"\\$&"):t.setAttribute("id",p);p="[id='"+p+"'] ";l=c.length;for(;l--;)c[l]=p+d(c[l]);f=de.test(e)&&t.parentNode||t;m=c.join(",")}if(m)try{ee.apply(r,f.querySelectorAll(m));return r}catch(y){}finally{u||t.removeAttribute("id")}}}return L(e.replace(ce,"$1"),t,r,n)}function n(){function e(r,n){t.push(r+=" ")>E.cacheLength&&delete e[t.shift()];return e[r]=n}var t=[];return e}function i(e){e[B]=!0;return e}function a(e){var t=M.createElement("div");try{return!!e(t)}catch(r){return!1}finally{t.parentNode&&t.parentNode.removeChild(t);t=null}}function s(e,t){for(var r=e.split("|"),n=e.length;n--;)E.attrHandle[r[n]]=t}function o(e,t){var r=t&&e,n=r&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||X)-(~e.sourceIndex||X);if(n)return n;if(r)for(;r=r.nextSibling;)if(r===t)return-1;return e?1:-1}function l(e){return function(t){var r=t.nodeName.toLowerCase();return"input"===r&&t.type===e}}function c(e){return function(t){var r=t.nodeName.toLowerCase();return("input"===r||"button"===r)&&t.type===e}}function u(e){return i(function(t){t=+t;return i(function(r,n){for(var i,a=e([],r.length,t),s=a.length;s--;)r[i=a[s]]&&(r[i]=!(n[i]=r[i]))})})}function p(){}function h(e,t){var n,i,a,s,o,l,c,u=H[e+" "];if(u)return t?0:u.slice(0);o=e;l=[];c=E.preFilter;for(;o;){if(!n||(i=pe.exec(o))){i&&(o=o.slice(i[0].length)||o);l.push(a=[])}n=!1;if(i=he.exec(o)){n=i.shift();a.push({value:n,type:i[0].replace(ce," ")});o=o.slice(n.length)}for(s in E.filter)if((i=ge[s].exec(o))&&(!c[s]||(i=c[s](i)))){n=i.shift();a.push({value:n,type:s,matches:i});o=o.slice(n.length)}if(!n)break}return t?o.length:o?r.error(e):H(e,l).slice(0)}function d(e){for(var t=0,r=e.length,n="";r>t;t++)n+=e[t].value;return n}function f(e,t,r){var n=t.dir,i=r&&"parentNode"===n,a=G++;return t.first?function(t,r,a){for(;t=t[n];)if(1===t.nodeType||i)return e(t,r,a)}:function(t,r,s){var o,l,c,u=U+" "+a;if(s){for(;t=t[n];)if((1===t.nodeType||i)&&e(t,r,s))return!0}else for(;t=t[n];)if(1===t.nodeType||i){c=t[B]||(t[B]={});if((l=c[n])&&l[0]===u){if((o=l[1])===!0||o===S)return o===!0}else{l=c[n]=[u];l[1]=e(t,r,s)||S;if(l[1]===!0)return!0}}}}function m(e){return e.length>1?function(t,r,n){for(var i=e.length;i--;)if(!e[i](t,r,n))return!1;return!0}:e[0]}function y(e,t,r,n,i){for(var a,s=[],o=0,l=e.length,c=null!=t;l>o;o++)if((a=e[o])&&(!r||r(a,n,i))){s.push(a);c&&t.push(o)}return s}function g(e,t,r,n,a,s){n&&!n[B]&&(n=g(n));a&&!a[B]&&(a=g(a,s));return i(function(i,s,o,l){var c,u,p,h=[],d=[],f=s.length,m=i||T(t||"*",o.nodeType?[o]:o,[]),g=!e||!i&&t?m:y(m,h,e,o,l),v=r?a||(i?e:f||n)?[]:s:g;r&&r(g,v,o,l);if(n){c=y(v,d);n(c,[],o,l);u=c.length;for(;u--;)(p=c[u])&&(v[d[u]]=!(g[d[u]]=p))}if(i){if(a||e){if(a){c=[];u=v.length;for(;u--;)(p=v[u])&&c.push(g[u]=p);a(null,v=[],c,l)}u=v.length;for(;u--;)(p=v[u])&&(c=a?re.call(i,p):h[u])>-1&&(i[c]=!(s[c]=p))}}else{v=y(v===s?v.splice(f,v.length):v);a?a(null,s,v,l):ee.apply(s,v)}})}function v(e){for(var t,r,n,i=e.length,a=E.relative[e[0].type],s=a||E.relative[" "],o=a?1:0,l=f(function(e){return e===t},s,!0),c=f(function(e){return re.call(t,e)>-1},s,!0),u=[function(e,r,n){return!a&&(n||r!==P)||((t=r).nodeType?l(e,r,n):c(e,r,n))}];i>o;o++)if(r=E.relative[e[o].type])u=[f(m(u),r)];else{r=E.filter[e[o].type].apply(null,e[o].matches);if(r[B]){n=++o;for(;i>n&&!E.relative[e[n].type];n++);return g(o>1&&m(u),o>1&&d(e.slice(0,o-1).concat({value:" "===e[o-2].type?"*":""})).replace(ce,"$1"),r,n>o&&v(e.slice(o,n)),i>n&&v(e=e.slice(n)),i>n&&d(e))}u.push(r)}return m(u)}function C(e,t){var n=0,a=t.length>0,s=e.length>0,o=function(i,o,l,c,u){var p,h,d,f=[],m=0,g="0",v=i&&[],C=null!=u,T=P,L=i||s&&E.find.TAG("*",u&&o.parentNode||o),w=U+=null==T?1:Math.random()||.1;if(C){P=o!==M&&o;S=n}for(;null!=(p=L[g]);g++){if(s&&p){h=0;for(;d=e[h++];)if(d(p,o,l)){c.push(p);break}if(C){U=w;S=++n}}if(a){(p=!d&&p)&&m--;i&&v.push(p)}}m+=g;if(a&&g!==m){h=0;for(;d=t[h++];)d(v,f,o,l);if(i){if(m>0)for(;g--;)v[g]||f[g]||(f[g]=Z.call(c));f=y(f)}ee.apply(c,f);C&&!i&&f.length>0&&m+t.length>1&&r.uniqueSort(c)}if(C){U=w;P=T}return v};return a?i(o):o}function T(e,t,n){for(var i=0,a=t.length;a>i;i++)r(e,t[i],n);return n}function L(e,t,r,n){var i,a,s,o,l,c=h(e);if(!n&&1===c.length){a=c[0]=c[0].slice(0);if(a.length>2&&"ID"===(s=a[0]).type&&b.getById&&9===t.nodeType&&R&&E.relative[a[1].type]){t=(E.find.ID(s.matches[0].replace(be,Se),t)||[])[0];if(!t)return r;e=e.slice(a.shift().value.length)}i=ge.needsContext.test(e)?0:a.length;for(;i--;){s=a[i];if(E.relative[o=s.type])break;if((l=E.find[o])&&(n=l(s.matches[0].replace(be,Se),de.test(a[0].type)&&t.parentNode||t))){a.splice(i,1);e=n.length&&d(a);if(!e){ee.apply(r,n);return r}break}}}x(e,c)(n,t,!R,r,de.test(e));return r}var w,b,S,E,O,A,x,P,_,N,M,k,R,I,D,F,$,B="sizzle"+-new Date,j=e.document,U=0,G=0,z=n(),H=n(),W=n(),V=!1,q=function(e,t){if(e===t){V=!0;return 0}return 0},Y=typeof t,X=1<<31,K={}.hasOwnProperty,J=[],Z=J.pop,Q=J.push,ee=J.push,te=J.slice,re=J.indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(this[t]===e)return t;return-1},ne="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ie="[\\x20\\t\\r\\n\\f]",ae="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",se=ae.replace("w","w#"),oe="\\["+ie+"*("+ae+")"+ie+"*(?:([*^$|!~]?=)"+ie+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+se+")|)|)"+ie+"*\\]",le=":("+ae+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+oe.replace(3,8)+")*)|.*)\\)|)",ce=new RegExp("^"+ie+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ie+"+$","g"),pe=new RegExp("^"+ie+"*,"+ie+"*"),he=new RegExp("^"+ie+"*([>+~]|"+ie+")"+ie+"*"),de=new RegExp(ie+"*[+~]"),fe=new RegExp("="+ie+"*([^\\]'\"]*)"+ie+"*\\]","g"),me=new RegExp(le),ye=new RegExp("^"+se+"$"),ge={ID:new RegExp("^#("+ae+")"),CLASS:new RegExp("^\\.("+ae+")"),TAG:new RegExp("^("+ae.replace("w","w*")+")"),ATTR:new RegExp("^"+oe),PSEUDO:new RegExp("^"+le),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ie+"*(even|odd|(([+-]|)(\\d*)n|)"+ie+"*(?:([+-]|)"+ie+"*(\\d+)|))"+ie+"*\\)|)","i"),bool:new RegExp("^(?:"+ne+")$","i"),needsContext:new RegExp("^"+ie+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ie+"*((?:-\\d)?\\d*)"+ie+"*\\)|)(?=[^-]|$)","i")},ve=/^[^{]+\{\s*\[native \w/,Ce=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Te=/^(?:input|select|textarea|button)$/i,Le=/^h\d$/i,we=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+ie+"?|("+ie+")|.)","ig"),Se=function(e,t,r){var n="0x"+t-65536;return n!==n||r?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)};try{ee.apply(J=te.call(j.childNodes),j.childNodes);J[j.childNodes.length].nodeType}catch(Ee){ee={apply:J.length?function(e,t){Q.apply(e,te.call(t))}:function(e,t){for(var r=e.length,n=0;e[r++]=t[n++];);e.length=r-1}}}A=r.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1};b=r.support={};N=r.setDocument=function(e){var t=e?e.ownerDocument||e:j,r=t.defaultView;if(t===M||9!==t.nodeType||!t.documentElement)return M;M=t;k=t.documentElement;R=!A(t);r&&r.attachEvent&&r!==r.top&&r.attachEvent("onbeforeunload",function(){N()});b.attributes=a(function(e){e.className="i";return!e.getAttribute("className")});b.getElementsByTagName=a(function(e){e.appendChild(t.createComment(""));return!e.getElementsByTagName("*").length});b.getElementsByClassName=a(function(e){e.innerHTML="<div class='a'></div><div class='a i'></div>";e.firstChild.className="i";return 2===e.getElementsByClassName("i").length});b.getById=a(function(e){k.appendChild(e).id=B;return!t.getElementsByName||!t.getElementsByName(B).length});if(b.getById){E.find.ID=function(e,t){if(typeof t.getElementById!==Y&&R){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}};E.filter.ID=function(e){var t=e.replace(be,Se);return function(e){return e.getAttribute("id")===t}}}else{delete E.find.ID;E.filter.ID=function(e){var t=e.replace(be,Se);return function(e){var r=typeof e.getAttributeNode!==Y&&e.getAttributeNode("id");return r&&r.value===t}}}E.find.TAG=b.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==Y?t.getElementsByTagName(e):void 0}:function(e,t){var r,n=[],i=0,a=t.getElementsByTagName(e);if("*"===e){for(;r=a[i++];)1===r.nodeType&&n.push(r);return n}return a};E.find.CLASS=b.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==Y&&R?t.getElementsByClassName(e):void 0};D=[];I=[];if(b.qsa=ve.test(t.querySelectorAll)){a(function(e){e.innerHTML="<select><option selected=''></option></select>";e.querySelectorAll("[selected]").length||I.push("\\["+ie+"*(?:value|"+ne+")");e.querySelectorAll(":checked").length||I.push(":checked")});a(function(e){var r=t.createElement("input");r.setAttribute("type","hidden");e.appendChild(r).setAttribute("t","");e.querySelectorAll("[t^='']").length&&I.push("[*^$]="+ie+"*(?:''|\"\")");e.querySelectorAll(":enabled").length||I.push(":enabled",":disabled");e.querySelectorAll("*,:x");I.push(",.*:")})}(b.matchesSelector=ve.test(F=k.webkitMatchesSelector||k.mozMatchesSelector||k.oMatchesSelector||k.msMatchesSelector))&&a(function(e){b.disconnectedMatch=F.call(e,"div");F.call(e,"[s!='']:x");D.push("!=",le)});I=I.length&&new RegExp(I.join("|"));D=D.length&&new RegExp(D.join("|"));$=ve.test(k.contains)||k.compareDocumentPosition?function(e,t){var r=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(r.contains?r.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1};q=k.compareDocumentPosition?function(e,r){if(e===r){V=!0;return 0}var n=r.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(r);return n?1&n||!b.sortDetached&&r.compareDocumentPosition(e)===n?e===t||$(j,e)?-1:r===t||$(j,r)?1:_?re.call(_,e)-re.call(_,r):0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,r){var n,i=0,a=e.parentNode,s=r.parentNode,l=[e],c=[r];if(e===r){V=!0;return 0}if(!a||!s)return e===t?-1:r===t?1:a?-1:s?1:_?re.call(_,e)-re.call(_,r):0;if(a===s)return o(e,r);n=e;for(;n=n.parentNode;)l.unshift(n);n=r;for(;n=n.parentNode;)c.unshift(n);for(;l[i]===c[i];)i++;return i?o(l[i],c[i]):l[i]===j?-1:c[i]===j?1:0};return t};r.matches=function(e,t){return r(e,null,null,t)};r.matchesSelector=function(e,t){(e.ownerDocument||e)!==M&&N(e);t=t.replace(fe,"='$1']");if(!(!b.matchesSelector||!R||D&&D.test(t)||I&&I.test(t)))try{var n=F.call(e,t);if(n||b.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return r(t,M,null,[e]).length>0};r.contains=function(e,t){(e.ownerDocument||e)!==M&&N(e);return $(e,t)};r.attr=function(e,r){(e.ownerDocument||e)!==M&&N(e);var n=E.attrHandle[r.toLowerCase()],i=n&&K.call(E.attrHandle,r.toLowerCase())?n(e,r,!R):t;return i===t?b.attributes||!R?e.getAttribute(r):(i=e.getAttributeNode(r))&&i.specified?i.value:null:i};r.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)};r.uniqueSort=function(e){var t,r=[],n=0,i=0;V=!b.detectDuplicates;_=!b.sortStable&&e.slice(0);e.sort(q);if(V){for(;t=e[i++];)t===e[i]&&(n=r.push(i));for(;n--;)e.splice(r[n],1)}return e};O=r.getText=function(e){var t,r="",n=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=O(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[n];n++)r+=O(t);return r};E=r.selectors={cacheLength:50,createPseudo:i,match:ge,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){e[1]=e[1].replace(be,Se);e[3]=(e[4]||e[5]||"").replace(be,Se);"~="===e[2]&&(e[3]=" "+e[3]+" ");return e.slice(0,4)},CHILD:function(e){e[1]=e[1].toLowerCase();if("nth"===e[1].slice(0,3)){e[3]||r.error(e[0]);e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3]));e[5]=+(e[7]+e[8]||"odd"===e[3])}else e[3]&&r.error(e[0]);return e},PSEUDO:function(e){var r,n=!e[5]&&e[2];if(ge.CHILD.test(e[0]))return null;if(e[3]&&e[4]!==t)e[2]=e[4];else if(n&&me.test(n)&&(r=h(n,!0))&&(r=n.indexOf(")",n.length-r)-n.length)){e[0]=e[0].slice(0,r);e[2]=n.slice(0,r)}return e.slice(0,3)}},filter:{TAG:function(e){var t=e.replace(be,Se).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=z[e+" "];return t||(t=new RegExp("(^|"+ie+")"+e+"("+ie+"|$)"))&&z(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==Y&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(i){var a=r.attr(i,e);if(null==a)return"!="===t;if(!t)return!0;a+="";return"="===t?a===n:"!="===t?a!==n:"^="===t?n&&0===a.indexOf(n):"*="===t?n&&a.indexOf(n)>-1:"$="===t?n&&a.slice(-n.length)===n:"~="===t?(" "+a+" ").indexOf(n)>-1:"|="===t?a===n||a.slice(0,n.length+1)===n+"-":!1}},CHILD:function(e,t,r,n,i){var a="nth"!==e.slice(0,3),s="last"!==e.slice(-4),o="of-type"===t;return 1===n&&0===i?function(e){return!!e.parentNode}:function(t,r,l){var c,u,p,h,d,f,m=a!==s?"nextSibling":"previousSibling",y=t.parentNode,g=o&&t.nodeName.toLowerCase(),v=!l&&!o;if(y){if(a){for(;m;){p=t;for(;p=p[m];)if(o?p.nodeName.toLowerCase()===g:1===p.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}f=[s?y.firstChild:y.lastChild];if(s&&v){u=y[B]||(y[B]={});c=u[e]||[];d=c[0]===U&&c[1];h=c[0]===U&&c[2];p=d&&y.childNodes[d];for(;p=++d&&p&&p[m]||(h=d=0)||f.pop();)if(1===p.nodeType&&++h&&p===t){u[e]=[U,d,h];break}}else if(v&&(c=(t[B]||(t[B]={}))[e])&&c[0]===U)h=c[1];else for(;p=++d&&p&&p[m]||(h=d=0)||f.pop();)if((o?p.nodeName.toLowerCase()===g:1===p.nodeType)&&++h){v&&((p[B]||(p[B]={}))[e]=[U,h]);if(p===t)break}h-=i;return h===n||h%n===0&&h/n>=0}}},PSEUDO:function(e,t){var n,a=E.pseudos[e]||E.setFilters[e.toLowerCase()]||r.error("unsupported pseudo: "+e);if(a[B])return a(t);if(a.length>1){n=[e,e,"",t];return E.setFilters.hasOwnProperty(e.toLowerCase())?i(function(e,r){for(var n,i=a(e,t),s=i.length;s--;){n=re.call(e,i[s]);e[n]=!(r[n]=i[s])}}):function(e){return a(e,0,n)}}return a}},pseudos:{not:i(function(e){var t=[],r=[],n=x(e.replace(ce,"$1"));return n[B]?i(function(e,t,r,i){for(var a,s=n(e,null,i,[]),o=e.length;o--;)(a=s[o])&&(e[o]=!(t[o]=a))}):function(e,i,a){t[0]=e;n(t,null,a,r);return!r.pop()}}),has:i(function(e){return function(t){return r(e,t).length>0}}),contains:i(function(e){return function(t){return(t.textContent||t.innerText||O(t)).indexOf(e)>-1}}),lang:i(function(e){ye.test(e||"")||r.error("unsupported lang: "+e);e=e.replace(be,Se).toLowerCase();return function(t){var r;do if(r=R?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang")){r=r.toLowerCase();return r===e||0===r.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var r=e.location&&e.location.hash;return r&&r.slice(1)===t.id},root:function(e){return e===k},focus:function(e){return e===M.activeElement&&(!M.hasFocus||M.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){e.parentNode&&e.parentNode.selectedIndex;return e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!E.pseudos.empty(e)},header:function(e){return Le.test(e.nodeName)},input:function(e){return Te.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:u(function(){return[0]}),last:u(function(e,t){return[t-1]}),eq:u(function(e,t,r){return[0>r?r+t:r]}),even:u(function(e,t){for(var r=0;t>r;r+=2)e.push(r);return e}),odd:u(function(e,t){for(var r=1;t>r;r+=2)e.push(r);return e}),lt:u(function(e,t,r){for(var n=0>r?r+t:r;--n>=0;)e.push(n);return e}),gt:u(function(e,t,r){for(var n=0>r?r+t:r;++n<t;)e.push(n);return e})}};E.pseudos.nth=E.pseudos.eq;for(w in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})E.pseudos[w]=l(w);for(w in{submit:!0,reset:!0})E.pseudos[w]=c(w);p.prototype=E.filters=E.pseudos;E.setFilters=new p;x=r.compile=function(e,t){var r,n=[],i=[],a=W[e+" "];if(!a){t||(t=h(e));r=t.length;for(;r--;){a=v(t[r]);a[B]?n.push(a):i.push(a)}a=W(e,C(i,n))}return a};b.sortStable=B.split("").sort(q).join("")===B;b.detectDuplicates=V;N();b.sortDetached=a(function(e){return 1&e.compareDocumentPosition(M.createElement("div"))});a(function(e){e.innerHTML="<a href='#'></a>";return"#"===e.firstChild.getAttribute("href")})||s("type|href|height|width",function(e,t,r){return r?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)});b.attributes&&a(function(e){e.innerHTML="<input/>";e.firstChild.setAttribute("value","");return""===e.firstChild.getAttribute("value")})||s("value",function(e,t,r){return r||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue});a(function(e){return null==e.getAttribute("disabled")})||s(ne,function(e,t,r){var n;return r?void 0:(n=e.getAttributeNode(t))&&n.specified?n.value:e[t]===!0?t.toLowerCase():null});ue.find=r;ue.expr=r.selectors;ue.expr[":"]=ue.expr.pseudos;ue.unique=r.uniqueSort;ue.text=r.getText;ue.isXMLDoc=r.isXML;ue.contains=r.contains}(e);var Ee={};ue.Callbacks=function(e){e="string"==typeof e?Ee[e]||n(e):ue.extend({},e);var r,i,a,s,o,l,c=[],u=!e.once&&[],p=function(t){i=e.memory&&t;a=!0;o=l||0;l=0;s=c.length;r=!0;for(;c&&s>o;o++)if(c[o].apply(t[0],t[1])===!1&&e.stopOnFalse){i=!1;break}r=!1;c&&(u?u.length&&p(u.shift()):i?c=[]:h.disable())},h={add:function(){if(c){var t=c.length;!function n(t){ue.each(t,function(t,r){var i=ue.type(r);"function"===i?e.unique&&h.has(r)||c.push(r):r&&r.length&&"string"!==i&&n(r)})}(arguments);if(r)s=c.length;else if(i){l=t;p(i)}}return this},remove:function(){c&&ue.each(arguments,function(e,t){for(var n;(n=ue.inArray(t,c,n))>-1;){c.splice(n,1);if(r){s>=n&&s--;o>=n&&o--}}});return this},has:function(e){return e?ue.inArray(e,c)>-1:!(!c||!c.length)},empty:function(){c=[];s=0;return this},disable:function(){c=u=i=t;return this},disabled:function(){return!c},lock:function(){u=t;i||h.disable();return this},locked:function(){return!u},fireWith:function(e,t){if(c&&(!a||u)){t=t||[];t=[e,t.slice?t.slice():t];r?u.push(t):p(t)}return this},fire:function(){h.fireWith(this,arguments);return this},fired:function(){return!!a}};return h};ue.extend({Deferred:function(e){var t=[["resolve","done",ue.Callbacks("once memory"),"resolved"],["reject","fail",ue.Callbacks("once memory"),"rejected"],["notify","progress",ue.Callbacks("memory")]],r="pending",n={state:function(){return r},always:function(){i.done(arguments).fail(arguments);return this},then:function(){var e=arguments;return ue.Deferred(function(r){ue.each(t,function(t,a){var s=a[0],o=ue.isFunction(e[t])&&e[t];i[a[1]](function(){var e=o&&o.apply(this,arguments);e&&ue.isFunction(e.promise)?e.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[s+"With"](this===n?r.promise():this,o?[e]:arguments)})});e=null}).promise()},promise:function(e){return null!=e?ue.extend(e,n):n}},i={};n.pipe=n.then;ue.each(t,function(e,a){var s=a[2],o=a[3];n[a[1]]=s.add;o&&s.add(function(){r=o},t[1^e][2].disable,t[2][2].lock);i[a[0]]=function(){i[a[0]+"With"](this===i?n:this,arguments);return this};i[a[0]+"With"]=s.fireWith});n.promise(i);e&&e.call(i,i);return i},when:function(e){var t,r,n,i=0,a=ae.call(arguments),s=a.length,o=1!==s||e&&ue.isFunction(e.promise)?s:0,l=1===o?e:ue.Deferred(),c=function(e,r,n){return function(i){r[e]=this;n[e]=arguments.length>1?ae.call(arguments):i;n===t?l.notifyWith(r,n):--o||l.resolveWith(r,n)}};if(s>1){t=new Array(s);r=new Array(s);n=new Array(s);for(;s>i;i++)a[i]&&ue.isFunction(a[i].promise)?a[i].promise().done(c(i,n,a)).fail(l.reject).progress(c(i,r,t)):--o}o||l.resolveWith(n,a);return l.promise()}});ue.support=function(t){var r,n,i,a,s,o,l,c,u,p=K.createElement("div");p.setAttribute("className","t");p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>";r=p.getElementsByTagName("*")||[];n=p.getElementsByTagName("a")[0];if(!n||!n.style||!r.length)return t;a=K.createElement("select");o=a.appendChild(K.createElement("option"));i=p.getElementsByTagName("input")[0];n.style.cssText="top:1px;float:left;opacity:.5";t.getSetAttribute="t"!==p.className;t.leadingWhitespace=3===p.firstChild.nodeType;t.tbody=!p.getElementsByTagName("tbody").length;t.htmlSerialize=!!p.getElementsByTagName("link").length;t.style=/top/.test(n.getAttribute("style"));t.hrefNormalized="/a"===n.getAttribute("href");t.opacity=/^0.5/.test(n.style.opacity);t.cssFloat=!!n.style.cssFloat;t.checkOn=!!i.value;t.optSelected=o.selected;t.enctype=!!K.createElement("form").enctype;t.html5Clone="<:nav></:nav>"!==K.createElement("nav").cloneNode(!0).outerHTML;t.inlineBlockNeedsLayout=!1;t.shrinkWrapBlocks=!1;t.pixelPosition=!1;t.deleteExpando=!0;t.noCloneEvent=!0;t.reliableMarginRight=!0;t.boxSizingReliable=!0;i.checked=!0;t.noCloneChecked=i.cloneNode(!0).checked;a.disabled=!0;t.optDisabled=!o.disabled;try{delete p.test}catch(h){t.deleteExpando=!1}i=K.createElement("input");i.setAttribute("value","");t.input=""===i.getAttribute("value");i.value="t";i.setAttribute("type","radio");t.radioValue="t"===i.value;i.setAttribute("checked","t");i.setAttribute("name","t");s=K.createDocumentFragment();s.appendChild(i);t.appendChecked=i.checked;t.checkClone=s.cloneNode(!0).cloneNode(!0).lastChild.checked;if(p.attachEvent){p.attachEvent("onclick",function(){t.noCloneEvent=!1});p.cloneNode(!0).click()}for(u in{submit:!0,change:!0,focusin:!0}){p.setAttribute(l="on"+u,"t");t[u+"Bubbles"]=l in e||p.attributes[l].expando===!1}p.style.backgroundClip="content-box";p.cloneNode(!0).style.backgroundClip="";t.clearCloneStyle="content-box"===p.style.backgroundClip;for(u in ue(t))break;t.ownLast="0"!==u;ue(function(){var r,n,i,a="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",s=K.getElementsByTagName("body")[0];if(s){r=K.createElement("div");r.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px";s.appendChild(r).appendChild(p);p.innerHTML="<table><tr><td></td><td>t</td></tr></table>";i=p.getElementsByTagName("td");i[0].style.cssText="padding:0;margin:0;border:0;display:none";c=0===i[0].offsetHeight;i[0].style.display="";i[1].style.display="none";t.reliableHiddenOffsets=c&&0===i[0].offsetHeight;p.innerHTML="";p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;";ue.swap(s,null!=s.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===p.offsetWidth});if(e.getComputedStyle){t.pixelPosition="1%"!==(e.getComputedStyle(p,null)||{}).top;t.boxSizingReliable="4px"===(e.getComputedStyle(p,null)||{width:"4px"}).width;n=p.appendChild(K.createElement("div"));n.style.cssText=p.style.cssText=a;n.style.marginRight=n.style.width="0";p.style.width="1px";t.reliableMarginRight=!parseFloat((e.getComputedStyle(n,null)||{}).marginRight)}if(typeof p.style.zoom!==Y){p.innerHTML="";p.style.cssText=a+"width:1px;padding:1px;display:inline;zoom:1";t.inlineBlockNeedsLayout=3===p.offsetWidth;p.style.display="block";p.innerHTML="<div></div>";p.firstChild.style.width="5px";t.shrinkWrapBlocks=3!==p.offsetWidth;t.inlineBlockNeedsLayout&&(s.style.zoom=1)}s.removeChild(r);r=p=i=n=null}});r=a=s=o=n=i=null;return t}({});var Oe=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,Ae=/([A-Z])/g;ue.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){e=e.nodeType?ue.cache[e[ue.expando]]:e[ue.expando];return!!e&&!o(e)},data:function(e,t,r){return i(e,t,r)},removeData:function(e,t){return a(e,t)},_data:function(e,t,r){return i(e,t,r,!0)},_removeData:function(e,t){return a(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&ue.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}});ue.fn.extend({data:function(e,r){var n,i,a=null,o=0,l=this[0];if(e===t){if(this.length){a=ue.data(l);if(1===l.nodeType&&!ue._data(l,"parsedAttrs")){n=l.attributes;for(;o<n.length;o++){i=n[o].name;if(0===i.indexOf("data-")){i=ue.camelCase(i.slice(5));s(l,i,a[i])}}ue._data(l,"parsedAttrs",!0)}}return a}return"object"==typeof e?this.each(function(){ue.data(this,e)}):arguments.length>1?this.each(function(){ue.data(this,e,r)}):l?s(l,e,ue.data(l,e)):null},removeData:function(e){return this.each(function(){ue.removeData(this,e)})}});ue.extend({queue:function(e,t,r){var n;if(e){t=(t||"fx")+"queue";n=ue._data(e,t);r&&(!n||ue.isArray(r)?n=ue._data(e,t,ue.makeArray(r)):n.push(r));return n||[]}},dequeue:function(e,t){t=t||"fx";var r=ue.queue(e,t),n=r.length,i=r.shift(),a=ue._queueHooks(e,t),s=function(){ue.dequeue(e,t)};if("inprogress"===i){i=r.shift();n--}if(i){"fx"===t&&r.unshift("inprogress");delete a.stop;i.call(e,s,a)}!n&&a&&a.empty.fire()},_queueHooks:function(e,t){var r=t+"queueHooks";return ue._data(e,r)||ue._data(e,r,{empty:ue.Callbacks("once memory").add(function(){ue._removeData(e,t+"queue");ue._removeData(e,r)})})}});ue.fn.extend({queue:function(e,r){var n=2;if("string"!=typeof e){r=e;e="fx";n--}return arguments.length<n?ue.queue(this[0],e):r===t?this:this.each(function(){var t=ue.queue(this,e,r);ue._queueHooks(this,e);"fx"===e&&"inprogress"!==t[0]&&ue.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ue.dequeue(this,e)})},delay:function(e,t){e=ue.fx?ue.fx.speeds[e]||e:e;t=t||"fx";return this.queue(t,function(t,r){var n=setTimeout(t,e);r.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,r){var n,i=1,a=ue.Deferred(),s=this,o=this.length,l=function(){--i||a.resolveWith(s,[s])};if("string"!=typeof e){r=e;e=t}e=e||"fx";for(;o--;){n=ue._data(s[o],e+"queueHooks");if(n&&n.empty){i++;n.empty.add(l)}}l();return a.promise(r)}});var xe,Pe,_e=/[\t\r\n\f]/g,Ne=/\r/g,Me=/^(?:input|select|textarea|button|object)$/i,ke=/^(?:a|area)$/i,Re=/^(?:checked|selected)$/i,Ie=ue.support.getSetAttribute,De=ue.support.input;ue.fn.extend({attr:function(e,t){return ue.access(this,ue.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ue.removeAttr(this,e)})},prop:function(e,t){return ue.access(this,ue.prop,e,t,arguments.length>1)},removeProp:function(e){e=ue.propFix[e]||e;return this.each(function(){try{this[e]=t;delete this[e]}catch(r){}})},addClass:function(e){var t,r,n,i,a,s=0,o=this.length,l="string"==typeof e&&e;if(ue.isFunction(e))return this.each(function(t){ue(this).addClass(e.call(this,t,this.className))});if(l){t=(e||"").match(he)||[];for(;o>s;s++){r=this[s];n=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(_e," "):" ");if(n){a=0;for(;i=t[a++];)n.indexOf(" "+i+" ")<0&&(n+=i+" ");r.className=ue.trim(n)}}}return this},removeClass:function(e){var t,r,n,i,a,s=0,o=this.length,l=0===arguments.length||"string"==typeof e&&e;if(ue.isFunction(e))return this.each(function(t){ue(this).removeClass(e.call(this,t,this.className))});if(l){t=(e||"").match(he)||[];for(;o>s;s++){r=this[s];n=1===r.nodeType&&(r.className?(" "+r.className+" ").replace(_e," "):"");if(n){a=0;for(;i=t[a++];)for(;n.indexOf(" "+i+" ")>=0;)n=n.replace(" "+i+" "," ");r.className=e?ue.trim(n):""}}}return this},toggleClass:function(e,t){var r=typeof e;return"boolean"==typeof t&&"string"===r?t?this.addClass(e):this.removeClass(e):this.each(ue.isFunction(e)?function(r){ue(this).toggleClass(e.call(this,r,this.className,t),t)}:function(){if("string"===r)for(var t,n=0,i=ue(this),a=e.match(he)||[];t=a[n++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else if(r===Y||"boolean"===r){this.className&&ue._data(this,"__className__",this.className);this.className=this.className||e===!1?"":ue._data(this,"__className__")||""}})},hasClass:function(e){for(var t=" "+e+" ",r=0,n=this.length;n>r;r++)if(1===this[r].nodeType&&(" "+this[r].className+" ").replace(_e," ").indexOf(t)>=0)return!0;return!1},val:function(e){var r,n,i,a=this[0];if(arguments.length){i=ue.isFunction(e);return this.each(function(r){var a;if(1===this.nodeType){a=i?e.call(this,r,ue(this).val()):e;null==a?a="":"number"==typeof a?a+="":ue.isArray(a)&&(a=ue.map(a,function(e){return null==e?"":e+""}));n=ue.valHooks[this.type]||ue.valHooks[this.nodeName.toLowerCase()];n&&"set"in n&&n.set(this,a,"value")!==t||(this.value=a)}})}if(a){n=ue.valHooks[a.type]||ue.valHooks[a.nodeName.toLowerCase()];if(n&&"get"in n&&(r=n.get(a,"value"))!==t)return r;r=a.value;return"string"==typeof r?r.replace(Ne,""):null==r?"":r}}});ue.extend({valHooks:{option:{get:function(e){var t=ue.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){for(var t,r,n=e.options,i=e.selectedIndex,a="select-one"===e.type||0>i,s=a?null:[],o=a?i+1:n.length,l=0>i?o:a?i:0;o>l;l++){r=n[l];if(!(!r.selected&&l!==i||(ue.support.optDisabled?r.disabled:null!==r.getAttribute("disabled"))||r.parentNode.disabled&&ue.nodeName(r.parentNode,"optgroup"))){t=ue(r).val();if(a)return t;s.push(t)}}return s},set:function(e,t){for(var r,n,i=e.options,a=ue.makeArray(t),s=i.length;s--;){n=i[s];(n.selected=ue.inArray(ue(n).val(),a)>=0)&&(r=!0)}r||(e.selectedIndex=-1);return a}}},attr:function(e,r,n){var i,a,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s){if(typeof e.getAttribute===Y)return ue.prop(e,r,n);if(1!==s||!ue.isXMLDoc(e)){r=r.toLowerCase();i=ue.attrHooks[r]||(ue.expr.match.bool.test(r)?Pe:xe)}if(n===t){if(i&&"get"in i&&null!==(a=i.get(e,r)))return a;a=ue.find.attr(e,r);return null==a?t:a}if(null!==n){if(i&&"set"in i&&(a=i.set(e,n,r))!==t)return a;e.setAttribute(r,n+"");return n}ue.removeAttr(e,r)}},removeAttr:function(e,t){var r,n,i=0,a=t&&t.match(he);if(a&&1===e.nodeType)for(;r=a[i++];){n=ue.propFix[r]||r;ue.expr.match.bool.test(r)?De&&Ie||!Re.test(r)?e[n]=!1:e[ue.camelCase("default-"+r)]=e[n]=!1:ue.attr(e,r,"");e.removeAttribute(Ie?r:n)}},attrHooks:{type:{set:function(e,t){if(!ue.support.radioValue&&"radio"===t&&ue.nodeName(e,"input")){var r=e.value;e.setAttribute("type",t);r&&(e.value=r);return t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,r,n){var i,a,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o){s=1!==o||!ue.isXMLDoc(e);if(s){r=ue.propFix[r]||r;a=ue.propHooks[r]}return n!==t?a&&"set"in a&&(i=a.set(e,n,r))!==t?i:e[r]=n:a&&"get"in a&&null!==(i=a.get(e,r))?i:e[r]}},propHooks:{tabIndex:{get:function(e){var t=ue.find.attr(e,"tabindex");return t?parseInt(t,10):Me.test(e.nodeName)||ke.test(e.nodeName)&&e.href?0:-1}}}});Pe={set:function(e,t,r){t===!1?ue.removeAttr(e,r):De&&Ie||!Re.test(r)?e.setAttribute(!Ie&&ue.propFix[r]||r,r):e[ue.camelCase("default-"+r)]=e[r]=!0;return r}};ue.each(ue.expr.match.bool.source.match(/\w+/g),function(e,r){var n=ue.expr.attrHandle[r]||ue.find.attr;ue.expr.attrHandle[r]=De&&Ie||!Re.test(r)?function(e,r,i){var a=ue.expr.attrHandle[r],s=i?t:(ue.expr.attrHandle[r]=t)!=n(e,r,i)?r.toLowerCase():null;ue.expr.attrHandle[r]=a;return s}:function(e,r,n){return n?t:e[ue.camelCase("default-"+r)]?r.toLowerCase():null}});De&&Ie||(ue.attrHooks.value={set:function(e,t,r){if(!ue.nodeName(e,"input"))return xe&&xe.set(e,t,r);e.defaultValue=t;return void 0}});if(!Ie){xe={set:function(e,r,n){
var i=e.getAttributeNode(n);i||e.setAttributeNode(i=e.ownerDocument.createAttribute(n));i.value=r+="";return"value"===n||r===e.getAttribute(n)?r:t}};ue.expr.attrHandle.id=ue.expr.attrHandle.name=ue.expr.attrHandle.coords=function(e,r,n){var i;return n?t:(i=e.getAttributeNode(r))&&""!==i.value?i.value:null};ue.valHooks.button={get:function(e,r){var n=e.getAttributeNode(r);return n&&n.specified?n.value:t},set:xe.set};ue.attrHooks.contenteditable={set:function(e,t,r){xe.set(e,""===t?!1:t,r)}};ue.each(["width","height"],function(e,t){ue.attrHooks[t]={set:function(e,r){if(""===r){e.setAttribute(t,"auto");return r}}}})}ue.support.hrefNormalized||ue.each(["href","src"],function(e,t){ue.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}});ue.support.style||(ue.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}});ue.support.optSelected||(ue.propHooks.selected={get:function(e){var t=e.parentNode;if(t){t.selectedIndex;t.parentNode&&t.parentNode.selectedIndex}return null}});ue.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ue.propFix[this.toLowerCase()]=this});ue.support.enctype||(ue.propFix.enctype="encoding");ue.each(["radio","checkbox"],function(){ue.valHooks[this]={set:function(e,t){return ue.isArray(t)?e.checked=ue.inArray(ue(e).val(),t)>=0:void 0}};ue.support.checkOn||(ue.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Fe=/^(?:input|select|textarea)$/i,$e=/^key/,Be=/^(?:mouse|contextmenu)|click/,je=/^(?:focusinfocus|focusoutblur)$/,Ue=/^([^.]*)(?:\.(.+)|)$/;ue.event={global:{},add:function(e,r,n,i,a){var s,o,l,c,u,p,h,d,f,m,y,g=ue._data(e);if(g){if(n.handler){c=n;n=c.handler;a=c.selector}n.guid||(n.guid=ue.guid++);(o=g.events)||(o=g.events={});if(!(p=g.handle)){p=g.handle=function(e){return typeof ue===Y||e&&ue.event.triggered===e.type?t:ue.event.dispatch.apply(p.elem,arguments)};p.elem=e}r=(r||"").match(he)||[""];l=r.length;for(;l--;){s=Ue.exec(r[l])||[];f=y=s[1];m=(s[2]||"").split(".").sort();if(f){u=ue.event.special[f]||{};f=(a?u.delegateType:u.bindType)||f;u=ue.event.special[f]||{};h=ue.extend({type:f,origType:y,data:i,handler:n,guid:n.guid,selector:a,needsContext:a&&ue.expr.match.needsContext.test(a),namespace:m.join(".")},c);if(!(d=o[f])){d=o[f]=[];d.delegateCount=0;u.setup&&u.setup.call(e,i,m,p)!==!1||(e.addEventListener?e.addEventListener(f,p,!1):e.attachEvent&&e.attachEvent("on"+f,p))}if(u.add){u.add.call(e,h);h.handler.guid||(h.handler.guid=n.guid)}a?d.splice(d.delegateCount++,0,h):d.push(h);ue.event.global[f]=!0}}e=null}},remove:function(e,t,r,n,i){var a,s,o,l,c,u,p,h,d,f,m,y=ue.hasData(e)&&ue._data(e);if(y&&(u=y.events)){t=(t||"").match(he)||[""];c=t.length;for(;c--;){o=Ue.exec(t[c])||[];d=m=o[1];f=(o[2]||"").split(".").sort();if(d){p=ue.event.special[d]||{};d=(n?p.delegateType:p.bindType)||d;h=u[d]||[];o=o[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)");l=a=h.length;for(;a--;){s=h[a];if(!(!i&&m!==s.origType||r&&r.guid!==s.guid||o&&!o.test(s.namespace)||n&&n!==s.selector&&("**"!==n||!s.selector))){h.splice(a,1);s.selector&&h.delegateCount--;p.remove&&p.remove.call(e,s)}}if(l&&!h.length){p.teardown&&p.teardown.call(e,f,y.handle)!==!1||ue.removeEvent(e,d,y.handle);delete u[d]}}else for(d in u)ue.event.remove(e,d+t[c],r,n,!0)}if(ue.isEmptyObject(u)){delete y.handle;ue._removeData(e,"events")}}},trigger:function(r,n,i,a){var s,o,l,c,u,p,h,d=[i||K],f=le.call(r,"type")?r.type:r,m=le.call(r,"namespace")?r.namespace.split("."):[];l=p=i=i||K;if(3!==i.nodeType&&8!==i.nodeType&&!je.test(f+ue.event.triggered)){if(f.indexOf(".")>=0){m=f.split(".");f=m.shift();m.sort()}o=f.indexOf(":")<0&&"on"+f;r=r[ue.expando]?r:new ue.Event(f,"object"==typeof r&&r);r.isTrigger=a?2:3;r.namespace=m.join(".");r.namespace_re=r.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null;r.result=t;r.target||(r.target=i);n=null==n?[r]:ue.makeArray(n,[r]);u=ue.event.special[f]||{};if(a||!u.trigger||u.trigger.apply(i,n)!==!1){if(!a&&!u.noBubble&&!ue.isWindow(i)){c=u.delegateType||f;je.test(c+f)||(l=l.parentNode);for(;l;l=l.parentNode){d.push(l);p=l}p===(i.ownerDocument||K)&&d.push(p.defaultView||p.parentWindow||e)}h=0;for(;(l=d[h++])&&!r.isPropagationStopped();){r.type=h>1?c:u.bindType||f;s=(ue._data(l,"events")||{})[r.type]&&ue._data(l,"handle");s&&s.apply(l,n);s=o&&l[o];s&&ue.acceptData(l)&&s.apply&&s.apply(l,n)===!1&&r.preventDefault()}r.type=f;if(!a&&!r.isDefaultPrevented()&&(!u._default||u._default.apply(d.pop(),n)===!1)&&ue.acceptData(i)&&o&&i[f]&&!ue.isWindow(i)){p=i[o];p&&(i[o]=null);ue.event.triggered=f;try{i[f]()}catch(y){}ue.event.triggered=t;p&&(i[o]=p)}return r.result}}},dispatch:function(e){e=ue.event.fix(e);var r,n,i,a,s,o=[],l=ae.call(arguments),c=(ue._data(this,"events")||{})[e.type]||[],u=ue.event.special[e.type]||{};l[0]=e;e.delegateTarget=this;if(!u.preDispatch||u.preDispatch.call(this,e)!==!1){o=ue.event.handlers.call(this,e,c);r=0;for(;(a=o[r++])&&!e.isPropagationStopped();){e.currentTarget=a.elem;s=0;for(;(i=a.handlers[s++])&&!e.isImmediatePropagationStopped();)if(!e.namespace_re||e.namespace_re.test(i.namespace)){e.handleObj=i;e.data=i.data;n=((ue.event.special[i.origType]||{}).handle||i.handler).apply(a.elem,l);if(n!==t&&(e.result=n)===!1){e.preventDefault();e.stopPropagation()}}}u.postDispatch&&u.postDispatch.call(this,e);return e.result}},handlers:function(e,r){var n,i,a,s,o=[],l=r.delegateCount,c=e.target;if(l&&c.nodeType&&(!e.button||"click"!==e.type))for(;c!=this;c=c.parentNode||this)if(1===c.nodeType&&(c.disabled!==!0||"click"!==e.type)){a=[];for(s=0;l>s;s++){i=r[s];n=i.selector+" ";a[n]===t&&(a[n]=i.needsContext?ue(n,this).index(c)>=0:ue.find(n,this,null,[c]).length);a[n]&&a.push(i)}a.length&&o.push({elem:c,handlers:a})}l<r.length&&o.push({elem:this,handlers:r.slice(l)});return o},fix:function(e){if(e[ue.expando])return e;var t,r,n,i=e.type,a=e,s=this.fixHooks[i];s||(this.fixHooks[i]=s=Be.test(i)?this.mouseHooks:$e.test(i)?this.keyHooks:{});n=s.props?this.props.concat(s.props):this.props;e=new ue.Event(a);t=n.length;for(;t--;){r=n[t];e[r]=a[r]}e.target||(e.target=a.srcElement||K);3===e.target.nodeType&&(e.target=e.target.parentNode);e.metaKey=!!e.metaKey;return s.filter?s.filter(e,a):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode);return e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,r){var n,i,a,s=r.button,o=r.fromElement;if(null==e.pageX&&null!=r.clientX){i=e.target.ownerDocument||K;a=i.documentElement;n=i.body;e.pageX=r.clientX+(a&&a.scrollLeft||n&&n.scrollLeft||0)-(a&&a.clientLeft||n&&n.clientLeft||0);e.pageY=r.clientY+(a&&a.scrollTop||n&&n.scrollTop||0)-(a&&a.clientTop||n&&n.clientTop||0)}!e.relatedTarget&&o&&(e.relatedTarget=o===e.target?r.toElement:o);e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0);return e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==u()&&this.focus)try{this.focus();return!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){if(this===u()&&this.blur){this.blur();return!1}},delegateType:"focusout"},click:{trigger:function(){if(ue.nodeName(this,"input")&&"checkbox"===this.type&&this.click){this.click();return!1}},_default:function(e){return ue.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,r,n){var i=ue.extend(new ue.Event,r,{type:e,isSimulated:!0,originalEvent:{}});n?ue.event.trigger(i,null,t):ue.event.dispatch.call(t,i);i.isDefaultPrevented()&&r.preventDefault()}};ue.removeEvent=K.removeEventListener?function(e,t,r){e.removeEventListener&&e.removeEventListener(t,r,!1)}:function(e,t,r){var n="on"+t;if(e.detachEvent){typeof e[n]===Y&&(e[n]=null);e.detachEvent(n,r)}};ue.Event=function(e,t){if(!(this instanceof ue.Event))return new ue.Event(e,t);if(e&&e.type){this.originalEvent=e;this.type=e.type;this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?l:c}else this.type=e;t&&ue.extend(this,t);this.timeStamp=e&&e.timeStamp||ue.now();this[ue.expando]=!0};ue.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=l;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=l;if(e){e.stopPropagation&&e.stopPropagation();e.cancelBubble=!0}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=l;this.stopPropagation()}};ue.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){ue.event.special[e]={delegateType:t,bindType:t,handle:function(e){var r,n=this,i=e.relatedTarget,a=e.handleObj;if(!i||i!==n&&!ue.contains(n,i)){e.type=a.origType;r=a.handler.apply(this,arguments);e.type=t}return r}}});ue.support.submitBubbles||(ue.event.special.submit={setup:function(){if(ue.nodeName(this,"form"))return!1;ue.event.add(this,"click._submit keypress._submit",function(e){var r=e.target,n=ue.nodeName(r,"input")||ue.nodeName(r,"button")?r.form:t;if(n&&!ue._data(n,"submitBubbles")){ue.event.add(n,"submit._submit",function(e){e._submit_bubble=!0});ue._data(n,"submitBubbles",!0)}});return void 0},postDispatch:function(e){if(e._submit_bubble){delete e._submit_bubble;this.parentNode&&!e.isTrigger&&ue.event.simulate("submit",this.parentNode,e,!0)}},teardown:function(){if(ue.nodeName(this,"form"))return!1;ue.event.remove(this,"._submit");return void 0}});ue.support.changeBubbles||(ue.event.special.change={setup:function(){if(Fe.test(this.nodeName)){if("checkbox"===this.type||"radio"===this.type){ue.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)});ue.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1);ue.event.simulate("change",this,e,!0)})}return!1}ue.event.add(this,"beforeactivate._change",function(e){var t=e.target;if(Fe.test(t.nodeName)&&!ue._data(t,"changeBubbles")){ue.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||ue.event.simulate("change",this.parentNode,e,!0)});ue._data(t,"changeBubbles",!0)}})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){ue.event.remove(this,"._change");return!Fe.test(this.nodeName)}});ue.support.focusinBubbles||ue.each({focus:"focusin",blur:"focusout"},function(e,t){var r=0,n=function(e){ue.event.simulate(t,e.target,ue.event.fix(e),!0)};ue.event.special[t]={setup:function(){0===r++&&K.addEventListener(e,n,!0)},teardown:function(){0===--r&&K.removeEventListener(e,n,!0)}}});ue.fn.extend({on:function(e,r,n,i,a){var s,o;if("object"==typeof e){if("string"!=typeof r){n=n||r;r=t}for(s in e)this.on(s,r,n,e[s],a);return this}if(null==n&&null==i){i=r;n=r=t}else if(null==i)if("string"==typeof r){i=n;n=t}else{i=n;n=r;r=t}if(i===!1)i=c;else if(!i)return this;if(1===a){o=i;i=function(e){ue().off(e);return o.apply(this,arguments)};i.guid=o.guid||(o.guid=ue.guid++)}return this.each(function(){ue.event.add(this,e,i,n,r)})},one:function(e,t,r,n){return this.on(e,t,r,n,1)},off:function(e,r,n){var i,a;if(e&&e.preventDefault&&e.handleObj){i=e.handleObj;ue(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler);return this}if("object"==typeof e){for(a in e)this.off(a,r,e[a]);return this}if(r===!1||"function"==typeof r){n=r;r=t}n===!1&&(n=c);return this.each(function(){ue.event.remove(this,e,n,r)})},trigger:function(e,t){return this.each(function(){ue.event.trigger(e,t,this)})},triggerHandler:function(e,t){var r=this[0];return r?ue.event.trigger(e,t,r,!0):void 0}});var Ge=/^.[^:#\[\.,]*$/,ze=/^(?:parents|prev(?:Until|All))/,He=ue.expr.match.needsContext,We={children:!0,contents:!0,next:!0,prev:!0};ue.fn.extend({find:function(e){var t,r=[],n=this,i=n.length;if("string"!=typeof e)return this.pushStack(ue(e).filter(function(){for(t=0;i>t;t++)if(ue.contains(n[t],this))return!0}));for(t=0;i>t;t++)ue.find(e,n[t],r);r=this.pushStack(i>1?ue.unique(r):r);r.selector=this.selector?this.selector+" "+e:e;return r},has:function(e){var t,r=ue(e,this),n=r.length;return this.filter(function(){for(t=0;n>t;t++)if(ue.contains(this,r[t]))return!0})},not:function(e){return this.pushStack(h(this,e||[],!0))},filter:function(e){return this.pushStack(h(this,e||[],!1))},is:function(e){return!!h(this,"string"==typeof e&&He.test(e)?ue(e):e||[],!1).length},closest:function(e,t){for(var r,n=0,i=this.length,a=[],s=He.test(e)||"string"!=typeof e?ue(e,t||this.context):0;i>n;n++)for(r=this[n];r&&r!==t;r=r.parentNode)if(r.nodeType<11&&(s?s.index(r)>-1:1===r.nodeType&&ue.find.matchesSelector(r,e))){r=a.push(r);break}return this.pushStack(a.length>1?ue.unique(a):a)},index:function(e){return e?"string"==typeof e?ue.inArray(this[0],ue(e)):ue.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var r="string"==typeof e?ue(e,t):ue.makeArray(e&&e.nodeType?[e]:e),n=ue.merge(this.get(),r);return this.pushStack(ue.unique(n))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}});ue.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ue.dir(e,"parentNode")},parentsUntil:function(e,t,r){return ue.dir(e,"parentNode",r)},next:function(e){return p(e,"nextSibling")},prev:function(e){return p(e,"previousSibling")},nextAll:function(e){return ue.dir(e,"nextSibling")},prevAll:function(e){return ue.dir(e,"previousSibling")},nextUntil:function(e,t,r){return ue.dir(e,"nextSibling",r)},prevUntil:function(e,t,r){return ue.dir(e,"previousSibling",r)},siblings:function(e){return ue.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ue.sibling(e.firstChild)},contents:function(e){return ue.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ue.merge([],e.childNodes)}},function(e,t){ue.fn[e]=function(r,n){var i=ue.map(this,t,r);"Until"!==e.slice(-5)&&(n=r);n&&"string"==typeof n&&(i=ue.filter(n,i));if(this.length>1){We[e]||(i=ue.unique(i));ze.test(e)&&(i=i.reverse())}return this.pushStack(i)}});ue.extend({filter:function(e,t,r){var n=t[0];r&&(e=":not("+e+")");return 1===t.length&&1===n.nodeType?ue.find.matchesSelector(n,e)?[n]:[]:ue.find.matches(e,ue.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,r,n){for(var i=[],a=e[r];a&&9!==a.nodeType&&(n===t||1!==a.nodeType||!ue(a).is(n));){1===a.nodeType&&i.push(a);a=a[r]}return i},sibling:function(e,t){for(var r=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&r.push(e);return r}});var Ve="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",qe=/ jQuery\d+="(?:null|\d+)"/g,Ye=new RegExp("<(?:"+Ve+")[\\s/>]","i"),Xe=/^\s+/,Ke=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Je=/<([\w:]+)/,Ze=/<tbody/i,Qe=/<|&#?\w+;/,et=/<(?:script|style|link)/i,tt=/^(?:checkbox|radio)$/i,rt=/checked\s*(?:[^=]|=\s*.checked.)/i,nt=/^$|\/(?:java|ecma)script/i,it=/^true\/(.*)/,at=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,st={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ue.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},ot=d(K),lt=ot.appendChild(K.createElement("div"));st.optgroup=st.option;st.tbody=st.tfoot=st.colgroup=st.caption=st.thead;st.th=st.td;ue.fn.extend({text:function(e){return ue.access(this,function(e){return e===t?ue.text(this):this.empty().append((this[0]&&this[0].ownerDocument||K).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=f(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var r,n=e?ue.filter(e,this):this,i=0;null!=(r=n[i]);i++){t||1!==r.nodeType||ue.cleanData(T(r));if(r.parentNode){t&&ue.contains(r.ownerDocument,r)&&g(T(r,"script"));r.parentNode.removeChild(r)}}return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){1===e.nodeType&&ue.cleanData(T(e,!1));for(;e.firstChild;)e.removeChild(e.firstChild);e.options&&ue.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){e=null==e?!1:e;t=null==t?e:t;return this.map(function(){return ue.clone(this,e,t)})},html:function(e){return ue.access(this,function(e){var r=this[0]||{},n=0,i=this.length;if(e===t)return 1===r.nodeType?r.innerHTML.replace(qe,""):t;if(!("string"!=typeof e||et.test(e)||!ue.support.htmlSerialize&&Ye.test(e)||!ue.support.leadingWhitespace&&Xe.test(e)||st[(Je.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(Ke,"<$1></$2>");try{for(;i>n;n++){r=this[n]||{};if(1===r.nodeType){ue.cleanData(T(r,!1));r.innerHTML=e}}r=0}catch(a){}}r&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=ue.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;this.domManip(arguments,function(r){var n=e[t++],i=e[t++];if(i){n&&n.parentNode!==i&&(n=this.nextSibling);ue(this).remove();i.insertBefore(r,n)}},!0);return t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,r){e=ne.apply([],e);var n,i,a,s,o,l,c=0,u=this.length,p=this,h=u-1,d=e[0],f=ue.isFunction(d);if(f||!(1>=u||"string"!=typeof d||ue.support.checkClone)&&rt.test(d))return this.each(function(n){var i=p.eq(n);f&&(e[0]=d.call(this,n,i.html()));i.domManip(e,t,r)});if(u){l=ue.buildFragment(e,this[0].ownerDocument,!1,!r&&this);n=l.firstChild;1===l.childNodes.length&&(l=n);if(n){s=ue.map(T(l,"script"),m);a=s.length;for(;u>c;c++){i=l;if(c!==h){i=ue.clone(i,!0,!0);a&&ue.merge(s,T(i,"script"))}t.call(this[c],i,c)}if(a){o=s[s.length-1].ownerDocument;ue.map(s,y);for(c=0;a>c;c++){i=s[c];nt.test(i.type||"")&&!ue._data(i,"globalEval")&&ue.contains(o,i)&&(i.src?ue._evalUrl(i.src):ue.globalEval((i.text||i.textContent||i.innerHTML||"").replace(at,"")))}}l=n=null}}return this}});ue.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ue.fn[e]=function(e){for(var r,n=0,i=[],a=ue(e),s=a.length-1;s>=n;n++){r=n===s?this:this.clone(!0);ue(a[n])[t](r);ie.apply(i,r.get())}return this.pushStack(i)}});ue.extend({clone:function(e,t,r){var n,i,a,s,o,l=ue.contains(e.ownerDocument,e);if(ue.support.html5Clone||ue.isXMLDoc(e)||!Ye.test("<"+e.nodeName+">"))a=e.cloneNode(!0);else{lt.innerHTML=e.outerHTML;lt.removeChild(a=lt.firstChild)}if(!(ue.support.noCloneEvent&&ue.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ue.isXMLDoc(e))){n=T(a);o=T(e);for(s=0;null!=(i=o[s]);++s)n[s]&&C(i,n[s])}if(t)if(r){o=o||T(e);n=n||T(a);for(s=0;null!=(i=o[s]);s++)v(i,n[s])}else v(e,a);n=T(a,"script");n.length>0&&g(n,!l&&T(e,"script"));n=o=i=null;return a},buildFragment:function(e,t,r,n){for(var i,a,s,o,l,c,u,p=e.length,h=d(t),f=[],m=0;p>m;m++){a=e[m];if(a||0===a)if("object"===ue.type(a))ue.merge(f,a.nodeType?[a]:a);else if(Qe.test(a)){o=o||h.appendChild(t.createElement("div"));l=(Je.exec(a)||["",""])[1].toLowerCase();u=st[l]||st._default;o.innerHTML=u[1]+a.replace(Ke,"<$1></$2>")+u[2];i=u[0];for(;i--;)o=o.lastChild;!ue.support.leadingWhitespace&&Xe.test(a)&&f.push(t.createTextNode(Xe.exec(a)[0]));if(!ue.support.tbody){a="table"!==l||Ze.test(a)?"<table>"!==u[1]||Ze.test(a)?0:o:o.firstChild;i=a&&a.childNodes.length;for(;i--;)ue.nodeName(c=a.childNodes[i],"tbody")&&!c.childNodes.length&&a.removeChild(c)}ue.merge(f,o.childNodes);o.textContent="";for(;o.firstChild;)o.removeChild(o.firstChild);o=h.lastChild}else f.push(t.createTextNode(a))}o&&h.removeChild(o);ue.support.appendChecked||ue.grep(T(f,"input"),L);m=0;for(;a=f[m++];)if(!n||-1===ue.inArray(a,n)){s=ue.contains(a.ownerDocument,a);o=T(h.appendChild(a),"script");s&&g(o);if(r){i=0;for(;a=o[i++];)nt.test(a.type||"")&&r.push(a)}}o=null;return h},cleanData:function(e,t){for(var r,n,i,a,s=0,o=ue.expando,l=ue.cache,c=ue.support.deleteExpando,u=ue.event.special;null!=(r=e[s]);s++)if(t||ue.acceptData(r)){i=r[o];a=i&&l[i];if(a){if(a.events)for(n in a.events)u[n]?ue.event.remove(r,n):ue.removeEvent(r,n,a.handle);if(l[i]){delete l[i];c?delete r[o]:typeof r.removeAttribute!==Y?r.removeAttribute(o):r[o]=null;te.push(i)}}}},_evalUrl:function(e){return ue.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}});ue.fn.extend({wrapAll:function(e){if(ue.isFunction(e))return this.each(function(t){ue(this).wrapAll(e.call(this,t))});if(this[0]){var t=ue(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(ue.isFunction(e)?function(t){ue(this).wrapInner(e.call(this,t))}:function(){var t=ue(this),r=t.contents();r.length?r.wrapAll(e):t.append(e)})},wrap:function(e){var t=ue.isFunction(e);return this.each(function(r){ue(this).wrapAll(t?e.call(this,r):e)})},unwrap:function(){return this.parent().each(function(){ue.nodeName(this,"body")||ue(this).replaceWith(this.childNodes)}).end()}});var ct,ut,pt,ht=/alpha\([^)]*\)/i,dt=/opacity\s*=\s*([^)]*)/,ft=/^(top|right|bottom|left)$/,mt=/^(none|table(?!-c[ea]).+)/,yt=/^margin/,gt=new RegExp("^("+pe+")(.*)$","i"),vt=new RegExp("^("+pe+")(?!px)[a-z%]+$","i"),Ct=new RegExp("^([+-])=("+pe+")","i"),Tt={BODY:"block"},Lt={position:"absolute",visibility:"hidden",display:"block"},wt={letterSpacing:0,fontWeight:400},bt=["Top","Right","Bottom","Left"],St=["Webkit","O","Moz","ms"];ue.fn.extend({css:function(e,r){return ue.access(this,function(e,r,n){var i,a,s={},o=0;if(ue.isArray(r)){a=ut(e);i=r.length;for(;i>o;o++)s[r[o]]=ue.css(e,r[o],!1,a);return s}return n!==t?ue.style(e,r,n):ue.css(e,r)},e,r,arguments.length>1)},show:function(){return S(this,!0)},hide:function(){return S(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){b(this)?ue(this).show():ue(this).hide()})}});ue.extend({cssHooks:{opacity:{get:function(e,t){if(t){var r=pt(e,"opacity");return""===r?"1":r}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ue.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,r,n,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,s,o,l=ue.camelCase(r),c=e.style;r=ue.cssProps[l]||(ue.cssProps[l]=w(c,l));o=ue.cssHooks[r]||ue.cssHooks[l];if(n===t)return o&&"get"in o&&(a=o.get(e,!1,i))!==t?a:c[r];s=typeof n;if("string"===s&&(a=Ct.exec(n))){n=(a[1]+1)*a[2]+parseFloat(ue.css(e,r));s="number"}if(!(null==n||"number"===s&&isNaN(n))){"number"!==s||ue.cssNumber[l]||(n+="px");ue.support.clearCloneStyle||""!==n||0!==r.indexOf("background")||(c[r]="inherit");if(!(o&&"set"in o&&(n=o.set(e,n,i))===t))try{c[r]=n}catch(u){}}}},css:function(e,r,n,i){var a,s,o,l=ue.camelCase(r);r=ue.cssProps[l]||(ue.cssProps[l]=w(e.style,l));o=ue.cssHooks[r]||ue.cssHooks[l];o&&"get"in o&&(s=o.get(e,!0,n));s===t&&(s=pt(e,r,i));"normal"===s&&r in wt&&(s=wt[r]);if(""===n||n){a=parseFloat(s);return n===!0||ue.isNumeric(a)?a||0:s}return s}});if(e.getComputedStyle){ut=function(t){return e.getComputedStyle(t,null)};pt=function(e,r,n){var i,a,s,o=n||ut(e),l=o?o.getPropertyValue(r)||o[r]:t,c=e.style;if(o){""!==l||ue.contains(e.ownerDocument,e)||(l=ue.style(e,r));if(vt.test(l)&&yt.test(r)){i=c.width;a=c.minWidth;s=c.maxWidth;c.minWidth=c.maxWidth=c.width=l;l=o.width;c.width=i;c.minWidth=a;c.maxWidth=s}}return l}}else if(K.documentElement.currentStyle){ut=function(e){return e.currentStyle};pt=function(e,r,n){var i,a,s,o=n||ut(e),l=o?o[r]:t,c=e.style;null==l&&c&&c[r]&&(l=c[r]);if(vt.test(l)&&!ft.test(r)){i=c.left;a=e.runtimeStyle;s=a&&a.left;s&&(a.left=e.currentStyle.left);c.left="fontSize"===r?"1em":l;l=c.pixelLeft+"px";c.left=i;s&&(a.left=s)}return""===l?"auto":l}}ue.each(["height","width"],function(e,t){ue.cssHooks[t]={get:function(e,r,n){return r?0===e.offsetWidth&&mt.test(ue.css(e,"display"))?ue.swap(e,Lt,function(){return A(e,t,n)}):A(e,t,n):void 0},set:function(e,r,n){var i=n&&ut(e);return E(e,r,n?O(e,t,n,ue.support.boxSizing&&"border-box"===ue.css(e,"boxSizing",!1,i),i):0)}}});ue.support.opacity||(ue.cssHooks.opacity={get:function(e,t){return dt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var r=e.style,n=e.currentStyle,i=ue.isNumeric(t)?"alpha(opacity="+100*t+")":"",a=n&&n.filter||r.filter||"";r.zoom=1;if((t>=1||""===t)&&""===ue.trim(a.replace(ht,""))&&r.removeAttribute){r.removeAttribute("filter");if(""===t||n&&!n.filter)return}r.filter=ht.test(a)?a.replace(ht,i):a+" "+i}});ue(function(){ue.support.reliableMarginRight||(ue.cssHooks.marginRight={get:function(e,t){return t?ue.swap(e,{display:"inline-block"},pt,[e,"marginRight"]):void 0}});!ue.support.pixelPosition&&ue.fn.position&&ue.each(["top","left"],function(e,t){ue.cssHooks[t]={get:function(e,r){if(r){r=pt(e,t);return vt.test(r)?ue(e).position()[t]+"px":r}}}})});if(ue.expr&&ue.expr.filters){ue.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!ue.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||ue.css(e,"display"))};ue.expr.filters.visible=function(e){return!ue.expr.filters.hidden(e)}}ue.each({margin:"",padding:"",border:"Width"},function(e,t){ue.cssHooks[e+t]={expand:function(r){for(var n=0,i={},a="string"==typeof r?r.split(" "):[r];4>n;n++)i[e+bt[n]+t]=a[n]||a[n-2]||a[0];return i}};yt.test(e)||(ue.cssHooks[e+t].set=E)});var Et=/%20/g,Ot=/\[\]$/,At=/\r?\n/g,xt=/^(?:submit|button|image|reset|file)$/i,Pt=/^(?:input|select|textarea|keygen)/i;ue.fn.extend({serialize:function(){return ue.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ue.prop(this,"elements");return e?ue.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ue(this).is(":disabled")&&Pt.test(this.nodeName)&&!xt.test(e)&&(this.checked||!tt.test(e))}).map(function(e,t){var r=ue(this).val();return null==r?null:ue.isArray(r)?ue.map(r,function(e){return{name:t.name,value:e.replace(At,"\r\n")}}):{name:t.name,value:r.replace(At,"\r\n")}}).get()}});ue.param=function(e,r){var n,i=[],a=function(e,t){t=ue.isFunction(t)?t():null==t?"":t;i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};r===t&&(r=ue.ajaxSettings&&ue.ajaxSettings.traditional);if(ue.isArray(e)||e.jquery&&!ue.isPlainObject(e))ue.each(e,function(){a(this.name,this.value)});else for(n in e)_(n,e[n],r,a);return i.join("&").replace(Et,"+")};ue.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ue.fn[t]=function(e,r){return arguments.length>0?this.on(t,null,e,r):this.trigger(t)}});ue.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,r){return this.on(e,null,t,r)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,r,n){return this.on(t,e,r,n)},undelegate:function(e,t,r){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",r)}});var _t,Nt,Mt=ue.now(),kt=/\?/,Rt=/#.*$/,It=/([?&])_=[^&]*/,Dt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Ft=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,$t=/^(?:GET|HEAD)$/,Bt=/^\/\//,jt=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,Ut=ue.fn.load,Gt={},zt={},Ht="*/".concat("*");try{Nt=X.href}catch(Wt){Nt=K.createElement("a");Nt.href="";Nt=Nt.href}_t=jt.exec(Nt.toLowerCase())||[];ue.fn.load=function(e,r,n){if("string"!=typeof e&&Ut)return Ut.apply(this,arguments);var i,a,s,o=this,l=e.indexOf(" ");if(l>=0){i=e.slice(l,e.length);e=e.slice(0,l)}if(ue.isFunction(r)){n=r;r=t}else r&&"object"==typeof r&&(s="POST");o.length>0&&ue.ajax({url:e,type:s,dataType:"html",data:r}).done(function(e){a=arguments;o.html(i?ue("<div>").append(ue.parseHTML(e)).find(i):e)}).complete(n&&function(e,t){o.each(n,a||[e.responseText,t,e])});return this};ue.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ue.fn[t]=function(e){return this.on(t,e)}});ue.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Nt,type:"GET",isLocal:Ft.test(_t[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Ht,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ue.parseJSON,"text xml":ue.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?k(k(e,ue.ajaxSettings),t):k(ue.ajaxSettings,e)},ajaxPrefilter:N(Gt),ajaxTransport:N(zt),ajax:function(e,r){function n(e,r,n,i){var a,p,v,C,L,b=r;if(2!==T){T=2;l&&clearTimeout(l);u=t;o=i||"";w.readyState=e>0?4:0;a=e>=200&&300>e||304===e;n&&(C=R(h,w,n));C=I(h,C,w,a);if(a){if(h.ifModified){L=w.getResponseHeader("Last-Modified");L&&(ue.lastModified[s]=L);L=w.getResponseHeader("etag");L&&(ue.etag[s]=L)}if(204===e||"HEAD"===h.type)b="nocontent";else if(304===e)b="notmodified";else{b=C.state;p=C.data;v=C.error;a=!v}}else{v=b;if(e||!b){b="error";0>e&&(e=0)}}w.status=e;w.statusText=(r||b)+"";a?m.resolveWith(d,[p,b,w]):m.rejectWith(d,[w,b,v]);w.statusCode(g);g=t;c&&f.trigger(a?"ajaxSuccess":"ajaxError",[w,h,a?p:v]);y.fireWith(d,[w,b]);if(c){f.trigger("ajaxComplete",[w,h]);--ue.active||ue.event.trigger("ajaxStop")}}}if("object"==typeof e){r=e;e=t}r=r||{};var i,a,s,o,l,c,u,p,h=ue.ajaxSetup({},r),d=h.context||h,f=h.context&&(d.nodeType||d.jquery)?ue(d):ue.event,m=ue.Deferred(),y=ue.Callbacks("once memory"),g=h.statusCode||{},v={},C={},T=0,L="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===T){if(!p){p={};for(;t=Dt.exec(o);)p[t[1].toLowerCase()]=t[2]}t=p[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===T?o:null},setRequestHeader:function(e,t){var r=e.toLowerCase();if(!T){e=C[r]=C[r]||e;v[e]=t}return this},overrideMimeType:function(e){T||(h.mimeType=e);return this},statusCode:function(e){var t;if(e)if(2>T)for(t in e)g[t]=[g[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||L;u&&u.abort(t);n(0,t);return this}};m.promise(w).complete=y.add;w.success=w.done;w.error=w.fail;h.url=((e||h.url||Nt)+"").replace(Rt,"").replace(Bt,_t[1]+"//");h.type=r.method||r.type||h.method||h.type;h.dataTypes=ue.trim(h.dataType||"*").toLowerCase().match(he)||[""];if(null==h.crossDomain){i=jt.exec(h.url.toLowerCase());h.crossDomain=!(!i||i[1]===_t[1]&&i[2]===_t[2]&&(i[3]||("http:"===i[1]?"80":"443"))===(_t[3]||("http:"===_t[1]?"80":"443")))}h.data&&h.processData&&"string"!=typeof h.data&&(h.data=ue.param(h.data,h.traditional));

M(Gt,h,r,w);if(2===T)return w;c=h.global;c&&0===ue.active++&&ue.event.trigger("ajaxStart");h.type=h.type.toUpperCase();h.hasContent=!$t.test(h.type);s=h.url;if(!h.hasContent){if(h.data){s=h.url+=(kt.test(s)?"&":"?")+h.data;delete h.data}h.cache===!1&&(h.url=It.test(s)?s.replace(It,"$1_="+Mt++):s+(kt.test(s)?"&":"?")+"_="+Mt++)}if(h.ifModified){ue.lastModified[s]&&w.setRequestHeader("If-Modified-Since",ue.lastModified[s]);ue.etag[s]&&w.setRequestHeader("If-None-Match",ue.etag[s])}(h.data&&h.hasContent&&h.contentType!==!1||r.contentType)&&w.setRequestHeader("Content-Type",h.contentType);w.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+Ht+"; q=0.01":""):h.accepts["*"]);for(a in h.headers)w.setRequestHeader(a,h.headers[a]);if(h.beforeSend&&(h.beforeSend.call(d,w,h)===!1||2===T))return w.abort();L="abort";for(a in{success:1,error:1,complete:1})w[a](h[a]);u=M(zt,h,r,w);if(u){w.readyState=1;c&&f.trigger("ajaxSend",[w,h]);h.async&&h.timeout>0&&(l=setTimeout(function(){w.abort("timeout")},h.timeout));try{T=1;u.send(v,n)}catch(b){if(!(2>T))throw b;n(-1,b)}}else n(-1,"No Transport");return w},getJSON:function(e,t,r){return ue.get(e,t,r,"json")},getScript:function(e,r){return ue.get(e,t,r,"script")}});ue.each(["get","post"],function(e,r){ue[r]=function(e,n,i,a){if(ue.isFunction(n)){a=a||i;i=n;n=t}return ue.ajax({url:e,type:r,dataType:a,data:n,success:i})}});ue.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){ue.globalEval(e);return e}}});ue.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1);if(e.crossDomain){e.type="GET";e.global=!1}});ue.ajaxTransport("script",function(e){if(e.crossDomain){var r,n=K.head||ue("head")[0]||K.documentElement;return{send:function(t,i){r=K.createElement("script");r.async=!0;e.scriptCharset&&(r.charset=e.scriptCharset);r.src=e.url;r.onload=r.onreadystatechange=function(e,t){if(t||!r.readyState||/loaded|complete/.test(r.readyState)){r.onload=r.onreadystatechange=null;r.parentNode&&r.parentNode.removeChild(r);r=null;t||i(200,"success")}};n.insertBefore(r,n.firstChild)},abort:function(){r&&r.onload(t,!0)}}}});var Vt=[],qt=/(=)\?(?=&|$)|\?\?/;ue.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Vt.pop()||ue.expando+"_"+Mt++;this[e]=!0;return e}});ue.ajaxPrefilter("json jsonp",function(r,n,i){var a,s,o,l=r.jsonp!==!1&&(qt.test(r.url)?"url":"string"==typeof r.data&&!(r.contentType||"").indexOf("application/x-www-form-urlencoded")&&qt.test(r.data)&&"data");if(l||"jsonp"===r.dataTypes[0]){a=r.jsonpCallback=ue.isFunction(r.jsonpCallback)?r.jsonpCallback():r.jsonpCallback;l?r[l]=r[l].replace(qt,"$1"+a):r.jsonp!==!1&&(r.url+=(kt.test(r.url)?"&":"?")+r.jsonp+"="+a);r.converters["script json"]=function(){o||ue.error(a+" was not called");return o[0]};r.dataTypes[0]="json";s=e[a];e[a]=function(){o=arguments};i.always(function(){e[a]=s;if(r[a]){r.jsonpCallback=n.jsonpCallback;Vt.push(a)}o&&ue.isFunction(s)&&s(o[0]);o=s=t});return"script"}});var Yt,Xt,Kt=0,Jt=e.ActiveXObject&&function(){var e;for(e in Yt)Yt[e](t,!0)};ue.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&D()||F()}:D;Xt=ue.ajaxSettings.xhr();ue.support.cors=!!Xt&&"withCredentials"in Xt;Xt=ue.support.ajax=!!Xt;Xt&&ue.ajaxTransport(function(r){if(!r.crossDomain||ue.support.cors){var n;return{send:function(i,a){var s,o,l=r.xhr();r.username?l.open(r.type,r.url,r.async,r.username,r.password):l.open(r.type,r.url,r.async);if(r.xhrFields)for(o in r.xhrFields)l[o]=r.xhrFields[o];r.mimeType&&l.overrideMimeType&&l.overrideMimeType(r.mimeType);r.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(o in i)l.setRequestHeader(o,i[o])}catch(c){}l.send(r.hasContent&&r.data||null);n=function(e,i){var o,c,u,p;try{if(n&&(i||4===l.readyState)){n=t;if(s){l.onreadystatechange=ue.noop;Jt&&delete Yt[s]}if(i)4!==l.readyState&&l.abort();else{p={};o=l.status;c=l.getAllResponseHeaders();"string"==typeof l.responseText&&(p.text=l.responseText);try{u=l.statusText}catch(h){u=""}o||!r.isLocal||r.crossDomain?1223===o&&(o=204):o=p.text?200:404}}}catch(d){i||a(-1,d)}p&&a(o,u,p,c)};if(r.async)if(4===l.readyState)setTimeout(n);else{s=++Kt;if(Jt){if(!Yt){Yt={};ue(e).unload(Jt)}Yt[s]=n}l.onreadystatechange=n}else n()},abort:function(){n&&n(t,!0)}}}});var Zt,Qt,er=/^(?:toggle|show|hide)$/,tr=new RegExp("^(?:([+-])=|)("+pe+")([a-z%]*)$","i"),rr=/queueHooks$/,nr=[G],ir={"*":[function(e,t){var r=this.createTween(e,t),n=r.cur(),i=tr.exec(t),a=i&&i[3]||(ue.cssNumber[e]?"":"px"),s=(ue.cssNumber[e]||"px"!==a&&+n)&&tr.exec(ue.css(r.elem,e)),o=1,l=20;if(s&&s[3]!==a){a=a||s[3];i=i||[];s=+n||1;do{o=o||".5";s/=o;ue.style(r.elem,e,s+a)}while(o!==(o=r.cur()/n)&&1!==o&&--l)}if(i){s=r.start=+s||+n||0;r.unit=a;r.end=i[1]?s+(i[1]+1)*i[2]:+i[2]}return r}]};ue.Animation=ue.extend(j,{tweener:function(e,t){if(ue.isFunction(e)){t=e;e=["*"]}else e=e.split(" ");for(var r,n=0,i=e.length;i>n;n++){r=e[n];ir[r]=ir[r]||[];ir[r].unshift(t)}},prefilter:function(e,t){t?nr.unshift(e):nr.push(e)}});ue.Tween=z;z.prototype={constructor:z,init:function(e,t,r,n,i,a){this.elem=e;this.prop=r;this.easing=i||"swing";this.options=t;this.start=this.now=this.cur();this.end=n;this.unit=a||(ue.cssNumber[r]?"":"px")},cur:function(){var e=z.propHooks[this.prop];return e&&e.get?e.get(this):z.propHooks._default.get(this)},run:function(e){var t,r=z.propHooks[this.prop];this.pos=t=this.options.duration?ue.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e;this.now=(this.end-this.start)*t+this.start;this.options.step&&this.options.step.call(this.elem,this.now,this);r&&r.set?r.set(this):z.propHooks._default.set(this);return this}};z.prototype.init.prototype=z.prototype;z.propHooks={_default:{get:function(e){var t;if(null!=e.elem[e.prop]&&(!e.elem.style||null==e.elem.style[e.prop]))return e.elem[e.prop];t=ue.css(e.elem,e.prop,"");return t&&"auto"!==t?t:0},set:function(e){ue.fx.step[e.prop]?ue.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ue.cssProps[e.prop]]||ue.cssHooks[e.prop])?ue.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}};z.propHooks.scrollTop=z.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}};ue.each(["toggle","show","hide"],function(e,t){var r=ue.fn[t];ue.fn[t]=function(e,n,i){return null==e||"boolean"==typeof e?r.apply(this,arguments):this.animate(H(t,!0),e,n,i)}});ue.fn.extend({fadeTo:function(e,t,r,n){return this.filter(b).css("opacity",0).show().end().animate({opacity:t},e,r,n)},animate:function(e,t,r,n){var i=ue.isEmptyObject(e),a=ue.speed(t,r,n),s=function(){var t=j(this,ue.extend({},e),a);(i||ue._data(this,"finish"))&&t.stop(!0)};s.finish=s;return i||a.queue===!1?this.each(s):this.queue(a.queue,s)},stop:function(e,r,n){var i=function(e){var t=e.stop;delete e.stop;t(n)};if("string"!=typeof e){n=r;r=e;e=t}r&&e!==!1&&this.queue(e||"fx",[]);return this.each(function(){var t=!0,r=null!=e&&e+"queueHooks",a=ue.timers,s=ue._data(this);if(r)s[r]&&s[r].stop&&i(s[r]);else for(r in s)s[r]&&s[r].stop&&rr.test(r)&&i(s[r]);for(r=a.length;r--;)if(a[r].elem===this&&(null==e||a[r].queue===e)){a[r].anim.stop(n);t=!1;a.splice(r,1)}(t||!n)&&ue.dequeue(this,e)})},finish:function(e){e!==!1&&(e=e||"fx");return this.each(function(){var t,r=ue._data(this),n=r[e+"queue"],i=r[e+"queueHooks"],a=ue.timers,s=n?n.length:0;r.finish=!0;ue.queue(this,e,[]);i&&i.stop&&i.stop.call(this,!0);for(t=a.length;t--;)if(a[t].elem===this&&a[t].queue===e){a[t].anim.stop(!0);a.splice(t,1)}for(t=0;s>t;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete r.finish})}});ue.each({slideDown:H("show"),slideUp:H("hide"),slideToggle:H("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ue.fn[e]=function(e,r,n){return this.animate(t,e,r,n)}});ue.speed=function(e,t,r){var n=e&&"object"==typeof e?ue.extend({},e):{complete:r||!r&&t||ue.isFunction(e)&&e,duration:e,easing:r&&t||t&&!ue.isFunction(t)&&t};n.duration=ue.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in ue.fx.speeds?ue.fx.speeds[n.duration]:ue.fx.speeds._default;(null==n.queue||n.queue===!0)&&(n.queue="fx");n.old=n.complete;n.complete=function(){ue.isFunction(n.old)&&n.old.call(this);n.queue&&ue.dequeue(this,n.queue)};return n};ue.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}};ue.timers=[];ue.fx=z.prototype.init;ue.fx.tick=function(){var e,r=ue.timers,n=0;Zt=ue.now();for(;n<r.length;n++){e=r[n];e()||r[n]!==e||r.splice(n--,1)}r.length||ue.fx.stop();Zt=t};ue.fx.timer=function(e){e()&&ue.timers.push(e)&&ue.fx.start()};ue.fx.interval=13;ue.fx.start=function(){Qt||(Qt=setInterval(ue.fx.tick,ue.fx.interval))};ue.fx.stop=function(){clearInterval(Qt);Qt=null};ue.fx.speeds={slow:600,fast:200,_default:400};ue.fx.step={};ue.expr&&ue.expr.filters&&(ue.expr.filters.animated=function(e){return ue.grep(ue.timers,function(t){return e===t.elem}).length});ue.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){ue.offset.setOffset(this,e,t)});var r,n,i={top:0,left:0},a=this[0],s=a&&a.ownerDocument;if(s){r=s.documentElement;if(!ue.contains(r,a))return i;typeof a.getBoundingClientRect!==Y&&(i=a.getBoundingClientRect());n=W(s);return{top:i.top+(n.pageYOffset||r.scrollTop)-(r.clientTop||0),left:i.left+(n.pageXOffset||r.scrollLeft)-(r.clientLeft||0)}}};ue.offset={setOffset:function(e,t,r){var n=ue.css(e,"position");"static"===n&&(e.style.position="relative");var i,a,s=ue(e),o=s.offset(),l=ue.css(e,"top"),c=ue.css(e,"left"),u=("absolute"===n||"fixed"===n)&&ue.inArray("auto",[l,c])>-1,p={},h={};if(u){h=s.position();i=h.top;a=h.left}else{i=parseFloat(l)||0;a=parseFloat(c)||0}ue.isFunction(t)&&(t=t.call(e,r,o));null!=t.top&&(p.top=t.top-o.top+i);null!=t.left&&(p.left=t.left-o.left+a);"using"in t?t.using.call(e,p):s.css(p)}};ue.fn.extend({position:function(){if(this[0]){var e,t,r={top:0,left:0},n=this[0];if("fixed"===ue.css(n,"position"))t=n.getBoundingClientRect();else{e=this.offsetParent();t=this.offset();ue.nodeName(e[0],"html")||(r=e.offset());r.top+=ue.css(e[0],"borderTopWidth",!0);r.left+=ue.css(e[0],"borderLeftWidth",!0)}return{top:t.top-r.top-ue.css(n,"marginTop",!0),left:t.left-r.left-ue.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||J;e&&!ue.nodeName(e,"html")&&"static"===ue.css(e,"position");)e=e.offsetParent;return e||J})}});ue.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,r){var n=/Y/.test(r);ue.fn[e]=function(i){return ue.access(this,function(e,i,a){var s=W(e);if(a===t)return s?r in s?s[r]:s.document.documentElement[i]:e[i];s?s.scrollTo(n?ue(s).scrollLeft():a,n?a:ue(s).scrollTop()):e[i]=a;return void 0},e,i,arguments.length,null)}});ue.each({Height:"height",Width:"width"},function(e,r){ue.each({padding:"inner"+e,content:r,"":"outer"+e},function(n,i){ue.fn[i]=function(i,a){var s=arguments.length&&(n||"boolean"!=typeof i),o=n||(i===!0||a===!0?"margin":"border");return ue.access(this,function(r,n,i){var a;if(ue.isWindow(r))return r.document.documentElement["client"+e];if(9===r.nodeType){a=r.documentElement;return Math.max(r.body["scroll"+e],a["scroll"+e],r.body["offset"+e],a["offset"+e],a["client"+e])}return i===t?ue.css(r,n,o):ue.style(r,n,i,o)},r,s?i:t,s,null)}})});ue.fn.size=function(){return this.length};ue.fn.andSelf=ue.fn.addBack;if("object"==typeof module&&module&&"object"==typeof module.exports)module.exports=ue;else{e.jQuery=e.$=ue;"function"==typeof define&&define.amd&&define("jquery",[],function(){return ue})}}(window);!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(e){if(!e.support.cors&&e.ajaxTransport&&window.XDomainRequest){var t=/^https?:\/\//i,r=/^get|post$/i,n=new RegExp("^"+location.protocol,"i");e.ajaxTransport("* text html xml json",function(i,a,s){if(i.crossDomain&&i.async&&r.test(i.type)&&t.test(i.url)&&n.test(i.url)){var o=null;return{send:function(t,r){var n="",s=(a.dataType||"").toLowerCase();o=new XDomainRequest;/^\d+$/.test(a.timeout)&&(o.timeout=a.timeout);o.ontimeout=function(){r(500,"timeout")};o.onload=function(){var t="Content-Length: "+o.responseText.length+"\r\nContent-Type: "+o.contentType,n={code:200,message:"success"},i={text:o.responseText};try{if("html"===s||/text\/html/i.test(o.contentType))i.html=o.responseText;else if("json"===s||"text"!==s&&/\/json/i.test(o.contentType))try{i.json=e.parseJSON(o.responseText)}catch(a){n.code=500;n.message="parseerror"}else if("xml"===s||"text"!==s&&/\/xml/i.test(o.contentType)){var l=new ActiveXObject("Microsoft.XMLDOM");l.async=!1;try{l.loadXML(o.responseText)}catch(a){l=void 0}if(!l||!l.documentElement||l.getElementsByTagName("parsererror").length){n.code=500;n.message="parseerror";throw"Invalid XML: "+o.responseText}i.xml=l}}catch(c){throw c}finally{r(n.code,n.message,i,t)}};o.onprogress=function(){};o.onerror=function(){r(500,"error",{text:o.responseText})};a.data&&(n="string"===e.type(a.data)?a.data:e.param(a.data));o.open(i.type,i.url);o.send(n)},abort:function(){o&&o.abort()}}}})}});!function(e){"use strict";var t=({defaults:{method:"GET",cancelRequests:!1,target:e(),source:null,callback:null,link:null,minLength:0,matchFromStart:!0},openXHR:{},cache:{}},function(t,n,i){var a=[];if(n)if(i.buildHTML)e(i.target).html(i.buildHTML({results:n}));else{for(var s=0;s<n.length;s++){var o=n[s];a[a.length]=e.isPlainObject(o)?'<li><a href="'+i.link+encodeURIComponent(o.id)+'">'+o.label+"</a></li>":'<li><a href="'+i.link+encodeURIComponent(o)+'">'+o+"</a></li>"}e(i.target).html(a.join(""))}null!==i.callback&&e.isFunction(i.callback)&&r(i);t.trigger(t.val().length>0?"targetUpdated.autocomplete":"targetCleared.autocomplete")}),r=function(t){e("li a",e(t.target)).on("click.autocomplete",function(e){e.stopPropagation();e.preventDefault();t.callback(e)})},n=function(e,t){t.html("").closest("fieldset").removeClass("ui-search-active");e.trigger("targetCleared.autocomplete")},i=function(r){var i,a,s,o,l=e(this),c=l.attr("id"),u=l.data("autocomplete");if(u){var p=u.settings,h=u.openXHR;i=l.val();if(i.length<p.minLength)n(l,e(p.target));else if(e.isArray(p.source)){a=p.source.sort().filter(function(t){o=p.matchFromStart?new RegExp("^"+i,"i"):new RegExp(i,"i");s=e.isPlainObject(t)?t.label:t;return o.test(s)});t(l,a,p)}else"function"==typeof p.source?p.source(i,function(e){t(l,e,p)}):e.ajax({type:p.method,url:p.source,data:{term:i},beforeSend:function(e){if(p.cancelRequests){if(h[c])h[c].abort();else{p.target.html('<li><a href="#">Searching...</a></li>');p.target.closest("fieldset").addClass("ui-search-active")}h[c]=e}},success:function(e){t(l,e,p)},complete:function(e,t){p.cancelRequests&&(h[c]=null)},dataType:"json"})}},a={init:function(t){var r=this,a={settings:null};a.settings=e.extend({},a.defaults,t);r.data("autocomplete",a);var s=a.settings;return r.off("keyup.autocomplete").on("keyup.autocomplete",i).next(".ui-input-clear").on("click",function(t){n(r,e(s.target))})},update:function(t){var r=this.data("autocomplete");if(r){r.settings=e.extend(r.settings,t);this.data("autocomplete",r)}return this},clear:function(){var t=this.data("autocomplete");t&&n(this,e(t.settings.target));return this},destroy:function(){var t=this.data("autocomplete");if(t){n(this,e(t.settings.target));this.removeData("autocomplete");this.off(".autocomplete")}return this}};e.fn.autocomplete=function(e){return a[e]?a[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void 0:a.init.apply(this,arguments)}}(jQuery);!function(e){e.fn.drag=function(t,r,n){var i="string"==typeof t?t:"",a=e.isFunction(t)?t:e.isFunction(r)?r:null;0!==i.indexOf("drag")&&(i="drag"+i);n=(t==a?r:n)||{};return a?this.bind(i,n,a):this.trigger(i)};var t=e.event,r=t.special,n=r.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(t){var r=e.data(this,n.datakey),i=t.data||{};r.related+=1;e.each(n.defaults,function(e,t){void 0!==i[e]&&(r[e]=i[e])})},remove:function(){e.data(this,n.datakey).related-=1},setup:function(){if(!e.data(this,n.datakey)){var r=e.extend({related:0},n.defaults);e.data(this,n.datakey,r);t.add(this,"touchstart mousedown",n.init,r);this.attachEvent&&this.attachEvent("ondragstart",n.dontstart)}},teardown:function(){var r=e.data(this,n.datakey)||{};if(!r.related){e.removeData(this,n.datakey);t.remove(this,"touchstart mousedown",n.init);n.textselect(!0);this.detachEvent&&this.detachEvent("ondragstart",n.dontstart)}},init:function(i){if(!n.touched){var a,s=i.data;if(!(0!=i.which&&s.which>0&&i.which!=s.which||e(i.target).is(s.not)||s.handle&&!e(i.target).closest(s.handle,i.currentTarget).length)){n.touched="touchstart"==i.type?this:null;s.propagates=1;s.mousedown=this;s.interactions=[n.interaction(this,s)];s.target=i.target;s.pageX=i.pageX;s.pageY=i.pageY;s.dragging=null;a=n.hijack(i,"draginit",s);if(s.propagates){a=n.flatten(a);if(a&&a.length){s.interactions=[];e.each(a,function(){s.interactions.push(n.interaction(this,s))})}s.propagates=s.interactions.length;s.drop!==!1&&r.drop&&r.drop.handler(i,s);n.textselect(!1);n.touched?t.add(n.touched,"touchmove touchend",n.handler,s):t.add(document,"mousemove mouseup",n.handler,s);return!n.touched||s.live?!1:void 0}}}},interaction:function(t,r){var i=e(t)[r.relative?"position":"offset"]()||{top:0,left:0};return{drag:t,callback:new n.callback,droppable:[],offset:i}},handler:function(i){var a=i.data;switch(i.type){case!a.dragging&&"touchmove":i.preventDefault();case!a.dragging&&"mousemove":if(Math.pow(i.pageX-a.pageX,2)+Math.pow(i.pageY-a.pageY,2)<Math.pow(a.distance,2))break;i.target=a.target;n.hijack(i,"dragstart",a);a.propagates&&(a.dragging=!0);case"touchmove":i.preventDefault();case"mousemove":if(a.dragging){n.hijack(i,"drag",a);if(a.propagates){a.drop!==!1&&r.drop&&r.drop.handler(i,a);break}i.type="mouseup"}case"touchend":case"mouseup":default:n.touched?t.remove(n.touched,"touchmove touchend",n.handler):t.remove(document,"mousemove mouseup",n.handler);if(a.dragging){a.drop!==!1&&r.drop&&r.drop.handler(i,a);n.hijack(i,"dragend",a)}n.textselect(!0);a.click===!1&&a.dragging&&e.data(a.mousedown,"suppress.click",(new Date).getTime()+5);a.dragging=n.touched=!1}},hijack:function(r,i,a,s,o){if(a){var l,c,u,p={event:r.originalEvent,type:r.type},h=i.indexOf("drop")?"drag":"drop",d=s||0,f=isNaN(s)?a.interactions.length:s;r.type=i;r.originalEvent=null;a.results=[];do if(c=a.interactions[d]){if("dragend"!==i&&c.cancelled)continue;u=n.properties(r,a,c);c.results=[];e(o||c[h]||a.droppable).each(function(s,o){u.target=o;r.isPropagationStopped=function(){return!1};l=o?t.dispatch.call(o,r,u):null;if(l===!1){if("drag"==h){c.cancelled=!0;a.propagates-=1}"drop"==i&&(c[h][s]=null)}else"dropinit"==i&&c.droppable.push(n.element(l)||o);"dragstart"==i&&(c.proxy=e(n.element(l)||c.drag)[0]);c.results.push(l);delete r.result;return"dropinit"!==i?l:void 0});a.results[d]=n.flatten(c.results);"dropinit"==i&&(c.droppable=n.flatten(c.droppable));"dragstart"!=i||c.cancelled||u.update()}while(++d<f);r.type=p.type;r.originalEvent=p.event;return n.flatten(a.results)}},properties:function(e,t,r){var i=r.callback;i.drag=r.drag;i.proxy=r.proxy||r.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=r.offset.left;i.originalY=r.offset.top;i.offsetX=i.originalX+i.deltaX;i.offsetY=i.originalY+i.deltaY;i.drop=n.flatten((r.drop||[]).slice());i.available=n.flatten((r.droppable||[]).slice());return i},element:function(e){return e&&(e.jquery||1==e.nodeType)?e:void 0},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?n.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",n.dontstart).css("MozUserSelect",t?"":"none");document.unselectable=t?"off":"on"},dontstart:function(){return!1},callback:function(){}};n.callback.prototype={update:function(){r.drop&&this.available.length&&e.each(this.available,function(e){r.drop.locate(this,e)})}};var i=t.dispatch;t.dispatch=function(t){if(!(e.data(this,"suppress."+t.type)-(new Date).getTime()>0))return i.apply(this,arguments);e.removeData(this,"suppress."+t.type);return void 0};var a=t.fixHooks.touchstart=t.fixHooks.touchmove=t.fixHooks.touchend=t.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(t,r){if(r){var n=r.touches&&r.touches[0]||r.changedTouches&&r.changedTouches[0]||null;n&&e.each(a.props,function(e,r){t[r]=n[r]})}return t}};r.draginit=r.dragstart=r.dragend=n}(jQuery);!function(e){e.fn.drop=function(t,r,n){var i="string"==typeof t?t:"",a=e.isFunction(t)?t:e.isFunction(r)?r:null;0!==i.indexOf("drop")&&(i="drop"+i);n=(t==a?r:n)||{};return a?this.bind(i,n,a):this.trigger(i)};e.drop=function(t){t=t||{};n.multi=t.multi===!0?1/0:t.multi===!1?1:isNaN(t.multi)?n.multi:t.multi;n.delay=t.delay||n.delay;n.tolerance=e.isFunction(t.tolerance)?t.tolerance:null===t.tolerance?null:n.tolerance;n.mode=t.mode||n.mode||"intersect"};var t=e.event,r=t.special,n=e.event.special.drop={multi:1,delay:20,mode:"overlap",targets:[],datakey:"dropdata",noBubble:!0,add:function(t){var r=e.data(this,n.datakey);r.related+=1},remove:function(){e.data(this,n.datakey).related-=1},setup:function(){if(!e.data(this,n.datakey)){var t={related:0,active:[],anyactive:0,winner:0,location:{}};e.data(this,n.datakey,t);n.targets.push(this)}},teardown:function(){var t=e.data(this,n.datakey)||{};if(!t.related){e.removeData(this,n.datakey);var r=this;n.targets=e.grep(n.targets,function(e){return e!==r})}},handler:function(t,i){var a;if(i)switch(t.type){case"mousedown":case"touchstart":a=e(n.targets);"string"==typeof i.drop&&(a=a.filter(i.drop));a.each(function(){var t=e.data(this,n.datakey);t.active=[];t.anyactive=0;t.winner=0});i.droppable=a;r.drag.hijack(t,"dropinit",i);break;case"mousemove":case"touchmove":n.event=t;n.timer||n.tolerate(i);break;case"mouseup":case"touchend":n.timer=clearTimeout(n.timer);if(i.propagates){r.drag.hijack(t,"drop",i);r.drag.hijack(t,"dropend",i)}}},locate:function(t,r){var i=e.data(t,n.datakey),a=e(t),s=a.offset()||{},o=a.outerHeight(),l=a.outerWidth(),c={elem:t,width:l,height:o,top:s.top,left:s.left,right:s.left+l,bottom:s.top+o};if(i){i.location=c;i.index=r;i.elem=t}return c},contains:function(e,t){return(t[0]||t.left)>=e.left&&(t[0]||t.right)<=e.right&&(t[1]||t.top)>=e.top&&(t[1]||t.bottom)<=e.bottom},modes:{intersect:function(e,t,r){return this.contains(r,[e.pageX,e.pageY])?1e9:this.modes.overlap.apply(this,arguments)},overlap:function(e,t,r){return Math.max(0,Math.min(r.bottom,t.bottom)-Math.max(r.top,t.top))*Math.max(0,Math.min(r.right,t.right)-Math.max(r.left,t.left))},fit:function(e,t,r){return this.contains(r,t)?1:0},middle:function(e,t,r){return this.contains(r,[t.left+.5*t.width,t.top+.5*t.height])?1:0}},sort:function(e,t){return t.winner-e.winner||e.index-t.index},tolerate:function(t){var i,a,s,o,l,c,u,p,h=0,d=t.interactions.length,f=[n.event.pageX,n.event.pageY],m=n.tolerance||n.modes[n.mode];do if(p=t.interactions[h]){if(!p)return;p.drop=[];l=[];c=p.droppable.length;m&&(s=n.locate(p.proxy));i=0;do if(u=p.droppable[i]){o=e.data(u,n.datakey);a=o.location;if(!a)continue;o.winner=m?m.call(n,n.event,s,a):n.contains(a,f)?1:0;l.push(o)}while(++i<c);l.sort(n.sort);i=0;do if(o=l[i])if(o.winner&&p.drop.length<n.multi){if(!o.active[h]&&!o.anyactive)if(r.drag.hijack(n.event,"dropstart",t,h,o.elem)[0]!==!1){o.active[h]=1;o.anyactive+=1}else o.winner=0;o.winner&&p.drop.push(o.elem)}else if(o.active[h]&&1==o.anyactive){r.drag.hijack(n.event,"dropend",t,h,o.elem);o.active[h]=0;o.anyactive-=1}while(++i<c)}while(++h<d);n.last&&f[0]==n.last.pageX&&f[1]==n.last.pageY?delete n.timer:n.timer=setTimeout(function(){n.tolerate(t)},n.delay);n.last=n.event}};r.dropinit=r.dropstart=r.dropend=n}(jQuery);!function(e,t){e.fn.track=function(r){function n(t,r,n){t.each(function(){var t=e(this);if(window.MutationObserver){var r=t.data("__watcherObserver");if(null==r){r=new MutationObserver(n.fnc);t.data("__watcherObserver",r)}r.observe(this,{attributes:!0,subtree:a.watchChildren,childList:a.watchChildren,characterData:!0})}else n.intervalId=setInterval(n.fnc,interval)})}function i(r){var i=e(this),a=i.data(r);if(a){var s=this;if(a.func){var o=!1,l=0;for(l;l<a.props.length;l++){var c=a.props[l],u="";u=c.startsWith("attr_")?i.attr(c.replace("attr_","")):i.css(c);if(u!=t&&a.vals[l]!=u){a.vals[l]=u;o=!0;break}}if(o){i.untrack(r);a.func.call(s,a,l);n(i,r,a)}}}}var a=e.extend({properties:null,interval:100,id:"_watcher",watchChildren:!1,callback:null},r);return this.each(function(){var t=this,r=e(this),s=function(e,r){i.call(t,a.id)},o={id:a.id,props:a.properties.split(","),vals:[a.properties.split(",").length],func:a.callback,fnc:s,origProps:a.properties,interval:a.interval,intervalId:null};e.each(o.props,function(e){o.vals[e]=r.css(o.props[e])});r.data(a.id,o);n(r,a.id,o)})};e.fn.untrack=function(t){this.each(function(){var r=e(this),n=r.data(t);try{if(window.MutationObserver){var i=r.data("__watcherObserver");if(i){i.disconnect();r.removeData("__watcherObserver")}}else clearInterval(n.intervalId)}catch(a){}});return this};String.prototype.startsWith=function(e){return 0==this.length?!1:e==this.substr(0,e.length)}}(jQuery,void 0);var QRCode;!function(){function e(e){this.mode=c.MODE_8BIT_BYTE,this.data=e,this.parsedData=[];for(var t=[],r=0,n=this.data.length;n>r;r++){var i=this.data.charCodeAt(r);i>65536?(t[0]=240|(1835008&i)>>>18,t[1]=128|(258048&i)>>>12,t[2]=128|(4032&i)>>>6,t[3]=128|63&i):i>2048?(t[0]=224|(61440&i)>>>12,t[1]=128|(4032&i)>>>6,t[2]=128|63&i):i>128?(t[0]=192|(1984&i)>>>6,t[1]=128|63&i):t[0]=i,this.parsedData=this.parsedData.concat(t)}this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function t(e,t){this.typeNumber=e,this.errorCorrectLevel=t,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function r(e,t){if(void 0==e.length)throw new Error(e.length+"/"+t);for(var r=0;r<e.length&&0==e[r];)r++;this.num=new Array(e.length-r+t);for(var n=0;n<e.length-r;n++)this.num[n]=e[n+r]}function n(e,t){this.totalCount=e,this.dataCount=t}function i(){this.buffer=[],this.length=0}function a(){return"undefined"!=typeof CanvasRenderingContext2D}function s(){var e=!1,t=navigator.userAgent;return/android/i.test(t)&&(e=!0,aMat=t.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(e=parseFloat(aMat[1]))),e}function o(e,t){for(var r=1,n=l(e),i=0,a=m.length;a>=i;i++){var s=0;switch(t){case u.L:s=m[i][0];break;case u.M:s=m[i][1];break;case u.Q:s=m[i][2];break;case u.H:s=m[i][3]}if(s>=n)break;r++}if(r>m.length)throw new Error("Too long data");return r}function l(e){var t=encodeURI(e).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return t.length+(t.length!=e?3:0)}e.prototype={getLength:function(){return this.parsedData.length},write:function(e){for(var t=0,r=this.parsedData.length;r>t;t++)e.put(this.parsedData[t],8)}},t.prototype={addData:function(t){var r=new e(t);this.dataList.push(r),this.dataCache=null},isDark:function(e,t){if(0>e||this.moduleCount<=e||0>t||this.moduleCount<=t)throw new Error(e+","+t);return this.modules[e][t]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(e,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++){this.modules[n]=new Array(this.moduleCount);for(var i=0;i<this.moduleCount;i++)this.modules[n][i]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(e,r),this.typeNumber>=7&&this.setupTypeNumber(e),null==this.dataCache&&(this.dataCache=t.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(e,t){for(var r=-1;7>=r;r++)if(!(-1>=e+r||this.moduleCount<=e+r))for(var n=-1;7>=n;n++)-1>=t+n||this.moduleCount<=t+n||(this.modules[e+r][t+n]=r>=0&&6>=r&&(0==n||6==n)||n>=0&&6>=n&&(0==r||6==r)||r>=2&&4>=r&&n>=2&&4>=n?!0:!1)},getBestMaskPattern:function(){for(var e=0,t=0,r=0;8>r;r++){this.makeImpl(!0,r);var n=h.getLostPoint(this);(0==r||e>n)&&(e=n,t=r)}return t},createMovieClip:function(e,t,r){var n=e.createEmptyMovieClip(t,r),i=1;this.make();for(var a=0;a<this.modules.length;a++)for(var s=a*i,o=0;o<this.modules[a].length;o++){var l=o*i,c=this.modules[a][o];c&&(n.beginFill(0,100),n.moveTo(l,s),n.lineTo(l+i,s),n.lineTo(l+i,s+i),n.lineTo(l,s+i),n.endFill())}return n},setupTimingPattern:function(){for(var e=8;e<this.moduleCount-8;e++)null==this.modules[e][6]&&(this.modules[e][6]=0==e%2);for(var t=8;t<this.moduleCount-8;t++)null==this.modules[6][t]&&(this.modules[6][t]=0==t%2)},setupPositionAdjustPattern:function(){for(var e=h.getPatternPosition(this.typeNumber),t=0;t<e.length;t++)for(var r=0;r<e.length;r++){var n=e[t],i=e[r];if(null==this.modules[n][i])for(var a=-2;2>=a;a++)for(var s=-2;2>=s;s++)this.modules[n+a][i+s]=-2==a||2==a||-2==s||2==s||0==a&&0==s?!0:!1}},setupTypeNumber:function(e){for(var t=h.getBCHTypeNumber(this.typeNumber),r=0;18>r;r++){var n=!e&&1==(1&t>>r);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=n}for(var r=0;18>r;r++){var n=!e&&1==(1&t>>r);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=n}},setupTypeInfo:function(e,t){for(var r=this.errorCorrectLevel<<3|t,n=h.getBCHTypeInfo(r),i=0;15>i;i++){var a=!e&&1==(1&n>>i);6>i?this.modules[i][8]=a:8>i?this.modules[i+1][8]=a:this.modules[this.moduleCount-15+i][8]=a}for(var i=0;15>i;i++){var a=!e&&1==(1&n>>i);8>i?this.modules[8][this.moduleCount-i-1]=a:9>i?this.modules[8][15-i-1+1]=a:this.modules[8][15-i-1]=a}this.modules[this.moduleCount-8][8]=!e},mapData:function(e,t){for(var r=-1,n=this.moduleCount-1,i=7,a=0,s=this.moduleCount-1;s>0;s-=2)for(6==s&&s--;;){for(var o=0;2>o;o++)if(null==this.modules[n][s-o]){var l=!1;a<e.length&&(l=1==(1&e[a]>>>i));var c=h.getMask(t,n,s-o);c&&(l=!l),this.modules[n][s-o]=l,i--,-1==i&&(a++,i=7)}if(n+=r,0>n||this.moduleCount<=n){n-=r,r=-r;break}}}},t.PAD0=236,t.PAD1=17,t.createData=function(e,r,a){for(var s=n.getRSBlocks(e,r),o=new i,l=0;l<a.length;l++){var c=a[l];o.put(c.mode,4),o.put(c.getLength(),h.getLengthInBits(c.mode,e)),c.write(o)}for(var u=0,l=0;l<s.length;l++)u+=s[l].dataCount;if(o.getLengthInBits()>8*u)throw new Error("code length overflow. ("+o.getLengthInBits()+">"+8*u+")");for(o.getLengthInBits()+4<=8*u&&o.put(0,4);0!=o.getLengthInBits()%8;)o.putBit(!1);for(;!(o.getLengthInBits()>=8*u)&&(o.put(t.PAD0,8),!(o.getLengthInBits()>=8*u));)o.put(t.PAD1,8);return t.createBytes(o,s)},t.createBytes=function(e,t){for(var n=0,i=0,a=0,s=new Array(t.length),o=new Array(t.length),l=0;l<t.length;l++){var c=t[l].dataCount,u=t[l].totalCount-c;i=Math.max(i,c),a=Math.max(a,u),s[l]=new Array(c);for(var p=0;p<s[l].length;p++)s[l][p]=255&e.buffer[p+n];n+=c;var d=h.getErrorCorrectPolynomial(u),f=new r(s[l],d.getLength()-1),m=f.mod(d);o[l]=new Array(d.getLength()-1);for(var p=0;p<o[l].length;p++){var y=p+m.getLength()-o[l].length;o[l][p]=y>=0?m.get(y):0}}for(var g=0,p=0;p<t.length;p++)g+=t[p].totalCount;for(var v=new Array(g),C=0,p=0;i>p;p++)for(var l=0;l<t.length;l++)p<s[l].length&&(v[C++]=s[l][p]);for(var p=0;a>p;p++)for(var l=0;l<t.length;l++)p<o[l].length&&(v[C++]=o[l][p]);return v};for(var c={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},u={L:1,M:0,Q:3,H:2},p={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},h={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],
G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(e){for(var t=e<<10;h.getBCHDigit(t)-h.getBCHDigit(h.G15)>=0;)t^=h.G15<<h.getBCHDigit(t)-h.getBCHDigit(h.G15);return(e<<10|t)^h.G15_MASK},getBCHTypeNumber:function(e){for(var t=e<<12;h.getBCHDigit(t)-h.getBCHDigit(h.G18)>=0;)t^=h.G18<<h.getBCHDigit(t)-h.getBCHDigit(h.G18);return e<<12|t},getBCHDigit:function(e){for(var t=0;0!=e;)t++,e>>>=1;return t},getPatternPosition:function(e){return h.PATTERN_POSITION_TABLE[e-1]},getMask:function(e,t,r){switch(e){case p.PATTERN000:return 0==(t+r)%2;case p.PATTERN001:return 0==t%2;case p.PATTERN010:return 0==r%3;case p.PATTERN011:return 0==(t+r)%3;case p.PATTERN100:return 0==(Math.floor(t/2)+Math.floor(r/3))%2;case p.PATTERN101:return 0==t*r%2+t*r%3;case p.PATTERN110:return 0==(t*r%2+t*r%3)%2;case p.PATTERN111:return 0==(t*r%3+(t+r)%2)%2;default:throw new Error("bad maskPattern:"+e)}},getErrorCorrectPolynomial:function(e){for(var t=new r([1],0),n=0;e>n;n++)t=t.multiply(new r([1,d.gexp(n)],0));return t},getLengthInBits:function(e,t){if(t>=1&&10>t)switch(e){case c.MODE_NUMBER:return 10;case c.MODE_ALPHA_NUM:return 9;case c.MODE_8BIT_BYTE:return 8;case c.MODE_KANJI:return 8;default:throw new Error("mode:"+e)}else if(27>t)switch(e){case c.MODE_NUMBER:return 12;case c.MODE_ALPHA_NUM:return 11;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 10;default:throw new Error("mode:"+e)}else{if(!(41>t))throw new Error("type:"+t);switch(e){case c.MODE_NUMBER:return 14;case c.MODE_ALPHA_NUM:return 13;case c.MODE_8BIT_BYTE:return 16;case c.MODE_KANJI:return 12;default:throw new Error("mode:"+e)}}},getLostPoint:function(e){for(var t=e.getModuleCount(),r=0,n=0;t>n;n++)for(var i=0;t>i;i++){for(var a=0,s=e.isDark(n,i),o=-1;1>=o;o++)if(!(0>n+o||n+o>=t))for(var l=-1;1>=l;l++)0>i+l||i+l>=t||(0!=o||0!=l)&&s==e.isDark(n+o,i+l)&&a++;a>5&&(r+=3+a-5)}for(var n=0;t-1>n;n++)for(var i=0;t-1>i;i++){var c=0;e.isDark(n,i)&&c++,e.isDark(n+1,i)&&c++,e.isDark(n,i+1)&&c++,e.isDark(n+1,i+1)&&c++,(0==c||4==c)&&(r+=3)}for(var n=0;t>n;n++)for(var i=0;t-6>i;i++)e.isDark(n,i)&&!e.isDark(n,i+1)&&e.isDark(n,i+2)&&e.isDark(n,i+3)&&e.isDark(n,i+4)&&!e.isDark(n,i+5)&&e.isDark(n,i+6)&&(r+=40);for(var i=0;t>i;i++)for(var n=0;t-6>n;n++)e.isDark(n,i)&&!e.isDark(n+1,i)&&e.isDark(n+2,i)&&e.isDark(n+3,i)&&e.isDark(n+4,i)&&!e.isDark(n+5,i)&&e.isDark(n+6,i)&&(r+=40);for(var u=0,i=0;t>i;i++)for(var n=0;t>n;n++)e.isDark(n,i)&&u++;var p=Math.abs(100*u/t/t-50)/5;return r+=10*p}},d={glog:function(e){if(1>e)throw new Error("glog("+e+")");return d.LOG_TABLE[e]},gexp:function(e){for(;0>e;)e+=255;for(;e>=256;)e-=255;return d.EXP_TABLE[e]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},f=0;8>f;f++)d.EXP_TABLE[f]=1<<f;for(var f=8;256>f;f++)d.EXP_TABLE[f]=d.EXP_TABLE[f-4]^d.EXP_TABLE[f-5]^d.EXP_TABLE[f-6]^d.EXP_TABLE[f-8];for(var f=0;255>f;f++)d.LOG_TABLE[d.EXP_TABLE[f]]=f;r.prototype={get:function(e){return this.num[e]},getLength:function(){return this.num.length},multiply:function(e){for(var t=new Array(this.getLength()+e.getLength()-1),n=0;n<this.getLength();n++)for(var i=0;i<e.getLength();i++)t[n+i]^=d.gexp(d.glog(this.get(n))+d.glog(e.get(i)));return new r(t,0)},mod:function(e){if(this.getLength()-e.getLength()<0)return this;for(var t=d.glog(this.get(0))-d.glog(e.get(0)),n=new Array(this.getLength()),i=0;i<this.getLength();i++)n[i]=this.get(i);for(var i=0;i<e.getLength();i++)n[i]^=d.gexp(d.glog(e.get(i))+t);return new r(n,0).mod(e)}},n.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],n.getRSBlocks=function(e,t){var r=n.getRsBlockTable(e,t);if(void 0==r)throw new Error("bad rs block @ typeNumber:"+e+"/errorCorrectLevel:"+t);for(var i=r.length/3,a=[],s=0;i>s;s++)for(var o=r[3*s+0],l=r[3*s+1],c=r[3*s+2],u=0;o>u;u++)a.push(new n(l,c));return a},n.getRsBlockTable=function(e,t){switch(t){case u.L:return n.RS_BLOCK_TABLE[4*(e-1)+0];case u.M:return n.RS_BLOCK_TABLE[4*(e-1)+1];case u.Q:return n.RS_BLOCK_TABLE[4*(e-1)+2];case u.H:return n.RS_BLOCK_TABLE[4*(e-1)+3];default:return void 0}},i.prototype={get:function(e){var t=Math.floor(e/8);return 1==(1&this.buffer[t]>>>7-e%8)},put:function(e,t){for(var r=0;t>r;r++)this.putBit(1==(1&e>>>t-r-1))},getLengthInBits:function(){return this.length},putBit:function(e){var t=Math.floor(this.length/8);this.buffer.length<=t&&this.buffer.push(0),e&&(this.buffer[t]|=128>>>this.length%8),this.length++}};var m=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],y=function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){function t(e,t){var r=document.createElementNS("http://www.w3.org/2000/svg",e);for(var n in t)t.hasOwnProperty(n)&&r.setAttribute(n,t[n]);return r}var r=this._htOption,n=this._el,i=e.getModuleCount();Math.floor(r.width/i),Math.floor(r.height/i),this.clear();var a=t("svg",{viewBox:"0 0 "+String(i)+" "+String(i),width:"100%",height:"100%",fill:r.colorLight});a.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),n.appendChild(a),a.appendChild(t("rect",{fill:r.colorDark,width:"1",height:"1",id:"template"}));for(var s=0;i>s;s++)for(var o=0;i>o;o++)if(e.isDark(s,o)){var l=t("use",{x:String(s),y:String(o)});l.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),a.appendChild(l)}},e.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},e}(),g="svg"===document.documentElement.tagName.toLowerCase(),v=g?y:a()?function(){function e(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function t(e,t){var r=this;if(r._fFail=t,r._fSuccess=e,null===r._bSupportDataURI){var n=document.createElement("img"),i=function(){r._bSupportDataURI=!1,r._fFail&&_fFail.call(r)},a=function(){r._bSupportDataURI=!0,r._fSuccess&&r._fSuccess.call(r)};return n.onabort=i,n.onerror=i,n.onload=a,void(n.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==")}r._bSupportDataURI===!0&&r._fSuccess?r._fSuccess.call(r):r._bSupportDataURI===!1&&r._fFail&&r._fFail.call(r)}if(this._android&&this._android<=2.1){var r=1/window.devicePixelRatio,n=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(e,t,i,a,s,o,l,c){if("nodeName"in e&&/img/i.test(e.nodeName))for(var u=arguments.length-1;u>=1;u--)arguments[u]=arguments[u]*r;else"undefined"==typeof c&&(arguments[1]*=r,arguments[2]*=r,arguments[3]*=r,arguments[4]*=r);n.apply(this,arguments)}}var i=function(e,t){this._bIsPainted=!1,this._android=s(),this._htOption=t,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=t.width,this._elCanvas.height=t.height,e.appendChild(this._elCanvas),this._el=e,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return i.prototype.draw=function(e){var t=this._elImage,r=this._oContext,n=this._htOption,i=e.getModuleCount(),a=n.width/i,s=n.height/i,o=Math.round(a),l=Math.round(s);t.style.display="none",this.clear();for(var c=0;i>c;c++)for(var u=0;i>u;u++){var p=e.isDark(c,u),h=u*a,d=c*s;r.strokeStyle=p?n.colorDark:n.colorLight,r.lineWidth=1,r.fillStyle=p?n.colorDark:n.colorLight,r.fillRect(h,d,a,s),r.strokeRect(Math.floor(h)+.5,Math.floor(d)+.5,o,l),r.strokeRect(Math.ceil(h)-.5,Math.ceil(d)-.5,o,l)}this._bIsPainted=!0},i.prototype.makeImage=function(){this._bIsPainted&&t.call(this,e)},i.prototype.isPainted=function(){return this._bIsPainted},i.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},i.prototype.round=function(e){return e?Math.floor(1e3*e)/1e3:e},i}():function(){var e=function(e,t){this._el=e,this._htOption=t};return e.prototype.draw=function(e){for(var t=this._htOption,r=this._el,n=e.getModuleCount(),i=Math.floor(t.width/n),a=Math.floor(t.height/n),s=['<table style="border:0;border-collapse:collapse;">'],o=0;n>o;o++){s.push("<tr>");for(var l=0;n>l;l++)s.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+i+"px;height:"+a+"px;background-color:"+(e.isDark(o,l)?t.colorDark:t.colorLight)+';"></td>');s.push("</tr>")}s.push("</table>"),r.innerHTML=s.join("");var c=r.childNodes[0],u=(t.width-c.offsetWidth)/2,p=(t.height-c.offsetHeight)/2;u>0&&p>0&&(c.style.margin=p+"px "+u+"px")},e.prototype.clear=function(){this._el.innerHTML=""},e}();QRCode=function(e,t){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:u.H},"string"==typeof t&&(t={text:t}),t)for(var r in t)this._htOption[r]=t[r];"string"==typeof e&&(e=document.getElementById(e)),this._android=s(),this._el=e,this._oQRCode=null,this._oDrawing=new v(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(e){this._oQRCode=new t(o(e,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(e),this._oQRCode.make(),this._el.title=e,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=u}();var TC=TC||{};!function(){var e=[],t=[];TC.Map=TC.Map||function(e,t){var n=this;n.$events=$(n);n.isReady=!1;n.isLoaded=!1;n.controls=[];n.activeControl=null;n.layers=[];n.baseLayers=[];n.workLayers=[];n.baseLayer=null;n.vectors=null;var s=0;n.div=TC.Util.getDiv(e);n._$div=$(n.div);n._$div.addClass(TC.Consts.classes.LOADING);n._$div.data("map",n);n._$div.addClass(TC.Consts.classes.MAP);n._markerDeferreds=[];if(!TC.ready){TC.Cfg=$.extend({},TC.Defaults,TC.Cfg);TC.ready=!0}n.options=i(t);n._remainingLayers=0;var o=function(){if(n.options.stateful){l();n.state=n.checkLocation()}n.options.layout&&n.$events.trigger($.Event(TC.Consts.event.LAYOUTLOAD,{map:n}));t&&void 0!==t.workLayers&&(n.options.workLayers=t.workLayers);t&&void 0!==t.baseLayers&&(n.options.baseLayers=t.baseLayers);n._remainingLayers=n.options.baseLayers.length+n.options.workLayers.length;if(n.options.zoomToFeatures){var e=function i(e){clearTimeout(n._zoomToFeaturesTimeout);n._zoomToFeaturesTimeout=setTimeout(function(){n.zoomToFeatures(e.layer.features,{animate:!1});n.off(TC.Consts.event.FEATURESADD,i)},100)};n.on(TC.Consts.event.FEATURESADD,e)}else{var r=function a(e){if(e.layer.isBase&&e.layer===n.baseLayer){"undefined"!=typeof n.state&&n.setExtent(n.state.ext);n.off(TC.Consts.event.LAYERADD,a)}};n.on(TC.Consts.event.LAYERADD,r)}n.crs=n.options.crs;n.wrap=new TC.wrap.Map(n);TC.loadJS(!(TC.isLegacy?window[TC.Consts.PROJ4JSOBJ_LEGACY]:window[TC.Consts.PROJ4JSOBJ]),[TC.url.proj4js],function(){TC.loadJSInOrder(!(TC.isLegacy?window[TC.Consts.OLNS_LEGACY]:window[TC.Consts.OLNS]),[TC.url.ol,TC.url.olConnector],function(){TC.loadProjDef(n.options.crs,function(){n.wrap.setMap();for(var e in n.options.controls)if(n.options.controls[e])if("boolean"==typeof n.options.controls[e])n.addControl(e);else{var t=n.options.controls[e];e=e.substr(0,1).toUpperCase()+e.substr(1);n.addControl(e,t)}n.on(TC.Consts.event.BEFORELAYERUPDATE,y);n.on(TC.Consts.event.LAYERUPDATE,g);var r,i,a;for(r=0;r<n.options.baseLayers.length;r++){a=n.options.baseLayers[r];if("string"==typeof a)for(i=0;i<TC.Cfg.availableBaseLayers.length;i++)if(TC.Cfg.availableBaseLayers[i].id===a){a=TC.Cfg.availableBaseLayers[i];break}n.addLayer($.extend({},a,{isBase:!0,map:n}))}var s=function(e){e.isRaster()&&!e.names&&e.setVisibility(!1)};for(r=0;r<n.options.workLayers.length;r++){var o=!1;a=$.extend({},n.options.workLayers[r],{map:n});if(n.state&&a.type!==TC.Consts.layerType.VECTOR)for(var r=0;r<n.state.layers.length;r++){var l=n.state.layers[r];if(l.u===a.url&&a.layerNames.indexOf(l.n)>=0){a.hideTitle=l.hideTitle;a.renderOptions={opacity:l.o,hide:!l.v};l.Added=!0;break}o=!0;n._remainingLayers--}o||$.when(n.addLayer(a)).then(s)}n.state&&n.state.layers&&n.state.layers.forEach(function(e){if(!e.Added){var t=e.o,r=e.v;n.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(e.u,e.u.indexOf(window.location.protocol)<0)||e.u,hideTitle:e.h,layerNames:e.n?e.n.split(","):"",renderOptions:{opacity:e.o,hide:!e.v}}).then(function(e){e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;(401===e.error.code||403===e.error.code)&&t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)});var n=e.wrap.getRootLayerNode();e.title=n.Title||n.title;e.setOpacity(t);e.setVisibility(r)})}});n.isReady=!0;n.$events.trigger($.Event(TC.Consts.event.MAPREADY))})})});n.on(TC.Consts.event.FEATURECLICK,function(e){n.activeControl&&n.activeControl.isExclusive()||e.feature.showPopup()});n.on(TC.Consts.event.NOFEATURECLICK,function(e){e.layer._noFeatureClicked=!0;var t,r,i=!0;for(t=0;t<n.workLayers.length;t++){r=n.workLayers[t];if(r instanceof TC.layer.Vector&&!r._noFeatureClicked){i=!1;break}}if(i){for(t=0;t<n.workLayers.length;t++){r=n.workLayers[t];r instanceof TC.layer.Vector&&delete r._noFeatureClicked}for(var a=n.getControlsByClass(TC.control.Popup),t=0,s=a.length;s>t;t++)a[t].hide()}})};n.one(TC.Consts.event.MAPREADY,function(){h(n._$div)});n.one(TC.Consts.event.MAPLOAD,function(){n._$div.removeClass(TC.Consts.classes.LOADING)});var l=function(){var e=4;window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);var t=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE].join(" ");n.on(TC.Consts.event.MAPLOAD,function(){n.loaded(function(){n.replaceCurrent=!0;p();n.on(t,$.proxy(p,n));var r;n.on(TC.Consts.event.LAYEROPACITY,function(e){clearTimeout(r);r=setTimeout(function(){p(e)},500)});window.addEventListener("popstate",function(r){var i;i=n.loadingCtrl&&n.loadingCtrl.addWait();setTimeout(function(){if(r&&null!=r.state){n.off(t,$.proxy(p,n));$.when(m(r.state)).then(function(){setTimeout(function(){n.on(t,$.proxy(p,n))},200);n.loadingCtrl&&n.loadingCtrl.removeWait(i)})}},e)})})})},c=null,u=null,p=function(e){var t=".tc",r=d();if(n.replaceCurrent){window.history.replaceState(r,null,null);delete n.replaceCurrent}else{n.lastEventType=e.type;var i=function(){u=c;c=TC.Util.utf8ToBase64(r);window.history.pushState(r,null,window.location.href.split("#").shift()+"#"+c)};if(e)switch(!0){case e.type==TC.Consts.event.BASELAYERCHANGE.replace(t,""):case e.type==TC.Consts.event.ZOOM.replace(t,""):case e.type==TC.Consts.event.LAYERORDER.replace(t,""):i();break;case e.type.toLowerCase().indexOf("LAYER".toLowerCase())>-1:e.layer.type==TC.Consts.layerType.WMS&&i()}}},d=function(){for(var e={},t=n.getExtent(),r=0;r<t.length;r++)Math.abs(t[r])>180&&(t[r]=Math.floor(1e3*t[r])/1e3);e.ext=t;e.base=n.getBaseLayer().id;e.layers=[];for(var i,a,r=0;r<n.workLayers.length;r++){i=n.workLayers[r];if("WMS"==i.type&&!i.options.stateless&&i.layerNames&&i.layerNames.length){a={u:TC.Util.isOnCapabilities(i.url),n:$.isArray(i.names)?i.names.join(","):i.names,o:i.getOpacity(),v:i.getVisibility(),h:i.options.hideTitle};e.layers.push(a)}}window.jsonpack||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSONPACK);return jsonpack.pack(e)},f=function(){var e=[];n.workLayers.forEach(function(t){"vector"!=t.type&&e.push(t)});for(var t=0;t<e.length;t++)n.removeLayer(e[t])},m=function(e){var t=new $.Deferred,r=[];n.loadingctrl||(n.loadingCtrl=n.getControlsByClass("TC.control.LoadingIndicator")[0]);n.hasWait||(n.hasWait=n.loadingCtrl&&n.loadingCtrl.addWait());var i,a=function(){n.loadingCtrl&&n.loadingCtrl.removeWait(n.hasWait);delete n.hasWait;t.resolve()};if("string"==typeof e)try{i=jsonpack.unpack(e)}catch(s){try{i=JSON.parse(e)}catch(o){TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"))}}else i=e;if(i){i.base!=n.getBaseLayer().id&&n.setBaseLayer(i.base);i.ext&&r.push(n.setExtent(i.ext));f();i.layers=i.layers||i.capas||[];if(i.layers.length>0)for(var l=0;l<i.layers.length;l++){var c=i.layers[l],u=c.o,p=c.v,h=!1;for(j=0;j<n.options.workLayers.length;j++){var d=$.extend({},n.options.workLayers[j],{map:n});if(d.type!==TC.Consts.layerType.VECTOR&&c.u===d.url&&d.layerNames.indexOf(c.n)){h=!0;d.renderOptions.opacity=c.o;d.renderOptions.hide=!c.v;r.push(n.addLayer(d).then(setVisibility));break}}h||r.push(n.addLayer({id:TC.getUID(),url:TC.Util.isOnCapabilities(c.u,c.u.indexOf(window.location.protocol)<0)||c.u,hideTitle:c.h,layerNames:c.n?c.n.split(","):"",renderOptions:{opacity:c.o,hide:!c.v}}).then(function(e){var t=e.wrap.getRootLayerNode();e.title=t.Title||t.title;e.setOpacity(u,!0);e.setVisibility(p)}))}$.when.apply($,r).done(function(){a()})}return t};a.getMapState=function(){var e=d();return TC.Util.utf8ToBase64(e)};a.getPreviousMapState=function(){return u};a.checkLocation=function(){var e=window.location.hash;if(e&&e.length>1){e=e.substr(1);var t;try{t=jsonpack.unpack(TC.Util.base64ToUtf8(e))}catch(r){try{t=JSON.parse(TC.Util.base64ToUtf8(e))}catch(i){TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return}}if(t){var a=!1;if(!t.hasOwnProperty("ext")){a=!0;t.ext=n.options.initialExtent}if(!t.hasOwnProperty("base")){a=!0;t.base=n.options.defaultBaseLayer}if(t.hasOwnProperty("layers"))for(var s=t.layers.length-1;s>=0;s--)if(t.layers[s]&&t.layers[s].hasOwnProperty("u")&&t.layers[s].hasOwnProperty("n")){if(!t.layers[s].hasOwnProperty("o")||!t.layers[s].hasOwnProperty("v")||!t.layers[s].hasOwnProperty("h")){a=!0;jQuery.extend(t.layers[s],{o:t.layers[s].o||1,v:t.layers[s].v||!0,h:t.layers[s].h||!1})}}else{a=!0;t.layers.length=t.layers.length-1}else{a=!0;t.layers=[]}a&&TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST);return t}TC.error(TC.Util.getLocaleString(n.options.locale,"mapStateNotValid"),TC.Consts.msgErrorMode.TOAST)}};var y=function(e){if(0>=s){s=0;n.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATE))}s+=1},g=function(e){s-=1;if(0>=s){s=0;n.$events.trigger($.Event(TC.Consts.event.UPDATE))}},v=function(e){var t=$.Deferred();if("string"==typeof e){var r=e,n=function(e,t){var r=$.Deferred();$.ajax({type:"HEAD",url:e,complete:function(n,i){r.resolve({resource:t,found:404!==n.status,url:e})}});return r.promise()},i=/^(https?:)?\/\//i.test(r),a=function(t,a){var c=$.Deferred(),u=[l+r+"/"+a,o+r+"/"+a,o+"responsive/"+a];i&&u.unshift(r+"/"+a);var p=0;!function h(r){n(u[r],t).done(function(t){t.found?c.resolve(s(e,t)):h(++r)})}(p);return c.promise()},s=function(e,t){if(!(t.resource in e)){var n=($.extend(!0,{},e),t.found?t.url:o+r+"/"+c[t.resource]);e[t.resource]=n}return e},o=TC.apiLocation+"TC/layout/",l="layout/",e={},c={script:"script.js",style:"style.css",markup:"markup.html",config:"config.json",i18n:"resources"},u=Object.keys(c).length;for(var p in c)a(p,c[p]).done(function(e){Object.keys(e).length===u&&t.resolve(e)})}else t.resolve(e);return t.promise()};TC.i18n=TC.i18n||{};TC.i18n.loadResources=TC.i18n.loadResources||function(e,t,r){var n;e?n=$.ajax({url:t+r+".json",type:"GET",dataType:"json",success:function(e){TC.i18n[r]=TC.i18n[r]||{};$.extend(TC.i18n[r],e);"undefined"!=typeof dust&&dust.i18n.add(r,TC.i18n[r])}}):dust.i18n.add(r,TC.i18n[r]);return n};var C=[],T=n.options.locale,L=$.Deferred();C.push(L);TC.loadJSInOrder(!window.dust||!window.dust.i18n,TC.url.templating,function(){if(T){dust.i18n.setLanguages([T]);C.push(TC.i18n.loadResources(!TC.i18n[T],TC.apiLocation+"TC/resources/",T))}L.resolve()});$.when.apply(this,C).always(function(){n.options.layout?v(n.options.layout).done(function(e){n.$events.trigger($.Event(TC.Consts.event.BEFORELAYOUTLOAD,{map:n}));var r;"string"==typeof e?r={href:$.trim(e)}:(e.hasOwnProperty("config")||e.hasOwnProperty("markup")||e.hasOwnProperty("style")||e.hasOwnProperty("ie8Style")||e.hasOwnProperty("script")||e.hasOwnProperty("href")||e.hasOwnProperty("i18n"))&&(r=$.extend({},e));r.href&&(r.href+=r.href.match(/\/$/)?"":"/");r.config=r.config||r.href+"config.json";r.markup=r.markup||r.href+"markup.html";r.style=r.style||r.href+"style.css";r.ie8Style=r.ie8Style||r.href+"ie8.css";r.script=r.script||r.href+"script.js";r.i18n=r.i18n||r.href+"resources";r.i18n&&(r.i18n+=r.i18n.match(/\/$/)?"":"/");n.layout=r;var a=[],s=$.Deferred();a.push(s);r.config?a.push($.ajax({url:r.config,type:"GET",dataType:"json",success:function(e){s.resolve(e.i18n);n.options=i(e,t)},error:function(e,t,r){TC.error(t+": "+r);s.resolve(!1)}})):s.resolve(!1);if(r.markup){var l;if(T){l=$.Deferred();a.push(l)}a.push($.ajax({url:r.markup,type:"GET",dataType:"html",success:function(e){s.then(function(t){if(t&&T)TC.i18n.loadResources(!0,r.i18n,T).always(function(){var t="tc-markup";dust.loadSource(dust.compile(e,t));dust.render(t,null,function(e,t){if(e){TC.error(e);l.reject()}else{n._$div.append(t);l.resolve()}})});else{n._$div.append(e);T&&l.resolve()}})},error:function(){l.reject()}}))}$.when.apply(this,a).always(function(){TC.loadJS(r.script,r.script,function(){h(n._$div);r.style&&TC.loadCSS(r.style);!Modernizr.canvas&&r.ie8Style&&TC.loadCSS(r.ie8Style);o()})})}):o()});n.$events.on(TC.Consts.event.UPDATEPARAMS,function(e){r(e.layer)});n.$events.on(TC.Consts.event.ZOOM,function(){for(var e=0;e<n.workLayers.length;e++)r(n.workLayers[e])});var w=TC.error;TC.error=function(e,t,r){if(t){var i=function(e,t,r){switch(t){case TC.Consts.msgErrorMode.TOAST:if(!n.toast){console.warn("No existe el objeto Toast");return}n.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration});break;case TC.Consts.msgErrorMode.EMAIL:JL("onerrorLogger").fatalException(r?{msg:r,errorMsg:e}:e,null);break;case TC.Consts.msgErrorMode.CONSOLE:default:console.error(e)}};if($.isArray(t))for(var a=0;a<t.length;a++)i(e,t[a],r);else i(e,t,r)}else{w(e);n.toast(e,{type:TC.Consts.msgType.ERROR,duration:2*TC.Cfg.toastDuration})}}};var r=function(e){e.type===TC.Consts.layerType.WMS&&(e.tree=null)},n=function(e,t){var r=$.map(e,function(e){var r={};e&&(r[t]=e[t]);return r}),n={};n[t]=TC.Cfg[t];r.unshift(n);if("baseLayers"===t&&r[1].baseLayers){n=r[1];for(var i=0;i<n.baseLayers.length;i++)"object"==typeof n.baseLayers[i]&&$.extend(n.baseLayers[i],$.grep(TC.Cfg.availableBaseLayers,function(e){return e.id===n.baseLayers[i].id})[0])}else{r.unshift(!0);n=$.extend.apply(this,r)}return n[t]},i=function(){var e=$.extend.apply(this,$.merge([!0,{},TC.Cfg],arguments));e.baseLayers=n(arguments,"baseLayers");e.workLayers=n(arguments,"workLayers");return e},a=TC.Map.prototype;a.addLayer=function(r,n){var i=this,a=d(r);if(a){var s;for(s=0,len=e.length;s<len&&d(e[s]);s++);e.splice(s,0,r);t.splice(s,0,n)}else{e.push(r);t.push(n)}for(var o=new $.Deferred,l=function(e){return"string"==typeof e?e:e.id},c=l(r),u=!1,p=0;p<i.options.baseLayers.length&&!u;p++)l(i.options.baseLayers[p])===c&&(u=!0);for(var p=0;p<i.options.workLayers.length&&!u;p++)l(i.options.workLayers[p])===c&&(u=!0);u||i.isLoaded||(i._remainingLayers=i._remainingLayers+1);var h,f,m;if(a){f=!TC.layer||!TC.layer.Raster;m=TC.apiLocation+"TC/layer/Raster.js"}else{f=!TC.layer||!TC.layer.Vector;m=TC.apiLocation+"TC/layer/Vector.js"}TC.loadJS(f,[m],function(){if("string"==typeof r){for(var a=0;a<TC.Cfg.availableBaseLayers.length;a++)if(TC.Cfg.availableBaseLayers[a].id===r){h=new TC.layer.Raster($.extend({},TC.Cfg.availableBaseLayers[a],{map:i}));break}}else if(r instanceof TC.Layer){h=r;h.map=i}else{r.map=i;h=r.type===TC.Consts.layerType.VECTOR||r.type===TC.Consts.layerType.KML||r.type===TC.Consts.layerType.WFS?new TC.layer.Vector(r):new TC.layer.Raster(r)}var s=$.inArray(r,e);0>s&&(s=0);e[s]=h;t[s]=n;i.$events.trigger($.Event(TC.Consts.event.BEFORELAYERADD,{layer:h}));$.when(i.wrap.getMap(),h.wrap.getLayer()).then(function(){var r=$.grep(e,function(e){return e.wrap&&e.wrap.isNative(e.wrap.getLayer())});if(r.length===e.length)for(var n=e.length,a=0;n>a;a++){var s=e.shift(),l=t.shift(),c=-1;d(s)&&(c=i.wrap.indexOfFirstVector());-1===c&&(c=i.wrap.getLayerCount());if(s)if(s.isCompatible(i.crs)){i.layers[i.layers.length]=s;if(s.isBase){i.state?s.isDefault=i.state.base===s.id:"string"==typeof i.options.defaultBaseLayer?s.isDefault=i.options.defaultBaseLayer===s.id:"number"==typeof i.options.defaultBaseLayer&&(s.isDefault=i.options.defaultBaseLayer===i.baseLayers.length);if(s.isDefault){i.wrap.setBaseLayer(s.wrap.getLayer());i.baseLayer=s}i.baseLayers[i.baseLayers.length]=s;i.options.baseLayers.length!==i.baseLayers.length||i.baseLayer||i.wrap.setBaseLayer(i.baseLayers[0].wrap.getLayer())}else{i.wrap.insertLayer(s.wrap.getLayer(),c);i.workLayers[i.workLayers.length]=s}i.$events.trigger($.Event(TC.Consts.event.LAYERADD,{layer:s}));$.isFunction(l)&&l(s)}else{var u,p='Layer "'+s.title+'" ("'+s.names+'"): ';u=s.isValidFromNames()?"layerSrsNotCompatible":"layerNameNotValid";p+=TC.Util.getLocaleString(i.options.locale,u);TC.error(p);i.$events.trigger($.Event(TC.Consts.event.LAYERERROR,{layer:s,reason:u}))}i._remainingLayers=i._remainingLayers-1;if(0===i._remainingLayers&&!i.isLoaded){i.isLoaded=!0;i.$events.trigger($.Event(TC.Consts.event.MAPLOAD))}}o.resolve(h)})});return o.promise()};a.removeLayer=function(e){var t=this,r=new $.Deferred;$.when(e.wrap.getLayer()).then(function(n){for(var i=0;i<t.layers.length;i++)t.layers[i]===e&&t.layers.splice(i,1);if(e.isBase){for(var i=0;i<t.baseLayers.length;i++)if(t.baseLayers[i]===e){t.baseLayers.splice(i,1);t.baseLayer===e&&t.setBaseLayer(t.baseLayers[0]);break}}else{for(var i=0;i<t.workLayers.length;i++)if(t.workLayers[i]===e){t.workLayers.splice(i,1);break}e===t.vectors&&(t.vectors=null)}t.wrap.removeLayer(n);t.$events.trigger($.Event(TC.Consts.event.LAYERREMOVE,{layer:e}));r.resolve(e)});return r};a.insertLayer=function(e,t,r){for(var n=this,i=-1,a=0;a<n.layers.length;a++)if(e===n.layers[a]){i=a;break}var s=[];s.push(e.wrap.getLayer());var o=n.layers[t];o&&s.push(o.wrap.getLayer());$.when.apply(this,s).then(function(a,s){var o=-1;o=s?n.wrap.getLayerIndex(s):n.wrap.getLayerCount();if(o>=0){e.map=n;n.wrap.insertLayer(a,o);i>-1&&n.layers.splice(i,1);n.layers.splice(t,0,e);n.workLayers=$.grep(n.layers,function(e){return!e.isBase});n.$events.trigger($.Event(TC.Consts.event.LAYERORDER,{layer:e,oldIndex:i,newIndex:t}))}$.isFunction(r)&&r()})};a.setLayerIndex=function(e,t){this.wrap.setLayerIndex(e.wrap.getLayer(),t)};a.putLayerOnTop=function(e){var t=this,r=t.wrap.getLayerCount();t.setLayerIndex(e,r-1)};a.setBaseLayer=function(e,t){var r=this,n=null,i=!1;if("string"==typeof e){var a;for(a=0;a<r.layers.length;a++)if(r.layers[a].id===e){e=r.layers[a];i=!0;break}if(!i)for(a=0;a<TC.Cfg.availableBaseLayers.length;a++)if(TC.Cfg.availableBaseLayers[a].id===e){e=r.addLayer($.extend(!0,{},TC.Cfg.availableBaseLayers[a],{isDefault:!0,map:r}));i=!0;break}}else i=$.inArray(e,r.layers)>=0;if(i){r.$events.trigger($.Event(TC.Consts.event.BEFOREBASELAYERCHANGE,{oldLayer:r.getBaseLayer(),newLayer:e}));n=e;$.when(r.wrap.getMap(),e).then(function(e,n){$.when(n.wrap.getLayer()).then(function(e){r.wrap.setBaseLayer(e).then(function(){r.baseLayer=n;r.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:n}));$.isFunction(t)&&t()})})})}else TC.error("Base layer is not in layers collection");return n};a.on=function(e,t){var r=this;r.$events.on(e,t);return r};a.one=function(e,t){var r=this;r.$events.one(e,t);return r};a.off=function(e,t){var r=this;r.$events.off(e,t);return r};a.ready=function(e){var t=this;$.isFunction(e)&&(t.isReady?e():t.one(TC.Consts.event.MAPREADY,e))};a.loaded=function(e){var t=this;$.isFunction(e)&&(t.isLoaded?e():t.one(TC.Consts.event.MAPLOAD,e))};a.getLayerTree=function(){var e=this,t={baseLayers:[],workLayers:[]};e.baseLayer&&(t.baseLayers[0]=e.baseLayer.getTree());for(var r=0;r<e.workLayers.length;r++){var n=e.workLayers[r].getTree();n&&t.workLayers.unshift(n)}return t};a.addControl=function(e,t){var r=this,n=new $.Deferred,i=function(e){r.controls.push(e);e.register(r);$dv=$(e.div);0===$dv.parent().length&&$dv.appendTo(r._$div);r.$events.trigger($.Event(TC.Consts.event.CONTROLADD,{control:e}));n.resolve(e)};if("string"==typeof e){e=e.substr(0,1).toUpperCase()+e.substr(1);TC.loadJS(!TC.Control||!TC.control[e],[TC.apiLocation+"TC/control/"+e],function(){i(new TC.control[e](null,t))})}else i(e);return n.promise()};a.getControlsByClass=function(e){var t=this,r=[],n=e;if("string"==typeof e){n=window;for(var i=e.split("."),a=0;a<i.length;a++){n=n[i[a]];if(!n)break}}if($.isFunction(n))for(var a=0;a<t.controls.length;a++){
var s=t.controls[a];s instanceof n&&r.push(s)}return r};a.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.FeatureInfo");return e&&e.length?e[0]:null};a.getLoadingIndicator=function(){var e=null,t=this.getControlsByClass("TC.control.LoadingIndicator");t.length&&(e=t[0]);return e};a.setExtent=function(e,t){return this.wrap.setExtent(e,t)};a.getExtent=function(){return this.wrap.getExtent()};a.setCenter=function(e,t){this.wrap.setCenter(e,t)};a.getCenter=function(){return this.wrap.getCenter()};a.setRotation=function(e){this.wrap.setRotation(e)};a.getRotation=function(){return this.wrap.getRotation()};a.getViewHTML=function(){return this.wrap.getViewport()};a.getCoordinateFromPixel=function(e){return this.wrap.getCoordinateFromPixel(e)};a.getPixelFromCoordinate=function(e){return this.wrap.getPixelFromCoordinate(e)};a.zoomToFeatures=function(e,t){var r=this;if(e.length>0){var n=[1/0,1/0,-(1/0),-(1/0)],i=t||{},a=i.pointBoundsRadius||r.options.pointBoundsRadius;a=r.wrap.isGeo()?a/TC.Util.getMetersPerDegree(r.getExtent()):a;var s=i.extentMargin;"number"!=typeof s&&(s=r.options.extentMargin);for(var o=0;o<e.length;o++){var l=e[o].getBounds();if(l){n[0]=Math.min(n[0],l[0]);n[1]=Math.min(n[1],l[1]);n[2]=Math.max(n[2],l[2]);n[3]=Math.max(n[3],l[3])}}if(n[2]-n[0]===0){n[0]=n[0]-a;n[2]=n[2]+a}if(n[3]-n[1]===0){n[1]=n[1]-a;n[3]=n[3]+a}if(r.options.extentMargin){var c=(n[2]-n[0])*s/2,u=(n[3]-n[1])*s/2;n[0]=n[0]-c;n[1]=n[1]-u;n[2]=n[2]+c;n[3]=n[3]+u}if(r.options.maxExtent){n[0]=Math.max(n[0],r.options.maxExtent[0]);n[1]=Math.max(n[1],r.options.maxExtent[1]);n[2]=Math.min(n[2],r.options.maxExtent[2]);n[3]=Math.min(n[3],r.options.maxExtent[3])}r.wrap.setExtent(n,i);r.$events.trigger($.Event(TC.Consts.event.ZOOMTO,{extent:n}))}};a.zoomToMarkers=function(e){var t=this;$.when.apply(this,t._markerDeferreds).then(function(){for(var r=[],n=0;n<t.workLayers.length;n++){var i=t.workLayers[n];if(i.type===TC.Consts.layerType.VECTOR)for(var a=0;a<i.features.length;a++){var s=i.features[a];s instanceof TC.feature.Marker&&(r[r.length]=s)}}for(var n=0;n<arguments.length;n++)r[r.length]=arguments[n];t.zoomToFeatures(r,e);t._markerDeferreds=[]})};a.getLayer=function(e){var t=this,r=null;if("string"==typeof e){for(var n=0;n<t.layers.length;n++)if(t.layers[n].id===e){r=t.layers[n];break}}else TC.Layer&&e instanceof TC.Layer&&(r=e);return r};var s=function(e){var t;if(e.vectors)t=e.vectors;else{t=e.addLayer({id:TC.getUID(),title:TC.i18n[e.options.locale].vectors,type:TC.Consts.layerType.VECTOR});e.vectors=t;$.when(t).then(function(t){e.vectors=t})}return t};a.addPoint=function(e,t){var r=this;if(t&&t.layer){var n=r.getLayer(t.layer);n&&n.addPoint(e,t)}else $.when(s(r)).then(function(r){r.addPoint(e,t)})};a.addMarker=function(e,t){var r=this;if(t&&t.layer){var n=r.getLayer(t.layer);n&&r._markerDeferreds.push(n.addMarker(e,t))}else{var i=new $.Deferred;r._markerDeferreds.push(i);$.when(s(r)).then(function(r){$.when(r.addMarker(e,t)).then(function(e){i.resolve(e)})})}};a.addPolyline=function(e,t){var r=this;if(t&&t.layer){var n=r.getLayer(t.layer);n&&t.layer.addPolyline(e,t)}else $.when(s(r)).then(function(r){r.addPolyline(e,t)})};a.addPolygon=function(e,t){var r=this;if(t&&t.layer){var n=r.getLayer(t.layer);n&&t.layer.addPolygon(e,t)}else $.when(s(r)).then(function(r){r.addPolygon(e,t)})};a.getBaseLayer=function(){return this.baseLayer||this.baseLayers[0]};a.getResolutions=function(){return this.getBaseLayer().getResolutions()};a.getResolution=function(){return this.wrap.getResolution()};a.setResolution=function(e){this.wrap.setResolution(e)};a.exportFeatures=function(e,t){var r=this,n=t||{},i=r.getLoadingIndicator(),a=i&&i.addWait(),s=r.wrap.exportFeatures(e,n),o=TC.Consts.mimeType[n.format],l=n.format||"";TC.Util.downloadFile((n.fileName||TC.getUID())+"."+l.toLowerCase(),o,s);i&&i.removeWait(a)};var o="tc-toast-container",l="tc-toast",c={},u=function(){var e=$(this),t=e.parent("."+o),r=e.html();e.addClass(TC.Consts.classes.HIDDEN);void 0!==c[r]&&(c[r]=void 0);setTimeout(function(){e.remove();t.find("."+l).length||t.remove()},1e3)};a.toast=function(e,t){var r=this,n=t||{},i=n.duration||TC.Cfg.toastDuration,a=c[e];if(a){clearTimeout(a.timeout);a.$toast.remove()}var s=r._$div.find("."+o);s.length||(s=$("<div>").addClass(o).appendTo(r._$div));a=c[e]={$toast:$("<div>").addClass(l).html(e).appendTo(s).on(TC.Consts.event.CLICK,u)};var p="";switch(n.type){case TC.Consts.msgType.INFO:p=TC.Consts.classes.INFO;break;case TC.Consts.msgType.WARNING:p=TC.Consts.classes.WARNING;break;case TC.Consts.msgType.ERROR:p=TC.Consts.classes.ERROR}a.$toast.addClass(p);a.timeout=setTimeout(function(){u.call(a.$toast)},i)};var p=!1,h=function(e){if(/iPad/i.test(navigator.userAgent)){var t=window.innerHeight,r=e.height(),n=Modernizr.mq("only screen and (orientation : landscape)")?20:0;r===t+n&&(p=!0)}var i=function(){e.toggleClass(TC.Consts.classes.IPAD_IOS7_FIX,Modernizr.mq("only screen and (orientation : landscape)"))};if(p){i();$(window).on("resize",i)}else $(window).off("resize",i)},d=function(e){return"string"==typeof e||e.type!==TC.Consts.layerType.VECTOR&&e.type!==TC.Consts.layerType.KML&&e.type!==TC.Consts.layerType.WFS};a.exportImage=function(){var e=this,t=null,r="El mapa actual no es compatible con la exportaci\xf3n de im\xe1genes",n=e.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0];if(n&&e.options.crossOrigin)try{t=n.toDataURL()}catch(i){TC.error(r+": "+i.message)}else TC.error(r);return t}}();var TC=TC||{};!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define([],t):e.Util=t()}(TC,function(){Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e};var e=Number.prototype.toLocaleString;Number.prototype.toLocaleString=function(t,r){if("eu-ES"!=t||TC.Util.detectIE())return e.apply(this,arguments);var n=e.apply(this,arguments);n=n.replace(/\,/g,".");Math.floor(this)==this&&Number.isInteger(Math.floor(this))||(n=n.replace(/.([^.]*)$/,",$1"));return n};var t={},r={},a=["Capability","Request","GetMap","DCPType","0","HTTP","Get","OnlineResource"],s=["OperationsMetadata","GetTile","DCP","HTTP","Get","0","href"],o=function(e,t,r){return r<t.length-1?e.hasOwnProperty(t[r])?o(e[t[r]],t,++r):null:e[t[r]]},l={getMapLocale:function(e){return e.options&&e.options.locale&&e.options.locale.replace("_","-")||"es-ES"},regex:{PROTOCOL:/(^https?:)/i},isOnCapabilities:function(e){var t=2==arguments.length?arguments[1]:!0,r=t?e:e.replace(TC.Util.regex.PROTOCOL,"");if(t){if(TC.capabilities[r])return e}else for(var n in TC.capabilities)if(n.replace(TC.Util.regex.PROTOCOL,"")==r)return n;for(n in TC.capabilities){var i=o(TC.capabilities[n],a,0)||o(TC.capabilities[n],s,0);if(i&&t&&e==i)return i;if(i&&e.replace(TC.Util.regex.PROTOCOL,"")==i.replace(TC.Util.regex.PROTOCOL,""))return i}return e},reqGetMapOnCapabilities:function(e){var t=2==arguments.length?arguments[1]:!0,r=(t?e:e.replace(TC.Util.regex.PROTOCOL,""),function(e){var r=o(e,a,0)||o(e,s,0);return r?t?r.split("?")[0]:r.split("?")[0].replace(TC.Util.regex.PROTOCOL,""):null});return TC.capabilities[e]?r(TC.capabilities[e]):null},getFNFromString:function(e){var t=window,r=e.split(".");for(i=0;i<r.length-1;i++){t=t[r[i]];if(void 0==t)return}return t[r[r.length-1]]},isURL:function(e){return/^(http|https|ftp|mailto)\:\/\//i.test(e)},isSecureURL:function(e){return/^(f|ht)tps?:\/\//i.test(e)?/^(f|ht)tps:\/\//i.test(e):!0},isSameOrigin:function(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!t&&e.match(TC.Consts.url.SPLIT_REGEX);if(r){var n=window.location,i=r[1];t=(i==n.protocol||void 0==i)&&r[3]==n.hostname;var a=r[4],s=n.port;(80!=a&&""!==a||"80"!=s&&""!==s)&&(t=t&&a==s)}return t},formatNumber:function(e,t){var r=typeof e;if("number"===r)return e.toLocaleString(t);if("string"===r){n=parseFloat(e);if(n===new Number(e).valueOf())return n.toLocaleString(t)}return e},addProtocol:function(e){var t=e;e&&0===e.indexOf("//")&&(t=location.protocol+e);return t},getDiv:function(e){var t;t="string"==typeof e?document.getElementById(e):1==$(e).length?e:document.createElement("div");return t},getScriptLocation:function(){var e,t;if(document.currentScript)t=document.currentScript;else{var r=document.getElementsByTagName("script");t=r[r.length-1]}e=t.getAttribute("src");return e?e.substr(0,e.lastIndexOf("/")+1):""},getBackgroundUrlFromCss:function(e){var r="";if(void 0!==t[e])r=t[e];else{var n=$('<div style="display:none">').addClass(e).appendTo("body"),i=/^url\(['"]?(.*?)['"]?\)$/gi.exec(n.css("background-image"));i&&i.length>1&&(r=i[i.length-1]);n.remove();t[e]=r}return r},getPointIconUrl:function c(e){var t=null;if(e.url)t=e.url;else{var n;if("string"==typeof e.cssClass)n=e.cssClass;else{var i=e.classes||TC.Cfg.styles.marker.classes;n=i[0];if(e.group){if(void 0===r[e.group]){var a=0;for(var s in r)a++;a%=i.length;r[e.group]=i[a]}n=r[e.group]}}t=TC.Util.getBackgroundUrlFromCss(n)}t||e===TC.Cfg.styles.point||""===e.cssClass||(t=c(TC.Cfg.styles.point));return t},addArrayToTree:function u(e,t,r){var n=null,i=!1;r=r||0;var a=e[r];if(a){for(var s,o=0,l=t.children.length;l>o;o++){s=t.children[o];if(s.name===a){i=!0;var c=u(e,s,r+1);c&&(n=c);break}}if(!i){s={name:a,title:a,uid:"/"+e.slice(0,r+1).join("/"),children:[]};t.children.push(s);n=s}}return n},parseCoords:function(e){var t=null,r=function(e){var t=e,r={};r.type=TC.Consts.GEOGRAPHIC;var n=t.indexOf("\xb0");r.value=parseFloat(t.substr(0,n));t=t.substr(n+1);n=t.indexOf("'");if(n>=0){var i=parseFloat(t.substr(0,n))/60;r.value>=0?r.value+=i:r.value-=i;t=t.substr(n+1);n=t.indexOf("'");if(n>=0){i=parseFloat(t.substr(0,n).replace(",","."))/3600;r.value>=0?r.value+=i:r.value-=i}}return r},n=function(e){var t=$.trim(e);if(t.match(/^1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?\s*[NnSsWwOoEe]$/g)){switch(t[t.length-1]){case"S":case"s":case"W":case"w":case"O":case"o":t="-"+t}t=t.substr(0,t.length-1);return r(t)}if(t.match(/^[+-]?1?\d{0,2}\s*\u00B0(\s*\d{1,2}\s*'(\s*\d{1,2}([.,]\d+)?\s*'')?)?$/g))return r(t);if(t.match(/^1?\d{0,2}([.,]\d+)?\s*\u00B0?\s*[NnSsWwOoEe]$/g)){var n={type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.substr(0,t.length-1).replace(",","."))};t.match(/[SsWwOo]$/)&&(n.value=-n.value);return n}return t.match(/^[+-]?1?\d{0,2}([.,]\d+)?\s*\u00B0?$/g)?{type:TC.Consts.GEOGRAPHIC,value:parseFloat(t.replace(",","."))}:t.match(/^\d{6,7}([.,]\d+)?$/g)?{type:TC.Consts.UTM,value:parseFloat(t.replace(",","."))}:null};e=$.trim(e).toUpperCase();var i=e.split(",");4===i.length?i=[i.slice(0,1).join("."),i.slice(2,3).join(".")]:(1===i.length||3===i.length)&&(i=e.split(" "));if(2===i.length){var a=n(i[0]),s=n(i[1]);null!==a&&null!==s&&(t=[a,s])}return t},reproject:function(e,t,r){var n,i=!0;if(!$.isArray(e)||!$.isArray(e[0])){i=!1;e=[e]}TC.loadProjDef(t,!0);TC.loadProjDef(r,!0);var a=new Proj4js.Proj(t),s=new Proj4js.Proj(r);n=new Array(e.length);for(var o=0,l=e.length;l>o;o++){var c=Proj4js.transform(a,s,{x:e[o][0],y:e[o][1]});n[o]=[c.x,c.y]}i||(n=n[0]);return n},getMetersPerDegree:function(e){var t=void 0,r=6370997;if($.isArray(e)&&e.length>=4){var n=this.degToRad(e[3]-e[1]),i=Math.sin(n/2),a=i*i,s=2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));t=r*s/(e[3]-e[1])}return t},radToDeg:function(e){return 180*e/Math.PI},degToRad:function(e){return e*Math.PI/180},mod:function(e){return(e%(2*Math.PI)+2*Math.PI)%(2*Math.PI)},getLocaleString:function(e,t,r){var n=t;if(TC.i18n&&TC.i18n[e]){var i=TC.i18n[e][t];if(i){n=i;if(r)for(var a in r)n=n.replace("{"+a+"}",r[a])}}return n},getSimpleMimeType:function(e){var t="";if(e){var r=e.indexOf(";");r>0&&(e=e.substring(0,r));t=e}return t},getQueryStringParams:function(e){var t;if(e){var r=e.indexOf("?");if(r>=0){t=e.substr(r);var n=t.indexOf("#");n>=0&&(t=t.substr(0,n))}else t="?"}else t=location.search;var i=$.map(t.replace(/(^\?)/,"").split("&"),function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0];delete i[""];return i},fastUnshift:function(e,t){for(var r=e.length;r;){e[r]=e[r-1];r--}e[0]=t},storage:{getCookie:function(e){return $.cookie(e)},setCookie:function(e,t,r){return $.cookie(e,t,r)},getLocalValue:function(e){var t=null;t=localStorage&&localStorage instanceof Storage?localStorage.getItem(e):TC.Util.storage.getCookie(e);return t},setLocalValue:function(e,t){if(localStorage&&localStorage instanceof Storage)void 0===t?localStorage.removeItem(e):localStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:r})}else TC.Util.storage.setCookie(e,t);return e},getSessionLocalValue:function(e){var t=null;t=sessionStorage&&sessionStorage instanceof Storage?sessionStorage.getItem(e):TC.Util.storage.getCookie(e);return t},setSessionLocalValue:function(e,t){if(sessionStorage&&sessionStorage instanceof Storage)void 0===t?sessionStorage.removeItem(e):sessionStorage.setItem(e,t);else if(void 0===t){var r=new Date;r.setDate(r.getDate()-1);TC.Util.storage.setCookie(e,"",{expires:r})}else TC.Util.storage.setCookie(e,t);return e}},detectFirefox:function(){return/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)?new Number(RegExp.$1):!1},detectIE:function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);var r=e.indexOf("Trident/");if(r>0){var n=e.indexOf("rv:");return parseInt(e.substring(n+3,e.indexOf(".",n)),10)}var i=e.indexOf("Edge/");return i>0?parseInt(e.substring(i+5,e.indexOf(".",i)),10):!1},detectChrome:function(){return window.chrome},detectSafari:function(){return!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)},detectMouse:function(){if(Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)"))return!0;if(Modernizr.mq("(pointer:coarse)")&&!Modernizr.mq("(pointer:fine)")){var e=function(){var e,t="(hover: hover)",r=!Modernizr.touch;if("matchMedia"in window){e=window.matchMedia(t);e.media===t&&(r=e.matches)}else console.log("no dispone de matchMedia");return r};return e()?!0:!1}return!Modernizr.mq("(pointer:coarse)")&&Modernizr.mq("(pointer:fine)")?!0:Modernizr.mq("(pointer:none)")?!1:Modernizr.touch?void 0:!0},detectAndroid:function(){return navigator.userAgent.match(/Android/i)},detectBlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},detectIOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},detectMobileWindows:function(){return navigator.userAgent.match(/IEMobile/i)},detectMobile:function(){return TC.Util.detectAndroid()||TC.Util.detectIOS()||TC.Util.detectMobileWindows()||TC.Util.detectBlackBerry()},getElementByNodeName:function(e,t){for(var r=t.indexOf(":"),n=t.substr(r+1),i=e.getElementsByTagNameNS("*",n),a=0;a<i.length;a++)if(i[a].nodeName==t)return i;return void 0},addURLParameters:function(e,t){if(!t)return e;var r=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),n=e.split("?");if(n.length>=2){var i=n[1].split(/[&;]/g);i.push(r);e=n[0]+"?"+i.join("&");return e}n=e.split("#");if(n.length>=2){n.shift();e=n[0]+"?"+r+"#"+n.join("#");return e}e=e+"?"+r;return e},removeURLParameter:function(e,t){var r=e.split("?");if(r.length>=2){for(var n=encodeURIComponent(t.toLowerCase())+"=",i=r[1].toLowerCase().split(/[&;]/g),a=i.length;a-->0;)-1!==i[a].lastIndexOf(n,0)&&i.splice(a,1);e=r[0]+"?"+i.join("&");return e}return e},showModal:function(e,t){var r=$(e),t=t||{};r.off("click").removeAttr("hidden");r.fadeIn(250,function(){r.on("click",".tc-modal-close",function(e){e.stopPropagation();return TC.Util.closeModal(t.closeCallback)});$.isFunction(t.openCallback)&&t.openCallback()})},closeModal:function(e){$(".tc-modal").hide().find(".tc-modal-window").removeAttr("style").off();e&&e()},closeAlert:function(e){$(e).parents(".tc-alert").hide()},getParameterByName:function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)","i"),r=t.exec(location.search);return null===r?"":decodeURIComponent(r[1].replace(/\+/g," "))},getLocaleUserChoice:function(e){var t="en_US";e=e||{};var r=e.cookieName||"SITNA.language",n=e.paramName||"lang",i=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language||navigator.userLanguage,a=TC.Util.getParameterByName(n)||TC.Util.storage.getCookie(r)||i,s=a.indexOf("-");s>=0&&(a=a.substr(0,s));var o=new Date((new Date).getTime()+31536e6);TC.Util.storage.setCookie(r,a,{expires:o});switch(a){case"eu":t="eu_ES";break;case"es":t="es_ES";break;default:t="en_US"}return t},downloadBlob:function(e,t){var r=document.createElement("a");if(void 0!==r.download){var n=URL.createObjectURL(t);r.setAttribute("href",n);r.setAttribute("download",e);r.style.visibility="hidden";document.body.appendChild(r);r.click();document.body.removeChild(r)}},downloadFile:function(e,t,r){var n=new Blob([r],{type:t});navigator.msSaveBlob?navigator.msSaveBlob(n,e):TC.Util.downloadBlob(e,n)},downloadDataURI:function(e,t,r){for(var n=atob(r.split(",")[1]),i=[],a=0;a<n.length;a++)i.push(n.charCodeAt(a));var s=new Blob([new Uint8Array(i)],{type:t});navigator.msSaveBlob?navigator.msSaveBlob(s,e):TC.Util.downloadBlob(e,s)},shortenUrl:function(e){var t;$.ajax({url:"https://api-ssl.bitly.com/v3/shorten",data:{access_token:"6c466047309f44bd8173d83e81491648b243ee3d",longUrl:e},async:!1}).done(function(e){t=e.data.url});return t},utf8ToBase64:function(e){return window.btoa(unescape(encodeURIComponent(e)))},base64ToUtf8:function(e){var t;try{t=decodeURIComponent(escape(window.atob(e)))}catch(r){t=null}return t},operation:function(e,t,r,n){for(var i=[],a=0;a<e.length;a++){for(var s=e[a],o=!1,l=0;l<t.length;l++)if(r(s,t[l])){o=!0;break}o===n&&i.push(s)}return i},isSecureURL:function(e){return/^(f|ht)tps?:\/\//i.test(e)?/^(f|ht)tps:\/\//i.test(e):!0},inBoth:function(e,t,r){return this.operation(e,t,r,!0)},inFirstOnly:function(e,t,r){return this.operation(e,t,r,!1)},inSecondOnly:function(e,t,r){return this.inFirstOnly(t,e,r)},toDataUrl:function(e,t){var r={type:"image/png",encoderOptions:.92},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,i=n.type,a=n.encoderOptions,s=e.getContext("2d");if(!s)return"";var o=e.width,l=e.height,c=s.getImageData(0,0,o,l),u=s.globalCompositeOperation;if(t){s.globalCompositeOperation="destination-over";s.fillStyle=t;s.fillRect(0,0,o,l)}var p=e.toDataURL(i,a);if(t){s.clearRect(0,0,o,l);s.putImageData(c,0,0);s.globalCompositeOperation=u}return p},imgToDataUrl:function(e,t){var r=function(e){var t=document.createElement("CANVAS"),r=t.getContext("2d");t.height=e.height;t.width=e.width;r.drawImage(e,0,0);return t},n=$.Deferred(),i=new Image;i.crossOrigin="anonymous";i.onload=function(){var e,a=r(i);e=TC.Util.toDataUrl(a,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});n.resolve(e,a)};i.onerror=function(a){var s=new XMLHttpRequest;s.open("GET",TC.proxify(e),!0);s.setRequestHeader("Content-Type","application/x-www-form-urlencoded");s.responseType="arraybuffer";s.onload=function(e){if(200===this.status){for(var a=new Uint8Array(this.response),o=a.length,l=new Array(o);o--;)l[o]=String.fromCharCode(a[o]);var c=l.join(""),u=s.getResponseHeader("content-type");if(0===u.indexOf("image")){i.src="data:"+u+";base64,"+window.btoa(c);i.onload=function(){var e=r(i);dataURL=TC.Util.toDataUrl(e,"#ffffff",{type:t||"image/jpeg",encoderOptions:1});n.resolve(dataURL,e)}}}};s.onreadystatechange=function(){4===s.readyState&&200!==s.status&&n.reject()};s.send()};var a=e.replace(/^https?\:/i,"");i.src=a;if(i.complete||void 0===i.complete){i.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";i.src=a}return n.promise()},addToCanvas:function(e,t,r){var n=TC.Util.cloneCanvas(e),i=$.Deferred(),a=n.getContext("2d"),s=new Image;t.crossOrigin="anonymous";s.src=t;s.onload=function(){a.drawImage(s,r.x||0,r.y||0);i.resolve(n)};return i.promise()},cloneCanvas:function(e){var t=document.createElement("canvas"),r=t.getContext("2d");t.width=e.width;t.height=e.height;r.drawImage(e,0,0);return t},calculateAspectRatioFit:function(e,t,r,n){var i=Math.min(r/e,n/t);return{width:e*i,height:t*i}},getFormattedDate:function(e,t){function r(e){return 10>e?"0"+e:e}var n=new Date(e);return[n.getFullYear(),r(n.getMonth()+1),r(n.getDate())].concat(t?["_",r(n.getHours()),r(n.getMinutes()),r(n.getSeconds())]:[]).join("")},replaceAccent:function(e){var t={"\xe4":"a","\xf6":"o","\xfc":"u","\xc4":"A","\xd6":"O","\xdc":"U","\xe1":"a","\xe9":"e",i:"i","\xf3":"o","\xfa":"u","\xc1":"A","\xc9":"E","\xcd":"I","\xd3":"O","\xda":"U","\xf1":"n","\xd1":"N"};return e.replace(/[\xf6\xe4\u00fc\xd6\xc4\u00dc\u00e1\u00e9\u00ed\u00f3\u00fa\u00c1\u00c9\u00cd\u00d3\u00da\u00f1\u00d1]/g,function(e){return t[e]})},downloadFileForm:function(e,t){var r=function(e,t){var r=$("<form/>",{"class":"tc-ctl-download-form",method:"post",enctype:"text/plain",action:TC.Util.detectIE()?TC.proxify(e):e}),n=$("<input/>",{"class":"tc-ctl-download-query",name:t.substring(0,t.indexOf("="))});r.append(n);var i=$("iframe").filter(function(t,r){return $(r).data("url-download")===e});if(i.length>0)i=i.first();else{i=$('<iframe style="visibility: hidden; display:none;"></iframe>');i.data("url-download",e);$("body").append(i)}var a=i[0].contentDocument;a.open();a.write(r[0].outerHTML);a.close();$("input",a).val(t.substring(t.indexOf("=")+1));r=$("form",a);return r},n=[];if(jQuery.isArray(e))for(var i=e,a=0;a<i.length;a++)n.push(r(i[a].url,i[a].data));else n.push(r(e,t));$(n).submit();setTimeout(function(){$(".tc-ctl-download-form").remove()},1e3)},WFSQueryBuilder:function(e,t,r,n,i){$.isArray(e)||(e=[e]);var a='xsi:schemaLocation="http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd" xmlns:ogc="http://www.opengis.net/ogc" service="WFS" {resultType} {format} ';switch(r.version){case"1.0.0":case"1.1.0":a+='xmlns:gml="http://www.opengis.net/gml" xmlns:wfs="http://www.opengis.net/wfs" ';break;case"2.0.0":a+='xmlns:wfs="http://www.opengis.net/wfs/2.0" xmlns:gml="http://www.opengis.net/gml/3.2" '}for(var s in r)"string"==typeof r[s]&&s.indexOf("gml")<0&&r[s].indexOf("wfs")<0&&(a+=s+'="'+r[s]+'" ');var o="<wfs:GetFeature "+a.format({resultType:i?'resultType="hits"':"",format:'outputFormat="'+n+'"'})+">",l="",c="<wfs:Query typeName"+("2.0.0"===r.version?"s":"")+'="{typeName}">{filter}</wfs:Query>';$.each(e,function(e,n){l+=c.format({typeName:n,filter:TC.Util.WFSFilterBuilder(t,r.version)})});o+=l+"</wfs:GetFeature>";return o},WFSFilterBuilder:function(e,t){var r="";if(jQuery.isPlainObject(e))r='<{prefix}:Filter><{prefix}:Intersects><fes:ValueReference></fes:ValueReference><{prefix}:Function name="querySingle"><{prefix}:Literal>{clipLayer}</{prefix}:Literal><{prefix}:Literal>{geometryName}</{prefix}:Literal><{prefix}:Literal>{where}</{prefix}:Literal></{prefix}:Function></{prefix}:Intersects></{prefix}:Filter>'.format({prefix:"2.0.0"===t?"fes":"ogc",clipLayer:e.clipLayer,geometryName:e.geometryName,where:e.where});else switch(!0){case!e:break;case $.isArray(e):var n="<gml:Envelope><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({lowerCorner:e[0]+" "+e[1],upperCorner:e[2]+" "+e[3]});switch(!0){case"1.0.0"===t:case"1.1.0"===t:r+="<ogc:Filter><ogc:BBOX>"+n+"</ogc:BBOX></ogc:Filter>";break;case"2.0.0"===t:r+="<fes:Filter><fes:BBOX>"+n+"</fes:BBOX></fes:Filter>"}break;case e instanceof TC.Feature:switch(!0){case"1.0.0"===t:case"1.1.0"===t:r+="<ogc:Filter><ogc:Intersects><ogc:PropertyName></ogc:PropertyName>"+TC.Util.writeGMLGeometry(e,"2.0")+"</ogc:Intersects></ogc:Filter>";break;case"2.0.0"===t:r+="<fes:Filter><fes:Intersects><fes:ValueReference></fes:ValueReference>"+TC.Util.writeGMLGeometry(e,"3.2")+"</fes:Intersects></fes:Filter>"}break;default:TC.error("Geometr\xeda no v\xe1lida")}return r},writeGMLGeometry:function(e,t){var r=function(e){var r;if(0===t.indexOf("3")){r=e.toString();for(;r.indexOf(",")>=0;)r=r.replace(","," ")}else{r=e;jQuery.each(r,function(e,t){return t.join(",")}).join(" ")}return r};switch(t){case"3.1.1":break;case"3.2":switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return'<gml:LineString srsDimension="2"><gml:posList>'+r(e.geometry)+"</gml:posList></gml:LineString>";default:return'<gml:Polygon srsDimension="2"><gml:exterior><gml:LinearRing><gml:posList>'+r(e.geometry[0])+"</gml:posList></gml:LinearRing></gml:exterior></gml:Polygon>"}break;case"2.0":default:switch(!0){case TC.feature.Polyline&&e instanceof TC.feature.Polyline:return"<gml:LineString><gml:coordinates>"+r(e.geometry[0])+"</gml:coordinates></gml:LineString>";default:return"<gml:Polygon><gml:outerBoundaryIs><gml:LinearRing><gml:coordinates>"+r(e.geometry[0])+"</gml:coordinates></gml:LinearRing></gml:outerBoundaryIs></gml:Polygon>"}}}};String.prototype.format=function(){var e=this.toString();if(!arguments.length)return e;var t=typeof arguments[0],t="string"==t||"number"==t?arguments:arguments[0];for(arg in t)e=e.replace(RegExp("\\{"+arg+"\\}","gi"),t[arg]);return e};return l});!function(e,t){"use strict";function r(e,t){var r=e.length;~t&&r>t&&(r=t);return r}function n(e,t){L.setTimeout(e,t||0)}function i(e){n(function(){throw e})}function a(e){return/(^(https?:)?\/\/)|(\.(js|php)$)/.test(e)&&!/(\n|\r)/m.test(e)}function s(e){return e&&e.constructor&&e.call&&e.apply}function o(e){var t;return(t=Array.isArray)?t(e)?e:[e]:w.concat(e)}function l(e){return w.slice.call(e)}function c(){var e=l(arguments);return function(){return E.apply(E,e.concat(l(arguments)))}}function u(e,t){var r=this;if((!r.readyState||/^c|loade/.test(r.readyState))&&!r.loadStatus){r.onload=r.onreadystatechange=r.onerror=null;r.loadStatus=!0;if(t&&"error"===t.type){var n=r.src||"Resource",a=" fails to load.",s={name:"ConnectionError",source:n,evt:t,stack:n+a,message:a,toString:function(){return this.source+this.message}};i(s);e.reject(s)}else e.resolve()}}function p(e,t){var r="script",n=T.createElement(r),i=T.getElementsByTagName(r),a=i[i.length-1];n.async=!0;n.src=e;if(t){n.loadStatus=!1;var s=c(u,n,t);n.onload=n.onreadystatechange=n.onerror=s;var o=a;o=o||document.body.firstChild;o.parentNode.insertBefore(n,o)}}function h(e,t){S(function(){try{e.call(null,t)}catch(r){t.reject(r)}})}function d(e,t){if(!s(e)){if(a(e)){p(e,t);return}if(b){e=v+encodeURIComponent(e);p(e,t);return}}var r=s(e)?e:Function(e);if(!t.async){var n=r;r=function(e){try{n.call(null);e.resolve()}catch(t){e.reject(t)}}}h(r,t)}function f(e,t){var r=this;r.tasks=[];r.callbacks=[];r.errors=[];r.data={};r.nextTask=0;r.nextCallback=0;r.until=-1;r.digest=!1;r.add(e).whenDone(t)}function m(){var e=this;if(e.digest)n(c(m,e),50/3);else{e.digest=!0;for(var t,i,a=e.nextCallback;a<r(e.callbacks,e.until);a++)if(e.nextTask===e.tasks.length){i=e.nextCallback;t=e.callbacks[i];if(t){e.nextCallback=a+1;t.call(null,e.data,e.nextTask-1,e.errors);if(!t.untilThen)continue;e.nextCallback--;e.until=-1}e.callbacks.splice(i,1)}e.digest=!1}}function y(){var e=this;if(e.nextTask<e.tasks.length&&++e.nextTask!==e.tasks.length)return e;m.call(e);return e}function g(e,t){return new f(e,t)}var v="data:application/javascript,",C="OMITTED",T=document,L=window,w=Array.prototype,b=!0;T.all&&!T.addEventListener&&(b=!1);var S=L.requestAnimationFrame||L.webkitRequestAnimationFrame||L.mozRequestAnimationFrame||n,E=Function.call;f.prototype.resolve=function(e,t){var r=this;e&&e!==C&&(r.data[e]=t);return y.call(r)};f.prototype.reject=function(e){var t=this;if(e){i(e);t.errors.push(e)}return y.call(t)};f.prototype.whenDone=function(e){var t=this;if(!e)return t;if(t.nextTask>t.tasks.length)return t;t.callbacks.push(e);t.nextTask===t.tasks.length&&t.resolve();return t};f.prototype.add=function(e,t){var r=this;if(!e)return r;if(t&&r[t]){var n=new Error("Callback value name: "+t+" is registered");i(n);r.errors.push(n)}e=o(e);for(var a,s=({resolve:c(r.resolve,r,t),reject:r.reject,async:!!t},0);s<e.length;s++){a=e[s];if(a){r.tasks.push(a);d(a,r)}}return r};f.prototype.then=function(e,t){function r(){n.until=n.nextCallback;n.add(e,t)}var n=this;if(!e)return n;r.untilThen=!0;return n.whenDone(r)};"undefined"!=typeof module&&module.exports?module.exports=g:"function"==typeof define&&define.amd?define(function(){return g}):t[e]=g}("asyncJS",this);var TC=TC||{};TC.version="1.3.0";!function(){if(!TC.apiLocation){var e,t;if(document.currentScript)t=document.currentScript;else{var r=document.getElementsByTagName("script");t=r[r.length-1]}var e=t.getAttribute("src");TC.apiLocation=e.substr(0,e.lastIndexOf("/")+1)}}();if(!TC.Consts){TC.Consts={};TC.Consts.OLNS_LEGACY="OpenLayers";TC.Consts.OLNS="ol";TC.Consts.PROJ4JSOBJ_LEGACY="Proj4js";TC.Consts.PROJ4JSOBJ="proj4";TC.Consts.GEOGRAPHIC="geographic";TC.Consts.UTM="UTM";TC.Consts.OLD_BROWSER_ALERT="TC.oldBrowserAlert";TC.Consts.CLUSTER_ANIMATION_DURATION=200;TC.Consts.ZOOM_ANIMATION_DURATION=300;TC.Consts.URL_MAX_LENGTH=2048;TC.Consts.METER_PRECISION=0;TC.Consts.DEGREE_PRECISION=5;TC.Consts.EXTENT_TOLERANCE=.9998;TC.Consts.url={SPLIT_REGEX:/([^:]*:)?\/\/([^:]*:?[^@]*@)?([^:\/\?]*):?([^\/\?]*)/,MODERNIZR:"lib/modernizr.js",JQUERY_LEGACY:TC.apiLocation+"lib/jquery/jquery.1.10.2.js",JQUERY:"//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.js",OL_LEGACY:"lib/OpenLayers/OpenLayers.debug.js",OL:"lib/ol/build/ol-custom.js",OL_CONNECTOR_LEGACY:"TC/ol/ol2.js",OL_CONNECTOR:"TC/ol/ol.js",TEMPLATING:"lib/dust/dust-full-helpers.min.js",TEMPLATING_I18N:"lib/dust/dustjs-i18n.min.js",TEMPLATING_OVERRIDES:"lib/dust/dust.overrides.js",PROJ4JS_LEGACY:"lib/proj4js/legacy/proj4js-compressed.js",PROJ4JS:"lib/proj4js/proj4-src.js",SPATIALREFERENCE:"http://spatialreference.org/",LOCALFORAGE:TC.apiLocation+"lib/localForage/localforage.min.js",D3C3:TC.apiLocation+"lib/d3c3/d3c3.min.js",CESIUM:TC.apiLocation+"lib/cesium/release/Cesium.js",JSNLOG:"lib/jsnlog/jsnlog.min.js",ERROR_LOGGER:TC.apiLocation+"errors/logger.ashx",PDFMAKE:TC.apiLocation+"lib/pdfmake/pdfmake-fonts.min.js",JSONPACK:"lib/jsonpack/jsonpack.min.js"};TC.Consts.classes={MAP:"tc-map",POINT:"tc-point",MARKER:"tc-marker",VISIBLE:"tc-visible",HIDDEN:"tc-hidden",COLLAPSED:"tc-collapsed",CHECKED:"tc-checked",DISABLED:"tc-disabled",ACTIVE:"tc-active",LASTCHILD:"tc-lastchild",TRANSPARENT:"tc-transparent",DROP:"tc-drop",LOADING:"tc-loading",IPAD_IOS7_FIX:"tc-ipad-ios7-fix",INFO:"tc-msg-info",WARNING:"tc-msg-warning",ERROR:"tc-msg-error"};TC.Consts.msgType={INFO:"info",WARNING:"warning",ERROR:"error"};TC.Consts.msgErrorMode={TOAST:"toast",CONSOLE:"console",EMAIL:"email"};TC.Consts.event={MAPLOAD:"mapload.tc",MAPREADY:"mapready.tc",BEFORELAYERADD:"beforelayeradd.tc",LAYERADD:"layeradd.tc",LAYERREMOVE:"layerremove.tc",LAYERORDER:"layerorder.tc",BEFORELAYERUPDATE:"beforelayerupdate.tc",LAYERUPDATE:"layerupdate.tc",LAYERERROR:"layererror.tc",BEFOREBASELAYERCHANGE:"beforebaselayerchange.tc",BASELAYERCHANGE:"baselayerchange.tc",BEFOREUPDATE:"beforeupdate.tc",UPDATE:"update.tc",BEFOREZOOM:"beforezoom.tc",ZOOM:"zoom.tc",BEFOREUPDATEPARAMS:"beforeupdateparams.tc",UPDATEPARAMS:"updateparams.tc",VECTORUPDATE:"vectorupdate.tc",FEATUREADD:"featureadd.tc",BEFOREFEATURESADD:"beforefeaturesadd.tc",FEATURESADD:"featuresadd.tc",FEATUREREMOVE:"featureremove.tc",FEATURESCLEAR:"featuresclear.tc",FEATURESIMPORT:"featuresimport.tc",FEATURESIMPORTERROR:"featuresimporterror.tc",BEFORETILELOAD:"beforetileload.tc",TILELOAD:"tileload.tc",TILELOADERROR:"tileloaderror.tc",CONTROLADD:"controladd.tc",CONTROLACTIVATE:"controlactivate.tc",CONTROLDEACTIVATE:"controldeactivate.tc",BEFORECONTROLRENDER:"beforecontrolrender.tc",CONTROLRENDER:"controlrender.tc",BEFORELAYOUTLOAD:"beforelayoutload.tc",LAYOUTLOAD:"layoutload.tc",LAYERVISIBILITY:"layervisibility.tc",LAYEROPACITY:"layeropacity.tc",FEATURECLICK:"featureclick.tc",NOFEATURECLICK:"nofeatureclick.tc",FEATUREOVER:"featureover.tc",FEATUREOUT:"featureout.tc",BEFOREFEATUREINFO:"beforefeatureinfo.tc",FEATUREINFO:"featureinfo.tc",NOFEATUREINFO:"nofeatureinfo.tc",FEATUREINFOERROR:"featureinfoerror.tc",CLICK:"click.tc",MOUSEUP:"mouseup.tc",STARTLOADING:"startloading.tc",STOPLOADING:"stoploading.tc",EXTERNALSERVICEADDED:"externalserviceadded.tc",
ZOOMTO:"zoomto.tc"};TC.Consts.layer={IDENA_ORTHOPHOTO:"ortofoto",IDENA_BASEMAP:"mapabase",IDENA_CADASTER:"catastro",IDENA_CARTO:"cartografia",IDENA_ORTHOPHOTO2012:"ortofoto2012",IDENA_DYNBASEMAP:"mapabase_dinamico",IDENA_BW_RELIEF:"relieve_bn",IDENA_BASEMAP_ORTHOPHOTO:"base_orto",BLANK:"ninguno"};TC.Consts.text={API_ERROR:"Error API SITNA",APP_ERROR:"Error de aplicaci\xf3n"};TC.Consts.layerType={WMS:"WMS",WMTS:"WMTS",WFS:"WFS",VECTOR:"vector",KML:"KML",GPX:"GPX",GEOJSON:"GeoJSON",GROUP:"group"};TC.Consts.geom={POINT:"point",MULTIPOINT:"multipoint",POLYLINE:"polyline",POLYGON:"polygon",MULTIPOLYLINE:"multipolyline",MULTIPOLYGON:"multipolygon",CIRCLE:"circle",RECTANGLE:"rectangle"};TC.Consts.searchType={CADASTRAL:"cadastral",COORDINATES:"coordinates",MUNICIPALITY:"municipality",COUNCIL:"council",LOCALITY:"locality",STREET:"street",NUMBER:"number",URBAN:"urban",COMMONWEALTH:"commonwealth",ROAD:"road",ROADPK:"roadpk"};TC.Consts.mapSearchType={MUNICIPALITY:TC.Consts.searchType.MUNICIPALITY,COUNCIL:TC.Consts.searchType.COUNCIL,URBAN:TC.Consts.searchType.URBAN,COMMONWEALTH:TC.Consts.searchType.COMMONWEALTH,GENERIC:"generic"};TC.Consts.comparison={EQUAL_TO:"=="};TC.Consts.WMTSEncoding={KVP:"KVP",RESTFUL:"RESTful"};TC.Consts.mimeType={PNG:"image/png",JPEG:"image/jpeg",JSON:"application/json",KML:"application/vnd.google-earth.kml+xml",GML:"application/gml+xml",XML:"application/xml"};TC.Consts.format={JSON:"JSON",KML:"KML",GML:"GML",GML2:"GML2",GML3:"GML2",GEOJSON:"GeoJSON",TOPOJSON:"TopoJSON",GPX:"GPX",WKT:"WKT"};TC.Consts.visibility={NOT_VISIBLE:0,NOT_VISIBLE_AT_RESOLUTION:1,HAS_VISIBLE:2,VISIBLE:4};TC.Consts.MARKER="marker";TC.Defaults=function(){var e={},t=function(t){var r=t.features.length,n=e[r];if(!n){n=Math.round(15*Math.sqrt(r));e[r]=n}return n},r={},n=function(e){var t=e.features.length,n=r[t];if(!n){var i=Math.round(100+155*Math.min(6,t)/6);i>255&&(i=255);var a=Math.round(255-155*Math.max(0,t-4)/6);100>a&&(a=100);var s=100;n="#"+i.toString(16)+a.toString(16)+s.toString(16);r[t]=n}return n};return{imageRatio:1.05,proxy:"",crs:"EPSG:25830",utmCrs:"EPSG:25830",geoCrs:"EPSG:4326",initialExtent:[541084.221,4640788.225,685574.4632,4796618.764],maxExtent:[480408,4599748,742552,4861892],baselayerExtent:[480408,4599748,742552,4861892],resolutions:[1024,512,256,128,64,32,16,8,4,2,1,.5,.25],pointBoundsRadius:30,extentMargin:.2,mouseWheelZoom:!0,attribution:'<a href="http://sitna.navarra.es/" target="_blank">SITNA</a>',oldBrowserAlert:!0,notifyApplicationErrors:!1,maxErrorCount:10,locale:"es_ES",screenSize:20,pixelTolerance:10,toastDuration:5e3,avgTileSize:31e3,availableBaseLayers:[{id:TC.Consts.layer.IDENA_BASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830extended",layerNames:"mapabase",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/png",isDefault:!0,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png"},{id:TC.Consts.layer.IDENA_ORTHOPHOTO,title:"Ortofoto 2014",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830reduced",layerNames:"ortofoto2014",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-orthophoto.jpg"},{id:TC.Consts.layer.IDENA_ORTHOPHOTO2012,title:"Ortofoto 2012",type:TC.Consts.layerType.WMTS,url:"//idena.navarra.es/ogc/wmts/",matrixSet:"epsg25830",layerNames:"ortofoto2012",encoding:TC.Consts.WMTSEncoding.RESTFUL,format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-ortho2012.jpg"},{id:TC.Consts.layer.IDENA_CADASTER,title:"Catastro",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"catastro,regionesFronterizas",format:"image/png",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-cadaster.png"},{id:TC.Consts.layer.IDENA_CARTO,title:"Cartograf\xeda topogr\xe1fica",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:cartografia_topografica",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-carto.png"},{id:TC.Consts.layer.IDENA_BW_RELIEF,title:"Relieve",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"IDENA:mapa_relieve_bn",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-relief_bw.jpg"},{id:TC.Consts.layer.IDENA_BASEMAP_ORTHOPHOTO,title:"Mapa base/ortofoto 2014",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase_orto",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-base_ortho.jpg"},{id:TC.Consts.layer.IDENA_DYNBASEMAP,title:"Mapa base",type:TC.Consts.layerType.WMS,url:"//idena.navarra.es/ogc/wms",layerNames:"mapaBase,regionesFronterizas",format:"image/jpeg",isDefault:!1,hideTree:!0,thumbnail:TC.apiLocation+"TC/css/img/thumb-basemap.png"},{id:TC.Consts.layer.BLANK,title:"Mapa en blanco",type:TC.Consts.layerType.VECTOR}],baseLayers:[TC.Consts.layer.IDENA_BASEMAP,TC.Consts.layer.IDENA_ORTHOPHOTO,TC.Consts.layer.IDENA_CADASTER,TC.Consts.layer.IDENA_CARTO],defaultBaseLayer:TC.Consts.layer.IDENA_BASEMAP,workLayers:[],controls:{loadingIndicator:!0,navBar:!1,scaleBar:!1,scale:!1,scaleSelector:!1,overviewMap:!1,basemapSelector:!1,attribution:!0,TOC:!1,coordinates:!0,legend:!1,popup:!1,search:{url:"//idena.navarra.es/ogc/wfs",allowedSearchTypes:{coordinates:{},municipality:{}}},measure:!1,streetView:!0,featureInfo:!0},layout:null,styles:{point:{fillColor:"#f00",fillOpacity:.5,strokeColor:"#f00",strokeWidth:2,radius:6},marker:{classes:[TC.Consts.classes.MARKER+1,TC.Consts.classes.MARKER+2,TC.Consts.classes.MARKER+3,TC.Consts.classes.MARKER+4,TC.Consts.classes.MARKER+5],anchor:[.5,1],width:32,height:32},line:{strokeColor:"#f00",strokeWidth:2},polygon:{strokeColor:"#f00",strokeWidth:2,fillColor:"#000",fillOpacity:.3},cluster:{point:{cssClass:"",anchor:[.5,.5],fillColor:n,fillOpacity:.6,width:t,height:t,label:"${features.length}",fontColor:"#000",fontSize:12}},selection:{point:{fillColor:"#00f",fillOpacity:.5,strokeColor:"#00f",strokeWidth:2,radius:6},line:{strokeColor:"#00f",strokeWidth:2},polygon:{strokeColor:"#00f",strokeWidth:2,fillColor:"#000",fillOpacity:.3}}}}}();!function(){Array.prototype.map||(Array.prototype.map=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=new Array(r),i=arguments.length>=2?arguments[1]:void 0,a=0;r>a;a++)a in t&&(n[a]=e.call(i,t[a],a,t));return n});TC.proxify=function(e){e=$.trim(e);var t=e;if(TC.Cfg.proxy){var r=!1;if(TC.Cfg.proxyExceptions)for(var n=0;n<TC.Cfg.proxyExceptions.length;n++)if(e.indexOf(TC.Cfg.proxyExceptions[n])>-1){r=!0;break}if(!r&&!TC.Util.isSameOrigin(e))if("function"==typeof TC.Cfg.proxy)t=TC.Cfg.proxy(e);else{t=TC.Cfg.proxy;"http"!=e.substr(0,4)&&(t+=window.location.protocol);t+=encodeURIComponent(e)}}return t};var e=function(){var e,t=document,r=t.getElementsByTagName("head");if(0===r.length){e=t.createElement("head");t.documentElement.insertBefore(e,document.body)}else e=r[0];return e};"boolean"!=typeof TC.isDebug&&(TC.isDebug=!1);TC.syncLoadJS=function(t){/(\.js|\/)$/i.test(t)||(t+=TC.isDebug?".js":".min.js");var r=new XMLHttpRequest;r.open("GET",t,!1);r.send(null);var n=document.createElement("script");n.type="text/javascript";n.text=r.responseText;e().appendChild(n)};window.yepnope||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.MODERNIZR);TC.isLegacy=!0;window.jQuery||TC.syncLoadJS(Modernizr.canvas&&!TC.isLegacy?TC.Consts.url.JQUERY:TC.Consts.url.JQUERY_LEGACY);$(document).ready(function(){var e,t="Unknown library",r="OpenLayers 2",n="OpenLayers 4";if(TC.Control){e="Compiled";TC.isLegacy?window.OpenLayers&&(t=r):window.ol&&(t=n)}else{e="On demand";t=TC.isLegacy?r:n}TC.version=TC.version+" ("+e+"; "+t+"; @ "+TC.apiLocation+")"});TC.downloadedJSs=[];TC.requestedJSs={};TC.loadJSInOrder=function(e,t,r){TC.loadJS(e,t,r,!0)};TC.loadJS=function(e,t,r,n){arguments.length<4&&(n=!1);var i=$.isArray(t)?t:[t];i=$.map(i,function(e){return/\.js$/i.test(e)?e:e+(TC.isDebug?".js":".min.js")});if(Modernizr.canvas)if(e){for(var a,s=[],o=[],l=0;l<i.length;l++){a=i[l];TC.downloadedJSs[a]||(TC.requestedJSs[a]?o.push(a):s.push(a))}if(0==s.length&&0==o.length)r();else if(s.length>0&&0==o.length){for(var c=asyncJS(),l=0;l<s.length;l++)TC.requestedJSs[s[l]]=c;if(n)for(var l=0;l<s.length;l++)0==l?c.add(s[l]):c.then(s[l]);else c.add(s);c.whenDone(function(){for(var e=0;e<s.length;e++){TC.downloadedJSs.push(s[e]);delete TC.requestedJSs[s[e]]}r()})}else if(0==s.length&&o.length>0)for(var u,p=o.length,h=0,l=0;l<o.length;l++){var u=o[l],c=TC.requestedJSs[u];c.whenDone(function(e,t,n){h++;h>=p&&r()})}else console.error("Mezcla de tareas en proceso y nuevas!!")}else r();else{if(e)for(var l=0;l<i.length;l++)TC.syncLoadJS(i[l]);r&&r()}};var t=function(e){for(var t=!1,r=0;r<document.styleSheets.length;r++){var n=document.styleSheets[r].href;if(n){var i=n.indexOf(e);if(i>=0&&i===n.length-e.length){t=!0;break}}}return t};TC.loadCSS=function(r){if(!t(r)){var n=document.createElement("link");n.rel="stylesheet";n.href=r;e().appendChild(n)}};TC.loadProjDef=function(t,r){var n,i="EPSG:",a="urn:ogc:def:crs:EPSG::",s="http://www.opengis.net/gml/srs/epsg.xml#",o=i+"25830",l=a+"25830",c=s+"25830";if(TC.isLegacy){window[TC.Consts.PROJ4JSOBJ_LEGACY]||TC.syncLoadJS(TC.url.proj4js);Proj4js.defs[o]="+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs";Proj4js.defs[l]=Proj4js.defs[o];Proj4js.defs[c]=Proj4js.defs[o];n=function(e){return Proj4js.defs[e]}}else{window[TC.Consts.PROJ4JSOBJ]||TC.syncLoadJS(TC.url.proj4js);proj4.defs(o,"+proj=utm +zone=30 +ellps=GRS80 +units=m +no_defs");proj4.defs(l,proj4.defs(o));proj4.defs(c,proj4.defs(o));n=function(e){return proj4.defs(e)}}window.Proj4js||(window.Proj4js={Proj:function(e){return proj4(Proj4js.defs[e])},defs:proj4.defs,transform:proj4});var u=function(e){o=i+e;l=a+e;c=s+e;Proj4js.defs[l]=Proj4js.defs[o];Proj4js.defs[c]=Proj4js.defs[o];if(!TC.isLegacy){proj4.defs(o,Proj4js.defs[o]);proj4.defs(l,Proj4js.defs[o]);proj4.defs(c,Proj4js.defs[o])}};if(n(t)){if($.isFunction(r)){u(h);r()}}else{var p=t.lastIndexOf("#");0>p&&(p=t.lastIndexOf(":"));var h=t.substr(p+1),d=TC.proxify(TC.Consts.url.SPATIALREFERENCE+"ref/epsg/"+h+"/proj4js/");if("boolean"==typeof r)if(r){var f=new XMLHttpRequest;f.open("GET",d,!1);f.send(null);var m=document.createElement("script");m.type="text/javascript";m.text=f.responseText;e().appendChild(m);u(h)}else TC.loadJS(!0,d);else TC.loadJS(!0,d,function(){u(h);r()})}};TC.url={templating:[TC.apiLocation+TC.Consts.url.TEMPLATING,TC.apiLocation+TC.Consts.url.TEMPLATING_I18N,TC.apiLocation+TC.Consts.url.TEMPLATING_OVERRIDES]};if(TC.isLegacy){TC.url.ol=TC.apiLocation+TC.Consts.url.OL_LEGACY;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR_LEGACY;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS_LEGACY}else{TC.url.ol=TC.apiLocation+TC.Consts.url.OL;TC.url.olConnector=TC.apiLocation+TC.Consts.url.OL_CONNECTOR;TC.url.proj4js=TC.apiLocation+TC.Consts.url.PROJ4JS}TC.Cfg=$.extend(!0,{},TC.Defaults,TC.Cfg);TC.capabilities={};TC.WFScapabilities={};TC.cache={};TC.inherit=function(e,t){function r(){}r.prototype=t.prototype;e._super=t.prototype;e.prototype=new r;e.prototype.constructor=e};TC.alert=function(e){alert(e)};TC.prompt=function(e,t,r){var n=prompt(e,t);$.isFunction(r)&&r(n)};TC.confirm=function(e,t,r){confirm(e)?$.isFunction(t)&&t():$.isFunction(r)&&r()};TC.error=function(e){window.console&&console.error(e)};TC.Object=function(){var e=this;e.$events=$(e)};TC.Object.prototype.on=function(e,t){var r=this;r.$events.on(e,t);return r};TC.Object.prototype.one=function(e,t){var r=this;r.$events.one(e,t);return r};TC.Object.prototype.off=function(e,t){var r=this;r.$events.off(e,t);return r};TC.wrap={Map:function(e){var t=this;t.parent=e;t.map=null;t.mapDeferred=new $.Deferred;t.getMap=function(){return t.map||t.mapDeferred.promise()}},Layer:function(e){var t=this;t.parent=e;t.layer=null;t.layerDeferred=new $.Deferred;t.getLayer=function(){return t.layer||t.layerDeferred.promise()};t.setLayer=function(e){t.layer=e;e?t.layerDeferred.resolve(e):t.layerDeferred.reject()}},layer:{Raster:function(){TC.wrap.Layer.apply(this,arguments)},Vector:function(){TC.wrap.Layer.apply(this,arguments)}},Control:function(e){var t=this;t.parent=e},control:{Click:function(){TC.wrap.Control.apply(this,arguments)},ScaleBar:function(){TC.wrap.Control.apply(this,arguments)},NavBar:function(){TC.wrap.Control.apply(this,arguments)},Coordinates:function(){TC.wrap.Control.apply(this,arguments)},Search:function(){TC.wrap.Control.apply(this,arguments)},Measure:function(){TC.wrap.Control.apply(this,arguments)},OverviewMap:function(){TC.wrap.Control.apply(this,arguments)},FeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Popup:function(){TC.wrap.Control.apply(this,arguments)},GeometryFeatureInfo:function(){TC.wrap.Control.apply(this,arguments)},Geolocation:function(){TC.wrap.Control.apply(this,arguments)},Draw:function(){TC.wrap.Control.apply(this,arguments)},CacheBuilder:function(){TC.wrap.Control.apply(this,arguments)},Edit:function(){TC.wrap.Control.apply(this,arguments)}},Feature:function(){}};TC.inherit(TC.wrap.layer.Raster,TC.wrap.Layer);TC.inherit(TC.wrap.layer.Vector,TC.wrap.Layer);TC.inherit(TC.wrap.control.Click,TC.wrap.Control);TC.inherit(TC.wrap.control.ScaleBar,TC.wrap.Control);TC.inherit(TC.wrap.control.NavBar,TC.wrap.Control);TC.inherit(TC.wrap.control.Coordinates,TC.wrap.Control);TC.inherit(TC.wrap.control.Measure,TC.wrap.Control);TC.inherit(TC.wrap.control.OverviewMap,TC.wrap.Control);TC.inherit(TC.wrap.control.Popup,TC.wrap.Control);TC.inherit(TC.wrap.control.FeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.GeometryFeatureInfo,TC.wrap.control.Click);TC.inherit(TC.wrap.control.Geolocation,TC.wrap.Control);TC.inherit(TC.wrap.control.Draw,TC.wrap.Control);TC.inherit(TC.wrap.control.CacheBuilder,TC.wrap.Control);TC.inherit(TC.wrap.control.Edit,TC.wrap.Control);TC.loadCSS(TC.apiLocation+"TC/css/tcmap.css");TC.Map||TC.syncLoadJS(TC.apiLocation+"TC/Map");TC.Util||TC.syncLoadJS(TC.apiLocation+"TC/Util");var r=1;TC.getUID=function(){var e=r.toString();r+=1;return e}}();!function(e,t){function r(e){return e}function n(e){return decodeURIComponent(e.replace(i," "))}var i=/\+/g;e.cookie=function(i,a,s){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(a))||null===a)){s=e.extend({},e.cookie.defaults,s);null===a&&(s.expires=-1);if("number"==typeof s.expires){var o=s.expires,l=s.expires=new Date;l.setDate(l.getDate()+o)}a=String(a);return t.cookie=[encodeURIComponent(i),"=",s.raw?a:encodeURIComponent(a),s.expires?";expires="+s.expires.toUTCString():"",s.path?";path="+s.path:"",s.domain?";domain="+s.domain:"",s.secure?";secure":""].join("")}s=a||e.cookie.defaults||{};for(var c,u=s.raw?r:n,p=t.cookie.split("; "),h=0;c=p[h]&&p[h].split("=");h++)if(u(c.shift())===i)return u(c.join("="));return null};e.cookie.defaults={}}(jQuery,document)}$(function(){var e=function(){var e,t,r,n=(navigator.appVersion,navigator.userAgent),i=navigator.appName,a=""+parseFloat(navigator.appVersion),s=parseInt(navigator.appVersion,10);if(-1!=(t=n.indexOf("Opera"))){i="Opera";a=n.substring(t+6);-1!=(t=n.indexOf("Version"))&&(a=n.substring(t+8))}else if(-1!=(t=n.indexOf("MSIE"))){i="Microsoft Internet Explorer";a=n.substring(t+5)}else if(-1!=(t=n.indexOf("Chrome"))){i="Chrome";a=n.substring(t+7)}else if(-1!=(t=n.indexOf("Safari"))){i="Safari";a=n.substring(t+7);-1!=(t=n.indexOf("Version"))&&(a=n.substring(t+8))}else if(-1!=(t=n.indexOf("Firefox"))){i="Firefox";a=n.substring(t+8)}else if((e=n.lastIndexOf(" ")+1)<(t=n.lastIndexOf("/"))){i=n.substring(e,t);a=n.substring(t+1);i.toLowerCase()==i.toUpperCase()&&(i=navigator.appName)}-1!=(r=a.indexOf(";"))&&(a=a.substring(0,r));-1!=(r=a.indexOf(" "))&&(a=a.substring(0,r));s=parseInt(""+a,10);if(isNaN(s)){a=""+parseFloat(navigator.appVersion);s=parseInt(navigator.appVersion,10)}return{name:i,version:s}};TC.browser=e();if(TC.Cfg.oldBrowserAlert&&!Modernizr.mq("only all")&&!TC.Util.storage.getCookie(TC.Consts.OLD_BROWSER_ALERT)){alert("Con su "+TC.browser.name+" "+TC.browser.version+" la aplicaci\xf3n no funcionar\xe1. Le recomendamos que utilice un navegador m\xe1s actualizado.");TC.Util.storage.setCookie(TC.Consts.OLD_BROWSER_ALERT,1)}/ip(ad|hone|od)/i.test(navigator.userAgent)&&(TC.Consts.event.CLICK="touchstart.tc");window.JL||TC.syncLoadJS(TC.apiLocation+TC.Consts.url.JSNLOG);JL.defaultAjaxUrl=TC.Consts.url.ERROR_LOGGER;window.addEventListener("error",function(){var e=0,t=$("."+TC.Consts.classes.MAP).data("map");return function(r){var n=r.message,i=r.filename,a=r.lineno,s=r.colno,o=r.error,l=i.indexOf(TC.apiLocation)>0;if((TC.Cfg.notifyApplicationErrors||l)&&e<TC.Cfg.maxErrorCount){var c=l?TC.Consts.text.API_ERROR:TC.Consts.text.APP_ERROR;JL("onerrorLogger").fatalException({msg:c,errorMsg:n,url:i,lineNumber:a,column:s,appUrl:location.href,prevState:t.getPreviousMapState(),userAgent:navigator.userAgent},o);e++;if(!TC.isDebug){var u="webmaster@itracasa.es";$.when(TC.i18n.loadResources(!TC.i18n[t.options.locale],TC.apiLocation+"TC/resources/",t.options.locale)).done(function(){TC.error(TC.Util.getLocaleString(t.options.locale,"genericError")+(t.options.contactEmail||u),{type:TC.Consts.msgType.ERROR})})}}return!1}}(),!1)});TC.Layer=function(e){var t=this;t.options=e||{};$.extend(t,t.options);t.id=t.options.id||TC.getUID();t.map=t.options.map;t.type=t.options.type||TC.Consts.layerType.WMS;var r=t.options.isBase?TC.Consts.mimeType.JPEG:TC.Consts.mimeType.PNG;t.options.format=t.options.format||r;void 0===t.options.hideTree&&(t.options.hideTree=!0);void 0===t.options.hideTitle&&(t.options.hideTitle=!1);t._cache={visibilityStates:{}};t.tree=null;t.wrap=null};TC.Layer.state={IDLE:"idle",LOADING:"loading"};TC.Layer.prototype.setVisibility=function(e){this.wrap.setVisibility(e)};TC.Layer.prototype.getVisibility=function(){var e=this,t=!1;e.map&&(e.isBase&&e.map.getBaseLayer()!==e||(t=e.wrap.getVisibility()));return t};TC.Layer.prototype.getOpacity=function(){var e=this,t=!1;e.map&&(e.isBase&&e.map.getBaseLayer()!==e||(t=e.wrap.getLayer().getOpacity()));return t};TC.Layer.prototype.setOpacity=function(e,t){var r=this;$.when(this.wrap.getLayer()).then(function(n){n.setOpacity(e);r.map&&!t&&r.map.$events.trigger($.Event(TC.Consts.event.LAYEROPACITY,{layer:r,opacity:e}))})};TC.Layer.prototype.isCompatible=function(e){return!0};TC.Layer.prototype.isValidFromNames=function(){return!0};TC.Layer.prototype.isRaster=function(){var e=!0,t=this;switch(t.type){case TC.Consts.layerType.VECTOR:case TC.Consts.layerType.KML:case TC.Consts.layerType.WFS:case TC.Consts.layerType.GROUP:e=!1}return e};TC.Layer.prototype.isVisibleByScale=function(e){return!0};TC.Layer.prototype.isVisibleByName=function(e){return!0};TC.Layer.prototype.getTree=function(){var e=this,t={name:e.name,title:e.title};return t};TC.Layer.prototype.findNode=function e(t,r){var n=null;if(r.uid==t)n=r;else for(var i=0;i<r.children.length;i++){var a=e(t,r.children[i]);if(a){n=a;break}}return n};TC.Layer.prototype.setNodeVisibility=function(e,t){this.setVisibility(t)};TC.Layer.prototype.getNodeVisibility=function(e){return TC.Consts.visibility.VISIBLE};TC.Layer.prototype.getResolutions=function(){return this.wrap.getResolutions?this.wrap.getResolutions():[]};TC.control=TC.control||{};TC.Control=function(){var e=this;e.$events=$(e);e.map=null;e.isActive=!1;e.isDisabled=!1;e._firstRender=$.Deferred();var t=arguments.length;e.options=$.extend({},t>1?arguments[1]:arguments[0]);e.div=TC.Util.getDiv(e.options.div?e.options.div:arguments[0]);e._$div=$(e.div);e._$div.addClass(TC.Control.prototype.CLASS).addClass(e.CLASS);e.template=e.options.template||e.template};TC.Control.prototype.on=function(e,t){var r=this;r.$events.on(e,t);return r};TC.Control.prototype.one=function(e,t){var r=this;r.$events.one(e,t);return r};TC.Control.prototype.off=function(e,t){var r=this;r.$events.off(e,t);return r};TC.Control.prototype.CLASS="tc-ctl";TC.Control.prototype.template="";TC.Control.prototype.show=function(){this._$div.show()};TC.Control.prototype.hide=function(){this._$div.hide()};TC.Control.prototype.render=function(e){var t=this;t.renderData(null,e)};TC.Control.prototype.renderData=function(e,t){var r=this;if(r.map){var n=$.Event(TC.Consts.event.BEFORECONTROLRENDER,{dataObject:e});r.$events.trigger(n)}r._$div.toggleClass(TC.Consts.classes.DISABLED,r.isDisabled);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){var n,i=function(e){var t=$.Deferred(),r=[];for(var n in e){var i=e[n];if("string"==typeof i){var a=$.ajax({url:i,type:"get",dataType:"html"});a.templateKey=n;r.push(a)}else $.isFunction(i)&&i()}0==r.length?t.resolve():$.when.apply($,r).then(function(){if(3!=arguments.length||$.isArray(arguments[0]))for(var e=0;e<arguments.length;e++){var r=arguments[e],n=r[0],i=r[2].templateKey,a=dust.compile(n,i);dust.loadSource(a)}else{var n=arguments[0],i=arguments[2].templateKey,a=dust.compile(n,i);dust.loadSource(a)}t.resolve()},function(e,t,r){console.error("Deferred fallido")});return t};if("object"==typeof r.template)n=i(r.template);else{var a={};r.template&&(a[r.CLASS]=r.template);n=i(a)}n.then(function(){dust.cache[r.CLASS]&&dust.render(r.CLASS,e,function(e,t){r._$div.html(t);e&&TC.error(e)});r._firstRender.resolve();r.$events.trigger($.Event(TC.Consts.event.CONTROLRENDER));$.isFunction(t)&&t()})})};TC.Control.prototype.getRenderedHtml=function(e,t,r){var n=this,i=$.Deferred(),a=function(){dust.cache[e]&&dust.render(e,t,function(e,t){if(e){TC.error(e);i.reject()}else{$.isFunction(r)&&r(t);i.resolve(t)}})};TC.loadJSInOrder(!window.dust,TC.url.templating,function(){if(dust.cache[e])a();else{var t=n.template[e];if("string"==typeof t)$.ajax({url:t,type:"get",dataType:"html"}).done(function(){var t=arguments[0],r=dust.compile(t,e);dust.loadSource(r);a()});else if($.isFunction(t)){t();a()}}});return i};TC.Control.prototype.register=function(e){var t=this;t.map=e;t.render();t.options.active&&t.activate()};TC.Control.prototype.activate=function(){var e=this;if(e.map&&e.map.activeControl&&e.map.activeControl!=e){e.map.previousActiveControl=e.map.activeControl;e.map.activeControl.deactivate()}e.isActive=!0;if(e.map){e.map.activeControl=e;e.map.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:e}));e.$events.trigger($.Event(TC.Consts.event.CONTROLACTIVATE,{control:e}))}};TC.Control.prototype.deactivate=function(e){0==arguments.length&&(e=!1);var t=this;t.isActive=!1;if(t.map){t.map.activeControl=null;if(!e){var r=t.map.getDefaultControl();r==t?r=null:t.map.previousActiveControl==t?r=null:r||(r=t.map.previousActiveControl);r&&r.activate()}t.map.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:t}));t.$events.trigger($.Event(TC.Consts.event.CONTROLDEACTIVATE,{control:t}))}};TC.Control.prototype.enable=function(){var e=this;e.isDisabled=!1;e._$div&&e._$div.removeClass(TC.Consts.classes.DISABLED)};TC.Control.prototype.disable=function(){var e=this;e.isDisabled=!0;e._$div&&e._$div.addClass(TC.Consts.classes.DISABLED)};TC.Control.prototype.renderPromise=function(){return this._firstRender};TC.Control.prototype.isExclusive=function(){return!1};TC.Control.prototype.getLocaleString=function(e,t){var r=this,n=r.map?r.map.options.locale:TC.Cfg.locale;return TC.Util.getLocaleString(n,e,t)};TC.feature=TC.feature||{};TC.Feature=function(e,t){var r=this;r.wrap=new TC.wrap.Feature;r.wrap.parent=r;if($.isArray(e))r.geometry=e;else if(r.wrap.isNative(e)){r.wrap.feature=e;r.id=r.wrap.getId();r.geometry=r.wrap.getGeometry();r.folders=e._folders;r.data=r.wrap.getData()}var n=r.options=$.extend(!0,{},t);r.id=r.id||n.id||TC.getUID();r.data=n.data||r.data||null;r._visibilityState=TC.Consts.visibility.VISIBLE;r.showsPopup=void 0===n.showsPopup?!0:n.showsPopup;r.layer=n.layer||null;r._selected=!1;n.selected&&r.select()};TC.Feature.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.Feature.prototype.CLASSNAME="TC.Feature";TC.Feature.prototype.getPath=function(){var e=[],t=this;t.folders?e=t.folders:t.options.group&&(e=[t.options.group]);return e};TC.Feature.prototype.setVisibility=function(e){var t=this;if(e&&t._visibilityState===TC.Consts.visibility.NOT_VISIBLE||!e&&t._visibilityState===TC.Consts.visibility.VISIBLE){t._visibilityState=e?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;t.layer.wrap.setFeatureVisibility(t,e)}};TC.Feature.prototype.setId=function(e){var t=this;t.id=e;t.wrap.setId(e)};TC.Feature.prototype.getBounds=function(){return this.wrap.getBounds()};TC.Feature.prototype.setStyle=function(e){var t=this;$.extend(!0,t.options,e);this.wrap.setStyle(t.options)};TC.Feature.prototype.getLegend=function(){var e=this;e._legend||(e._legend=e.wrap.getLegend());return e._legend};TC.Feature.prototype.getData=function(){var e=null,t=this;e=t.data?t.data:t.wrap.getData();return e};TC.Feature.prototype.setData=function(e){var t=this;t.data=$.extend(t.data,e);t.wrap.setData(e)};TC.Feature.prototype.getInfo=function(){var e=null,t=this,r=t.layer&&t.layer.map&&TC.Util.getMapLocale(t.layer.map),n=t.getData();if("object"==typeof n){var i=t.wrap.getTemplate();if(i)e=i.replace(/\$\[?(?:\w+\/)*(\w+)\]/g,function(e,t){return n[t]});else{var a=[];for(var s in n){var o=n[s];if("string"==typeof o||"number"==typeof o||"undefined"==typeof o){a[a.length]="<tr><th>";a[a.length]=s;a[a.length]="</th><td>";var l=TC.Util.isURL(o);if(l){a[a.length]='<a href="';a[a.length]=o;a[a.length]='" target="_blank">'}a[a.length]=void 0!==o?TC.Util.formatNumber(o,r):"&mdash;";l&&(a[a.length]="</a>");a[a.length]="</td></tr>"}}if(a.length>0){a.unshift("<table>");a[a.length]="</table>";e=a.join("")}}}else"string"==typeof n&&(e=n);if(!e){e=t.title;t.group&&(e+=" "+t.group)}e||(e=TC.Util.getLocaleString(r.replace("-","_"),"noData"));return e};TC.Feature.prototype.clone=function(){var e=this,t=e.wrap.cloneFeature();t._wrap=e.wrap;return new e.constructor(t,e.options)};TC.Feature.prototype.getStyle=function(){return this.wrap.getStyle()};TC.Feature.prototype.showPopup=function(e){var t=this;if(t.layer&&t.layer.map){var r,n=e||t.popup;if(!n)for(var i=t.layer.map.getControlsByClass("TC.control.Popup"),a=0,s=i.length;s>a;a++){var o=i[a];if(!o.caller){n=o;break}}if(n){r=$.Deferred();r.resolve(n)}else TC.loadJS(!TC.control||!TC.control.Popup,[TC.apiLocation+"TC/control/Popup"],function(){r=t.layer.map.addControl(new TC.control.Popup)});r.then(function(e){e.currentFeature=t;for(var r=t.layer.map.getControlsByClass(TC.control.Popup),n=0,i=r.length;i>n;n++){var a=r[n];a!==e&&a.hide()}t.wrap.showPopup(e);t.layer.map.$events.trigger($.Event(TC.Consts.event.POPUP,{control:e}));e.fitToView(!0)})}};TC.Feature.prototype.select=function(){var e=this;e._selected=!0;e.layer&&e.layer.selectedFeatures.push(e);var t=e.options.selection||{};e.setStyle($.extend({},TC.Cfg.styles.selection[e.STYLETYPE],t[e.STYLETYPE]))};TC.Feature.prototype.unselect=function(){var e=this;e._selected=!1;e.setStyle();if(e.layer){var t=$.inArray(e,e.layer.selectedFeatures);t>=0&&e.layer.selectedFeatures.splice(t,1)}};TC.Feature.prototype.isSelected=function(){return this._selected};TC.Feature.prototype.toGML=function(e,t){return this.wrap.toGML(e,t)};TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Point=function(e,t){var r=this;TC.Feature.apply(r,arguments);var n;if(r.wrap.isNative(e)){e._wrap=r.wrap;r.wrap.feature=e}else{n=r.options=$.extend(!0,r.options,TC.Cfg.styles.point,t);r.wrap.createPoint(e,n)}};TC.inherit(TC.feature.Point,TC.Feature);!function(){var e=TC.feature.Point.prototype;e.STYLETYPE=TC.Consts.geom.POINT;e.CLASSNAME="TC.feature.Point";e.getCoords=function(){return this.wrap.getGeometry()};e.setCoords=function(e){return this.wrap.setGeometry(e)}}();TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Circle=function(e,t){var r=this;TC.Feature.apply(r,arguments);var n;if(r.wrap.isNative(e)){e._wrap=r.wrap;r.wrap.feature=e}else{n=r.options=$.extend(!0,r.options,TC.Cfg.styles.polygon,t);r.wrap.createCircle(e,n)}};TC.inherit(TC.feature.Circle,TC.Feature);!function(){var e=TC.feature.Circle.prototype;e.STYLETYPE=TC.Consts.geom.POLYGON;e.CLASSNAME="TC.feature.Circle";e.getCoords=function(){return this.wrap.getGeometry()};e.setCoords=function(e){return this.wrap.setGeometry(e)}}();TC.feature=TC.feature||{};TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.feature.Marker=function(e,t){var r=this;TC.Feature.apply(r,arguments);if(r.wrap.isNative(e)){e._wrap=r.wrap;r.wrap.feature=e}else{var n=r.options=$.extend(!0,r.options,TC.Cfg.styles.marker,t),i=r.layer&&r.layer.map?r.layer.map.options.locale:TC.Cfg.locale;r.title=n.title||TC.i18n[i][TC.Consts.MARKER];r.wrap.createMarker(e,n)}};TC.inherit(TC.feature.Marker,TC.feature.Point);TC.feature.Marker.prototype.STYLETYPE="marker";TC.feature.Marker.prototype.CLASSNAME="TC.feature.Marker";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolygon=function(e,t){var r=this;TC.Feature.apply(r,arguments);var n;if(r.wrap.isNative(e)){e._wrap=r.wrap;r.wrap.feature=e}else{n=r.options=$.extend(!0,r.options,TC.Cfg.styles.polygon,t);r.wrap.createMultiPolygon(e,n)}};TC.inherit(TC.feature.MultiPolygon,TC.Feature);TC.feature.MultiPolygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.MultiPolygon.prototype.CLASSNAME="TC.feature.MultiPolygon";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.MultiPolyline=function(e,t){var r=this;TC.Feature.apply(r,arguments);var n;if(r.wrap.isNative(e)){e._wrap=r.wrap;r.wrap.feature=e}else{n=r.options=$.extend(!0,r.options,TC.Cfg.styles.line,t);r.wrap.createMultiPolyline(e,n)}};TC.inherit(TC.feature.MultiPolyline,TC.Feature);TC.feature.MultiPolyline.prototype.STYLETYPE=TC.Consts.geom.POLYLINE;TC.feature.MultiPolyline.prototype.CLASSNAME="TC.feature.MultiPolyline";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polygon=function(e,t){var r=this;TC.Feature.apply(r,arguments);var n;if(r.wrap.isNative(e)){e._wrap=r.wrap;r.wrap.feature=e}else{n=r.options=$.extend(!0,r.options,TC.Cfg.styles.polygon,t);r.wrap.createPolygon(e,n)}};TC.inherit(TC.feature.Polygon,TC.Feature);TC.feature.Polygon.prototype.STYLETYPE=TC.Consts.geom.POLYGON;TC.feature.Polygon.prototype.CLASSNAME="TC.feature.Polygon";TC.feature=TC.feature||{};TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");TC.feature.Polyline=function(e,t){var r=this;TC.Feature.apply(r,arguments);var n;if(r.wrap.isNative(e)){e._wrap=r.wrap;r.wrap.feature=e}else{n=r.options=$.extend(!0,r.options,TC.Cfg.styles.line,t);r.wrap.createPolyline(e,n)}};TC.inherit(TC.feature.Polyline,TC.Feature);TC.feature.Polyline.prototype.STYLETYPE=TC.Consts.geom.POLYLINE;TC.feature.Polyline.prototype.CLASSNAME="TC.feature.Polyline";TC.filter={};TC.filter.Filter=function(e){this.tagName_=e};TC.filter.Filter.prototype.getTagName=function(){return this.tagName_};TC.filter.Filter.prototype.writeFilterCondition_=function(){var e=this;return'<{prefix}:Filter xmlns:ogc="http://www.opengis.net/ogc">{inner}</{prefix}:Filter>'.format({prefix:"ogc",tag:e.getTagName(),inner:this.writeInnerCondition_(e)})};TC.filter.Filter.prototype.writeInnerCondition_=function(e){return e instanceof TC.filter.LogicalNary?e.write():e instanceof TC.filter.ComparisonBinary?e.write():e instanceof TC.filter.Comparison?e.write():(e instanceof TC.filter.Spatial,e.write())};TC.filter.Filter.prototype.writeInnerArrayCondition_=function(e){return e.reduce(function(e,t,r){return(e instanceof TC.filter.Filter?e.writeInnerCondition_(e):e)+t.writeInnerCondition_(t)})};TC.filter.Filter.prototype.getText=function(){return this.writeFilterCondition_()};TC.filter.and=function(e){var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.And,t))};TC.filter.or=function(e){
var t=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(TC.filter.Or,t))};TC.filter.not=function(e){return new TC.filter.Not(e)};TC.filter.bbox=function(e,t,r){return new TC.filter.Bbox(e,t,r)};TC.filter.intersects=function(e,t,r){return new TC.filter.Intersects(e,t,r)};TC.filter.within=function(e,t,r){return new TC.filter.Within(e,t,r)};TC.filter.equalTo=function(e,t,r){return new TC.filter.EqualTo(e,t,r)};TC.filter.notEqualTo=function(e,t,r){return new TC.filter.NotEqualTo(e,t,r)};TC.filter.lessThan=function(e,t){return new TC.filter.LessThan(e,t)};TC.filter.lessThanOrEqualTo=function(e,t){return new TC.filter.LessThanOrEqualTo(e,t)};TC.filter.greaterThan=function(e,t){return new TC.filter.GreaterThan(e,t)};TC.filter.greaterThanOrEqualTo=function(e,t){return new TC.filter.GreaterThanOrEqualTo(e,t)};TC.filter.isNull=function(e){return new TC.filter.IsNull(e)};TC.filter.between=function(e,t,r){return new TC.filter.IsBetween(e,t,r)};TC.filter["function"]=function(e,t){return new TC.filter.Function(e,t)};TC.filter.like=function(e,t,r,n,i,a){return new TC.filter.IsLike(e,t,r,n,i,a)};TC.filter.LogicalNary=function(e,t){TC.filter.Filter.call(this,e);this.conditions=Array.prototype.slice.call(arguments,1)};TC.inherit(TC.filter.LogicalNary,TC.filter.Filter);TC.filter.And=function(e){var t=["And"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,t)};TC.inherit(TC.filter.And,TC.filter.LogicalNary);TC.filter.Or=function(e){var t=["Or"].concat(Array.prototype.slice.call(arguments));TC.filter.LogicalNary.apply(this,t)};TC.inherit(TC.filter.Or,TC.filter.LogicalNary);TC.filter.LogicalNary.prototype.write=function(){return"<{prefix}:{tag}>{inner}</{prefix}:{tag}>".format({prefix:"ogc",tag:this.getTagName(),inner:this.writeInnerArrayCondition_(this.conditions)})};TC.filter.Not=function(e){TC.filter.Filter.call(this,"Not");this.condition=e};TC.inherit(TC.filter.Not,TC.filter.Filter);TC.filter.Bbox=function(e,t,r){TC.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=r};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Comparison=function(e,t){TC.filter.Filter.call(this,e);this.propertyName=t};TC.inherit(TC.filter.Comparison,TC.filter.Filter);TC.filter.Comparison.prototype.write=function(){var e="";this.lowerBoundary&&this.upperBoundary&&(e="<ogc:LowerBoundary><ogc:Literal>{LowerBoundary}</ogc:Literal></ogc:LowerBoundary><ogc:UpperBoundary><ogc:Literal>{UpperBoundary}</ogc:Literal></ogc:UpperBoundary>".format({LowerBoundary:this.lowerBoundary,UpperBoundary:this.upperBoundary}));this.pattern&&(e="<ogc:Literal>{Pattern}</ogc:Literal>".format({Pattern:this.pattern}));this.params&&(e=$.isArray(this.params)?this.params.reduce(function(e,t,r){var n=function(e){return"<ogc:Literal>{value}</ogc:Literal>".format({value:e})};return(r>0?e:n(e))+n(t)}):"<ogc:Literal>{value}</ogc:Literal>".format({value:this.params}));return"<{prefix}:{tag}{matchCase}{escape}{singleChar}{wildCard}><{prefix}:PropertyName>{name}</{prefix}:PropertyName>{values}</{prefix}:{tag}>".format({prefix:"ogc",tag:this.getTagName(),matchCase:"undefined"!=typeof this.matchCase?' matchCase="'+this.matchCase+'"':"",escape:"undefined"!=typeof this.escapeChar?' escape="'+this.escapeChar+'"':"",singleChar:"undefined"!=typeof this.singleChar?' singleChar="'+this.singleChar+'"':"",wildCard:"undefined"!=typeof this.wildCard?' wildCard="'+this.wildCard+'"':"",name:this.propertyName,values:e})};TC.filter.ComparisonBinary=function(e,t,r,n){TC.filter.Comparison.call(this,e,t);this.expression=r;this.matchCase=n};TC.inherit(TC.filter.ComparisonBinary,TC.filter.Comparison);TC.filter.ComparisonBinary.prototype.write=function(){return"<{prefix}:{tag}{matchCase}><{prefix}:PropertyName>{name}</{prefix}:PropertyName><{prefix}:Literal>{value}</{prefix}:Literal></{prefix}:{tag}>".format({prefix:"ogc",tag:this.getTagName(),matchCase:"undefined"!=typeof this.matchCase?' matchCase="'+this.matchCase+'"':"",name:this.propertyName,value:this.expression})};TC.filter.EqualTo=function(e,t,r){TC.filter.ComparisonBinary.call(this,"PropertyIsEqualTo",e,t,r)};TC.inherit(TC.filter.EqualTo,TC.filter.ComparisonBinary);TC.filter.GreaterThan=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThan",e,t)};TC.inherit(TC.filter.GreaterThan,TC.filter.ComparisonBinary);TC.filter.GreaterThanOrEqualTo=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsGreaterThanOrEqualTo",e,t)};TC.inherit(TC.filter.GreaterThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.LessThan=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThan",e,t)};TC.inherit(TC.filter.LessThan,TC.filter.ComparisonBinary);TC.filter.LessThanOrEqualTo=function(e,t){TC.filter.ComparisonBinary.call(this,"PropertyIsLessThanOrEqualTo",e,t)};TC.inherit(TC.filter.LessThanOrEqualTo,TC.filter.ComparisonBinary);TC.filter.NotEqualTo=function(e,t,r){TC.filter.ComparisonBinary.call(this,"PropertyIsNotEqualTo",e,t,r)};TC.inherit(TC.filter.NotEqualTo,TC.filter.ComparisonBinary);TC.filter.IsLike=function(e,t,r,n,i,a){TC.filter.Comparison.call(this,"PropertyIsLike",e);this.pattern=t;this.wildCard=void 0!==r?r:"*";this.singleChar=void 0!==n?n:".";this.escapeChar=void 0!==i?i:"!";this.matchCase=a};TC.inherit(TC.filter.IsLike,TC.filter.Comparison);TC.filter.IsNull=function(e){TC.filter.Comparison.call(this,"PropertyIsNull",e)};TC.inherit(TC.filter.IsNull,TC.filter.Comparison);TC.filter.IsBetween=function(e,t,r){TC.filter.Comparison.call(this,"PropertyIsBetween",e);this.lowerBoundary=t;this.upperBoundary=r};TC.inherit(TC.filter.IsBetween,TC.filter.Comparison);TC.filter.Function=function(e,t){TC.filter.Comparison.call(this,"Function",e);this.params=t};TC.inherit(TC.filter.Function,TC.filter.Comparison);TC.filter.Spatial=function(e,t,r,n){TC.filter.Filter.call(this,e);this.geometryName=t||"the_geom";this.geometry=r;this.srsName=n};TC.inherit(TC.filter.Spatial,TC.filter.Filter);TC.filter.Spatial.prototype.write=function(){return"<{prefix}:{tag}><{prefix}:PropertyName>{name}</{prefix}:PropertyName>{geometry}</{prefix}:{tag}>".format({prefix:"ogc",tag:this.getTagName(),name:this.geometryName,srsName:"undefined"!=typeof this.srsName?' srsName="'+this.srsName+'"':"",geometry:this.geometry.wrap.toGML()})};TC.filter.Bbox=function(e,t,r){TC.filter.Filter.call(this,"BBOX");this.geometryName=e;this.extent=t;this.srsName=r};TC.inherit(TC.filter.Bbox,TC.filter.Filter);TC.filter.Bbox.prototype.write=function(){var e="<gml:Envelope{srsName}><gml:lowerCorner>{lowerCorner}</gml:lowerCorner><gml:upperCorner>{upperCorner}</gml:upperCorner></gml:Envelope>".format({srsName:"undefined"!=typeof this.srsName?' srsName="'+this.srsName+'"':"",lowerCorner:this.extent[0]+" "+this.extent[1],upperCorner:this.extent[2]+" "+this.extent[3]});return"<{prefix}:{tag}><{prefix}:PropertyName>{name}</{prefix}:PropertyName>{BBOX}</{prefix}:{tag}>".format({prefix:"ogc",tag:this.getTagName(),name:this.geometryName,BBOX:e})};TC.filter.Intersects=function(e,t,r){TC.filter.Spatial.call(this,"Intersects",e,t,r)};TC.inherit(TC.filter.Intersects,TC.filter.Spatial);TC.filter.Within=function(e,t,r){TC.filter.Spatial.call(this,"Within",e,t,r)};TC.inherit(TC.filter.Within,TC.filter.Spatial);TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.MapContents=function(){var e=this;TC.Control.apply(e,arguments);e.layerTrees={}};TC.inherit(TC.control.MapContents,TC.Control);!function(){var e=TC.control.MapContents.prototype;e.CLASS="tc-ctl-mc";var t={layer:"tcLayer",img:"tcImg"};e.render=function(e){var t=this;t.map&&t.renderData(t.map.getLayerTree(),e)};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.render(function(){for(var r=0,n=e.layers.length;n>r;r++)t.updateLayerTree(e.layers[r]);e.on(TC.Consts.event.ZOOM,function(){t.updateScale()}).on(TC.Consts.event.UPDATEPARAMS,function(e){var r=e.layer.names,n=function i(e){var t=!1;if(e)if($.inArray(e.name,r)>=0)t=!0;else for(var n=0;n<e.children.length;n++)if(i(e.children[n])){t=!0;break}return t};n(t.layerTrees[e.layer.id])||0===r.length?t.update():t.updateLayerTree(e.layer)}).on(TC.Consts.event.LAYERVISIBILITY,function(e){t.updateLayerVisibility(e.layer)}).on(TC.Consts.event.LAYERADD,function(e){t.updateLayerTree(e.layer)}).on(TC.Consts.event.VECTORUPDATE+" "+TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATURESADD,function(e){t._updateLayerTreeTimeout&&clearTimeout(t._updateLayerTreeTimeout);t._updateLayerTreeTimeout=setTimeout(function(){if(t.map.workLayers.indexOf(e.layer)>-1){t.updateLayerTree(e.layer);delete t._updateLayerTreeTimeout}},100)}).on(TC.Consts.event.LAYERREMOVE,function(e){t.removeLayer(e.layer)}).on(TC.Consts.event.LAYERORDER,function(e){t.updateLayerOrder(e.layer,e.oldIndex,e.newIndex)})})};e.updateScale=function(){};e.updateLayerVisibility=function(e){};e.updateLayerTree=function(e){this.layerTrees[e.id]=e.getTree()};e.updateLayerOrder=function(e,r,n){var i=this;if(r>=0&&r!==n)for(var a,s,o=i.getLayerUIElements(),l=i.map.workLayers.length-1;l>=0;l--){var c=i.map.workLayers[l];s=a;o.each(function(e,r){var n=$(r);if(n.data(t.layer)===c){a=n;return!1}});if(c===e){s?s.after(a):o.parent().prepend(a);break}}};e.removeLayer=function(e){this.update()};e.getLayerUIElements=function(){var e=this;return e._$div.find("ul").first().children()};var r=function(e){return/[&?]REQUEST=getLegendGraphic/i.test(e)},n=function(e,t,r){var n="error.tc";TC.Cfg.proxy&&e.off(n).on(n,function(){e.attr("src",TC.proxify(t))});var i=/^(https?:)?\/\//i;if(TC.Util.isSecureURL(document.location.href)&&!TC.Util.isSecureURL(t)){var a="";a=1==r?t.replace(i,"https://"):TC.isUsingServiceWorker()?TC.proxify(t):t;e.attr("src",a)}else e.attr("src",i.test(t)?t.substr(t.indexOf("//")):t)};e.styleLegendImage=function(e,i){if(!e.attr("src")){var a=e.data(t.img);if(i&&i.options.method&&"POST"===i.options.method)i.getLegendGraphicImage().done(function(t){n(e,t)}).fail(function(e){TC.error(e)});else{if(r(a)){var s=e.parent(),o=s.css("color"),l=o.indexOf("("),c=o.indexOf(")");if(l>=0&&c>l){color=o.substr(0,c).substr(l+1).split(",");o="0x";for(var u=0;3>u;u++){var p=parseInt(color[u]).toString(16);o+=1===p.length?"0"+p:p}}else o.replace("#","0x");a+="&LEGEND_OPTIONS=fontName:"+s.css("font-family")+";fontSize:"+parseInt(s.css("font-size"))+";fontColor:"+o+";fontAntiAliasing:true";i.params&&i.params.sld_body&&(a=TC.Util.addURLParameters(a,{sld_body:i.params.sld_body}));e.data(t.img,a)}n(e,a,i.usesSSL)}}}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.TOC=function(){var e=this;TC.control.MapContents.apply(e,arguments)};TC.inherit(TC.control.TOC,TC.control.MapContents);!function(){var e=TC.control.TOC.prototype;e.CLASS="tc-ctl-toc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/TOC.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/TOCBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/TOCNode.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"worklayers"}).w('</h2><div class="tc-ctl-toc-tree"><form><div class="tc-ctl-toc-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><ul class="tc-ctl-toc-branch tc-ctl-toc-wl">').s(t.get(["workLayers"],!1),t,{block:r},{}).w("</ul></form></div>")}function r(e,t){return e.p("tc-ctl-toc-wlbranch",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":r,block:n},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><input type="checkbox" class="tc-ctl-toc-branch-cb" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:a},{}).w("</ul></li>")}function r(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}function n(e,t){return e.w('class="tc-ctl-toc-node"')}function i(e,t){return e.w(" checked")}function a(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-branch",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":r,block:n},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><input type="checkbox" name="toc" value="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["isVisible"],!1),t,{block:i},{}).w(" /><span>").f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-toc-branch">').s(t.get(["children"],!1),t,{block:a},{}).w("</ul></li>")}function r(e,t){return e.w('class="tc-ctl-toc-node tc-ctl-toc-leaf"')}function n(e,t){return e.w('class="tc-ctl-toc-node"')}function i(e,t){return e.w(" checked")}function a(e,t){return e.p("tc-ctl-toc-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-node",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;return t}}var t={layer:"tcLayer",layerUid:"tcLayerUid"},r="click.tc";e.register=function(e){var t=this;TC.control.MapContents.prototype.register.call(t,e);t._addBrowserEventHandlers();e.on(TC.Consts.event.EXTERNALSERVICEADDED,function(r){if(r&&r.layer){r.layer.map=e;e.addLayer(r.layer);t.updateLayerTree(r.layer)}})};e._addBrowserEventHandlers=function(){var e=this;e._$div.on(r,"input[type=checkbox]",function(r){var n=$(r.target),i=n.closest("ul."+e.CLASS+"-wl").children("li").has(n).data(t.layer),a=n.parents("li").first().data(t.layerUid),s=n.prop("checked");i.setNodeVisibility(a,s);r.stopPropagation()}).on(TC.Consts.event.MOUSEUP,"li",function(t){var r=$(t.target);if(!r.hasClass(e.CLASS+"-leaf")){r.toggleClass(TC.Consts.classes.COLLAPSED);r.find("ul").first().toggleClass(TC.Consts.classes.COLLAPSED);t.stopPropagation()}})};e.update=function(){var e=this,r=function(e){return e.children("input[type=checkbox]")},n=e._$div.find("ul."+e.CLASS+"-wl").first();n.children("li").each(function(e,n){var i=$(n),a=i.data(t.layer);if(a){var s=a.getVisibility();r(i).prop("checked",s);a.tree=null;i.find("li").each(function(e,n){var i=$(n),s=r(i),o=i.data(t.layerUid);switch(a.getNodeVisibility(o)){case TC.Consts.visibility.VISIBLE:s.prop("checked",!0);s.prop("indeterminate",!1);break;case TC.Consts.visibility.NOT_VISIBLE_AT_RESOLUTION:s.prop("checked",!0);s.prop("indeterminate",!1);break;case TC.Consts.visibility.HAS_VISIBLE:s.prop("checked",!1);s.prop("indeterminate",!0);break;default:s.prop("checked",!1);s.prop("indeterminate",!1)}})}});e.updateScale()};e.updateScale=function(){var e=this;e._$div.find("ul."+e.CLASS+"-wl").children("li").each(function(r,n){var i=$(n),a=i.data(t.layer);i.find("li").each(function(r,n){var i=$(n);i.toggleClass(e.CLASS+"-node-notvisible",!a.isVisibleByScale(i.data(t.layerUid)))})})};e.updateLayerTree=function(e){var r=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(r,e);r._$div.find("."+r.CLASS+"-empty").addClass(TC.Consts.classes.HIDDEN);var n=r.CLASS+"-branch";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(n,r.layerTrees[e.id],function(n,i){var a=$(i);Modernizr.canvas||a.find("li:last-child").addClass(TC.Consts.classes.LASTCHILD);var s=a.data(t.layerUid),o=r._$div.find("."+r.CLASS+"-wl"),l=o.find('li[data-tc-layer-uid="'+s+'"]');if(1===l.length){l.html(a.html());l.data(t.layer)||l.data(t.layer,e)}else{a.data(t.layer,e);o.prepend(a)}n&&TC.error(n)});var i="ul."+r.CLASS+"-wl",a="ul."+r.CLASS+"-branch",s="li."+r.CLASS+"-node",o="li."+r.CLASS+"-leaf";r._$div.find(i+" "+a+" "+a+","+i+" "+a+" "+s).not(o).addClass(TC.Consts.classes.COLLAPSED);r.update()})}};e.removeLayer=function(e){if(!e.isBase){var r=this,n=function(){return r._$div.find("."+r.CLASS+"-wl").children("li")},i=n();i.each(function(r,a){var s=$(a);if(s.data(t.layer)===e){s.remove();i=n();return!1}});0===i.length&&r._$div.find("."+r.CLASS+"-empty").removeClass(TC.Consts.classes.HIDDEN)}};e.updateLayerVisibility=function(e){var r=this;r._$div.find("."+r.CLASS+"-wl").children("li").each(function(n,i){var a=$(i);if(a.data(t.layer)===e){var s=!e.getVisibility(),o=a.find("input[type=checkbox]"),l=o.filter("."+r.CLASS+"-branch-cb");l.prop("checked",!s);o.not(l).prop("disabled",s);return!1}})};e.updateLayerOrder=function(e,t,r){};e.render=function(e){var t=this;TC.Control.prototype.render.call(t,function(){var r=t.options.controls||[];if(r.length>0){var n=r[0],i=$("<div/>");t._$div.append(i);t.map.addControl(n.name,$.extend({div:i},n.options))}$.isFunction(e)&&e()})}}();TC.control=TC.control||{};TC.control.TOC||TC.syncLoadJS(TC.apiLocation+"TC/control/TOC");TC.control.ListTOC=function(){var e=this;TC.control.TOC.apply(e,arguments);e.layers=[]};TC.inherit(TC.control.ListTOC,TC.control.TOC);!function(){var e=TC.control.ListTOC.prototype;e.CLASS="tc-ctl-ltoc";e.CLICKEVENT="click.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGEND=TC.Consts.classes.DRAGEND||"tc-dragend";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/ListTOC.html";e.template[e.CLASS+"-elm"]=TC.apiLocation+"TC/templates/ListTOCElement.html";e.template[e.CLASS+"-type-sgl"]=TC.apiLocation+"TC/templates/ListTOCTooltipSingle.html";e.template[e.CLASS+"-type-grp"]=TC.apiLocation+"TC/templates/ListTOCTooltipGroup.html";e.template[e.CLASS+"-type-grp-node"]=TC.apiLocation+"TC/templates/ListTOCTooltipGroupNode.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"loadedLayers"}).w('<span class="tc-ctl-ltoc-n"></span><button class="tc-ctl-ltoc-del-all tc-hidden" title="').h("i18n",t,{},{$key:"removeAllLayersFromMap"}).w('"></button></h2><div class="tc-ctl-ltoc-empty">').h("i18n",t,{},{$key:"noData"}).w('</div><div class="tc-ctl-ltoc-content"><form><ul>').s(t.get(["workLayers"],!1),t,{block:r},{}).w("</ul></form></div>")}function r(e,t){return e.p("tc-ctl-ltoc-elm",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;return t};e.template[e.CLASS+"-elm"]=function(){function t(e,t){return e.w('<li class="tc-ctl-ltoc-elm" tabindex="-1"><div class="tc-ctl-ltoc-lyr">').x(t.get(["path"],!1),t,{block:r},{}).w('</div><div class="tc-ctl-ltoc-type"></div><div class="tc-ctl-ltoc-path" title="').s(t.get(["path"],!1),t,{"else":n,block:i},{}).w('">').s(t.get(["path"],!1),t,{"else":s,block:o},{}).w('</div><div><div class="tc-ctl-ltoc-btn-info" title="').h("i18n",t,{},{$key:"infoFromThisLayer"}).w('"></div><input type="range" value="').f(t.get(["opacity"],!1),t,"h").w('" title="').h("i18n",t,{},{$key:"transparencyOfThisLayer"}).w('" /><input type="checkbox" ').nx(t.get(["hide"],!1),t,{block:c},{}).w(' title="').h("i18n",t,{},{$key:"visibilityOfThisLayer"}).w('" /></div><div class="tc-ctl-ltoc-info tc-hidden">').x(t.get(["abstract"],!1),t,{block:u},{}).x(t.get(["legend"],!1),t,{block:p},{}).x(t.get(["metadata"],!1),t,{block:d},{}).w('</div><div class="tc-ctl-ltoc-dd ').x(t.get(["hide"],!1),t,{block:m},{}).w('" title="').h("i18n",t,{},{$key:"dragToReorder"}).w('"></div><div class="tc-ctl-ltoc-del ').nx(t.get(["hide"],!1),t,{block:y},{}).w('" title="').h("i18n",t,{},{$key:"removeLayerFromMap"}).w('"></div></li>')}function r(e,t){return e.f(t.get(["title"],!1),t,"h")}function n(e,t){return e.f(t.get(["title"],!1),t,"h")}function i(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:a},{})}function a(e,t){return e.w(" &bull; ")}function s(e,t){return e.f(t.get(["title"],!1),t,"h")}function o(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:l},{})}function l(e,t){return e.w(" &bull; ")}function c(e,t){return e.w('checked="checked"')}function u(e,t){return e.w('<div class="tc-ctl-ltoc-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div>").f(t.get(["abstract"],!1),t,"h").w("</div></div>")}function p(e,t){return e.w('<div class="tc-ctl-ltoc-legend" data-tc-layer-name="').f(t.get(["layerNames"],!1),t,"h").w('"><h4>').h("i18n",t,{},{$key:"content"}).w("</h4>").s(t.get(["legend"],!1),t,{block:h},{}).w(" </div>")}function h(e,t){return e.w("<div><p>").f(t.get(["title"],!1),t,"h").w('</p><img data-tc-img="').f(t.get(["src"],!1),t,"h").w('" /></div>')}function d(e,t){return e.w('<div class="tc-ctl-ltoc-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:f},{}).w("</ul></div>")}function f(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h",["s"]).w('" type="').f(t.get(["format"],!1),t,"h").w('" title="').f(t.get(["formatDescription"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h").w("</a></li>")}function m(e,t){return e.w("tc-hidden")}function y(e,t){return e.w("tc-hidden")}dust.register(e.CLASS+"-elm",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;p.__dustBody=!0;h.__dustBody=!0;d.__dustBody=!0;f.__dustBody=!0;m.__dustBody=!0;y.__dustBody=!0;return t};e.template[e.CLASS+"-type-sgl"]=function(){function t(e,t){return e.h("i18n",t,{},{$key:"singleLayer"})}dust.register(e.CLASS+"-type-sgl",t);t.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp"]=function(){function t(e,t){return e.w("<div>").h("i18n",t,{},{$key:"groupLayerThatContains"}).w(":</div><ul>").s(t.get(["Layer"],!1),t,{block:r},{}).w("</ul>")}function r(e,t){return e.p("tc-ctl-ltoc-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-type-grp",t);t.__dustBody=!0;r.__dustBody=!0;return t};e.template[e.CLASS+"-type-grp-node"]=function(){function t(e,t){return e.w('<li class="tc-ctl-ltoc-tip-grp-elm"><span>').f(t.get(["Title"],!1),t,"h").w("</span><ul>").s(t.get(["Layer"],!1),t,{block:r},{}).w("</ul></li>")}function r(e,t){return e.p("tc-ctl-ltoc-type-grp-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-type-grp-node",t);t.__dustBody=!0;r.__dustBody=!0;return t}}var t={layer:"tcLayer"},r=function(e,r){var n;e._$div.find("li."+e.CLASS+"-elm").each(function(e,i){var a=$(i);if(a.data(t.layer)===r){n=a;return!1}});return n},n=function(e){return $.grep(e.map.workLayers,function(e){return!e.stealth}).length};e.register=function(e){var t=this;TC.control.TOC.prototype.register.call(t,e);e.off(TC.Consts.event.EXTERNALSERVICEADDED);e.on(TC.Consts.event.LAYEROPACITY,function(e){var n=r(t,e.layer);n&&n.find("input[type=range]").val(Math.round(100*e.opacity))}).on(TC.Consts.event.FEATURESIMPORT,function(r){var n=r.fileName;if(r.features&&r.features.length>0){var i="."+TC.Consts.format.GPX.toLowerCase();if(r.fileName.toLowerCase().indexOf(i)===r.fileName.length-i.length)return;e.one(TC.Consts.event.LAYERADD,function(e){if(e&&e.layer&&e.layer.title==n){if(t.map&&t.map.layout&&t.map.layout.accordion&&t._$div.hasClass(TC.Consts.classes.COLLAPSED))for(var r=0;r<t.map.controls.length;r++)t.map.controls[r]!==t&&t.map.controls[r]._$div.addClass(TC.Consts.classes.COLLAPSED);t.map.$events.trigger($.Event(TC.Consts.event.TOOLSOPEN),{});t._$div.removeClass(TC.Consts.classes.COLLAPSED)}})}})};e._addBrowserEventHandlers=function(){var e=this;e._$div.on(e.CLICKEVENT,"input[type=checkbox]",function(r){var n=$(r.target),i=n.parents("li."+e.CLASS+"-elm").first(),a=i.data(t.layer),s=n.prop("checked");a.setVisibility(s);r.stopPropagation()}).on("change input","input[type=range]",function(e){var r=$(e.target),n=r.parents("li").first().data(t.layer);n.setOpacity(r.val()/100)}).on(e.CLICKEVENT,"."+e.CLASS+"-del",function(r){var n=$(r.target).parents("li").first(),i=n.data(t.layer);e.map.removeLayer(i)}).on(e.CLICKEVENT,"."+e.CLASS+"-del-all",function(r){TC.confirm(e.getLocaleString("layersRemove.confirm"),function(){var r=e._$div.find("li."+e.CLASS+"-elm"),n=new Array(r.length);r.each(function(e,r){n[e]=$(r).data(t.layer)});for(var i=0,a=n.length;a>i;i++)e.map.removeLayer(n[i])})}).on(e.CLICKEVENT,"."+e.CLASS+"-btn-info",function(r){var n=$(r.target),i=n.parents("li").first(),a=i.find("."+e.CLASS+"-info");a.find("."+e.CLASS+"-legend img").each(function(r,n){var a=i.data(t.layer);e.styleLegendImage($(n),a)});a.toggleClass(TC.Consts.classes.HIDDEN);i.find('input[type="checkbox"]').is(":checked")&&i.find("."+e.CLASS+"-dd").toggleClass(TC.Consts.classes.HIDDEN,!a.hasClass(TC.Consts.classes.HIDDEN));n.toggleClass(TC.Consts.classes.CHECKED)})};e.updateLayerVisibility=function(e){var t=this,n=r(t,e);if(n){var i=e.getVisibility();n.find("."+t.CLASS+"-del").toggleClass(TC.Consts.classes.HIDDEN,i);n.find("."+t.CLASS+"-info").hasClass(TC.Consts.classes.HIDDEN)&&n.find("."+t.CLASS+"-dd").toggleClass(TC.Consts.classes.HIDDEN,!i)}};e.updateLayerTree=function(e){var r=this,i=function(e,n,i){if(e!==n){for(var a=e.data(t.layer),s=n.data(t.layer),o=-1,l=0;l<r.map.layers.length;l++)if(s===r.map.layers[l]){o=l;break}o>=1&&o<r.map.layers.length&&r.map.insertLayer(a,o,i)}},a=function(e){var t=$.Deferred();e&&e.options.method&&"POST"===e.options.method?e.getLegendGraphicImage().done(function(e){t.resolve(e)}).fail(function(e){TC.error(e)}):t.resolve();return t.promise()};if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(r,e);for(var s=!1,o=0,l=r.layers.length;l>o;o++)if(e===r.layers[o]){s=!0;break}if(!s){var c=r.CLASS+"-elm";r.layers.push(e);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){TC.loadJS(!$.fn.drag,[TC.apiLocation+"lib/jQuery/jquery.event.drag.js"],function(){var n=e.title?e.title:e.capabilities.Service.Title,s={title:e.options.hideTitle?"":n,hide:e.renderOptions&&e.renderOptions.hide?!0:!1,opacity:e.renderOptions&&e.renderOptions.opacity?100*e.renderOptions.opacity:100},o=e.isRaster();if(o){s.layerNames=e.layerNames;var l=e.getPath();l.shift();s.path=l;var u=e.names[0],p=e.wrap.getInfo(u);s.legend=p.legend;s["abstract"]=p["abstract"];var h,d=p.hasOwnProperty("abstract")||p.hasOwnProperty("legend")||p.hasOwnProperty("metadata");if(e.tree&&e.tree.children&&e.tree.children.length&&e.tree.children[0].children&&e.tree.children[0].children.length)h=null;else{h=p.metadata;if(h)for(var f=0,m=h.length;m>f;f++){var y=h[f];y.formatDescription=r.getLocaleString(TC.Util.getSimpleMimeType(y.format))||r.getLocaleString("viewMetadata")}}s.metadata=h}a(e).done(function(n){n&&(legend.src=n);dust.render(c,s,function(n,a){var s,l=$(a),c=!1;if(o){c=e.names.length>1;if(!c)for(var p=e.wrap.getAllLayerNodes(),h=0;h<p.length;h++){var f=p[h];if(e.wrap.getName(f)===u){s=f;e.wrap.getLayerNodes(f).length>0&&(c=!0);break}}}var m=l.find("."+r.CLASS+"-type"),y=c?r.CLASS+"-type-grp":r.CLASS+"-type-sgl";m.addClass(y);d||l.find("."+r.CLASS+"-btn-info").addClass(TC.Consts.classes.HIDDEN);if(s){e.wrap.normalizeLayerNode(s);dust.render(y,s,function(e,t){var n;m.on("mouseover",function(e){var i=m.offset(),a=$(r.map.div).offset();n=$("<div>").addClass(r.CLASS+"-tip").html(t).css({top:i.top-a.top+"px",right:$(r.map.div).width()-(i.left-a.left)+"px"}).appendTo(r.map.div)}).on("mouseout",function(e){n.remove()})})}var g=r._$div.find("ul").first();l.data(t.layer,e);l.drag("start",function(e,t){var r=$(this),n=g.children("li");n.not(r).addClass(TC.Consts.classes.DRAGEND);n.index(r);r.css("zIndex",100).addClass(TC.Consts.classes.DRAG);var i=n.last(),a=r.position();t.limit={top:n.first().position().top-a.top,bottom:i.height()+i.position().top-a.top-r.height()-1};t.dropTargetIndex=-1}).drag("end",function(e,t){var r=$(this);r.removeClass(TC.Consts.classes.DRAG).addClass(TC.Consts.classes.DRAGEND);var n,a,s=function(e){return parseInt(e.substr(e.lastIndexOf(",")+1))},o=s(r.css("transform")),l=this.getBoundingClientRect().top-o;if(t.dropTargetIndex>=0){n=g.children("li").get(t.dropTargetIndex);a=$(n);var c=s(a.css("transform")),u=n.getBoundingClientRect().top-c}r.css("transform",a?"translateY("+(u-l)+"px)":"");var p="transitionend.tc";r.on(p,function h(e){if("transform"===e.originalEvent.propertyName){r.off(p,h).removeClass(TC.Consts.classes.DRAGEND).css("zIndex","");a&&i(r,a,function(){g.children("li").css("transform","").removeClass(TC.Consts.classes.DRAGEND)})}})}).drag(function(e,t){var r,n=$(this),i=Math.min(Math.max(t.limit.top,Math.round(t.deltaY)),t.limit.bottom),a=this.getBoundingClientRect(),s=a.height-1,o=(a.top+a.bottom)/2,l=[],c=g.children("li");c.each(function(e,n){var i=n.getBoundingClientRect();l[e]={elm:n,top:i.top,bottom:i.bottom};n===t.drag&&(r=e)});for(var u,p=-1,h=0,d=l.length;d>h;h++){var f=l[h];if(r>h){if(o<f.bottom)if(o>f.top&&t.deltaY>t.prevDeltaY)u="";else{u="translateY("+s+"px)";0>p&&(p=h)}else u="";$(f.elm).css("transform",u)}else if(h>r){if(o>f.top)if(o<f.bottom&&t.deltaY<t.prevDeltaY)u="";else{u="translateY(-"+s+"px)";p=h}else u="";$(f.elm).css("transform",u)}}t.dropTargetIndex=p;n.css("transform","translateY("+i+"px)");t.prevDeltaY=t.deltaY},{handle:"."+r.CLASS+"-dd"}).on("keydown",function(e){var t=this,r=function(){t.focus()},n=$(this);switch(!0){case/Up$/.test(e.key):var a=n.prev();a.length&&i(n,a,r);break;case/Down$/.test(e.key):var s=n.next();s.length&&i(n,s,r)}});g.prepend(l);r.updateScale()})})})});var u=n(r);$("."+r.CLASS+"-n").text(u).toggleClass(TC.Consts.classes.VISIBLE,u>0);r._$div.find("."+r.CLASS+"-empty").toggleClass(TC.Consts.classes.HIDDEN,u>0);r._$div.find("."+r.CLASS+"-del-all").toggleClass(TC.Consts.classes.HIDDEN,!1)}}};e.updateScale=function(){var e=this;e._$div.find("ul").find("li."+e.CLASS+"-elm").each(function(r,n){var i=$(n),a=i.data(t.layer);if(a.names){for(var s=!1,o=0;o<a.names.length;o++)if(a.isVisibleByScale(a.names[o])){s=!0;break}i.toggleClass(e.CLASS+"-elm-notvisible",!s)}})};e.updateLayerOrder=function(e,t,r){TC.control.MapContents.prototype.updateLayerOrder.call(this,e,t,r)};e.removeLayer=function(e){var r=this,i=r.layers.indexOf(e);i>=0&&r.layers.splice(i,1);var a=r._$div.find("ul").first();a.find("li."+r.CLASS+"-elm").each(function(r,n){var i=$(n);if(i.data(t.layer)===e){i.remove();return!1}});var s=n(r);r._$div.find("."+r.CLASS+"-del-all").toggleClass(TC.Consts.classes.HIDDEN,0===s);r._$div.find("."+r.CLASS+"-empty").toggleClass(TC.Consts.classes.HIDDEN,s>0);$("."+r.CLASS+"-n").text(s).toggleClass(TC.Consts.classes.VISIBLE,s>0)};e.getLayerUIElements=function(){var e=this;return e._$div.find("ul").first().children("li."+e.CLASS+"-elm")}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Click=function(){var e=this;TC.Control.apply(e,arguments);e.callback=e.options&&e.options.callback||function(e,t){console.log("[Click]["+e[0]+", "+e[1]+"]["+t[0]+", "+t[1]+"]")};e.wrap=new TC.wrap.control.Click(e)};TC.inherit(TC.control.Click,TC.Control);!function(){var e=TC.control.Click.prototype;e.CLASS="tc-ctl-click";e.register=function(e){var t=this;t.wrap.register(e);TC.Control.prototype.register.call(t,e)};e.activate=function(){var e=this;TC.Control.prototype.activate.call(e);e.wrap.activate()};e.deactivate=function(){var e=this;e.wrap.deactivate();TC.Control.prototype.deactivate.call(e)}}();TC.control=TC.control||{};TC.control.Click||TC.syncLoadJS(TC.apiLocation+"TC/control/Click");TC.Consts.event.POPUPHIDE=TC.Consts.event.POPUPHIDE||"popuphide.tc";TC.Consts.event.RESULTSPANELCLOSE=TC.Consts.event.RESULTSPANELCLOSE||"resultspanelclose.tc";TC.control.FeatureInfoCommons=function(){var e=this;TC.control.Click.apply(e,arguments);e.resultsLayer=null;e.filterLayer=null;e._layersDeferred=$.Deferred();e.filterFeature=null;e.info=null;e.popup=null;e.resultsPanel=null;e.lastFeatureCount=null;e._$dialogDiv=$(TC.Util.getDiv(e.options.dialogDiv));e.options.dialogDiv||e._$dialogDiv.appendTo("body")};TC.control.FeatureInfoCommons.displayMode={POPUP:"popup",RESULTS_PANEL:"resultsPanel"};!function(){var e="ul.tc-ctl-finfo-features li",t=function(e){
e.getDisplayTarget().find("ul."+e.CLASS+"-services li").removeClass(TC.Consts.classes.CHECKED).removeClass(TC.Consts.classes.DISABLED).removeClass(TC.Consts.classes.FROMLEFT).removeClass(TC.Consts.classes.FROMRIGHT)},r=function(r,n){if(!r._zooming){var i,a,s,o;if(this instanceof TC.Feature){i=this;r.getDisplayTarget().find(e).each(function(e,t){var n=$(t),l=n.parents("li").first(),c=l.parents("li").first(),u=r.getFeature(r.info,c.index(),l.index(),n.index());if(u===i){a=n;s=l;o=c}})}else a=$(this);s=s||a.parents("li").first();o=o||s.parents("li").first();t(r);a.addClass(TC.Consts.classes.CHECKED);s.addClass(TC.Consts.classes.CHECKED);o.addClass(TC.Consts.classes.CHECKED);if(n>0){a.addClass(TC.Consts.classes.FROMLEFT);s.addClass(TC.Consts.classes.FROMLEFT);o.addClass(TC.Consts.classes.FROMLEFT)}else if(0>n){a.addClass(TC.Consts.classes.FROMRIGHT);s.addClass(TC.Consts.classes.FROMRIGHT);o.addClass(TC.Consts.classes.FROMRIGHT)}i=i||r.getFeature(r.info,o.index(),s.index(),a.index());var l=r.resultsLayer.features.slice(),c=l.filter(function(e){return i&&i.id===e.id});if(c.length>0)return;for(var u=0;u<l.length;u++){var p=l[u];p!==r.filterFeature&&r.resultsLayer.removeFeature(p)}i&&i.geometry?r.resultsLayer.addFeature(i):a.addClass(TC.Consts.classes.DISABLED)}},n=function(e,t){var r=e.getDisplayTarget().find("ul."+e.CLASS+"-features > li"),n=r.length,i=r.filter("."+TC.Consts.classes.CHECKED),a=r.index(i.get(0));return r.get((a+t+n)%n)};TC.inherit(TC.control.FeatureInfoCommons,TC.control.Click);var i=TC.control.FeatureInfoCommons.prototype;i.CLASS="tc-ctl-finfo";i.template={};if(TC.isDebug){i.template[i.CLASS]=TC.apiLocation+"TC/templates/FeatureInfo.html";i.template[i.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureInfoDialog.html";i.template[i.CLASS+"-del-btn"]=TC.apiLocation+"TC/templates/FeatureInfoDeleteButton.html"}else{i.template[i.CLASS]=function(){function e(e,n){return e.w('<ul class="tc-ctl-finfo-services">').s(n.get(["services"],!1),n,{"else":t,block:r},{}).w("</ul>").x(n.get(["featureCount"],!1),n,{block:O},{})}function t(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}function r(e,t){return e.w("<li><h3>").x(t.getPath(!1,["mapLayer","title"]),t,{"else":n,block:a},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{"else":s,block:E},{}).w("</div></li>")}function n(e,t){return e.f(t.getPath(!1,["mapLayer","id"]),t,"h")}function a(e,t){return e.f(t.getPath(!1,["mapLayer","title"]),t,"h")}function s(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{"else":o,block:l},{}).w("</ul>")}function o(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}function l(e,t){return e.w("<li><h4>").s(t.get(["path"],!1),t,{block:c},{}).w(' <span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w('</span> </h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{"else":p,block:h},{}).w("</ul></div></li>")}function c(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:u},{})}function u(e,t){return e.w(" &bull; ")}function p(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}function h(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{"else":d,block:C},{}).w("</li>")}function d(e,t){return e.x(t.get(["error"],!1),t,{"else":f,block:v},{})}function f(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:m},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:y},{}).w("</tbody></table>").x(t.get(["geometry"],!1),t,{block:g},{})}function m(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToCenter"}).w('"')}function y(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}function g(e,t){return e.w('<div class="tc-ctl-finfo-tools"><button class="tc-ctl-finfo-tools-btn" title="').h("i18n",t,{},{$key:"tools"}).w('">').h("i18n",t,{},{$key:"tools"}).w("</button></div>")}function v(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}function C(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{"else":T,block:L},{key:t.get(["rawFormat"],!1),value:"text/html"})}function T(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}function L(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:w},{})}function w(e,t){return e.h("ne",t,{"else":b,block:S},{key:t.get(["expandUrl"],!1),value:""})}function b(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" />')}function S(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" /><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}function E(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}function O(e,t){return e.h("gt",t,{block:A},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}function A(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-idx"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}dust.register(i.CLASS,e);e.__dustBody=!0;t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;p.__dustBody=!0;h.__dustBody=!0;d.__dustBody=!0;f.__dustBody=!0;m.__dustBody=!0;y.__dustBody=!0;g.__dustBody=!0;v.__dustBody=!0;C.__dustBody=!0;T.__dustBody=!0;L.__dustBody=!0;w.__dustBody=!0;b.__dustBody=!0;S.__dustBody=!0;E.__dustBody=!0;O.__dustBody=!0;A.__dustBody=!0;return e};i.template[i.CLASS+"-dialog"]=function(){function e(e,t){return e.w('<div class="tc-ctl-finfo-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-finfo-dialog-dl"><h2>').h("i18n",t,{},{$key:"download"}).w('</h2><div><button class="tc-button tc-ctl-finfo-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-ctl-finfo-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-ctl-finfo-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-ctl-finfo-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button></div></div><div class="tc-ctl-finfo-dialog-share"></div></div></div></div>')}dust.register(i.CLASS+"-dialog",e);e.__dustBody=!0;return e};i.template[i.CLASS+"-del-btn"]=function(){function e(e,t){return e.w('<button class="tc-ctl-finfo-del-btn" title="').h("i18n",t,{},{$key:"deleteFeature"}).w('">').h("i18n",t,{},{$key:"deleteFeature"}).w("</button>")}dust.register(i.CLASS+"-del-btn",e);e.__dustBody=!0;return e}}i.register=function(e){var t=this;TC.control.Click.prototype.register.call(t,e);var r;r=t.options.resultsLayer?t.options.resultsLayer:{id:TC.getUID(),title:t.CLASS+": Results layer",type:TC.Consts.layerType.VECTOR,stealth:!0};var n;n=t.options.filterLayer?t.options.filterLayer:{id:TC.getUID(),title:t.CLASS+": Filter layer",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{line:{strokeColor:t.lineColor,strokeWidth:2},polygon:{strokeColor:t.lineColor,strokeWidth:2,fillColor:"#000",fillOpacity:.3}}};e.loaded(function(){$.when(e.addLayer(r),e.addLayer(n)).then(function(e,r){t.resultsLayer=e;t.filterLayer=r;t._layersDeferred.resolve()})});t.displayMode=t.options.displayMode||TC.control.FeatureInfoCommons.displayMode.POPUP;t.setDisplayMode(t.displayMode);e.on(TC.Consts.event.BEFOREFEATUREINFO,function(e){t.querying=!0;t.beforeGetFeatureInfo(e)}).on(TC.Consts.event.FEATUREINFO,function(e){t.querying=!1;if(t.isActive){t.lastFeatureCount=t.countFeatures(e);t.responseCallback(e)}}).on(TC.Consts.event.NOFEATUREINFO,function(e){t.querying=!1;t.lastFeatureCount=0;t.closeResults()}).on(TC.Consts.event.POPUPHIDE+" "+TC.Consts.event.RESULTSPANELCLOSE,function(e){if(e.control===t.getDisplayControl()&&t.resultsLayer){t.resultsLayer.clearFeatures();clearTimeout(t._removeFilterFeatureTimeout);t._removeFilterFeatureTimeout=setTimeout(function(){t.querying||t.filterLayer.clearFeatures()},50)}})};i.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e).on(TC.Consts.event.CLICK,"button[data-format]",function(e){TC.Util.closeModal();var r=t.resultsLayer.features[t.resultsLayer.features.length-1];t.map.exportFeatures([r],{fileName:r.id,format:$(e.target).data("format")})})})};i.markerStyle={cssClass:TC.Consts.classes.POINT,anchor:[.5,.5],width:15,height:15,noPrint:!0};i.setDisplayMode=function(e){var t=this;t.displayMode=e;var r=t.map;switch(e){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:if(!t.resultsPanel){var n=r.getControlsByClass("TC.control.ResultsPanel")[0];if(n)t.resultsPanel=n;else{var i=function a(e){if(TC.control.ResultsPanel&&e.control instanceof TC.control.ResultsPanel){t.resultsPanel=e.control;r.off(TC.Consts.event.CONTROLADD,a)}};r.on(TC.Consts.event.CONTROLADD,i)}}break;default:t.displayMode=TC.control.FeatureInfoCommons.displayMode.POPUP;t.popup||$.when(r.addControl("popup",{closeButton:!0,draggable:t.options.draggable})).then(function(e){t.popup=e;e.caller=t;r.on(TC.Consts.event.POPUP,function(e){t.onShowPopUp(e)});r.on(TC.Consts.event.POPUPHIDE,function(r){r.control===e&&t.popup.$popupDiv.css("width","auto")})})}};i.getDisplayControl=function(){var e=this;switch(e.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return e.resultsPanel;default:return e.popup}};i.getDisplayTarget=function(){var e=this;switch(e.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:return e.resultsPanel.$divTable;default:return e.popup.$popupDiv}};i.displayResults=function(){var e=this;e.filterFeature.data=$("<div>").append(e._$div.clone()).html();switch(e.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:e.getDisplayTarget().html(e.filterFeature.data);e.resultsPanel.open();e.displayResultsCallback();break;default:e.popup&&e.filterFeature.showPopup(e.popup)}};i.closeResults=function(){var e=this;switch(e.displayMode){case TC.control.FeatureInfoCommons.displayMode.RESULTS_PANEL:e.resultsPanel&&e.resultsPanel.close();break;default:e.popup&&e.popup.isVisible()&&e.popup.hide()}};i.displayResultsCallback=function(){var i=this,a=i.getDisplayTarget(),s="ficHandlers",o=a.data(s);if(!o){var l,c="click";a.on(c,e,function(e){r.call(this,i.map.activeControl)});c="mouseenter";a.on(c,e,function(e){var t=this;$(t).parents("."+i.CLASS+"-layers > li").hasClass(TC.Consts.classes.CHECKED)&&r.call(t,i.map.activeControl)});c=TC.Consts.event.CLICK;l="."+i.CLASS+"-btn-next";a.on(c,l,function(e){r.call(n(i.map.activeControl,1),i.map.activeControl,1);return!1});l="."+i.CLASS+"-btn-prev";a.on(c,l,function(e){r.call(n(i.map.activeControl,-1),i.map.activeControl,-1);return!1});l="ul."+i.CLASS+"-layers h4";a.on(c,l,function(n){var s=$(n.target).parent();if(s.hasClass(TC.Consts.classes.CHECKED))"none"===a.find(".tc-ctl-finfo-btn-next").css("display")&&t(i.map.activeControl);else{r.call(s.find(e).first()[0],i.map.activeControl);i.displayMode===TC.control.FeatureInfoCommons.displayMode.POPUP&&i.popup.fitToView(!0)}});l="."+i.CLASS+"-tools-btn";a.on(c,l,function(e){var t=new $.Deferred;i.map.activeControl._shareCtl?t.resolve():i.map.addControl("share",{div:i.map.activeControl._$dialogDiv.find(".tc-modal-body .tc-ctl-finfo-dialog-share")}).then(function(e){i.map.activeControl._shareCtl=e;t.resolve()});$.when(t).then(function(){TC.Util.showModal(i.map.activeControl._$dialogDiv.find("."+i.map.activeControl.CLASS+"-dialog"),{openCallback:function(){i.map.activeControl.onShowModal()}})})});a.data(s,!0)}i.info&&(i.info.defaultFeature?r.call(i.info.defaultFeature,i):r.call(a.find(e).first()[0],i));a.find("table").on("click",function(e){if(!$(this).parent().hasClass(TC.Consts.classes.DISABLED)){if(i.resultsLayer.features[0]){var t=function r(){i._zooming=!1;i.map.off(TC.Consts.event.ZOOM,r)};i.map.on(TC.Consts.event.ZOOM,t);i._zooming=!0;i.map.zoomToFeatures([i.resultsLayer.features[0]],{animate:!0})}e.stopPropagation()}});a.find("table a").on("click",function(e){e.stopPropagation()})};i.onShowPopUp=function(e){{var t=this;t.map}if(e.control===t.popup){t.displayResultsCallback();t.fitSize()}};i.onShowModal=function(){};i.highlightFeature=function(e){r.call(e,this)};i.fitSize=function(){var e=this,t=e.getDisplayTarget(),r=0;t.find(".tc-ctl-finfo-features li").each(function(e,t){r=Math.max(r,$(t).position().left+$(t).width())});r&&t.width(r+50)};i.countFeatures=function(e){for(var t=0,r=0;r<e.services.length;r++)e.services[r].layers.forEach(function(e){t+=e.features.length});return t};i.getFeature=function(e,t,r,n){var i;if(e){i=e.services[t];if(i){i=i.layers[r];i&&(i=i.features[n])}}return i};i.getFeatureIdx=function(e,t,r,n){var i=-1;if(e)for(var a=0;t>a;a++)for(var s=e.services[a],o=a===t-1?r:s.layers.length,l=0;o>l;l++)for(var c=s.layers[l],u=l===r-1?n:c.features.length,p=0;u>p;p++)i+=1;return i};i.beforeGetFeatureInfo=function(e){var t=this;t.closeResults();if(e.control===t&&t.map&&t.resultsLayer){t.lastFeatureCount=null;t.resultsLayer.clearFeatures();t.info=null}};i.activate=function(){var e=this;e.wrap&&e.wrap.activate();TC.Control.prototype.activate.call(e)};i.deactivate=function(e){var t=this;t.popup&&t.popup.hide();t.resultsLayer.clearFeatures();t.filterLayer.clearFeatures();t.wrap&&t.wrap.deactivate();TC.Control.prototype.deactivate.call(t,e)}}();TC.control=TC.control||{};TC.Consts=TC.Consts||{};TC.Consts.SCREEN_SIZE_KEY="TC.Map.screenSize";TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Scale=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.Scale,TC.Control);!function(){var e=TC.control.Scale.prototype;e.CLASS="tc-ctl-scl";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Scale.html":function(){function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><span>1:').h("math",t,{},{key:r,method:"round"}).w('</span> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></div>')}function r(e,t){return e.f(t.get(["scale"],!1),t,"h")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;return t};e.render=function(e){var t=this;$("input[type=button]",t._$div).off();t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize},function(){var r=t._$div.find("span");r.text("1:"+t.format(r.text().substr(2)));t._$div.find('input[type="button"]').on(TC.Consts.event.CLICK,function(){t.setScreenSize.call(t)});$.isFunction(e)&&e()})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);var r=TC.Util.storage.getLocalValue(TC.Consts.SCREEN_SIZE_KEY);r&&(TC.Cfg.screenSize=r);t.render(function(){e.on(TC.Consts.event.ZOOM,function(){delete t.metersPerDegree;t.update()})})};e.update=function(){this.render()};e.setScreenSize=function(){var e=this;TC.prompt(e.getLocaleString("selectScreenSize"),TC.Cfg.screenSize,function(t){if(t){TC.Cfg.screenSize=parseFloat(t);TC.Util.storage.setLocalValue(TC.Consts.SCREEN_SIZE_KEY,TC.Cfg.screenSize);e.update()}})};e.getScale=function(e){var t=this,r=0,n=!e&&t.map?t.map.wrap.getResolution():e;if(n){r=n*t.getDpi(TC.Cfg.screenSize)/.0254;window.devicePixelRatio&&(r*=window.devicePixelRatio)}if(t.map&&t.map.wrap.isGeo()){if(!t.metersPerDegree){var i=t.map.getExtent();i&&(t.metersPerDegree=TC.Util.getMetersPerDegree(i))}t.metersPerDegree&&(r*=t.metersPerDegree)}return r};e.getDpi=function(e){var t=this;t.dpi=Math.sqrt(screen.width*screen.width+screen.height*screen.height)/e;return t.dpi};e.format=function(e){for(var t=new Number(e).toFixed(0),r=[];t.length>3;){var n=t.length-3;r.unshift(t.substr(n));t=t.substr(0,n)}t&&r.unshift(t);return r.join(".")}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.SWCacheClient=function(){var e=this;e.serviceWorkerEnabled=!1;e._serviceWorkerDeferred=$.Deferred()};TC.inherit(TC.control.SWCacheClient,TC.Control);var e=TC.control.SWCacheClient.prototype;e.CLASS="tc-ctl-swcc";e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);navigator.serviceWorker?navigator.serviceWorker.register("tc-cb-service-worker.js",{scope:"./"}).then(function(e){t.serviceWorkerEnabled=!0;e.installing?t._serviceWorkerDeferred.resolve(e.installing):e.waiting?t._serviceWorkerDeferred.resolve(e.waiting):e.active&&t._serviceWorkerDeferred.resolve(e.active);console.log(e.scope,"register")},function(e){t.serviceWorkerEnabled=!1;t._serviceWorkerDeferred.reject();console.error("Could not register service worker: "+e)}):t._serviceWorkerDeferred.reject()};e.getServiceWorker=function(){return this._serviceWorkerDeferred.promise()};var t=function(e,t,r,n){var i="message",a=function s(a){if(a.data.name===t){a.data.action===r&&a.data.event===n?e.resolve(t):"error"===a.data.event&&e.reject();navigator.serviceWorker.removeEventListener(i,s)}};navigator.serviceWorker.addEventListener(i,a)};e.createCache=function(e,r){var n=this,i=$.Deferred();n.getServiceWorker().then(function(n){var a="create",s=r||{};t(i,e,a,"cached");n.postMessage({action:a,name:e,list:s.urlList||[],silent:s.silent})},function(){i.resolve(!1)});return i.promise()};e.deleteCache=function(e,r){var n=this,i=$.Deferred();n.getServiceWorker().then(function(n){var a="delete",s=r||{};t(i,e,a,"deleted");n.postMessage({action:a,name:e,silent:s.silent})},function(){i.resolve(!1)});return i.promise()}}();window.OpenLayers||TC.syncLoadJS(TC.url.ol);!function(){OpenLayers._getScriptLocation=function(){var e=OpenLayers._getScriptLocation();e||(e=TC.url.ol.substr(0,TC.url.ol.lastIndexOf("/")+1));return function(){return e}}();OpenLayers.CustomTheme=TC.apiLocation+"OpenLayers/theme/tcsa/style.css";OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{fillColor:TC.Cfg.styles.polygon.fillColor,fillOpacity:TC.Cfg.styles.polygon.fillOpacity,strokeColor:TC.Cfg.styles.line.strokeColor,strokeWidth:TC.Cfg.styles.line.strokeWidth});OpenLayers.Format.XML.prototype._write=OpenLayers.Format.XML.prototype.write;OpenLayers.Format.XML.prototype.write=function(){var e=OpenLayers.Format.XML.prototype._write.apply(this,arguments);e=e.replace(new RegExp('xmlns:NS\\d+="" NS\\d+:',"g"),"");return e};OpenLayers.Control.PanZoom.prototype.onButtonClick=function(e){var t=e.buttonElement;switch(t.action){case"panup":this.map.pan(0,-this.getSlideFactor("h"));break;case"pandown":this.map.pan(0,this.getSlideFactor("h"));break;case"panleft":this.map.pan(-this.getSlideFactor("w"),0);break;case"panright":this.map.pan(this.getSlideFactor("w"),0);break;case"zoomin":this.map.zoomIn();break;case"zoomout":this.map.zoomOut();break;case"zoomworld":this.map.zoomToExtent(this.map.options.extent)}};OpenLayers.Control.OverviewMap.prototype._updateOverview=OpenLayers.Control.OverviewMap.prototype.updateOverview;OpenLayers.Control.OverviewMap.prototype.updateOverview=function(){var e=this;(e.active||null===e.active)&&e._updateOverview()};OpenLayers.Format.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Format.XML,{layerIdentifier:"_layer",featureIdentifier:"_feature",regExes:{trimSpace:/^\s*|\s*$/g,removeSpace:/\s*/g,splitSpace:/\s+/,trimComma:/\s*,\s*/g},gmlFormat:null,read:function(e){var t;"string"==typeof e&&(e=OpenLayers.Format.XML.prototype.read.apply(this,[e]));var r=e.documentElement;if(r){var n=this["read_"+r.nodeName];t=n?n.call(this,r):new OpenLayers.Format.GML(this.options?this.options:{}).read(e)}else t=e;return t},read_msGMLOutput:function(e){var t=[],r=this.getSiblingNodesByTagCriteria(e,this.layerIdentifier);if(r)for(var n=0,i=r.length;i>n;++n){var a=r[n],s=a.nodeName;a.prefix&&(s=s.split(":")[1]);var s=s.replace(this.layerIdentifier,""),o=this.getSiblingNodesByTagCriteria(a,this.featureIdentifier);if(o)for(var l=0;l<o.length;l++){var c=o[l],u=this.parseGeometry(c),p=this.parseAttributes(c),h=new OpenLayers.Feature.Vector(u.geometry,p,null);h.bounds=u.bounds;h.type=s;t.push(h)}}return t},read_FeatureInfoResponse:function(e){for(var t=[],r=this.getElementsByTagNameNS(e,"*","FIELDS"),n=0,i=r.length;i>n;n++){var a,s=r[n],o=null,l={},c=s.attributes.length;if(c>0)for(a=0;c>a;a++){var u=s.attributes[a];l[u.nodeName]=u.nodeValue}else{var p=s.childNodes;for(a=0,c=p.length;c>a;++a){var h=p[a];3!=h.nodeType&&(l[h.getAttribute("name")]=h.getAttribute("value"))}}t.push(new OpenLayers.Feature.Vector(o,l,null))}return t},getSiblingNodesByTagCriteria:function(e,t){var r,n,i,a,s,o=[];if(e&&e.hasChildNodes()){r=e.childNodes;i=r.length;for(var l=0;i>l;l++){s=r[l];for(;s&&1!=s.nodeType;){s=s.nextSibling;l++}n=s?s.nodeName:"";if(n.length>0&&n.indexOf(t)>-1)o.push(s);else{a=this.getSiblingNodesByTagCriteria(s,t);a.length>0&&(0==o.length?o=a:o.push(a))}}}return o},parseAttributes:function(e){var t={};if(1==e.nodeType)for(var r=e.childNodes,n=r.length,i=0;n>i;++i){var a=r[i];if(1==a.nodeType){var s=a.childNodes,o=a.prefix?a.nodeName.split(":")[1]:a.nodeName;if(0==s.length)t[o]=null;else if(1==s.length){var l=s[0];if(3==l.nodeType||4==l.nodeType){var c=l.nodeValue.replace(this.regExes.trimSpace,"");t[o]=c}}}}return t},parseGeometry:function(e){this.gmlFormat||(this.gmlFormat=new OpenLayers.Format.GML);var t,r=this.gmlFormat.parseFeature(e),n=null;if(r){t=r.geometry&&r.geometry.clone();n=r.bounds&&r.bounds.clone();r.destroy()}return{geometry:t,bounds:n}},CLASS_NAME:"OpenLayers.Format.WMSGetFeatureInfo"});OpenLayers.Format.GML.prototype._oldParseFeature=OpenLayers.Format.GML.prototype.parseFeature;OpenLayers.Format.GML.prototype.parseFeature=function(e){this.externalProjection=null;for(var t,r,n=["MultiPolygon","Polygon","MultiLineString","LineString","MultiPoint","Point","Envelope"],i=0;i<n.length;++i){t=n[i];r=this.getElementsByTagNameNS(e,this.gmlns,t);if(r.length>0){var a=r[0].getAttribute("srsName");if(a){TC.loadProjDef(a,!0);this.externalProjection=new OpenLayers.Projection("EPSG:"+a.substr(a.lastIndexOf("#")+1))}break}}return this._oldParseFeature(e)};OpenLayers.Control.WMSGetFeatureInfo=OpenLayers.Class(OpenLayers.Control,{hover:!1,drillDown:!1,maxFeatures:10,clickCallback:"click",output:"features",layers:null,queryVisible:!1,url:null,layerUrls:null,infoFormat:"text/html",vendorParams:{},format:null,formatOptions:null,handler:null,hoverRequest:null,initialize:function(e){e=e||{};e.handlerOptions=e.handlerOptions||{};OpenLayers.Control.prototype.initialize.apply(this,[e]);this.format||(this.format=new OpenLayers.Format.WMSGetFeatureInfo(e.formatOptions));this.drillDown===!0&&(this.hover=!1);if(this.hover)this.handler=new OpenLayers.Handler.Hover(this,{move:this.cancelHover,pause:this.getInfoForHover},OpenLayers.Util.extend(this.handlerOptions.hover||{},{delay:250}));else{var t={};t[this.clickCallback]=this.getInfoForClick;this.handler=new OpenLayers.Handler.Click(this,t,this.handlerOptions.click||{})}},getInfoForClick:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});OpenLayers.Element.addClass(this.map.viewPortDiv,"olCursorWait");this.request(e.xy,{})},getInfoForHover:function(e){this.events.triggerEvent("beforegetfeatureinfo",{xy:e.xy});this.request(e.xy,{hover:!0})},cancelHover:function(){if(this.hoverRequest){this.hoverRequest.abort();this.hoverRequest=null}},findLayers:function(){for(var e,t,r=this.layers||this.map.layers,n=[],i=r.length-1;i>=0;--i){e=r[i];if(e instanceof OpenLayers.Layer.WMS&&(!this.queryVisible||e.getVisibility())){t=OpenLayers.Util.isArray(e.url)?e.url[0]:e.url;this.drillDown!==!1||this.url||(this.url=t);(this.drillDown===!0||this.urlMatches(t))&&n.push(e)}}return n},urlMatches:function(e){var t=OpenLayers.Util.isEquivalentUrl(this.url,e);if(!t&&this.layerUrls)for(var r=0,n=this.layerUrls.length;n>r;++r)if(OpenLayers.Util.isEquivalentUrl(this.layerUrls[r],e)){t=!0;break}return t},buildWMSOptions:function(e,t,r,n){for(var i=[],a=[],s=0,o=t.length;o>s;s++)if(null!=t[s].params.LAYERS){i=i.concat(t[s].params.LAYERS);a=a.concat(this.getStyleNames(t[s]))}var l=t[0],c=this.map.getProjection(),u=l.projection;u&&u.equals(this.map.getProjectionObject())&&(c=u.getCode());var p=OpenLayers.Util.extend({service:"WMS",version:l.params.VERSION,request:"GetFeatureInfo",exceptions:l.params.EXCEPTIONS,bbox:this.map.getExtent().toBBOX(null,l.reverseAxisOrder()),feature_count:this.maxFeatures,height:this.map.getSize().h,width:this.map.getSize().w,format:n,info_format:l.params.INFO_FORMAT||this.infoFormat},parseFloat(l.params.VERSION)>=1.3?{crs:c,i:parseInt(r.x),j:parseInt(r.y)}:{srs:c,x:parseInt(r.x),y:parseInt(r.y)});0!=i.length&&(p=OpenLayers.Util.extend({layers:i,query_layers:i,styles:a},p));OpenLayers.Util.applyDefaults(p,this.vendorParams);return{url:e,params:OpenLayers.Util.upperCaseObject(p),callback:function(t){this.handleResponse(r,t,e)},scope:this}},getStyleNames:function(e){var t;t=e.params.STYLES?e.params.STYLES:OpenLayers.Util.isArray(e.params.LAYERS)?new Array(e.params.LAYERS.length):e.params.LAYERS.replace(/[^,]/g,"");return t},request:function(e,t){var r=this.findLayers();if(0!=r.length){t=t||{};if(this.drillDown===!1){var n=this.buildWMSOptions(this.url,r,e,r[0].params.FORMAT),i=OpenLayers.Request.GET(n);t.hover===!0&&(this.hoverRequest=i)}else{this._requestCount=0;this._numRequests=0;this.features=[];for(var a,s={},o=0,l=r.length;l>o;o++){var c=r[o];a=OpenLayers.Util.isArray(c.url)?c.url[0]:c.url;if(a in s)s[a].push(c);else{this._numRequests++;s[a]=[c]}}var r;for(var a in s){r=s[a];var n=this.buildWMSOptions(a,r,e,r[0].params.FORMAT);OpenLayers.Request.GET(n)}}}else{this.events.triggerEvent("nogetfeatureinfo");OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")}},triggerGetFeatureInfo:function(e,t,r){this.events.triggerEvent("getfeatureinfo",{text:e.responseText,features:r,request:e,xy:t});OpenLayers.Element.removeClass(this.map.viewPortDiv,"olCursorWait")},handleResponse:function(e,t,r){var n=t.responseXML;n&&n.documentElement||(n=t.responseText);var i=this.format.read(n);if(this.drillDown===!1)this.triggerGetFeatureInfo(t,e,i);else{this._requestCount++;this._features=(this._features||[]).concat("object"===this.output?{url:r,features:i}:i);if(this._requestCount===this._numRequests){this.triggerGetFeatureInfo(t,e,this._features.concat());delete this._features;delete this._requestCount;delete this._numRequests}}},CLASS_NAME:"OpenLayers.Control.WMSGetFeatureInfo"});OpenLayers.Format.WMSGetFeatureInfo.prototype._defaultRead_FeatureInfoResponse=OpenLayers.Format.WMSGetFeatureInfo.prototype.read_FeatureInfoResponse;OpenLayers.Format.WMSGetFeatureInfo.prototype["read_esri_wms:FeatureInfoResponse"]=function(e){for(var t=[],r=this.getElementsByTagNameNS(e,"http://www.esri.com/wms","FeatureInfoCollection"),n=0;n<r.length;n++)for(var i=r[n],a=this.getElementsByTagNameNS(i,"http://www.esri.com/wms","FeatureInfo"),s=0;s<a.length;s++){for(var o=a[s],l=null,c=this.getElementsByTagNameNS(o,"http://www.esri.com/wms","FieldName"),u=this.getElementsByTagNameNS(o,"http://www.esri.com/wms","FieldValue"),p={},h=0;h<c.length;h++){var d=c[h],f=u[h],m=void 0===d.textContent?"text":"textContent";p[d[m]]=f[m]}var y=new OpenLayers.Feature.Vector(l,p,null);y.type=i.getAttribute("layername");t.push(y)}return t};OpenLayers.Format.WMSGetFeatureInfo.prototype.read_FeatureInfoResponse=function(e){return"http://www.esri.com/wms"===e.namespaceURI?OpenLayers.Format.WMSGetFeatureInfo.prototype["read_esri_wms:FeatureInfoResponse"].call(this,e):OpenLayers.Format.WMSGetFeatureInfo.prototype._defaultRead_FeatureInfoResponse.call(this,e)};!function(){function e(e){OpenLayers.Request.XMLHttpRequest.onreadystatechange&&OpenLayers.Request.XMLHttpRequest.onreadystatechange.apply(e);e.dispatchEvent({type:"readystatechange",bubbles:!1,cancelable:!1,timeStamp:new Date+0})}function t(e){try{e.responseText=e._object.responseText}catch(t){}try{e.responseXML=fGetDocument(e._object)}catch(t){}try{e.status=e._object.status}catch(t){}try{e.statusText=e._object.statusText}catch(t){}}function r(e){e._object.onreadystatechange=new window.Function}{var n=!!window.controllers,i=window.document.all&&!window.opera;i&&window.navigator.userAgent.match(/MSIE 7.0/)}OpenLayers.Request.XMLHttpRequest.prototype.open=function(a,s,o,l,c){function u(e){var t=0!==e.indexOf("http")&&0!==e.indexOf("//"),r=!t&&e.match(this.URL_SPLIT_REGEX);if(r){var n=window.location;t=r[1]==n.protocol&&r[3]==n.hostname;var i=r[4],a=n.port;(80!=i&&""!=i||"80"!=a&&""!=a)&&(t=t&&i==a)}return t}u(s)||"withCredentials"in this._object||!window.XDomainRequest||(this._object=new window.XDomainRequest);delete this._headers;arguments.length<3&&(o=!0);this._async=o;var p,h=this,d=this.readyState;if(i&&o){p=function(){if(d!=OpenLayers.Request.XMLHttpRequest.DONE){r(h);h.abort()}};window.attachEvent("onunload",p)}OpenLayers.Request.XMLHttpRequest.onopen&&OpenLayers.Request.XMLHttpRequest.onopen.apply(this,arguments);arguments.length>4?this._object.open(a,s,o,l,c):arguments.length>3?this._object.open(a,s,o,l):this._object.open(a,s,o);this.readyState=OpenLayers.Request.XMLHttpRequest.OPENED;e(this);"withCredentials"in this._object||"onreadystatechange"in this._object?this._object.onreadystatechange=function(){if(!n||o){h.readyState=h._object.readyState;t(h);if(h._aborted)h.readyState=OpenLayers.Request.XMLHttpRequest.UNSENT;else{if(h.readyState==OpenLayers.Request.XMLHttpRequest.DONE){delete h._data;r(h);i&&o&&window.detachEvent("onunload",p)}d!=h.readyState&&e(h);d=h.readyState}}}:this._object.onload=function(){if(!n||o){h.readyState=OpenLayers.Request.XMLHttpRequest.DONE;h._object.status=200;h._object.statusText="OK";t(h);delete h._data;i&&o&&window.detachEvent("onunload",p);h.onreadystatechange()}}};OpenLayers.Request.XMLHttpRequest.prototype.setRequestHeader=function(e,t){this._headers||(this._headers={});this._headers[e]=t;return"setRequestHeader"in this._object?this._object.setRequestHeader(e,t):("contentType"in this._object&&"Content-Type"==e,void 0)}}();OpenLayers.Format.KML.prototype._getNodeText=function(e){var t="";void 0!==e.textContent?t=e.textContent:void 0!==e.innerHTML?t=e.innerHTML:void 0!==e.text&&(t=e.text);return t};OpenLayers.Format.KML.prototype._getFolderHierarchy=function(e){var t=[],r=e;if(r.parentNode)do{r=r.parentNode;if("folder"==r.nodeName.toLowerCase()){var n;r.childNodes&&r.childNodes.length&&r.childNodes.length>0&&("name"==r.childNodes[0].nodeName?n=this._getNodeText(r.childNodes[0]):r.childNodes.length>1&&(n=this._getNodeText(r.childNodes[1])));n&&t.push(n)}}while(null!==r.parentNode&&"document"!==r.parentNode.nodeName.toLowerCase());t.reverse();this._folderTree||(this._folderTree={children:[]});TC.Util.addArrayToTree(t,this._folderTree);return t};OpenLayers.Format.KML.prototype.parserTimeout=0;OpenLayers.Format.KML.prototype.parseFeatures=function(e,t){for(var r,n,i=[],a=new Date,s=0,o=e.length;o>s;s++){if(this.parserTimeout>0&&s%10===0&&s>0){r=new Date;n=parseInt(r.getTime()-a.getTime());if(n>this.parserTimeout)throw"El archivo KML es demasiado complejo para este navegador."+n+"ms, "+s+" features"}var l=e[s],c=this.parseFeature.apply(this,[l]);if(!c)throw"Bad Placemark: "+s;this.extractStyles&&c.attributes&&c.attributes.styleUrl&&(c.style=this.getStyle(c.attributes.styleUrl,t));if(this.extractStyles){var u=this.getElementsByTagNameNS(l,"*","Style")[0];if(u){var p=this.parseStyle(u);p&&(c.style=OpenLayers.Util.extend(c.style,p));

}}this.parseFolders&&(c._folders=this._getFolderHierarchy(l));if(this.extractTracks){var h=this.getElementsByTagNameNS(l,this.namespaces.gx,"Track");if(h&&h.length>0){var d=h[0],f={features:[],feature:c};this.readNode(d,f);f.features.length>0&&i.push.apply(i,f.features)}}else i.push(c)}this.features=this.features.concat(i)};OpenLayers.Format.KML.prototype._read=OpenLayers.Format.KML.prototype.read;OpenLayers.Format.KML.prototype.read=function(e){var t=this.getChildEl(e.documentElement,"Document");if(t){var r=this.getChildEl(t,"name");r&&(this._documentName=this._getNodeText(r))}return this._read.call(this,e)};OpenLayers.Popup.Anchored.prototype.calculateRelativePosition=function(){return"tr"};OpenLayers.Control.PanZoomBar.prototype._draw=OpenLayers.Control.PanZoomBar.prototype.draw;OpenLayers.Control.PanZoomBar.prototype.draw=function(e){var t=this,r=OpenLayers.Control.PanZoomBar.prototype._draw.call(t,e);$(t.div).removeAttr("style").addClass("tc-ctl-nav");var n=$(t.buttons[0]),i=n.height();n.removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-zoomin");var a=(n.height()-i,$(t.zoombarDiv)),i=a.css("height");a.removeAttr("style").addClass("tc-ctl-nav-bar").css("height",i);var s=$(t.slider);i=s.css("height");s.removeAttr("style").addClass("tc-ctl-nav-slider").css("height",i);$(t.buttons[1]).removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-zoomout");$(t.buttons[2]).removeAttr("style").addClass("tc-ctl-nav-btn tc-ctl-nav-btn-home");return r};TC.wrap.Map.prototype.setMap=function(){var e=this,t=e.parent.options;t.proxy&&(OpenLayers.ProxyHost=t.proxy);e.map=new OpenLayers.Map(e.parent.div,{projection:t.crs,extent:t.initialExtent,maxExtent:t.maxExtent,restrictedExtent:t.maxExtent,controls:[new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:!0},pinchZoomOptions:{autoActivate:!0},zoomWheelEnabled:t.mouseWheelZoom})],theme:OpenLayers.CustomTheme});e.map.events.register("zoomstart",e.parent,function(){e.parent.$events.trigger($.Event(TC.Consts.event.BEFOREZOOM))});e.map.events.register("zoomend",e.parent,function(){e.parent.$events.trigger($.Event(TC.Consts.event.ZOOM))});e.map.events.register("featureclick",e.parent,function(t){t.feature&&t.feature._wrap&&e.parent.$events.trigger($.Event(TC.Consts.event.FEATURECLICK,{feature:t.feature._wrap.parent}))});e.map.events.register("nofeatureclick",e.parent,function(t){for(var r=0;r<e.parent.workLayers.length;r++){var n=e.parent.workLayers[r];n.wrap.layer===t.layer&&e.parent.$events.trigger($.Event(TC.Consts.event.NOFEATURECLICK,{layer:n}))}});var r;$(e.parent.div).on("resize",function(){clearTimeout(r);r=setTimeout(function(){e.map.updateSize()},200)});e.mapDeferred.resolve(e.map)};TC.wrap.Map.prototype.insertLayer=function(e,t){for(var r=this,n=!1,i=0;i<r.map.layers.length;i++)if(r.map.layers[i]===e){n=!0;break}n||r.map.addLayer(e);r.map.setLayerIndex(e,t)};TC.wrap.Map.prototype.removeLayer=function(e){this.map.removeLayer(e)};TC.wrap.Map.prototype.getLayerCount=function(){return this.map.getNumLayers()};TC.wrap.Map.prototype.indexOfFirstVector=function(){for(var e=this,t=-1,r=0,n=e.map.layers.length;n>r;r++)if(e.map.layers[r]instanceof OpenLayers.Layer.Vector){t=r;break}return t};TC.wrap.Map.prototype.getLayerIndex=function(e){return this.map.getLayerIndex(e)};TC.wrap.Map.prototype.setLayerIndex=function(e,t){this.map.setLayerIndex(e,t)};TC.wrap.Map.prototype.setBaseLayer=function(e){var t=this,r=new $.Deferred;t.map.addLayer(e);t.map.setBaseLayer(e);t.parent.baseLayer&&t.map.removeLayer(t.parent.baseLayer.wrap.getLayer());r.resolve();return r};TC.wrap.Map.prototype.setExtent=function(e){this.map.updateSize();this.map.zoomToExtent(e)};TC.wrap.Map.prototype.getExtent=function(){var e=null,t=this.map.getExtent();t&&(e=[t.left,t.bottom,t.right,t.top]);return e};TC.wrap.Map.prototype.setCenter=function(e){this.map.panTo(e)};TC.wrap.Map.prototype.getResolution=function(){return this.map.getResolution()};TC.wrap.Map.prototype.setResolution=function(e){$.when(this.getMap()).then(function(t){t.zoomTo(t.getZoomForResolution(e))})};TC.wrap.Map.prototype.getResolutions=function(){var e=[],t=this;if(t.map.resolutions)e=t.map.resolutions;else{t.map.baseLayer&&(e=t.map.baseLayer.resolutions);if(!e)for(var r=0;r<t.map.layers.length&&!e;r++)e=t.map.layers[r].resolutions}return e};TC.wrap.Map.prototype.getCoordinateFromPixel=function(e){var t=this.map.getLonLatFromPixel({x:e[0],y:e[1]});return[t.lon,t.lat]};TC.wrap.Map.prototype.getPixelFromCoordinate=function(e){var t=this.map.getPixelFromLonLat({lon:e[0],lat:e[1]});return[t.x,t.y]};TC.wrap.Map.prototype.getViewport=function(e){var t=this,r=e||{};if(r.synchronous)n=t.map.getViewport();else{var n=new $.Deferred;$.when(this.getMap()).then(function(e){n.resolve(e.getViewport())})}return n};TC.wrap.Map.prototype.isNative=function(e){return e instanceof OpenLayers.Map};TC.wrap.Map.prototype.isGeo=function(){var e=this,t=e.map.getProjectionObject();null===t&&(t=new OpenLayers.Projection(e.map.projection));var r=t.getUnits();return"degrees"===r||!r};TC.wrap.Map.prototype.addPopup=function(e){e.$popupDiv=$("<div>")};TC.wrap.Map.prototype.hidePopup=function(e){var t=this,r=t.parent;e&&$.when(r.wrap.getMap()).then(function(t){if(e.wrap.popup&&r.popup===e){t.removePopup(e.wrap.popup);e.wrap.popup.destroy();delete e.wrap.popup;r.popup=null}})};TC.wrap.Map.prototype.exportFeatures=function(e,t){TC.error("TC.wrap.Map.prototype.exportFeatures no implementado en OpenLayers 2")};TC.wrap.Map.prototype.enableDragAndDrop=function(e){TC.error("TC.wrap.Map.prototype.enableDragAndDrop no implementado en OpenLayers 2")};TC.wrap.Map.prototype.loadFiles=function(e){TC.error("TC.wrap.Map.prototype.loadFiles no implementado en OpenLayers 2")};TC.wrap.Layer.prototype.getVisibility=function(){var e=this,t=!1;e.layer&&(t=e.layer.getVisibility());return t};TC.wrap.Layer.prototype.setVisibility=function(e){var t=this;$.when(t.getLayer()).then(function(t){t.setVisibility(e)})};TC.wrap.Layer.prototype.isNative=function(e){return e instanceof OpenLayers.Layer};TC.wrap.Layer.prototype.WmsParser=OpenLayers.Format.WMSCapabilities;TC.wrap.Layer.prototype.WmtsParser=OpenLayers.Format.WMTSCapabilities;TC.wrap.Layer.prototype.addCommonEvents=function(e){var t=this;e.events.register("loadstart",t.parent.map,function(){t.parent.state=TC.Layer.state.LOADING;t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:t.parent}))});e.events.register("loadend",t.parent.map,function(){t.parent.state=TC.Layer.state.IDLE;t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:t.parent}))});e.events.register("visibilitychanged",t.parent.map,function(){t.parent.map&&t.parent.map.$events.trigger($.Event(TC.Consts.event.LAYERVISIBILITY,{layer:t.parent}))})};TC.wrap.layer.Raster.prototype.getGetMapUrl=function(){var e=null,t=this;switch(t.getServiceType()){case TC.Consts.layerType.WMS:e=t.parent.capabilities.capability.request.getmap.href;break;case TC.Consts.layerType.WMTS:e=t.parent.capabilities.operationsMetadata.GetTile.dcp.http.get[0].url}return e};TC.wrap.layer.Raster.prototype.getInfoFormats=function(){var e=null,t=this.parent.capabilities;t.capability&&t.capability.request.getfeatureinfo&&(e=t.capability.request.getfeatureinfo.formats);return e};TC.wrap.layer.Raster.infoFormatPreference=["application/vnd.ogc.gml","application/json","application/vnd.esri.wms_featureinfo_xml","application/vnd.esri.wms_raw_xml","application/vnd.ogc.wms_xml","text/xml","text/html","text/plain"];TC.wrap.layer.Raster.prototype.getWMTSLayer=function(){var e=null,t=this,r=t.parent.capabilities;if(r&&r.contents)for(var n=0;n<r.contents.layers.length;n++)for(var i=r.contents.layers[n],a=0;a<i.tileMatrixSetLinks.length;a++)if(t.parent.options.matrixSet===i.tileMatrixSetLinks[a].tileMatrixSet){e=i;break}return e};TC.wrap.layer.Raster.prototype.getTileMatrix=function(e){var t=null,r=this,n=r.parent.capabilities;n&&n.contents&&n.contents.tileMatrixSets[e]&&(t=_layer.capabilities.contents.tileMatrixSets[_layer.options.matrixSet].matrixIds);return t};TC.wrap.layer.Raster.prototype.getScaleDenominators=function(e){var t=[],r=this;e.scaleDenominator?t=[e.scaleDenominator,e.scaleDenominator]:(e.minScale||e.maxScale)&&(t=[e.minScale,e.maxScale]);if(!t.length&&!r.getName(e)){for(var n=r.getLayerNodes(e),i=-(1/0),a=1/0,s=0,o=n.length;o>s;s++){var l=r.getScaleDenominators(n[s]);l[0]>i&&(i=l[0]);l[1]<a&&(a=l[1])}i>-(1/0)&&1/0>a&&(t=[i,a])}return t};TC.wrap.layer.Raster.prototype.getAttribution=function(e){var t=null;e&&(t=e.serviceIdentification?e.serviceIdentification.title:e.service.title);return t};TC.wrap.layer.Raster.prototype.getInfo=function(e){var t={},r=this.parent.capabilities;if(r&&r.capability)for(var n=function(e,t){var r=e.prefix.length&&0!==t.indexOf(e.prefix)?e.prefix+":"+t:t;return e.name===r},i=0;i<r.capability.layers.length;i++){var a=r.capability.layers[i];if(n(a,e)){a.title&&(t.title=a.title);a["abstract"]&&(t["abstract"]=a["abstract"]);a.styles.length&&(t.legend=a.styles[0].legend.href);if(a.metadataURLs.length){t.metadata=[];for(var s=0;s<a.metadataURLs.length;s++){var o=a.metadataURLs[s];t.metadata.push({format:o.format,type:o.type,url:o.href})}}t.queryable=a.queryable;break}}return t};TC.wrap.layer.Raster.prototype.getServiceType=function(){var e=null,t=this.parent.capabilities;t.capability&&t.capability.request&&t.capability.request.getmap?e=TC.Consts.layerType.WMS:t.operationsMetadata&&t.operationsMetadata.GetTile&&(e=TC.Consts.layerType.WMTS);return e};TC.wrap.layer.Raster.prototype.getServiceTitle=function(){var e=null,t=this.parent.capabilities;t.capability&&t.service?e=t.service.title:t.serviceIdentification&&(e=t.serviceIdentification.title);return e};TC.wrap.layer.Raster.prototype.getRootLayerNode=function(){var e,t=this;t.getServiceType()===TC.Consts.layerType.WMS&&(e=t.parent.capabilities.capability.nestedLayers[0]);return e};TC.wrap.layer.Raster.prototype.getName=function(e,t){var r=e.name;if(r&&t){var n=r.indexOf(":");n>=0&&(r=r.substr(n+1))}return r};TC.wrap.layer.Raster.prototype.getIdentifier=function(e){return e.identifier};TC.wrap.layer.Raster.prototype.getLayerNodes=function(e){var t=e.nestedLayers;$.isArray(t)||(t=[]);return t};TC.wrap.layer.Raster.prototype.normalizeLayerNode=function(e){e.Layer=e.nestedLayers;if(e.Layer)for(var t=0;t<e.Layer.length;t++)TC.wrap.layer.Raster.prototype.normalizeLayerNode(e.Layer[t]);e.Title=e.title;e.Abstract=e["abstract"];return e};TC.wrap.layer.Raster.prototype.normalizeCapabilities=function(e){return{Capability:{Exception:cap.capability.exception,Layer:cap.capability.nestedLayers[0]},Service:cap.service,version:cap.version}};TC.wrap.layer.Raster.prototype.getAllLayerNodes=function(){var e=this,t=this.parent.capabilities;switch(e.getServiceType()){case TC.Consts.layerType.WMS:return t.capability.layers;case TC.Consts.layerType.WMTS:return t.contents.layers;default:return[]}};TC.wrap.layer.Raster.prototype.getLegend=function(e){var t={},r=e.styles;if(r&&r.length){var n=r[0].legend||{};t.src=n.href}return t};TC.wrap.layer.Raster.prototype.isCompatible=function(e){var t=this,r=!1,n=t.parent;switch(t.getServiceType()){case TC.Consts.layerType.WMS:if(n.capabilities&&n.capabilities.capability&&n.capabilities.capability.layers)if(0===n.names.length)r=!0;else for(var i=n.names.slice(0),a=0;a<n.capabilities.capability.layers.length;a++){var s=n.capabilities.capability.layers[a],o=$.inArray(t.getName(s),i);if(o>=0){i.splice(o,1);r=s.srs[e];if(!r||!i.length)break}}break;case TC.Consts.layerType.WMTS:var l=n.capabilities&&n.capabilities.contents&&n.capabilities.contents.tileMatrixSets[n.options.matrixSet]&&n.capabilities.contents.tileMatrixSets[n.options.matrixSet].supportedCRS,c=new RegExp("^urn:ogc:def:crs:"+e.replace(":",":.*:")+"$","g");r=l&&(c.test(l)||l===e)}return r};TC.wrap.layer.Raster.prototype.getCompatibleLayers=function(e){var t=this,r=[],n=t.parent;switch(t.getServiceType()){case TC.Consts.layerType.WMS:if(n.capabilities&&n.capabilities.capability&&n.capabilities.capability.layers)for(var i=0;i<n.capabilities.capability.layers.length;i++){var a=n.capabilities.capability.layers[i],s=t.getName(a);a.srs[e]&&s&&(r[r.length]=s)}break;case TC.Consts.layerType.WMTS:var o=n.capabilities&&n.capabilities.contents&&n.capabilities.contents.tileMatrixSets;if(o){var l=new RegExp("^urn:ogc:def:crs:"+e.replace(":",":.*:")+"$","g");for(var c in o){var u=o[c].supportedCRS;u&&(l.test(u)||u===e)&&(r[r.length]=c)}}}return r};TC.wrap.layer.Raster.prototype.createWmsLayer=function(e,t,r){var n=this,i=new OpenLayers.Layer.WMS(r&&r.id?r.id:t.LAYERS,e,t,{isBaseLayer:1==(r&&r.isBase),singleTile:!0,transitionEffect:"resize",projection:n.parent.crs,units:"m",ratio:TC.Cfg.imageRatio});i._wrap=n;t.LAYERS.length||i.setVisibility(!1);n.addCommonEvents(i);i._originalGetURL=i.getURL;i._noGetURL=function(){return TC.Consts.BLANK_IMAGE};i.getURL=i.params.LAYERS.length>0?i._originalGetURL:i._noGetURL;return i};TC.wrap.layer.Raster.prototype.createWmtsLayer=function(e,t,r){var n=(new OpenLayers.Format.WMTSCapabilities).createLayer(this.parent.capabilities,{isBaseLayer:1==(r&&r.isBase),name:r&&r.id?r.id:TC.Consts.layerType.WMTS,matrixSet:e,layer:t,requestEncoding:r.encoding===TC.Consts.WMTSEncoding.RESTFUL?"REST":"KVP"});n._wrap=self;this.addCommonEvents(n);return n};TC.wrap.layer.Raster.prototype.getParams=function(){return this.layer.params};TC.wrap.layer.Raster.prototype.setParams=function(e){var t=this;t.layer.getURL=e.LAYERS.length>0?t.layer._originalGetURL:t.layer._noGetURL;t.layer.mergeNewParams(e)};TC.wrap.layer.Raster.prototype.getResolutions=function(){return[]};TC.wrap.layer.Raster.prototype.setWMTSUrl=function(){};TC.wrap.Geometry={getNearest:function(e,t){var r=new OpenLayers.Geometry.LineString($.map(t,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])})),n=r.distanceTo(new OpenLayers.Geometry.Point(e[0],e[1]),{details:!0});return[n.x0,n.y0]}};TC.wrap.layer.Vector.prototype.createVectorLayer=function(){var e=this,t=null,r=$.extend({},TC.Cfg,e.parent.options),n=OpenLayers.Feature.Vector.style["default"],i=function(e,t){var i=OpenLayers.Style.prototype.getSymbolizerPrefix(t.geometry).toLowerCase();return r.styles[i]&&r.styles[i][e]||n[e]},a={strokeColor:"${getStrokeColor}",strokeWidth:"${getStrokeWidth}",strokeOpacity:"${getStrokeOpacity}",fillColor:"${getFillColor}",fillOpacity:"${getFillOpacity}",strokeLinecap:"${getStrokeLinecap}",strokeDashstyle:"${getStrokeDashstyle}"},s={getStrokeColor:function(e){return i("strokeColor",e)},getStrokeWidth:function(e){return i("strokeWidth",e)},getStrokeOpacity:function(e){return i("strokeOpacity",e)},getStrokeLinecap:function(e){return i("strokeLinecap",e)},getStrokeDashstyle:function(e){return i("strokeDashstyle",e)},getFillColor:function(e){return i("fillColor",e)},getFillOpacity:function(e){return i("fillOpacity",e)}},o=function(e){var t=e;if($.isFunction(e)){var r="f"+TC.getUID();s[r]=e;t="${"+r+"}"}return t};if(r.styles.point){a.pointRadius=o(r.styles.point.radius);a.graphic=r.styles.point.graphic;a.label=o(r.styles.point.label);a.fontColor=o(r.styles.point.fontColor);a.fontSize=o(r.styles.point.fontSize);a.fontWeight=o(r.styles.point.fontWeight);a.angle=o(r.styles.point.angle)}var l=new OpenLayers.StyleMap({"default":new OpenLayers.Style($.extend({},n,a),{context:s})}),c={styleMap:l,projection:TC.Cfg.crs};r.isLabeling&&(c.renderers=[OpenLayers.Class(OpenLayers.Renderer.SVG,{drawText:function(e,t,r){var n=!!t.labelOutlineWidth;if(n){var i=OpenLayers.Util.extend({},t);i.fontColor=o(i.labelOutlineColor);i.fontStrokeColor=o(i.labelOutlineColor);i.fontStrokeWidth=o(t.labelOutlineWidth);t.labelOutlineOpacity&&(i.fontOpacity=o(t.labelOutlineOpacity));delete i.labelOutlineWidth;this.drawText(e,i,r)}var a=this.getResolution(),s=(r.x-this.featureDx)/a+this.left,l=r.y/a-this.top,c=n?this.LABEL_OUTLINE_SUFFIX:this.LABEL_ID_SUFFIX,u=this.nodeFactory(e+c,"text");u.setAttributeNS(null,"x",s);u.setAttributeNS(null,"y",-l);if(t.angle||0==t.angle){var p="rotate(-"+t.angle+","+s+","+-l+")";u.setAttributeNS(null,"transform",p)}t.fontColor&&u.setAttributeNS(null,"fill",t.fontColor);t.fontStrokeColor&&u.setAttributeNS(null,"stroke",t.fontStrokeColor);t.fontStrokeWidth&&u.setAttributeNS(null,"stroke-width",t.fontStrokeWidth);t.fontOpacity&&u.setAttributeNS(null,"opacity",t.fontOpacity);t.fontFamily&&u.setAttributeNS(null,"font-family",t.fontFamily);t.fontSize&&u.setAttributeNS(null,"font-size",t.fontSize);t.fontWeight&&u.setAttributeNS(null,"font-weight",t.fontWeight);t.fontStyle&&u.setAttributeNS(null,"font-style",t.fontStyle);if(t.labelSelect===!0){u.setAttributeNS(null,"pointer-events","visible");u._featureId=e}else u.setAttributeNS(null,"pointer-events","none");var h=t.labelAlign||OpenLayers.Renderer.defaultSymbolizer.labelAlign;u.setAttributeNS(null,"text-anchor",OpenLayers.Renderer.SVG.LABEL_ALIGN[h[0]]||"middle");OpenLayers.IS_GECKO===!0&&u.setAttributeNS(null,"dominant-baseline",OpenLayers.Renderer.SVG.LABEL_ALIGN[h[1]]||"central");for(var d=t.label.split("\n"),f=d.length;u.childNodes.length>f;)u.removeChild(u.lastChild);for(var m=0;f>m;m++){var y=this.nodeFactory(e+c+"_tspan_"+m,"tspan");if(t.labelSelect===!0){y._featureId=e;y._geometry=r;y._geometryClass=r.CLASS_NAME}OpenLayers.IS_GECKO===!1&&y.setAttributeNS(null,"baseline-shift",OpenLayers.Renderer.SVG.LABEL_VSHIFT[h[1]]||"-35%");y.setAttribute("x",s);if(0==m){var g=OpenLayers.Renderer.SVG.LABEL_VFACTOR[h[1]];null==g&&(g=-.5);y.setAttribute("dy",g*(f-1)+"em")}else y.setAttribute("dy","1em");y.textContent=""===d[m]?" ":d[m];y.parentNode||u.appendChild(y)}u.parentNode||this.textRoot.appendChild(u)},CLASS_NAME:"OpenLayers.Control.CustomSVG"})]);var u=new OpenLayers.Strategy.Fixed;if(e.parent.type===TC.Consts.layerType.KML){c.strategies=[u];c.protocol=new OpenLayers.Protocol.HTTP({url:TC.proxify(r.url),format:new OpenLayers.Format.KML({extractStyles:!0,extractAttributes:!0,parseFolders:!0,internalProjection:new OpenLayers.Projection(TC.Cfg.crs),externalProjection:new OpenLayers.Projection("EPSG:4326")})})}else if(r.type===TC.Consts.layerType.WFS){var p=function(e){var t,r=[];for(var n in e){var i,a,s,o=e[n];if(o.type){i=o.type;a=o.value;var l=new OpenLayers.Filter.Comparison({type:i,property:n,value:a});if(o.ignoreHyphens){l=[l,new OpenLayers.Filter.Comparison({type:i,property:n,value:a.replace(/-/g,"")})];s=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.OR,filters:l})}else s=l}else{i=OpenLayers.Filter.Comparison.EQUAL_TO;a=o;s=new OpenLayers.Filter.Comparison({type:i,property:n,value:a})}r.push(s)}switch(r.length){case 0:t=null;break;case 1:t=r[0];break;default:t=new OpenLayers.Filter.Logical({type:OpenLayers.Filter.Logical.AND,filters:r})}return t},h={};if(r.properties)for(var d=0;d<r.properties.length;d++){var f=r.properties[d];f.name&&f.type?h[f.name]={value:f.value||"",type:f.type,ignoreHyphens:f.ignoreHyphens}:h[f]=""}c.strategies=[u];c.protocol=new OpenLayers.Protocol.WFS({url:r.url,version:r.version,featureType:r.featureType,geometryName:r.geometryName,featurePrefix:r.namespace,outputFormat:r.outputFormat,srsName:TC.Cfg.crs});c.filter=p(h)}if(r.cluster){$.isArray(c.strategies)||(c.strategies=[]);c.strategies.push(new OpenLayers.Strategy.Cluster({distance:r.cluster.distance}))}t=new OpenLayers.Layer.Vector("Vectors",c);t._wrap=e;this.addCommonEvents(t);t.events.register("beforefeaturesadded",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.BEFOREFEATURESADD,{layer:e.parent}))});t.events.register("featuresadded",null,function(t){for(var r=[],n=[],i=[],a=0;a<t.features.length;a++){var s=t.features[a];s._wrap||(s.geometry instanceof OpenLayers.Geometry.Point?r[r.length]=s:s.geometry instanceof OpenLayers.Geometry.LineString||s.geometry instanceof OpenLayers.Geometry.MultiLineString?n[n.length]=s:(s.geometry instanceof OpenLayers.Geometry.Polygon||s.geometry instanceof OpenLayers.Geometry.MultiPolygon)&&(i[i.length]=s))}var o=[];r.length>0&&o.push(e.parent.addMarkers(r));n.length>0&&o.push(e.parent.addPolylines(n));i.length>0&&o.push(e.parent.addPolygons(i));$.when.apply(e,o).then(function(){var t=[];if(arguments.length)for(var r=0;r<arguments[0].length;r++){var n=t[r]=arguments[0][r];$.isArray(n.wrap.feature.cluster)&&(n.features=$.map(n.wrap.feature.cluster,function(e){return new n.constructor(e)}))}e.parent.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:e.parent,features:t}))})});t.events.register("featureremoved",null,function(t){var r=t.feature;if(r._wrap){var n=$.inArray(r._wrap.parent,e.parent.features);if(n>-1){e.parent.features.splice(n,1);e.parent.map.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{layer:e.parent,feature:r._wrap.parent}))}}});$(e.parent.map);t.events.register("featuresadded",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:e.parent}))});t.events.register("featuresremoved",null,function(){e.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:e.parent}))});if(e.parent.type===TC.Consts.layerType.KML){t.events.register("added",null,function(){u.activate()});if(!e.parent.options.title){var m=function y(){t.protocol.format._documentName&&(e.parent.title=t.protocol.format._documentName);t.events.unregister("loadend",null,y)};t.events.register("loadend",null,m)}}return t};TC.wrap.layer.Vector.prototype.getGetFeatureUrl=function(){return null};TC.wrap.layer.Vector.prototype["import"]=function(e){TC.error("TC.wrap.layer.Vector.prototype.import no est\xe1 soportada con OpenLayers 2")};TC.wrap.layer.Vector.prototype.addFeatures=function(e){$.when(this.getLayer()).then(function(t){t.addFeatures(e)})};TC.wrap.layer.Vector.prototype.getFeatures=function(){var e=this.getLayer();if(e instanceof OpenLayers.Layer){if(e.strategies)for(var t=0;t<e.strategies.length;t++){var r=e.strategies[t];r instanceof OpenLayers.Strategy.Filter&&r.setFilter(r.filter)}return e.features}return[]};TC.wrap.layer.Vector.prototype.getFeatureById=function(e){var t=this.getLayer();if(t instanceof OpenLayers.Layer){if(t.strategies)for(var r=0;r<t.strategies.length;r++){var n=t.strategies[r];n instanceof OpenLayers.Strategy.Filter&&n.setFilter(n.filter)}return t.getFeatureById(e)}return null};TC.wrap.layer.Vector.prototype.removeFeature=function(e){$.when(this.getLayer()).then(function(t){t.removeFeatures([e.wrap.feature])})};TC.wrap.layer.Vector.prototype.clearFeatures=function(){$.when(this.getLayer()).then(function(e){e.removeAllFeatures()})};TC.wrap.layer.Vector.prototype.setFeatureVisibility=function(e,t){var r=this,n=$.inArray(e,r.parent.features);if(n>=0){t?delete e.wrap.feature.style.display:e.wrap.feature.style.display="none";r._redrawTimeout&&clearTimeout(r._redrawTimeout);r._redrawTimeout=setTimeout(function(){$.when(r.getLayer()).then(function(e){e.redraw();r.parent.map.$events.trigger($.Event(TC.Consts.event.VECTORUPDATE,{layer:r.parent}))});delete r._redrawTimeout},100)}};TC.wrap.layer.Vector.prototype.getRGBA=function(e,t){var r=[0,0,0,1];if("string"==typeof e){var n=4===e.length?1:2;r[0]=parseInt(e.substr(1,n),16);r[1]=parseInt(e.substr(1+n,n),16);r[2]=parseInt(e.substr(1+2*n,n),16);if(1===n){r[0]=17*r[0];r[1]=17*r[1];r[2]=17*r[2]}void 0!==t&&(r[3]=t)}return r};TC.wrap.layer.Vector.prototype.findFeature=function(e){var t=this;$.when(t.getLayer()).then(function(t){var r=t.filter;if(r){if(r.filters&&r.filters.length<=e.length)for(var n=0;n<r.filters.length;n++){var i=r.filters[n];if(i.type===OpenLayers.Filter.Logical.OR){i.filters[0].value=e[n];i.filters[1].value=e[n].replace("-","")}else i.value=e[n]}else r.value=e[0];t.removeAllFeatures();t.setVisibility(!0);t.strategies[0].active||t.strategies[0].activate();t.refresh()}})};TC.wrap.layer.Vector.prototype.sendTransaction=function(e,t,r){var n=$.Deferred();TC.error('"sendTransaction" no est\xe1 soportado por la versi\xf3n OpenLayers 2 de la API SITNA');n.reject();return n};TC.wrap.layer.Vector.prototype.setDraggable=function(e,t,r){var n=this;$.when(n.parent.map.wrap.getMap(),n.getLayer()).then(function(i,a){if(e){if(!n._ctl){var s={};$.isFunction(t)&&(s.onComplete=function(e,r){t.call(this,e._wrap.parent,[r.x,r.y])});$.isFunction(r)&&(s.onStart=function(e,t){r.call(this,e._wrap.parent,[t.x,t.y])});n._ctl=new OpenLayers.Control.DragFeature(a,s);i.addControl(n._ctl)}n._ctl.activate()}else n._ctl&&n._ctl.deactivate()})};TC.wrap.control.Click.prototype.register=function(e){var t=this;t._ctl=new OpenLayers.Control;$.when(e.wrap.getMap()).then(function(r){var n=function(e){var n=r.getLonLatFromPixel(e.xy);t.parent.callback([n.lon,n.lat],[e.xy.x,e.xy.y])};t._ctl.handler=new OpenLayers.Handler.Click(this,{click:n},{single:!0,"double":!1,pixelTolerance:e.options.pixelTolerance,stopSingle:!1,stopDouble:!1});r.addControl(t._ctl)})};TC.wrap.control.Click.prototype.activate=function(){var e=this;e._ctl.activate()};TC.wrap.control.Click.prototype.deactivate=function(){var e=this;e._ctl.deactivate()};TC.wrap.control.ScaleBar.prototype.render=function(){var e=this;e.ctl?e.ctl.draw():e.ctl=new OpenLayers.Control.ScaleLine({div:e.parent.div,bottomInUnits:"",bottomOutUnits:""})};TC.wrap.control.NavBar.prototype.register=function(e){var t=this;$.when(e.wrap.getMap()).then(function(e){t.zsCtl=new OpenLayers.Control.PanZoomBar({panIcons:!1,zoomWorldIcon:!0});e.addControl(t.zsCtl);e.events.register("changebaselayer",null,function(){t.zsCtl.moveZoomBar()})})};TC.wrap.control.NavBar.prototype.refresh=function(){};TC.wrap.control.Coordinates.prototype.register=function(e){var t=this,r=new $.Deferred;$.when(e.wrap.getMap()).then(function(n){var i=n.getProjectionObject();null===i&&(i=new OpenLayers.Projection(n.projection));t.parent.crs=i.getCode();t.parent.units=i.getUnits();t.parent.isGeo=e.wrap.isGeo();var a=function(e){var r=n.getLonLatFromPixel(n.events.getMousePosition(e));if(r){t.parent.isGeo?t.parent.latLon=[r.lat,r.lon]:t.parent.xy=[r.lon,r.lat];t.parent.update.apply(t.parent,arguments)}};n.events.register("mousemove",t.parent,a);n.events.register("mouseover",t.parent,a);n.events.register("mouseout",t.parent,function(){t.parent.clear.apply(t.parent,arguments)});r.resolve()});return r};TC.wrap.Parser=function(){};TC.wrap.Parser.prototype.read=function(e){var t=[],r=this;if(r.parser){TC.Feature||TC.syncLoadJS(TC.apiLocation+"TC/Feature");t=$.map(r.parser.read(e),function(e){return new TC.Feature(null,{id:e.fid,data:e.data})})}return t};TC.wrap.parser={WFS:function(e){this.parser=new OpenLayers.Format.GML(e)},JSON:function(e){this.parser=new OpenLayers.Format.GeoJSON(e)}};TC.inherit(TC.wrap.parser.WFS,TC.wrap.Parser);TC.inherit(TC.wrap.parser.JSON,TC.wrap.Parser);TC.wrap.control.Search.prototype.addEvents=function(){var e=this;$.when(e.parent.layer.wrap.getLayer()).then(function(t){var r=e.parent.layer.map,n=r.wrap.isGeo()?r.options.pointBoundsRadius/TC.Util.getMetersPerDegree(r.getExtent()):r.options.pointBoundsRadius;t.events.register("featuresadded",t,function(t){for(var r=t.features[0].geometry.getBounds(),i=1;i<t.features.length;i++)r.extend(t.features[i].geometry.getBounds());if(r.left===r.right){r.left-=n;r.right+=n}if(r.top===r.bottom){r.bottom-=n;r.top+=n}e.parent.layer.map.setExtent(r)})})};TC.wrap.control.OverviewMap.prototype.register=function(e){var t=this,r=function(){var e=new OpenLayers.Size(t.parent._$div.width(),t.parent._$div.height());0===e.w&&(e.w=100);0===e.h&&(e.h=100);return e},n=r();$.when(t.parent.layer.wrap.getLayer()).then(function(i){t.ovMap=new OpenLayers.Control.OverviewMap({div:t.parent.div,size:n,layers:[i],minRatio:24,maxRatio:48,autoPan:!0,theme:OpenLayers.CustomTheme,mapOptions:{projection:e.crs,displayProjection:e.crs,baseLayer:i,maxExtent:e.options.maxExtent,minRatio:24,maxRatio:48,minRectSize:30,theme:OpenLayers.CustomTheme},maximized:!0});var a=$(t.parent.div).find("."+t.parent.CLASS+"-load");i.events.register("loadstart",t.parent.layer,function(){a.removeClass(TC.Consts.classes.HIDDEN).addClass(TC.Consts.classes.VISIBLE)});i.events.register("loadend",t.parent.layer,function(){a.removeClass(TC.Consts.classes.VISIBLE).addClass(TC.Consts.classes.HIDDEN)});$.when(e.wrap.getMap()).then(function(e){e.addControl(t.ovMap);t.parent.isLoaded=!0;t.parent.$events.trigger($.Event(TC.Consts.event.MAPLOAD));e.events.register("updatesize",t.parent,function(){r();if(t.ovMap.ovmap){$ovmap=$(t.ovMap.ovmap.div);$ovmap.css("width",t.parent._$div.css("width")).css("height",t.parent._$div.css("height"));t.ovMap.ovmap.updateSize();t.ovMap.updateRectToMap()}})})})};TC.wrap.control.OverviewMap.prototype.get3DCameraLayer=function(){TC.error("TC.wrap.control.OverviewMap.prototype.get3DCameraLayer no implementado en OpenLayers 2")};TC.wrap.control.OverviewMap.prototype.draw3DCamera=function(e){TC.error("TC.wrap.control.OverviewMap.prototype.draw3DCamera no implementado en OpenLayers 2")};TC.wrap.control.OverviewMap.prototype.enable=function(){var e=this;e.ovMap.activate();e.ovMap.update()};TC.wrap.control.OverviewMap.prototype.disable=function(){this.ovMap.deactivate()};TC.wrap.control.FeatureInfo.prototype.register=function(e){var t=this;t._map=e;$.when(e.wrap.getMap()).then(function(r){TC.wrap.control.Click.prototype.register.call(t,e);for(var n=[],i=function(e){var t=!1;e instanceof TC.layer.Raster&&!e.isBase&&e.wrap.getInfoFormats()&&(t=!0);return t},a=0;a<e.workLayers.length;a++){var s=e.workLayers[a];i(s)&&n.push(s.wrap.layer)}t._gfi=new OpenLayers.Control.WMSGetFeatureInfo({layers:n,autoActivate:!1,drillDown:!0,maxFeatures:1e3,queryVisible:!0,output:"object",formatOptions:{internalProjection:r.projection}});e.options.pixelTolerance&&(t._gfi.vendorParams={radius:e.options.pixelTolerance,buffer:e.options.pixelTolerance});r.addControl(t._gfi);e.on(TC.Consts.event.LAYERADD,function(e){i(e.layer)&&t._gfi.layers.push(e.layer.wrap.layer)}).on(TC.Consts.event.LAYERREMOVE,function(e){var r=$.inArray(e.layer.wrap.layer,t._gfi.layers);r>=0&&t._gfi.layers.splice(r,1)});var o={};t._gfi.events.register("beforegetfeatureinfo",t.parent,function(r){for(var n=0;n<r.object.layers.length;n++)for(var i=0;i<e.workLayers.length;i++)e.workLayers[i].wrap.layer===r.object.layers[n]&&(o[r.object.layers[n].url]=e.workLayers[i]);e.$events.trigger($.Event(TC.Consts.event.BEFOREFEATUREINFO,{xy:[r.xy.x,r.xy.y],control:t.parent}))});t._gfi.events.register("getfeatureinfo",t.parent,function(r){for(var n,i=0,a=[],s=[],l=[],c=0;c<r.features.length;c++){var u=r.features[c];n={layers:[],text:r.text};var p=o[u.url];if(p){n.mapLayer=p;delete o[u.url]}for(var h=0;h<u.features.length;h++){for(var d=u.features[h],f=d.fid?d.fid.substr(0,d.fid.lastIndexOf(".")):d.type||"",m=n.mapLayer?n.mapLayer.wrap.getInfo(f).title||f:"[Sin t\xedtulo]",y=null,g=0;g<n.layers.length;g++)if(n.layers[g].name===f){y=n.layers[g];break}if(!y){y={name:f,title:m,features:[]};n.layers.push(y)}a.push(TC.wrap.Feature.createFeature(d));s.push(y.features);i+=1}if(!u.features.length){contentType=r.request.getResponseHeader("Content-Type");if(0===contentType.indexOf("text/")){y={name:f,title:m,features:[]};n.layers.push(y);y.features.push({rawUrl:r.request._object.responseURL,rawContent:r.text});i+=1}}l.push(n)}$.when.apply(this,a).then(function(){if(arguments.length)for(var n=0;n<arguments.length;n++){var a=arguments[n];a.attributes=[];for(var o in a.data)a.attributes.push({name:o,value:a.data[o]});s[n].push(a)}e.$events.trigger($.Event(TC.Consts.event.FEATUREINFO,{xy:[r.xy.x,r.xy.y],services:l,featureCount:i,control:t.parent}))})});t._gfi.events.register("exception",t.parent,function(r){e.$events.trigger($.Event(TC.Consts.event.FEATUREINFOERROR,{xy:[r.xy.x,r.xy.y],control:t.parent,layer:r.layer._wrap.parent}))})})};TC.wrap.control.FeatureInfo.prototype.getFeatureInfo=function(e){var t=this;t._map&&t._gfi.layers.length>0&&t._gfi.getInfoForClick({xy:{x:e[0],y:e[1]}})};TC.wrap.control.Popup.prototype=function(){this.popup=null};TC.wrap.control.Popup.prototype.fitToView=function(){var e=this;setTimeout(function(){e.popup.updateSize()},100)};TC.wrap.control.Popup.prototype.setDragged=function(e){};

TC.wrap.Feature.prototype.getLegend=function(){var e=this,t={},r=e.feature.style;if(r.externalGraphic){t.src=r.externalGraphic;t.width=r.graphicWidth;t.height=r.graphicHeight}else{r.strokeColor&&(t.strokeColor=r.strokeColor);r.strokeWidth&&(t.strokeWidth=r.strokeWidth);r.fillColor&&(t.fillColor=r.fillColor);r.pointRadius&&(t.height=t.width=2*r.pointRadius)}return t};TC.wrap.Feature.prototype.createPoint=function(e,t){var r=this;if($.isArray(e)){var n={pointRadius:t.radius||(t.height+t.width)/4};if(t.fillColor){n.fillColor=t.fillColor;n.fillOpacity=t.fillOpacity}else n.fill=!1;if(t.strokeColor){n.strokeColor=t.strokeColor;n.strokeWidth=t.strokeWidth}else n.stroke=!1;r.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]),null,n)}else if(r.isNative(e)){r.feature=e;r.parent.geometry=[e.geometry.x,e.geometry.y];if(e.style){r.parent.options.radius=e.style.pointRadius;r.parent.options.fillColor=e.style.fillColor;r.parent.options.fillOpacity=e.style.fillOpacity;r.parent.options.strokeColor=e.style.strokeColor}}t&&t.id&&(r.feature.id=t.id);r.feature._wrap=r};TC.wrap.Feature.prototype.createMarker=function(e,t){var r=this,n=TC.Util.getPointIconUrl(t);if(n){if($.isArray(e)){var i={externalGraphic:TC.Util.getPointIconUrl(t),graphicWidth:t.width,graphicHeight:t.height,graphicXOffset:-Math.round(t.anchor[0]*t.width),graphicYOffset:-Math.round(t.anchor[1]*t.height)};r.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Point(e[0],e[1]),null,i)}else if(r.isNative(e)){r.feature=e;r.parent.geometry=[e.geometry.x,e.geometry.y];if(e.style){r.parent.options.url=e.style.externalGraphic;r.parent.options.width=e.style.graphicWidth;r.parent.options.height=e.style.graphicHeight;r.parent.options.anchor=[-e.style.graphicXOffset/e.style.graphicWidth,-e.style.graphicYOffset/e.style.graphicHeight]}}t&&t.id&&(r.feature.id=t.id);r.feature._wrap=r}else r.createPoint(e,t)};TC.wrap.Feature.prototype.createPolyline=function(e,t){var r=this;if($.isArray(e)){var n=$.map(e,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])});r.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.LineString(n),null,{stroke:!0,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth})}else if(r.isNative(e)){r.feature=e;for(var i=r.parent.geometry=e.geometry.getVertices(),a=0;a<i.length;a++)i[a]=[i[a].x,i[a].y];if(e.style){r.parent.options.strokeColor=e.style.strokeColor;r.parent.options.strokeWidth=e.style.strokeWidth}}r.feature._wrap=r};TC.wrap.Feature.prototype.createPolygon=function(e,t){var r=this;if($.isArray(e)){var n,i=function(e){return new OpenLayers.Geometry.LinearRing($.map(e,function(e){return new OpenLayers.Geometry.Point(e[0],e[1])}))};if(e.length>0&&$.isArray(e[0])&&e[0].length>0&&$.isArray(e[0][0])){n=new Array(e.length);for(var a=0,s=e.length;s>a;a++)n[a]=i(e[a])}else n=[i(e)];r.feature=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(n),null,{stroke:!0,strokeColor:t.strokeColor,strokeWidth:t.strokeWidth,fillColor:t.fillColor,fillOpacity:t.fillOpacity})}else if(r.isNative(e)){r.feature=e;if(e.geometry)for(var o=r.parent.geometry=e.geometry.getVertices(),a=0;a<o.length;a++)o[a]=[o[a].x,o[a].y];if(e.style){r.parent.options.strokeColor=e.style.strokeColor;r.parent.options.strokeWidth=e.style.strokeWidth;r.parent.options.fillColor=e.style.fillColor;r.parent.options.fillOpacity=e.style.fillOpacity}}r.feature._wrap=r};TC.wrap.Feature.prototype.createCircle=function(e,t){};TC.wrap.Feature.createFeature=function(e){var t=new $.Deferred,r={id:e.fid,data:e.attributes};e.geometry instanceof OpenLayers.Geometry.Point?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){t.resolve(new TC.feature.Point(e,r))}):e.geometry instanceof OpenLayers.Geometry.LineString?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Polyline,[TC.apiLocation+"TC/feature/Polyline"],function(){t.resolve(new TC.feature.Polyline(e,r))}):e.geometry instanceof OpenLayers.Geometry.MultiLineString?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.MultiPolyline,[TC.apiLocation+"TC/feature/MultiPolyline"],function(){t.resolve(new TC.feature.MultiPolyline(e,r))}):e.geometry instanceof OpenLayers.Geometry.Polygon?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Polygon,[TC.apiLocation+"TC/feature/Polygon"],function(){t.resolve(new TC.feature.Polygon(e,r))}):e.geometry instanceof OpenLayers.Geometry.MultiPolygon?TC.loadJS(!TC.feature||TC.feature&&!TC.feature.MultiPolygon,[TC.apiLocation+"TC/feature/MultiPolygon"],function(){t.resolve(new TC.feature.MultiPolygon(e,r))}):TC.loadJS(!TC.Feature,[TC.apiLocation+"TC/Feature"],function(){t.resolve(new TC.Feature(e,r))});return t};TC.wrap.Feature.prototype.cloneFeature=function(){var e=this;return new e.feature.constructor(e.feature.geometry.clone(),e.feature.attributes,e.feature.style)};TC.wrap.Feature.prototype.getStyle=function(){var e=this.feature.style,t={};if(e.fillColor){t.fillColor=e.fillColor;t.fillOpacity=e.fillOpacity}if(e.strokeColor){t.strokeColor=e.strokeColor;t.strokeWidth=e.strokeWidth}if(e.externalGraphic){t.url=e.externalGraphic;t.anchor=[e.graphicXOffset/e.graphicWidth,e.graphicYOffset/e.graphicHeight]}if(e.label){t.label=e.label;t.labelOffset=[e.labelXOffset,e.labelYOffset];t.fontColor=e.fontColor;t.labelOutlineColor=e.labelOutlineColor;t.labelOutlineWidth=e.labelOutlineWidth;t.fontSize=e.fontSize}return t};TC.wrap.Feature.prototype.getGeometry=function(){var e,t=this;if(t.feature&&t.feature.geometry){var r=function(e){return[e.x,e.y]},n=function(e){for(var t=e.getVertices(),n=0,i=t.length;i>n;n++)t[n]=r(t[n]);return t},i=function(e){for(var t=new Array(e.components.length),r=0,i=e.components.length;i>r;r++)t[r]=n(e.components[r]);return t},a=t.feature.geometry;a instanceof OpenLayers.Geometry.Point?e=r(a):a instanceof OpenLayers.Geometry.LineString?e=n(a):a instanceof OpenLayers.Geometry.MultiLineString?e=n(a.components[0]):a instanceof OpenLayers.Geometry.Polygon?e=i(a):a instanceof OpenLayers.Geometry.MultiPolygon&&(e=i(a.components[0]))}return e};TC.wrap.Feature.prototype.setGeometry=function(e){var t=!1,r=this;if(r.feature&&r.feature.geometry){var n=r.feature.geometry;if(n instanceof OpenLayers.Geometry.Point&&$.isArray(e)&&"number"==typeof e[0]&&"number"==typeof e[1]){n.move(e[0]-n.x,e[1]-n.y);t=!0}}return t};TC.wrap.Feature.prototype.getId=function(){var e,t=this;t.feature&&(e=t.feature.fid);return e};TC.wrap.Feature.prototype.setId=function(e){var t=this;t.feature&&(t.feature.fid=e)};TC.wrap.Feature.prototype.setStyle=function(e){var t=this,r=t.feature.style||new OpenLayers.Style;e instanceof OpenLayers.Style||(e=new OpenLayers.Style(e));var e=e.createLiterals(OpenLayers.Util.extend({},e.defaultStyle),t.feature);if(t.feature.geometry instanceof OpenLayers.Geometry.Point){r.externalGraphic=e.url;r.graphicWidth=e.width;r.graphicHeight=e.height;e.anchor&&e.width&&(r.graphicXOffset=-Math.round(e.anchor[0]*e.width));e.anchor&&e.height&&(r.graphicYOffset=-Math.round(e.anchor[1]*e.height));r.graphic=e.graphic;e.label&&(r.label=e.label.toCamelCase());e.angle&&(r.angle=e.angle);r.fontColor=e.fontColor;r.labelOutlineColor=e.labelOutlineColor;r.labelOutlineWidth=e.labelOutlineWidth}else if(t.feature.geometry.components&&t.feature.geometry.components instanceof Array&&t.feature.geometry.components[0].CLASS_NAME==(new OpenLayers.Geometry.LineString).CLASS_NAME||!t.feature.geometry.components&&t.feature.geometry instanceof new OpenLayers.Geometry.LineString){r.stroke=!0;r.strokeColor=e.strokeColor;r.strokeWidth=e.strokeWidth}else if(t.feature.geometry.components&&t.feature.geometry.components instanceof Array&&t.feature.geometry.components[0].CLASS_NAME==(new OpenLayers.Geometry.Polygon).CLASS_NAME||!t.feature.geometry.components&&t.feature.geometry instanceof new OpenLayers.Geometry.Polygon){r.stroke=!0;r.strokeColor=e.strokeColor;r.strokeWidth=e.strokeWidth;r.fillColor=e.fillColor;r.fillOpacity=e.fillOpacity}t.feature.layer&&t.feature.layer.drawFeature(t.feature,r)};TC.wrap.Feature.prototype.getInnerPoint=function(e){var t=this.feature,r=t.geometry.getCentroid(!0);if(!result.intersects(t.geometry)){var n=t.geometry.distanceTo(result,{details:!0});r=new OpenLayers.Geometry.Point(n.x0,n.y0)}return[r.x,r.y]};TC.wrap.Feature.prototype.showPopup=function(e){{var t=this;t.feature}Modernizr.canvas&&-1===OpenLayers.Popup.Anchored.prototype.displayClass.indexOf(TC.control.Popup.prototype.CLASS)&&(OpenLayers.Popup.Anchored.prototype.displayClass=OpenLayers.Popup.Anchored.prototype.displayClass+" "+TC.control.Popup.prototype.CLASS+" "+TC.Consts.classes.VISIBLE);var r=Modernizr.canvas?OpenLayers.Popup.Anchored:OpenLayers.Popup.FramedCloud;t._innerCentroid||(t._innerCentroid=t.getInnerPoint());e.currentFeature=t.parent;var n=e.map;n&&$.when(n.wrap.getMap()).then(function(i){if(n.popup){i.removePopup(n.popup.wrap.popup);n.popup.wrap.popup.destroy();delete n.popup.wrap.popup;n.popup=null}var a=t.parent.getInfo();if(a){var s=t.parent.options,o=null;Modernizr.canvas&&s.anchor&&s.height&&(o={size:new OpenLayers.Size(0,s.height),offset:new OpenLayers.Pixel(0,-s.height*s.anchor[1])});var l=new r(null,new OpenLayers.LonLat(t._innerCentroid[0],t._innerCentroid[1]),null,a,o,e.options.closeButton,function(t){this.hide();OpenLayers.Event.stop(t);n.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:e}))});l.autoSize=!0;l.panMapIfOutOfView=!0;l.keepInMap=!0;l.maxSize=new OpenLayers.Size(i.size.w/2,i.size.h/2);e.$popupDiv=$(l.div);e.wrap.popup=l;n.popup=e;i.addPopup(l);if(Modernizr.canvas){e.$popupDiv.css("overflow","").css("border","").css("width","").css("height","");var c=$(l.contentDiv).css("position","");l.updateSize();c.css("width","");var u=$(l.groupDiv).find(".olPopupCloseBox").attr("style","").addClass(e.CLASS+"-close").attr("title",e.getLocaleString("close"));u.length&&c.css("margin-right",u.width())}}})};TC.wrap.Feature.prototype.isNative=function(e){return e instanceof OpenLayers.Feature};TC.wrap.Feature.prototype.getPath=function(){var e=[],t=this;t.feature&&t.feature._folders&&(e=t.feature._folders);return e};TC.wrap.Feature.prototype.getBounds=function(){var e=null,t=this;if(t.feature&&t.feature.geometry){var r=t.feature.geometry.getBounds();e=[r.left,r.bottom,r.right,r.top]}return e};TC.wrap.Feature.prototype.getTemplate=function(){var e=null,t=this;if(t.feature.style){e=t.feature.style.balloonStyle;e&&(e=e.replace(/\$\{(\w+)\}/g,"$$[$1]"))}return e};TC.wrap.Feature.prototype.getData=function(){var e=$.extend({},this.feature.attributes);for(var t in e)e[t].value&&(e[t]=e[t].value);return e};TC.wrap.control.Draw.prototype.activate=function(e){var t=this,r=e===TC.Consts.geom.POLYGON?OpenLayers.Handler.Polygon:OpenLayers.Handler.Path;t.parent.map&&$.when(t.parent.map.wrap.getMap()).then(function(n){if(t.control){t.control.deactivate();n.removeControl(t.control)}if(e){var i=function(e){var r="measurepartial"===e.type?TC.Consts.event.MEASUREPARTIAL:TC.Consts.event.MEASURE,n={units:e.units};if(1===e.order)n.length=e.measure;else if(2===e.order){n.area=e.measure;n.perimeter=t.control.getLength(e.geometry,e.units)}t.parent.$events.trigger(t.parent.measure?$.Event(r,n):$.Event(TC.Consts.event.DRAWEND,{geometry:new TC.feature.Polygon(e.geometry.components)}))};t.control=new OpenLayers.Control.Measure(r,{geodesic:!0,persist:!0,immediate:!0});t.control.handler.callbacks.point=function(e){t.parent.$events.trigger($.Event(TC.Consts.event.POINT,{point:[e.x,e.y]}))};t.control.events.on(t.parent.measure?{measure:i,measurepartial:i}:{measure:i});n.addControl(t.control);t.control.activate()}})};TC.wrap.control.Draw.prototype.deactivate=function(){var e=this;e.control&&e.control.deactivate()};TC.wrap.control.Draw.prototype.undo=function(){var e=this,t=!1;e.control&&e.control.handler&&(t=e.control.handler.undo());return t};TC.wrap.control.Draw.prototype.redo=function(){var e=this,t=!1;e.control&&e.control.handler&&(t=e.control.handler.redo());return t};TC.wrap.control.Draw.prototype.end=function(){var e=this;if(e.control&&e.control.handler){e.control.handler.finishGeometry();e.control.handler.layer&&e.control.handler.layer.redraw()}};TC.wrap.control.CacheBuilder.prototype.getRequestSchema=function(e){return{}};TC.wrap.control.CacheBuilder.prototype.getGetTilePattern=function(e){return""}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Attribution=function(){var e=this;TC.Control.apply(e,arguments);e.apiAttribution="";e.mainDataAttribution="";e.dataAttributions=e.options.dataAttributions&&e.options.dataAttributions instanceof Array?e.options.dataAttributions:[e.options.dataAttributions]||[]};TC.inherit(TC.control.Attribution,TC.Control);!function(){var e=TC.control.Attribution.prototype;e.CLASS="tc-ctl-attrib";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Attribution.html":function(){function t(e,t){return e.w("<div><span>&copy; ").f(t.get(["api"],!1),t,"h",["s"]).w("</span> - ").h("i18n",t,{},{$key:"data"}).w(": <span>").f(t.get(["mainData"],!1),t,"h",["s"]).w("</span>").x(t.get(["otherData"],!1),t,{block:r},{}).w('<div class="tc-ctl-attrib-other tc-collapsed">').s(t.get(["otherData"],!1),t,{block:n},{}).w("</div></div>")}function r(e,t){return e.w(' - <span class="tc-ctl-attrib-cmd">').h("i18n",t,{},{$key:"others"}).w("...</span>")}function n(e,t){return e.w("<span>").f(t.getPath(!1,["otherData",t.get(["$idx"],!1)]),t,"h",["s"]).w("</span>").h("sep",t,{block:i},{})}function i(e,t){return e.w(", ")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.apiAttribution=t.map.options.attribution||t.apiAttribution;var r=function(e){if(e){var r=$("<div/>").html($.trim(e.wrap.getAttribution(TC.capabilities[e.url]))).text();if(r)if(/IDENA/.test(r))t.mainDataAttribution='<a href="http://idena.navarra.es/" target="_blank">IDENA</a>';else{for(var n=!1,i=0;i<t.dataAttributions.length;i++)if(r===t.dataAttributions[i]){n=!0;break}n||t.dataAttributions.push(r)}}},n=function(e){if(e){var r=function(){if(e.map.workLayers.length>0){for(var t=e.map.workLayers.slice().reverse(),r=0;r<t.length;r++)if(t[r].url==e.url&&t[r].getVisibility())return!1;return!0}return!0};if(r()){var n=$("<div/>").html($.trim(e.wrap.getAttribution(TC.capabilities[e.url]))).text();if(n){var i=t.dataAttributions.indexOf(n);i>-1&&t.dataAttributions.splice(i,1)}}}};t.render();e.on(TC.Consts.event.LAYERADD,function(e){if(e.layer.wrap.getAttribution){r(e.layer);t.render()}});e.on(TC.Consts.event.LAYERREMOVE,function(e){if(e.layer.wrap.getAttribution){n(e.layer);t.render()}});e.on(TC.Consts.event.LAYERVISIBILITY,function(e){if(e.layer.wrap.getAttribution){e.layer.getVisibility()?r(e.layer):n(e.layer);t.render()}})};e.render=function(e){var t=this;t.renderData({api:t.apiAttribution,mainData:t.mainDataAttribution,otherData:t.dataAttributions},function(){t._$div.find("."+t.CLASS+"-cmd").on(TC.Consts.event.CLICK,function(){t._$div.find("."+t.CLASS+"-other").toggleClass(TC.Consts.classes.COLLAPSED)});$.isFunction(e)&&e()})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.BasemapSelector=function(){var e=this;TC.control.MapContents.apply(e,arguments)};TC.inherit(TC.control.BasemapSelector,TC.control.MapContents);!function(){var e=TC.control.BasemapSelector.prototype;e.CLASS="tc-ctl-bms";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/BasemapSelector.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/BasemapSelectorNode.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"backgroundMaps"}).w('</h2><div class="tc-ctl-bms-tree"><form><ul class="tc-ctl-bms-branch">').s(t.get(["baseLayers"],!1),t,{block:r},{}).w("</ul></form></div>")}function r(e,t){return e.p("tc-ctl-bms-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){function t(e,t){return e.w('<li class="tc-ctl-bms-node" data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><label').x(t.get(["legend"],!1),t,{block:r},{}).w('><input type="radio" name="bms" value="').f(t.get(["name"],!1),t,"h").w('" /><span>').f(t.get(["title"],!1),t,"h").w("</span></label></li>")}function r(e,t){return e.w(' style="background-size: 100% 100%; background-image: url(').f(t.getPath(!1,["legend","src"]),t,"h").w(')"')}dust.register(e.CLASS+"-node",t);t.__dustBody=!0;r.__dustBody=!0;return t}}e.register=function(e){var t=this;TC.control.MapContents.prototype.register.call(t,e);e.on(TC.Consts.event.BASELAYERCHANGE,function(){t.update()});t._$div.on("change","input[type=radio]",function(e){var r=$(e.target);if(!Modernizr.canvas){t._$div.find("label > span").removeClass(TC.Consts.classes.CHECKED);r.next().addClass(TC.Consts.classes.CHECKED)}var n=r.closest("li").data("layer");n!=n.map.getBaseLayer()&&n.map.setBaseLayer(n);e.stopPropagation()})};e.update=function(){var e=this;e._$div.find("ul."+e.CLASS+"-branch").children("li").each(function(t,r){var n=$(r),i=n.data("layer"),a=n.find("input[type=radio]").first(),s=e.map.baseLayer===i;a.prop("checked",s);Modernizr.canvas||a.next().toggleClass(TC.Consts.classes.CHECKED,s)});e.updateScale()};e.updateLayerTree=function(e){var t=this;if(e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(t,e);var r=t.CLASS+"-node";TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r,t.layerTrees[e.id],function(r,n){var i=$(n),a=i.data("tcLayerUid"),s=t._$div.find("."+t.CLASS+"-branch"),o=s.find('li[data-tc-layer-uid="'+a+'"]');if(1===o.length)o.html(i.html());else{i.data("layer",e);s.append(i)}r&&TC.error(r)});t.update()})}};e.updateLayerOrder=function(e,t,r){};e.removeLayer=function(e){var t=this;if(e.isBase){var r=t._$div.find("."+t.CLASS+"-branch").children("li");r.each(function(t,r){var n=$(r);if(n.data("layer")===e){n.remove();return!1}})}}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");!function(){TC.Consts.classes.CONNECTION_OFFLINE=TC.Consts.classes.CONNECTION_OFFLINE||"tc-conn-offline";TC.Consts.classes.CONNECTION_WIFI=TC.Consts.classes.CONNECTION_WIFI||"tc-conn-wifi";TC.Consts.classes.CONNECTION_MOBILE=TC.Consts.classes.CONNECTION_MOBILE||"tc-conn-mobile";TC.Consts.classes.OFFLINE=TC.Consts.classes.OFFLINE||"tc-offline";var e="already_exists",t=window.applicationCache;TC._appCacheBuilders||(TC._appCacheBuilders=[]);TC._appCacheUpdater||(TC._appCacheUpdater=function(t,r){for(var n=(TC.Util.getQueryStringParams(r),0),i=TC._appCacheBuilders.length;i>n;n++){var a=TC._appCacheBuilders[n];switch(t.type){case"cached":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEDOWNLOAD,{url:r}));break;case"obsolete":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEDELETE,{url:r}));break;case"checking":break;case"progress":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEPROGRESS,{url:r,loaded:t.loaded,total:t.total}));break;case"error":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEERROR,{url:r,reason:t.reason,status:t.status}));break;case"noupdate":case"updateready":a.$events.trigger($.Event(TC.Consts.event.MAPCACHEERROR,{url:r,reason:e,status:t.status}))}}});var r,n=function(){var e=window.parent!==window&&document.referrer&&TC.Util.isSameOrigin(document.referrer)&&parent.TC&&parent.TC._appCacheUpdater;return function(t){e&&parent.TC._appCacheUpdater(t,location.href)}}(),i=function(){var e=$.Deferred();if(r&&r.length)e.resolve(r);else{var t=$("html").attr("manifest");t?$.ajax({url:t,type:"GET",dataType:"text"}).done(function(t){var r=t.indexOf("NETWORK:");r>=0&&(t=t.substr(0,r));r=t.indexOf("FALLBACK:");r>=0&&(t=t.substr(0,r));r=t.indexOf("SETTINGS:");r>=0&&(t=t.substr(0,r));var n=$.grep(t.split(/[\n\r]/),function(e){return e.length>0&&0!==e.indexOf("#")&&"CACHE:"!==e});n.shift();e.resolve(n)}).fail(function(){e.reject()}):e.reject()}return e};t.addEventListener("cached",n,!1);t.addEventListener("error",n,!1);t.addEventListener("noupdate",n,!1);t.addEventListener("obsolete",n,!1);t.addEventListener("progress",n,!1);t.addEventListener("updateready",n,!1);TC.control.CacheBuilder=function(){var e=this;TC.control.SWCacheClient.apply(this,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={DRAW:t+"-draw",DRAWING:t+"-drawing",PROGRESS:t+"-progress",NEW:t+"-new",LIST:t+"-list",LISTITEM:t+"-list > li",DELBTN:t+"-btn-del",OKBTN:t+"-btn-ok",NEWBTN:t+"-btn-new",SAVEBTN:".tc-btn-save",CANCELBTN:".tc-btn-cancel",EDITBTN:".tc-btn-edit",VIEWBTN:".tc-btn-view",DELETEBTN:".tc-btn-delete",TILECOUNT:t+"-tile-count",NAMETB:t+"-txt-name",TEXTBOX:"input.tc-textbox",EXIT:t+"-link-exit",OFFPANEL:t+"-off-panel",BLLIST:t+"-bl-list",BLLISTITEM:t+"-bl-list > li",BLLISTTEXT:t+"-bl-panel-txt",RNGMAXRES:t+"-rng-maxres",SEARCH:t+"-map-available-srch",EMPTYLIST:t+"-map-available-empty",OFFLINEHIDDEN:"[data-no-cb]"};e.storedMaps=[];TC._appCacheBuilders.push(e);try{if(window.localStorage){for(var r=0,n=localStorage.length;n>r;r++){var i=localStorage.key(r);if(0===i.indexOf(e.LOCAL_STORAGE_KEY_PREFIX)){var a=localStorage.getItem(i).split(" "),o=s(a.shift()),l=a.join(" "),c={name:l,extent:o,url:decodeURIComponent(i.substr(e.LOCAL_STORAGE_KEY_PREFIX.length))};e.storedMaps.push(c)}}e.storedMaps.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0})}}catch(u){TC.error(e.getLocaleString("couldNotAccessLocalStorage"))}var p=$.extend({},n>1?arguments[1]:arguments[0]);e._$dialogDiv=$(TC.Util.getDiv(p.dialogDiv));p.dialogDiv||e._$dialogDiv.appendTo("body");e.mapIsOffline=location.pathname.indexOf("/"+e.CACHE_REQUEST_PATH)===location.pathname.length-e.CACHE_REQUEST_PATH.length-1;e.mapIsOffline&&$(e._selectors.OFFLINEHIDDEN).addClass(TC.Consts.classes.HIDDEN);TC.Control.apply(e,arguments);e.wrap=new TC.wrap.control.CacheBuilder(e);e.isDownloading=!1;e.baseLayers=[];e.options.avgTileSize=e.options.avgTileSize||TC.Cfg.avgTileSize;e.requestSchemas=[];e.minResolution=0;e.currentMap=null;e._loadedCount=0;var h=history.pushState;history.pushState=function(t){var r;r=h.apply(history,arguments);if(e._$offlinePanelDiv){var n=location.pathname.replace("/"+e.CACHE_REQUEST_PATH,"/"),i=TC.Util.getQueryStringParams();delete i[e.MAP_DEFINITION_PARAM_NAME];delete i[e.MAP_EXTENT_PARAM_NAME];delete i[e.SERVICE_WORKER_FLAG];var a=$.param(i);a.length&&(a="?"+a);var s=n+a+location.hash;e._$offlinePanelDiv.find(e._selectors.EXIT).attr("href",s)}return r};var d=navigator.connection||navigator.mozConnection||navigator.webkitConnection||{},f=function(){if(e._$offlinePanelDiv){var t=e._$offlinePanelDiv.find(e._selectors.OFFPANEL);t.removeClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI);var r=d.type;switch(r){case 1:case 2:case void 0:t.addClass(TC.Consts.classes.CONNECTION_WIFI);break;default:t.addClass(TC.Consts.classes.CONNECTION_MOBILE)}}};d.addEventListener&&d.addEventListener("typechange",f);window.addEventListener("online",f);window.addEventListener("offline",function(){e._$offlinePanelDiv&&e._$offlinePanelDiv.find(e._selectors.OFFPANEL).addClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI)})};TC.inherit(TC.control.CacheBuilder,TC.control.SWCacheClient);var a=TC.control.CacheBuilder.prototype;a.CLASS="tc-ctl-cbuild";a.MAP_DEFINITION_PARAM_NAME="map-def";a.MAP_EXTENT_PARAM_NAME="map-extent";a.LOCAL_STORAGE_KEY_PREFIX="TC.offline.map.";a.COOKIE_KEY_PREFIX="TC.offline.map.";a.CACHE_REQUEST_PATH="offline";a.SERVICE_WORKER_FLAG="sw";a._states={READY:"ready",EDIT:"editing",DOWNLOADING:"downloading",DELETING:"deleting"};a._actions={CREATE:"create",DELETE:"delete"};a.offlineControls=["attribution","basemapSelector","cacheBuilder","click","coordinates","draw","edit","geolocation","loadingIndicator","measure","navBar","popup","print","scale","scaleBar","scaleSelector","state","fullScreen"];TC.Consts.event.MAPCACHEDOWNLOAD=TC.Consts.event.MAPCACHEDOWNLOAD||"mapcachedownload.tc";TC.Consts.event.MAPCACHEDELETE=TC.Consts.event.MAPCACHEDELETE||"mapcachedelete.tc";TC.Consts.event.MAPCACHEPROGRESS=TC.Consts.event.MAPCACHEPROGRESS||"mapcacheprogress.tc";TC.Consts.event.MAPCACHEERROR=TC.Consts.event.MAPCACHEERROR||"mapcacheerror.tc";a.template={};if(TC.isDebug){a.template[a.CLASS]=TC.apiLocation+"TC/templates/CacheBuilder.html";a.template[a.CLASS+"-map-node"]=TC.apiLocation+"TC/templates/CacheBuilderMapNode.html";a.template[a.CLASS+"-bl-node"]=TC.apiLocation+"TC/templates/CacheBuilderBaseLayerNode.html";a.template[a.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/CacheBuilderDialog.html";a.template[a.CLASS+"-off-panel"]=TC.apiLocation+"TC/templates/CacheBuilderOfflinePanel.html"}else{a.template[a.CLASS]=function(){function e(e,a){return e.w("<h2>").h("i18n",a,{},{$key:"offlineMaps"}).w('</h2><div class="tc-ctl-cbuild-content"><div class="tc-ctl-cbuild-draw tc-hidden"></div><i class="tc-ctl-cbuild-map-search-icon"></i><input type="search" list="').f(a.get(["listId"],!1),a,"h").w('" class="tc-ctl-cbuild-map-available-srch tc-textbox" placeholder="').h("i18n",a,{},{$key:"cb.filter.plhr"}).w('"').x(a.get(["storedMaps"],!1),a,{"else":t,block:r},{}).w(' maxlength="200" /> <ul id="').f(a.get(["listId"],!1),a,"h").w('" class="tc-ctl-cbuild-list"><li class="tc-ctl-cbuild-map-available-empty"').x(a.get(["storedMaps"],!1),a,{block:n},{}).w("><span>").h("i18n",a,{},{$key:"cb.noMaps"}).w('</span></li><li class="tc-ctl-cbuild-map-not" hidden><span>').h("i18n",a,{},{$key:"noMatches"}).w("</span></li>").s(a.get(["storedMaps"],!1),a,{block:i},{}).w('</ul><div class="tc-ctl-cbuild-new"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-new" disabled title="').h("i18n",a,{},{$key:"newofflinemap"}).w('">').h("i18n",a,{},{$key:"newOfflineMap"}).w('</button></div><div class="tc-ctl-cbuild-drawing tc-hidden"><div class="tc-ctl-cbuild-tile-cmd"><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-draw" title="').h("i18n",a,{},{$key:"cancel"}).w('">').h("i18n",a,{},{$key:"cancel"}).w('</button></div></div><div class="tc-ctl-cbuild-progress tc-hidden"><p>').h("i18n",a,{},{$key:"cb.DownloadingMap|s"}).w(': <span class="tc-ctl-cbuild-progress-count"></span></p><div class="tc-ctl-cbuild-progress-bar"><div class="tc-ctl-cbuild-progress-ratio" style="width:0"></div></div><button class="tc-button tc-icon-button tc-ctl-cbuild-btn-cancel-dl" title="').h("i18n",a,{},{$key:"cancel"}).w('">').h("i18n",a,{},{$key:"cancel"}).w("</button></div></div>")}function t(e,t){return e.w(" disabled")}function r(e,t){return e}function n(e,t){return e.w(" hidden")}function i(e,t){return e.p("tc-ctl-cbuild-map-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(a.CLASS,e);e.__dustBody=!0;t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;return e};a.template[a.CLASS+"-map-node"]=function(){function e(e,t){return e.w('<li data-extent="').f(t.get(["extent"],!1),t,"h").w('"><span><a href="').f(t.get(["url"],!1),t,"h").w('" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</a></span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /><button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"cancel"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"editMapName"}).w('">').h("i18n",t,{},{$key:"editMapName"}).w('</button><button class="tc-btn-view" title="').h("i18n",t,{},{$key:"viewMapExtent"}).w('">').h("i18n",t,{},{$key:"viewMapExtent"}).w('</button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"deleteMap"}).w('">').h("i18n",t,{},{$key:"deleteMap"}).w("</button></li>")}dust.register(a.CLASS+"-map-node",e);e.__dustBody=!0;return e};a.template[a.CLASS+"-bl-node"]=function(){function e(e,t){return e.w('<li class="tc-ctl-cbuild-bl-node" data-tc-layer-uid="').f(t.get(["id"],!1),t,"h").w('"><label style="background-size: 100% 100%; background-image: url(').f(t.get(["thumbnail"],!1),t,"h").w(')"><input type="checkbox" name="cbbl" value="').f(t.get(["id"],!1),t,"h").w('" disabled><span>').f(t.get(["title"],!1),t,"h").w("</span></label></li>")}dust.register(a.CLASS+"-bl-node",e);e.__dustBody=!0;return e};a.template[a.CLASS+"-dialog"]=function(){function e(e,t){return e.w('<div class="tc-ctl-cbuild-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"newOfflineMap"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><input type="text" class="tc-ctl-cbuild-txt-name" placeholder="').h("i18n",t,{},{$key:"nameRequired"}).w('" required /><div class="tc-ctl-cbuild-bl-panel"><h4>').h("i18n",t,{},{$key:"availableOfflineMaps"}).w("</h4><p>").h("i18n",t,{},{$key:"selectAtLeastOne"}).w(':</p><ul class="tc-ctl-cbuild-bl-list"></ul></div><div class="tc-ctl-cbuild-res-panel"><h4>').h("i18n",t,{},{$key:"maxRes"}).w('</h4><div class="tc-ctl-cbuild-res"></div><input type="range" class="tc-ctl-cbuild-rng-maxres" disabled value="0" title="').h("i18n",t,{},{$key:"maxRes"}).w('"></div><div class="tc-ctl-cbuild-tile-count"></div></div><div class="tc-modal-footer"><button class="tc-button tc-modal-close tc-ctl-cbuild-btn-ok" disabled>').h("i18n",t,{},{$key:"ok"}).w('</button><button type="button" class="tc-button tc-modal-close tc-ctl-cbuild-btn-cancel">').h("i18n",t,{},{$key:"cancel"}).w("</button></div></div></div>")}dust.register(a.CLASS+"-dialog",e);e.__dustBody=!0;return e};a.template[a.CLASS+"-off-panel"]=function(){function e(e,t){return e.w('<div class="tc-ctl-cbuild-off-panel tc-conn-wifi"><span>').h("i18n",t,{},{$key:"offlineMap"}).w('</span> <a href="" class="tc-ctl-cbuild-link-exit" title="').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w('"><span>').h("i18n",t,{},{$key:"returnToOnlineMaps"}).w("</span></a></div>")}dust.register(a.CLASS+"-off-panel",e);e.__dustBody=!0;return e}}var s=function(e){return $.map(decodeURIComponent(e).split(","),function(e){return parseFloat(e)})},o=function(e){e._state=e._states.READY;e.showDownloadProgress(0,1);e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.NEW).removeClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.LISTITEM).removeClass(TC.Consts.classes.DISABLED);e._$div.find(e._selectors.DELBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.TILECOUNT).html("");e.extent=null;e._loadedCount=0;e.boxDraw&&e.boxDraw.cancel()},l=function(e){e._state=e._states.EDITING;e.showDownloadProgress(0,1);e._$div.find(e._selectors.NEW).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.DRAWING).removeClass(TC.Consts.classes.HIDDEN);e.map.toast(e.getLocaleString("clickOnDownloadAreaFirstCorner"),{type:TC.Consts.msgType.INFO});e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!0);e._$dialogDiv.find(e._selectors.NAMETB).val("");e.boxDraw.activate()},c=function(e){e._state=e._states.DOWNLOADING;TC.Util.closeModal();e.showDownloadProgress(0,1);e._$div.find(e._selectors.NEW).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).removeClass(TC.Consts.classes.HIDDEN);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!0);e.layer.clearFeatures();e.boxDraw.cancel()},u=function(e){e._state=e._states.DELETING;e.showDownloadProgress(0,1);

e._$div.find(e._selectors.DRAWING).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.PROGRESS).addClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.NEW).removeClass(TC.Consts.classes.HIDDEN);e._$div.find(e._selectors.LISTITEM).addClass(TC.Consts.classes.DISABLED);e._$div.find(e._selectors.DELBTN).prop("disabled",!0);e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!0);e._$div.find(e._selectors.NEWBTN).prop("disabled",!1);e._$dialogDiv.find(e._selectors.TILECOUNT).html("");e.boxDraw.cancel()},p=function(e,t){t.find("span").first().addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.TEXTBOX).removeClass(TC.Consts.classes.HIDDEN).val(t.find("span a").html()).focus();t.find(e._selectors.SAVEBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.CANCELBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.EDITBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.VIEWBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.DELETEBTN).addClass(TC.Consts.classes.HIDDEN)},h=function(e,t){t.find("span").first().removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.TEXTBOX).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.SAVEBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.CANCELBTN).addClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.EDITBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.VIEWBTN).removeClass(TC.Consts.classes.HIDDEN);t.find(e._selectors.DELETEBTN).removeClass(TC.Consts.classes.HIDDEN)},d=function(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")},f=function(e,t){var r,n,i,a=t||{},s=e._$dialogDiv.find(e._classSelector+"-res"),o=e._$dialogDiv.find(e._selectors.RNGMAXRES),l=e.getResolutions();if(l.length){if(e.minResolution){if(void 0===a.rangeValue)for(var c=0,u=l.length;u>c;c++)if(e.minResolution>=l[c]){o.val(c);break}}else void 0===a.rangeValue&&o.val(Math.floor(l.length/2));n=parseInt(o.attr("max",l.length-1).val());var p=Math.floor(1e3*new Number(l[n]))/1e3;r=e.getLocaleString("metersPerPixel",{value:p.toLocaleString((e.map?e.map.options.locale:TC.Cfg.locale).replace("_","-"))});i=100*(n+1)/(l.length+1)+"%";o.prop("disabled",!1);e.minResolution=l[o.val()]}else{n=0;r="";o.val(0);i="0";e.minResolution=0;o.prop("disabled",!0)}s.css("left",i).html(r)},y=function(e,t){for(var r=null,n=0,i=e.tileMatrixLimits.length;i>n;n++){r=e.tileMatrixLimits[n];if(r.res<=t)break}return r},g=function(e){var t=e._$dialogDiv.find(e._classSelector+"-bl-node input[type=checkbox]");t.each(function(t,r){var n=$(r);if(n.prop("checked")){var i=e.requestSchemas.filter(function(e){return e.layerId===n.val()})[0];if(i){var a=y(i,e.minResolution);if(a){var s="{TileMatrix}",o="{TileRow}",l="{TileCol}",c=i.url;if(c.indexOf(s)<0){var u=c.indexOf("?");u>=0&&(c=c.substr(0,u));for(var p=0,h=e.baseLayers.length;h>p;p++){var d=e.baseLayers[p];if(d.id===i.layerId){c=c+"?layer="+d.layerNames+"&style=default&tilematrixset="+d.matrixSet+"&Service=WMTS&Request=GetTile&Version=1.0.0&Format="+d.format+"&TileMatrix="+s+"&TileRow="+o+"&TileCol="+l;break}}}n.parent("label").css("background-size","auto").css("background-position","left bottom").css("background-image","url("+c.replace("{TileMatrix}",a.mId).replace(o,a.rt).replace(l,a.cl)+")")}}}})},v=function(e,t){var r;r=1>t?e.getLocaleString("lessThan1Mb"):e.getLocaleString("approxXMb",{quantity:d(t)});return r},C=function(e){var t="";e.tileCount=0;for(var r=0,n=e.requestSchemas.length;n>r;r++)for(var i=e.requestSchemas[r],a=0,s=i.tileMatrixLimits.length;s>a;a++){var o=i.tileMatrixLimits[a];e.tileCount+=(o.cr-o.cl+1)*(o.rb-o.rt+1);if(o.res<e.minResolution)break}if(e.tileCount){e.estimatedMapSize=Math.round(e.tileCount*e.options.avgTileSize/1048576);t=e.getLocaleString("xTiles",{quantity:d(e.tileCount)})+" ("+v(e,e.estimatedMapSize)+")"}e._$dialogDiv.find(e._selectors.TILECOUNT).html(t)},T=function(e,t){return e._$div.find(e._selectors.LISTITEM).filter(function(e,r){return $(r).find("a").first().html()===t})},L=function(e,t){var r=t.indexOf("#");r>=0&&(t=t.substr(0,r));return e._$div.find(e._selectors.LISTITEM).filter(function(e,r){return $(r).find("a").first().attr("href")===t})},w=function(e,t){$("<iframe>").css("display","none").attr("src",t).appendTo(e._$div)},b=function(e,t){var r=e._$div.find('iframe[src="'+t+'"]');r.remove()},S=function(e,t){var r=!1;if(window.localStorage){localStorage.setItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t.url),t.extent+" "+t.name);r=!0}return r},E=function(e,t){var r=!1;if(window.localStorage){localStorage.removeItem(e.LOCAL_STORAGE_KEY_PREFIX+encodeURIComponent(t));r=!0}return r},O=function(e){var t=e.currentMap;if(S(e,t)){e.getRenderedHtml(e.CLASS+"-map-node",{name:t.name,url:t.url},function(t){e._$div.find(e._selectors.LIST).append(t);e._$div.find(e._selectors.EMPTYLIST).attr("hidden","hidden");e._$div.find(e._selectors.SEARCH).prop("disabled",!1)});e.storedMaps.push(t)}},A=function(e,t){var r=e.findStoredMap({url:t});if(r){E(e,t)&&T(e,r.name).remove();var n=$.inArray(r,e.storedMaps);e.storedMaps.splice(n,1);if(!e.storedMaps.length){e._$div.find(e._selectors.SEARCH).prop("disabled",!0);e._$div.find(e._selectors.EMPTYLIST).removeAttr("hidden")}return r.name}return null},x=function(e){e._$dialogDiv.find(e._selectors.OKBTN).prop("disabled",!e.extent||0===e._$dialogDiv.find(e._selectors.NAMETB).val().length||e._$dialogDiv.find(e._selectors.RNGMAXRES).prop("disabled"))};a.render=function(e){var t=this,r={storedMaps:t.storedMaps,listId:t.CLASS+"-list-"+TC.getUID()};t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e);t._$dialogDiv.find(t._selectors.NAMETB).on(TC.Consts.event.CLICK,function(e){e.preventDefault();this.selectionStart=0;this.selectionEnd=this.value.length;this.focus()})}).then(function(){t.renderData(r,function(){t._$dialogDiv.find(t._selectors.OKBTN).on(TC.Consts.event.CLICK,function(){var e={mapName:t._$dialogDiv.find(t._selectors.NAMETB).val()};if(t.findStoredMap({name:e.mapName}))TC.alert(t.getLocaleString("cb.mapNameAlreadyExists.error",e));else{var r=function(){t._$div.find(t._classSelector+"-name").html(e.mapName);t.map.toast(t.getLocaleString("downloadingMap",{mapName:e.mapName}));c(t);t.requestCache(e)},n=navigator.temporaryStorage||navigator.webkitTemporaryStorage||{};if(n.queryUsageAndQuota)n.queryUsageAndQuota(function(n,i){var a=(i-n)/1048576;t.estimatedMapSize<a?r():TC.confirm(t.getLocaleString("cb.mapCreation.warning.reasonSize",{mapName:e.mapName,mapSize:v(t,t.estimatedMapSize),availableStorage:v(t,Math.round(a))}),r)},function(e){TC.error(e)});else{var a=TC.Util.detectIE();if(a){var s=12>a?1e3:2e3,o=0,l=function(){var n=t.tileCount+o;n>s?TC.confirm(t.getLocaleString("cb.mapCreation.warning.reasonCount",{mapName:e.mapName,resourceCount:d(n),maxResourceCount:d(s)}),r):r()};i().done(function(e){o=e.length;l()}).fail(l)}else r()}}});t._$dialogDiv.find(t._selectors.NAMETB).on("input",function(){x(t)});t._$div.find(t._selectors.NEWBTN).on(TC.Consts.event.CLICK,function(){l(t)});t._$div.find(t._classSelector+"-btn-cancel-draw").on(TC.Consts.event.CLICK,function(){o(t)});t._$div.find(t._classSelector+"-btn-cancel-dl").on(TC.Consts.event.CLICK,function(){t.cancelCacheRequest()});t._$div.find(t._selectors.LIST).on(TC.Consts.event.CLICK,t._selectors.DELETEBTN,function(e){if(navigator.onLine){$btn=$(e.target);var r=$btn.parent().find("a").html();if(r){var n=t.getLocaleString("cb.delete.confirm",{mapName:r});t.serviceWorkerEnabled||(n=n+" "+t.getLocaleString("cb.delete.confirm.connect.warning"));if(confirm(n))if(navigator.onLine){u(t);t.deleteMap(r)}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}}else TC.alert(t.getLocaleString("cb.delete.conn.alert"))}).on(TC.Consts.event.CLICK,t._selectors.EDITBTN,function(e){p(t,$(e.target).parent())}).on(TC.Consts.event.CLICK,t._selectors.CANCELBTN,function(e){var r=$(e.target).parent();r.find(t._selectors.TEXTBOX).val(r.find("a").html());h(t,$(e.target).parent())}).on(TC.Consts.event.CLICK,t._selectors.SAVEBTN,function(e){var r=$(e.target).parent();h(t,r);var n=r.find("a"),i=(n.html(),r.find(t._selectors.TEXTBOX).val()),a=t.findStoredMap({url:n.attr("href")});if(a){a.name=i;n.html(i);n.attr("title",i);S(t,a)}}).on(TC.Consts.event.CLICK,t._selectors.VIEWBTN,function(e){$btn=$(e.target);var r=!$btn.hasClass(TC.Consts.classes.ACTIVE);t._$div.find(t._selectors.VIEWBTN).removeClass(TC.Consts.classes.ACTIVE).parent().removeClass(TC.Consts.classes.ACTIVE);var n=$btn.parent().find("a").html();if(n){var i=t.findStoredMap({name:n});if(i){var a=s(i.extent);t.layer.clearFeatures();if(r){t.layer.addPolygon([[[a[0],a[1]],[a[0],a[3]],[a[2],a[3]],[a[2],a[1]]]],{showsPopup:!1}).then(function(){t.layer.map.zoomToFeatures(t.layer.features)});$btn.addClass(TC.Consts.classes.ACTIVE);$btn.parent().addClass(TC.Consts.classes.ACTIVE);$btn.attr("title",t.getLocaleString("removeMapExtent"))}}}});var r=function(e){e=e.toLowerCase();var r=t._$div.find(t._selectors.LISTITEM).hide(),n=r.filter("li:not([class]),li."+TC.Consts.classes.ACTIVE);if(0===e.length){n.show();t._$div.find(t._classSelector+"-map-search-icon").css("visibility","visible")}else{t._$div.find(t._classSelector+"-map-search-icon").css("visibility","hidden");var i=new RegExp(e,"i");n.each(function(){var e=$(this);e.toggle(i.test(e.find("a").text()))});0===n.filter(":visible").length&&r.filter('[class^="tc-ctl-cbuild-map-not"]').show()}},n=t._$div.find(t._selectors.SEARCH);n.on("keyup search",function(){r($(this).val().toLowerCase().trim())});try{if(n.has($("::-ms-clear"))){var a;n.on("mouseup",function(e){a=n.val();""!==a&&setTimeout(function(){var e=n.val();""===e&&r(e)},1)})}}catch(m){}t._$dialogDiv.find(t._selectors.BLLIST).on("change","input[type=checkbox]",function(e){t.baseLayers.length=0;t._$dialogDiv.find(t._selectors.BLLIST+" input[type=checkbox]").each(function(e,r){var n=$(r);if(n.prop("checked"))for(var i=n.val(),a=0,s=t.map.baseLayers.length;s>a;a++){var o=t.map.baseLayers[a];if(o.id===i&&o.type===TC.Consts.layerType.WMTS){t.baseLayers[t.baseLayers.length]=o;break}}});t.updateRequestSchemas();f(t);g(t);x(t);C(t)});t._$dialogDiv.find(t._selectors.RNGMAXRES).on("input change",function(e){f(t,{rangeValue:$(e.target).val()});g(t);C(t)});TC.Util.getQueryStringParams();L(t,location.href).addClass(TC.Consts.classes.ACTIVE);$.isFunction(e)&&e()})});window.addEventListener("beforeunload",function(e){if(t.isDownloading){var r=t.getLocaleString("cb.mapDownloading.warning");e.returnValue=r;return r}},!0)};a.register=function(r){var n=this;TC.control.SWCacheClient.prototype.register.call(n,r);if(navigator.serviceWorker){navigator.serviceWorker.addEventListener("message",function(e){switch(e.data.event){case"progress":n.$events.trigger($.Event(TC.Consts.event.MAPCACHEPROGRESS,{url:e.data.name,loaded:e.data.count,total:e.data.total}));break;case"cached":n.$events.trigger($.Event(TC.Consts.event.MAPCACHEDOWNLOAD,{url:e.data.name}));break;case"deleted":n.$events.trigger($.Event(TC.Consts.event.MAPCACHEDELETE,{url:e.data.name}));break;case"error":e.data.action===n._actions.CREATE&&TC.error(n.getLocaleString("cb.resourceDownload.error",{url:e.data.url}))}});var a=function(){i().then(function(e){n.cacheUrlList(e,{silent:!0})})},l=function(){n.deleteCache(n.LOCAL_STORAGE_KEY_PREFIX,{silent:!0})};if(t.status===t.CACHED||t.status===t.UPDATEREADY||t.status===t.UNCACHED)a();else{t.addEventListener("cached",a,!1);t.addEventListener("updateready",a,!1);t.addEventListener("downloading",l,!1);t.addEventListener("obsolete",l,!1)}}if(n.mapIsOffline){r._$div.addClass(TC.Consts.classes.OFFLINE);n._$offlinePanelDiv=$(TC.Util.getDiv(n.options.offlinePanelDiv));n.options.offlinePanelDiv||n._$offlinePanelDiv.appendTo(r._$div);n.getRenderedHtml(n.CLASS+"-off-panel",null,function(e){n._$offlinePanelDiv.html(e);navigator.onLine||n._$offlinePanelDiv.find(n._selectors.OFFPANEL).addClass(TC.Consts.classes.CONNECTION_OFFLINE).removeClass(TC.Consts.classes.CONNECTION_MOBILE).removeClass(TC.Consts.classes.CONNECTION_WIFI);n._$offlinePanelDiv.find(n._selectors.EXIT).on(TC.Consts.event.CLICK,function(e){TC.confirm(n.getLocaleString("offlineMapExit.confirm"),null,function(){e.preventDefault()})})})}n.layer=null;r.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0}).then(function(e){n.layer=e;TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){n.boxDraw=new TC.control.Draw({div:n._$div.find(n._selectors.DRAW),mode:TC.Consts.geom.RECTANGLE,layer:n.layer});n.boxDraw.$events.on(TC.Consts.event.DRAWSTART,function(e){n.map.toast(n.getLocaleString("clickOnDownloadAreaOppositeCorner"),{type:TC.Consts.msgType.INFO})}).on(TC.Consts.event.DRAWEND,function(e){var t=e.geometry.geometry[0],r=t[0],i=t[2],a=Math.min(r[0],i[0]),s=Math.max(r[0],i[0]),o=Math.min(r[1],i[1]),l=Math.max(r[1],i[1]);n.setExtent([a,o,s,l]);var c=n._$dialogDiv.find("input[type=checkbox]");c.each(function(e,t){for(var r=0,i=n.map.baseLayers.length;i>r;r++){var a=n.map.baseLayers[r];if(t.value===a.id){var s=$(t),o=s.parents("li").first(),l=a.getResolutions(),c=n.wrap.getRequestSchemas({extent:n.extent,layers:[a]})[0].tileMatrixLimits;if(c.length&&l[l.length-1]==c[c.length-1].res)o.removeClass(TC.Consts.classes.HIDDEN);else{s.prop("checked",!1);o.addClass(TC.Consts.classes.HIDDEN)}break}}});var u;u=n._$dialogDiv.find(n._selectors.BLLISTITEM).filter(":not(."+TC.Consts.classes.HIDDEN+")").length?"selectAtLeastOne":"cb.noMapsAtSelectedExtent";n._$dialogDiv.find(n._selectors.BLLISTTEXT).html(n.getLocaleString(u));g(n);C(n);TC.Util.showModal(n._$dialogDiv.find(n._classSelector+"-dialog"),{openCallback:function(){c.prop("disabled",!1);var e;if(Date.prototype.toLocaleString){var t={};t.year=t.month=t.day=t.hour=t.minute=t.second="numeric";e=(new Date).toLocaleString(n.map.options.locale.replace("_","-"),t)}else e=(new Date).toString();n._$dialogDiv.find(n._selectors.NAMETB).val(e)[0];x(n)},closeCallback:function(){c.prop("disabled",!0);n.layer.clearFeatures()}})});r.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){n.boxDraw===e.control&&n._state===n._states.EDITING&&o(n)});r.addControl(n.boxDraw)})});var c=function(e){var t=!1,r=n._$dialogDiv.find(n._selectors.BLLIST),i=function(){return r.find('li[data-tc-layer-uid="'+e.id+'"]').length>0},a=e.type===TC.Consts.layerType.WMTS;TC.Util.detectSafari()&&TC.Util.detectIOS()&&(a=a&&TC.Util.isSameOrigin(e.url));if(a&&!i()){t=!0;n.getRenderedHtml(n.CLASS+"-bl-node",e,function(e){i()||r.append(e)})}return t};r.on(TC.Consts.event.LAYERADD,function(e){c(e.layer)}).on(TC.Consts.event.LAYERREMOVE,function(e){e.layer.type===TC.Consts.layerType.WMTS&&n._$dialogDiv.find(n._selectors.BLLIST).find('li[data-tc-layer-uid="'+e.layer.id+'"]').remove()});var u=TC.Util.getQueryStringParams(),p=u[n.MAP_DEFINITION_PARAM_NAME],h=u[n.MAP_EXTENT_PARAM_NAME];r.ready(function(){if(n.mapIsOffline){for(var e=[],t=0,i=n.offlineControls.length;i>t;t++){var a=n.offlineControls[t];a=a.substr(0,1).toUpperCase()+a.substr(1);e=e.concat(r.getControlsByClass("TC.control."+a))}for(var t=0,i=r.controls.length;i>t;t++){var s=r.controls[t];e.indexOf(s)<0&&s.disable()}$(n._selectors.OFFLINEHIDDEN).addClass(TC.Consts.classes.HIDDEN)}});r.loaded(function(){r.putLayerOnTop(n.layer);n._firstRender.then(function(){n._$div.find(n._selectors.NEWBTN).prop("disabled",!1);for(var e=0,t=r.baseLayers.length;t>e;e++)c(r.baseLayers[e])});if(n.mapIsOffline){var e=JSON.parse(window.atob(decodeURIComponent(p))),t=[],i=$.grep(r.baseLayers,function(r){var n=!1;if(r.type===TC.Consts.layerType.WMTS)for(var i=0,a=e.layers.length;a>i;i++){var s=e.layers[i],o=0===r.url.indexOf("//")?location.protocol+r.url:r.url;if(o===e.url[s.urlIdx]&&r.layerNames===s.id&&r.matrixSet===e.tms[s.tmsIdx]){n=!0;break}}n||r.type!==TC.Consts.layerType.VECTOR&&(t[t.length]=r);return n})[0];i&&r.setBaseLayer(i);for(var a=0,o=t.length;o>a;a++)r.removeLayer(t[a]);r.setExtent(s(h))}});n.$events.on(TC.Consts.event.MAPCACHEDOWNLOAD,function(e){n.isDownloading=!1;var t=function(e){var t=e.indexOf("#");return t>=0?e.substr(0,t):e},i=t(e.url),a=L(n,i);if(a.length&&!n.serviceWorkerEnabled){a.removeClass(TC.Consts.classes.DISABLED);a.find(n._selectors.DELBTN).prop("disabled",!1);TC.alert(n.getLocaleString("cb.delete.error"))}else if(n.currentMap&&i===n.currentMap.url){O(n);r.toast(n.getLocaleString("mapDownloaded",{mapName:n.currentMap.name}))}n.currentMap=null;b(n,e.url);o(n)}).on(TC.Consts.event.MAPCACHEDELETE,function(e){n.isDownloading=!1;var t=A(n,e.url)||n.currentMap&&n.currentMap.name;b(n,e.url);n.currentMap=null;if(t){document.cookie=n.COOKIE_KEY_PREFIX+"delete=; expires=Thu, 01 Jan 1970 00:00:01 GMT;";r.toast(n.getLocaleString("mapDeleted",{mapName:t}))}o(n)}).on(TC.Consts.event.MAPCACHEPROGRESS,function(e){var t=e.total;!t&&n.requestSchemas&&(t=n.requestSchemas[0].tileCount);var r=e.loaded;if(r)n._loadedCount=r;else{n._loadedCount+=1;r=n._loadedCount}n.showDownloadProgress(r,t)}).on(TC.Consts.event.MAPCACHEERROR,function(t){n.isDownloading=!1;b(n,t.url);o(n);var r=n.getLocaleString("cb.mapCreation.error"),i=!0;switch(t.reason){case"quota":r+=". "+n.getLocaleString("cb.mapCreation.error.reasonQuota");break;case"resource":r+=". "+n.getLocaleString("cb.mapCreation.error.reasonResource");break;case"manifest":"410"==t.status&&A(n,t.url);i=!1;break;case e:r+=". "+n.getLocaleString("cb.mapCreation.error.reasonAlreadyExists")}if(i)if(TC.Util.detectIE()){TC.error(r);TC.alert(n.getLocaleString("cb.mapCreation.error.reasonIE"))}else TC.alert(r);n.currentMap=null})};a.setExtent=function(e){var t=this;if($.isArray(e)&&e.length>=4){t.extent=e;t.updateRequestSchemas()}};a.cacheUrlList=function(e,t){var r=this,n=t||{};r.createCache(n.name||r.LOCAL_STORAGE_KEY_PREFIX+"common",{urlList:e,silent:n.silent})};a.requestCache=function(e){var t=this,r=e||{};if(t.map){var n=r.extent||t.extent||t.map.getExtent();t.updateRequestSchemas({extent:n});if(t.requestSchemas){for(var i=function(e,r,n){var i=e.res>=t.minResolution;!i&&r>0&&(i=n[r-1].res>t.minResolution);return i},a=function(e){return{mId:e.mId,cl:e.cl,cr:e.cr,rt:e.rt,rb:e.rb}},s=t.requestSchemas.map(function(e){return{layerId:e.layerId,tileMatrixLimits:e.tileMatrixLimits.filter(i)}}),o=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY],l=0,c=s.length;c>l;l++){var u=s[l],p=u.tileMatrixLimits[u.tileMatrixLimits.length-1],h=p.res*p.tSize;o[0]=Math.min(o[0],p.origin[0]+h*p.cl);o[1]=Math.min(o[1],p.origin[1]-h*(p.rb+1));o[2]=Math.max(o[2],p.origin[0]+h*(p.cr+1));o[3]=Math.max(o[3],p.origin[1]-h*p.rt);u.tileMatrixLimits=u.tileMatrixLimits.map(a)}var d=Math.pow(10,t.map.wrap.isGeo()?TC.Consts.DEGREE_PRECISION:TC.Consts.METER_PRECISION);o=o.map(function(e,t){var r=3>t?Math.ceil:Math.floor;return r(e*d)/d});for(var f={bBox:o,res:Math.floor(1e3*t.minResolution)/1e3,url:[],tms:[],format:[],layers:new Array(t.baseLayers.length)},l=0,c=t.baseLayers.length;c>l;l++){var y=t.baseLayers[l],g=0===y.url.indexOf("//")?location.protocol+y.url:y.url,v=$.inArray(g,f.url);0>v&&(v=f.url.push(g)-1);var C=$.inArray(y.matrixSet,f.tms);0>C&&(C=f.tms.push(y.matrixSet)-1);var T=y.format.substr(y.format.indexOf("/")+1),L=$.inArray(T,f.format);0>L&&(L=f.format.push(T)-1);f.layers[l]={urlIdx:v,id:y.layerNames,tmsIdx:C,formatIdx:L}}var b=TC.Util.getQueryStringParams(),S=b[t.MAP_EXTENT_PARAM_NAME]=o.toString();b[t.MAP_DEFINITION_PARAM_NAME]=btoa(JSON.stringify(f));t.serviceWorkerEnabled&&(b[t.SERVICE_WORKER_FLAG]=1);var E=location.origin+location.pathname.substr(0,location.pathname.lastIndexOf("/")+1)+t.CACHE_REQUEST_PATH+"?"+$.param(b);t.currentMap={name:r.mapName,extent:S,url:E};t.isDownloading=!0;if(t.serviceWorkerEnabled)for(var l=0,c=s.length;c>l;l++){for(var O=s[l],A=null,x=0,P=t.baseLayers.length;P>x;x++){var _=t.baseLayers[x];if(_.id===O.layerId){A=t.wrap.getGetTilePattern(_);break}}if(A){urlList=[];var N=0;for(k=0,lenk=O.tileMatrixLimits.length;k<lenk;k++){var p=O.tileMatrixLimits[k];for(_=p.cl;_<=p.cr;_++)for(m=p.rt;m<=p.rb;m++)urlList[N++]=A.replace("{TileMatrix}",p.mId).replace("{TileCol}",_).replace("{TileRow}",m)}urlList.push(E);t.cacheUrlList(urlList,{name:E})}}else w(t,E)}}};a.cancelCacheRequest=function(){var e=this;if(e.currentMap){b(e,e.currentMap.url);e.deleteCache(e.currentMap.url).then(function(t){t||(e.currentMap=null)})}e.isDownloading=!1;o(e)};a.deleteMap=function(e){var t=this,r=t.findStoredMap({name:e});if(r){var n=TC.Util.getQueryStringParams(r.url);t.deleteCache(r.url).then(function(e){if(!e){document.cookie=t.COOKIE_KEY_PREFIX+"delete="+atob(decodeURIComponent(n[t.MAP_DEFINITION_PARAM_NAME]));w(t,r.url)}})}};a.findStoredMap=function(e){var t=this;return $.grep(t.storedMaps,function(t){var r=!0;e.name&&e.name!==t.name&&(r=!1);r&&e.url&&e.url!==t.url&&(r=!1);return r})[0]};a.showDownloadProgress=function(e,t){var r=this,n=r._classSelector,i=r._$div.find(n+"-progress-count");if(t){var a=Math.min(Math.round(100*e/t),100),s=a+"%";r._$div.find(n+"-progress-ratio").css("width",s);i.html(s)}else{r._$div.find(n+"-progress-bar").addClass(TC.Consts.classes.HIDDEN);i.html(r.getLocaleString("xFiles",{quantity:e}))}};a.updateRequestSchemas=function(e){var t=this,r=e||{};r.extent=r.extent||t.extent;r.layers=r.layers||t.baseLayers;t.requestSchemas=t.wrap.getRequestSchemas(r);return t.requestSchemas};a.getResolutions=function(){for(var e=this,t=[],r=function(e){return e.res},n=e.requestSchemas.map(function(e){return e.tileMatrixLimits.map(r)}),i=Number.POSITIVE_INFINITY,a=0,s=0,o=n.length;o>s;s++){var l=n[s];i=Math.min(i,l[0]);a=Math.max(a,l[l.length-1])}for(var s=0,o=n.length;o>s;s++)t=t.concat(n[s].filter(function(e){return i>=e&&e>=a&&t.indexOf(e)<0}));t.sort(function(e,t){return t-e});return t}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Coordinates=function(){var e=this;e.crs="";e.xy=[0,0];e.latLon=[0,0];e.units="m";e.isGeo=!1;TC.Control.apply(e,arguments);e.geoCrs=e.options.geoCrs||TC.Cfg.geoCrs};TC.inherit(TC.control.Coordinates,TC.Control);!function(){var e=TC.control.Coordinates.prototype;e.CLASS="tc-ctl-coords";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Coordinates.html":function(){function t(e,t){return e.w('<div>CRS: <span class="tc-ctl-coords-crs">').f(t.get(["crs"],!1),t,"h").w('</span></div><div class="tc-ctl-coords-xy">').x(t.get(["isGeo"],!1),t,{"else":r,block:n},{}).w("</div>").x(t.get(["showGeo"],!1),t,{block:i},{})}function r(e,t){return e.w('X: <span class="tc-ctl-coords-x">').f(t.get(["x"],!1),t,"h").w('</span> Y: <span class="tc-ctl-coords-y">').f(t.get(["y"],!1),t,"h").w("</span>")}function n(e,t){return e.h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span>")}function i(e,t){return e.w('<div class="tc-ctl-coords-alt">CRS: <span class="tc-ctl-coords-geocrs">').f(t.get(["geoCrs"],!1),t,"h").w('</span></div><div class="tc-ctl-coords-xy">').h("i18n",t,{},{$key:"lat"}).w(': <span class="tc-ctl-coords-lat">').f(t.get(["lat"],!1),t,"h").w("</span> ").h("i18n",t,{},{$key:"lon"}).w(': <span class="tc-ctl-coords-lon">').f(t.get(["lon"],!1),t,"h").w("</span></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.crs=t.map.crs;t.wrap||(t.wrap=new TC.wrap.control.Coordinates(t));t.clear();e.loaded(function(){t.wrap.register(e).then(function(){t.render(function(){t.update();t.clear()})});if(TC.Util.detectMobile()){$.when(e.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"})).then(function(e){t.layer=e});t.activateCoords()}})};e.render=function(e){var t=this;t.renderData({x:t.xy[0],y:t.xy[1],lat:t.latLon[0],lon:t.latLon[1],crs:t.crs,geoCrs:t.geoCrs,isGeo:t.isGeo,showGeo:t.options.showGeo},function(){t.$crs=t._$div.find("."+t.CLASS+"-crs");t.$geoCrs=t._$div.find("."+t.CLASS+"-geocrs");t.$x=t._$div.find("."+t.CLASS+"-x");t.$y=t._$div.find("."+t.CLASS+"-y");t.$lat=t._$div.find("."+t.CLASS+"-lat");t.$lon=t._$div.find("."+t.CLASS+"-lon");$.isFunction(e)&&e()})};e.formatCoord=function(e,t){var r;r=e.toFixed(t);3>=t&&(r=r.replace(/\B(?=(\d{3})+(?!\d))/g,"|"));r=r.replace(".",",").replace(/\|/g,".");return r};e.update=function(){var e=this;e.renderPromise().then(function(){if(e.$crs){!e.isGeo&&e.options.showGeo&&(e.latLon=TC.Util.reproject(e.xy,e.crs,e.geoCrs).reverse());e.$crs.text(e.crs);e.$geoCrs.text(e.geoCrs);if(!e.isGeo){e.$x.text(e.formatCoord(e.xy[0],TC.Consts.METER_PRECISION));e.$y.text(e.formatCoord(e.xy[1],TC.Consts.METER_PRECISION))}if(e.isGeo||e.options.showGeo){e.$lat.text(e.formatCoord(e.latLon[0],TC.Consts.DEGREE_PRECISION));e.$lon.text(e.formatCoord(e.latLon[1],TC.Consts.DEGREE_PRECISION))}TC.Util.detectMobile()||e._$div.removeClass(TC.Consts.classes.HIDDEN)}})};e.clear=function(){var e=this;TC.Util.detectMobile()||e._$div.addClass(TC.Consts.classes.HIDDEN)};e.deactivateCoords=function(){var e=this;e._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);e.clear();e.wrap.coordsDeactivate();e.cleanCoordsPointer()};e.cleanCoordsPointer=function(){var e=this;delete e.currentCoordsMarker;$.when(e.getLayer()).then(function(e){e&&e.clearFeatures()})};e.activateCoords=function(){var e=this;e.wrap.coordsActivate()};e.getCoords=function(){var e=this,t=e.map.getControlsByClass(TC.control.Popup);if(t&&t.length>0&&t[0].isVisible())e.coordsToPopup(t[0]);else{e.updateCoordsCtrl([(e.map.getExtent()[0]+e.map.getExtent()[2])/2,(e.map.getExtent()[1]+e.map.getExtent()[3])/2]);e.coordsToClick.call(e,{coordinate:e.xy})}};e.coordsToPopup=function(e){var t=this;e&&t.updateCoordsCtrl(e.wrap.popup.getPosition())};e.updateCoordsCtrl=function(e){var t=this;if(e){t.x=e[0];t.y=e[1];t.xy=[t.x,t.y];t.update()}};var t,r;e.coordsToClick=function(e){var n=this;if(!$(n.map._$div).hasClass("tc-ctl-sv-active tc-collapsed")){$(n._$div).stop(!0,!0);t&&clearTimeout(t);if(0==n._$div.find("span.close").length){r=n._$div.append('<span class="close"></span>');$(r).click(function(){n._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);n.clear();n.cleanCoordsPointer()})}n.updateCoordsCtrl(e.coordinate);n.coordsMarkerAdd(e.coordinate);n._$div.removeClass(TC.Consts.classes.HIDDEN);t=setTimeout(function(){$(n._$div).animate({opacity:0},3e3,"linear",function(){$(n._$div).css({opacity:.7});n._$div.toggleClass(TC.Consts.classes.HIDDEN,!0);n.clear();n.cleanCoordsPointer()})},5e3)}};e.coordsMarkerAdd=function(e){var t=this;t.currentCoordsMarker?t.currentCoordsMarker.setCoords(e):$.when(t.getLayer()).then(function(r){r&&$.when(r.addMarker(e,{title:"Coord",showsPopup:!1,cssClass:TC.Consts.classes.POINT,anchor:[.5,.5]})).then(function(e){t.currentCoordsMarker=e})})};e.getLayer=function(){var e=this,t=new $.Deferred;void 0==e.layer?$.when(e.map.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Coordenadas"})).then(function(r){e.layer=r;e.layer.map.putLayerOnTop(e.layer);t.resolve(e.layer)}):t.resolve(e.layer);return t}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Download=function(e){var t=this;t._classSelector="."+t.CLASS;TC.Control.apply(t,arguments);var r=e||{};t._$dialogDiv=$(TC.Util.getDiv(r.dialogDiv));r.dialogDiv||t._$dialogDiv.appendTo("body")};TC.inherit(TC.control.Download,TC.Control);!function(){var e=TC.control.Download.prototype;e.CLASS="tc-ctl-download";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Download.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/DownloadDialog.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"download"}).w(' <span class="tc-beta">').h("i18n",t,{},{$key:"beta"}).w('</span> </h2><div class="tc-ctl-sctnr tc-ctl-sctnr-select"><form><label class="tc-ctl-sctnr-tab tc-ctl-download-image" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="image" /><span>').h("i18n",t,{},{$key:"dl.export.map"}).w('</span></label><label class="tc-ctl-sctnr-tab tc-ctl-download-data" style="width:calc(100%/2 - 1px)"><input type="radio" name="sctnr-sel" value="data" /><span>').h("i18n",t,{},{$key:"dl.export.vector"}).w('</span></label></form></div><div class="tc-ctl tc-ctl-sctnr-elm tc-ctl-sctnr-elm-image tc-group tc-ctl-download-cnt tc-ctl-download-image tc-hidden"><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format-image" class="tc-combo"><option value="image/png">PNG</option><option value="image/jpeg">JPEG</option></select><div class="tc-ctl-download-div"><input id="tc-ctl-download-image-qr" class="tc-hidden" type="checkbox" checked style="display:none;" /><label for="tc-ctl-download-image-qr" class="tc-ctl-download-image-qr-label" title="').h("i18n",t,{},{$key:"createQrCodeToImage"}).w('">').h("i18n",t,{},{$key:"appendQRCode"}).w('</label></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadImageFromCurrentMap"}).w('" name="descargar">').h("i18n",t,{},{$key:"download"}).w('</button></div></div><div class="tc-ctl tc-ctl-sctnr-elm tc-ctl-sctnr-elm-data tc-group tc-ctl-download-cnt tc-hidden"><label>').h("i18n",t,{},{$key:"format"}).w(':</label><select id="download-format" class="tc-combo"><option value="GML32">GML</option><option value="application/json">GeoJSON</option><option value="application/vnd.google-earth.kml+xml">KML (Google Earth)</option><option value="shape-zip">Shape (ESRI)</option></select><div class="tc-ctl-download-div"><i class="tc-ctl-download-help icon-question-sign" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"showDownloadHelp"}).w('"></i></div><div class="tc-group tc-group tc-ctl-download-cnt" style="text-align:right;"><button type="button" class="tc-ctl-download-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"downloadLayersFromCurrentExtent"}).w('" name="descargar">').h("i18n",t,{},{$key:"download"}).w('</button></div><div class="tc-alert alert-warning tc-hidden"><p id="zoom-msg"><strong>').h("i18n",t,{},{$key:"tooManyFeatures"}).w(": </strong>").h("i18n",t,{},{$key:"tooManyFeatures.instructions"}).w('</p><p id="layers-msg"><strong>').h("i18n",t,{},{$key:"noLayersLoaded"}).w(": </strong>").h("i18n",t,{},{$key:"noLayersLoaded.instructions"}).w('</p><p id="url-msg"><strong>').h("i18n",t,{},{$key:"tooManySelectedLayers"}).w(": </strong>").h("i18n",t,{},{$key:"tooManySelectedLayers.instructions"}).w('</p><p id="noFeatures-msg"><strong>').h("i18n",t,{},{$key:"noData"}).w(": </strong>").h("i18n",t,{},{$key:"noData.instructions"}).w('</p><p id="novalid-msg"><strong>').h("i18n",t,{},{$key:"noValidService"}).w(": </strong>").h("i18n",t,{},{$key:"noValidService.instructions"}).w("</p></div></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w(' <div class="tc-ctl-download-help-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"downloadData"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p>').h("i18n",t,{},{$key:"dl.instructions.1|s"}).w("</p><ul><li>").h("i18n",t,{},{$key:"dl.instructions.2|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.3|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.4|s"}).w("<ul><li>").h("i18n",t,{},{$key:"dl.instructions.5|s"}).w("</li><li>").h("i18n",t,{},{$key:"dl.instructions.6|s"}).w('</li></ul></li></ul></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t}}e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e);

}).then(function(){TC.Control.prototype.render.call(t,function(){var r=(t.CLASS+"-seldisabled",".tc-ctl-sctnr");t._selectors={TAB:r+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:r+"-elm"};var n=function(e){var r=$(this).closest(t._selectors.TAB).find(t._selectors.RADIOBUTTON),n=r.val(),i=t._$div.find(t._selectors.ELEMENT);if(t._oldValue===n&&t.options.deselectable){setTimeout(function(){r.prop("checked",!1)},0);t._oldValue=null;$active=$();$hidden=i}else{$active=i.filter(t._selectors.ELEMENT+"-"+n);$hidden=i.not($active);t._oldValue=n}$active.removeClass(TC.Consts.classes.HIDDEN);$hidden.addClass(TC.Consts.classes.HIDDEN);r.prop("checked",!0)};t._$div.find("span").on(TC.Consts.event.CLICK,n);e&&e()})})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);var r=function(){var e=window.location.href,t=e.indexOf("?"),r=e.indexOf("#");t>0&&(e=r>t?e.replace(e.substring(t,r),""):e.replace(e.substring(t,e.length-1),""));return e},n=function(e){var t=$.Deferred(),r=150;e?TC.loadJS("undefined"==typeof QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){e.length>r&&(e=TC.Util.shortenUrl(e));$("body").append('<div id="qrcode"></div>');{var n=$("#qrcode");new QRCode(n.get(0),{text:e,width:85,height:85})}setTimeout(function(){var e=n.find("img").attr("src");n.remove();t.resolve(e)},100)}):t.resolve(imgBase64);return t.promise()},i=function(){var e=t.map.getLoadingIndicator().addWait(),i=$active.find("select").val();if($active.find("select").val().indexOf("image")>-1){var o,l=$.Deferred(),c=t.map.wrap.getViewport({synchronous:!0}).getElementsByTagName("canvas")[0],u=TC.Util.cloneCanvas(c),p=t.map.getControlsByClass(TC.control.ScaleBar);if(0==p.length){p=new TC.control.ScaleBar;p.register(t.map);p.render()}if(p){var h=u.getContext("2d");h.save();var d=document.getElementsByClassName("ol-scale-line-inner"),f=d.item(0),m=$.extend({},f.getBoundingClientRect());d=document.getElementsByClassName(p[0].CLASS);var y=d.item(0),g=$.extend({},y.getBoundingClientRect()),v=f.textContent;h.beginPath();h.strokeStyle=window.getComputedStyle(f).borderColor;var C,T;if(m.width>m.height){C=m.width;T=m.height}else{C=m.height;T=m.width}g.left=m.left=15;g.left=g.left-2;g.top=m.top=15;g.top--;h.moveTo(m.left,m.top);h.lineTo(m.left,m.top+T);h.lineTo(m.left+C,m.top+T);h.lineTo(m.left+C,m.top);h.stroke();var L=(h.measureText(v),{x:m.left+C/2,y:m.top+T/2});h.globalAlpha=.5;h.fillStyle=window.getComputedStyle(y).backgroundColor;C+=4;T+=4;h.fillRect(g.left,g.top,C,T);h.globalAlpha=1;h.fillStyle=window.getComputedStyle(f).color;h.font=window.getComputedStyle(f).fontSize+" "+window.getComputedStyle(f).fontFamily;h.textAlign="center";h.textBaseline="middle";h.fillText(v,L.x,L.y)}$active.find("#tc-ctl-download-image-qr:checked").length>0?$.when(n(r())).then(function(r){if(r){var n=u.getContext("2d");n.fillStyle="#ffffff";n.fillRect(u.width-91,u.height-91,91,91);$.when(TC.Util.addToCanvas(u,r,{x:u.width-88,y:u.height-88})).then(function(e){l.resolve(e)})}else{TC.error(t.getLocaleString("dl.export.map.error")+": QR");t.map.getLoadingIndicator().removeWait(e)}}):l.resolve(u);$.when(l).then(function(r){try{o=r.toDataURL(i);TC.Util.downloadDataURI(window.location.hostname+"_"+TC.Util.getFormattedDate((new Date).toString(),!0)+"."+i.split("/")[1],i,o)}catch(n){TC.error(t.getLocaleString("dl.export.map.error")+": "+n.message)}t.map.getLoadingIndicator().removeWait(e)})}else{var w=(a(),t.map.getExtent()),b=TC.WFSGetFeatureBuilder(t.map,w,i,!0);$.when.apply($,b).then(function(){var r=$.grep(arguments,function(e){return null!=e});if(0!==r.length){for(var n=[],i=0;i<r.length;i++)if(r[i].err)switch(r[i].err){case"NumMaxFeatures":s({zoom:!0,serviceName:r[i].service.mapLayer.title},e);break;case"NameResolutionFailure":s({noValid:!0,serviceName:r[i].service.mapLayer.title},e);break;default:s({noValid:!0,serviceName:r[i].service.mapLayer.title},e)}else{var a=r[i].data,o=r[i].url;a&&o&&n.push({url:o+"?download=zip",data:a})}TC.Util.downloadFileForm(n);t.map.getLoadingIndicator().removeWait(e)}else s({layers:!0},e)})}},a=function(){for(var e=[],r=0;r<t.map.workLayers.length;r++){var n=t.map.workLayers[r];n.type===TC.Consts.layerType.WMS&&n.getVisibility()&&n.names.length>0&&e.push(n)}return e},s=function(e,r){var n,i=t._$div.find(".alert-warning");e.zoom?n=i.find("#zoom-msg").html().format({serviceName:e.serviceName}):e.layers?n=t.getLocaleString("noLayersLoaded"):e.url?n=t.getLocaleString("tooManySelectedLayers"):e.noFeatures?n=i.find("#noFeatures-msg").html():e.noValid&&(n=i.find("#novalid-msg").html().format({serviceName:e.serviceName}));t.map.toast(n,{type:TC.Consts.msgType.WARNING});t.map.getLoadingIndicator().removeWait(r)},o=function(e){e.stopPropagation();TC.Util.showModal(t._$dialogDiv.find(t._classSelector+"-help-dialog"))};t._$div.on(TC.Consts.event.CLICK,".tc-ctl-download-btn",i);t._$div.on(TC.Consts.event.CLICK,".tc-ctl-download-help",o)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Feature&&TC.feature.Point||TC.syncLoadJS(TC.apiLocation+"TC/feature/Point");TC.Feature&&TC.feature.Polyline||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polyline");TC.Feature&&TC.feature.Polygon||TC.syncLoadJS(TC.apiLocation+"TC/feature/Polygon");TC.Consts.event.DRAWSTART="drawstart.tc";TC.Consts.event.DRAWEND="drawend.tc";TC.Consts.event.DRAWCANCEL="drawcancel.tc";TC.Consts.event.MEASURE="measure.tc";TC.Consts.event.MEASUREPARTIAL="measurepartial.tc";!function(){TC.control.Draw=function(){var e=this;TC.Control.apply(e,arguments);e._classSelector="."+e.CLASS;e._pointClass=e.CLASS+"-point";e._lineClass=e.CLASS+"-line";e._polygonClass=e.CLASS+"-polygon";e.history=[];e.historyIndex=0;this.renderPromise().then(function(){e.reset=!0;e.callBack=null;e.measure=!1;e._cancelClick=!1;e.mode=e.options.mode||TC.Consts.geom.POLYLINE;e.options.measure&&(e.measure=e.options.measure);$.isFunction(e.options.callback)&&(e.callBack=e.options.callback);e.wrap=new TC.wrap.control.Draw(e);e._$newBtn=e._$div.find(e._classSelector+"-btn-new").on(TC.Consts.event.CLICK,function(){e["new"]()});e._$cancelBtn=e._$div.find(e._classSelector+"-btn-cancel").on(TC.Consts.event.CLICK,function(){e.cancel()});e._$endBtn=e._$div.find(e._classSelector+"-btn-end").on(TC.Consts.event.CLICK,function(){e.end()});e._$undoBtn=e._$div.find(e._classSelector+"-btn-undo").on(TC.Consts.event.CLICK,function(){e.undo()});e._$redoBtn=e._$div.find(e._classSelector+"-btn-redo").on(TC.Consts.event.CLICK,function(){e.redo()});e.$events.on(TC.Consts.event.MEASURE,function(t){e.resetValues()});e.$events.on(TC.Consts.event.POINT,function(r){if(e.layer&&e.layer.features&&e.layer.features.length>0){e.layer.clearFeatures();e.resetValues()}e.history.length=e.historyIndex;e.history[e.historyIndex++]=r.point;t(e)});e.$events.on(TC.Consts.event.DRAWEND,function(t){r(e);e.callBack&&e.callBack(t.geometry)})})};TC.inherit(TC.control.Draw,TC.Control);var e=TC.control.Draw.prototype;e.CLASS="tc-ctl-draw";var t=function(e){e._$endBtn.prop("disabled",0===e.historyIndex||e.mode===TC.Consts.geom.POLYGON&&e.historyIndex<3||e.mode===TC.Consts.geom.POLYLINE&&e.historyIndex<2);e._$redoBtn.prop("disabled",e.history.length===e.historyIndex);e._$undoBtn.prop("disabled",0===e.historyIndex)},r=function(e){e.resetValues();e._$endBtn.prop("disabled",!0);e._$cancelBtn.prop("disabled",!1)};e.template=TC.isDebug?TC.apiLocation+"TC/templates/Draw.html":function(){function t(e,t){return e.w(' <button class="tc-ctl-btn tc-ctl-draw-btn-new" title="').f(t.get(["tooltip"],!1),t,"h").w('">').h("i18n",t,{},{$key:"new"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-undo" disabled title="').h("i18n",t,{},{$key:"undo"}).w('">').h("i18n",t,{},{$key:"undo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-redo" disabled title="').h("i18n",t,{},{$key:"redo"}).w('">').h("i18n",t,{},{$key:"redo"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-end" title="').h("i18n",t,{},{$key:"end"}).w('">').h("i18n",t,{},{$key:"end"}).w('</button><button class="tc-ctl-btn tc-ctl-draw-btn-cancel" title="').h("i18n",t,{},{$key:"cancel"}).w('">').h("i18n",t,{},{$key:"cancel"}).w("</button> ")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.render=function(e){var t,r=this;switch(r.options.mode){case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:t=r.getLocaleString("drawLine");r._$div.addClass(r._lineClass);break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:t=r.getLocaleString("drawPolygon");r._$div.addClass(r._polygonClass);break;case TC.Consts.geom.POINT:case TC.Consts.geom.MULTIPOINT:t=r.getLocaleString("draw");r._$div.addClass(r._pointClass);break;default:t=r.getLocaleString("draw")}r.renderData({tooltip:t},function(){$.isFunction(e)&&e()})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.loaded(function(){t.options.layer?t.setLayer(t.options.layer):"boolean"!=typeof t.options.layer&&e.loaded(function(){t.layerPromise=e.addLayer({id:TC.getUID(),title:"DrawControl",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:$.extend({},e.options.styles.point,{fillOpacity:0}),line:e.options.styles.line,polygon:e.options.styles.polygon}});$.when(t.layerPromise).then(function(r){t.layer=r;e.putLayerOnTop(t.layer)})})})};e["new"]=function(){var e=this;e.layer&&e.layer.clearFeatures();e.setMode(e.mode,!0)};e.undo=function(){var e=this,r=e.wrap.undo();if(r){e.historyIndex--;t(e);e.historyIndex<=0&&e.resetValues()}return r};e.redo=function(){var e=this,r=this.wrap.redo();if(r){e.historyIndex++;t(e)}return r};e.cancel=function(){var e=this;e._cancelClick=!0;this.setMode(null,!1);e.resetValues();r(e);e.$events.trigger($.Event(TC.Consts.event.DRAWCANCEL,{ctrl:e}))};e.activate=function(){var e=this;e._$newBtn.addClass(TC.Consts.classes.ACTIVE);TC.Control.prototype.activate.call(e);e.wrap.activate(e.mode);e._$div.removeClass(e._pointClass).removeClass(e._lineClass).removeClass(e._polygonClass);switch(e.mode){case TC.Consts.geom.POINT:e._$div.addClass(e._pointClass);break;case TC.Consts.geom.POLYLINE:e._$div.addClass(e._lineClass);break;case TC.Consts.geom.POLYGON:e._$div.addClass(e._polygonClass)}};e.deactivate=function(){var e=this;e._$newBtn&&e._$newBtn.removeClass(TC.Consts.classes.ACTIVE);TC.Control.prototype.deactivate.call(e,!e._cancelClick);e.wrap&&e.wrap.deactivate();e.resetValues();e._cancelClick=!1};e.isExclusive=function(){return!0};e.end=function(){var e=this;e.wrap.end();e.resetValues()};e.setMode=function(e,t){var r=this;e&&(r.mode=e);if(t&&e){r.layer&&r.layer.map.putLayerOnTop(r.layer);r.activate()}else r.deactivate();var n=t?TC.Consts.event.CONTROLACTIVATE:TC.Consts.event.CONTROLDEACTIVATE;r.map&&r.map.$events.trigger($.Event(n,{control:r}))};e.getLayer=function(){var e=this;return e.options&&"boolean"==typeof e.options.layer&&!e.options.layer?null:e.layer?e.layer:e.layerPromise};e.setLayer=function(e){var t=this;t.map&&(t.layer="string"==typeof e?t.map.getLayer(e):e)};e.resetValues=function(){var e=this;e.history.length=0;e.historyIndex=0;t(e)}}();TC.control=TC.control||{};TC.control.SWCacheClient||TC.syncLoadJS(TC.apiLocation+"TC/control/SWCacheClient");TC.Consts.editMode={SELECT:"select",ADDPOINT:"addpoint",ADDLINE:"addline",ADDPOLYGON:"addpolygon"};TC.Consts.editStyles={NEW:"temporary",SELECTED:"select",DEFAULT:"default"};TC.Consts.event.POINT="point.tc";TC.Consts.event.BEFOREFEATUREMODIFY="beforefeaturemodify.tc";TC.Consts.event.FEATUREMODIFY="featuremodify.tc";TC.Consts.event.FEATURESSELECT="featureselect.tc";TC.Consts.event.FEATURESUNSELECT="featureunselect.tc";!function(){var e=0,t=function(){return"NewFeature."+e++},r=function(e,t){var r=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var n,i;switch(!0){case t instanceof TC.feature.Polygon:i=TC.Consts.geom.POLYGON;break;case t instanceof TC.feature.Polyline:i=TC.Consts.geom.POLYLINE;break;case t instanceof TC.feature.Point:i=TC.Consts.geom.POINT;break;case t instanceof TC.feature.MultiPolygon:i=TC.Consts.geom.MULTIPOLYGON;break;case t instanceof TC.feature.MultiPolyline:i=TC.Consts.geom.MULTIPOLYLINE}n={id:t.id||t.provId,attributes:t.data,type:i,geometry:t.geometry};localforage.setItem(e,n).then(function(){r.resolve({feature:t})})["catch"](function(e){r.reject({feature:t,error:e})})});return r.promise()},n=function(e){var t=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.removeItem(e).then(function(){t.resolve(e)})["catch"](function(e){t.reject(e)})});return t.promise()},i=function(e){var t=$.Deferred();TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(e).then(function(r){t.resolve({key:e,feature:r})})["catch"](function(e){t.reject(e)})});return t.promise()},a=function(e,t){return e.LOCAL_STORAGE_KEY_PREFIX+(t||e.layer.id)},s=function(e,t){return a(e,t)+e.LOCAL_STORAGE_ADDED_KEY_PREFIX},o=function(e,t){return a(e,t)+e.LOCAL_STORAGE_MODIFIED_KEY_PREFIX},l=function(e,t){return a(e,t)+e.LOCAL_STORAGE_REMOVED_KEY_PREFIX},c=function(e){e._$deleteBtn.prop("disabled",!0);e._$joinBtn.prop("disabled",!0);e._$splitBtn.prop("disabled",!0)},u=function(e){var t=!1;(TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon||TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline)&&e.geometry.length>1&&(t=!0);return t},p=function(e,t){e._$deleteBtn.prop("disabled",0===t.length);e._$joinBtn.prop("disabled",t.length<2);e._$splitBtn.prop("disabled",0===t.filter(u).length)},h=function(e,t){e._$saveBtn.prop("disabled",t);e._$discardBtn.prop("disabled",t);self.checkedOut=!t},d=function(e,t){"undefined"!=typeof t?h(e,!t):TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var t=a(e);localforage.keys().then(function(r){if(r){for(var n=!0,i=0,a=r.length;a>i;i++)if(0===r[i].indexOf(t)){n=!1;break}h(e,n)}})})},f=function(e,t){var r=$.Deferred(),n=e._changesLayers[t.id];if(n)r.resolve(n);else{n=e._changesLayers[t.id]=new TC.layer.Vector({id:TC.getUID(),title:t.title+" - cambios pendientes",stealth:!0,styles:e.getChangesLayerStyle(t)});var i=e.map.layers.indexOf(t);e.map.insertLayer(n,i+1,function(){r.resolve(n)})}return r.promise()};TC.control.Edit=function(){var e=this;TC.control.SWCacheClient.apply(this,arguments);e._classSelector="."+e.CLASS;e.$events=$(e);e.wrap=new TC.wrap.control.Edit(e);e._layerDeferred=$.Deferred();e.layer=null;e.checkedOut=!1;e.callback=arguments[2]&&$.isFunction(arguments[2])?arguments[2]:e.options.callback?e.options.callback:null;e.multi=e.options.multi?e.options.multi:!1;e.eraseActionConfirmTxt=e.options.eraseText?e.options.eraseText:"\xbfEst\xe1 seguro de eliminar esta(s) geometr\xeda(s)?";e.cancelActionConfirmTxt=e.options.cancelText?e.options.eraseText:"Si continua todos los cambios se perder\xe1n. \xbfDesea continuar?";e.styles=e.options.styles;e.features={};e.attributeEditor=null;e.pointDraw=null;e.lineDraw=null;e.polygonDraw=null;e.snapping="boolean"==typeof e.options.snapping?e.options.snapping:!0;e._changesLayers={};e._showsChanges="boolean"==typeof e.options.showChanges?e.options.showChanges:!0;$.isFunction(e.options.getChangesLayerStyleFunction)&&(e.getChangesLayerStyleFunction=e.getChangesLayerStyle);e.$events.on(TC.Consts.event.FEATUREADD,function(n){var i=n.feature;i.provId=t();var a=e._changesLayers[e.layer.id];e.features[e.layer.id].added.push(i);a.addFeature(i);r(s(e)+i.provId,i).then(function(){d(e,!0);TC.toast("Adici\xf3n guardada")},function(){TC.error("Fallo al guardar adici\xf3n")})}).on(TC.Consts.event.FEATUREREMOVE,function(t){var i=t.feature,a=i.provId||i.id,c=function(){d(e);TC.toast("Eliminaci\xf3n guardada")},u=function(){TC.error("Fallo al guardar eliminaci\xf3n")},p=e._changesLayers[e.layer.id],h=e.features[e.layer.id],f=h.added.indexOf(i);if(0>f){var m=l(e);f=h.modified.indexOf(i);if(0>f){f=h.removed.indexOf(i);if(0>f){h.removed.push(i);p.addFeature(i);r(m+i.id,i).then(c,u)}}else{h.modified.splice(f,1);h.removed.push(i);n(o(e)+i.id).then(function(){c();r(m+i.id,i).then(c,u)},u)}}else{p.removeFeature(i);h.added.splice(f,1);n(s(e)+a).then(c,u)}}).on(TC.Consts.event.FEATUREMODIFY,function(t){var n=t.feature,i=n.provId||n.id,a=function(){d(e,!0);TC.toast("Modificaci\xf3n guardada")},l=function(){TC.error("Fallo al guardar modificaci\xf3n")},c=e._changesLayers[e.layer.id],u=e.features[e.layer.id],p=u.added.indexOf(n);if(0>p){p=u.modified.indexOf(n);if(0>p){c.addFeature(n);u.modified.push(n)}r(o(e)+i,n).then(a,l)}else r(s(e)+i,n).then(a,l)}).on(TC.Consts.event.FEATUREADD+" "+TC.Consts.event.FEATUREREMOVE+" "+TC.Consts.event.FEATUREMODIFY,function(t){if(e.serviceWorkerEnabled&&navigator.onLine){var r=e.layer.wrap.getGetFeatureUrl(),n=e.layer.wrap.getDescribeFeatureTypeUrl();r&&n&&e.createCache(e.LOCAL_STORAGE_KEY_PREFIX+e.layer.id,{urlList:[r,n]})}}).on(TC.Consts.event.CONTROLDEACTIVATE,function(e){}).on(TC.Consts.event.FEATURESSELECT,function(t){var r=e.getSelectedFeatures();p(e,r);r.length&&r[0].showPopup(e.attributeEditor)}).on(TC.Consts.event.FEATURESUNSELECT,function(t){p(e,e.getSelectedFeatures())})};TC.inherit(TC.control.Edit,TC.control.SWCacheClient);var m=TC.control.Edit.prototype;m.CLASS="tc-ctl-edit";m.LOCAL_STORAGE_KEY_PREFIX="TC.offline.edit.";m.LOCAL_STORAGE_ADDED_KEY_PREFIX=".added.";m.LOCAL_STORAGE_MODIFIED_KEY_PREFIX=".modified.";m.LOCAL_STORAGE_REMOVED_KEY_PREFIX=".removed.";m.template={};if(TC.isDebug){m.template[m.CLASS]=TC.apiLocation+"TC/templates/Edit.html";m.template[m.CLASS+"-attr"]=TC.apiLocation+"TC/templates/EditAttributes.html"}else{m.template[m.CLASS]=function(){function e(e,n){return e.w("<h2>").h("i18n",n,{},{$key:"featureEdit"}).w(' <span class="tc-beta">').h("i18n",n,{},{$key:"beta"}).w('</span></h2><div class="tc-ctl-edit-layer"><select class="tc-combo tc-ctl-edit-layer-sel"><option value="">').h("i18n",n,{},{$key:"selectLayerToEdit"}).w("</option>").s(n.get(["layers"],!1),n,{block:t},{}).w('</select><input type="checkbox" id="tc-ctl-edit-view-changes-cb"').x(n.get(["showChanges"],!1),n,{block:r},{}).w(' /><label class="tc-ctl-edit-view-changes" for="tc-ctl-edit-view-changes-cb">').h("i18n",n,{},{$key:"highlightUnsyncedChanges"}).w('</label></div><div class="tc-ctl-edit-mode"><form><label class="tc-ctl-edit-btn-select" title="').h("i18n",n,{},{$key:"select"}).w('"><input type="radio" name="mode" value="select" /><span>').h("i18n",n,{},{$key:"select"}).w('</span></label><label class="tc-ctl-edit-btn-point" title="').h("i18n",n,{},{$key:"newPoint"}).w('"><input type="radio" name="mode" value="addpoint" /><span>').h("i18n",n,{},{$key:"newPoint"}).w('</span></label><label class="tc-ctl-edit-btn-line" title="').h("i18n",n,{},{$key:"newLine"}).w('"><input type="radio" name="mode" value="addline" /><span>').h("i18n",n,{},{$key:"newLine"}).w('</span></label><label class="tc-ctl-edit-btn-polygon" title="').h("i18n",n,{},{$key:"newPolygon"}).w('"><input type="radio" name="mode" value="addpolygon" /><span>').h("i18n",n,{},{$key:"newPolygon"}).w('</span></label></form></div><div class="tc-ctl-edit-select tc-hidden"><button class="tc-ctl-btn tc-ctl-edit-btn-delete" disabled title="').h("i18n",n,{},{$key:"delete"}).w('">').h("i18n",n,{},{$key:"delete"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-join" disabled title="').h("i18n",n,{},{$key:"joinGeometries.tooltip"}).w('">').h("i18n",n,{},{$key:"joinGeometries"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-split" disabled title="').h("i18n",n,{},{$key:"splitGeometry"}).w('">').h("i18n",n,{},{$key:"splitGeometry"}).w('</button><button class="tc-ctl-btn tc-ctl-edit-btn-cancel" disabled title="').h("i18n",n,{},{$key:"cancel"}).w('">').h("i18n",n,{},{$key:"cancel"}).w('</button></div><div class="tc-ctl-edit-point tc-hidden"></div><div class="tc-ctl-edit-line tc-hidden"></div><div class="tc-ctl-edit-polygon tc-hidden"></div><div class="tc-ctl-edit-save"><button class="tc-button tc-icon-button tc-ctl-edit-btn-save" disabled title="').h("i18n",n,{},{$key:"syncChanges"}).w('">').h("i18n",n,{},{$key:"syncChanges"}).w('</button><button class="tc-button tc-icon-button tc-ctl-edit-btn-discard" disabled title="').h("i18n",n,{},{$key:"discardChanges"}).w('">').h("i18n",n,{},{$key:"discardChanges"}).w("</button></div>")}function t(e,t){return e.w('<option value="').f(t.get(["id"],!1),t,"h").w('">').f(t.get(["title"],!1),t,"h").w("</option>")}function r(e,t){return e.w(" checked")}dust.register(m.CLASS,e);e.__dustBody=!0;t.__dustBody=!0;r.__dustBody=!0;return e};m.template[m.CLASS+"-attr"]=function(){function e(e,r){r=r.shiftBlocks(D);return e.w('<div class="tc-ctl-edit-attr"><h3>').h("i18n",r,{},{$key:"attributeEdit"}).w('</h3><div class="tc-ctl-edit-attr-body"><table><tbody>').s(r.get(["data"],!1),r,{block:t},{}).w('</tbody></table></div><div class="tc-ctl-edit-attr-footer"><button class="tc-button tc-ctl-edit-btn-attr-ok">').h("i18n",r,{},{$key:"ok"}).w('</button><button class="tc-button tc-ctl-edit-btn-attr-cancel">').h("i18n",r,{},{$key:"cancel"}).w("</button></div></div>")}function t(e,t){t=t.shiftBlocks(D);return e.w("<tr><th>").f(t.get(["name"],!1),t,"h").w("</th><td>").x(t.get(["readOnly"],!1),t,{"else":r,block:I},{}).w("</td></tr>")}function r(e,t){t=t.shiftBlocks(D);return e.x(t.get(["availableValues"],!1),t,{block:n},{}).h("select",t,{block:a},{key:t.get(["type"],!1)})}function n(e,t){t=t.shiftBlocks(D);return e.w('<select class="tc-combo" name="').f(t.get(["name"],!1),t,"h").w('"><option value=""></option>').s(t.get(["availableValues"],!1),t,{block:i},{}).w("</select>")}function i(e,t){t=t.shiftBlocks(D);return e.w('<option value="').f(t.getPath(!0,[]),t,"h").w('">').f(t.getPath(!0,[]),t,"h").w("</option>")}function a(e,t){t=t.shiftBlocks(D);return e.h("none",t,{block:s},{}).h("eq",t,{block:o},{value:"int"}).h("eq",t,{block:l},{value:"integer"}).h("eq",t,{block:c},{value:"double"}).h("eq",t,{block:u},{value:"boolean"}).h("eq",t,{block:p},{value:"date"}).h("eq",t,{block:h},{value:"time"}).h("eq",t,{block:d},{value:"dateTime"}).h("eq",t,{block:f},{value:"byte"}).h("eq",t,{block:y},{value:"long"}).h("eq",t,{block:g},{value:"negativeInteger"}).h("eq",t,{block:v},{value:"nonNegativeInteger"}).h("eq",t,{block:C},{value:"nonPositiveInteger"}).h("eq",t,{block:T},{value:"positiveInteger"}).h("eq",t,{block:L},{value:"short"}).h("eq",t,{block:w},{value:"unsignedLong"}).h("eq",t,{block:b},{value:"unsignedInt"}).h("eq",t,{block:S},{value:"unsignedShort"}).h("eq",t,{block:E},{value:"unsignedByte"}).h("eq",t,{block:O},{value:"float"}).h("eq",t,{block:A},{value:"decimal"})}function s(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputText"),t,{},{})}function o(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function l(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function c(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function u(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputCheckbox"),t,{},{})}function p(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputDate"),t,{},{})}function h(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputTime"),t,{},{})}function d(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputDatetime"),t,{},{})}function f(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function y(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function g(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function v(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function C(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function T(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function L(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function w(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function b(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function S(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function E(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function O(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function A(e,t){t=t.shiftBlocks(D);return e.b(t.getBlock("inputNumber"),t,{},{})}function x(e,t){t=t.shiftBlocks(D);return e.w('<input type="text" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function P(e,t){t=t.shiftBlocks(D);return e.w('<input type="number" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function _(e,t){t=t.shiftBlocks(D);return e.w('<input type="checkbox" name="').f(t.get(["name"],!1),t,"h").w('"').x(t.get(["value"],!1),t,{block:N},{}).w("/>")}function N(e,t){t=t.shiftBlocks(D);return e.w(" checked")}function M(e,t){t=t.shiftBlocks(D);return e.w('<input type="date" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function k(e,t){t=t.shiftBlocks(D);return e.w('<input type="time" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function R(e,t){t=t.shiftBlocks(D);return e.w('<input type="datetime" class="tc-textbox" name="').f(t.get(["name"],!1),t,"h").w('" value="').f(t.get(["value"],!1),t,"h").w('" />')}function I(e,t){t=t.shiftBlocks(D);return e.f(t.get(["value"],!1),t,"h")}dust.register(m.CLASS+"-attr",e);var D={inputText:x,inputNumber:P,inputCheckbox:_,inputDate:M,inputTime:k,inputDatetime:R};e.__dustBody=!0;t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;p.__dustBody=!0;h.__dustBody=!0;d.__dustBody=!0;f.__dustBody=!0;y.__dustBody=!0;g.__dustBody=!0;v.__dustBody=!0;C.__dustBody=!0;T.__dustBody=!0;L.__dustBody=!0;w.__dustBody=!0;b.__dustBody=!0;S.__dustBody=!0;E.__dustBody=!0;O.__dustBody=!0;A.__dustBody=!0;x.__dustBody=!0;P.__dustBody=!0;_.__dustBody=!0;N.__dustBody=!0;M.__dustBody=!0;k.__dustBody=!0;R.__dustBody=!0;I.__dustBody=!0;return e}}m.register=function(t){var r=this;TC.control.SWCacheClient.prototype.register.call(r,t);t.addControl("popup",{closeButton:!0}).then(function(e){r.attributeEditor=e});t.on(TC.Consts.event.LAYERUPDATE,function(t){if(t.layer.type===TC.Consts.layerType.WFS&&!t.layer.options.stealth){var n=t.layer,c=r.features[t.layer.id]=r.features[t.layer.id]||{added:[],modified:[],removed:[]};f(r,n).then(function(t){r.layer!==n&&t.setVisibility(!1);var u=a(r,n.id),p=s(r,n.id),h=o(r,n.id),d=l(r,n.id);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){TC.getUID();localforage.keys().then(function(r){if(r)for(var a=0,s=r.length;s>a;a++){var o=r[a];0===o.indexOf(u)&&i(o).then(function(r){var i,a=r.key;if(0===a.indexOf(d)){i=a.substr(d.length);var s=n.getFeatureById(i);n.removeFeature(s);t.addFeature(s);c.removed.push(s)}else if(0===a.indexOf(h)){i=a.substr(h.length);var s=n.getFeatureById(i);if(s){t.addFeature(s);c.modified.push(s);s.wrap.setGeometry(r.feature.geometry);s.setData(r.feature.attributes)}}else if(0===a.indexOf(p)){i=a.substr(p.length);var o=parseInt(i.substr(i.lastIndexOf(".")+1));e=Math.max(e,o+1);var l;switch(r.feature.type){case TC.Consts.geom.POINT:l=n.addPoint(r.feature.geometry);break;case TC.Consts.geom.POLYLINE:l=n.addPolyline(r.feature.geometry);break;case TC.Consts.geom.POLYGON:l=n.addPolygon(r.feature.geometry);break;case TC.Consts.geom.MULTIPOLYLINE:l=n.addMultiPolyline(r.feature.geometry);break;case TC.Consts.geom.MULTIPOLYGON:l=n.addMultiPolygon(r.feature.geometry)}l.then(function(e){t.addFeature(e);c.added.push(e);e.provId=i;e.setData(r.feature.attributes)})}})}})})})}}).on(TC.Consts.event.LAYERADD,function(e){if(e.layer.type===TC.Consts.layerType.WFS&&!e.layer.options.stealth){r.features[e.layer.id]=r.features[e.layer.id]||{added:[],modified:[],removed:[]};$("<option>").attr("value",e.layer.id).html(e.layer.title||e.layer.id).appendTo(r._$layerSelect)}}).on(TC.Consts.event.LAYERREMOVE,function(e){if(e.layer.type===TC.Consts.layerType.WFS&&!e.layer.options.stealth){var t=r._$layerSelect.find("option[value="+e.layer.id+"]");t.filter(":selected").length>0&&r.setLayer(null);t.remove()}}).on(TC.Consts.event.POPUP,function(e){if(e.control===r.attributeEditor){for(var t=e.control.currentFeature,n=r.attributes.slice(),i={},a=r._joinedFeatureAttributes||[],s=0,o=n.length;o>s;s++){var l=t.getData()||{},c=n[s];c.value=l[c.name];"id"===c.name&&(c.readOnly=!0);c.availableValues=[];for(var u=0,p=a.length;p>u;u++){var h=a[u][c.name];void 0!==h&&""!==h&&(c.availableValues[c.availableValues.length]=h)}i[c.name]=c.type}n.sort(function(e,t){return(e.readOnly?!t.readOnly:t.readOnly)?!e.readOnly-!t.readOnly:e.name>t.name?1:e.name<t.name?-1:0});r.getRenderedHtml(r.CLASS+"-attr",{data:n},function(e){var n=r.attributeEditor.$contentDiv;n.html(e);var a=n.find("input"),s=n.find("select");a.on("input",function(e){var t=$(e.target),r=s.filter("[name="+t.attr("name")+"]");r.val()!==t.val()&&r.val("")});s.on("change",function(e){var t=$(e.target);a.filter("[name="+t.attr("name")+"]").val(t.val())});n.find("."+r.CLASS+"-btn-attr-ok").on("click",function(){var e={};a.each(function(t,r){a=$(r);var n=a.attr("name"),s=a.val();switch(i[n]){case"int":case"integer":case"byte":case"long":case"negativeInteger":case"nonNegativeInteger":case"nonPositiveInteger":case"positiveInteger":case"short":case"unsignedLong":case"unsignedInt":case"unsignedShort":case"unsignedByte":s=parseInt(s);Number.isNaN(s)||(e[n]=s);break;case"double":case"float":case"decimal":s=parseFloat(s);Number.isNaN(s)||(e[n]=s);break;case"date":case"time":case"dateTime":e[n]=new Date(s);break;case"boolean":e[n]=!!s;break;case void 0:break;default:e[n]=s}});t.setData(e);r.$events.trigger($.Event(TC.Consts.event.FEATUREMODIFY,{feature:t,layer:r.layer}));r.attributeEditor.hide()});n.find("."+r.CLASS+"-btn-attr-cancel").on("click",function(){r.attributeEditor.hide()})})}});t.loaded(function(){if(r.options.layer)r.setLayer(r.options.layer);else{var e=t.workLayers.filter(function(e){return e.type===TC.Consts.layerType.WFS&&!e.options.stealth});r.setLayer(1===e.length?e[0].id:null)}r.showChanges(r._showsChanges);r.renderPromise().then(function(){var e="draw";$.when.apply(r,[t.addControl(e,{div:r._$div.find("."+r.CLASS+"-point"),mode:TC.Consts.geom.POINT,layer:!1}),t.addControl(e,{div:r._$div.find("."+r.CLASS+"-line"),mode:TC.Consts.geom.POLYLINE,layer:!1}),t.addControl(e,{div:r._$div.find("."+r.CLASS+"-polygon"),mode:TC.Consts.geom.POLYGON,layer:!1})]).then(function(e,t,n){r.pointDraw=e;r.lineDraw=t;r.polygonDraw=n;var i=function(e){var t,n=e.geometry;switch(r.geometryType){case TC.Consts.geom.POINT:t=TC.feature.Point;break;case TC.Consts.geom.POLYLINE:t=TC.feature.Polyline;break;case TC.Consts.geom.POLYGON:t=TC.feature.Polygon;break;case TC.Consts.geom.MULTIPOLYLINE:t=TC.feature.MultiPolyline;break;case TC.Consts.geom.MULTIPOLYGON:t=TC.feature.MultiPolygon}t&&(n=new t(n.geometry,{geometryName:r.layer.options.geometryName}));r.layer.addFeature(n);r.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:n}))},a=function(){r.cancel()};e.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,a);t.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,a);n.on(TC.Consts.event.DRAWEND,i).on(TC.Consts.event.DRAWCANCEL,a);r.options.modes&&$.isArray(r.options.modes)&&1==r.options.modes.length&&r.setMode(r.options.modes[0],null)})})})};m.render=function(e){var t=this,r=[];if(t.map)for(var n=0,i=t.map.workLayers.length;i>n;n++){var a=t.map.workLayers[n];a.type!==TC.Consts.layerType.WFS||a.options.stealth||r.push({id:a.id,title:a.title||a.id})}TC.Control.prototype.renderData.call(t,{layers:r,showChanges:t.showChanges},function(){t._$layerDiv=t._$div.find(t._classSelector+"-layer");t._$layerSelect=t._$layerDiv.find(t._classSelector+"-layer-sel").on("change",function(e){t.setLayer(t._$layerSelect.val())});t._$layerDiv.find("#"+t.CLASS+"-view-changes-cb").on("change",function(e){t.showChanges($(e.target).prop("checked"));

});t._$cancelBtn=t._$div.find(t._classSelector+"-btn-cancel").on("click",function(){t.cancel()});t._$deleteBtn=t._$div.find(t._classSelector+"-btn-delete").on("click",function(){TC.confirm(t.eraseActionConfirmTxt,function(){t.deleteFeatures(t.getSelectedFeatures())})});t._$joinBtn=t._$div.find(t._classSelector+"-btn-join").on("click",function(){t.joinFeatures(t.getSelectedFeatures())});t._$splitBtn=t._$div.find(t._classSelector+"-btn-split").on("click",function(){t.splitFeatures(t.getSelectedFeatures())});t._$saveBtn=t._$div.find(t._classSelector+"-btn-save").on("click",function(){t.applyEdits()});t._$discardBtn=t._$div.find(t._classSelector+"-btn-discard").on("click",function(){t.discardEdits()});if(t.options.modes&&$.isArray(t.options.modes)&&t.options.modes.length>0){for(var r in TC.Consts.editMode)if("string"==typeof r&&t.options.modes.indexOf(TC.Consts.editMode[r])<0){$("label"+t._classSelector+"-btn-"+TC.Consts.editMode[r],t._$div).remove();$("div"+t._classSelector+"-"+TC.Consts.editMode[r],t._$div).remove()}if(1==t.options.modes.length){var n=t.options.modes[0];$("label"+t._classSelector+"-btn-"+n,t._$div).css("display","none")}}t._$div.find("input[type=radio][name=mode]").on("change",function(){var e=$(this),r=e.val(),n=t.mode===r?void 0:r;t.setMode(n)});$.isFunction(e)&&e()})};m.setLayer=function(e){var t=this;t.layer=map.getLayer(e);t.setMode(null);var r="input[type=radio][name=mode]";if(t.layer){f(t,t.layer).then(function(e){for(var r in t._changesLayers){var n=t._changesLayers[r];n.setVisibility(t._showsChanges&&n===e)}});t.layer.describeFeatureType().then(function(e){t.attributes=e.filter(function(e){switch(e.type){case"gml:LinearRingPropertyType":case"gml:PolygonPropertyType":t.geometryType=TC.Consts.geom.POLYGON;return!1;case"gml:MultiPolygonPropertyType":case"gml:MultiSurfacePropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYGON;return!1;case"gml:LineStringPropertyType":t.geometryType=TC.Consts.geom.POLYLINE;return!1;case"gml:MultiLineStringPropertyType":t.geometryType=TC.Consts.geom.MULTIPOLYLINE;return!1;case"gml:PointPropertyType":case"gml:MultiPointPropertyType":t.geometryType=TC.Consts.geom.POINT;return!1;case"gml:BoxPropertyType":t.geometryType=TC.Consts.geom.RECTANGLE;return!1;case"gml:GeometryCollectionPropertyType":case"gml:GeometryAssociationType":return!1;default:return!0}});for(var n=0,i=t.attributes.length;i>n;n++){var a=t.attributes[n];a.type=a.type.substr(a.type.indexOf(":")+1)}t.renderPromise().then(function(){d(t);t._$div.find(t._classSelector+"-layer-sel").val(t.layer.id);$rb=t._$div.find(r);var e;switch(t.geometryType){case TC.Consts.geom.POINT:e="[value=select],[value="+TC.Consts.editMode.ADDPOINT+"]";break;case TC.Consts.geom.POLYLINE:case TC.Consts.geom.MULTIPOLYLINE:e="[value=select],[value="+TC.Consts.editMode.ADDLINE+"]";break;case TC.Consts.geom.POLYGON:case TC.Consts.geom.MULTIPOLYGON:e="[value=select],[value="+TC.Consts.editMode.ADDPOLYGON+"]";break;default:e="[value]"}var n=$rb.filter(e).attr("disabled",!1);$rb.not(n).attr("disabled",!0)})});t._layerDeferred.resolve(t.layer)}else{t.renderPromise().then(function(){d(t,!1);$rb=t._$div.find(r).attr("disabled",!0);$rb.each(function(e,t){$(t).prop("checked",!1)})});t._layerDeferred.resolve(null)}};m.setMode=function(e){var t=this;t.mode=e;c(t);var r,n,i=function(e){if(e){t.snapping&&(e.snapping=t.layer);e.activate()}};switch(e){case TC.Consts.editMode.SELECT:r=t._$div.find(t._classSelector+"-select");n=t._$div.find(t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.activate();break;case TC.Consts.editMode.ADDPOINT:r=t._$div.find(t._classSelector+"-point");n=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-line,"+t._classSelector+"-polygon");i(t.pointDraw);break;case TC.Consts.editMode.ADDLINE:r=t._$div.find(t._classSelector+"-line");n=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-polygon");i(t.lineDraw);break;case TC.Consts.editMode.ADDPOLYGON:r=t._$div.find(t._classSelector+"-polygon");n=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line");i(t.polygonDraw);break;default:r=$();n=t._$div.find(t._classSelector+"-select,"+t._classSelector+"-point,"+t._classSelector+"-line,"+t._classSelector+"-polygon");t.isActive&&t.deactivate();t.pointDraw&&t.pointDraw.isActive&&t.pointDraw.deactivate();t.lineDraw&&t.lineDraw.isActive&&t.lineDraw.deactivate();t.polygonDraw&&t.polygonDraw.isActive&&t.polygonDraw.deactivate()}var a;if(e){a=t._$div.find("input[type=radio][name=mode][value="+e+"]").prop("checked",!0).addClass(TC.Consts.classes.CHECKED);a.next().addClass(TC.Consts.classes.CHECKED)}else{a=t._$div.find("input[type=radio][name=mode]").prop("checked",!1).removeClass(TC.Consts.classes.CHECKED);a.next().removeClass(TC.Consts.classes.CHECKED)}r.removeClass(TC.Consts.classes.HIDDEN);n.addClass(TC.Consts.classes.HIDDEN)};m.showChanges=function(e){var t=this;t._showsChanges=e;for(var r in t._changesLayers){var n=t._changesLayers[r];n.setVisibility(e&&t.layer&&r===t.layer.id)}};m.cancel=function(){var e=this;e.options.modes&&$.isArray(e.options.modes)&&1==e.options.modes.length?e.setMode(e.options.modes[0],null):e.setMode(null,!1);e.wrap.cancel(!0,e.cancelActionConfirmTxt)};m.onFeatureClick=function(e){self.activeControl&&self.activeControl.isExclusive()||e.feature.show()};m.activate=function(e){var t=this;TC.Control.prototype.activate.call(t);var r=e||{};t._$cancelBtn.prop("disabled",!1);$.when(t.getLayer()).then(function(){t.wrap.activate(r.mode?r.mode:t.mode);TC.Control.prototype.activate.call(t)})};m.deactivate=function(){var e=this;TC.Control.prototype.deactivate.call(e);e.wrap.cancel(!0);e._$cancelBtn.prop("disabled",!0);e.wrap.deactivate()};m.isExclusive=function(){return!0};m.joinFeatures=function(e){var t=this;if(t.geometryType===TC.Consts.geom.MULTIPOLYLINE||t.geometryType===TC.Consts.geom.MULTIPOLYGON||t.geometryType===TC.Consts.geom.MULTIPOINT){t._joinedFeatureAttributes=[];if(e.length>1){for(var r=e.map(function(e){t._joinedFeatureAttributes[t._joinedFeatureAttributes.length]=e.getData();return e.geometry}),n=r.reduce(function(e,t){return e.concat(t)}),i=new e[0].constructor(n),a=0,s=e.length;s>a;a++){var o=e[a];t.layer.removeFeature(o);t.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{feature:o}))}t.layer.addFeature(i).then(function(e){t.setSelectedFeatures([i]);t.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:e}));e.showPopup(t.attributeEditor)})}p(t,[i])}};m.splitFeatures=function(e){for(var t=this,r=e.filter(u),n=r.map(function(e){return e.geometry}),i=[],a=0,s=r.length;s>a;a++)for(var o=r[a],l=o.getData(),c=n[a],h=0,d=c.length;d>h;h++)i[i.length]=new o.constructor([c[h]],{data:l});for(var a=0,f=r.length;f>a;a++){var o=r[a];t.layer.removeFeature(o);t.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{feature:o}))}for(var m=new Array(i.length),a=0,f=i.length;f>a;a++){var y=m[a]=t.layer.addFeature(i[a]);y.then(function(e){t.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{feature:e}))})}$.when.apply(this,m).then(function(){t.setSelectedFeatures(i)});p(t,i)};m.deleteFeatures=function(e){var t=this;t.wrap.deleteFeatures(e);0===t.layer.features.length&&t._$deleteBtn.prop("disabled",!0)};m.applyEdits=function(){var e=this;if(e.layer){var t=e.features[e.layer.id];e.layer.applyEdits(t.added,t.modified,t.removed).then(function(){e.discardEdits();e.map.toast("Cambios sincronizados con \xe9xito con el servidor")},function(e){TC.error("Error ["+e.code+"] al guardar cambios: "+e.reason)})}};m.discardEdits=function(){var e=this;e._joinedFeatureAttributes=[];var t=a(e);TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.keys().then(function(r){if(r){for(var n=0,i=r.length;i>n;n++){var a=r[n];0===a.indexOf(t)&&localforage.removeItem(a)}if(e.layer){var s=e.features[e.layer.id];s.added.length=0;s.modified.length=0;s.removed.length=0;e.setSelectedFeatures([]);e.attributeEditor.hide();var o=e._changesLayers[e.layer.id];o.clearFeatures();e.deleteCache(t).then(function(){e.layer.refresh()})}d(e,!1)}})})};m.getSelectedFeatures=function(){return this.wrap.getSelectedFeatures()};m.setSelectedFeatures=function(e){return this.wrap.setSelectedFeatures(e)};m.getLayer=function(){var e=this;return e.layer||e._layerDeferred};m.getChangesLayerStyle=function(e){var t=function(t){for(var r,n=e.wrap.getRGBA(t),i=0;3>i;i++)n[i]=255-n[i];r=(65536*n[0]+256*n[1]+n[2]).toString(16);4===r.length?r="00"+r:5===r.length&&(r="0"+r);return"#"+r},r=[1,3],n=$.extend(!0,{},e.options.styles);if(n.point){n.point.strokeColor=t(n.point.strokeColor);n.point.lineDash=r}if(n.line){n.line.strokeColor=t(n.line.strokeColor);n.line.lineDash=r}if(n.polygon){n.polygon.strokeColor=t(n.polygon.strokeColor);n.polygon.lineDash=r}return n}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ExternalWMS=function(e){if(TC.isLegacy)console.warn("El control ExternalWMS no soporta modo legacy");else{var t=this;this.count=0;this._addedUrls=[];TC.Control.apply(t,arguments)}};TC.inherit(TC.control.ExternalWMS,TC.Control);!function(){var e=TC.control.ExternalWMS.prototype;e.CLASS="tc-ctl-xwms";e.markServicesAsSelected=function(e){if(e.length>0){var t=$(e[0]);t.attr("disabled","true");t.addClass("tc-ctl-xwms-option-selected")}};e.register=function(e){if(TC.isLegacy)console.warn("El control ExternalWMS no soporta modo legacy");else{var t=this;TC.Control.prototype.register.call(t,e);t._$div.on("change","select",function(e){if(""!=this.value){var r=this.value;0===r.indexOf("//")&&(r=location.protocol+r);t._$div.find("input").val(r);$(this).val("")}});var r=function(e){for(var t=["version","service","request"],r=0;r<t.length;r++)e=TC.Util.removeURLParameter(e,t[r]);e.match(/\?$/)&&(e=e.substr(0,e.length-1));return e};t._$div.on("click","button[name='agregar']",function(e){var n=t._$div.find("input").val();if(n)if(/^((https?|ftp):)?(\/\/)?(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(n))if(t._addedUrls.indexOf(n)>-1)TC.alert(t.getLocaleString("serviceAlreadyAdded"));else{n=r(n);var i=t.map.getControlsByClass("TC.control.LoadingIndicator")[0];i.show();var a=t._$div.find("button");a.attr("disabled","true");for(var s={id:"xwms"+ ++t.count,type:"WMS",url:n,hideTree:!1},o=0;o<t.options.suggestions.length;o++){var l=$.grep(t.options.suggestions[o].items,function(e,t){return e.url===n});if(l.length>0&&l[0].layerNames){s.layerNames=l[0].layerNames;break}}var c=new TC.layer.Raster(s);c.getCapabilitiesPromise().then(function(e){if("undefined"!=typeof e.Capability){var r=e.Capability.Layer;if(r.CRS&&-1==r.CRS.indexOf(t.map.crs)){TC.alert(t.getLocaleString("serviceSrsNotCompatible"));i.hide();a.removeAttr("disabled")}else{t.map.$events.trigger($.Event(TC.Consts.event.EXTERNALSERVICEADDED,{layer:c}));t._$div.find("input").val("");var s=t._$div.find("select option[value='"+n+"']");t.markServicesAsSelected(s);t._addedUrls.push(n);i.hide();a.removeAttr("disabled")}}else{TC.alert(t.getLocaleString("noLayersFoundInService"));i.hide();a.removeAttr("disabled")}},function(e){TC.alert(t.getLocaleString("serviceCouldNotBeLoaded")+":\n"+e);i.hide();a.removeAttr("disabled")})}else TC.alert(t.getLocaleString("typeAValidAddress"));else TC.alert(t.getLocaleString("typeAnAddress"))});e.on(TC.Consts.event.LAYERADD,function(e){if(e.layer&&!e.layer.isBase){var r=e.layer.url,n=t._$div.find("select option").filter(function(e,t){return TC.Util.addProtocol(t.value)===TC.Util.addProtocol(r)});t.markServicesAsSelected(n);t._addedUrls.push(r)}})}};e.template={};e.template[e.CLASS]=TC.isDebug?TC.apiLocation+"TC/templates/ExternalWMS.html":function(){function t(e,t){return e.x(t.get(["title"],!1),t,{block:r},{}).w('<div><div class="tc-group tc-ctl-xwms-cnt"> <select id="add-wms-select" class="tc-combo" title="WMS (Web Map Service)"><option value="">WMS</option>').s(t.get(["suggestions"],!1),t,{block:n},{}).w('</select><input type="text" class="tc-textbox" placeholder="').h("i18n",t,{},{$key:"writeAddressOrSelect"}).w('" /></div><div class="tc-group tc-group tc-ctl-xwms-cnt" style="text-align:right;"><button type="button" class="tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"addService.title"}).w('" name="agregar">').h("i18n",t,{},{$key:"addService"}).w("</button></div></div>")}function r(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"addMaps"}).w("</h2>")}function n(e,t){return e.x(t.get(["group"],!1),t,{block:i},{}).s(t.get(["items"],!1),t,{block:a},{}).x(t.get(["group"],!1),t,{block:s},{})}function i(e,t){return e.w('<optgroup label="').f(t.get(["group"],!1),t,"h").w('">')}function a(e,t){return e.w('<option value="').f(t.get(["url"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w("</option>")}function s(e,t){return e.w("	</optgroup>")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;return t};e.render=function(e){var t=this;t.renderData(t.options)}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.FeatureInfo=function(){var e=this;TC.control.FeatureInfoCommons.apply(this,arguments);e.wrap=new TC.wrap.control.FeatureInfo(e);TC.Consts.classes.FROMLEFT="tc-fromleft";TC.Consts.classes.FROMRIGHT="tc-fromright";e.callback=function(t,r){for(var n=!1,i=0;i<e.map.workLayers.length;i++){var a=e.map.workLayers[i];if(a.type===TC.Consts.layerType.WMS&&a.getVisibility()&&a.names.length>0){n=!0;break}}n?e.wrap.getFeatureInfo(r):e.map.$events.trigger($.Event(TC.Consts.event.NOFEATUREINFO,{xy:r,control:e}))}};TC.inherit(TC.control.FeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.FeatureInfo.prototype;e.FEATURE_PARAM="showfeature";var t=TC.apiLocation+"lib/jshash/md5-min.js",r=function(e,r){if(0!==jQuery.grep(e.map.workLayers,function(e,t){return e.type===TC.Consts.layerType.WMS&&e.url===r.s&&e.getDisgregatedLayerNames().indexOf(r.l)>=0}).length){e.sharedFeatureInfo=r;TC.loadJS(!window.hex_md5,[t],function(){var t=e.map.options.pixelTolerance||TC.Cfg.pixelTolerance,n=2*t+1,i=[t,t],a=n*r.r/2,s=[r.xy[0]-a,r.xy[1]-a,r.xy[0]+a,r.xy[1]+a];e.beforeGetFeatureInfo({xy:i,control:e});e.wrap.getFeatureInfo(i,{serviceUrl:r.s,layerName:r.l,featureId:r.f,mapSize:[n,n],boundingBox:s})})}else TC.error(TC.Util.getLocaleString(e.map.options.locale,"sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)},n=function i(e,t){var r;if($.isArray(e)){r=e.slice();for(var n=0,a=r.length;a>n;n++)r[n]=i(r[n])}else r="number"==typeof e?Math.round(e.toFixed(t)):e;return r};e.register=function(e){var t=this;TC.control.FeatureInfoCommons.prototype.register.call(t,e);t._$div.appendTo("<div>");e.loaded(function(){t._layersDeferred.then(function(){var e=TC.Util.getParameterByName(t.FEATURE_PARAM);if(e){var n;try{n=JSON.parse(decodeURIComponent(escape(window.atob(e))))}catch(i){TC.error(TC.Util.getLocaleString(t.map.options.locale,"sharedFeatureNotValid"),TC.Consts.msgErrorMode.TOAST)}n&&r(t,n)}})})};e.beforeGetFeatureInfo=function(e){var t=this;TC.control.FeatureInfoCommons.prototype.beforeGetFeatureInfo.call(t,e);if(e.control===t&&t.map&&t.filterLayer){for(var r=null;!r;)r=t.map.getCoordinateFromPixel(e.xy);var n=t.getLocaleString("featureInfo"),i=$.extend({},t.map.options.styles.marker,t.markerStyle,{title:n,set:n});t.displayMode!==TC.control.FeatureInfoCommons.POPUP&&(i.showsPopup=!1);t.filterLayer.clearFeatures();$.when(t.filterLayer.addMarker(r,i)).then(function(e){if(null===t.lastFeatureCount){t.map.putLayerOnTop(t.filterLayer);t.filterFeature=e}else t.filterLayer.clearFeatures()})}};e.onShowModal=function(){var e=this,r=e.getDisplayTarget().find("ul."+e.CLASS+"-features li."+TC.Consts.classes.CHECKED),i=e._shareCtl;i.extraParams=null;var a=r.parents("li").first(),s=a.parents("li").first(),o=e.info.services[s.index()];if(o){var l=o.layers[a.index()];if(l){var c=l.features[r.index()];TC.loadJS(!window.hex_md5,[t],function(){var t=hex_md5(JSON.stringify({data:c.getData(),geometry:n(c.geometry,TC.Consts.DEGREE_PRECISION)}));i.extraParams={};i.extraParams[e.FEATURE_PARAM]=window.btoa(unescape(encodeURIComponent(JSON.stringify({xy:c.wrap.getInnerPoint(),r:e.map.getResolution(),s:o.mapLayer.url,l:l.name,f:c.id,h:t}))));var r=i._$div;r.find(".tc-url input[type=text]").val(i.generateLink());r.find(".tc-iframe input[type=text]").val(i.generateIframe())})}}};e.responseCallback=function(e){var t=this;if(t.filterFeature){var r=e.services;t.info={services:r,defaultFeature:e.defaultFeature};for(var i=0;i<r.length;i++){for(var a=r[i],s=0;s<a.layers.length;s++)if(!a.layers[s].features.length){a.layers.splice(s,1);s-=1}if(!a.layers.length){r.splice(i,1);i-=1}}if(r.length)t.renderData(e,function(){t._$div.find("td."+t.CLASS+"-val").each(function(e,r){var n=$(r),i=n.text();TC.Util.isURL(i)&&n.html('<a href="'+i+'" target="_blank" title="'+t.getLocaleString("linkInNewWindow")+'">'+i+"</a>")});if(t.sharedFeatureInfo){t._$div.find("ul."+t.CLASS+"-services li").addClass(TC.Consts.classes.CHECKED);for(var e,r=t.sharedFeatureInfo,i=0,a=t.info.services.length;a>i;i++){var s=t.info.services[i];if(s.mapLayer.url===r.s){for(var o=0,l=s.layers.length;l>o;o++){var c=s.layers[o];if(c.name===r.l){for(var u=0,p=c.features.length;p>u;u++){var h=c.features[u];if(h.id===r.f){e=h;var d=hex_md5(JSON.stringify({data:h.getData(),geometry:n(h.geometry,TC.Consts.DEGREE_PRECISION)}));r.h!==d&&TC.alert(t.getLocaleString("finfo.featureChanged.warning"));break}}break}}break}}e&&t.map.addControl(new TC.control.Popup({div:TC.Util.getDiv(),closeButton:!0})).then(function(r){e.data=t._$div.html();r.$popupDiv.addClass(t.CLASS+"-lite");t.getLocaleString("deleteFeature");t.getRenderedHtml(t.CLASS+"-del-btn",null,function(e){r.$popupDiv.append(e);r.$popupDiv.find("."+t.CLASS+"-del-btn").on(TC.Consts.event.CLICK,function(e){TC.confirm(t.getLocaleString("deleteFeature.confirm"),function(){t.map.removeLayer(t.sharedFeatureLayer);delete t.sharedFeatureLayer})})});e.showsPopup=!0;e.popup=r;t.map.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,title:t.getLocaleString("foi")}).then(function(r){t.sharedFeatureLayer=r;t.filterLayer.clearFeatures();r.addFeature(e);t.map.zoomToFeatures([e])});t.map.on(TC.Consts.event.POPUP,function(n){n.control===r&&r.$popupDiv.find("table").on(TC.Consts.event.CLICK,function(r){t.map.zoomToFeatures([e])})})});delete t.sharedFeatureInfo}else t.displayResults()});else{t.resultsLayer.clearFeatures();t.filterLayer.clearFeatures()}}}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FileImport=function(){var e=this;TC.Control.apply(e,arguments);e.formats=$.isArray(e.options.formats)?e.options.formats:[TC.Consts.format.KML,TC.Consts.format.GML,TC.Consts.format.GML2,TC.Consts.format.GEOJSON,TC.Consts.format.WKT,TC.Consts.format.GPX];e.apiAttribution="";e.mainDataAttribution="";e.dataAttributions=[]};TC.inherit(TC.control.FileImport,TC.Control);!function(){var e=TC.control.FileImport.prototype;e.CLASS="tc-ctl-file";e.template=TC.isDebug?TC.apiLocation+"TC/templates/FileImport.html":function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"openFile"}).w("</h2><div><p>").h("i18n",t,{},{$key:"fileImport.instructions"}).w('</p><div class="tc-ctl-file-open"><label class="tc-button tc-ctl-file-open-label tc-icon-button"><input type="file" class="tc-ctl-file-open-ipt tc-button" accept="').s(t.get(["formats"],!1),t,{block:r},{}).w('" />').h("i18n",t,{},{$key:"openFile"}).w("</label></div></div>")}function r(e,t){return e.w(".").f(t.getPath(!0,[]),t,"h").h("sep",t,{block:n},{})}function n(e,t){return e.w(",")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.options.enableDragAndDrop&&e.wrap.enableDragAndDrop(t.options);e.on(TC.Consts.event.FEATURESIMPORT,function(r){var n="."+TC.Consts.format.GPX.toLowerCase();r.fileName.toLowerCase().indexOf(n)!==r.fileName.length-n.length&&e.addLayer({id:TC.getUID(),title:r.fileName,type:TC.Consts.layerType.VECTOR}).then(function(n){for(var i="EPSG:4326",a=function(e){var r=e.geometry;if(r){var n=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(r.join(" "));n&&n.length>=3&&Math.abs(n[1])<=180&&Math.abs(n[3])<=90&&e.setCoords(TC.Util.reproject(r,i,t.map.crs))}return e},s=0,o=r.features.length;o>s;s++){var l=a(r.features[s]);n.addFeature(l)}setTimeout(function(){e.zoomToFeatures(n.features)},100)})}).on(TC.Consts.event.FEATURESIMPORTERROR,function(e){var r,n=e.file.name;r=".kmz"===n.toLowerCase().substr(n.length-4)?"fileImport.error.reasonKmz":"fileImport.error.reasonUnknown";TC.error(t.getLocaleString(r,{fileName:n}),TC.Consts.msgErrorMode.TOAST);var i=new FileReader;i.onload=function(e){TC.error("Nombre del archivo: "+n+" \n Contenido del archivo: \n\n"+e.target.result,TC.Consts.msgErrorMode.EMAIL,"Error en la subida de un archivo")};i.readAsText(e.file)})};e.render=function(){var e=this;e.renderData({formats:e.formats},function(){e._$div.find("input[type=file]").on(TC.Consts.event.CLICK,function(e){$(this).wrap("<form>").closest("form").get(0).reset();$(this).unwrap()}).on("change",function(t){if(e.map){console.log("salta el change");e.map.wrap.loadFiles(t.target.files)}})})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.FullScreen=function(){var e=this;TC.Control.apply(e,arguments);e.fullScreenElement=document.documentElement};TC.inherit(TC.control.FullScreen,TC.Control);!function(){var e=TC.control.FullScreen.prototype;e.CLASS="tc-ctl-fscreen";e.template=TC.isDebug?TC.apiLocation+"TC/templates/FullScreen.html":function(){function t(e,t){return e.w('<button class="tc-ctl-fscreen-btn" title="').h("i18n",t,{},{$key:"fscreen.tip"}).w('"></button>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.renderPromise().then(function(){var e=t._$div.find("."+t.CLASS+"-btn");if(t.enabledFullScreen()){e.on("click",function(){t.toggleFullScreen()});$(document).on("fullscreenchange mozfullscreenchange webkitfullscreenchange MSFullscreenChange",function(){e.toggleClass(TC.Consts.classes.ACTIVE,t.isFullScreen());e.attr("title",t.getLocaleString(t.isFullScreen()?"fscreen.tip.return":"fscreen.tip"))})}else e.addClass(TC.Consts.classes.HIDDEN)})};e.requestFullScreen=function(){var e=this,t=e.fullScreenElement;document.documentElement.requestFullScreen?t.requestFullScreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):t.msRequestFullscreen&&t.msRequestFullscreen()};e.cancelFullScreen=function(){document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()};e.isFullScreen=function(){return document.fullScreenElement||document.mozFullScreen||document.webkitIsFullScreen||document.msFullscreenElement};e.toggleFullScreen=function(){var e=this;e.isFullScreen()?e.cancelFullScreen():e.requestFullScreen()};e.enabledFullScreen=function(){var e=this,t=e.fullScreenElement,r=document.documentElement.requestFullScreen||t.mozRequestFullScreen||t.webkitRequestFullScreen||t.msRequestFullscreen;return r&&"function"==typeof r}}();!function(){Math.hypot=Math.hypot||function(){for(var e=0,t=arguments.length,r=0;t>r;r++){if(arguments[r]===1/0||arguments[r]===-(1/0))return 1/0;e+=arguments[r]*arguments[r]}return Math.sqrt(e)}}();!function(){for(var e=0,t=["ms","moz","webkit","o"],r=!(!window.performance||!window.performance.now),n=0,i=t.length;i>n&&!window.requestAnimationFrame;n+=1){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,r){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),a=window.setTimeout(function(){t(n+i)},i);e=n+i;return a});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});if(!r){var a=window.requestAnimationFrame,s=+new Date;window.requestAnimationFrame=function(e,t){var r=function(t){var r=1e12>t?t:t-s;return e(r)};a(r,t)}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Geolocation=function(e){var t=this;t.$events=$(t);t._classSelector="."+t.CLASS;t.Const={Classes:{ACTIVE:"tc-ctl-geolocation-active",CLOSED:"closed",SELECTEDTRACK:"selectedTrack",DRAWACTIVATED:"draw-activated",SIMULATIONACTIVATED:"simulation-activated"},Selector:{SIMULATE:".tc-btn-simulate",DRAW:".tc-draw",EDIT:".tc-btn-edit",DELETE:".tc-btn-delete",SAVE:".tc-btn-save",CANCEL:".tc-btn-cancel",EXPORT_GPX:".tc-btn-export-gpx",EXPORT_KML:".tc-btn-export-kml",STOP:".tc-btn-stop",PAUSE:".tc-btn-pause",BACKWARD:".tc-btn-backward",FORWARD:".tc-btn-forward",SPEED:".tc-spn-speed"},LocalStorageKey:{TRACKING:"trk",TRACKINGTEMP:"trktemp",TRACKINGSHOWADVERTISEMENT:"trkAdvertisement",GPSSHOWADVERTISEMENT:"gpsAdvertisement",TEST:"test"},Message:{VALIDATENAME:""},Event:{POSITIONCHANGE:"positionchange.tc.geolocation",GPSPOSITIONCHANGE:"gpspositionchange.tc.geolocation",GPSPOSITIONERROR:"positionerror.tc.geolocation",STATEUPDATED:"stateupdated.tc.geolocation",GPSADD:"gpsadd.tc.geolocation",TRACKSNAPPING:"tracksnapping.tc.geolocation",DRAWTRACK:"drawtrack.tc.geolocation",CLEARTRACK:"cleartrack.tc.geolocation",IMPORTEDTRACK:"importedtrack.tc.geolocation"},MimeMap:{KML:"application/vnd.google-earth.kml+xml",GPX:"application/gpx+xml"},SupportedFileExtensions:[".kml",".gpx"],Tabs:{GPS:"gps"},Layers:{GPS:"gps",TRACK:"track",TRACKING:"tracking"}};TC.Control.apply(t,arguments);var r=e||{};t._$dialogDiv=$(TC.Util.getDiv(r.dialogDiv));r.dialogDiv||t._$dialogDiv.appendTo("body");t.delta=500;t.walkingSpeed=5e3;t.gapHill=t.options.gapHill||20};TC.inherit(TC.control.Geolocation,TC.Control);!function(){var e=TC.control.Geolocation.prototype;e.CLASS="tc-ctl-geolocation";TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";TC.Consts.event.TOOLSOPEN=TC.Consts.event.TOOLSOPEN||"toolsopen.tc";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Geolocation.html";e.template[e.CLASS+"-track-node"]=TC.apiLocation+"TC/templates/GeolocationTrackNode.html";e.template[e.CLASS+"-track-snapping-node"]=TC.apiLocation+"TC/templates/GeolocationTrackSnappingNode.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/GeolocationDialog.html";e.template[e.CLASS+"-tracking-toast"]=TC.apiLocation+"TC/templates/GeolocationTrackingToast.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"geo"}).w('</h2><div class="tc-ctl-geolocation-content"> <div class="tc-ctl-geolocation-track"><div class="tc-ctl-geolocation-track-snap-info"></div><div class="tc-ctl-geolocation-info-tracking tc-hidden"><div class="tc-ctl-p-results"><div class="prpanel-group prsidebar-body "><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><label>').h("i18n",t,{},{$key:"geo.mylocation"}).w('</label> <span id="trackingInfoClose" class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",t,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span id="trackingInfoMin" class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",t,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span> </h4></div><div id="results" class="prpanel-collapse"><div class="prpanel-body list-group"> </div> </div></div></div><div id="trackingInfoMax" class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",t,{},{$key:"geo.trk.panel.3"}).w('"><i class="fa fa-list-alt"></i></div></div></div><!-- img se insertan en el div del mapa--> <div id="tc-ctl-geolocation-track-elevation-marker" class="tc-ctl-geolocation-trackMarker elevation" style="display: none;" /> <div class="tc-ctl-geolocation-track-panel-block"><input id="tc-ctl-geolocation-track-panel-opened" type="checkbox" checked/><label for="tc-ctl-geolocation-track-panel-opened" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.1"}).w('">').h("i18n",t,{},{$key:"geo.trk.panel.help.2"}).w('</label><i class="tc-ctl-geolocation-track-panel-help icon-question-sign" title="').h("i18n",t,{},{$key:"geo.trk.panel.help.3"}).w('"></i></div><div class="tc-ctl-geolocation-track-mng"><div class="tc-ctl-geolocation-select"><form> <label class="tc-ctl-geolocation-btn-track" title="').h("i18n",t,{},{$key:"geo.track.title"}).w('"><input type="radio" name="mode" value="tracks" /><span>').h("i18n",t,{},{$key:"geo.gps"}).w('</span></label><label class="tc-ctl-geolocation-btn-tracks" title="').h("i18n",t,{},{$key:"geo.tracks.title"}).w('"><input type="radio" name="mode" value="track-available" /><span>').h("i18n",t,{},{$key:"geo.tracks"}).w('</span></label> </form></div> <div class="tc-ctl-geolocation-track-available tc-ctl-geolocation-track-cnt tc-ctl-geolocation-panel tc-hidden"><i class="tc-ctl-geolocation-track-search-icon"></i><input id="tc-ctl-geolocation-track-available-srch" type="search" list="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-srch tc-textbox" placeholder="').h("i18n",t,{},{$key:"geo.filter.plhr"}).w('" maxlength="200" /> <ol id="tc-ctl-geolocation-track-available-lst" class="tc-ctl-geolocation-track-available-lst"><li class="tc-ctl-geolocation-track-available-empty"><span>').h("i18n",t,{},{$key:"geo.noTracks"}).w('</span></li><li class="tc-ctl-geolocation-track-not" hidden><span>').h("i18n",t,{},{$key:"noMatches"}).w('</span></li></ol><div class="tc-ctl-geolocation-track-cnt"><input name="uploaded-file" id="uploaded-file" type="file" class="tc-ctl-geolocation-track-import tc-button" accept=".gpx,.kml" disabled /><label class="tc-button tc-icon-button" for="uploaded-file" title="').h("i18n",t,{},{$key:"geo.trk.import.upload"}).w('">').h("i18n",t,{},{$key:"geo.trk.import.lbl"}).w('</label></div></div><div class="tc-ctl-geolocation-tracks tc-ctl-geolocation-panel tc-hidden"> <div class="tc-alert alert-warning tc-hidden"><p id="panel-msg">').h("i18n",t,{},{$key:"geo.trk.panel.1"}).w(" <ul><li>").h("i18n",t,{},{$key:"geo.trk.panel.2"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.3"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.4"}).w("</li><li>").h("i18n",t,{},{$key:"geo.trk.panel.5"}).w('</li></ul></p></div> <div class="tc-ctl-geolocation-track-ui"> <div class="tc-ctl-geolocation-track-render"><input id="tc-ctl-geolocation-track-render" type="checkbox" hidden checked /><label for="tc-ctl-geolocation-track-render" class="tc-ctl-geolocation-track-render" title="').h("i18n",t,{},{
$key:"geo.trk.render"}).w('">').h("i18n",t,{},{$key:"geo.trk.render"}).w('</label></div><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-activate" title="').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.activate"}).w('</button><button class="tc-button tc-icon-button tc-ctl-geolocation-track-ui-deactivate tc-hidden" title="').h("i18n",t,{},{$key:"geo.track.deactivate.title"}).w('">').h("i18n",t,{},{$key:"geo.track.deactivate"}).w('</button></div><div class="tc-ctl-geolocation-track-current tc-ctl-geolocation-track-cnt"><input type="text" class="tc-ctl-geolocation-track-title tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.name.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-save" disabled title="').h("i18n",t,{},{$key:"geo.trk.name.save"}).w('"></button><input type="text" class="tc-ctl-geolocation-track-waypoint tc-textbox" disabled placeholder="').h("i18n",t,{},{$key:"geo.trk.wyp.plhr"}).w('" maxlength="200" /><button class="tc-button tc-icon-button tc-ctl-geolocation-track-add-wpt" disabled title="').h("i18n",t,{},{$key:"geo.trk.wyp.save"}).w('"></button></div></div></div></div></div><!--se inserta en el div del mapa--><div class="tc-ctl-geolocation-track-center tc-hidden"> <button class="tc-ctl-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"geo.trk.center"}).w('"></button></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-track-node"]=function(){function t(e,t){return e.w('<li data-id="').f(t.get(["id"],!1),t,"h").w('" data-uid="').f(t.get(["uid"],!1),t,"h").w('"><span class="tc-draw tc-selectable" title="').f(t.get(["name"],!1),t,"h").w('">').f(t.get(["name"],!1),t,"h").w('</span><input class="tc-textbox tc-hidden" type="text" value="').f(t.get(["name"],!1),t,"h").w('" /> <button class="tc-btn-simulate" title="').h("i18n",t,{},{$key:"tr.lst.simulate"}).w('"></button><button hidden class="tc-btn-stop" title="').h("i18n",t,{},{$key:"tr.lst.stop"}).w('"></button><button class="tc-btn-edit" title="').h("i18n",t,{},{$key:"tr.lst.edit"}).w('"></button><button hidden class="tc-btn-pause" title="').h("i18n",t,{},{$key:"tr.lst.pause"}).w('"></button> <button hidden class="tc-btn-backward" title="').h("i18n",t,{},{$key:"tr.lst.backward"}).w('"></button><label hidden class="tc-spn-speed" title="').h("i18n",t,{},{$key:"tr.lst.velocity"}).w('"></label><button hidden class="tc-btn-forward" title="').h("i18n",t,{},{$key:"tr.lst.forward"}).w('"></button> <button class="tc-btn-save tc-hidden" title="').h("i18n",t,{},{$key:"save"}).w('"></button><button class="tc-btn-cancel tc-hidden" title="').h("i18n",t,{},{$key:"tr.lst.cancel"}).w('"></button><button class="tc-btn-delete" title="').h("i18n",t,{},{$key:"tr.lst.delete"}).w('"></button><button class="tc-btn-export-gpx" title="').h("i18n",t,{},{$key:"tr.lst.exportGPX"}).w('"></button><button class="tc-btn-export-kml" title="').h("i18n",t,{},{$key:"tr.lst.exportKML"}).w('"></button> </li>')}dust.register(e.CLASS+"-track-node",t);t.__dustBody=!0;return t};e.template[e.CLASS+"-track-snapping-node"]=function(){function t(e,t){return e.w("<ul>").x(t.get(["n"],!1),t,{block:r},{}).w("<li> <span>X:</span> ").f(t.get(["x"],!1),t,"h").w(" </li><li> <span>Y:</span> ").f(t.get(["y"],!1),t,"h").w(" </li>").x(t.get(["z"],!1),t,{block:n},{}).x(t.get(["m"],!1),t,{block:a},{}).w("</ul>")}function r(e,t){return e.w("<li> <span>").h("i18n",t,{},{$key:"geo.trk.snapping.name"}).w(":</span> ").f(t.get(["n"],!1),t,"h").w(" </li>")}function n(e,t){return e.h("ne",t,{block:i},{key:t.get(["z"],!1),value:0}).w(" ")}function i(e,t){return e.w("<li> <span>Z:</span> ").f(t.get(["z"],!1),t,"h").w(" </li>")}function a(e,t){return e.w("<li> ").f(t.get(["m"],!1),t,"h").w(" </li>")}dust.register(e.CLASS+"-track-snapping-node",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w('<div class="tc-ctl-geolocation-continue-track-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.gps"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><button class="tc-button tc-ctl-geolocation-track-continue"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cnt"}).w(' </button><button class="tc-button tc-ctl-geolocation-track-new"> ').h("i18n",t,{},{$key:"geo.trk.dialog.new"}).w(' </button> <button class="tc-button tc-modal-close"> ').h("i18n",t,{},{$key:"geo.trk.dialog.cancel"}).w(' </button></div></div></div><div class="tc-ctl-geolocation-track-advert-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"geo.track.activate.title"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><p id="pageBlurMsg">').h("i18n",t,{},{$key:"geo.trk.page.blur"}).w('</p><p class="tc-ctl-geolocation-track-advertisement p"> <label> <input type="checkbox" name="checkbox" id="advertisement"> ').h("i18n",t,{},{$key:"geo.trk.dialog.advertisement"}).w(' </label> </p></div><div class="tc-modal-footer"><button class="tc-button tc-ctl-geolocation-track-advert-ok"> ').h("i18n",t,{},{$key:"ok"}).w(" </button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t};e.template[e.CLASS+"-tracking-toast"]=function(){function t(e,t){return e.w("<ul><li><span>X:</span> ").f(t.get(["x"],!1),t,"h").w("<br /><span>Y:</span> ").f(t.get(["y"],!1),t,"h").w("<br />").x(t.get(["z"],!1),t,{block:r},{}).w("</li><li>").x(t.get(["accuracy"],!1),t,{block:n},{}).x(t.get(["speed"],!1),t,{block:i},{}).w("</li></ul>")}function r(e,t){return e.w("<span>Z:</span> ").f(t.get(["z"],!1),t,"h").w(" m<br />")}function n(e,t){return e.w("<span>").h("i18n",t,{},{$key:"geo.trk.accuracy"}).w(":</span> ").f(t.get(["accuracy"],!1),t,"h").w(" m<br />")}function i(e,t){return e.w("<span>").h("i18n",t,{},{$key:"geo.trk.speed"}).w(":</span> ").f(t.get(["speed"],!1),t,"h").w(" km/h<br />")}dust.register(e.CLASS+"-tracking-toast",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;return t}}e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.wrap=new TC.wrap.control.Geolocation(t);t.wrap.register(e);e.loaded(function(){$.when(e.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.GPS"})).then(function(e){t.layerGPS=e});$.when(e.addLayer({id:TC.getUID(),type:TC.Consts.layerType.VECTOR,stealth:!0,title:"Posicionar.Tracking"})).then(function(e){t.layerTracking=e});e.on(TC.Consts.event.FEATURESIMPORT,function(e){var t=this;if(t.isDisabled)/.gpx$/g.test(e.fileName.toLowerCase())&&t.map.toast(t.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else if(e.fileName&&e.features&&e.features.length>0){var r=/.kml$/g.test(e.fileName.toLowerCase())&&t.importedByMe||!1;if(/.gpx$/g.test(e.fileName.toLowerCase())||r){if(t.layerTrack){t.map.removeLayer(t.layerTrack);t.layerTrack=void 0}if(r){for(var n=0;n<t.map.workLayers.slice().reverse().length;n++){var i=t.map.workLayers.slice().reverse()[n];if(i.title&&i.title.toLowerCase().trim()===e.fileName.toLowerCase().trim()){t.map.removeLayer(i);break}}t.importedByMe=!1}t.getLayer(t.Const.Layers.TRACK).then(function(r){var n=t.getLoadingIndicator().addWait();t.importedFileName=e.fileName;for(var i=0,a=e.features.length;a>i;i++)t.layerTrack.addFeature(e.features[i]);t.wrap.processImportedFeatures(n);if(t.layerTrack){if(t.map&&t.map.layout&&t.map.layout.accordion&&t._$div.hasClass(TC.Consts.classes.COLLAPSED))for(var i=0;i<t.map.controls.length;i++)t.map.controls[i]!==t&&t.map.controls[i]._$div.addClass(TC.Consts.classes.COLLAPSED);t._$div.removeClass(TC.Consts.classes.COLLAPSED);$("."+t.CLASS+"-btn-tracks > span").click();t.map.$events.trigger($.Event(TC.Consts.event.TOOLSOPEN),{})}})}}}.bind(t));e.on(TC.Consts.event.LAYERVISIBILITY+" "+TC.Consts.event.LAYEROPACITY+" "+TC.Consts.event.LAYERREMOVE,function(e){var t=this;if(e.layer==t.layerTrack)switch(!0){case e.type+"."+e.namespace===TC.Consts.event.LAYERREMOVE:t.wrap.deactivateSnapping();var r=t.getSelectedTrack();r&&t.clearSelectedTrack();t.resultsPanelChart&&t.resultsPanelChart.close();t.layerTrack=void 0;break;case e.opacity>0&&e.opacity<1:return;case 0==e.layer.getVisibility():t.resultsPanelChart&&t.resultsPanelChart.minimize();case 0==e.opacity:t.wrap.deactivateSnapping();break;case 1==e.layer.getVisibility():t.resultsPanelChart&&t.resultsPanelChart.maximize();case 1==e.opacity:t.wrap.activateSnapping()}}.bind(t))})};e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.render.call(t,e)})};var t=!0;e.renderData=function(s,o){var l=this,c=function(e,t){return(t.match(/(moveTop.*)/g)||[]).join(" ")};l.trackingActive={isTrackingActive:!1,get:function(){return this.isTrackingActive},set:function(e){this.isTrackingActive=e;l.$geoInfoResult||(l.$geoInfoResult=$("."+l.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isTrackingActive){case!0:if(l.elevationActiveCollapsed.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop57");l.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}else if(l.elevationActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop159");l.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}else{l.$geoInfoResult.removeClass(c).addClass("moveTop33");l.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}break;case!1:}}};l.elevationActive={isElevationActive:!1,get:function(){return this.isElevationActive},set:function(e){this.isElevationActive=e;l.$geoInfoResult||(l.$geoInfoResult=$("."+l.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isElevationActive){case!0:if(l.trackingActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop159");l.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}break;case!1:if(l.trackingActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop33");l.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}}}};l.elevationActiveCollapsed={isElevationActiveCollapsed:!1,get:function(){return this.isElevationActiveCollapsed},set:function(e){this.isElevationActiveCollapsed=e;l.$geoInfoResult||(l.$geoInfoResult=$("."+l.CLASS+"-info-tracking div.tc-ctl-p-results"));switch(this.isElevationActiveCollapsed){case!0:if(l.trackingActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop57");l.$geoInfoResult.find(".prcollapsed").removeClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").removeClass("prpanel-heading-samehw")}break;case!1:if(l.trackingActive.get()){l.$geoInfoResult.removeClass(c).addClass("moveTop159");l.$geoInfoResult.find(".prcollapsed").addClass("prcollapsed-samehw");l.$geoInfoResult.find(".prpanel-heading").addClass("prpanel-heading-samehw")}}}};var p=l.Const.Selector;TC.Control.prototype.renderData.call(l,s,function(){var s=l._$div.find(l._classSelector+"-panel");l._$div.find(".tc-ctl-geolocation-select span").on(TC.Consts.event.CLICK,function(e){var t=$(this).closest("label").find("input[type=radio][name=mode]"),r=t.val();s.removeClass(TC.Consts.classes.HIDDEN);s.not(".tc-ctl-geolocation-"+r).addClass(TC.Consts.classes.HIDDEN)});l.gps={};l.gps.$activateButton=l._$div.find(l._classSelector+"-locate-show");l.gps.$deactivateButton=l._$div.find(l._classSelector+"-locate-hide");l.track={};l.track.$activateButton=l._$div.find(l._classSelector+"-track-ui-activate");l.track.$deactivateButton=l._$div.find(l._classSelector+"-track-ui-deactivate");l.track.$info=l._$div.find(l._classSelector+"-info-tracking").appendTo(l.map._$div);$(document).on("click","#trackingInfoMin",function(){var e=$(this).closest("div.tc-ctl-p-results");e.find(".prsidebar-body").toggle("slide",function(){e.find(".prcollapsed-max").fadeIn()})});$(document).on("click","#trackingInfoMax",function(){var e=$(this).closest("div.tc-ctl-p-results");e.find(".prsidebar-body").toggle("slide");e.find(".prcollapsed-max").hide()});$(document).on("click","#trackingInfoClose",function(){$(this).closest("div.tc-ctl-p-results").find(".prsidebar-body").fadeOut("slide")});l.track.$trackSearch=l._$div.find(l._classSelector+"-track-available-srch");l.track.$trackList=l._$div.find(l._classSelector+"-track-available-lst");l.track.$trackToolPanelOpened=l._$div.find("#tc-ctl-geolocation-track-panel-opened");l._$div.find("."+e.CLASS+"-track-panel-help").click(function(){a.call(l)});l.track.$trackName=l._$div.find(l._classSelector+"-track-title");l.track.$trackSave=l._$div.find(l._classSelector+"-track-save");l.track.$trackWPT=l._$div.find(l._classSelector+"-track-waypoint");l.track.$trackAdd=l._$div.find(l._classSelector+"-track-add-wpt");l.track.$trackContinue=l._$dialogDiv.find(".tc-ctl-geolocation-track-continue");l.track.$trackRenew=l._$dialogDiv.find(".tc-ctl-geolocation-track-new");l.track.$trackClose=l._$dialogDiv.find(".tc-ctl-geolocation-continue-track-dialog button.tc-modal-close");l.track.$trackAddSegment=l._$div.find("#tc-ctl-geolocation-track-segment");l.track.$trackAdvertisementOK=l._$dialogDiv.find(".tc-ctl-geolocation-track-advert-ok");l.track.$trackImportFile=l._$div.find(l._classSelector+"-track-import");TC.Util.detectMobile()&&Modernizr.mq("screen and (max-height: 50em) and (max-width: 50em)")&&l.track.$trackToolPanelOpened.prop("checked",!1);if(window.File&&window.FileReader&&window.FileList&&window.Blob){l.track.$trackImportFile.removeAttr("disabled");l.track.$trackImportFile.on(TC.Consts.event.CLICK,function(e){$(this).wrap("<form>").closest("form").get(0).reset();$(this).unwrap()});l.track.$trackImportFile.on("change",function(e){if(!l._cleaning){l.clear(l.Const.Layers.TRACK);if(l.map){l.map.on(TC.Consts.event.LAYERERROR,r);l.importedByMe=!0;l.map.wrap.loadFiles(e.target.files)}}})}else console.log("no es posible la importaci\xf3n");l.gps.$activateButton.on("click",function(){l.activateGPS()});l.gps.$deactivateButton.on("click",function(){l.deactivateGPS()});l.track.$activateButton.on("click",function(){l.activateTracking();n.call(l)});l.track.$deactivateButton.on("click",function(){l.deactivateTracking();i.call(l)});var o=function(e){e=e.toLowerCase();var t=l.track.$trackList.find("li").hide(),r=t.filter("li:not([class]),li."+l.Const.Classes.SELECTEDTRACK);if(0===e.length){r.show();l._$div.find(l._classSelector+"-track-search-icon").css("visibility","visible")}else{l._$div.find(l._classSelector+"-track-search-icon").css("visibility","hidden");var n=new RegExp(e,"i");r.each(function(){var e=$(this);e.toggle(n.test(e.children("span").text()))});0===r.filter(":visible").length&&t.filter('[class^="tc-ctl-geolocation-track-not"]').show()}};l.track.$trackSearch.on("keyup search",function(){o($(this).val().toLowerCase().trim())});try{if(l.track.$trackSearch.has($("::-ms-clear"))){var c;l.track.$trackSearch.on("mouseup",function(e){c=l.track.$trackSearch.val();""!==c&&setTimeout(function(){var e=l.track.$trackSearch.val();""===e&&o(e)},1)})}}catch(h){}l.track.$trackSave.on("click",$.proxy(l.saveTrack,l));l.track.$trackAdd.on("click",$.proxy(l.addWaypoint,l));var d=function(e,t){t.is("li")||(t=t.parent());if(e){t.find("input").first().removeClass(TC.Consts.classes.HIDDEN);t.find("span").first().addClass(TC.Consts.classes.HIDDEN);t.find("input").first().focus().val(t.find("span").first().text());t.find(p.SIMULATE).first().addClass(TC.Consts.classes.HIDDEN);t.find(p.EDIT).first().addClass(TC.Consts.classes.HIDDEN);t.find(p.DELETE).first().addClass(TC.Consts.classes.HIDDEN);t.find(p.DRAW).first().addClass(TC.Consts.classes.HIDDEN);t.find(p.EXPORT_GPX).first().addClass(TC.Consts.classes.HIDDEN);t.find(p.EXPORT_KML).first().addClass(TC.Consts.classes.HIDDEN);t.find(p.SAVE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(p.CANCEL).first().removeClass(TC.Consts.classes.HIDDEN)}else{t.find("input").first().addClass(TC.Consts.classes.HIDDEN);t.find("span").first().removeClass(TC.Consts.classes.HIDDEN);t.find(p.SIMULATE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(p.EDIT).first().removeClass(TC.Consts.classes.HIDDEN);t.find(p.DELETE).first().removeClass(TC.Consts.classes.HIDDEN);t.find(p.DRAW).first().removeClass(TC.Consts.classes.HIDDEN);t.find(p.EXPORT_GPX).first().removeClass(TC.Consts.classes.HIDDEN);t.find(p.EXPORT_KML).first().removeClass(TC.Consts.classes.HIDDEN);t.find(p.SAVE).first().addClass(TC.Consts.classes.HIDDEN);t.find(p.CANCEL).first().addClass(TC.Consts.classes.HIDDEN)}};l.uiSimulate=function(e,t){var r=[p.SIMULATE,p.EDIT,p.DELETE,p.EXPORT_GPX,p.EXPORT_KML],n=[p.STOP,p.PAUSE,p.BACKWARD,p.FORWARD,p.SPEED],i=t.is("li")?t:t.parent();if(e){for(var a=0;a<r.length;a++)$(i).find(r[a]).first().attr("hidden","hidden");for(var a=0;a<n.length;a++)$(i).find(n[a]).first().removeAttr("hidden")}else{for(var a=0;a<n.length;a++)$(i).find(n[a]).first().attr("hidden","hidden");for(var a=0;a<r.length;a++)$(i).find(r[a]).first().removeAttr("hidden")}};$(document).on("click",p.SIMULATE,function(){var e=l.getLoadingIndicator().addWait();$(this).parent().find(p.SPEED).text("x 1");$.when(y(l,this)).then(function(){l.getLoadingIndicator().removeWait(e)})});$(document).on("click",p.DRAW,function(){var e=l.getLoadingIndicator().addWait();$.when(m(l,this)).then(function(){l.getLoadingIndicator().removeWait(e)})});l.$events.on(l.Const.Event.IMPORTEDTRACK,function(e,t){if(l.isDisabled)l.map.toast(l.getLocaleString("geo.trk.import.disabled"),{type:TC.Consts.msgType.WARNING});else{var r=l.track.$trackList.find('li[data-id="'+t+'"]');m(l,r.find(p.DRAW));l.track.$trackList.animate({scrollTop:t*r.outerHeight()},"slow")}});var f=function(e,t){for(var r=e.track.$trackList.find("li[data-id]"),n=0;n<r.length;n++){var i=$(r[n]);if(i&&i.attr("data-id")!==t){var a=i.find(p.SIMULATE),s=i.find(p.PAUSE);a.toggleClass(e.Const.Classes.SIMULATIONACTIVATED,!1);a.attr("title",e.getLocaleString("tr.lst.simulate"));s.toggleClass("play",!1);s.attr("title",e.getLocaleString("tr.lst.pause"));e.uiSimulate(!1,i);d(!1,i)}}e.clear(e.Const.Layers.TRACK)},m=function(e,t){var r=$.Deferred(),n=$(t).parent();setTimeout(function(){if(n.hasClass(e.Const.Classes.SELECTEDTRACK)){e.uiSimulate(!1,$(t));e.clear(e.Const.Layers.TRACK);$(t).attr("title",$(t).text());e.elevationActive.set(!1);if(void 0!==e.layerTrack){e.map.removeLayer(e.layerTrack);e.layerTrack=void 0}}else if(e.getSelectedTrack().length>0){f(e,n.attr("data-id"));e.drawTrack(n)}else e.drawTrack(n);r.resolve()},0);return r.promise()},y=function(e,t){var r=$.Deferred();setTimeout(function(){var n=$(t).parent();e.getLayer(e.Const.Layers.TRACK).then(function(i){f(e,n.attr("data-id"));e.uiSimulate(!1,e.getSelectedTrack());$(this).parent().addClass(e.Const.Classes.SELECTEDTRACK);e.uiSimulate(!0,$(t));e.simulate_paused=!1;e.simulateTrack($(t).parent());r.resolve()})},0);return r.promise()};$(document).on("click",l._classSelector+" "+p.EDIT,function(){d(!0,$(this))});$(document).on("click",l._classSelector+" "+p.DELETE,function(){l.removeTrack($(this).parent())});$(document).on("click",l._classSelector+" "+p.SAVE,function(){var e=$(this).parent().find("input").first().val();if(0==e.trim().length)TC.alert(l.getLocaleString("geo.trk.edit.alert"));else{l.editTrackName($(this).parent().attr("data-id"),$(this).parent().find("input").first().val());d(!1,$(this))}});$(document).on("click",l._classSelector+" "+p.CANCEL,function(){d(!1,$(this))});$(document).on("click",l._classSelector+" "+p.EXPORT_GPX+","+l._classSelector+" "+p.EXPORT_KML,function(){var e=this,t="tc-btn-export-",r=$.grep($(this).attr("class").split(" "),function(e){return 0===e.indexOf(t)})[0],n=r.replace(t,"").toUpperCase();l["export"](n,$(this).parent()).then(function(t){if(t){var r=$(e).parent().find("span").first().text(),i=new RegExp(l.Const.SupportedFileExtensions.join("|"),"gi"),a=r.replace(i,"");TC.Util.downloadFile(a+"."+n.toLowerCase(),l.Const.MimeMap[n],t)}else TC.alert(l.getLocaleString("geo.error.export"))})});$(document).on("click",l._classSelector+" "+p.STOP,function(){l.uiSimulate(!1,$(this));l.wrap.simulateTrackEnd();var e=$(this).parent().find(p.PAUSE);e.toggleClass("play",!1);e.attr("title",l.getLocaleString("tr.lst.pause"));$(this).parent().find(p.SPEED).text("x 1");l.simulate_speed=1});$(document).on("click",l._classSelector+" "+p.PAUSE,function(){l.simulate_paused=!$(this).hasClass("play");l.simulate_paused&&(l.simulate_pausedElapse=-1);$(this).attr("title",l.getLocaleString(l.simulate_paused?"tr.lst.play":"tr.lst.pause"));$(this).toggleClass("play",l.simulate_paused)});var g=.5;$(document).on("click",l._classSelector+" "+p.BACKWARD,function(){l.simulate_speed=1==l.simulate_speed?g:l.simulate_speed/2;$(l._classSelector+" "+p.FORWARD).removeAttr("disabled");$(this).parent().find(p.SPEED).text(l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed);.000244140625==l.simulate_speed&&$(this).attr("disabled","disabled")});$(document).on("click",l._classSelector+" "+p.FORWARD,function(){l.simulate_speed=l.simulate_speed/g;$(this).parent().find(p.SPEED).text(l.simulate_speed<1?"/ "+1/l.simulate_speed:"x "+l.simulate_speed);$(l._classSelector+" "+p.BACKWARD).removeAttr("disabled");4096==l.simulate_speed&&$(this).attr("disabled","disabled")});l.track.$trackContinue.on("click",function(){TC.Util.closeModal();u.call(l)});l.track.$trackRenew.on("click",function(){delete l.sessionTracking;TC.Util.storage.setSessionLocalValue(l.Const.LocalStorageKey.TRACKINGTEMP,void 0);localforage.removeItem(l.Const.LocalStorageKey.TRACKINGTEMP);TC.Util.closeModal();u.call(l)});l.track.$trackClose.on("click",function(){i.call(l)});l.track.$trackAddSegment.on("click",function(){TC.alert("pendiente");TC.Util.closeModal()});l.track.$trackAdvertisementOK.on("click",function(){var e=$(body).find('input[name*="Advertisement"]:checked');if(e.length>0){var t=new $.Deferred;window.localforage?t.resolve():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){t.resolve()});t.then(function(){localforage.setItem(e.first().attr("name"),!1)})}TC.Util.closeModal()});l.track.renderTrack=$("#tc-ctl-geolocation-track-render").change(function(){l.track.$activateButton.hasClass(TC.Consts.classes.HIDDEN)&&l.wrap.setTrackOnMapVisibility(this.checked);t=this.checked});window.localforage?l.bindTracks():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){l.bindTracks()})});$.isFunction(o)&&o()};e.activate=function(){var e=this;TC.Control.prototype.activate.call(e)};e.deactivate=function(){var e=this;e.clearSelection();e.deactivateTracking();TC.Control.prototype.deactivate.call(e)};var r=function(){var e=this;e.map.off(TC.Consts.event.LAYERERROR,r);e.clearFileInput(e.track.$trackImportFile);TC.alert(e.getLocaleString("geo.trk.upload.error3"))},n=function(){var e=this;e.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);e.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!1)},i=function(){var e=this;e.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)},a=function(){var e=this;e.map.toast(e._$div.find(".alert-warning").html(),{duration:1e4})};e.getLayer=function(e){var t,r=this,n=!0,i="";switch(!0){case e==r.Const.Layers.TRACKING:n=void 0!==r.layerTracking;i="layerTracking";break;case e==r.Const.Layers.TRACK:n=void 0!==r.layerTrack;i="layerTrack";t={line:{strokeWidth:2,strokeColor:"#C52737"},point:{radius:3,fillColor:"#C52737",strokeColor:"#ffffff",fontColor:"#C52737",fontSize:10,fontWeight:"bold",labelOutlineColor:"#ffffff",labelOutlineWidth:2,label:function(e){var t=e.getData().name;t=t&&(t+"").trim().length>0?(t+"").trim().toLowerCase():"";return t}}};break;case e==r.Const.Layers.GPS:n=void 0!==r.layerGPS;i="layerGPS"}if(this[i]){var a=new $.Deferred;a.resolve(this[i]);return a}if(r.layerPromise&&"resolved"!==r.layerPromise.state())return r.layerPromise;r.layerPromise=new $.Deferred;var s={id:TC.getUID(),type:TC.Consts.layerType.VECTOR,title:r.getLocaleString("geo")+" - "+e,stealth:!0};t&&(s.styles=t);$.when(r.map.addLayer(s)).then(function(e){this[i]=e;this[i].map.putLayerOnTop(e);r.layerPromise.resolve(this[i])}.bind(r));return r.layerPromise};e.activateGPS=function(){var e=this;e.deactivateTracking();L.call(e,e.Const.LocalStorageKey.GPSSHOWADVERTISEMENT);p.apply(e);g.apply(e);e.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);e.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.track.$trackToolPanelOpened.prop("checked")||e.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{});$.when(e.getLayer(e.Const.Layers.GPS)).then(function(t){e.currentPositionWaiting=e.getLoadingIndicator().addWait();if(navigator.geolocation){var r={timeout:6e4},n=function(r){r=r.coords;e.geopositionGPS=!0;var n=TC.Util.reproject([r.longitude,r.latitude],"EPSG:4326",e.map.crs);e.getLoadingIndicator().removeWait(e.currentPositionWaiting);t&&t.clearFeatures();var i=function(t){var r=function(e,t){return e instanceof Array?t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]:!0};return r(e.map.options.maxExtent,t)?!0:!1};i(n)?$.when(t.addCircle([n,r.accuracy]),t.addMarker(n,{title:"GPS",cssClass:TC.Consts.classes.POINT,anchor:[.5,.5]})).then(function(r,n){e.gps.accuracyCircle=r;e.gps.geoPosition=n;if(!e.wrap.pulsated){e.map.zoomToFeatures(t.features,{animate:!1});e.wrap.pulsate(r)}}):TC.alert(e.getLocaleString("geo.error.out"))};if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(t){e.data=t;n(t);e.currentPosition=navigator.geolocation.watchPosition(n,e.onGeolocateError.bind(e))},e.onGeolocateError.bind(e));setTimeout(function(){if(!e.data){e.getLoadingIndicator().removeWait(e.currentPositionWaiting);e.map.toast(e.getLocaleString("geo.error.permission_denied"),{type:TC.Consts.msgType.WARNING});e.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)}},r.timeout+1e3)}else alert("not supported")}else e.onGeolocateError()})};e.deactivateGPS=function(){var e=this;delete e.geopositionGPS;h();v();delete e.wrap.pulsated;navigator.geolocation&&e.currentPosition&&navigator.geolocation.clearWatch(e.currentPosition);$.when(e.getLayer(e.Const.Layers.GPS)).then(function(e){e&&e.clearFeatures()});e.gps.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);e.gps.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0);e.currentPositionWaiting&&e.getLoadingIndicator().removeWait(e.currentPositionWaiting);return!0};var s,o,l,c=function(){var e=this;e.track.$trackToolPanelOpened.prop("checked")||e.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{})},u=function(){var e=this;e.activate();n.call(e);c.call(e);e.track.$info.find(".prsidebar-body").show();e.$events.on(e.Const.Event.POSITIONCHANGE,function(t){e.currentPoint=t.pd;var r={},n=TC.Util.getMapLocale(e.map);r.x=Math.round(t.pd.position[0]).toLocaleString(n);r.y=Math.round(t.pd.position[1]).toLocaleString(n);r.z=Math.round(t.pd.altitude).toLocaleString(n);r.accuracy=Math.round(t.pd.accuracy).toLocaleString(n);r.speed=t.pd.speed.toLocaleString(n,{minimumFractionDigits:1,maximumFractionDigits:1});r&&e.getRenderedHtml(e.CLASS+"-tracking-toast",r,function(t){e.track.$info.find(".prpanel-body").html(t);e.track.$info.hasClass(TC.Consts.classes.HIDDEN)&&e.track.$info.removeClass(TC.Consts.classes.HIDDEN);e.trackingActive.set(!0)});e.track.$trackName.removeAttr("disabled");e.track.$trackSave.removeAttr("disabled");e.track.$trackWPT.removeAttr("disabled");e.track.$trackAdd.removeAttr("disabled");TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,e.wrap.formattedToStorage(e.layerTracking))});e.$events.on(e.Const.Event.STATEUPDATED,function(e){});e.clear(e.Const.Layers.TRACKING);L.call(e,e.Const.LocalStorageKey.TRACKINGSHOWADVERTISEMENT);e.wrap.setTracking(!0)},p=function(){var e=this;if(!e.videoScreenOn){var t={WebM:"data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=",MP4:"data:video/mp4;base64,AAAAHGZ0eXBpc29tAAACAGlzb21pc28ybXA0MQAAAAhmcmVlAAAAG21kYXQAAAGzABAHAAABthADAowdbb9/AAAC6W1vb3YAAABsbXZoZAAAAAB8JbCAfCWwgAAAA+gAAAAAAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIAAAIVdHJhawAAAFx0a2hkAAAAD3wlsIB8JbCAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAIAAAACAAAAAABsW1kaWEAAAAgbWRoZAAAAAB8JbCAfCWwgAAAA+gAAAAAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAVxtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAEcc3RibAAAALhzdHNkAAAAAAAAAAEAAACobXA0dgAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAIAAgASAAAAEgAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABj//wAAAFJlc2RzAAAAAANEAAEABDwgEQAAAAADDUAAAAAABS0AAAGwAQAAAbWJEwAAAQAAAAEgAMSNiB9FAEQBFGMAAAGyTGF2YzUyLjg3LjQGAQIAAAAYc3R0cwAAAAAAAAABAAAAAQAAAAAAAAAcc3RzYwAAAAAAAAABAAAAAQAAAAEAAAABAAAAFHN0c3oAAAAAAAAAEwAAAAEAAAAUc3RjbwAAAAAAAAABAAAALAAAAGB1ZHRhAAAAWG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAK2lsc3QAAAAjqXRvbwAAABtkYXRhAAAAAQAAAABMYXZmNTIuNzguMw=="};e.videoScreenOn=document.createElement("video");e.videoScreenOn.setAttribute("loop","");e.videoScreenOn.setAttribute("muted","");e.videoScreenOn.setAttribute("webkit-playsinline","");e.videoScreenOn.setAttribute("playsinline","");e.videoScreenOn.setAttribute("style","transform: translateZ(0px);");var r=document.createElement("source");r.src=t.WebM;r.type="video/webm";e.videoScreenOn.appendChild(r);var n=document.createElement("source");n.src=t.MP4;n.type="video/mp4";e.videoScreenOn.appendChild(n)}e.videoScreenOn.play()},h=function(){var e=this;e.videoScreenOn&&e.videoScreenOn.pause()},d=function(){var e=this;console.log("onWindowBlurred");console.log("video is: "+e.videoScreenOn.paused);C.apply(e);return"Texto de aviso"},f=function(){var e=this;console.log("onWindowFocused");console.log("video is: "+e.videoScreenOn.paused);e.videoScreenOn.paused&&e.videoScreenOn.play();T.apply(e);console.log("video is: "+e.videoScreenOn.paused)},m=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},y=function(){var e=this,t=m();document[t]||f.apply(e);console.log("video is: "+e.videoScreenOn.paused)},g=function(){var e=this;l||(l=y.bind(e));s||(s=d.bind(e));o||(o=f.bind(e));window.addEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.addEventListener("pagehide",s,!1);window.addEventListener("pageshow",o,!1)}else{window.addEventListener("blur",s,!1);window.addEventListener("focus",o,!1)}},v=function(){window.removeEventListener("visibilitychange",l,!1);if(TC.Util.detectSafari()&&Modernizr.touch&&!navigator.userAgent.match(/Android/i)&&!navigator.userAgent.match(/CriOS/i)){window.removeEventListener("pagehide",s,!1);window.removeEventListener("pageshow",o,!1)}else{window.removeEventListener("blur",s,!1);window.removeEventListener("focus",o,!1)}},C=function(){var e=this,t=TC.Util.storage.getSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP);t&&t.length>0&&localforage.setItem(e.Const.LocalStorageKey.TRACKINGTEMP,"string"==typeof t?t:JSON.stringify(t));

},T=function(){var e=this;localforage.getItem(e.Const.LocalStorageKey.TRACKINGTEMP).then(function(t){null!==t&&"null"!==t&&t.length>0&&TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,t)})},L=function(e){var t=this,r=new $.Deferred;window.localforage?r.resolve():TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){r.resolve()});r.then(function(){localforage.getItem(e).then(function(r){if(null==r){var n=t._$dialogDiv.find(".tc-ctl-geolocation-track-advert-dialog");n.find('input[type="checkbox"]').first().attr("name",e).removeAttr("checked");$("#pageBlurMsg").text(TC.Util.detectMobile()?t.getLocaleString("geo.trk.page.blur"):t.getLocaleString("geo.trk.page.blur.desktop"));n.find("h3").text(e==t.Const.LocalStorageKey.GPSSHOWADVERTISEMENT?t.getLocaleString("geo.track.activate")+" "+t.getLocaleString("geo.gps"):t.getLocaleString("geo.track.activate.title"));TC.Util.showModal(t._$dialogDiv.find(".tc-ctl-geolocation-track-advert-dialog"))}})});t.map.toast(t.getLocaleString(TC.Util.detectMobile()?"geo.trk.page.blur":"geo.trk.page.blur.desktop"),{type:TC.Consts.msgType.WARNING})};e.activateTracking=function(){var e=this,t=!0;e.clear(e.Const.Layers.TRACKING);try{TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TEST,e.Const.LocalStorageKey.TEST)}catch(r){r.code===DOMException.QUOTA_EXCEEDED_ERR?TC.alert(e.getLocaleString("geo.error.trackinglocalstorage")):TC.error(r);t=!1}if(t){p.apply(e);g.apply(e);e.sessionTracking=TC.Util.storage.getSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP);e.sessionTracking?TC.Util.showModal(e._$dialogDiv.find(".tc-ctl-geolocation-continue-track-dialog"),{closeCallback:function(){i.call(e)}}):u.call(e)}else i.call(e)};e.deactivateTracking=function(){var e=this,r=function(){e.track.$info.addClass(TC.Consts.classes.HIDDEN);$("#trackingInfoMax").hide();C.apply(e);e.wrap.setTracking(!1);delete e.geopositionTracking;t||$(e._classSelector+"-track-render").find("label").click();h.apply(e);v.apply(e);e.$events.off(e.Const.Event.POSITIONCHANGE);e.$events.off(e.Const.Event.STATEUPDATED);i.call(e);e.trackingActive.set(!1);e.track.$trackName.val("");e.track.$trackName.attr("disabled","disabled");e.track.$trackSave.attr("disabled","disabled");e.track.$trackWPT.val("");e.track.$trackWPT.attr("disabled","disabled");e.track.$trackAdd.attr("disabled","disabled");e.clear(e.Const.Layers.TRACKING);e.clear(e.Const.Layers.GPS);return!0};if(e.wrap.hasCoordinates()){e.map.toast(e.getLocaleString("geo.trk.deactivate.alert"),{duration:1e4});return r()}return r()};e.getStoredTracks=function(){var e=this,t=new $.Deferred,r=[];localforage.keys().then(function(n){var i=[];n=n.filter(function(t){if(!t.startsWith(e.Const.LocalStorageKey.TRACKINGTEMP)&&t.startsWith(e.Const.LocalStorageKey.TRACKING)){i.push(new $.Deferred);return!0}return!1});if(0==n.length){e.availableTracks=r;t.resolve(r)}i.forEach(function(e,t){localforage.getItem(n[t],function(t,r){e.resolve(r)})});$.when.apply($,i).then(function(){var n=Array.prototype.slice.call(arguments,0);if(n&&n.length){n.forEach(function(e){var e=JSON.parse(e);e instanceof Array?r=r.concat(e):r.push(e)});var i=w(r);e.availableTracks=i;t.resolve(i)}})});return t};var w=function(e){var t=[];for(var r in e)if(e[r]){t.push(e[r]);t.sort(function(e,t){return e.name.localeCompare(t.name)})}return t};e.setStoredTracks=function(e){var t=this,r=new $.Deferred,n=[];e.forEach(function(e){n.push(new $.Deferred);var r=n[n.length-1];localforage.setItem(t.Const.LocalStorageKey.TRACKING+"#"+e.uid,JSON.stringify(e),function(e,t){r.resolve(t)})});$.when.apply($,n).then(function(){t.getStoredTracks().then(function(){t.bindTracks();r.resolve()})});return r};e.getAvailableTracks=function(){var e=this,t=new $.Deferred;e.availableTracks?t.resolve(e.availableTracks):e.getStoredTracks().then(function(e){t.resolve(e)});return t};e.bindTracks=function(){var e=this;e.track.$trackList.find('li:not([class^="tc-ctl-geolocation-track-available-empty"])').hide();e.track.$trackList.find('li[class^="tc-ctl-geolocation-track-available-empty"]').hide();e.getAvailableTracks().then(function(t){if(b(t)){e.track.$trackList.find('li[class^="tc-ctl-geolocation-track-available-empty"]').show();e.track.$trackSearch.attr("disabled","disabled")}else{var r=$(e.getSelectedTrack()[0]).attr("data-uid");e.track.$trackList.find("li[data-id]").remove();for(var n in t)e.getRenderedHtml(e.CLASS+"-track-node",{id:n,uid:t[n].uid,name:t[n].name?t[n].name.trim():""},function(t){e.track.$trackList.append(t)});e.setSelectedTrack(e.track.$trackList.find('li[data-uid="'+r+'"]'));e.track.$trackSearch.removeAttr("disabled")}})};e.simulateTrack=function(e){var t=this;t.simulate_speed=1;t.drawTrack(e,!1);t.wrap.simulateTrack()};e.drawTrack=function(e,t){var r=this;c.call(r);r.getLayer(r.Const.Layers.TRACK).then(function(t){r.setSelectedTrack(e);r.drawTrackingData(e);r.elevationTrack(e);r.activate()})};e.elevationTrack=function(e,t){var r=this;if(t){r.wrap.simulateTrackEnd();r.uiSimulate(!1,e)}if(!r.onResize){r.onResize=r.elevationTrack.bind(r,e,!0);window.addEventListener("resize",r.onResize,!1)}var n={},i={},a=0;r.chart={coordinates:[]};r.track.elevationChart&&(r.track.elevationChart=r.track.elevationChart.destroy());var s=function(e){var t,s,o=new $.Deferred;t=[];s=[];r.getTrackingData(e).then(function(e){if(e)for(var l=(new ol.format.GeoJSON).readFeatures(e),c=0;c<l.length;c++){var u=l[c].getGeometry(),p=function(){var e=u.getLength();return parseFloat((e/1e3).toFixed(2))},h=function(){if(u.getLayout()==ol.geom.GeometryLayout.XYZM){var e=u.getLastCoordinate()[3]-u.getFirstCoordinate()[3];return{s:Math.floor(e/1e3%60),m:Math.floor(e/6e4%60),h:Math.floor(e/36e5%24)}}return null},d=function(e){if(e&&e.length>0&&e[0].length>2){for(var t=0,n=0,i=0,a=0,s=0,o=!0,l=0;l<e.length;l++){var c=e[l],u=c[2];if(0==l){i=u;a=u;s=u}a=Math.min(a,u);s=Math.max(s,u);var p=u-i;if(p>r.gapHill||p>0&&l==e.length-1){if(o)t+=p;else{n-=a-i;t+=u-a;o=!0}i=u;a=u;s=u}else if(p<-r.gapHill||0>p&&l==e.length-1){if(o){t+=s-i;n-=u-s;o=!1}else n-=p;i=u;a=u;s=u}}return{upHill:Math.round(t),downHill:Math.round(n)}}return null};switch(u.getType().toLowerCase()){case"point":continue;case"linestring":i=h(u);a=p(u);n=d(u.getCoordinates());r.chart.coordinates=r.chart.coordinates.concat(u.getCoordinates());break;case"multilinestring":for(var f,m=u.getLineStrings(),c=0;c<m.length;c++){a+=p(m[c]);m[c].getLayout()==ol.geom.GeometryLayout.XYZM&&(f+=m[c].getLastCoordinate()[3]-m[c].getFirstCoordinate()[3]);r.chart.coordinates=r.chart.coordinates.concat(m[c].getCoordinates())}f&&(i=h(f));break;default:return null}if(r.chart.coordinates.length>0){var y=0;t.push(y);for(var c=1;c<=r.chart.coordinates.length-1;c++){var g=r.chart.coordinates[c],v=r.chart.coordinates[c-1];y+=Math.hypot(g[0]-v[0],g[1]-v[1]);t.push(parseFloat(y.toFixed(2)))}}for(var C,T,L=!0,c=0;c<r.chart.coordinates.length;c++){if(!(r.chart.coordinates[c].length>2))return o.resolve(null);var w=Math.round(10*r.chart.coordinates[c][2])/10;L&&w>0&&(L=!1);s.push(w);0==c&&(C=T=w);C=Math.min(C,w);T=Math.max(T,w)}}s instanceof Array&&0==s.length&&(L=!0);r.chartData=L?null:$.extend({},{time:i,ele:s,x:t,miny:C,maxy:T},n);return o.resolve(r.chartData)});return o};s(e).then(function(e){var t=TC.Util.getMapLocale(r.map);if(null!=e){e.time&&(e.time=("00000"+e.time.h).slice(-2)+":"+("00000"+e.time.m).slice(-2)+":"+("00000"+e.time.s).slice(-2));var n=(r.map.options.pointBoundsRadius,document.documentElement.clientWidth/100*40);r.elevationChartSize={height:n>445?128:70,width:n>445?445:n>310?310:215};e=$.extend({},e,{size:{height:r.elevationChartSize.height,width:r.elevationChartSize.width},data:{x:"x",columns:[["x"].concat(e.x),["ele"].concat(e.ele)],types:{ele:"area-spline"},colors:{ele:"url(#grad1)"}},point:{show:!1},axis:{x:{tick:{count:5,format:function(e){e/=1e3;var r,n;if(1>e){r=Math.round(1e3*e);n=" m"}else{r=Math.round(100*e)/100;n=" km"}r=r.toLocaleString(t);return r+n}}},y:{padding:{top:0,bottom:0},max:e.maxy,min:e.miny,tick:{count:2,format:function(e){return parseInt(e.toFixed(0)).toLocaleString(t)+"m"}}}}});r.hasElevation=!0;r.elevationActive.set(!0)}else{r.hasElevation=!1;e={msg:r.getLocaleString("geo.trk.chart.chpe.empty")};r.elevationActive.set(!1)}if(r.resultsPanelChart)r.map.$events.trigger($.Event(r.Const.Event.DRAWTRACK),{data:e});else{TC.control.ResultsPanel||TC.syncLoadJS(TC.apiLocation+"TC/control/ResultsPanel");window.c3||TC.syncLoadJS(TC.Consts.url.D3C3||TC.apiLocation+"lib/d3c3/d3c3.min.js");r.resultsPanelChart=new TC.control.ResultsPanel({div:"results-panel",content:"chart",titles:{main:r.getLocaleString("geo.trk.chart.chpe"),max:r.getLocaleString("geo.trk.chart.chpe")},openOn:r.Const.Event.DRAWTRACK,closeOn:r.Const.Event.CLEARTRACK,chart:{ctx:r,onmouseout:TC.control.Geolocation.prototype.removeTooltip,tooltip:TC.control.Geolocation.prototype.getTooltip}});r.resultsPanelChart.register(r.map);r.resultsPanelChart.render(function(){r.resultsPanelChart.activateSnapping=function(e){r.layerTrack.getVisibility()||0!=r.layerTrack.getOpacity()||r.wrap.deactivateSnapping.call(r.wrap)};r.resultsPanelChart.deactivateSnapping=function(e){r.layerTrack.getVisibility()&&r.layerTrack.getOpacity()>0&&r.wrap.activateSnapping.call(r.wrap)};r.resultsPanelChart._$div.on("mouseover",r.resultsPanelChart.deactivateSnapping);r.resultsPanelChart._$div.on("mouseout",r.resultsPanelChart.activateSnapping);r.track.htmlElevationMarker=document.getElementById("tc-ctl-geolocation-track-elevation-marker");r.map.on(TC.Consts.event.RESULTSPANELMIN,function(){$(r.wrap.miDiv).hide();r.elevationActiveCollapsed.set(!0)});r.map.on(TC.Consts.event.RESULTSPANELMAX,function(){$(r.wrap.miDiv).show();r.elevationActiveCollapsed.set(!1)});r.map.on(TC.Consts.event.RESULTSPANELCLOSE,function(){$(r.wrap.miDiv).hide();r.elevationActive.set(!1)});r.map.on(TC.Consts.event.DRAWCHART,function(e,t){function n(){if(d3.select(".c3-axis-x").length&&!d3.select(".c3-axis-x").node())r.elevationChartLabelsRAF=requestAnimationFrame(n);else if(d3.select(".c3-axis-x").length&&d3.select(".c3-axis-x").node()&&!d3.select(".c3-axis-x").node().getBoundingClientRect().width)r.elevationChartLabelsRAF=requestAnimationFrame(n);else{window.cancelAnimationFrame(r.elevationChartLabelsRAF);r.elevationChartLabelsRAF=void 0;(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=r.elevationChartSize.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(r.elevationChartSize.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&h()}}var i=t.svg.getElementsByTagName("defs")[0],a="http://www.w3.org/2000/svg",s=document.createElementNS(a,"linearGradient");s.setAttributeNS(null,"id","grad1");s.setAttributeNS(null,"x1","0%");s.setAttributeNS(null,"x2","0%");s.setAttributeNS(null,"y1","0%");s.setAttributeNS(null,"y2","100%");s.setAttributeNS(null,"gradientUnits","userSpaceOnUse");var o=document.createElementNS(a,"stop");o.setAttributeNS(null,"offset","0%");o.setAttributeNS(null,"stop-color","red");o.setAttributeNS(null,"stop-opacity","0.7");s.appendChild(o);var l=document.createElementNS(a,"stop");l.setAttributeNS(null,"offset","50%");l.setAttributeNS(null,"stop-color","orange");l.setAttributeNS(null,"stop-opacity","0.9");s.appendChild(l);var c=document.createElementNS(a,"stop");c.setAttributeNS(null,"offset","100%");c.setAttributeNS(null,"stop-color","green");c.setAttributeNS(null,"stop-opacity","1");s.appendChild(c);i.appendChild(s);$(d3.select(".c3-brush").node()).remove();d3.select(".c3-event-rects,.c3-event-rects-single").selectAll("rect").style("cursor","pointer").on("click",function(e){d3.event.stopPropagation();var t=this.chart.coordinates[e.index].slice(0,2);t&&TC.loadJS(!TC.feature||TC.feature&&!TC.feature.Point,[TC.apiLocation+"TC/feature/Point"],function(){this.map.zoomToFeatures([new TC.feature.Point(t)])}.bind(r))}.bind(r));var u=d3.select(".c3-axis.c3-axis-x").select("path").attr("d"),p=/^M\d\,(\d)V\dH\d{3}V(\d)$/i.exec(u);if(p){u=u.replace(/(M\d\,)\d/i,"$10").replace(/(H\d{3}V)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}else{var p=/^M\s\d\s(\d)\sV\s\d\sH\s\d{3}\sV\s(\d)$/i.exec(u);if(p){u=u.replace(/(M\s\d\s)\d/i,"$10").replace(/(H\s\d{3}\sV\s)(\d)/i,"$10");d3.select(".c3-axis.c3-axis-x").select("path").attr("d",u)}}var h=function(){var e=d3.scale.ordinal().rangeRoundBands([0,r.elevationChartSize.width],.1,.3);d3.select(".c3-axis-x").selectAll("text:not(.c3-axis-x-label)").call(function(e,t){e.each(function(){e.each(function(e,t){if(0!=t){d3text=d3.select(this);if(!d3text.attr("edited")){d3text.attr("edited",!0);var r=d3text.select("tspan").node().cloneNode(),n=d3text.text().split(" ");d3text.select("tspan").text(n[0]);r.textContent=n[1];var i=r.getAttribute("dy");i=i?parseFloat(r.getAttribute("dy")):.71;i=i+.18+"em";r.setAttribute("dy",i);d3text.node().appendChild(r)}}})})},e.rangeBand())};if(d3.select(".c3-axis-x").node().getBoundingClientRect().width)(d3.select(".c3-axis-x").node().getBoundingClientRect().width>=r.elevationChartSize.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width||100*d3.select(".c3-axis-x").node().getBoundingClientRect().width/(r.elevationChartSize.width-d3.select(".c3-axis-y").node().getBoundingClientRect().width)>90)&&h();else{if(r.elevationChartLabelsRAF){window.cancelAnimationFrame(r.elevationChartLabelsRAF);r.elevationChartLabelsRAF=void 0}r.elevationChartLabelsRAF=requestAnimationFrame(n)}});r.map.$events.trigger($.Event(r.Const.Event.DRAWTRACK),{data:e})})}})};e.clear=function(e){var t=this;if(t.onResize){window.removeEventListener("resize",t.onResize,!1);t.onResize=void 0}if(e==t.Const.Layers.TRACK){t.resultsPanelChart&&t.resultsPanelChart.close();delete t.chartData;t.wrap.simulateTrackEnd();t.track.$trackList.find("li").removeClass(t.Const.Classes.SELECTEDTRACK);if(void 0!==t.layerTrack){t.map.removeLayer(t.layerTrack);t.layerTrack=void 0}t.map.$events.trigger($.Event(t.Const.Event.CLEARTRACK),{})}else t.getLayer(e).then(function(e){t.wrap.clear(e)})};e.saveTrack=function(){var e=this,t=new $.Deferred,r=arguments.length>0&&"string"==typeof arguments[0]?arguments[0]:e.getLocaleString("geo.trk.save.alert"),n=function(n){e.getLayer(n).then(function(n){var i;i=e.getLoadingIndicator().addWait();var a=e.importedFileName||e.track.$trackName.val().trim(),s=e.availableTracks;s||(s={});var o=TC.getUID();s.push({name:a,data:e.wrap.formattedToStorage(n,!0),uid:parseInt(o)});s=w(s);var l=function(t){e.track.$trackName.val("");e.track.$trackName.attr("disabled","disabled");e.track.$trackSave.attr("disabled","disabled");e.track.$trackWPT.val("");e.track.$trackWPT.attr("disabled","disabled");e.track.$trackAdd.attr("disabled","disabled");e.getLoadingIndicator().removeWait(t);c.call(e)};try{e.setStoredTracks(s).then(function(){e.map.toast(r,{duration:3e3});l(i);for(var n,a=0;a<s.length;a++)if(parseInt(s[a].uid)===parseInt(o)){n=a;break}t.resolve(n)})}catch(u){TC.alert(e.getLocaleString("geo.error.savelocalstorage")+": "+u.message);l(i);t.reject()}})};if(e.importedFileName)n(e.Const.Layers.TRACK);else if(0==e.track.$trackName.val().trim().length){e.track.$trackName.val((new Date).toLocaleString());n(e.Const.Layers.TRACKING)}else n(e.Const.Layers.TRACKING);return t};e.addWaypoint=function(){var e=this,t=e.track.$trackWPT.val().trim();t||(t=(new Date).toLocaleString());var r=e.getLoadingIndicator().addWait();c.call(e);e.wrap.addWaypoint(e.currentPoint.position,{name:t,ele:e.currentPoint.heading,time:(new Date).getTime()});e.track.$trackWPT.val("");e.track.$trackWPT.attr("disabled","disabled");e.track.$trackAdd.attr("disabled","disabled");TC.Util.storage.setSessionLocalValue(e.Const.LocalStorageKey.TRACKINGTEMP,e.wrap.formattedToStorage(e.layerTracking));e.getLoadingIndicator().removeWait(r)};e.editTrackName=function(e,t){var r=this;r.getAvailableTracks().then(function(n){if(n&&n[e]){n[e].name=t;r.setStoredTracks(n)}})};e.removeTrack=function(e){var t=this;t.getAvailableTracks().then(function(r){if(r){var n=$(e).attr("data-id");if(r[n]){var i=r[n].uid;TC.confirm(t.getLocaleString("geo.trk.delete.alert"),function(){t.getSelectedTrack().length>0&&$(t.getSelectedTrack()[0]).attr("data-id")==n&&t.clear(t.Const.Layers.TRACK);localforage.removeItem(t.Const.LocalStorageKey.TRACKING+"#"+i);1==$(e).parent().find('li[class=""]').length?t.getStoredTracks().then(function(){t.bindTracks()}):$(e).remove()},function(){})}}})};e.setSelectedTrack=function(e){var t=this;t.track.$trackList.find("li[data-id] > span").each(function(){$(this).attr("title",$(this).text())});t.track.$trackList.find("li").removeClass(t.Const.Classes.SELECTEDTRACK);e.addClass(t.Const.Classes.SELECTEDTRACK);$(e).attr("title",t.getLocaleString("tr.lst.clear")+$(e).find("span").text());$(e).find(t.Const.Selector.DRAW).attr("title",$(e).attr("title"))};e.getSelectedTrack=function(){var e=this;return e.track.$trackList.find("li."+e.Const.Classes.SELECTEDTRACK)};e.clearSelectedTrack=function(){var e=this,t=e.getSelectedTrack();if(t){if(e.onResize){window.removeEventListener("resize",e.onResize,!1);e.onResize=void 0}t.removeClass(e.Const.Classes.SELECTEDTRACK);t.attr("title",t.text());t.find(e.Const.Selector.DRAW).attr("title",t.attr("title"))}};e.clearSelection=function(){var e=this;e.wrap.deactivateSnapping();var t=e.getSelectedTrack();t&&e.clearSelectedTrack();if(e.resultsPanelChart){e.resultsPanelChart._$div.off("mouseover",e.resultsPanelChart.deactivateSnapping);e.resultsPanelChart._$div.off("mouseout",e.resultsPanelChart.activateSnapping);e.resultsPanelChart.close();delete e.resultsPanelChart}e.clear(e.Const.Layers.TRACK)};e.drawTrackingData=function(e){var t=this;t.wrap.clear();t.getTrackingData(e).then(function(e){e&&t.wrap.drawTrackingData(e).then(function(){var e=t.layerTrack.features;if(e&&e.length>0)for(var r,n=0;n<e.length;n++){e[n].STYLETYPE.indexOf("line")>-1&&(r=e[n]);e[n].showsPopup=!1}if(r&&r.geometry){var i=r.geometry[0],a=r.geometry[r.geometry.length-1];i&&i!==a&&t.layerTrack.addMarker(i.slice().splice(0,2),{showsPopup:!1,cssClass:t.CLASS+"-track-marker-icon-end",anchor:[.5,1]});a&&t.layerTrack.addMarker(a.slice().splice(0,2),{showsPopup:!1,cssClass:t.CLASS+"-track-marker-icon",anchor:[.5,1]})}})})};e.getTrackingData=function(e){var t=this,r=e,n=new $.Deferred;t.getAvailableTracks().then(function(e){if(e){var t=$(r).attr("data-id");if(e[t])return n.resolve(e[t].data)}return n.resolve()});return n};e["export"]=function(e,t){var r=this;return r.wrap["export"](e,t)};e.getTooltip=function(e){var t=this;return t.wrap.getTooltip(e)};e.removeTooltip=function(){var e=this;$(e.track.htmlElevationMarker).hide()};e.clearFileInput=function(e){var t=$(e);t.wrap("<form>").closest("form").get(0).reset();t.unwrap()};e.getLoadingIndicator=function(){var e=this;if(!e.loading){e.loading=e.map.getControlsByClass(TC.control.LoadingIndicator);e.loading&&e.loading.length>0&&(e.loading=e.loading[0])}return e.loading};e.onGeolocateError=function(e){var t=this;if(navigator.geolocation){t.currentPosition&&navigator.geolocation.clearWatch(t.currentPosition);t.currentPositionTrk&&navigator.geolocation.clearWatch(t.currentPositionTrk)}t.currentPositionWaiting&&t.getLoadingIndicator().removeWait(t.currentPositionWaiting);var r;switch(e.code){case e.PERMISSION_DENIED:r=t.getLocaleString("geo.error.permission_denied");break;case e.POSITION_UNAVAILABLE:r=t.getLocaleString("geo.error.position_unavailable");break;case e.TIMEOUT:r=t.getLocaleString("geo.error.timeout");break;default:r=t.getLocaleString("geo.error.default")}t.map.toast(r,{type:TC.Consts.msgType.WARNING});if(!t.geopositionTracking&&t.track){t.track.$activateButton.toggleClass(TC.Consts.classes.HIDDEN,!1);t.track.$deactivateButton.toggleClass(TC.Consts.classes.HIDDEN,!0)}};var b=function(e){return!e||0===e.length}}();TC.control=TC.control||{};TC.control.FeatureInfoCommons||TC.syncLoadJS(TC.apiLocation+"TC/control/FeatureInfoCommons");!function(){TC.control.GeometryFeatureInfo=function(){var e=this;TC.control.FeatureInfoCommons.apply(this,arguments);e.wrap=new TC.wrap.control.GeometryFeatureInfo(e);e.lineColor=e.options.lineColor?e.options.lineColor:"#c00";e.callback=function(t,r){if(!e._drawToken){e.closeResults();for(var n=!1,i=0;i<e.map.workLayers.length;i++){var a=e.map.workLayers[i];if(a.type===TC.Consts.layerType.WMS&&a.getVisibility()&&a.names.length>0){n=!0;break}}if(n){e.closeResults();e.wrap.beginDraw({geometryType:e.geometryType,xy:t,layer:e.filterLayer,callback:function(t){e.wrap.getFeaturesByGeometry(t)}})}}};e._isDrawing=!1;e._isSearching=!1;e._drawToken=!1};TC.inherit(TC.control.GeometryFeatureInfo,TC.control.FeatureInfoCommons);var e=TC.control.GeometryFeatureInfo.prototype;e.register=function(e){var t=this;TC.control.FeatureInfoCommons.prototype.register.call(t,e);e.on(TC.Consts.event.FEATUREINFOERROR,function(r){r.xhr&&404===r.xhr.status&&e.toast(r.control.getLocaleString("featureInfo.tooManyLayers"),{type:TC.Consts.msgType.ERROR});t.lastFeatureCount=0;t.closeResults()});t.$events.on(TC.Consts.event.CONTROLDEACTIVATE,function(e){t.wrap.cancelDraw()})};e.responseCallback=function(e){var t=this;if(t.filterFeature){var r=e.services;t.info={services:r};for(var n=0;n<r.length;n++){var i=r[n];if(i.hasLimits){delete i.layers;i.hasLimits=i.hasLimits}else{for(var a=0;a<i.layers.length;a++)if(!i.layers[a].features.length){i.layers.splice(a,1);a-=1}if(!i.layers.length){r.splice(n,1);n-=1}}}r.length?t.renderData(e,function(){t._$div.find("td."+t.CLASS+"-val").each(function(e,t){var r=$(t),n=r.text();TC.Util.isURL(n)&&r.html('<a href="'+n+'" target="_blank">'+n+"</a>")});t.displayResults()}):t.resultsLayer.clearFeatures()}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.LayerCatalog=function(){var e=this;e.layers=[];e.searchInit=!1;TC.Control.apply(e,arguments);e._readyDeferred=$.Deferred();TC.Consts.classes.SELECTABLE||(TC.Consts.classes.SELECTABLE="tc-selectable");TC.Consts.classes.INCOMPATIBLE||(TC.Consts.classes.INCOMPATIBLE="tc-incompatible");TC.Consts.classes.ACTIVE||(TC.Consts.classes.ACTIVE="tc-active");e._$div.on("mouseup.tc","li",function(t){var r=$(t.target);if(!r.hasClass(e.CLASS+"-leaf")){r.toggleClass(TC.Consts.classes.COLLAPSED);r.find("ul").first().toggleClass(TC.Consts.classes.COLLAPSED);t.stopPropagation()}})};TC.inherit(TC.control.LayerCatalog,TC.Control);!function(){var e=TC.control.LayerCatalog.prototype;e.CLASS="tc-ctl-lcat";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/LayerCatalog.html";e.template[e.CLASS+"-branch"]=TC.apiLocation+"TC/templates/LayerCatalogBranch.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LayerCatalogNode.html";e.template[e.CLASS+"-info"]=TC.apiLocation+"TC/templates/LayerCatalogInfo.html";e.template[e.CLASS+"-results"]=TC.apiLocation+"TC/templates/LayerCatalogResults.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"availableLayers"}).x(t.get(["enableSearch"],!1),t,{block:r},{}).w('</h2><div class="tc-ctl-lcat-search tc-hidden tc-collapsed"><div class="tc-group"><input type="search" class="tc-ctl-lcat-input tc-textbox" placeholder="').h("i18n",t,{},{$key:"textToSearchInLayers"}).w('" /></div><ul></ul></div><div class="tc-ctl-lcat-tree">').x(t.get(["layerTrees"],!1),t,{"else":i,block:a},{}).w('</div><div class="tc-ctl-lcat-info tc-hidden">').p("tc-ctl-lcat-info",t,t.rebase(t.getPath(!0,[])),{}).w("</div>")}function r(e,t){return e.x(t.get(["layerTrees"],!1),t,{block:n},{})}function n(e,t){return e.w('<button class="tc-ctl-lcat-btn-search" title="').h("i18n",t,{},{$key:"searchlayersbytext"}).w('"></button>')}function i(e,t){return e.w('<div class="tc-ctl tc-ctl-lcat-loading"><span>').h("i18n",t,{},{$key:"loadingLayerTree"}).w("...</span></div>")}function a(e,t){return e.w('<ul class="tc-ctl-lcat-branch">').s(t.get(["layerTrees"],!1),t,{block:s},{}).w("</ul>")}function s(e,t){return e.p("tc-ctl-lcat-branch",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;return t};e.template[e.CLASS+"-branch"]=function(){function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":r,block:n},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><span>').f(t.get(["title"],!1),t,"h").w('</span><ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:i},{}).w("</ul></li>")}function r(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}function n(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}function i(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-branch",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){function t(e,t){return e.x(t.get(["isVisible"],!1),t,{block:r},{})}function r(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":n,block:i},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><span data-tooltip="').x(t.get(["name"],!1),t,{block:a},{}).w('">').f(t.get(["title"],!1),t,"h").w("</span>").x(t.get(["name"],!1),t,{block:s},{}).w('<ul class="tc-ctl-lcat-branch tc-collapsed">').s(t.get(["children"],!1),t,{block:o},{}).w("</ul></li>")}function n(e,t){return e.w('class="tc-ctl-lcat-node tc-ctl-lcat-leaf"')}function i(e,t){return e.w('class="tc-ctl-lcat-node tc-collapsed"')}function a(e,t){return e.h("i18n",t,{},{$key:"clickToAddToMap"})}function s(e,t){return e.w('<button class="tc-ctl-lcat-btn-info"/>')}function o(e,t){return e.p("tc-ctl-lcat-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-node",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;return t};e.template[e.CLASS+"-info"]=function(){function t(e,t){return e.w('<a class="tc-ctl-lcat-info-close"></a><h2>').h("i18n",t,{},{$key:"layerInfo"}).w('</h2><h3 class="tc-ctl-lcat-title">').f(t.get(["title"],!1),t,"h").w("</h3>").x(t.get(["abstract"],!1),t,{block:r},{}).x(t.get(["metadata"],!1),t,{block:n},{})}function r(e,t){return e.w('<div class="tc-ctl-lcat-abstract"><h4>').h("i18n",t,{},{$key:"abstract"}).w("</h4><div>").f(t.get(["abstract"],!1),t,"h").w("</div></div>")}function n(e,t){return e.w('<div class="tc-ctl-lcat-metadata"><h4>').h("i18n",t,{},{$key:"metadata"}).w("</h4><ul>").s(t.get(["metadata"],!1),t,{block:i},{}).w("</ul></div>")}function i(e,t){return e.w('<li><a href="').f(t.get(["url"],!1),t,"h",["s"]).w('" type="').f(t.get(["format"],!1),t,"h").w('" title="').f(t.get(["formatDescription"],!1),t,"h").w('" target="_blank">').f(t.get(["formatDescription"],!1),t,"h").w("</a></li>")}dust.register(e.CLASS+"-info",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;return t};e.template[e.CLASS+"-results"]=function(){function t(e,t){return e.s(t.get(["servicesFound"],!1),t,{"else":r,block:n},{})}function r(e,t){return e.w('<li class="tc-ctl-lcat-no-results"><h5>').h("i18n",t,{},{$key:"noMatches"}).w("</h5></li>")}function n(e,t){return e.h("gt",t,{block:i},{key:t.get(["servicesLooked"],!1),value:1}).s(t.get(["founds"],!1),t,{block:s},{}).h("gt",t,{block:c},{key:t.get(["servicesLooked"],!1),value:1})}function i(e,t){return e.w('<li class="tc-ctl-lcat-search-group ').x(t.getPath(!1,["service","isCollapsed"]),t,{block:a},{}).w('" data-tc-service-index="').f(t.getPath(!1,["service","index"]),t,"h").w('"><h5>').f(t.getPath(!1,["service","title"]),t,"h").w("</h5><ul>")}function a(e,t){return e.w("tc-collapsed")}function s(e,t){return e.w('<li data-tc-layer-name="').f(t.get(["Name"],!1),t,"h").w('" ').x(t.get(["alreadyAdded"],!1),t,{"else":o,block:l},{}).w('><h5 class="tc-selectable">').f(t.get(["Title"],!1),t,"h").w('</h5><button class="tc-ctl-lcat-search-btn-info" /></li>')}function o(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"clickToAddToMap"}).w('" ')}function l(e,t){return e.w(' data-tooltip="').h("i18n",t,{},{$key:"layerAlreadyAdded"}).w('" class="tc-checked" ')}function c(e,t){return e.w("</ul></li>")}dust.register(e.CLASS+"-results",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;return t}}!function(){var t={LAYER:"tcLayer",LAYERNAME:"tcLayerName",LAYERINFO:"tcLayerInfo",SERVICEINDEX:"tcServiceIndex"},r=3,n="data-tooltip";e.register=function(e){var r=this;TC.Control.prototype.register.call(r,e);var i=function(){if($.isArray(r.options.layers)){for(var e=0;e<r.options.layers.length;e++){var t=r.options.layers[e];if(!t.type||t.type===TC.Consts.layerType.WMS){t.id||(t.id=TC.getUID());$.isPlainObject(t)&&(t=new TC.layer.Raster(t));r.layers.push(t)}}r.render(function(){r._readyDeferred.resolve()})}else r._readyDeferred.resolve()},a=function(t){if(t.layer===e.baseLayer){i();e.off(TC.Consts.event.LAYERUPDATE,a)}};e.loaded(function(){e.baseLayer.state&&e.baseLayer.state!==TC.Layer.state.IDLE?e.on(TC.Consts.event.LAYERUPDATE,a):i()});var s=function(e){var n=$();if(!e.isBase){var i=e.options.url;r._$roots&&r._$roots.each(function(r,a){var s=$(a),o=s.data(t.LAYER);o&&o.type===e.type&&o.options.url===i&&(n=n.add(s))})}return n},o=function(e,t){var r=$(),n=t||s(e);if(n.length)for(var i=0;i<e.names.length;i++){var a=n.find('li[data-tc-layer-name="'+e.names[i]+'"]');r=r.add(a);r=r.add(a.find("li"))}return r},l=function(e){var n=$();if(!e.isBase){var i=e.options.url;r.$list&&r.$list.find("li").each(function(r,a){var s=$(a),o=s.data(t.LAYER);if(o&&o.type===e.type&&o.options.url===i)for(var l=0;l<e.names.length;l++)s.is('li[data-tc-layer-name="'+e.names[l]+'"]')&&(n=n.add(s))})}return n},c=function(){if("createEvent"in document){var e=document.createEvent("HTMLEvents");e.initEvent("keyup",!1,!0);r.$text&&r.$text[0].dispatchEvent(e)}else r.$text&&r.$text[0].fireEvent("keyup")},u=function(e){var t=r.map.getControlsByClass(TC.control.ListTOC)[0];if(t)for(var i=t.layers,a=0;a<i.length;a++){var s=i[a];s!==e&&o(s).addClass(TC.Consts.classes.CHECKED).find("span").attr(n,p)}},p=r.getLocaleString("layerAlreadyAdded"),h=r.getLocaleString("clickToAddToMap");e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFOREUPDATEPARAMS,function(e){o(e.layer).hasClass(TC.Consts.classes.LOADING)||o(e.layer).addClass(TC.Consts.classes.LOADING).find("span").removeAttr(n)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.UPDATEPARAMS,function(e){var t=e.layer;t.isBase||t.type!==TC.Consts.layerType.WMS||r._readyDeferred.then(function(){var e=s(t),i=function(){o(t,e).removeClass(TC.Consts.classes.LOADING).addClass(TC.Consts.classes.CHECKED).find("span").attr(n,p);c()};if(e.length)i();else{for(var a=!1,l=0,u=r.layers.length;u>l;l++){var h=r.layers[l];if(h.type===t.type&&h.options.url===t.options.url){a=!0;break}}a||r.addLayer(new TC.layer.Raster({url:t.options.url,type:t.type,layerNames:[],title:t.title||t.wrap.getServiceTitle(),hideTitle:!0,hideTree:!1})).then(function(){e=s(t);i()})}})}).on(TC.Consts.event.LAYERERROR,function(e){e.reason&&TC.alert(r.getLocaleString(e.reason,{url:e.layer.url}));o(e.layer).removeClass(TC.Consts.classes.LOADING)}).on(TC.Consts.event.LAYERREMOVE,function(e){o(e.layer).removeClass(TC.Consts.classes.CHECKED).find("span").attr(n,h);l(e.layer).removeClass(TC.Consts.classes.CHECKED).attr(n,h);u(e.layer);c()}).on(TC.Consts.event.EXTERNALSERVICEADDED,function(e){if(e&&e.layer){r.addLayer(e.layer);r._$div.removeClass("tc-collapsed")}});r._$div.on(TC.Consts.event.CLICK,"span",function(i){var a=$(i.target),s=a.parent();if(!s.hasClass(TC.Consts.classes.LOADING)&&!s.hasClass(TC.Consts.classes.CHECKED)){i.preventDefault;var o=s.data(t.LAYERNAME);o=void 0!==o?o.toString():"";var l=r._$roots.has(s).data(t.LAYER);l||(l=s.data(t.LAYER));if(l&&o){var c=1;/iPad/i.test(navigator.userAgent)?c=10:TC.Util.detectFirefox()&&(c=250);l.title||(l.title=l.getTree().title);

s.addClass(TC.Consts.classes.LOADING).find("span").attr(n,"");var u=function(e){var t=new $.Deferred;setTimeout(function(){e[0].offsetHeight=e[0].offsetHeight;e[0].offsetWidth=e[0].offsetWidth;t.resolve()},c);return t.promise()};u(s).then(function(){var t=$.extend({},l.options);t.id=TC.getUID();t.layerNames=[o];e.addLayer(t).then(function(e){e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;(401===e.error.code||403===e.error.code)&&t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})});i.stopPropagation()})}}})};e.render=function(e){var i=this,a=$.map(i.layers,function(e){return e.wrap.getLayer()});$.when.apply(i,a).then(function(){var a=$.map(i.layers,function(e){var t=e.getTree(),r=function n(t){for(var r=!1,i=0;i<t.children.length;i++)n(t.children[i])&&(r=!0);t.hasOwnProperty("isVisible")&&(t.isVisible=!e.names||!e.names.length||r||t.isVisible);return t.isVisible};r(t);return t});i.renderData({layerTrees:a,enableSearch:i.options.enableSearch},function(){var a=i.getLocaleString("layerAlreadyAdded");i._$roots=i._$div.find("div."+i.CLASS+"-tree > ul."+i.CLASS+"-branch > li."+i.CLASS+"-node");i._$roots.each(function(e,r){var s=i.layers[e],o=$(r).data(t.LAYER,s),l=o.find("."+i.CLASS+"-btn-info"),c={};l.each(function(e,r){var o=$(r),l=o.parent().find("span").first(),u=o.parent().data(t.LAYERNAME).toString();if(u){l.addClass(TC.Consts.classes.SELECTABLE);var p=s.wrap.getInfo(u);if(p.hasOwnProperty("abstract")||p.hasOwnProperty("legend")||p.hasOwnProperty("metadata")){if(p.metadata)for(var h=0,d=p.metadata.length;d>h;h++){var f=p.metadata[h];f.formatDescription=c[f.format]=c[f.format]||i.getLocaleString(TC.Util.getSimpleMimeType(f.format))||i.getLocaleString("viewMetadata")}o.data(t.LAYERINFO,p);o.on(TC.Consts.event.CLICK,function(){if($(this).hasClass(TC.Consts.classes.CHECKED)){$(this).removeClass(TC.Consts.classes.CHECKED);i.hideLayerInfo()}else{i.showLayerInfo(s,u);$(this).addClass(TC.Consts.classes.CHECKED)}})}else o.remove();s.compatibleLayers&&s.compatibleLayers.indexOf(u)<0&&l.parent().append('<span class="'+TC.Consts.classes.INCOMPATIBLE+'" title="'+i.getLocaleString("srsNotCompatible")+'"></span>');if(i.map)for(var h=0,d=i.map.workLayers.length;d>h;h++){var m=i.map.workLayers[h];if(m.type===TC.Consts.layerType.WMS&&m.url===s.url&&1===m.names.length&&m.names[0]===u){l.parent().addClass(TC.Consts.classes.CHECKED);l.attr(n,a)}}}else{l.attr(n,"");o.remove()}})});i.$text=i._$div.find("."+i.CLASS+"-input");i.$list=i._$div.find("."+i.CLASS+"-search ul");i.$text.on("mouseup",function(e){var t=i.$text.val();""!==t&&setTimeout(function(){var e=i.$text.val();""===e&&i.$list.empty()},1)});var s=[];TC._search=TC._search||{};TC._search.retryTimeout=null;TC.loadJS(!i.$text.autocomplete,[TC.apiLocation+"lib/jQuery/autocomplete.js"],function(){i.$text.autocomplete({link:"#",target:i.$list,minLength:0,source:function(e,n){s=[];i._$roots.find("li."+TC.Consts.classes.CHECKED).each(function(e,r){s.push($(r).data(t.LAYERNAME).toString())});e=e.trim();if(e.length<r)i.$list.html("");else if(e.length>=r){TC._search.retryTimeout&&clearTimeout(TC._search.retryTimeout);TC._search.retryTimeout=setTimeout(function(){for(var t=[],r=0;r<i.layers.length;r++){var a=i.layers[r].searchSubLayers(e);a.length&&t.push({service:{index:r,title:i.layers[r].title||i.layers[r].id},founds:a})}n({servicesFound:t,servicesLooked:i.layers.length})},TC._search.interval)}},callback:function(e){i.$text.val(e.target.text||e.target.innerText);TC._search.lastPattern=i.$text.val();i.goToResult(unescape(e.target.hash).substring(1));i.$text.autocomplete("clear")},buildHTML:function(e){if(e.results&&e.results.servicesFound.length>0)for(var t=i.map.getLayerTree().workLayers,r=0;r<e.results.servicesFound.length;r++){for(var n=e.results.servicesFound[r].founds,a=0;a<n.length;a++){delete n[a].alreadyAdded;for(var o=0;o<t.length;o++)if(s.indexOf(n[a].Name)>=0){n[a].alreadyAdded=!0;break}if(!n[a].Name){n.splice(a,1);a--}}e.results.servicesFound[r].founds.length?e.results.servicesFound[r].service.isCollapsed=$(i._$div.find(".tc-ctl-lcat-search-group")[r]).hasClass(TC.Consts.classes.COLLAPSED):e.results.servicesFound.splice(r,1)}var l="";dust.render(i.CLASS+"-results",e.results,function(e,t){l=t});return l}})});if(!i.searchInit){i._$div.on("click","h2 button",function(){var e=i._$div.hasClass("tc-collapsed");i._$div.removeClass("tc-collapsed");var t=i._$div.find("."+i.CLASS+"-search"),r=i._$div.find("."+i.CLASS+"-tree"),n=i._$div.find("."+i.CLASS+"-info");if(t.hasClass(TC.Consts.classes.HIDDEN)||e){t.removeClass(TC.Consts.classes.HIDDEN);r.addClass(TC.Consts.classes.HIDDEN);i.$text[0].focus();$(this).addClass(i.CLASS+"-btn-tree");$(this).attr("title",i.getLocaleString("viewAvailableLayersTree"));$(this).removeClass(i.CLASS+"-btn-search");var a=$(".tc-ctl-lcat-search li button.tc-checked").length;0===a&&n.addClass(TC.Consts.classes.HIDDEN)}else{t.addClass(TC.Consts.classes.HIDDEN);r.removeClass(TC.Consts.classes.HIDDEN);$(this).addClass(i.CLASS+"-btn-search");$(this).attr("title",i.getLocaleString("searchLayersByText"));$(this).removeClass(i.CLASS+"-btn-tree");var a=$(".tc-ctl-lcat-tree li button.tc-checked").length;a>0&&n.removeClass(TC.Consts.classes.HIDDEN)}});i._$div.on("click","."+i.CLASS+"-search button."+i.CLASS+"-search-btn-info",function(e){e.stopPropagation();if($(this).hasClass(TC.Consts.classes.CHECKED)){$(this).removeClass(TC.Consts.classes.CHECKED);i.hideLayerInfo()}else{var r=$(this).parent();i.showLayerInfo(i.layers[r.parents("li").data(t.SERVICEINDEX)],r.data(t.LAYERNAME));$(this).addClass(TC.Consts.classes.CHECKED)}});i._$div.on("click",".tc-ctl-lcat-search li",function(e){e.stopPropagation();var r=$(this);if(!r.hasClass("tc-ctl-lcat-no-results"))if(r.hasClass("tc-ctl-lcat-search-group"))r.toggleClass(TC.Consts.classes.COLLAPSED);else{var s=r.data(t.LAYERNAME);s=void 0!==s?s.toString():"";if(!$(this).hasClass(TC.Consts.classes.CHECKED)){var o=r.parents("li.tc-ctl-lcat-search-group"),l=i.layers[0==o.length?0:o.data(t.SERVICEINDEX)].options.url,c=i.layers[0==o.length?0:o.data(t.SERVICEINDEX)].title;i.map.addLayer({id:TC.getUID(),url:l,title:c,hideTitle:!0,layerNames:[s]},function(e){r.data(t.LAYER,e);e.wrap.$events.on(TC.Consts.event.TILELOADERROR,function(e){var t=this.parent;(401===e.error.code||403===e.error.code)&&t.map.toast(e.error.text,{type:TC.Consts.msgType.ERROR});t.map.removeLayer(t)})});$(this).addClass(TC.Consts.classes.CHECKED);$(this).attr(n,a)}}});i.searchInit=!0}$.isFunction(e)&&e()})})};e.showLayerInfo=function(e,r){var n=this,i=null,a=n._$div.find("."+n.CLASS+"-info"),s=function(e,r){{var i=!1;a.data(t.LAYERNAME)}if(r){i=!0;a.data(t.LAYERNAME,e);a.removeClass(TC.Consts.classes.HIDDEN);dust.render(n.CLASS+"-info",r,function(e,t){a.html(t);e&&TC.error(e);a.find("."+n.CLASS+"-info-close").on(TC.Consts.event.CLICK,function(){n.hideLayerInfo()})})}return i};n._$div.find("."+n.CLASS+"-btn-info, ."+n.CLASS+"-search-btn-info").removeClass(TC.Consts.classes.CHECKED);n._$roots.each(function(a,o){var l=$(o);if(l.data(t.LAYER)===e){var c=l.find("."+n.CLASS+"-btn-info");c.each(function(e,a){var o=$(a),l=o.parent().data(t.LAYERNAME).toString();if(l===r){var c=o.data(t.LAYERINFO);n._$div.find('li [data-tc-layer-name="'+l+'"] > button').toggleClass(TC.Consts.classes.CHECKED,s(l,c));i=c;return!1}});return!1}});return i}}();e.hideLayerInfo=function(){var e=this;e._$div.find("."+e.CLASS+"-btn-info, ."+e.CLASS+"-search-btn-info").removeClass(TC.Consts.classes.CHECKED);e._$div.find("."+e.CLASS+"-info").addClass(TC.Consts.classes.HIDDEN)};e.addLayer=function(e){var t=$.Deferred(),r=this,n=[];r.options.layers&&r.options.layers.length&&(n=$.grep(r.options.layers,function(t){var r=TC.Util.reqGetMapOnCapabilities(t.url);return r&&r.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));0==n.length&&(n=$.grep(r.layers,function(t){return t.url.replace(TC.Util.regex.PROTOCOL)==e.url.replace(TC.Util.regex.PROTOCOL)}));if(0==n.length){r.layers.push(e);e.getCapabilitiesPromise().then(function(){e.compatibleLayers=e.wrap.getCompatibleLayers(r.map.crs);e.title=e.title||e.wrap.getServiceTitle();r.render(function(){t.resolve()})})}else t.resolve();return t};e.loaded=function(){return this._readyDeferred.promise()}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/control/MapContents");TC.control.Legend=function(){TC.control.MapContents.apply(this,arguments)};TC.inherit(TC.control.Legend,TC.control.MapContents);!function(){var e=TC.control.Legend.prototype;e.CLASS="tc-ctl-legend";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Legend.html";e.template[e.CLASS+"-node"]=TC.apiLocation+"TC/templates/LegendNode.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"legend"}).w('</h2><div class="tc-ctl-legend-tree"><ul class="tc-ctl-legend-branch">').s(t.get(["workLayers"],!1),t,{"else":r,block:n},{}).w("</ul></div>")}function r(e,t){return e.w('<li class="tc-ctl-legend-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}function n(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;return t};e.template[e.CLASS+"-node"]=function(){function t(e,t){return e.w("<li ").x(t.get(["children"],!1),t,{"else":r,block:n},{}).w(' data-tc-layer-name="').f(t.get(["name"],!1),t,"h").w('" data-tc-layer-uid="').f(t.get(["uid"],!1),t,"h").w('"><div class="tc-ctl-legend-title">').f(t.get(["title"],!1),t,"h").w("</div>").x(t.get(["legend"],!1),t,{block:i},{}).w('<ul class="tc-ctl-legend-branch">').s(t.get(["children"],!1),t,{block:c},{}).w("</ul></li>")}function r(e,t){return e.w('class="tc-ctl-legend-node tc-ctl-legend-leaf" ')}function n(e,t){return e.w('class="tc-ctl-legend-node" ')}function i(e,t){return e.w('<div class="tc-ctl-legend-watch">').x(t.getPath(!1,["legend","src"]),t,{"else":a,block:o},{}).w('</div><div class="tc-ctl-legend-nvr">').h("i18n",t,{},{$key:"notVisibleAtCurrentResolution"}).w("</div>")}function a(e,t){return e.w('<div class="tc-ctl-legend-img" style="border:solid ').f(t.getPath(!1,["legend","strokeWidth"]),t,"h").w("px ").f(t.getPath(!1,["legend","strokeColor"]),t,"h").w(";background-color:").f(t.getPath(!1,["legend","fillColor"]),t,"h").x(t.getPath(!1,["legend","width"]),t,{block:s},{}).w('"></div>')}function s(e,t){return e.w(";width:").f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w("px;border-radius:50%")}function o(e,t){return e.w('<img src="" data-tc-img="').f(t.getPath(!1,["legend","src"]),t,"h").w('" ').x(t.getPath(!1,["legend","width"]),t,{block:l},{}).w(" />")}function l(e,t){return e.w('style="width:').f(t.getPath(!1,["legend","width"]),t,"h").w("px;height:").f(t.getPath(!1,["legend","height"]),t,"h").w('px;"')}function c(e,t){return e.p("tc-ctl-legend-node",t,t.rebase(t.getPath(!0,[])),{})}dust.register(e.CLASS+"-node",t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;return t}}var t={layer:"tcLayer",layerUid:"tcLayerUid"};e.register=function(e){var t=this;TC.control.MapContents.prototype.register.call(t,e)};e.loadGraphics=function(){var e=this;e._$div.find("ul."+e.CLASS+"-branch").first().children("li").not("."+e.CLASS+"-empty").each(function(r,n){var i=$(n),a=i.data(t.layer);i.find("li").each(function(t,r){var n=$(r),i=n.find("img").first();i&&void 0!=i.attr("src")&&0==i.attr("src").length&&e.styleLegendImage(i,a)})})};e.updateScale=function(){var e=this,r=e.CLASS+"-node-inscale",n=e.CLASS+"-node-outofscale";e._$div.find("ul."+e.CLASS+"-branch").first().children("li").not("."+e.CLASS+"-empty").each(function(i,a){var s=$(a),o=s.data(t.layer);if(o){var l=!1;s.find("li").each(function(i,a){var s=$(a);if(s.hasClass(e.CLASS+"-node-visible")){var c=s.data(t.layerUid);if(o.isVisibleByScale(c)){l=!0;s.removeClass(n).addClass(r);var u=s.find("img").first();u.length>0&&e.styleLegendImage(u,o)}else s.addClass(n).removeClass(r)}});s.toggleClass(r,l);s.toggleClass(n,!l)}})};e.update=function(){var e=this;e._$div.find("ul."+e.CLASS+"-branch").first().children("li").each(function(r,n){var i=$(n),a=i.data(t.layer);if(a){a.getTree();i.find("li").each(function(r,n){var i=$(n),s=i.data(t.layerUid),o=e.CLASS+"-node-visible",l=e.CLASS+"-node-notvisible",c=e.CLASS+"-node-hasvisible";switch(a._cache.visibilityStates[s]){case TC.Consts.visibility.NOT_VISIBLE:i.removeClass(o+" "+c).addClass(l);break;case TC.Consts.visibility.HAS_VISIBLE:i.removeClass(o+" "+l).addClass(c);break;default:i.removeClass(l+" "+c).addClass(o)}});e.updateLayerVisibility(a)}});e.updateScale()};e.updateLayerTree=function(e){var r=this;if(!e.isBase&&!e.options.stealth){TC.control.MapContents.prototype.updateLayerTree.call(r,e);r._$div.find("."+r.CLASS+"-empty").addClass(TC.Consts.classes.HIDDEN);TC.loadJSInOrder(!window.dust,TC.url.templating,function(){dust.render(r.CLASS+"-node",r.layerTrees[e.id],function(n,i){var a=$(i),s=a.data(t.layerUid),o=r._$div.find("ul."+r.CLASS+"-branch").first(),l=o.find('li[data-tc-layer-uid="'+s+'"]');if(1===l.length)l.html(a.html());else{a.data(t.layer,e);o.prepend(a)}n&&TC.error(n)});r.update()})}};e.removeLayer=function(e){var r=this,n=function(){return r._$div.find("."+r.CLASS+"-branch").first().children("li").not("."+r.CLASS+"-empty")};if(!e.isBase){var i=n();i.each(function(r,a){var s=$(a);if(s.data(t.layer)===e){s.remove();i=n();return!1}});0===i.length&&r._$div.find("."+r.CLASS+"-empty").removeClass(TC.Consts.classes.HIDDEN)}};e.updateLayerVisibility=function(e){var r=this;r._$div.find("."+r.CLASS+"-branch").first().children("li").each(function(n,i){var a=$(i);if(a.data(t.layer)===e){a.toggleClass(r.CLASS+"-node-notvisible",!e.getVisibility());return!1}})};e.getLayerUIElements=function(){var e=this;return e._$div.find("ul."+e.CLASS+"-branch").first().children("li."+e.CLASS+"-node")}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.LineFeatureInfo=function(){var e=this;TC.control.GeometryFeatureInfo.apply(this,arguments);e.geometryType=TC.Consts.geom.POLYLINE};TC.inherit(TC.control.LineFeatureInfo,TC.control.GeometryFeatureInfo);var e=TC.control.LineFeatureInfo.prototype;e.CLASS="tc-ctl-finfo";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/FeatureInfo.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureInfoDialog.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w('<ul class="tc-ctl-finfo-services">').s(t.get(["services"],!1),t,{"else":r,block:n},{}).w("</ul>").x(t.get(["featureCount"],!1),t,{block:O},{})}function r(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}function n(e,t){return e.w("<li><h3>").x(t.getPath(!1,["mapLayer","title"]),t,{"else":i,block:a},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{"else":s,block:E},{}).w("</div></li>")}function i(e,t){return e.f(t.getPath(!1,["mapLayer","id"]),t,"h")}function a(e,t){return e.f(t.getPath(!1,["mapLayer","title"]),t,"h")}function s(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{"else":o,block:l},{}).w("</ul>")}function o(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}function l(e,t){return e.w("<li><h4>").s(t.get(["path"],!1),t,{block:c},{}).w(' <span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w('</span> </h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{"else":p,block:h},{}).w("</ul></div></li>")}function c(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:u},{})}function u(e,t){return e.w(" &bull; ")}function p(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}function h(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{"else":d,block:C},{}).w("</li>")}function d(e,t){return e.x(t.get(["error"],!1),t,{"else":f,block:v},{})}function f(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:m},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:y},{}).w("</tbody></table>").x(t.get(["geometry"],!1),t,{block:g},{})}function m(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToCenter"}).w('"')}function y(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}function g(e,t){return e.w('<div class="tc-ctl-finfo-tools"><button class="tc-ctl-finfo-tools-btn" title="').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w('">').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w("</button></div>")}function v(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}function C(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{"else":T,block:L},{key:t.get(["rawFormat"],!1),value:"text/html"})}function T(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}function L(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:w},{})}function w(e,t){return e.h("ne",t,{"else":b,block:S},{key:t.get(["expandUrl"],!1),value:""})}function b(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" />')}function S(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" /><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}function E(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}function O(e,t){return e.h("gt",t,{block:A},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}function A(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-idx"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;p.__dustBody=!0;h.__dustBody=!0;d.__dustBody=!0;f.__dustBody=!0;m.__dustBody=!0;y.__dustBody=!0;g.__dustBody=!0;v.__dustBody=!0;C.__dustBody=!0;T.__dustBody=!0;L.__dustBody=!0;w.__dustBody=!0;b.__dustBody=!0;S.__dustBody=!0;E.__dustBody=!0;O.__dustBody=!0;A.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w('<div class="tc-ctl-finfo-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-finfo-dialog-dl"><h2>').h("i18n",t,{},{$key:"download"}).w('</h2><div><button class="tc-button tc-ctl-finfo-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-ctl-finfo-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-ctl-finfo-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-ctl-finfo-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button></div></div><div class="tc-ctl-finfo-dialog-share"></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.LoadingIndicator=function(){var e=this;TC.Control.apply(e,arguments);window.addEventListener("error",function(){e.reset();return!1},!1)};TC.inherit(TC.control.LoadingIndicator,TC.Control);!function(){var e=TC.control.LoadingIndicator.prototype;e.CLASS="tc-ctl-load";e.template=TC.isDebug?TC.apiLocation+"TC/templates/LoadingIndicator.html":function(){function t(e,t){return e.w('<div class="tc-ctl-load-bar"><div class="tc-ctl-load-dots tc-ctl-load-dot1"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot2"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot3"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot4"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot5"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot6"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot7"> </div><div class="tc-ctl-load-dots tc-ctl-load-dot8"> </div></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.waits={};e.startWait=function(t){var r=this;void 0===e.waits[t.layer.id]&&(e.waits[t.layer.id]=0);e.waits[t.layer.id]=e.waits[t.layer.id]+1;r.show();r.map.$events.trigger($.Event(TC.Consts.event.STARTLOADING))};e.stopWait=function(t){var r=this,n=e.waits[t.layer.id];n>0&&(n=e.waits[t.layer.id]=n-1);n||delete e.waits[t.layer.id];var i=0;for(var a in e.waits)i++;if(!i){r.map?r.map.isLoaded&&r.hide():r.hide();r.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))}};e.reset=function(t){var r=this;e.waits={};r.hide();r.map.$events.trigger($.Event(TC.Consts.event.STOPLOADING))};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.on(TC.Consts.event.BEFORELAYERADD+" "+TC.Consts.event.BEFORELAYERUPDATE+" "+TC.Consts.event.BEFOREFEATURESADD,function(e){t.startWait(e)}).on(TC.Consts.event.LAYERADD+" "+TC.Consts.event.LAYERERROR+" "+TC.Consts.event.LAYERUPDATE+" "+TC.Consts.event.FEATURESADD,function(e){t.stopWait(e)}).on(TC.Consts.event.BEFOREFEATUREINFO,function(e){t.addWait(TC.Consts.event.FEATUREINFO)}).on(TC.Consts.event.FEATUREINFO+" "+TC.Consts.event.NOFEATUREINFO+" "+TC.Consts.event.FEATUREINFOERROR,function(e){t.removeWait(TC.Consts.event.FEATUREINFO)});if(!TC.isDebug){window.addEventListener("error",function(e,r,n,i,a){t.reset();return!1});$(document).ajaxError(function(e,r,n){t.reset()})}};e.addWait=function(e){var t,r=this,t=e||TC.getUID();r.startWait({layer:{id:t}});return t};e.removeWait=function(e){this.stopWait({layer:{id:e}})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POINT="point.tc";TC.control.Measure=function(){var e=this;TC.Control.apply(e,arguments);this.renderPromise().then(function(){e.measureMode=e.options.mode;e.history=[];e.historyIndex=0;e.reset=!0;e.wrap=new TC.wrap.control.Measure(e);e._$len=e._$div.find(".tc-ctl-meas-val-len");e._$area=e._$div.find(".tc-ctl-meas-val-area");e._$peri=e._$div.find(".tc-ctl-meas-val-peri");e.setMode(e.options.mode)})};TC.inherit(TC.control.Measure,TC.Control);!function(){var e=TC.control.Measure.prototype;e.CLASS="tc-ctl-meas";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Measure.html":function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"measure"}).w('</h2><div class="tc-ctl-meas-select"><form><label class="tc-ctl-meas-btn-len"><input type="radio" name="mode" value="polyline" /><span>').h("i18n",t,{},{$key:"length"}).w('</span></label><label class="tc-ctl-meas-btn-area"><input type="radio" name="mode" value="polygon" /><span>').h("i18n",t,{},{$key:"areaAndPerimeter"}).w('</span></label></form></div><div class="tc-ctl-meas-len tc-hidden"><div class="tc-ctl-meas-lines"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"length"}).w(': <span class="tc-ctl-meas-val-len"></span></div></div><div class="tc-ctl-meas-area tc-hidden"><div class="tc-ctl-meas-polygon"></div><div class="tc-ctl-meas-txt">').h("i18n",t,{},{$key:"area"}).w(': <span class="tc-ctl-meas-val-area"></span>, ').h("i18n",t,{},{$key:"perimeter"}).w(': <span class="tc-ctl-meas-val-peri"></span></div></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.render=function(e){var t=this;TC.Control.prototype.render.call(t,function(){TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){t.options.mode&&t._$div.find(".tc-ctl-meas-select").addClass(TC.Consts.classes.HIDDEN);t._$div.find("span").on(TC.Consts.event.CLICK,function(e){var r=$(this).closest("label").find("input[type=radio][name=mode]"),n=r.val();r.prop("checked",!0);t.setMode(n,!0)});$.isFunction(e)&&e()})})};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.renderPromise().then(function(){e.loaded(function(){t.layerPromise=e.addLayer({id:TC.getUID(),title:"Medici\xf3n",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{point:$.extend({},e.options.styles.point,{fillOpacity:0}),line:e.options.styles.line,polygon:e.options.styles.polygon}});$.when(t.layerPromise).then(function(r){t.layer=r;t.layer.map.putLayerOnTop(t.layer);TC.loadJS(!TC.control.Draw,TC.apiLocation+"TC/control/Draw",function(){t.drawLines=new TC.control.Draw({div:t._$div.find(".tc-ctl-meas-lines"),mode:TC.Consts.geom.POLYLINE,measure:!0,layer:t.layer});t.drawPolygons=new TC.control.Draw({div:t._$div.find(".tc-ctl-meas-polygon"),mode:TC.Consts.geom.POLYGON,measure:!0,layer:t.layer});$.when(e.addControl(t.drawLines),e.addControl(t.drawPolygons)).then(function(){var e=function(e){var r="m"===e.units?0:3;e.area?t._$area.html(e.area.toFixed(r).replace(".",",")+" "+e.units+"&sup2;"):0===e.area&&t.resetValues();e.perimeter?t._$peri.html(e.perimeter.toFixed(r).replace(".",",")+" "+e.units):0===e.perimeter&&t.resetValues();e.length?t._$len.html(e.length.toFixed(r).replace(".",",")+" "+e.units):0===e.length&&t.resetValues()};t.drawLines.$events.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(t){e(t)}).on(TC.Consts.event.DRAWCANCEL,function(){t.cancel()});t.drawPolygons.$events.on(TC.Consts.event.MEASURE+" "+TC.Consts.event.MEASUREPARTIAL,function(t){e(t)}).on(TC.Consts.event.DRAWCANCEL,function(){t.cancel()})});t.setMode(t.options.mode)})})})})};e.activate=function(){var e=this;TC.Control.prototype.activate.call(e)};e.deactivate=function(){var e=this;TC.Control.prototype.deactivate.call(e)};e.setMode=function(e,t){var r=this;r.mode=e;var n,i,a;switch(e){case TC.Consts.geom.POLYLINE:r.drawLines.activate();n=r._$div.find(".tc-ctl-meas-len");i=r._$div.find(".tc-ctl-meas-area");a=TC.Consts.event.CONTROLACTIVATE;break;case TC.Consts.geom.POLYGON:r.drawPolygons.activate();n=r._$div.find(".tc-ctl-meas-area");i=r._$div.find(".tc-ctl-meas-len");a=TC.Consts.event.CONTROLACTIVATE;break;case null:case void 0:r.drawLines&&r.drawLines.isActive&&r.drawLines.cancel();r.drawPolygons&&r.drawPolygons.isActive&&r.drawPolygons.cancel();n=$();i=r._$div.find(".tc-ctl-meas-area,.tc-ctl-meas-len");a=TC.Consts.event.CONTROLDEACTIVATE;break;default:r.drawLines.activate();n=r._$div.find(".tc-ctl-meas-area,.tc-ctl-meas-len");i=$();a=TC.Consts.event.CONTROLACTIVATE}r.resetValues();var s;if(e){s=r._$div.find("input[type=radio][name=mode][value="+e+"]").prop("checked",!0).addClass(TC.Consts.classes.CHECKED);s.next().addClass(TC.Consts.classes.CHECKED)}else{s=r._$div.find("input[type=radio][name=mode]").prop("checked",!1).removeClass(TC.Consts.classes.CHECKED);s.next().removeClass(TC.Consts.classes.CHECKED)}n.removeClass(TC.Consts.classes.HIDDEN);i.addClass(TC.Consts.classes.HIDDEN);a&&r.map&&r.map.$events.trigger($.Event(a,{control:r}));window.meas=r};e.cancel=function(){this.setMode(null,!1)};e.resetValues=function(){var e=this;e.NOMEASURE="-";if(e._$len){e._$len.text(e.NOMEASURE);e._$area.text(e.NOMEASURE);e._$peri.text(e.NOMEASURE)}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.control.MultiFeatureInfo=function(){var e=this;e.lineColor=null;TC.Control.apply(e,arguments);e.modes=e.options.modes||{};"undefined"==typeof e.modes[TC.Consts.geom.POINT]&&(e.modes[TC.Consts.geom.POINT]=!0);"undefined"==typeof e.modes[TC.Consts.geom.POLYGON]&&(e.modes[TC.Consts.geom.POLYGON]=!0);e.fInfoCtrl=null;e.lineFInfoCtrl=null;e.polygonFInfoCtrl=null;e.lastCtrlActive=null;e.listTOCCtrl=null;e.popup=null};TC.inherit(TC.control.MultiFeatureInfo,TC.Control);var e=TC.control.MultiFeatureInfo.prototype;e.CLASS="tc-ctl-m-finfo";e.template=TC.isDebug?TC.apiLocation+"TC/templates/MultiFeatureInfo.html":function(){function t(e,t){return e.w('<div class="tc-ctl-m-finfo-select"><form><span>').h("i18n",t,{},{$key:"selection"}).w("</span>").x(t.get(["pointSelectValue"],!1),t,{block:r},{}).x(t.get(["lineSelectValue"],!1),t,{block:n},{}).x(t.get(["polygonSelectValue"],!1),t,{block:i},{}).w("</form></div>")}function r(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-point" title="').h("i18n",t,{},{$key:"selectionByPoint"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["pointSelectValue"],!1),t,"h").w('" checked /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPoint"}).w("</span></label>")}function n(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-line" title="').h("i18n",t,{},{$key:"selectionByLine"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["lineSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byLine"}).w("</span></label>")}function i(e,t){return e.w('<label class="tc-ctl-m-finfo-btn-polygon" title="').h("i18n",t,{},{$key:"selectionByPrecinct"}).w('"><input type="radio" name="selectmode" value="').f(t.get(["polygonSelectValue"],!1),t,"h").w('" /><span class="tc-ctl-btn">').h("i18n",t,{},{$key:"byPrecinct"}).w("</span></label>")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.loaded(function(){var r=[];if(t.modes[TC.Consts.geom.POINT]){var n=$.Deferred();r.push(n);$.when(e.addControl("featureInfo",{displayMode:t.options.displayMode})).then(function(e){t.fInfoCtrl=e;n.resolve()})}if(t.modes[TC.Consts.geom.POLYLINE]){var i=$.Deferred();r.push(i);$.when(e.addControl("lineFeatureInfo",{displayMode:t.options.displayMode,lineColor:t.lineColor})).then(function(e){t.lineFInfoCtrl=e;i.resolve()})}if(t.modes[TC.Consts.geom.POLYGON]){var a=$.Deferred();r.push(a);$.when(e.addControl("polygonFeatureInfo",{displayMode:t.options.displayMode,lineColor:t.lineColor})).then(function(e){t.polygonFInfoCtrl=e;a.resolve()})}$.when.apply(this,r).then(function(){if(t.fInfoCtrl){t.fInfoCtrl.activate();t.lastCtrlActive=t.fInfoCtrl;t.lastCtrlActive.popup=t.popup}})});$.when(e.addControl("popup",{closeButton:!0,draggable:t.options.draggable})).then(function(e){t.popup=e;e.caller=t})};e.render=function(e){var t=this;t.lineColor=t.options.lineColor?t.options.lineColor:"#c00";var r={};t.modes[TC.Consts.geom.POINT]&&(r.pointSelectValue=TC.Consts.geom.POINT);t.modes[TC.Consts.geom.POLYLINE]&&(r.lineSelectValue=TC.Consts.geom.POLYLINE);t.modes[TC.Consts.geom.POLYGON]&&(r.polygonSelectValue=TC.Consts.geom.POLYGON);TC.Control.prototype.renderData.call(t,r,function(){var r=function(){switch(this.value){case TC.Consts.geom.POLYLINE:console.log("seleccion por l\xednea");(t.map.activeControl===t.fInfoCtrl||t.map.activeControl===t.polygonFInfoCtrl)&&t.lineFInfoCtrl.activate();t.lastCtrlActive=t.lineFInfoCtrl;break;case TC.Consts.geom.POLYGON:console.log("seleccion por pol\xedgono");(t.map.activeControl===t.fInfoCtrl||t.map.activeControl===t.lineFInfoCtrl)&&t.polygonFInfoCtrl.activate();t.lastCtrlActive=t.polygonFInfoCtrl;break;default:console.log("seleccion por punto");(t.map.activeControl===t.polygonFInfoCtrl||t.map.activeControl===t.lineFInfoCtrl)&&t.fInfoCtrl.activate();t.lastCtrlActive=t.fInfoCtrl}};t._$div.find("input[type=radio]").on("change",r);$.isFunction(e)&&e()})};e.activate=function(){var e=this;e.lastCtrlActive&&e.lastCtrlActive.activate()};e.deactivate=function(){
var e=this;e.lastCtrlActive.deactivate(!1)};TC.Map.prototype.getDefaultControl=function(){var e=this.getControlsByClass("TC.control.MultiFeatureInfo");if(e&&e.length)return e[0].lastCtrlActive;e=this.getControlsByClass("TC.control.FeatureInfo");return e&&e.length?e[0]:null}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.NavBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.NavBar,TC.Control);!function(){var e=TC.control.NavBar.prototype;e.CLASS="tc-ctl-nav";e.render=function(){var e=this;e.wrap||(e.wrap=new TC.wrap.control.NavBar(e))};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.wrap.register(e);e.loaded(function(){t.wrap.refresh()})}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.OverviewMap=function(){var e=this;TC.Control.apply(e,arguments);e.$events=$(e);e.isLoaded=!1;e.layer=null;e.wrap=new TC.wrap.control.OverviewMap(e)};TC.inherit(TC.control.OverviewMap,TC.Control);!function(){var e=TC.control.OverviewMap.prototype;e.CLASS="tc-ctl-ovmap";e.template=TC.isDebug?TC.apiLocation+"TC/templates/OverviewMap.html":function(){function t(e,t){return e.w('<div class="tc-ctl-ovmap-load tc-hidden"></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this,r=t.options.layer;TC.Control.prototype.register.call(t,e);e.loaded(function(){var n;if("string"==typeof r){var i=function(e,t){for(var r=null,n=0;n<t.length;n++){var i=t[n],a=i.id||i;if(a===e){r=i;break}}return r},a=i(r,TC.Cfg.availableBaseLayers);$.isPlainObject(a)||(a=i(r,e.options.baseLayers));$.isPlainObject(a)&&(n=new TC.layer.Raster(a))}else n=r instanceof TC.Layer?r:r.type===TC.Consts.layerType.VECTOR||r.type===TC.Consts.layerType.KML||r.type===TC.Consts.layerType.WFS?new TC.layer.Vector(r):new TC.layer.Raster(r);t.layer=n;t.wrap.register(e)})};e.loaded=function(e){var t=this;$.isFunction(e)&&(t.isLoaded&&t.map&&t.map.isLoaded?e():t.$events.on(TC.Consts.event.MAPLOAD,e))};e.activate=function(){this.enable()};e.deactivate=function(){this.disable()};e.enable=function(){var e=this;TC.Control.prototype.enable.call(e);e.wrap.enable()};e.disable=function(){var e=this;TC.Control.prototype.disable.call(e);e.wrap.disable()}}();TC.control=TC.control||{};TC.control.GeometryFeatureInfo||TC.syncLoadJS(TC.apiLocation+"TC/control/GeometryFeatureInfo");!function(){TC.control.PolygonFeatureInfo=function(){var e=this;TC.control.GeometryFeatureInfo.apply(this,arguments);e.geometryType=TC.Consts.geom.POLYGON};TC.inherit(TC.control.PolygonFeatureInfo,TC.control.GeometryFeatureInfo);var e=TC.control.PolygonFeatureInfo.prototype;e.CLASS="tc-ctl-finfo";e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/FeatureInfo.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/FeatureInfoDialog.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w('<ul class="tc-ctl-finfo-services">').s(t.get(["services"],!1),t,{"else":r,block:n},{}).w("</ul>").x(t.get(["featureCount"],!1),t,{block:O},{})}function r(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noData"}).w("</li>")}function n(e,t){return e.w("<li><h3>").x(t.getPath(!1,["mapLayer","title"]),t,{"else":i,block:a},{}).w('</h3><div class="tc-ctl-finfo-service-content">').s(t.get(["hasLimits"],!1),t,{"else":s,block:E},{}).w("</div></li>")}function i(e,t){return e.f(t.getPath(!1,["mapLayer","id"]),t,"h")}function a(e,t){return e.f(t.getPath(!1,["mapLayer","title"]),t,"h")}function s(e,t){return e.w('<ul class="tc-ctl-finfo-layers">').s(t.get(["layers"],!1),t,{"else":o,block:l},{}).w("</ul>")}function o(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataAtThisService"}).w("</li>")}function l(e,t){return e.w("<li><h4>").s(t.get(["path"],!1),t,{block:c},{}).w(' <span class="tc-ctl-finfo-layer-n">').f(t.getPath(!1,["features","length"]),t,"h").w('</span> </h4> <div class="tc-ctl-finfo-layer-content"><ul class="tc-ctl-finfo-features">').s(t.get(["features"],!1),t,{"else":p,block:h},{}).w("</ul></div></li>")}function c(e,t){return e.f(t.getPath(!0,[]),t,"h").h("sep",t,{block:u},{})}function u(e,t){return e.w(" &bull; ")}function p(e,t){return e.w('<li class="tc-ctl-finfo-empty">').h("i18n",t,{},{$key:"noDataInThisLayer"}).w("</li>")}function h(e,t){return e.w("<li>").x(t.get(["rawContent"],!1),t,{"else":d,block:C},{}).w("</li>")}function d(e,t){return e.x(t.get(["error"],!1),t,{"else":f,block:v},{})}function f(e,t){return e.w("<h5>").f(t.get(["id"],!1),t,"h").w("</h5><table").x(t.get(["geometry"],!1),t,{block:m},{}).w("><tbody>").s(t.get(["attributes"],!1),t,{block:y},{}).w("</tbody></table>").x(t.get(["geometry"],!1),t,{block:g},{})}function m(e,t){return e.w(' title="').h("i18n",t,{},{$key:"clickToCenter"}).w('"')}function y(e,t){return e.w('<tr><th class="tc-ctl-finfo-attr">').f(t.get(["name"],!1),t,"h").w('</th><td class="tc-ctl-finfo-val">').f(t.get(["value"],!1),t,"h").w("</td></tr>")}function g(e,t){return e.w('<div class="tc-ctl-finfo-tools"><button class="tc-ctl-finfo-tools-btn" title="').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w('">').h("i18n",t,{},{$key:"download"}).w("/").h("i18n",t,{},{$key:"share"}).w("</button></div>")}function v(e,t){return e.w('<span class="tc-ctl-finfo-errors">').h("i18n",t,{},{$key:"fi.error"}).w('<span class="tc-ctl-finfo-error-text">').f(t.get(["error"],!1),t,"h").w("</span></span>")}function C(e,t){return e.w("<h5>").h("i18n",t,{},{$key:"feature"}).w("</h5>").h("eq",t,{"else":T,block:L},{key:t.get(["rawFormat"],!1),value:"text/html"})}function T(e,t){return e.w("<pre>").f(t.get(["rawContent"],!1),t,"h").w("</pre>")}function L(e,t){return e.w(" ").x(t.get(["expandUrl"],!1),t,{block:w},{})}function w(e,t){return e.h("ne",t,{"else":b,block:S},{key:t.get(["expandUrl"],!1),value:""})}function b(e,t){return e.w('<iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" />')}function S(e,t){return e.w('<div class="tc-ctl-finfo-features-iframe-cnt"><iframe src="').f(t.get(["rawUrl"],!1),t,"h").w('" /><a class="tc-ctl-finfo-open" onclick="window.open(\'').f(t.get(["expandUrl"],!1),t,"h").w("', '_blank')\" title=\"").h("i18n",t,{},{$key:"expand"}).w('"></a></div>')}function E(e,t){return e.w('<span class="tc-ctl-finfo-errors">').f(t.get(["hasLimits"],!1),t,"h").w("</span>")}function O(e,t){return e.h("gt",t,{block:A},{key:t.get(["featureCount"],!1),value:"1",type:"number"})}function A(e,t){return e.w('<a class="tc-ctl-btn tc-ctl-finfo-btn-prev">').h("i18n",t,{},{$key:"previous"}).w('</a><div class="tc-ctl-finfo-counter"><span class="tc-ctl-finfo-idx"></span>/').f(t.get(["featureCount"],!1),t,"h").w('</div><a class="tc-ctl-btn tc-ctl-finfo-btn-next">').h("i18n",t,{},{$key:"next"}).w("</a>")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;o.__dustBody=!0;l.__dustBody=!0;c.__dustBody=!0;u.__dustBody=!0;p.__dustBody=!0;h.__dustBody=!0;d.__dustBody=!0;f.__dustBody=!0;m.__dustBody=!0;y.__dustBody=!0;g.__dustBody=!0;v.__dustBody=!0;C.__dustBody=!0;T.__dustBody=!0;L.__dustBody=!0;w.__dustBody=!0;b.__dustBody=!0;S.__dustBody=!0;E.__dustBody=!0;O.__dustBody=!0;A.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w('<div class="tc-ctl-finfo-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"feature"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="tc-ctl-finfo-dialog-dl"><h2>').h("i18n",t,{},{$key:"download"}).w('</h2><div><button class="tc-button tc-ctl-finfo-dl-btn-kml" data-format="KML" title="KML">KML</button><button class="tc-button tc-ctl-finfo-dl-btn-gml" data-format="GML" title="GML">GML</button><button class="tc-button tc-ctl-finfo-dl-btn-geojson" data-format="GeoJSON" title="GeoJSON">GeoJSON</button><button class="tc-button tc-ctl-finfo-dl-btn-wkt" data-format="WKT" title="WKT">WKT</button></div></div><div class="tc-ctl-finfo-dialog-share"></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.POPUP="popup.tc";TC.Consts.event.POPUPHIDE="popuphide.tc";TC.Consts.classes.DRAG=TC.Consts.classes.DRAG||"tc-drag";TC.Consts.classes.DRAGGED=TC.Consts.classes.DRAGGED||"tc-dragged";TC.Consts.classes.DRAGGABLE=TC.Consts.classes.DRAGGABLE||"tc-draggable";TC.control.Popup=function(){var e=this;TC.Control.apply(e,arguments);e.currentFeature=null;e.wrap=new TC.wrap.control.Popup(e)};TC.inherit(TC.control.Popup,TC.Control);!function(){var e=TC.control.Popup.prototype;e.CLASS="tc-ctl-popup";e.render=function(){};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);$.when(e.wrap.addPopup(t)).then(function(){e.on(TC.Consts.event.LAYERVISIBILITY,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&!e.layer.getVisibility()&&t.hide()});e.on(TC.Consts.event.LAYERREMOVE,function(e){t.currentFeature&&t.currentFeature.layer===e.layer&&t.hide()});e.on(TC.Consts.event.UPDATE,function(){t.currentFeature&&t.currentFeature._visibilityState!==TC.Consts.visibility.NOT_VISIBLE||t.hide()});e.on(TC.Consts.event.FEATUREREMOVE,function(e){t.currentFeature===e.feature&&t.hide()})})};e.fitToView=function(e){var t=this;e?setTimeout(function(){t.wrap.fitToView()},1e3):t.wrap.fitToView()};e.hide=function(){var e=this;if(e.map){e.map.wrap.hidePopup(e);e.setDragged(!1);e.map.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:e}))}};e.setDragged=function(e){var t=this;t.dragged=e;t.$popupDiv&&t.$popupDiv.toggleClass(TC.Consts.classes.DRAGGED,e);t.wrap.setDragged(e)};e.setDragging=function(e){var t=this;e&&t.setDragged(!0);t.$popupDiv.toggleClass(TC.Consts.classes.DRAG,e)};e.isVisible=function(){var e=this;return e.$popupDiv&&e.$popupDiv.hasClass(TC.Consts.classes.VISIBLE)}}();TC.control=TC.control||{};TC.Consts.classes.PRINTABLE="tc-printable";TC.control.Print=function(e){var t=this,r=e||{};t.ready=!1;t.title=r.title||"P\xe1gina de impresi\xf3n";t.cssUrl=r.cssUrl||TC.apiLocation+"TC/css/print.css";if(r.target){for(var n in t.template)dust.cache[n]||t.template[n]();var i=$(r.target);i.addClass(TC.Consts.classes.PRINTABLE);var a=function(e){var r=open(null,t.CLASS),n=i.html();dust.render(t.CLASS+"-page",{title:t.title,content:n,cssUrl:t.cssUrl},function(e,t){r.document.write(t);r.document.close();r.focus();e&&TC.error(e)})};dust.render(t.CLASS,null,function(e,r){i.append(r);i.find("."+t.CLASS+"-btn").on("click",a)})}};!function(){var e=TC.control.Print.prototype;e.CLASS="tc-ctl-print";e.template={};e.template[e.CLASS]=function(){function t(e,t){return e.w('<a class="tc-ctl-print-btn" title="').h("i18n",t,{},{$key:"printThisWindow"}).w('">').h("i18n",t,{},{$key:"print"}).w("</a>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-page"]=function(){function t(e,t){return e.w('<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head><title>').f(t.get(["title"],!1),t,"h").w('</title><link rel="stylesheet" href="').f(t.get(["cssUrl"],!1),t,"h").w('" /></head><body onload="print()" class="tc-ctl-print-page"><h1>').f(t.get(["title"],!1),t,"h").w("</h1>").f(t.get(["content"],!1),t,"h",["s"]).w("</body></html>")}dust.register(e.CLASS+"-page",t);t.__dustBody=!0;return t}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.PrintMap=function(){var e=this;TC.Control.apply(e,arguments)};TC.inherit(TC.control.PrintMap,TC.Control);!function(){var e=TC.control.PrintMap.prototype;e.CLASS="tc-ctl-printMap";e.template={};e.template[e.CLASS]=TC.isDebug?TC.apiLocation+"TC/templates/PrintMap.html":function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"print"}).w('</h2><div><div class="tc-ctl-printMap-div"><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"title"}).w(':</label><input type="text" class="tc-ctl-printMap-title tc-textbox" maxlength="30" placeholder="').h("i18n",t,{},{$key:"mapTitle"}).w('" /></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"layout"}).w(':</label><select id="print-design" class="tc-combo"><option value="landscape">').h("i18n",t,{},{$key:"landscape"}).w('</option><option value="portrait">').h("i18n",t,{},{$key:"portrait"}).w('</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><label>').h("i18n",t,{},{$key:"size"}).w(':</label><select id="print-size" class="tc-combo"><option value="a4">A4</option><option value="a3">A3</option></select></div><div class="tc-group tc-ctl-printMap-cnt"><button class="tc-ctl-printMap-btn tc-button tc-icon-button" title="').h("i18n",t,{},{$key:"printMap"}).w('">').h("i18n",t,{},{$key:"print"}).w("</button></div></div></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);var r=function(){var r="?";$.isEmptyObject(TC.Util.getQueryStringParams(window.location.href))||(r="&");r+="layout=print&orientation="+$("#print-design").val()+"&title="+$("input.tc-ctl-printMap-title").val()+"&size="+$("#print-size").val();var n;n=window.location.hash?window.location.href.replace(window.location.hash,r+window.location.hash):window.location.href+r;t.printWindow&&void 0!==t.printWindow&&t.printWindow.close();TC.printPreview={};TC.printPreview.refererMap=e;for(var i,a=[],s=0;s<e.workLayers.length;s++){i=e.workLayers[s];if((i.type===TC.Consts.layerType.VECTOR||i.type===TC.Consts.layerType.WFS)&&i.getVisibility()&&i.features.length>0)for(var o=i.features,l=0;l<o.length;l++){var c=o[l],u={};if(!(TC.feature.Marker&&c instanceof TC.feature.Marker&&c.options.noPrint)){if(c.layer.styles){var p=void 0==c.layer.styles[c.STYLETYPE]?c.layer.styles["polyline"===c.STYLETYPE?"line":c.STYLETYPE]:c.layer.styles["multipolygon"===c.STYLETYPE?"polygon":c.STYLETYPE];for(var h in p)u[h]="function"==typeof p[h]?p[h](c):p[h]}a.push({geometry:c.geometry,CLASSNAME:c.CLASSNAME,options:$.extend({},c.options,u,c.getStyle(),{layer:null})})}}}TC.printPreview.mapFeatures=a;t.printWindow=window.open(n,"print");t.printWindow.onbeforeunload=function(){delete this.printWindow}.bind(this)};t._$div.on("click",".tc-ctl-printMap-btn",r)}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.PrintPdf=function(){var e=this;TC.Control.apply(e,arguments)};TC.inherit(TC.control.PrintPdf,TC.Control);!function(){var e=TC.control.PrintPdf.prototype;e.CLASS="tc-ctl-print-pdf";var t={marginTop:20,marginLeft:55,a4:{width:596,height:842},a3:{width:842,height:1191},qrCode:{sideLength:85},headerHeight:20},r={PORTRAIT:"portrait",LANDSCAPE:"landscape"},n={A4:"a4",A3:"a3"},i=TC.Util.getParameterByName("orientation"),a=TC.Util.getParameterByName("size"),s=function(e,n){return e===r.PORTRAIT?t[n].width:t[n].height},o=function(e,n){return e===r.PORTRAIT?t[n].height:t[n].width};e.template=TC.isDebug?TC.apiLocation+"TC/templates/PrintPdf.html":function(){function t(e,t){return e.w('<button disabled class="disabled tc-button tc-ctl-print-pdf-btn" title="').h("i18n",t,{},{$key:"printpdf"}).w('"></button>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};var l=function(){var e=window.location.href,t=e.indexOf("?"),r=e.indexOf("#");t>0&&(e=r>t?e.replace(e.substring(t,r),""):e.replace(e.substring(t,e.length-1),""));return e},c=function(e){var r=$.Deferred(),n=150;e?TC.loadJS("undefined"==typeof QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){e.length>n&&(e=TC.Util.shortenUrl(e));var i=$("#qrcode");i.empty();new QRCode(i.get(0),{text:e,width:t.qrCode.sideLength,height:t.qrCode.sideLength});setTimeout(function(){var e=i.find("img").attr("src");r.resolve(e)},100)}):r.resolve(imgBase64);return r.promise()};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.pdfLibPromise=function(){var e=$.Deferred();window.pdfMake?e.resolve():TC.loadJS(!window.pdfMake,[TC.Consts.url.PDFMAKE],function(){e.resolve()});return e.promise()}();var r=!0;e._$div.on("mouseover",function(){if(r){e.toast(t.getLocaleString("print.advice.title")+": "+t.getLocaleString("print.advice.desc"),{type:TC.Consts.msgType.INFO,duration:7e3});r=!1}});var n="."+t.CLASS+"-btn";t.map.$events.on(TC.Consts.event.STARTLOADING,function(){var e=t._$div.find(n);e.addClass("disabled");e.attr("disabled","disabled")});t.map.$events.on(TC.Consts.event.STOPLOADING,function(){var e=t._$div.find(n);e.removeClass("disabled");e.removeAttr("disabled")});t.getLayersFromOpener();t.options.qrCode&&c(l());t._$div.on("click","."+t.CLASS+"-btn",function(){t.createPdf()})};var u=function(){var e=$.Deferred(),s={pageOrientation:i||r.LANDSCAPE,pageSize:a||n.A4,pageMargins:[t.marginLeft,t.marginTop]};e.resolve(s);return e.promise()};e.createPdf=function(){var e=this,r=s(i,a),n=o(i,a);e.canvas=$(".tc-map .ol-viewport canvas")[0];e.mapSize=TC.Util.calculateAspectRatioFit(e.canvas.width,e.canvas.height,r-2*t.marginLeft,n-2*t.marginTop-t.headerHeight);var p=function(t){TC.error(e.getLocaleString("print.error"));TC.error("No se ha podido generar el base64 correspondiente a la imagen: "+t,TC.Consts.msgErrorMode.EMAIL,"Error en la impresi\xf3n")},h=function(r){r.content=r.content||[];var n=$.Deferred(),i=e.map.getControlsByClass(TC.control.ScaleBar)[0];if(i)var a=$(".tc-ctl-sb .ol-scale-line-inner"),s=e.canvas.width/e.mapSize.width,o=a.width()/s;var l=function(e){var t;e&&(t=[[e]]);t[0].push({text:TC.Util.getParameterByName("title"),alignment:"center",fontSize:11});i&&t[0].push({table:{widths:[o],body:[[{text:i.getText(),fontSize:10,alignment:"center"}]]},layout:{hLineWidth:function(e,t){return 0===e?0:1},paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return 0},paddingBottom:function(e,t){return 0}}});r.content.push({table:{widths:[o,"*",o]},layout:"noBorders"});r.content[0].table.body=t;n.resolve(r)};e.options.logo?$.when(TC.Util.imgToDataUrl(e.options.logo,"image/png")).then(function(e,r){var n=(t.headerHeight,r.width*t.headerHeight/r.height,TC.Util.calculateAspectRatioFit(r.width,r.height,o,t.headerHeight));l({image:e,height:n.height,width:n.width})},function(){p(e.options.logo);n.reject()}):l();return n.promise()},d=function(r){var n=$.Deferred();r.content=r.content||[];var i=function(t){r.content.push({table:{widths:["*"],body:[[{image:TC.Util.toDataUrl(t),width:e.mapSize.width}]]},layout:{paddingLeft:function(e,t){return 0},paddingRight:function(e,t){return 0},paddingTop:function(e,t){return.1},paddingBottom:function(e,t){return 0}}});n.resolve(r)};e.options.qrCode?$.when(c(l())).then(function(r){if(r)$.when(TC.Util.addToCanvas(e.canvas,r,{x:e.canvas.width-t.qrCode.sideLength,y:e.canvas.height-t.qrCode.sideLength})).then(function(e){i(e)});else{TC.error(e.getLocaleString("print.qr.error"));i(e.canvas)}}):i(e.canvas);return n.promise()},f=function(t){var r=$.Deferred(),n=function(e,t,r){if(t.isVisibleByScale(e.name)){var n,i;t.options&&t.options.params&&t.options.params.base64LegendSrc?i=t.options.params.base64LegendSrc:e.legend&&(n=e.legend.src);result.push({src:n,title:e.title,level:r,srcBase64:i})}},a=function(e,t,r,n){if(Array.isArray(e))for(var i=0;i<e.length;i++)a(e[i],t,r,n);else if(e&&e.hasOwnProperty("children")&&e.children.length>0){e.title&&e.name&&result.push({header:e.title,level:n});a(e.children,t,r,++n)}if(e&&e.hasOwnProperty("children")&&0==e.children.length){t.apply(this,[e,r,n]);n--}},s=function(){for(var t=[],r=0;r<c.length;r++)for(var n=c[r].layers,i=0;i<n.length;i++)!function(r,n){var i=c[r].layers[n],a=i.src||i.srcBase64;if(a){e.map.options.crossOrigin&&TC.Util.detectIE()&&(a=TC.proxify(a));var s=TC.Util.imgToDataUrl(a,"image/png");t.push(s);s.then(function(e,t){i.image={base64:e,canvas:t}},function(){p(a)})}}(r,i);return t};if(e.options.legend&&e.options.legend.visible){var o=e.options.legend.orientation||i,l=e.map.workLayers,c=[],u=7;t.content=t.content||{};if(l.length>0){for(var h=l.length-1;h>=0;h--){var d=l[h];if(d.type===TC.Consts.layerType.WMS&&d.getVisibility()){result=[];a(d.getTree(),n,d,0);result.length>0&&c.push({title:d.title,layers:result})}}$.when.apply($,s()).then(function(){c.length>0&&t.content.push({text:" ",pageBreak:"before",pageOrientation:o});for(var e=0;e<c.length;e++){var n=c[e],i=10;t.content.push({text:n.title,fontSize:11,margin:[0,0,0,5]});for(var a=0;a<n.layers.length;a++){var s=n.layers[a];i=u*s.level;if(s.header)t.content.push({text:s.header,fontSize:10,margin:[i,0,0,3]});else{t.content.push({text:s.title,fontSize:9,margin:[i,0,0,2]});if(s.image){var l=s.image.canvas.width/2,p=l*s.image.canvas.height/s.image.canvas.width;t.content.push({image:s.image.base64,width:l,height:p,margin:[i,0,0,2]})}}}}r.resolve(t)},function(){r.reject()})}else r.resolve(t)}else r.resolve(t);return r.promise()},m=function(e){var t=window.location.host+"_",r=TC.Util.getParameterByName("title");if(r)t+=r;else{var n=TC.Util.getFormattedDate((new Date).toString(),!0);t+=n}pdfMake.createPdf(e).download(t.replace(/[\\\/:*?"<>\|]/g,"")+".pdf")},y=e.map.getControlsByClass(TC.control.LoadingIndicator)[0],g=y.addWait(),v=function(){y.removeWait(g)};$.when(e.pdfLibPromise).then(u).then(h).fail(v).then(d).then(f).fail(v).then(m).then(v)};e.getLayersFromOpener=function(e){var t=this,r=window.opener;if(r){var n=r.TC,i=n.printPreview?n.printPreview.refererMap:null;i&&t.map.loaded(function(){0===r.location.hash.length&&t.map.setExtent(i.options.initialExtent);for(var e=0;e<t.map.baseLayers.length;e++)t.map.removeLayer(t.map.baseLayers[e]);var a=i.getBaseLayer();t.map.addLayer({id:a.id,title:a.title,type:a.type,url:a.url,encoding:a.encoding,layerNames:a.layerNames,matrixSet:a.matrixSet,format:a.format,minResolution:a.minResolution,maxZoom:a.maxZoom,isBase:!0});for(var s,o=i.workLayers,e=0;e<o.length;e++){s=o[e];s.type===n.Consts.layerType.WMS&&s.options.stateless&&t.map.addLayer({id:s.id,title:s.title,type:s.type,method:s.method,url:s.url,format:s.format,stateless:s.stateless,params:s.params,layerNames:s.layerNames},function(e){e.setVisibility(s.getVisibility());e.setOpacity(s.getOpacity())})}var l=n.printPreview.mapFeatures;l&&t.map.addLayer({id:n.getUID(),type:n.Consts.layerType.VECTOR},function(e){n.loadJS(!n.feature,[n.apiLocation+"TC/Feature",n.apiLocation+"TC/feature/Point",n.apiLocation+"TC/feature/Polyline",n.apiLocation+"TC/feature/Polygon",n.apiLocation+"TC/feature/MultiPolygon",n.apiLocation+"TC/feature/MultiPolyline",n.apiLocation+"TC/feature/Circle",n.apiLocation+"TC/feature/Marker"],function(){for(var t=0;t<l.length;t++){var r=l[t];switch(r.CLASSNAME){case"TC.feature.Point":e.addPoint(r.geometry,r.options);break;case"TC.feature.Polyline":e.addPolyline(r.geometry,r.options);break;case"TC.feature.Polygon":e.addPolygon(r.geometry,r.options);break;case"TC.feature.MultiPolygon":e.addMultiPolygon(r.geometry,r.options);break;case"TC.feature.MultiPolyline":e.addMultiPolyline(r.geometry,r.options);break;case"TC.feature.Circle":e.addCircle(r.geometry,r.options);break;case"TC.feature.Marker":e.addMarker(r.geometry,r.options)}}})})})}}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.Consts.event.RESULTTOOLTIP="resulttooltip.tc";TC.Consts.event.RESULTTOOLTIPEND="resulttooltipend.tc";TC.Consts.event.DRAWCHART="drawchart.tc";TC.Consts.event.DRAWTABLE="drawtable.tc";TC.Consts.event.RESULTSPANELMIN="resultspanelmin.tc";TC.Consts.event.RESULTSPANELMAX="resultspanelmax.tc";TC.Consts.event.RESULTSPANELCLOSE="resultspanelclose.tc";TC.control.ResultsPanel=function(){var e=this;TC.Control.apply(e,arguments);e.data={};e.classes={FA:"fa"};e.contentType={TABLE:{fnOpen:TC.control.ResultsPanel.prototype.openTable,collapsedClass:".fa-list-alt"},CHART:{fnOpen:TC.control.ResultsPanel.prototype.openChart,collapsedClass:".fa-area-chart"}};e.content=e.contentType.TABLE;if(e.options){e.options.content&&(e.content=e.contentType[e.options.content.toUpperCase()]);e.options.chart&&(e.chart=e.options.chart);e.options.table&&(e.table=e.options.table)}};TC.inherit(TC.control.ResultsPanel,TC.Control);TC.control.ResultsPanel.prototype.CLASS="tc-ctl-p-results";TC.control.ResultsPanel.prototype.template={};if(TC.isDebug){TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS]=TC.apiLocation+"TC/templates/ResultsPanel.html";TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS+"-table"]=TC.apiLocation+"TC/templates/ResultsPanelTable.html";TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS+"-chart"]=TC.apiLocation+"TC/templates/ResultsPanelChart.html"}else{TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS]=function(){function e(e,t){return e.w('<div class="prpanel-group prsidebar-body " style="display: none" data-no-cb data-no-3d><div class="prpanel prpanel-default"><div class="prpanel-heading"><h4 class="prpanel-title"><label>').h("i18n",t,{},{$key:"geo.trk.chart.chpe"}).w('</label> <span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-close" title="').h("i18n",t,{},{$key:"close"}).w('"><i class="fa fa-times"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-min" title="').h("i18n",t,{},{$key:"hide"}).w('"><i class="fa fa-chevron-left"></i></span><span class="prcollapsed-pull-right prcollapsed-slide-submenu prcollapsed-slide-submenu-csv" hidden title="Exportar a Excel"><i class="fa fa-file-excel-o"></i></span></h4></div><div id="results" class="prpanel-collapse collapse in"><div class="prpanel-body list-group tc-ctl-p-results-table">').p("tc-ctl-p-results-table",t,t.rebase(t.getPath(!0,[])),{}).w('</div><div class="prpanel-body list-group tc-ctl-p-results-chart"></div></div></div></div><div class="prcollapsed prcollapsed-max prcollapsed-pull-left" style="display: none;" title="').h("i18n",t,{},{$key:"expand"}).w('" data-no-cb data-no-3d><i class="fa-list-alt" hidden></i><i class="fa-area-chart" hidden></i></div>')}dust.register(TC.control.ResultsPanel.prototype.CLASS,e);e.__dustBody=!0;return e};TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS+"-table"]=function(){function e(e,n){return e.w('<table class="table" style="display:none;"><thead>').s(n.get(["columns"],!1),n,{block:t},{}).w("</thead><tbody>").s(n.get(["results"],!1),n,{block:r},{}).w("</tbody></table>")}function t(e,t){return e.w("<th>").f(t.getPath(!0,[]),t,"h").w("</th>")}function r(e,t){return e.w("<tr>").h("iterate",t,{block:n},{on:t.getPath(!0,[])}).w("</tr>")}function n(e,t){return e.w("<td>").f(t.get(["value"],!1),t,"h").w("</td>")}dust.register(TC.control.ResultsPanel.prototype.CLASS+"-table",e);e.__dustBody=!0;t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;return e};TC.control.ResultsPanel.prototype.template[TC.control.ResultsPanel.prototype.CLASS+"-chart"]=function(){function e(e,n){return e.w('<div id="track-chart">').x(n.get(["msg"],!1),n,{"else":t,block:r},{}).w("</div>")}function t(e,t){return e.w('<span id="elevationGain" >').h("i18n",t,{},{$key:"geo.trk.chart.elevationGain"}).w(": +").f(t.get(["upHill"],!1),t,"h").w("m, -").f(t.get(["downHill"],!1),t,"h").w('m</span><div id="chart"></div>')}function r(e,t){return e.f(t.get(["msg"],!1),t,"h")}dust.register(TC.control.ResultsPanel.prototype.CLASS+"-chart",e);e.__dustBody=!0;t.__dustBody=!0;r.__dustBody=!0;return e}}TC.control.ResultsPanel.prototype.render=function(e){var t=this;TC.Control.prototype.render.call(t,function(){t.$mainTitle=t._$div.find("label");t.$minimize=t._$div.find(".prcollapsed-slide-submenu-min");t.$minimize.on("click",function(){t.minimize()});t.$close=t._$div.find(".prcollapsed-slide-submenu-close");t.$close.on("click",function(){t.close()});t.$maximize=t._$div.find(".prcollapsed-max");t.$maximize.on("click",function(){t.maximize()});if(t.content){t.content=t.content;if(t.options.titles){if(t.options.titles.main){t.$mainTitle.attr("title",t.options.titles.main);t.$mainTitle.html(t.options.titles.main)}t.options.titles.max&&t.$maximize.attr("title",t.options.titles.max)}}t._$div.find(t.content.collapsedClass).removeAttr("hidden").addClass(t.classes.FA);t.$divTable=t._$div.find("."+t.CLASS+"-table");t.$divChart=t._$div.find("."+t.CLASS+"-chart");TC.loadJS(Modernizr.touch,TC.apiLocation+"lib/jQuery/jquery.touchSwipe.min.js",function(){if(Modernizr.touch){t._$div.swipe({swipeLeft:function(){t.minimize()}})}});e&&"function"==typeof e&&e.call()})};TC.control.ResultsPanel.prototype.minimize=function(){var e=this;if(0==e._$div.find(e.content.collapsedClass+":visible").length){e._$div.find(e.content.collapsedClass).hasClass(e.classes.FA)||e._$div.find(e.content.collapsedClass).addClass(e.classes.FA);e._$div.find(e.content.collapsedClass).removeAttr("hidden");e._$div.find(".prsidebar-body").toggle("slide",function(){e._$div.find(".prcollapsed-max").fadeIn()});e.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELMIN),{})}};TC.control.ResultsPanel.prototype.maximize=function(){var e=this;if(0==e._$div.find(e.content.collapsedClass+":hidden").length){e._$div.find(e.content.collapsedClass).attr("hidden","hidden");e._$div.find(".prsidebar-body").toggle("slide");e._$div.find(".prcollapsed-max").hide();e.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELMAX),{})}};TC.control.ResultsPanel.prototype.close=function(){var e=this;e._$div.find(".prsidebar-body").fadeOut("slide");e._$div.find(".prcollapsed-max").hide();e._$div.find(e.content.collapsedClass).attr("hidden","hidden").removeClass(e.classes.FA);e.chart&&e.chart.chart&&(e.chart.chart=e.chart.chart.destroy());e.map.$events.trigger($.Event(TC.Consts.event.RESULTSPANELCLOSE,{control:e}))};TC.control.ResultsPanel.prototype.openChart=function(){var self=this,data=arguments.data||arguments[0].data;if(data)if(data.msg)self.map.toast(data.msg);else{var locale=TC.Util.getMapLocale(self.map);self.getRenderedHtml(TC.control.ResultsPanel.prototype.CLASS+"-chart",{upHill:data.upHill.toLocaleString(locale),downHill:data.downHill.toLocaleString(locale)},function(out){console.log(self._$div.find("."+TC.control.ResultsPanel.prototype.CLASS+"-chart").length);self._$div.find("."+TC.control.ResultsPanel.prototype.CLASS+"-chart").html(out);var chartOptions={bindto:"#chart",padding:{top:0,right:15,bottom:0,left:45},legend:{show:!1}};self.chart.tooltip&&(chartOptions.tooltip={contents:function(d){var fn=self.chart.tooltip;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.tooltip));return fn.call(eval(self.chart.ctx),d)}});self.chart&&self.chart.onmouseout&&(chartOptions.onmouseout=function(){var fn=self.chart.onmouseout;"function"!=typeof fn&&(fn=TC.Util.getFNFromString(self.chart.onmouseout));fn.call(eval(self.chart.ctx))});chartOptions=$.extend({},chartOptions,data);chartOptions.onrendered=function(){self.map.$events.trigger($.Event(TC.Consts.event.DRAWCHART),{svg:this.svg[0][0]});self._$div.find(".prsidebar-body").fadeIn("slide");self._$div.find("."+self.CLASS+"-table").hide()};if(window.c3){window.c3.chart.internal.fn.generateDrawLine=function(e,t){var r=this,n=r.config,i=r.d3.svg.line(),a=r.generateGetLinePoints(e,t),s=t?r.getSubYScale:r.getYScale,o=function(e){return(t?r.subxx:r.xx).call(r,e)},l=function(e,t){return n.data_groups.length>0?a(e,t)[0][1]:s.call(r,e.id)(e.value)};i=n.axis_rotated?i.x(l).y(o):i.x(o).y(l);n.line_connectNull||(i=i.defined(function(e){return null!=e.value}));return function(e){var a,o=n.line_connectNull?r.filterRemoveNull(e.values):e.values,l=t?r.x:r.subX,c=s.call(r,e.id),u=0,p=0;if(r.isLineType(e))if(n.data_regions[e.id])a=r.lineWithRegions(o,l,c,n.data_regions[e.id]);else{r.isStepType(e)&&(o=r.convertValuesToStep(o));a=i.interpolate("linear")(o)}else{if(o[0]){u=l(o[0].x);

p=c(o[0].value)}a=n.axis_rotated?"M "+p+" "+u:"M "+u+" "+p}return a?a:"M 0 0"}};window.c3.chart.internal.fn.generateDrawArea=function(e,t){var r=this,n=r.config,i=r.d3.svg.area(),a=r.generateGetAreaPoints(e,t),s=t?r.getSubYScale:r.getYScale,o=function(e){return(t?r.subxx:r.xx).call(r,e)},l=function(e,t){return n.data_groups.length>0?a(e,t)[0][1]:s.call(r,e.id)(0)},c=function(e,t){return n.data_groups.length>0?a(e,t)[1][1]:s.call(r,e.id)(e.value)};i=n.axis_rotated?i.x0(l).x1(c).y(o):i.x(o).y0(l).y1(c);n.line_connectNull||(i=i.defined(function(e){return null!==e.value}));return function(e){var t,a=n.line_connectNull?r.filterRemoveNull(e.values):e.values,s=0,o=0;if(r.isAreaType(e)){r.isStepType(e)&&(a=r.convertValuesToStep(a));t=i.interpolate("linear")(a)}else{if(a[0]){s=r.x(a[0].x);o=r.getYScale(e.id)(a[0].value)}t=n.axis_rotated?"M "+o+" "+s:"M "+s+" "+o}return t?t:"M 0 0"}};self.chart.chart=c3.generate(chartOptions)}})}else self.map.toast(data.msg);self.map.getLoadingIndicator().hide()};TC.control.ResultsPanel.prototype.openTable=function(){var e=this,t=arguments[0];if(t){var r,n=function(){for(var e=0;e<t.length;e++)for(var r in t[e])i.indexOf(r)<0&&delete t[e][r]};t.css&&(r=t.css);var i=t.columns,t=t.data;if(t&&t.length>0){if(!i){i=[];for(var a in t[0])i.push(a)}n();e.tableData={columns:i,results:t,css:r};e.getRenderedHtml(e.CLASS+"-table",e.tableData,function(t){e._$div.find("."+e.CLASS+"-table").html(t)});e._$div.find("."+e.CLASS+"-chart").hide();e._$div.find(".prsidebar-body").fadeIn("slide")}}e.map.getLoadingIndicator().hide()};TC.control.ResultsPanel.prototype.open=function(e){var t=this,r=t._$div.find("."+t.CLASS+"-table"),n=function(){var e=r[0].getBoundingClientRect();if(e&&e.width>100){window.cancelAnimationFrame(this.requestIsRendered);this.map.$events.trigger($.Event(TC.Consts.event.DRAWTABLE),{})}};t.requestIsRendered=window.requestAnimationFrame(n.bind(t));t._$div.find("."+t.CLASS+"-table").html(e);t._$div.find("."+t.CLASS+"-chart").hide();1==t._$div.find(t.content.collapsedClass+":visible").length&&t.maximize();t._$div.find(".prsidebar-body").fadeIn("slide");t.map.getLoadingIndicator().hide()};TC.control.ResultsPanel.prototype.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.openOn&&t.map.$events.one(t.openOn,function(e,r){t.content.fnOpen.call(t,r)});t.closeOn&&t.map.$events.one(t.closeOn,function(e,r){t.close()});t.options.openOn&&t.map.$events.on(t.options.openOn,function(e,r){t.content.fnOpen.call(t,r)});t.options.closeOn&&t.map.$events.on(t.options.closeOn,function(e,r){t.close()})};TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.ScaleBar=function(){TC.Control.apply(this,arguments)};TC.inherit(TC.control.ScaleBar,TC.Control);!function(){var e=TC.control.ScaleBar.prototype;e.CLASS="tc-ctl-sb";e.render=function(){var e=this;e.wrap||(e.wrap=new TC.wrap.control.ScaleBar(e));e.wrap.render()};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);e.wrap.getMap().addControl(t.wrap.ctl)};e.getText=function(){var e=this;return e.wrap.getText()}}();TC.control=TC.control||{};TC.control.Scale||TC.syncLoadJS(TC.apiLocation+"TC/control/Scale");TC.control.ScaleSelector=function(){var e=this;TC.control.Scale.apply(e,arguments);e.scales=null};TC.inherit(TC.control.ScaleSelector,TC.control.Scale);!function(){var e=TC.control.ScaleSelector.prototype;e.CLASS="tc-ctl-ss";e.template=TC.isDebug?TC.apiLocation+"TC/templates/ScaleSelector.html":function(){function t(e,t){return e.w('<div class="ol-scale-line ol-unselectable"><nobr><select>').s(t.get(["scales"],!1),t,{block:r},{}).w('</select> <input type="button" value="').f(t.get(["screenSize"],!1),t,"h").w("''\" title=\"").h("i18n",t,{},{$key:"estimatedMapSize"}).w('" /></nobr></div>')}function r(e,t){return e.w('<option value="').f(t.getPath(!0,[]),t,"h").w('"').h("eq",t,{block:n},{key:i,value:a}).w(">1:").h("math",t,{},{key:s,method:"round"}).w("</option>\n")}function n(e,t){return e.w(' selected="true"')}function i(e,t){return e.f(t.getPath(!0,[]),t,"h")}function a(e,t){return e.f(t.get(["scale"],!1),t,"h")}function s(e,t){return e.f(t.getPath(!0,[]),t,"h")}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;i.__dustBody=!0;a.__dustBody=!0;s.__dustBody=!0;return t};e.render=function(e){var t=this;if(t.map){!t.scales&&t.map.options.resolutions&&(t.scales=t.map.options.resolutions.map(t.getScale,t));var r=function(){t.scales=t.map.wrap.getResolutions().map(t.getScale,t);$("input[type=button]",t._$div).off();$("select",t._$div).off();t.renderData({scale:t.getScale(),screenSize:TC.Cfg.screenSize,scales:t.scales},function(){t._$div.find("option").each(function(e,r){$elm=$(r);$elm.text("1:"+t.format($elm.text().substr(2)))});t._$div.find('input[type="button"]').on(TC.Consts.event.CLICK,function(){t.setScreenSize.call(t)});$("select",t._$div).on("change",function(){t.setScale($(this).val())});$.isFunction(e)&&e()})};t.scales?r():$.when(t.map.wrap.getMap()).then(r)}};e.setScale=function(e){var t=this,r=.0254*e/t.getDpi(TC.Cfg.screenSize);window.devicePixelRatio&&(r/=window.devicePixelRatio);t.metersPerDegree&&(r/=t.metersPerDegree);t.map.wrap.setResolution(r);return r}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Search=function(){var e=this;TC.Control.apply(e,arguments);TC.Consts.event.TOOLSCLOSE=TC.Consts.event.TOOLSCLOSE||"toolsclose.tc";e.url="//idena.navarra.es/ogc/wfs";e.version="1.1.0";e.featurePrefix="IDENA";e._LIKE_PATTERN="*";e.UTMX="X";e.UTMY="Y";e.LON="Lon";e.LAT="Lat";e.UTMX_LABEL="X: ";e.UTMY_LABEL="Y: ";e.LON_LABEL="Lon: ";e.LAT_LABEL="Lat: ";e.MUN="M";e.POL="P";e.PAR="Par";e.MUN_LABEL="Mun: ";e.POL_LABEL="Pol: ";e.PAR_LABEL="Par: ";e.availableSearchTypes={};e.availableSearchTypes[TC.Consts.searchType.CADASTRAL]={suggestionRoot:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["CATAST_Pol_ParcelaRusti","CATAST_Pol_ParcelaUrba","CATAST_Pol_ParcelaMixta"],municipality:{featureType:"CATAST_Pol_Municipio",outputProperties:["CMUNICIPIO","MUNICIPIO"]},queryProperties:{municipality:"CMUNICIPIO",polygon:"POLIGONO",parcel:"PARCELA"},suggestionListHead:function(){return{label:e.getLocaleString("search.list.cadastral"),color:{"#e5475f":e.getLocaleString("search.list.cadastral.mixed"),"#0c8b3d":e.getLocaleString("search.list.cadastral.rustic"),"#136278":e.getLocaleString("search.list.cadastral.urban")}}},styles:{CATAST_Pol_ParcelaUrba:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#136278",strokeWidth:2,strokeOpacity:1}},CATAST_Pol_ParcelaRusti:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#0c8b3d",strokeWidth:2,strokeOpacity:1}},CATAST_Pol_ParcelaMixta:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#e5475f",strokeWidth:2,strokeOpacity:1}}},parser:e.getCadastralRef,goTo:e.goToCadastralRef,goToIdFormat:"M{0}P{1}Par{2}",idPropertiesIdentifier:"#"};e.availableSearchTypes[TC.Consts.searchType.COORDINATES]={parser:e.getCoordinates,goTo:e.goToCoordinates,label:null,suggestionListHead:function(t){return{label:e.availableSearchTypes[TC.Consts.searchType.COORDINATES].label||e.getLocaleString("search.list.coordinates")}}};e.availableSearchTypes[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{tProperty:["MUNINOAC","MUNICIPIO"]},suggestionListHead:function(){return{label:e.getLocaleString("search.list.municipality"),color:{"#fe06a5":e.getLocaleString("search.list.municipality")}}},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",searchWeight:2,styles:{CATAST_Pol_Municipio:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fe06a5",strokeWidth:2,strokeOpacity:1}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["CATAST_Pol_Municipio","ESTADI_Pol_EntidadPob"],renderFeatureType:["CATAST_Pol_Municipio"],dataIdProperty:{CATAST_Pol_Municipio:["CMUNICIPIO"],ESTADI_Pol_EntidadPob:["CMUNICIPIO","CENTIDAD"]},queryProperties:{tProperty:{CATAST_Pol_Municipio:["MUNINOAC","MUNICIPIO"],ESTADI_Pol_EntidadPob:["ENTINOAC","ENTIDAD"]}},suggestionListHead:function(){return{label:e.getLocaleString("search.list.locality"),color:{"#feba1e":e.getLocaleString("search.list.locality")}}},outputProperties:{CATAST_Pol_Municipio:["MUNICIPIO"],ESTADI_Pol_EntidadPob:["MUNICIPIO","ENTIDAD"]},outputFormatLabel:{CATAST_Pol_Municipio:"{0}",ESTADI_Pol_EntidadPob:"{1} ({0})"},searchWeight:2,styles:{CATAST_Pol_Municipio:{polygon:{fillColor:"#000000",fillOpacity:0,strokeColor:"#ffffff",strokeWidth:5,strokeOpacity:1}},ESTADI_Pol_EntidadPob:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.COUNCIL]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Concejo",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CCONCEJO"],queryProperties:{tProperty:["CONCEJO"]},outputProperties:["MUNICIPIO","CONCEJO"],outputFormatLabel:"{1} ({0})",searchWeight:2,parser:e.getAddress,goTo:e.goToAddress,idPropertiesIdentifier:"#",suggestionListHead:function(){return{label:e.getLocaleString("search.list.council"),color:{"#49006a":e.getLocaleString("search.list.council")}}},styles:{CATAST_Pol_Concejo:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#49006a",strokeWidth:2,strokeOpacity:1}}}};e.availableSearchTypes[TC.Consts.searchType.STREET]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Lin_CalleEje",renderFeatureType:"CATAST_Txt_Calle",dataIdProperty:["CVIA"],queryProperties:{tProperty:["ENTINOAC","ENTIDADC"],sProperty:["VIA","VIANOAC"]},suggestionListHead:function(){return{label:e.getLocaleString("search.list.street"),color:{"#CB0000":e.getLocaleString("search.list.street")}}},outputProperties:["ENTIDADC","VIA","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1}, {0}",styles:{CATAST_Lin_CalleEje:{line:{strokeColor:"#CB0000",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid"}},CATAST_Txt_Calle:{point:{label:"VIA",angle:"CADANGLE",fontColor:"#000000",fontSize:7,fontWeight:"bold",labelOutlineColor:"#ffffff",labelOutlineWidth:2}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.NUMBER]={root:null,limit:null,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Txt_Portal",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC","CVIA","PORTAL"],queryProperties:{tProperty:["ENTIDADC","ENTINOAC"],sProperty:["VIA","VIANOAC"],pProperty:["PORTAL"]},suggestionListHead:function(){return{label:e.getLocaleString("search.list.number"),color:{"#CB0000":e.getLocaleString("search.list.number")}}},outputProperties:["ENTIDADC","VIA","PORTAL","CENTIDADC","CMUNICIPIO"],outputFormatLabel:"{1} {2}, {0}",styles:{CATAST_Txt_Portal:{point:{radius:0,label:"PORTAL",angle:"CADANGLE",fontColor:"#CB0000",fontSize:14,fontWeight:"bold",labelOutlineColor:"#FFFFFF",labelOutlineWidth:4}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.URBAN]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"ESTADI_Pol_EntidadPob",renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDAD"],idPropertiesIdentifier:"#",queryProperties:{tProperty:["ENTINOAC","ENTIDAD"]},suggestionListHead:function(){return{label:e.getLocaleString("search.list.urban"),color:{"#feba1e":e.getLocaleString("search.list.urban")}}},outputProperties:["MUNICIPIO","ENTIDAD"],outputFormatLabel:"{1} ({0})",searchWeight:2,styles:{ESTADI_Pol_EntidadPob:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#feba1e",strokeWidth:2,strokeOpacity:1}}},parser:e.getAddress,goTo:e.goToAddress};e.availableSearchTypes[TC.Consts.searchType.COMMONWEALTH]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["POLUCI_Pol_MancoRSUg"],renderFeatureType:"",dataIdProperty:["CMANCOMUNI"],queryProperties:{tProperty:["MANCOMUNID"]},outputProperties:["MANCOMUNID"],outputFormatLabel:"{0}",searchWeight:1,styles:{POLUCI_Pol_MancoRSUg:{polygon:{fillColor:"#000000",fillOpacity:.1,strokeColor:"#fc4e2a",strokeWidth:2,strokeOpacity:1}}}};e.rootCfg={};e.rootCfg[TC.Consts.searchType.MUNICIPALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"CATAST_Pol_Municipio",dataIdProperty:["CMUNICIPIO"],queryProperties:{tProperty:["MUNICIPIO"]},outputProperties:["MUNICIPIO"],outputFormatLabel:"{0}",getRootLabel:function(){var t=new $.Deferred;if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel){var r={};r.SERVICE="WFS";r.VERSION=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].version;r.REQUEST="GetFeature";r.TYPENAME=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.MUNICIPALITY].featureType;r.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputFormat;r.PROPERTYNAME=["CMUNICIPIO"].concat(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties).join(",");r.CQL_FILTER=e.rootCfg[TC.Consts.searchType.MUNICIPALITY].root.map(function(e){return["CMUNICIPIO"].map(function(t,r){return t+"="+e[r]}).join(" AND ")});r.CQL_FILTER=r.CQL_FILTER.join(" OR ");$.ajax({url:e.rootCfg[TC.Consts.searchType.MUNICIPALITY].url+"?"+$.param(r),type:"GET"}).done(function(r){if(r.totalFeatures>0){e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=r.features.map(function(t){return{id:["CMUNICIPIO"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.MUNICIPALITY].outputProperties[0]].toLowerCase()}});t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel=[];t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel)}}).fail(function(){t.resolve([])})}else t.resolve(e.rootCfg[TC.Consts.searchType.MUNICIPALITY].rootLabel);return t}};e.rootCfg[TC.Consts.searchType.LOCALITY]={root:null,limit:!1,url:e.url||"//idena.navarra.es/ogc/wfs",version:e.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:e.featurePrefix||"IDENA",geometryName:"the_geom",featureType:["ESTADI_Pol_EntidadPob"],renderFeatureType:"",dataIdProperty:["CMUNICIPIO","CENTIDADC"],queryProperties:{tProperty:["ENTINOAC"]},outputProperties:["ENTINOAC"],getRootLabel:function(){var t=new $.Deferred;if(e.rootCfg.active&&!e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel){var r={};r.SERVICE="WFS";r.VERSION=e.rootCfg[TC.Consts.searchType.LOCALITY].version;r.REQUEST="GetFeature";r.TYPENAME=e.rootCfg[TC.Consts.searchType.LOCALITY].featurePrefix+":"+e.rootCfg[TC.Consts.searchType.LOCALITY].featureType;r.OUTPUTFORMAT=e.rootCfg[TC.Consts.searchType.LOCALITY].outputFormat;r.PROPERTYNAME=["CMUNICIPIO","CENTIDAD"].concat(e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties).join(",");r.CQL_FILTER=e.rootCfg[TC.Consts.searchType.LOCALITY].root.map(function(e){return["CMUNICIPIO","CENTIDAD"].map(function(t,r){return t+"="+e[r]}).join(" AND ")});r.CQL_FILTER=r.CQL_FILTER.join(" OR ");$.ajax({url:e.rootCfg[TC.Consts.searchType.LOCALITY].url+"?"+$.param(r),type:"GET"}).done(function(r){if(r.totalFeatures>0){e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=r.features.map(function(t){return{id:["CMUNICIPIO","CENTIDAD"].map(function(e){return t.properties[e]}).join("#"),label:t.properties[e.rootCfg[TC.Consts.searchType.LOCALITY].outputProperties[0]].toLowerCase()}});t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}else{e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel=[];t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel)}}).fail(function(){t.resolve([])})}else t.resolve(e.rootCfg[TC.Consts.searchType.LOCALITY].rootLabel);return t}};e.allowedSearchTypes=e.options.allowedSearchTypes||{};if(e.options.allowedSearchTypes)for(var t in e.options.allowedSearchTypes)if(e.availableSearchTypes[t]&&!$.isEmptyObject(e.options.allowedSearchTypes[t])){$.extend(e.availableSearchTypes[t],e.options.allowedSearchTypes[t]);if(e.options.allowedSearchTypes[t].root&&t!=TC.Consts.searchType.MUNICIPALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.MUNICIPALITY||t!=TC.Consts.searchType.LOCALITY&&e.options.allowedSearchTypes[t].rootType==TC.Consts.searchType.LOCALITY){e.rootCfg.active=e.rootCfg[e.options.allowedSearchTypes[t].rootType];e.rootCfg.active.root=e.options.allowedSearchTypes[t].root;e.rootCfg.active.limit=e.options.allowedSearchTypes[t].limit;e.availableSearchTypes[TC.Consts.searchType.STREET].queryProperties.tProperty=e.availableSearchTypes[TC.Consts.searchType.NUMBER].queryProperties.tProperty=e.rootCfg.active.dataIdProperty}}e.rootCfg.active&&e.rootCfg.active.getRootLabel();e.queryableFeatures=e.options.queryableFeatures||!1;e.UTMX_LEN=6;e.UTMY_LEN=7;e.CADASTRAL=TC.Consts.searchType.CADASTRAL;e.COORDINATES=TC.Consts.searchType.COORDINATES;e.MUNICIPALITY=TC.Consts.searchType.MUNICIPALITY;e.LOCALITY=TC.Consts.searchType.LOCALITY;e.COUNCIL=TC.Consts.searchType.COUNCIL;e.STREET=TC.Consts.searchType.STREET;e.NUMBER=TC.Consts.searchType.NUMBER;e.COMMONWEALTH=TC.Consts.searchType.COMMONWEALTH;e.URBAN=TC.Consts.searchType.URBAN;e.ROAD=TC.Consts.searchType.ROAD;e.ROADPK=TC.Consts.searchType.ROADPK;e.wrap=new TC.wrap.control.Search(e);e.interval=500;e.searchTypes={CADASTRAL_SEARCH:{parser:e.getCadastralRef,goTo:e.goToCadastralRef},COORDINATES_SEARCH:{parser:e.getCoordinates,goTo:e.goToCoordinates},ADDRESS_SEARCH:{types:[TC.Consts.searchType.MUNICIPALITY,TC.Consts.searchType.LOCALITY,TC.Consts.searchType.COUNCIL,TC.Consts.searchType.URBAN,TC.Consts.searchType.STREET,TC.Consts.searchType.NUMBER],parser:e.getAddress,goTo:e.goToAddress}};e.NORMAL_PATTERNS={ROMAN_NUMBER:/M{0,4}(CM|CD|D?C{0,3})(XC|XL|L?X{0,3})(IX|IV|V?I{0,3}){1,}?\S?\./i,ABSOLUTE_NOT_DOT:/[`~!@#$%^&*_|+\=?;:'"\{\}\[\]\\]/gi,ABSOLUTE:/[`~!@#$%^&*_|+\=?;:'.\{\}\[\]\\]/gi};e.filter=function(e){var t=function(t,r){for(var n=0;n<e._search.data.length;n++)if(e._search.data[n].id==t&&(!r||r&&e._search.data[n].dataRole===r))return e._search.data[n]},r=function(t){var r=e.availableSearchTypes[t.dataRole],n=t.dataLayer;if(r.renderFeatureType){t.dataLayer instanceof Array||(n=[t.dataLayer]);n=n.concat(r.renderFeatureType instanceof Array?r.renderFeatureType:[r.renderFeatureType])}return n};return{getPropertyName:function(t,r){return e.availableSearchTypes[t].queryProperties[r+"Property"]},getPropertyValue:function(t,r){return e.availableSearchTypes[t][r]},getIsLikeNode:function(t,r){var n=/([\-\"\.\\xba\(\)\/])/g;n.test(r)&&(r=r.replace(n,"\\$1"));return r.toString().indexOf(e._LIKE_PATTERN)>-1?'<Or><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+r.toLowerCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+'</Literal></PropertyIsLike><PropertyIsLike escape="\\" singleChar="_" wildCard="*" matchCase="false"><PropertyName>'+t+"</PropertyName><Literal>"+r.toUpperCase().replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsLike></Or>":"<PropertyIsEqualTo><PropertyName>"+t+"</PropertyName><Literal>"+r.replace(/\</gi,"&lt;").replace(/\>/gi,"&gt;")+"</Literal></PropertyIsEqualTo>"},getFilterNode:function(t,r){var n;if(t instanceof Array||"string"==typeof t){if(t instanceof Array&&t.length>1){n="<ogc:Or>";for(var i=0;i<t.length;i++)n+=e.filter.getIsLikeNode($.trim(t[i]),r);return n+="</ogc:Or>"}return e.filter.getIsLikeNode($.trim(t instanceof Array&&1===t.length?t[0]:t),r)}var a=[];for(var s in t)if(t[s]instanceof Array&&t[s].length>1){n="<Or>";for(var i=0;i<t[s].length;i++)n+=e.filter.getIsLikeNode($.trim(t[s][i]),r);n+="</Or>";a.push('(<Filter xmlns="http://www.opengis.net/ogc">'+n+"</Filter>)")}else{var o=t[s];t[s]instanceof Array&&1==t[s].length&&(o=t[s][0]);a.push('(<Filter xmlns="http://www.opengis.net/ogc"><Or>'+e.filter.getIsLikeNode($.trim(o),r)+"</Or></Filter>)")}return a.join("")},getFilter:function(t,r){var n={};n.multiL=!1;n.f="";var i,a=function(t,r){var n=[];if(r!=e.rootCfg.active.root)for(var i=r.split("#"),a=0;a<e.rootCfg.active.dataIdProperty.length;a++){0==a&&e.rootCfg.active.dataIdProperty.length>1&&n.push("<ogc:And>");n.push(e.filter.getFilterNode(e.rootCfg.active.dataIdProperty[a],i.length>a?i[a]:i[0]));a==e.rootCfg.active.dataIdProperty.length-1&&e.rootCfg.active.dataIdProperty.length>1&&n.push("</ogc:And>")}else{for(var s=0;s<e.rootCfg.active.root.length;s++){var i=e.rootCfg.active.root[s];0==s&&e.rootCfg.active.root.length>1&&n.push("<ogc:Or>");for(var a=0;a<e.rootCfg.active.dataIdProperty.length;a++){0==a&&e.rootCfg.active.dataIdProperty.length>1&&n.push("<ogc:And>");n.push(e.filter.getFilterNode(e.rootCfg.active.dataIdProperty[a],i.length>a?i[a]:i[0]));a==e.rootCfg.active.dataIdProperty.length-1&&e.rootCfg.active.dataIdProperty.length>1&&n.push("</ogc:And>")}}e.rootCfg.active.root.length>1&&n.push("</ogc:Or>")}return t.concat(n)};switch(r){case e.NUMBER:i=[];if(e.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(t.t)&&!/(\<|\>|\<\>)/gi.exec(t.s)){e.rootCfg.active?i=a(i,t.t):i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"s"),e._LIKE_PATTERN+t.s+e._LIKE_PATTERN))}else{var s=/(\<|\>|\<\>)/gi.exec(t.t);s?i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t.substring(0,t.t.indexOf(s[0])).trim()+e._LIKE_PATTERN)):e.rootCfg.active?i=a(i,t.t):i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN));s=/(\<|\>|\<\>)/gi.exec(t.s);i.push(s?e.filter.getFilterNode(e.filter.getPropertyName(r,"s"),e._LIKE_PATTERN+t.s.substring(0,t.s.indexOf(s[0])).trim()+e._LIKE_PATTERN):e.filter.getFilterNode(e.filter.getPropertyName(r,"s"),e._LIKE_PATTERN+t.s+e._LIKE_PATTERN))}i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"p"),t.p+"*"));n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;case e.STREET:i=[];if(e.rootCfg.active||!/(\<|\>|\<\>)/gi.exec(t.t)&&!/(\<|\>|\<\>)/gi.exec(t.s)){e.rootCfg.active?i=a(i,t.t):i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"s"),e._LIKE_PATTERN+t.s+e._LIKE_PATTERN))}else{var s=/(\<|\>|\<\>)/gi.exec(t.t);s?i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t.substring(0,t.t.indexOf(s[0])).trim()+e._LIKE_PATTERN)):e.rootCfg.active?i=a(i,t.t):i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN));s=/(\<|\>|\<\>)/gi.exec(t.s);i.push(s?e.filter.getFilterNode(e.filter.getPropertyName(r,"s"),e._LIKE_PATTERN+t.s.substring(0,t.s.indexOf(s[0])).trim()+e._LIKE_PATTERN):e.filter.getFilterNode(e.filter.getPropertyName(r,"s"),e._LIKE_PATTERN+t.s+e._LIKE_PATTERN))}n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>";break;case e.COUNCIL:n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN)+"</ogc:Filter>";break;case e.URBAN:n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN)+"</ogc:Filter>";break;case e.LOCALITY:n.f=e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN);n.multiL=!0;break;case e.MUNICIPALITY:n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN)+"</ogc:Filter>";break;case e.ROAD:n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc">'+e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN)+"</ogc:Filter>";break;case e.ROADPK:var i=[];i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"t"),e._LIKE_PATTERN+t.t+e._LIKE_PATTERN));i.push(e.filter.getFilterNode(e.filter.getPropertyName(r,"s"),e._LIKE_PATTERN+t.s+e._LIKE_PATTERN));n.f='<ogc:Filter xmlns:ogc="http://www.opengis.net/ogc"><ogc:And>'+i.join("")+"</ogc:And></ogc:Filter>"}return n},getParams:function(t,r,n,i){var a=e.filter.getFilter(t,r),s={REQUEST:"GetFeature",SERVICE:"WFS",MAXFEATURES:500,VERSION:e.availableSearchTypes[r].version,OUTPUTFORMAT:e.availableSearchTypes[r].outputFormat},o=e.filter.getPropertyValue(r,"featureType");if(o instanceof Array){for(var l=[],c=0;c<o.length;c++)l.push(e.availableSearchTypes[r].featurePrefix?e.availableSearchTypes[r].featurePrefix+":"+$.trim(o[c]):$.trim(o[c]));s.TYPENAME=l.join(",")}else s.TYPENAME=e.availableSearchTypes[r].featurePrefix?e.availableSearchTypes[r].featurePrefix+":"+$.trim(o):$.trim(o);var u=function(e){if(""!==(e||"")){if(e instanceof Array)return e.join(",");var t=[];if(e instanceof Object)for(var r in e){var n=e[r][0];e[r].length>1&&(n=e[r].join(","));t.push(n)}return t}},p=u(n),h=u(i);if(p instanceof Array&&h instanceof Array){s.PROPERTYNAME="";for(var c=0;c<p.length;c++)s.PROPERTYNAME+="("+p[c]+","+h[c]+")"}else s.PROPERTYNAME=p+","+h;s.FILTER=a.f;return $.param(s)},getGoToFilterLayer:function(e,n){var i=t(e,n);return r(i)},getGoToFilter:function(n,i){var a=[],s=n.split("#"),o=t(n,i);if(o&&o.dataRole){var l=e.availableSearchTypes[o.dataRole],c=l.dataIdProperty,u=r(o);if(n.indexOf("#")>-1&&u instanceof Array)for(var p=0;p<u.length;p++)for(var h=0;h<c[u[p]].length;h++)a.push({name:c[u[p]][h],value:s[h]});else if(-1==n.indexOf("#")&&u instanceof Array){for(var d=c,p=0;p<u.length;p++)if(!a.hasOwnProperty(u[p])){d instanceof Object&&c.hasOwnProperty(u[p])&&(d=c[u[p]]);for(var h=0;h<d.length;h++)h<s.length&&a.push({name:d[h],value:s[h]})}}else{c instanceof Object&&c.hasOwnProperty(u)&&(c=c[u]);for(var p=0;p<c.length;p++)a.push({name:c[p],value:s[p]})}}return e.transformFilter(a)},getGoToElement:function(e){return t(e)}}}(e)};TC.inherit(TC.control.Search,TC.Control);!function(){var e=TC.control.Search.prototype;e.CLASS="tc-ctl-search";TC.Consts.event.SEARCHQUERYEMPTY=TC.Consts.event.SEARCHQUERYEMPTY||"searchqueryempty.tc";e.template=TC.isDebug?TC.apiLocation+"TC/templates/Search.html":function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"search.1"}).w('</h2><div class="tc-ctl-search-content"><input type="search" class="tc-ctl-search-txt" placeholder="').h("i18n",t,{},{$key:"search.placeholder"}).w('" title="').h("i18n",t,{},{$key:"search.instructions"}).w('" /><a title="').h("i18n",t,{},{$key:"search.instructions"}).w('" class="tc-ctl-btn tc-ctl-search-btn">').h("i18n",t,{},{$key:"search.2"}).w('</a><ul class="tc-ctl-search-list"></ul></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t._search={data:[]};t.layerStyleFN=function(){function e(e){return e.indexOf(".")>-1?e.split(".")[0]:e}function r(e,r,n){for(var i in t.allowedSearchTypes){var a=t.availableSearchTypes[i]||t.allowedSearchTypes[i];if(a&&a.hasOwnProperty("featureType")&&(a.featureType.indexOf(n)>-1||a.renderFeatureType&&a.renderFeatureType.indexOf(n)>-1)&&a.styles[n].hasOwnProperty(r))return a.styles[n][r][e]}return TC.Cfg.styles[r][e]}return function(t,n,i,a){var s=this;a instanceof TC.Feature||s.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:s.layer,geom:a.geom}));var o=r(n,t,e(a.id));if(i){if(o instanceof Array){var l=o.map(function(e){return a.getData().hasOwnProperty(e)?a.getData()[e]:""}),c=this.getSearchTypeByFeature(e(a.id));return c?c.outputFormatLabel.tcFormat(l):l.join(" ")}return a.getData().hasOwnProperty(o)?a.getData()[o]:""}return o}}();e.loaded(function(){var r=t.layerStyleFN;t.layerPromise=e.addLayer({id:TC.getUID(),title:"B\xfasquedas",stealth:!0,type:TC.Consts.layerType.VECTOR,styles:{polygon:{fillColor:r.bind(t,"polygon","fillColor",!1),fillOpacity:r.bind(t,"polygon","fillOpacity",!1),strokeColor:r.bind(t,"polygon","strokeColor",!1),strokeOpacity:r.bind(t,"polygon","strokeOpacity",!1),strokeWidth:r.bind(t,"polygon","strokeWidth",!1)},line:{strokeColor:r.bind(t,"line","strokeColor",!1),strokeOpacity:r.bind(t,"line","strokeOpacity",!1),strokeWidth:r.bind(t,"line","strokeWidth",!1)},marker:{anchor:TC.Defaults.styles.marker.anchor,height:TC.Defaults.styles.marker.height,width:TC.Defaults.styles.marker.width},point:{radius:r.bind(t,"point","radius",!1),height:r.bind(t,"point","height",!1),width:r.bind(t,"point","width",!1),fillColor:r.bind(t,"point","fillColor",!1),fillOpacity:r.bind(t,"point","fillOpacity",!1),strokeColor:r.bind(t,"point","strokeColor",!1),strokeWidth:r.bind(t,"point","strokeWidth",!1),fontSize:r.bind(t,"point","fontSize",!1),fontColor:r.bind(t,"point","fontColor",!1),labelOutlineColor:r.bind(t,"point","labelOutlineColor",!1),labelOutlineWidth:r.bind(t,"point","labelOutlineWidth",!1),label:r.bind(t,"point","label",!0),angle:r.bind(t,"point","angle",!0)}}});$.when(t.layerPromise).then(function(e){t.layer=e})});t.EMPTY_RESULTS_LABEL=t.getLocaleString("noResults");t.EMPTY_RESULTS_TITLE=t.getLocaleString("checkCriterion");t.OUTBBX_LABEL=t.getLocaleString("outsideOfLimits");t.WFS_TYPE_ATTRS=["url","version","geometryName","featurePrefix","featureType","properties","outputFormat"];t.availableSearchTypes[TC.Consts.searchType.ROAD]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Lin_CtraEje",dataIdProperty:["DCARRETERA"],queryProperties:{tProperty:["DCARRETERA"]},suggestionListHead:function(){return{label:t.getLocaleString("search.list.road"),color:{"#00b2fc":t.getLocaleString("search.list.road")}}},outputProperties:["DCARRETERA"],outputFormatLabel:t.getLocaleString("search.list.road.shorter")+": {0}",searchWeight:2,styles:{INFRAE_Lin_CtraEje:{polygon:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5},line:{strokeColor:"#00b2fc",strokeOpacity:1,strokeWidth:5,strokeLinecap:"round",strokeDashstyle:"solid"}}},parser:t.getRoad,goTo:t.goToRoad,pattern:new RegExp("^(?:(?:"+t.getLocaleString("search.list.road")+"|"+t.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|NA?|PA?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))$","i")};t.availableSearchTypes[TC.Consts.searchType.ROADPK]={root:null,limit:!1,url:t.url||"//idena.navarra.es/ogc/wfs",version:t.version||"1.1.0",outputFormat:TC.Consts.format.JSON,featurePrefix:t.featurePrefix||"IDENA",geometryName:"the_geom",featureType:"INFRAE_Sym_CtraPK",dataIdProperty:["DCARRETERA","CPK"],queryProperties:{tProperty:["DCARRETERA"],sProperty:["PK"]},suggestionListHead:function(){return{label:t.getLocaleString("search.list.pk.larger"),color:{"#00b2fc":t.getLocaleString("search.list.road")+" "+t.getLocaleString("search.list.pk")
}}},outputProperties:["DCARRETERA","PK"],outputFormatLabel:t.getLocaleString("search.list.road.shorter")+": {0} "+t.getLocaleString("search.list.pk")+": {1}",searchWeight:2,styles:{INFRAE_Sym_CtraPK:{point:{label:["DCARRETERA","PK"],fontColor:"#00b2fc",fontSize:14,fontWeight:"bold",labelOutlineColor:"#ffffff",labelOutlineWidth:2}}},parser:t.getPK,goTo:t.goToPK,pattern:new RegExp("^(?:(?:"+t.getLocaleString("search.list.road")+"|"+t.getLocaleString("search.list.road.shorter")+")\\:?)?\\s*((A?|AP?|N?|NA?|PA?)\\s*\\-?\\s*(\\d{1,4})\\s*\\-?\\s*(A?|B?|C?|R?))\\s*\\,*\\s*(?:(?:"+t.getLocaleString("search.list.pk")+"\\:?)|(?:P\\:?)|(?:K\\:?)|(?:KM\\:?)|(?:\\s+|\\,+))\\s*(\\d{1,4})$","i")}};e.renderData=function(e,t){var r=this;r._search=r._search||{};var n=function(){r.search(r.$text.val(),function(e){if(1===e.length){r.$text.val(e[0].label);r.goToResult(e[0].id);r.$list.hide("fast")}else 0===e.length&&r.$list.hide("fast")})};TC.Control.prototype.renderData.call(r,e,function(){var e=function(){r.$text.val(r.$list[0].label||r.$list.find("li:not([header]) > a > span").text());r.lastPattern=r.$text.val();r.goToResult(r.$list[0].id||unescape(r.$list.find("li:not([header]) > a").attr("href")).substring(1));r.$list.hide("fast")};r.$text=r._$div.find("input.tc-ctl-search-txt");r.$list=r._$div.find(".tc-ctl-search-list");r.$button=r._$div.find(".tc-ctl-search-btn");r.$button.on(TC.Consts.event.CLICK,function(){r.getLayer().then(function(t){r.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length>1||(t.features.length>0?t.map.zoomToFeatures(t.features):1===r.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length?e():r.$text.trigger("keyup.autocomplete"))})});r.$list.on(TC.Consts.event.CLICK,"a.tc-ctl-search-li-empty",function(){r.$list.hide("fast");r.$text.focus()});try{if(r.$text.has($("::-ms-clear"))){var t;r.$text.on("mouseup",function(e){t=r.$text.val();""!==t&&setTimeout(function(){var e=r.$text.val();if(""===e){r.$list.hide("fast");n()}},1)})}}catch(i){}r.$text.on("keypress",function(t){if(13==t.which){t.preventDefault();t.stopPropagation();r.lastPattern="";1===r.$list.find("li > a:not(.tc-ctl-search-li-loading,.tc-ctl-search-li-empty)").length?e():n();return!1}}).on("search",function(){if(0===r.$text.val().length){r.$list.hide("fast");n()}}).on("input",function(){if(0===r.$text.val().length){r.$list.hide("fast");n()}}).on("targetCleared.autocomplete",function(){r.$list.hide("fast")}).on("targetUpdated.autocomplete",function(){r.$list.find("li").length>0&&r.$list.show("fast")});r.lastPattern="";r.retryTimeout=null;TC.loadJS(!r.$text.autocomplete,[TC.apiLocation+"lib/jQuery/autocomplete.js"],function(){var e;r.$text=r._$div.find("input.tc-ctl-search-txt");r.$text.autocomplete({link:"#",target:r.$list,minLength:2,ctx:r,source:function(t,n){function i(){var t=r.$text.val().trim();if(t.length>0&&(!r.lastPattern||t!=r.lastPattern)&&performance.now()-r.lastpress>r.interval){window.cancelAnimationFrame(e);e=void 0;r.$list.hide("fast");r.lastPattern=t;r.search(t,n)}else e=requestAnimationFrame(i)}r.lastpress=performance.now();e||(e=requestAnimationFrame(i))},callback:function(e){var t=$(e.target);$(e.target).is("a")||(t=$(e.target).closest("a"));r.$text.val($(t).find("span[hidden]").text());r.lastPattern=r.$text.val();r.goToResult(unescape($(t).attr("href")).substring(1),$(t).parent().attr("dataRole"));r.$text.autocomplete("clear")},buildHTML:function(e){function t(e,t){var r=parseInt(e,10),n=parseInt(t,10);if(isNaN(r)&&isNaN(n)){var i=e.replace(a,""),o=t.replace(a,"");if(i===o){var l=parseInt(e.replace(s,""),10),c=parseInt(t.replace(s,""),10);return l===c?0:l>c?1:-1}return i>o?1:-1}return isNaN(r)?1:isNaN(n)?-1:r>n?1:-1}var n=[],i=[],a=/[^a-zA-Z]/g,s=/[^0-9]/g,o=e.results.sort(function(e,r){return e.dataRole>r.dataRole?1:e.dataRole<r.dataRole?-1:t(e.label,r.label)});r.rootCfg.active&&(o=o.sort(function(e,r){var n=this.rootCfg.active.root[0].join("-"),i=this.rootCfg.active.dataIdProperty.map(function(t){return e.properties[t].toString()}).join("-"),a=this.rootCfg.active.dataIdProperty.map(function(e){return r.properties[e].toString()}).join("-");return i!==n&&a===n?1:i===n&&a!==n?-1:t(e.label,r.label)}.bind(r)));for(var l=0;l<o.length;l++){var c=o[l];if(-1==i.indexOf(c.dataRole)){var u=this.ctx.availableSearchTypes[c.dataRole]||this.ctx.allowedSearchTypes[c.dataRole],p=u.suggestionListHead(),h='<li header><span class="header">'+p.label+"</span>";for(var d in p.color)h+='<span class="header-color" title="'+p.color[d]+'" style="color: '+d+';"></span>';n[n.length]=h+"</li>";i.push(c.dataRole)}var f=c.label,m=[],y=this.ctx.lastPattern;y=r.NORMAL_PATTERNS.ROMAN_NUMBER.test(y)?y.replace(r.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):y.replace(r.NORMAL_PATTERNS.ABSOLUTE,"");var g=[],v=",";-1==y.indexOf(v)&&(v=" ");g=y.trim().split(v);if(c.label.indexOf(this.ctx.LAT_LABEL)>-1&&c.label.indexOf(this.ctx.LON_LABEL)>-1||c.label.indexOf(this.ctx.UTMX_LABEL)>-1&&c.label.indexOf(this.ctx.UTMY_LABEL)>-1){g=this.ctx.lastPattern.split(" ");for(var C=0;C<g.length;C++)","==g[C].trim().slice(-1)&&(g[C]=g[C].slice(0,-1))}for(var T=0;T<g.length;T++)if(g[T].trim().length>0){m.push("("+g[T].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")");var L=/((\<)|(\>)|(\<\>))/gi.exec(g[T].trim());if(L)for(var w=g[T].trim().replace(/((\<)|(\>)|(\<\>))/gi,"").split(" "),b=0;b<w.length;b++)w[b].trim().length>0&&m.push("("+w[b].trim().replace(/\(/gi,"\\(").replace(/\)/gi,"\\)")+")")}if(c.dataRole==TC.Consts.searchType.ROAD||c.dataRole==TC.Consts.searchType.ROADPK){var S=r.availableSearchTypes[c.dataRole].pattern,L=S.exec(this.ctx.lastPattern);if(L){m=[];if(L[2]&&L[3]){m.push(L[2]+"-"+L[3]);L[4]&&(m[m.length-1]=m[m.length-1]+"-"+L[4]);m[m.length-1]="("+m[m.length-1]+")"}L[5]&&m.push("(?:"+r.getLocaleString("search.list.pk")+"\\:\\s\\d*)("+L[5]+")\\d*")}}var E="("+m.join("|")+")";E=E.replace(/a/gi,"[a|\xe1]");E=E.replace(/e/gi,"[e|\xe9]");E=E.replace(/i/gi,"[i|\xed]");E=E.replace(/o/gi,"[o|\xf3]");E=E.replace(/u/gi,"[u|\xfa|\xfc]");var O=new RegExp(E,"gi"),A=c.label;f=c.dataRole==TC.Consts.searchType.ROAD||c.dataRole==TC.Consts.searchType.ROADPK?A.replace(O,function(){var e=Array.prototype.slice.call(arguments,0);return e[e.length-3]?e[0].replace(e[e.length-3],"<b>"+e[e.length-3]+"</b>"):"<b>"+e[0]+"</b>"}):A.replace(O,"<b>$1</b>");n[n.length]='<li dataRole="'+c.dataRole+'"><a href="#'+encodeURIComponent(c.id)+'"><span hidden>'+c.label+"</span>"+f+"</a></li>"}return n.join("")}});r.$text.add(r.$list).keydown(function(e){if(!e.ctrlKey&&!e.altKey&&!e.shiftKey)if(40===e.keyCode){r.$text[0]==document.activeElement?r.$list.find("li:not([header]):first a").focus():r.$list.find("li:not([header]):last a").is(":focus")?r.$text.focus():r.$list.find("li:not([header])").find("a:focus").parent("li:not([header])").nextAll("li:not([header]):first").find("a").focus();e.preventDefault();e.stopPropagation()}else if(38===e.keyCode){r.$text[0]==document.activeElement?r.$list.find("li:not([header]):last a").focus():document.activeElement==r.$list.find("li:not([header]):first a").get(0)?r.$list.find("li:not([header]):last a").focus():r.$list.find("li:not([header])").find("a:focus").parent("li:not([header])").prevAll("li:not([header]):first").find("a").focus();e.preventDefault();e.stopPropagation()}e.stopPropagation()})})});$.isFunction(t)&&t()};e.getLayer=function(){var e=this;e.layerPromise=e.layerPromise||new $.Deferred;if(e.layer){var t=new $.Deferred;t.resolve(e.layer);return t}return e.layerPromise};e.getFeatures=function(){var e=this;return e.layer.features};e.getSearchTypeByFeature=function(e){var t=this;for(var r in t.allowedSearchTypes){var n=t.availableSearchTypes[r]||t.allowedSearchTypes[r];if(n&&n.hasOwnProperty("featureType")&&(n.featureType.indexOf(e)>-1||n.renderFeatureType&&n.renderFeatureType.indexOf(e)>-1))return n}return null};e.cleanMap=function(){var e=this;e.getLayer().then(function(t){var r=t.features;t.clearFeatures();e.map.$events.trigger($.Event(TC.Consts.event.FEATUREREMOVE,{layer:t,feature:r}));for(var n=0;n<e.WFS_TYPE_ATTRS.length;n++)t.hasOwnProperty(e.WFS_TYPE_ATTRS[n])&&delete t[e.WFS_TYPE_ATTRS[n]]})};e.getMunicipalities=function(){var e=this;TC.cache.search=TC.cache.search||{};if(!TC.cache.search.municipalities){e._municipalitiesDeferred=new $.Deferred;var t={REQUEST:"GetFeature",SERVICE:"WFS",TYPENAME:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.featureType,VERSION:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].version,PROPERTYNAME:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.outputProperties.join(","),OUTPUTFORMAT:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].outputFormat};e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].featurePrefix&&(t.TYPENAME=e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].featurePrefix+":"+t.TYPENAME);var r=e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].url+"?"+$.param(t);$.ajax({url:r,type:"GET",dataType:"text"}).done(function(t){var r;r=e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.featurePrefix,featureType:e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.featureType});var n=r.read(t);TC.cache.search.municipalities=[];for(var i=0;i<n.length;i++){var a=n[i];TC.cache.search.municipalities.push({label:a.data[e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.outputProperties[1]],id:a.data[e.availableSearchTypes[TC.Consts.searchType.CADASTRAL].municipality.outputProperties[0]]})}TC.cache.search.municipalities.sort(function(e,t){var r;r=e.label<t.label?-1:e.label>t.label?1:0;return r});e._municipalitiesDeferred.resolve(TC.cache.search.municipalities)}).fail(function(){e._municipalitiesDeferred.resolve()})}return TC.cache.search.municipalities||e._municipalitiesDeferred.promise()};e.getCoordinates=function(e){var t=this,r=new $.Deferred,n=e.match(new RegExp("^"+$.trim(t.UTMX_LABEL.toLowerCase())+"*\\s*([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(t.UTMY_LABEL.toLowerCase())+"*\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"));n&&(e=n[1]+" "+n[2]);n=e.match(new RegExp("^"+$.trim(t.LAT_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(t.LON_LABEL.toLowerCase())+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));n&&(e=n[1]+" "+n[3]);if(/\d/.test(e)&&(new RegExp("^([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").test(e)||/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.test(e))){n=/^([-+]?\d{1,3}([.,]\d+)?)\,?\s*([-+]?\d{1,2}([.,]\d+)?)$/.exec(e);if(n&&(n[1].indexOf(",")>-1||n[3].indexOf(",")>-1)){n[1]=n[1].replace(",",".");n[3]=n[3].replace(",",".");e=n[1]+" "+n[3]}if(!n||n&&(n[1].indexOf(",")>-1?n[1].replace(",","."):n[1])<=180&&(n[3].indexOf(",")>-1?n[3].replace(",","."):n[3])<=90){n=new RegExp("^([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$").exec(e);if(n&&(n[1].indexOf(",")>-1||n[2].indexOf(",")>-1)){n[1]=n[1].replace(",",".");n[2]=n[2].replace(",",".");e=n[1]+" "+n[2]}e=e.replace(t.UTMX_LABEL,"").replace(t.UTMY_LABEL,"").replace(t.LON_LABEL,"").replace(t.LAT_LABEL,"");var i=TC.Util.parseCoords(e);if(i){var a=i[0].value,s=i[1].value,o=i[0].type===TC.Consts.UTM?t.UTMX:t.LAT,l=i[1].type===TC.Consts.UTM?t.UTMY:t.LON,c=o+a+l+s,u=t.getPoint(c);if(u&&!t.insideLimit(u)){a=i[1].value;s=i[0].value;o=i[1].type===TC.Consts.UTM?t.UTMX:t.LAT;l=i[0].type===TC.Consts.UTM?t.UTMY:t.LON;c=o+a+l+s;u=t.getPoint(c)}if(u){t.availableSearchTypes[TC.Consts.searchType.COORDINATES].label=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.test(c)?t.getLocaleString("search.list.coordinates.utm")+t.map.crs:t.getLocaleString("search.list.coordinates.geo");r.resolve([{id:c,label:t.getLabel(c),dataRole:TC.Consts.searchType.COORDINATES}])}else r.resolve([])}else r.resolve([])}else r.resolve([])}else r.resolve([]);return r.promise()};e.getCadastralRef=function(e){var t=this,r=new $.Deferred,n=e.match(new RegExp($.trim(t.MUN_LABEL.toLowerCase())+"?\\s(.*)\\,\\s?"+$.trim(t.POL_LABEL.toLowerCase())+"?\\s(\\d{1,2})\\,\\s?"+$.trim(t.PAR_LABEL.toLowerCase())+"?\\s(\\d{1,4})"));n&&(e=n[1]+", "+n[2]+", "+n[3]);var i=e;!/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(e)&&t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].suggestionRoot&&(i=t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].suggestionRoot+", "+e);/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.test(i)&&!new RegExp("^([0-9]{"+t.UTMX_LEN+"})\\s*\\,\\s*([0-9]{"+t.UTMY_LEN+"})$").test(e)?$.when(t.getMunicipalities()).then(function(e){var n=/^(.*)\,(\s*\d{1,2}\s*)\,(\s*\d{1,4}\s*)$/.exec(i);if(n){var a=new RegExp($.trim(n[1]).replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),"i"),s=$.grep(e,function(e){e=e.label||e.id||e;return a.test(e)||a.test(t.removePunctuation(e))}),o=function(e,r,n,i){var a=[];a.push[t.MUN]=e;a.push[t.POL]=n;a.push[t.PAR]=i;return{id:t.MUN+e+t.POL+n+t.PAR+i,label:t.getLabel(t.MUN+r+t.POL+n+t.PAR+i),dataRole:TC.Consts.searchType.CADASTRAL,properties:a}};if(s.length>0)for(var l=0;l<s.length;l++)s[l]=o(s[l].id,s[l].label,$.trim(n[2]),$.trim(n[3]));/^[0-9]*$/g.test(n[1])&&s.push(o($.trim(n[1]),$.trim(n[1]),$.trim(n[2]),$.trim(n[3])));r.resolve(s)}}):r.resolve([]);return r.promise()};e.getAddress=function(e){var t=this,r=new $.Deferred,n=[],i=function(e){var r=[];for(var n in t.allowedSearchTypes)switch(!0){case n==TC.Consts.searchType.MUNICIPALITY:case n==TC.Consts.searchType.LOCALITY:case n==TC.Consts.searchType.COUNCIL:case n==TC.Consts.searchType.URBAN:case n==TC.Consts.searchType.STREET:case n==TC.Consts.searchType.NUMBER:t.availableSearchTypes[n]&&t.availableSearchTypes[n].hasOwnProperty("queryProperties")&&Object.keys(t.availableSearchTypes[n].queryProperties).length===Object.keys(e).length&&r.push(n)}r=r.sort(function(e,r){return(t.availableSearchTypes[e].searchWeight||0)>=(t.availableSearchTypes[r].searchWeight||0)?1:0}).filter(function(e){for(var n=0;n<r.length;n++)if((t.availableSearchTypes[r[n]].searchWeight||0)>(t.availableSearchTypes[e].searchWeight||0))return!1;return!0});return r},a=function(e,r){var n;n=t.availableSearchTypes[r].outputFormat===TC.Consts.format.JSON?new TC.wrap.parser.JSON:new TC.wrap.parser.WFS({featureNS:t.availableSearchTypes[r].featurePrefix,featureType:t.availableSearchTypes[r].featureType});return n.read(e)},s=function(e){var r="";e=t.removePunctuation(e);var n,i=/(.*)\s<>\s.*/;if(e.indexOf("(")>-1||e.indexOf(")")>-1){i=/(.*)(\s<>\s.*\(.*\))/;if(e.indexOf("<>")>-1&&i.test(e)){n=e.match(i);if(null!==n){r=e.replace(n[2],"");r=r.splitRemoveWhiteSpaces(",").join(",")}}else{i=/\(.*\)/;if(!i.test(e)){i=/\(.*/;if(!i.test(e)){i=/.*\)/;i.test(e)||(i=/\(.*\)/)}}r=e.replace(i,"");r=r.splitRemoveWhiteSpaces(",").join(",")}e=r}e=t.NORMAL_PATTERNS.ROMAN_NUMBER.test(e)?e.replace(t.NORMAL_PATTERNS.ABSOLUTE_NOT_DOT,""):e.replace(t.NORMAL_PATTERNS.ABSOLUTE,"");return e.toLowerCase()},o=function(e){for(var r=function(e){return/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.test(e)},n=function(e){var r=[],n=/^(\d{1,3})\s?\-?\s?([a-z]{0,4})\s?\-?\s?([a-z]{0,4})$/i.exec(e);if(n){for(var i=1;i<n.length;i++)n[i].trim().length>0&&r.push(n[i].trim());return r.join(t._LIKE_PATTERN)}return e},i=function(e){return/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.test(e)},a=function(e){var r=[],n=/^([a-z]{1,4})\s?\-?\s?(\d{1,3})$/i.exec(e);if(n){for(var i=1;i<n.length;i++)n[i].trim().length>0&&r.push(n[i].trim());return r.join(t._LIKE_PATTERN)}return e},s=function(e){return/^(sn|S\/N|s\/n|s\-n)$/i.test(e)},o=function(e){var t=/^(sn|S\/N|s\/n|s\-n)$/i.exec(e);return t?"s*n":e},l=function(e){return/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.test(e)},c=function(e){var t=/^([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);return t?e:e},u=[r,i,s,l],p=[n,a,o,c],h=0;h<p.length&&!u[h].call(t,e);)h++;return h<p.length?p[h].call(t,e):e},l=function(e,r,n){var i=new $.Deferred;e=e.trim();","==e.charAt(e.length-1)&&(e=e.substring(0,e.length-1));var a=[],s=function(e){if(r)for(var t=e.length;t--;)if(n){if(e[t].t){var i=this.rootCfg.active.rootLabel.filter(function(r){return r.label.indexOf(this.removePunctuation(e[t].t).toLowerCase())>-1}.bind(this));1==i.length?e[t].t=i[0].id:i.length>1?i.map(function(r){var n=$.extend({},e[t]);n.t=r.id;e.push(n)}):0==i.length&&e.splice(t,1)}}else e.push($.extend({},e[t],{t:r}))}.bind(t),l=function(e,t){var r=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(r&&r[1]&&r[2]){var n=function(){return o((r[3]||r[4]||r[5]||r[6]).trim())};if(/^([^0-9]+)$/i.test(r[1].trim())&&/^([^0-9]+)$/i.test(r[2].trim())){t.push({t:r[1].trim(),s:r[2].trim(),p:n()});t.push({t:r[2].trim(),s:r[1].trim(),p:n()})}else t.push(/^([^0-9]+)$/i.test(r[1].trim())?{t:r[1].trim(),s:r[2].trim(),p:n()}:{s:r[1].trim(),t:r[2].trim(),p:n()});s(t);return!0}return!1},c=function(e,t){var r=/^(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(r&&r[6]&&r[1]){var n=function(){return o((r[2]||r[3]||r[4]||r[5]).trim())};if(/^([^0-9]+)$/i.test(r[6].trim())&&/^([^0-9]+)$/i.test(r[1].trim())){t.push({t:r[6].trim(),s:r[1].trim(),p:n()});t.push({t:r[1].trim(),s:r[6].trim(),p:n()})}else t.push(/^([^0-9]+)$/i.test(r[6].trim())?{t:r[6].trim(),s:r[1].trim(),p:n()}:{s:r[6].trim(),t:r[1].trim(),p:n()});s(t);return!0}return!1},u=function(e,t){var r=/^(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)(?:\s*\,\s*)(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(r&&r[1]&&r[2]){t.push({t:r[2].trim(),s:r[1].trim(),p:o((r[3]||r[4]||r[5]||r[6]).trim())});s(t);return!0}return!1},p=function(e,r){var n=/^([^0-9\,]+)(?:\s*\,\s*)(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))$/i.exec(e);if(n&&n[1]&&n[2]){if(/^([^0-9]+)$/i.test(n[1].trim())&&/^([^0-9]+)$/i.test(n[2].trim())){r.push({t:n[1].trim(),s:n[2].trim()});r.push({s:n[1].trim(),t:n[2].trim()})}else{var i=function(e){for(var r=e.split(" ").reverse(),n=[],i=0;i<r.length;i++)if(1==r[i].length){n.push(r[i]);r[i]=""}return n.length>0?r.reverse().join(" ").trim()+t._LIKE_PATTERN+n.reverse().join(t._LIKE_PATTERN):r.reverse().join(" ").trim()};r.push(/^([^0-9]+)$/i.test(n[1].trim())?{t:n[1].trim(),s:i(n[2].trim())}:{s:i(n[1].trim()),t:n[2].trim()})}s(r);return!0}return!1},h=function(e,r){var n=/^(?:([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+))(?:\s*\,\s*)([^0-9\,]+)$/i.exec(e);if(n){for(var i={},a=e.split(",").reverse(),l=0;l<a.length;l++)if(/^([^0-9\,]+)$/i.test(a[l].trim()))i.t=a[l].trim();else if(/(\s*\d+)/i.test(a[l].trim()))if(-1==a[l].trim().indexOf(" "))i.s=a[l].trim();else{for(var c=a[l].trim().split(" ").reverse(),u=function(e){var t=/^(?:(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e.trim());if(t){i.p=o(e.trim());return!0}return!1},p=0,h=c[p].trim();p<c.length&&!u(h);){p++;p<c.length&&(h+=c[p])}if(i.p){for(var d=c,f=0;f<d.length;f++){for(var m=!1,y=0;y<d[f].split("").length;y++)i.p.indexOf(d[f][y])>-1&&(m=!0);if(m){{d[f]}d[f]="";if(i.p==o(h))break}}if(/^([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9]+)$/i.test(c.reverse().join(" ").trim())){for(var g=[],v=c.reverse(),C=0;C<v.length;C++)if(1==v[C].trim().length){g.push(v[C].trim());v[C]=""}i.s=g.length>0?v.reverse().join(" ").trim()+t._LIKE_PATTERN+g.reverse().join(t._LIKE_PATTERN):v.reverse().join(" ").trim()}r.push({t:i.t,s:i.s+" "+i.p})}else i.s=a[l].trim()}r.push(i);s(r);return!0}return!1},d=function(e,t){var n=/^([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/0-9\<\>]+)$/i.exec(e);if(n&&n[1]){t.push(r?{t:r,s:n[1].trim()}:{t:n[1].trim()});return!0}return!1},f=function(e,t){var n=/^([^\,][a-z\u00f1\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\s*\-\.\(\)\/]+)\s*\,?\s*((\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4}))$/i.exec(e);if(n&&n[1]&&n[2]){t.push(r?{t:r,s:n[1].trim(),p:o(n[2].trim())}:{t:n[1].trim(),s:n[2].trim()});return!0}return!1},m=function(e,t){var n=/^([^\,][0-9\s*\-\.\(\)\/]+)\s*\,?\s*(\d{1,3}\s?\-?\s?[a-z]{0,4}\s?\-?\s?[a-z]{0,4})|([a-z]{1,4}\s?\-?\s?\d{1,3})|(sn|S\/N|s\/n|s\-n)|([a-z]{1,4}\s?\+\s?[a-z]{1,4})$/i.exec(e);if(n&&n[1]&&n[2]&&r){t.push({t:r,s:n[1].trim(),p:o(n[2].trim())});return!0}return!1},y=function(){for(var r=[function(e){return e.length>=3},function(e){return/^\d+$/.test(e)?!1:/^\d+\,\s*\d+$/.test(e)?!1:!0}],n=0;n<r.length;n++)if(!r[n].call(t,e))return!1;return!0};if(y(e)){var g=[l,c,u,p,h];g=r&&e.split(",").length<3?[f,m,d].concat(g):g.concat([f,m,d]);var v=0;try{for(;v<g.length&&!g[v].call(t,e,a);)v++}catch(C){TC.error("Error seg\xfan el patr\xf3n: "+e,TC.Consts.msgErrorMode.EMAIL,"Error en la b\xfasqueda del callejero")}}a.length>0&&r?$.when(t.rootCfg.active.getRootLabel()).then(function(e){if(e)for(var n=a.length;n--;){var s=a[n];if(a.length>1&&s.t==r&&e.filter(function(e){return e.indexOf(t.removePunctuation(s.s).toLowerCase())>-1}).length>0){a.splice(n,1);break}}i.resolve(a)}):i.resolve(a);return i.promise()},c=function(e,r,i,a){for(var s=0;s<e.length;s++){var o=[],l=[],c="",u=i,p=a,h=t.filter.getPropertyValue(r,"outputFormatLabel"),d=e[s].id.split(".").slice(0,1).shift();if(!(i instanceof Array)){u=i[d];p=a[d];h=h[d]}for(var f=0;f<u.length;f++)o.push(e[s].data[u[f]]);for(var f=0;f<p.length;f++)l.push(e[s].data[p[f]]);var m=function(e){for(var t=[],r=0;r<e.length;r++)-1==jQuery.inArray(e[r],t)&&t.push(e[r]);return t};o instanceof Array&&h&&m(o).length>1?c=h.tcFormat(o):o instanceof Array&&1==m(o).length&&(c=o[0]);var y=c.toCamelCase(),g=function(e,t){for(var r=0;r<n.length;r++)if(n[r].dataRole==e&&n[r].text.toLowerCase().trim()==t.toLowerCase().trim())return!0;return!1};if(!g(r,y)){for(var v=[],C=0;C<i.length;C++)v[i[C]]=o[C];n.push({text:y,label:y,id:l.join("#"),dataRole:r,dataLayer:d,properties:v})}}}.bind(t);e=s(e);$.when(l(e,t.rootCfg.active&&t.rootCfg.active.root||"",t.rootCfg.active&&t.rootCfg.active.limit||!1)).then(function(e){function s(e,i){var s=t.filter.getPropertyValue(i,"outputProperties"),o=t.filter.getPropertyValue(i,"dataIdProperty");return $.ajax({url:t.availableSearchTypes[i].url,type:"POST",contentType:"application/x-www-form-urlencoded;charset=UTF-8",dataType:"text",data:t.filter.getParams(e,i,s,o),beforeSend:function(){t.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');t.$text.trigger("targetUpdated.autocomplete")}}).done(function(e){var t=a(e,i);c(t,i,s,o)}).fail(function(e){"abort"!==e.statusText&&alert("error");r.resolve(n)})}if(e){t._search.data=n;if(t.request){for(var o=0;o<t.request.length;o++)t.request[o].abort();t.request=[]}else t.request=[];$.map(e,function(e,r){for(var n=i(e),r=0;r<n.length;r++){var a=n[r];a&&t.allowedSearchTypes[a]&&t.request.push(s(e,a))}});$.when.apply($,t.request).then(function(){t.request=null;r.resolve(n)})}else r.resolve(n)});return r.promise()};e.getRoad=function(e){var t=this,r=new $.Deferred;e=e.trim();if(e.length<2)r.resolve([]);else{var n=TC.Consts.searchType.ROAD,i=t.availableSearchTypes[n].pattern,a=i.exec(e);if(a&&a[3]){var s=t.filter.getPropertyValue(n,"outputProperties"),o=t.filter.getPropertyValue(n,"dataIdProperty"),l=t.filter.getPropertyValue(n,"outputFormatLabel"),c=a[2]?a[2].trim()+"-"+a[3].trim():a[3].trim();a[4]&&a[4].length>0&&(c=c+"-"+a[4].trim());$.ajax({url:t.availableSearchTypes[n].url+"?"+t.filter.getParams({t:c},n,s,o),type:"GET",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){if(t.request){for(var e=0;e<t.request.length;e++)t.request[e].abort();t.request=[]}else t.request=[];t.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');t.$text.trigger("targetUpdated.autocomplete")}}).done(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){if(!t.some(function(t){return t.text==e.properties[s[0]]})){var r=l.tcFormat(s.map(function(t){return e.properties[t]})),i=s.map(function(t){return e.properties[t]}).join("-");t.push({id:o.map(function(t){return e.properties[t]}).join("#"),label:r,text:i,dataLayer:e.id.split(".")[0],dataRole:n})}});r.resolve(t)}else r.resolve([])}).fail(function(e){r.resolve([])})}else r.resolve([])}return r.promise()};e.getPK=function(e){var t=this,r=new $.Deferred;e=e.trim();if(e.length<3)r.resolve([]);else{var n=TC.Consts.searchType.ROADPK,i=t.availableSearchTypes[n].pattern,a=i.exec(e);if(a&&a[3]&&a[5]){var s=t.filter.getPropertyValue(n,"outputProperties"),o=t.filter.getPropertyValue(n,"dataIdProperty"),l=t.filter.getPropertyValue(n,"outputFormatLabel"),c=a[2]?a[2].trim()+"-"+a[3].trim():a[3].trim();a[4]&&a[4].length>0&&(c=c+"-"+a[4].trim());$.ajax({url:t.availableSearchTypes[n].url+"?"+t.filter.getParams({t:c,s:a[5].trim()},n,s,o),type:"GET",contentType:"application/x-www-form-urlencoded;charset=UTF-8",beforeSend:function(){if(t.request){for(var e=0;e<t.request.length;e++)t.request[e].abort();t.request=[]}else t.request=[];t.$list.html('<li><a class="tc-ctl-search-li-loading" href="#">'+t.getLocaleString("searching")+'<span class="tc-ctl-search-loading-spinner tc-ctl-search-loading"></span></a></li>');t.$text.trigger("targetUpdated.autocomplete")}}).done(function(e){var t=[];if(e.totalFeatures>0){e.features.map(function(e){if(!t.some(function(t){return t.label==e.properties[s[0]]})){var r=l.tcFormat(s.map(function(t){return e.properties[t]}));t.push({id:o.map(function(t){return e.properties[t]}).join("#"),label:r,text:r,dataLayer:e.id.split(".")[0],dataRole:n})}});r.resolve(t)}else r.resolve([])}).fail(function(e){r.resolve([])})}else r.resolve([])}return r.promise()};e.search=function(e,t){var r=this,n=[];e=$.trim(e);if(e.length>0){e=e.toLowerCase();var i=[],a=function(t){var a=new $.Deferred;i.push(a);$.when(t.call(r,e)).then(function(e){n=n.concat(e);a.resolve(n)})},s=!1;for(var o in r.allowedSearchTypes)switch(o){case TC.Consts.searchType.CADASTRAL:a(r.availableSearchTypes[TC.Consts.searchType.CADASTRAL].parser);break;case TC.Consts.searchType.COORDINATES:a(r.availableSearchTypes[TC.Consts.searchType.COORDINATES].parser);break;case TC.Consts.searchType.ROAD:a(r.availableSearchTypes[TC.Consts.searchType.ROAD].parser);break;case TC.Consts.searchType.ROADPK:a(r.availableSearchTypes[TC.Consts.searchType.ROADPK].parser);break;case TC.Consts.searchType.MUNICIPALITY:case TC.Consts.searchType.LOCALITY:case TC.Consts.searchType.COUNCIL:case TC.Consts.searchType.URBAN:case TC.Consts.searchType.STREET:case TC.Consts.searchType.NUMBER:if(!s){a(r.availableSearchTypes[o].parser);s=!0}break;default:r.allowedSearchTypes[o].parser?a(r.allowedSearchTypes[o].parser):console.log("Falta implementaci\xf3n del m\xe9todo parser")}$.when.apply(r,i).then(function(){n&&(r._search.data=n=n.sort(function(e,t){var r,n=/(\d+)/,i="";if(n.test(e.label)&&n.test(t.label)){r=e.label.match(n)[1];i=t.label.match(n)[1]}else{r=e.label;i=t.label}return r>i?1:i>r?-1:0}.bind(r)));t&&t(n);if(0===n.length){r.cleanMap();if(!r.layer||r.layer&&0===r.layer.features.length){r.$list.html('<li><a title="'+r.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+r.EMPTY_RESULTS_LABEL+"</a></li>");r.$text.trigger("targetUpdated.autocomplete")}}})}else r.cleanMap()};var t=function(e){var t=this;if(e&&e.length>0)for(var r=0;r<e.length;r++)e[r].showsPopup!=t.queryableFeatures&&(e[r].showsPopup=t.queryableFeatures)};e.goToResult=function(e,r){var n=this,i=null;n.loading||(n.loading=n.map.getControlsByClass("TC.control.LoadingIndicator")[0]);var a;a=n.loading.addWait();if(Modernizr.mq("(max-width: 30em)")){n.$text.blur();n.map.$events.trigger($.Event(TC.Consts.event.TOOLSCLOSE),{})}n.cleanMap();var s=!1,o=!0;for(var l in n.allowedSearchTypes)if(o)switch(l){case TC.Consts.searchType.CADASTRAL:i=n.availableSearchTypes[TC.Consts.searchType.CADASTRAL].goTo.call(n,e);null!==i&&(o=!1);break;case TC.Consts.searchType.COORDINATES:i=n.availableSearchTypes[TC.Consts.searchType.COORDINATES].goTo.call(n,e);null!==i&&(o=!1);break;case TC.Consts.searchType.ROAD:r===TC.Consts.searchType.ROAD&&(i=n.availableSearchTypes[TC.Consts.searchType.ROAD].goTo.call(n,e));null!==i&&(o=!1);break;case TC.Consts.searchType.ROADPK:i=n.availableSearchTypes[TC.Consts.searchType.ROADPK].goTo.call(n,e);null!==i&&(o=!1);break;case TC.Consts.searchType.MUNICIPALITY:case TC.Consts.searchType.LOCALITY:case TC.Consts.searchType.COUNCIL:case TC.Consts.searchType.URBAN:case TC.Consts.searchType.STREET:case TC.Consts.searchType.NUMBER:var c=r||n.filter.getGoToElement(e).dataRole;if(c&&c===l){i=n.availableSearchTypes[c].goTo.call(n,e,c);null!==i&&(o=!1)}break;default:if(n.allowedSearchTypes[l].goTo){s=!0;i=n.allowedSearchTypes[l].goTo.call(n,e);null!==i&&(o=!1)}else console.log("Falta implementaci\xf3n del m\xe9todo goTo")}n.loading.removeWait(a);if(i){a=n.loading.addWait();n.getLayer().then(function(r){switch(!0){case i.params.type==TC.Consts.layerType.VECTOR:for(var s=0;s<n.WFS_TYPE_ATTRS.length;s++)r.hasOwnProperty(n.WFS_TYPE_ATTRS[s])&&delete r[n.WFS_TYPE_ATTRS[s]];break;case i.params.type==TC.Consts.layerType.WFS:for(var s=0;s<n.WFS_TYPE_ATTRS.length;s++)r[n.WFS_TYPE_ATTRS[s]]=i.params[n.WFS_TYPE_ATTRS[s]]}r.type=i.params.type;r.refresh().then(function(){n.map.one(TC.Consts.event.LAYERUPDATE,function(e){if(e.layer==r){n.map.one(TC.Consts.event.FEATURESADD,function(e){if(e.layer==r){if(!e.layer.features||0==e.layer.features.length&&e.layer.wrap.layer.getSource().getFeatures()){n.$list.hide("fast");e.layer.map.setExtent(e.layer.wrap.layer.getSource().getExtent())}else if(e.layer.features&&e.layer.features.length>0){n.$list.hide("fast");t.call(n,e.layer.features);n.layer.map.zoomToFeatures(e.layer.features);n.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:n.layer,features:n.layer.features}))}else if(e.layer.features&&0==e.layer.features.length&&i.params.type==TC.Consts.layerType.WFS){n.$list.html(i.emptyResultHTML);n.$text.trigger("targetUpdated.autocomplete");n.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))}n.loading.removeWait(a)}});i.params.type!=TC.Consts.layerType.WFS&&n.map.one(TC.Consts.event.FEATURESADD,function(e){if(e.layer.features&&0==e.layer.features.length){n.$list.html(i.emptyResultHTML);n.$text.trigger("targetUpdated.autocomplete");n.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))}});if(e.layer.features&&e.layer.features.length>0){n.$list.hide("fast");t.call(n,e.layer.features);n.layer.map.zoomToFeatures(n.layer.features);n.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:n.layer,features:n.layer.features}));n.loading.removeWait(a)}else if(e.layer.features&&0==e.layer.features.length&&i.params.type==TC.Consts.layerType.WFS){n.$list.html(i.emptyResultHTML);n.$text.trigger("targetUpdated.autocomplete");n.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY));n.loading.removeWait(a)}}});0==r.features.length&&n.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:r,id:e}))})})}else s||n.map.$events.trigger($.Event(TC.Consts.event.SEARCHQUERYEMPTY))};var r=function(e){var t=this;if(e&&e.layer==t.layer){var r,n,i,a=e.id,s=t.getPoint(a);if(s&&t.insideLimit(s)){n=t.getLabel(a);i=t.layer.addMarker(s,$.extend({},t.map.options.styles.point,{title:n,group:n}));r=t.map.options.pointBoundsRadius;

t.map.setExtent([s[0]-r,s[1]-r,s[0]+r,s[1]+r])}else{var o=/^Lat((?:[+-]?)\d+(?:\.\d+)?)Lon((?:[+-]?)\d+(?:\.\d+)?)$/.exec(a);a=t.LAT+o[2]+t.LON+o[1];s=t.getPoint(a);if(s&&t.insideLimit(s)){n=t.getLabel(a);i=t.layer.addMarker(s,$.extend({},t.map.options.styles.point,{title:n,group:n}));r=t.map.options.pointBoundsRadius;t.map.setExtent([s[0]-r,s[1]-r,s[0]+r,s[1]+r]);t.$text.val(n)}}$.when(i).then(function(e){t.map.$events.trigger($.Event(TC.Consts.event.FEATURESADD,{layer:t.layer,features:[e]}))})}};e.goToCoordinates=function(e){var t=this,n={};if(/^X(\d+(?:[\.\,]\d+)?)Y(\d+(?:[\.\,]\d+)?)$/.test(e)||/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.test(e)){n.params={type:TC.Consts.layerType.VECTOR,styles:{marker:{url:t.layerStyleFN.bind(t,"marker","url",!0)}}};n.emptyResultHTML='<li><a class="tc-ctl-search-li-empty">'+t.OUTBBX_LABEL+"</a></li>";var i=r.bind(t);t.map.one(TC.Consts.event.LAYERUPDATE,i);return n}return null};e.goToCadastralRef=function(e){var t=this,r={};if(/^\M(\d+)\P(\d{1,2})Par{1}(\d{1,4})/g.test(e)){var n=/^\M(\d+)\P(\d{1,2})Par{1}(\d{1,4})/g.exec(e);TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");r.params={type:TC.Consts.layerType.WFS,url:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].url,version:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].version,geometryName:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].geometryName,featurePrefix:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].featurePrefix,featureType:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].featureType,properties:new TC.filter.and(new TC.filter.equalTo(t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].queryProperties.municipality,$.trim(n[1])),new TC.filter.equalTo(t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].queryProperties.polygon,$.trim(n[2])),new TC.filter.equalTo(t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].queryProperties.parcel,$.trim(n[3]))),outputFormat:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].outputFormat,styles:t.availableSearchTypes[TC.Consts.searchType.CADASTRAL].styles};r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>";return r}return null};e.goToRoad=function(e){var t=this,r={},n=TC.Consts.searchType.ROAD;r.params={type:TC.Consts.layerType.WFS,url:t.availableSearchTypes[n].url,version:t.availableSearchTypes[n].version,geometryName:t.availableSearchTypes[n].geometryName,featurePrefix:t.availableSearchTypes[n].featurePrefix,featureType:t.filter.getGoToFilterLayer(e),maxFeatures:3e3,properties:t.filter.getGoToFilter(e,n),outputFormat:t.availableSearchTypes[n].outputFormat,styles:t.availableSearchTypes[n].styles};r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>";return r};e.goToPK=function(e){var t=this,r={},n=TC.Consts.searchType.ROADPK;r.params={type:TC.Consts.layerType.WFS,url:t.availableSearchTypes[n].url,version:t.availableSearchTypes[n].version,geometryName:t.availableSearchTypes[n].geometryName,featurePrefix:t.availableSearchTypes[n].featurePrefix,featureType:t.filter.getGoToFilterLayer(e),maxFeatures:3e3,properties:t.filter.getGoToFilter(e,n),outputFormat:t.availableSearchTypes[n].outputFormat,styles:t.availableSearchTypes[n].styles};r.emptyResultHTML='<li><a title="'+t.EMPTY_RESULTS_TITLE+'" class="tc-ctl-search-li-empty">'+t.EMPTY_RESULTS_LABEL+"</a></li>";return r};e.goToAddress=function(e,t){var r=this,n={},i=r.availableSearchTypes[t];n.params={type:TC.Consts.layerType.WFS,url:i.url,version:i.version,geometryName:i.geometryName,featurePrefix:i.featurePrefix,featureType:r.filter.getGoToFilterLayer(e),maxFeatures:3e3,properties:r.filter.getGoToFilter(e,t),outputFormat:i.outputFormat,styles:i.styles};return n};e.getPoint=function(e){var t,r=this,n=r.map.wrap.isGeo(),i=/^X(\d+(?:\.\d+)?)Y(\d+(?:\.\d+)?)$/.exec(e);if(i&&3===i.length){t=[parseFloat(i[1]),parseFloat(i[2])];n&&(t=TC.Util.reproject(t,r.map.options.utmCrs,r.map.crs))}else{i=/^Lat((?:[+-]?)\d+(?:[.,]\d+)?)Lon((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e);if(i&&3===i.length){t=[parseFloat(i[2]),parseFloat(i[1])];if(!n)return TC.Util.reproject(t,r.map.options.geoCrs,r.map.crs)}i=/^Lon((?:[+-]?)\d+(?:[.,]\d+)?)Lat((?:[+-]?)\d+(?:[.,]\d+)?)$/.exec(e);if(i&&3===i.length){t=[parseFloat(i[2]),parseFloat(i[1])];if(!n)return TC.Util.reproject(t,r.map.options.geoCrs,r.map.crs)}}return t};e.insideLimit=function(e){var t=this,r=function(e,t){return e instanceof Array?t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3]:!0};return r(t.map.options.maxExtent,e)?!0:!1};e.getPattern=function(){var e=this;return e.$text.val()};e.getLabel=function(e){var t=this,r=e,n=TC.Util.getMapLocale(t.map);if(e.match(new RegExp("^(?:"+t.LAT+"[-\\d])|(?:"+t.UTMX+"[\\d])"))){r=r.replace(t.LAT,t.LAT_LABEL).replace(t.LON," "+t.LON_LABEL).replace(t.UTMX,t.UTMX_LABEL).replace(t.UTMY," "+t.UTMY_LABEL);var i=r.match(new RegExp("^"+$.trim(t.LAT_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(t.LON_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));if(i){r=r.replace(i[1],parseFloat(i[1]).toLocaleString(n));r=r.replace(i[3],parseFloat(i[3]).toLocaleString(n))}var a=1.1.toLocaleString(n).substring(1,2),i=r.match(new RegExp("^"+$.trim(t.UTMX_LABEL)+"*\\s*([0-9]{"+t.UTMX_LEN+"}(?:[.,]\\d+)?)\\s*\\,?\\s*"+$.trim(t.UTMY_LABEL)+"*\\s*([0-9]{"+t.UTMY_LEN+"}(?:[.,]\\d+)?)$"));if(i){Number.isInteger(parseFloat(i[1]))||(r=r.replace(i[1],i[1].replace(".",a)));Number.isInteger(parseFloat(i[2]))||(r=r.replace(i[2],i[2].replace(".",a)))}}else if(e.match(new RegExp("^(?:"+t.LON+"[-\\d])"))){r=r.replace(t.LON,t.LON_LABEL).replace(t.LAT," "+t.LAT_LABEL);var i=r.match(new RegExp("^"+$.trim(t.LON_LABEL)+"*\\s*([-+]?\\d{1,3}([.,]\\d+)?)\\,?\\s*"+$.trim(t.LAT_LABEL)+"*\\s*([-+]?\\d{1,2}([.,]\\d+)?)$"));if(i){r=r.replace(i[1],parseFloat(i[1]).toLocaleString(n));r=r.replace(i[3],parseFloat(i[3]).toLocaleString(n))}}else if(e.match(new RegExp("^(?:(\\"+t.MUN+"{1})(.*)(\\"+t.POL+"{1})(\\d{1,2})(\\"+t.PAR+"{1})(\\d{1,4}))"))){var i=e.match(new RegExp("^(?:(\\"+t.MUN+"{1})(.*)(\\"+t.POL+"{1})(\\d{1,2})(\\"+t.PAR+"{1})(\\d{1,4}))"));r=t.MUN_LABEL+i[2]+", "+t.POL_LABEL+i[4]+", "+t.PAR_LABEL+i[6]}return r};e.removePunctuation=function(e){e=e||"";for(var t=new Array(e.length),r={"\xe1":"a","\xc1":"A","\xe9":"e","\xc9":"E","\xed":"i","\xcd":"I","\xf3":"o","\xd3":"O","\xfa":"u","\xfc":"u","\xda":"U","\xdc":"U"},n=0,i=e.length;i>n;n++)t[n]=r[e.charAt(n)]||e.charAt(n);return t.join("")};e.decodeEntities=function(e){return $("<div/>").html(e).text()};e.transformFilter=function(e){TC.filter||TC.syncLoadJS(TC.apiLocation+"TC/Filter");if(e&&e instanceof Array){var t=e.map(function(e){if(!e.hasOwnProperty("type"))return new TC.filter.equalTo(e.name,e.value);switch(!0){case e.type==TC.Consts.comparison.EQUAL_TO:return new TC.filter.equalTo(e.name,e.value)}});return t.length>1?TC.filter.and.apply(null,t):t[0]}}}();String.prototype.tcFormat||(String.prototype.tcFormat=function(){var e=(arguments||[""])[0];return this.replace(/{(\d+)}/g,function(t,r){return"undefined"!=typeof e[r]?e[r]:t})});String.prototype.splitRemoveWhiteSpaces||(String.prototype.splitRemoveWhiteSpaces=function(e){for(var t=[],r=this.split(e),n=0;n<r.length;n++)$.trim(r[n]).length>0&&t.push($.trim(r[n]));return t});String.prototype.toCamelCase||(String.prototype.toCamelCase=function(){var e=this.toLowerCase(),t=this.toLowerCase().match(/\W+(.)/g);if(t)for(var r=0;r<t.length;r++)/[;:.<>\{\}\[\]\/\s()]/g.test(t[r])&&(e=e.replace(t[r],t[r].toUpperCase()));return e.charAt(0).toUpperCase()+e.substring(1)});Array.prototype.hasOwnProperty("findByProperty")||Object.defineProperty(Array.prototype,"findByProperty",{enumerable:!1,writable:!0,value:function(e,t){for(var r=0;r<this.length;r++)if(this[r][e]==t)return this[r]}});String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var r=this.toString();("number"!=typeof t||!isFinite(t)||Math.floor(t)!==t||t>r.length)&&(t=r.length);t-=e.length;var n=r.indexOf(e,t);return-1!==n&&n===t});TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.SelectContainer=function(){var e=this;TC.Control.apply(e,arguments);var t=e._classSelector="."+e.CLASS;e._selectors={TAB:t+"-tab",RADIOBUTTON:"input[type=radio][name=sctnr-sel]",ELEMENT:t+"-elm"};e.controlOptions=e.options.controls||[];var r=e.controlOptions.length;e._ctlDeferreds=new Array(r);for(var n=0;r>n;n++)e._ctlDeferreds[n]=$.Deferred()};TC.inherit(TC.control.SelectContainer,TC.Control);!function(){var e=TC.control.SelectContainer.prototype;e.CLASS="tc-ctl-sctnr";e.template=TC.isDebug?TC.apiLocation+"TC/templates/SelectContainer.html":function(){function t(e,t){return e.w("<h2>").f(t.get(["title"],!1),t,"h").w('</h2><div class="tc-ctl-sctnr-select"><form>').s(t.get(["controls"],!1),t,{block:r},{}).w("</form></div>").s(t.get(["controls"],!1),t,{block:n},{})}function r(e,t){return e.w('<label class="tc-ctl-sctnr-tab tc-ctl-sctnr-tab-').f(t.get(["$idx"],!1),t,"h").w('" style="width:calc(100%/').f(t.get(["$len"],!1),t,"h").w(' - 1px)"><input type="radio" name="sctnr-sel" value="').f(t.get(["$idx"],!1),t,"h").w('" /><span>').f(t.get(["title"],!1),t,"h").w("</span></label>")}function n(e,t){return e.w('<div class="tc-ctl-sctnr-elm tc-ctl-sctnr-elm-').f(t.get(["$idx"],!1),t,"h").w(' tc-hidden"></div>')}dust.register(e.CLASS,t);t.__dustBody=!0;r.__dustBody=!0;n.__dustBody=!0;return t};e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.renderPromise().then(function(){t.title=t.getLocaleString(t.options.title||"moreControls");t._$div.find("h2").first().html(t.title);for(var r=new Array(t.controlOptions.length),n=0,i=t.controlOptions.length;i>n;n++){var a=t.controlOptions[n];r[n]=e.addControl(a.name,$.extend({div:t._$div.find("."+t.CLASS+"-elm-"+n)},a.options))}var s=function(e,r){e.renderPromise().then(function(){var n=t.getLocaleString(t.controlOptions[r].title)||e._$div.find("h2").first().html();e._$div.parents(t._classSelector).first().find(t._selectors.TAB+"-"+r+" span").html(n)})};$.when.apply(t,r).then(function(){for(var e=0,r=arguments.length;r>e;e++){var n=arguments[e];s(n,e);t._ctlDeferreds[e].resolve(n)}})})};e.render=function(e){var t=this;t.renderData({title:t.title,controls:t.controlOptions},function(){var e=function(e){var r=$(this).closest(t._selectors.TAB).find(t._selectors.RADIOBUTTON),n=r.val(),i=t._$div.find(t._selectors.ELEMENT);if(t._oldValue===n&&t.options.deselectable){setTimeout(function(){r.prop("checked",!1)},0);t._oldValue=null;$active=$();$hidden=i}else{$active=i.filter(t._selectors.ELEMENT+"-"+n);$hidden=i.not($active);t._oldValue=n}$active.removeClass(TC.Consts.classes.HIDDEN);$hidden.addClass(TC.Consts.classes.HIDDEN);r.prop("checked",!0)};t._$div.find("span").on(TC.Consts.event.CLICK,e);for(var r=0,n=t._ctlDeferreds.length;n>r;r++)t.getControl(r).then(function(e){e.render()});"number"==typeof t.options.defaultSelection&&e.call(t._$div.find(t._selectors.RADIOBUTTON).get(t.options.defaultSelection))})};e.getControl=function(e){var t=this._ctlDeferreds[e];if(!t){t=$.Deferred();t.reject()}return t.promise()}}();TC.control=TC.control||{};TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");TC.control.Share=function(e){var t=this;t._classSelector="."+t.CLASS;TC.Control.apply(t,arguments);var r=e||{};t._$dialogDiv=$(TC.Util.getDiv(r.dialogDiv));r.dialogDiv||t._$dialogDiv.appendTo("body");t.render()};TC.inherit(TC.control.Share,TC.Control);!function(){var e=TC.control.Share.prototype;e.CLASS="tc-ctl-share";e.QR_MAX_LENGTH=150;e.IFRAME_WIDTH="600px";e.IFRAME_HEIGHT="450px";e.MOBILEFAV="Siga las instrucciones del navegador del dispositivo m\xf3vil para a\xf1adir como favorito. Se guardar\xe1 el estado actual del mapa.";e.NAVALERT=" +D para guardar en marcadores.";e.render=function(e){var t=this;t.getRenderedHtml(t.CLASS+"-dialog",null,function(e){t._$dialogDiv.html(e)}).then(function(){TC.Control.prototype.render.call(t,function(){if(TC.Util.detectChrome()||TC.Util.detectIE()>=10||TC.Util.detectFirefox()>=41){t._$div.find("button").removeClass("hide");var r=t._$div.find("input[type=text]");r.removeAttr("data-original-title")}TC.Util.detectMobile()||t._$div.find(".share-whatsapp").addClass(TC.Consts.classes.HIDDEN);var n=t._$div.find("."+t.CLASS+"-url-box");t._$div.find("span").on(TC.Consts.event.CLICK,function(e){var t=$(this).closest("label").find("input[type=radio][name=format]"),r=t.val();n.removeClass(TC.Consts.classes.HIDDEN);n.not(".tc-"+r).addClass(TC.Consts.classes.HIDDEN)});$.isFunction(e)&&e()})})};e.getLocation=function(){var e=window.location.href;window.location.hash&&(e=e.substr(0,e.indexOf(window.location.hash)));return e};e.generateLink=function(){var e=this,t=window.location.href,r=t.indexOf("#");r>0&&(t=t.substring(0,r));if(e.extraParams){var n=TC.Util.getQueryStringParams(t);$.extend(n,e.extraParams);var i=t.indexOf("?");i>=0&&(t=t.substring(0,i));t=t.concat("?",$.param(n))}TC.Util.getParameterByName("lang").length>0&&(t=t.indexOf("&")>-1?t.replace("lang="+TC.Util.getParameterByName("lang")+"&",""):t.replace("?lang="+TC.Util.getParameterByName("lang"),""));var a=e.map.getMapState(),s=t.concat("#",a);if(!(s.length>TC.Consts.URL_MAX_LENGTH)){e.enableButtons(s);return s}e.disableButtons()};e.generateIframe=function(e){var t=this,r=e||this.generateLink();return r?'<iframe style="width:'+t.IFRAME_WIDTH+";height:"+t.IFRAME_HEIGHT+';" src="'+r+'"></iframe>':void 0};e.register=function(t){var r=this;TC.Control.prototype.register.call(r,t);r.MOBILEFAV=r.getLocaleString("mobileBookmarks.instructions");r.NAVALERT=r.getLocaleString("bookmarks.instructions");var n=function(e){var t=$(e).parent().find("input[type=text]");t.val(t.hasClass("tc-url")?r.generateLink():r.generateIframe());t.select()},i=function(){document.getSelection().removeAllRanges();document.getSelection().addRange(document.createRange())};r._$div.on("click","h2",function(e){r._$div.find(".tc-url input[type=text]").val(r.generateLink());r._$div.find(".tc-iframe input[type=text]").val(r.generateIframe())});r._$div.on("click",".tc-ctl-share-url-box button",function(e){n(e.target);document.execCommand("copy");var t=$(this);t.text(r.getLocaleString("copied"));setTimeout(function(){t.text(r.getLocaleString("copy"));i()},1e3)});r._$div.on("click","input[type=text]",function(e){n(e.target)});r._$div.on("click",".ga-share-icon.disabled",function(e){e.stopImmediatePropagation();e.preventDefault();return!1});r._$div.on("click","a.share-email",function(e){e.preventDefault();var t=r.generateLink();t&&(window.location.href="mailto:?body="+encodeURIComponent(t+"\n"))});r._$div.on("click","a.qr-generator",function(e){e.preventDefault();var t=r.generateLink();t&&TC.loadJS("undefined"==typeof QRCode,[TC.apiLocation+"lib/qrcode/qrcode.min.js"],function(){t.length>r.QR_MAX_LENGTH&&(t=TC.Util.shortenUrl(t));TC.Util.showModal(r._$dialogDiv.find(r._classSelector+"-qr-dialog"));var e=r._$dialogDiv.find(".qrcode");e.empty();new QRCode(e[0],t)})});r._$div.on("click","a.share-fb",function(e){e.preventDefault();var t=r.generateLink();if(t){window.open("https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(t));return!1}});r._$div.on("click","a.share-twitter",function(e){e.preventDefault();var t=r.generateLink();if(t){var n=TC.Util.shortenUrl(t);if(void 0!==n){var i=encodeURIComponent(window.document.title?window.document.title:"Visor API SITNA");window.open("https://twitter.com/intent/tweet?text="+i+"&amp;url="+encodeURIComponent(n));return!1}TC.error("La URL "+t+" no ha podido ser acortada por ser no v\xe1lida")}});TC.Util.detectMobile()&&r._$div.on("click","a.share-whatsapp",function(e){e.preventDefault();var t=r.generateLink();if(t){var n=TC.Util.shortenUrl(t),i="whatsapp://send?text=";location.href=void 0!==n?i+encodeURIComponent(n):i+encodeURIComponent(t);return!1}});r._$div.on("click","a.share-star",function(t){t.preventDefault();var n=r.generateLink(),i=document.title;if(TC.Util.detectMobile())alert(e.MOBILEFAV);else if(window.sidebar&&window.sidebar.addPanel)window.sidebar.addPanel(i,n,"");else if(window.sidebar&&/Firefox/i.test(navigator.userAgent)||window.opera&&window.print){window.location.href=n;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}else if(window.external&&"AddFavorite"in window.external)window.external.AddFavorite(n,i);else{window.location.href=n;alert((/Mac/i.test(navigator.userAgent)?"Cmd":"Ctrl")+e.NAVALERT)}return!1})};e.enableButtons=function(e){var t=this;TC.Control.prototype.enable.call(t);var r=t._$div.find("."+t.CLASS+"-alert"),n=t._$div.find(".tc-button"),i=t._$div.find(".ga-share-icon"),a=t._$div.find(".tc-textbox");r.toggleClass(TC.Consts.classes.HIDDEN,!0);n.toggleClass("disabled",!1);n.removeAttr("disabled");$.each(i,function(e,t){$(t).toggleClass("disabled",!1)});a.filter(".tc-url").val(e);a.filter(".tc-iframe").val(t.generateIframe(e))};e.disableButtons=function(){var e=this;TC.Control.prototype.disable.call(e);var t=e._$div.find("."+e.CLASS+"-alert"),r=e._$div.find(".tc-button"),n=e._$div.find(".ga-share-icon"),i=e._$div.find(".tc-textbox");t.toggleClass(TC.Consts.classes.HIDDEN,!1);r.toggleClass("disabled",!0);r.attr("disabled","disabled");$.each(n,function(e,t){$(t).toggleClass("disabled",!0)});i.val()};e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/Share.html";e.template[e.CLASS+"-dialog"]=TC.apiLocation+"TC/templates/ShareDialog.html"}else{e.template[e.CLASS]=function(){function t(e,t){return e.w("<h2>").h("i18n",t,{},{$key:"share"}).w('</h2><div><div class="ga-share-icons"><a class="ga-share-icon share-email" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"sendMapByEmail"}).w('"href="#"><i class="icon-envelope-alt"></i></a><a class="ga-share-icon qr-generator" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"createQrCode"}).w('"href="#"><i class="icon-qrcode"></i></a><a class="ga-share-icon share-fb" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToFacebook"}).w('"href="#"><i class="icon-facebook"></i></a><a class="ga-share-icon share-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToTwitter"}).w('"href="#"><i class="icon-twitter"></i></a><a class="ga-share-icon share-whatsapp" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareMapToWhatsapp"}).w('"href="#"><i class="icon-whatsapp"></i></a><a class="ga-share-icon share-star" target="_blank" data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"addToBookmarks"}).w('"href="#"><i class="icon-star"></i></a></div><div class="tc-ctl-share-select"><form><label class="tc-ctl-share-btn-url"><input type="radio" checked="checked" name="format" value="url" /><span>').h("i18n",t,{},{$key:"shareLink"}).w('</span></label><label class="tc-ctl-share-btn-iframe"><input type="radio" name="format" value="iframe" /><span>').h("i18n",t,{},{$key:"embedMap"}).w('</span></label></form></div><div class="tc-ctl-share-url-box tc-group tc-url"><input type="text" class="tc-textbox tc-url" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"shareLink.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"shareLink.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-url-box tc-group tc-iframe tc-hidden"><input type="text" class="tc-textbox tc-iframe" readonly data-toggle="tooltip" data-placement="top" title="').h("i18n",t,{},{$key:"embedMap.tip.1"}).w('" /><button class="tc-button hide" title="').h("i18n",t,{},{$key:"embedMap.tip.2"}).w('">').h("i18n",t,{},{$key:"copy"}).w('</button></div><div class="tc-ctl-share-alert tc-alert alert-warning tc-hidden"><p>').h("i18n",t,{},{$key:"tooManyLayersLoaded|s"}).w("</p> </div></div>")}dust.register(e.CLASS,t);t.__dustBody=!0;return t};e.template[e.CLASS+"-dialog"]=function(){function t(e,t){return e.w('<div class="tc-ctl-share-qr-dialog tc-modal"><div class="tc-modal-background tc-modal-close"></div><div class="tc-modal-window"><div class="tc-modal-header"><h3>').h("i18n",t,{},{$key:"qrCode"}).w('</h3><div class="tc-ctl-popup-close tc-modal-close"></div></div><div class="tc-modal-body"><div class="qrcode"></div></div><div class="tc-modal-footer"><button type="button" class="tc-button tc-modal-close">').h("i18n",t,{},{$key:"close"}).w("</button></div></div></div>")}dust.register(e.CLASS+"-dialog",t);t.__dustBody=!0;return t}}}();TC.Control||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){TC.Consts.url.GOOGLEMAPS="//maps.googleapis.com/maps/api/js?v=3";var e=TC.Consts.url.GOOGLEMAPS;TC.Cfg.proxyExceptions=TC.Cfg.proxyExceptions||[];TC.Cfg.proxyExceptions.push(TC.Consts.url.GOOGLEMAPS);TC.control.StreetView=function(){var t=this;this._templatePromise=$.Deferred();t._sv=null;t._mapActiveControl=null;TC.Control.apply(t,arguments);t.options.googleMapsKey&&(e+="&key="+t.options.googleMapsKey);t.viewDiv=null;t._$viewDiv=null;t._startLonLat=null};TC.inherit(TC.control.StreetView,TC.Control);var t=TC.control.StreetView.prototype;t.CLASS="tc-ctl-sv";t.template={};if(TC.isDebug){t.template[t.CLASS]=TC.apiLocation+"TC/templates/StreetView.html";t.template[t.CLASS+"-view"]=TC.apiLocation+"TC/templates/StreetViewView.html"}else{t.template[t.CLASS]=function(){function e(e,t){return e.w('<div class="tc-ctl-sv-btn" title="').h("i18n",t,{},{$key:"sv.tip"}).w('"><div class="tc-ctl-sv-drag"></div></div>')}dust.register(t.CLASS,e);e.__dustBody=!0;return e};t.template[t.CLASS+"-view"]=function(){function e(e,t){return e.w('<div class="tc-ctl-sv-btn-close" title="').h("i18n",t,{},{$key:"closeStreetView"}).w('"></div>')}dust.register(t.CLASS+"-view",e);e.__dustBody=!0;return e}}var r=function(e){e._$div.find("."+e.CLASS+"-btn").addClass(TC.Consts.classes.CHECKED);$(e.map.div).addClass(e.CLASS+"-active")},n=function(e){e.layer.clearFeatures();e._$div.find("."+e.CLASS+"-btn").removeClass(TC.Consts.classes.CHECKED);e._$div.find("."+e.CLASS+"-drag").removeClass(TC.Consts.classes.HIDDEN);$(e.map.div).removeClass(e.CLASS+"-active");e._startLonLat=null},i=function(e){var t=!1,r=e._$div.find("."+e.CLASS+"-btn"),i=e._$div.find("."+e.CLASS+"-drag"),a=r[0].getBoundingClientRect(),s=i[0].getBoundingClientRect();i.addClass(TC.Consts.classes.HIDDEN);if(s.top<a.top||s.top>a.bottom||s.left<a.left||s.left>a.right){t=!0;for(var o=e.map.getExtent(),l=[o[2],o[3]],c=(new Array(16),0);16>c;c++)e.layer.addMarker(l,{cssClass:"tc-marker-sv-"+c,width:48,height:48,anchor:[0,1]});var u=e.map.div.getBoundingClientRect(),p=(s.left+s.right)/2-u.left,h=s.bottom-u.top,d=e.map.wrap.getCoordinateFromPixel([p,h]);e.callback(d)}else n(e);return t};t.register=function(e){var t=this;if(!t._$viewDiv){t.viewDiv=TC.Util.getDiv(t.options.viewDiv);t._$viewDiv=$(t.viewDiv).addClass(t.CLASS+"-view "+TC.Consts.classes.HIDDEN);t.options.viewDiv||t._$viewDiv.insertBefore(e.div)}TC.Control.prototype.register.call(t,e);t.layer=null;for(var a=t.CLASS+"-layer",s=0;s<e.workLayers.length;s++){var o=e.workLayers[s];if(o.type===TC.Consts.layerType.VECTOR&&o.id===a){t.layer=o;break}}t.layer||e.loaded(function(){$.when(e.addLayer({id:a,stealth:!0,type:TC.Consts.layerType.VECTOR})).then(function(e){t.layer=e})});t._templatePromise.then(function(){TC.loadJS(!$.fn.drag,[TC.apiLocation+"lib/jquery/jquery.event.drag.js",TC.apiLocation+"lib/jquery/jquery.event.drop.js"],function(){var e=t._$div.find("."+t.CLASS+"-drag");e.drag(function(t,r){e.css({transform:"translate("+r.deltaX+"px, "+r.deltaY+"px)"})}).drag("start",function(e,n){r(t);e.preventDefault();e.stopPropagation()}).drag("end",function(r,n){i(t);e.css({transform:"none"})})});var e=t._$viewDiv;e.find("."+t.CLASS+"-btn-close").on("mouseup",function(r){$(t.map.div).removeClass(TC.Consts.classes.COLLAPSED).trigger("resize");e.addClass(TC.Consts.classes.HIDDEN).removeClass(TC.Consts.classes.VISIBLE);t._$div.find("."+t.CLASS+"-drag").removeClass(TC.Consts.classes.HIDDEN);t.layer.wrap.setDraggable(!1);n(t);t._sv.setVisible(!1);r.stopPropagation();t._previousActiveControl&&t._previousActiveControl.activate()})},function(e,t,r){TC.error("Error de renderizado Streetview")})};t.render=function(){var e=this;TC.Control.prototype.render.call(e,function(){dust.cache[e.CLASS+"-view"]?dust.render(e.CLASS+"-view",null,function(t,r){setTimeout(function(){e._$viewDiv.html(r);t&&TC.error(t);e._templatePromise.resolve()},300)}):TC.error("No hay dust.cache para StreetView")})};var a=0;t.callback=function(t){var r=this,i="EPSG:4326",s=function(e){if(r._sv){var t=e.getBounds();lonLat=TC.Util.reproject([(t[0]+t[2])/2,(t[1]+t[3])/2],r.map.crs,i);r._sv.setPosition({lng:lonLat[0],lat:lonLat[1]})}},o=function(e){if(r._sv){var t=e.getBounds();r._startLonLat=[(t[0]+t[2])/2,(t[1]+t[3])/2]}},l=r.map.getLoadingIndicator();l&&(a=l.addWait(a));var c=$(r.map.div),u=function(e,n){r.layer.clearFeatures();var a,l;if(e){var u=e.getPosition();a=TC.Util.reproject([u.lng(),u.lat()],i,r.map.crs);l=e.getPov().heading}else{a=t;l=0}r.map.addMarker(a,{cssClass:"tc-marker-sv-"+(Math.round(16*l/360)+16)%16,width:48,height:48,anchor:[.4791666666666667,.7083333333333333],layer:r.layer,showsPopup:!1});$.when.apply(this,r.map._markerDeferreds).then(function(e){r.layer.wrap.setDraggable(!0,s,o)});if(n){var p=function(){r.map.setCenter(a)};c.hasClass(TC.Consts.classes.COLLAPSED)?p():setTimeout(p,1200)}};TC.loadJS(!window.google||!google.maps,e,function(){if(window.google){u();var e=r._$viewDiv,s=TC.Util.reproject(t,r.map.crs,i),o=e.hasClass(TC.Consts.classes.VISIBLE),p="transitionend.tc";e.off(p).on(p,function(e){if(("width"===e.originalEvent.propertyName||"height"===e.originalEvent.propertyName)&&!o){o=!0;google.maps.event.trigger(r._sv,"resize");c.addClass(TC.Consts.classes.COLLAPSED).trigger("resize")}});var h={position:new google.maps.LatLng(s[1],s[0]),pov:{heading:0,pitch:0},zoom:1,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_TOP},panControlOptions:{position:google.maps.ControlPosition.LEFT_TOP}};if(r._sv)r._sv.setOptions(h);else{r._sv=new google.maps.StreetViewPanorama(e[0],h);google.maps.event.addListener(r._sv,"position_changed",function(){u(r._sv,e.hasClass(TC.Consts.classes.VISIBLE))});google.maps.event.addListener(r._sv,"pov_changed",function(){if(r.layer.features&&r.layer.features.length>0){var e=r.layer.features[0];delete e.options.url;e.options.cssClass="tc-marker-sv-"+(Math.round(16*r._sv.getPov().heading/360)+16)%16;e.setStyle(e.options);r.layer.refresh()}});google.maps.event.addListener(r._sv,"status_changed",function(){var t=r._sv.getStatus();l&&l.removeWait(a);if(t===google.maps.StreetViewStatus.OK){if(!e.hasClass(TC.Consts.classes.VISIBLE)){r._sv.setVisible(!0);u(r._sv,!0);if(r.map.activeControl){r._previousActiveControl=r.map.activeControl;r.map.activeControl.deactivate(!0)}setTimeout(function(){e.css("left","").css("top","");e.removeClass(TC.Consts.classes.HIDDEN).addClass(TC.Consts.classes.VISIBLE)},200)}}else{TC.alert(r.getLocaleString(t===google.maps.StreetViewStatus.ZERO_RESULTS?"noStreetView":"streetViewUnknownError"));if(r._startLonLat)r.callback(r._startLonLat);else{r.layer.wrap.setDraggable(!1);n(r)}}})}u(r._sv)}else n(r)})}}();TC.control=TC.control||{};TC.control.MapContents||TC.syncLoadJS(TC.apiLocation+"TC/Control");!function(){Array.prototype.filter||(Array.prototype.filter=function(e){"use strict";if(void 0===this||null===this)throw new TypeError;var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var n=[],i=arguments.length>=2?arguments[1]:void 0,a=0;r>a;a++)if(a in t){var s=t[a];e.call(i,s,a,t)&&n.push(s)}return n})}();!function(){for(var e=0,t=["ms","moz","webkit","o"],r=!(!window.performance||!window.performance.now),n=0,i=t.length;i>n&&!window.requestAnimationFrame;n+=1){window.requestAnimationFrame=window[t[n]+"RequestAnimationFrame"];window.cancelAnimationFrame=window[t[n]+"CancelAnimationFrame"]||window[t[n]+"CancelRequestAnimationFrame"]}window.requestAnimationFrame||(window.requestAnimationFrame=function(t,r){var n=(new Date).getTime(),i=Math.max(0,16-(n-e)),a=window.setTimeout(function(){t(n+i)},i);e=n+i;return a});window.cancelAnimationFrame||(window.cancelAnimationFrame=function(e){clearTimeout(e)});if(!r){var a=window.requestAnimationFrame,s=+new Date;window.requestAnimationFrame=function(e,t){var r=function(t){var r=1e12>t?t:t-s;return e(r)};a(r,t)}}}();!function(){TC.Consts.classes.THREED=TC.Consts.classes.THREED||"tc-threed";TC.Consts.event.TERRAINLOADED=TC.Consts.event.TERRAINLOADED||"terrainloaded.tc.threed";TC.Consts.event.TERRAINRECEIVING=TC.Consts.event.TERRAINRECEIVING||"terrainreceiving.tc.threed";TC.control.ThreeD=function(){var e=this;TC.Control.apply(e,arguments);e.$events=$(e);e.selectors={divThreedMap:e.options.divMap};e.Consts={BLANK_BASE:"blank",DEFAULT_TILE_SIZE:256,TERRAIN_URL:"https://pmpwvinet18.tcsa.local/customcesiumterrain/epsg3857/geodetic/_5m/5m",events:{GFI:"gfi.tc.threed"}};e.options.terrainURL&&(e.Consts.TERRAIN_URL=e.options.terrainURL);e.options.isDebug&&(TC.Consts.url.CESIUM=TC.apiLocation+"lib/cesium/debug/Cesium.js")};TC.inherit(TC.control.ThreeD,TC.Control);var e=TC.control.ThreeD.prototype;e.CLASS="tc-ctl-threed";e.classes={MAPTHREED:"tc-map-threed",LOADING:"tc-loading",BTNACTIVE:"active",CAMERACTRARROWDISABLED:"disabled-arrow",BETA:"tc-beta-button",FOCUS:"focus",HIGHLIGHTED:"highlighted",DISABLED:"disabled",OUTFOCUS:"outfocus",GFIRESULTSTR:"-gfiTR",GFIRESULTSTH:"-gfiTH",GFIRESULTSTD:"-gfiTD"};e.direction={TO_TWO_D:"two_d",TO_THREE_D:"three_d"};e.threeDControls=["search","attribution","basemapSelector","listTOC","selectContainer","externalWMS","fileImport","layerCatalog","click","fullScreen","loadingIndicator","navBar","overviewMap","legend","fullScreen","threeD"];e.template={};if(TC.isDebug){e.template[e.CLASS]=TC.apiLocation+"TC/templates/ThreeD.html";e.template[e.CLASS+"-overlay"]=TC.apiLocation+"TC/templates/ThreeDOverlay.html";e.template[e.CLASS+"-cm-ctls"]=TC.apiLocation+"TC/templates/ThreeDCameraControls.html"}else{e.template[e.CLASS+"-cm-ctls"]=function(){function t(e,t){return e.w('<div><svg xmlns:dc="http://purl.org/dc/elements/1.1/"xmlns:cc="http://creativecommons.org/ns#"xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"xmlns:svg="http://www.w3.org/2000/svg"xmlns="http://www.w3.org/2000/svg"xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"width="220"height="135"viewBox="0 0 63.40233 35.531682"version="1.1"id="threedControls"><g inkscape:groupmode="layer"id="backgroundLayer"inkscape:label="backgroundLayer"transform="translate(-2.3693123,-42.387899)"><path style="fill:#ffffff;fill-opacity:0.23999999;stroke:none;stroke-width:0.2;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:0.3169643;paint-order:stroke fill markers"d="M 48.005285,42.387899 A 17.766048,17.766048 0 0 0 34.067635,49.16888 17.754217,17.754217 0 0 0 20.123267,42.399784 17.754217,17.754217 0 0 0 2.3693123,60.153739 a 17.754217,17.754217 0 0 0 17.7539547,17.75447 17.754217,17.754217 0 0 0 13.923699,-6.76961 17.766048,17.766048 0 0 0 13.958319,6.78098 17.766048,17.766048 0 0 0 17.766357,-17.76584 17.766048,17.766048 0 0 0 -17.766357,-17.76584 z"id="background"inkscape:connector-curvature="0" /></g><g inkscape:label="tiltLayer"inkscape:groupmode="layer"id="tiltLayer"transform="translate(-26.69084,-42.254264)"style="display:inline"><g class="tc-ctl-threed-cm-tilt-indicator"><path class="tc-ctl-threed-cm-tilt-inner"id="tiltInner"d="m 44.44423,52.861576 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"inkscape:connector-curvature="0"><title>').h("i18n",t,{},{$key:"threed.tilt.reset"
}).w('</title></path><path class="tc-ctl-threed-cm-tilt-inner-image"d="m 40.116095,64.124648 c -0.12075,-0.119221 -0.171366,-0.928328 -0.171366,-2.739326 0,-2.143319 0.03709,-2.606753 0.223349,-2.79065 0.19727,-0.194769 0.269957,-0.196719 0.622509,-0.01671 0.219537,0.112088 0.761654,0.542242 1.204705,0.955894 l 0.805547,0.752098 v 0.939855 c 0,0.51692 -0.06955,1.085596 -0.154558,1.263727 -0.173436,0.363428 -1.919571,1.804317 -2.186551,1.804317 -0.09475,0 -0.249383,-0.07614 -0.343635,-0.169192 z m 3.287741,-0.05029 c -0.307698,-0.212789 -0.317387,-0.295835 -0.317387,-2.721198 0,-1.757783 0.05096,-2.552024 0.171366,-2.670904 0.120776,-0.119243 0.941399,-0.169194 2.779684,-0.169194 2.432612,0 2.618273,0.01838 2.756146,0.27272 0.08484,0.156511 0.147831,1.267987 0.147831,2.608402 0,3.088986 0.189068,2.899662 -2.895738,2.899662 -1.872744,0 -2.3862,-0.04266 -2.641902,-0.219488 z m 0.586357,-6.180807 c -0.314529,-0.267117 -0.397432,-0.458143 -0.397432,-0.915756 0,-0.785501 0.427643,-1.207722 1.223233,-1.207722 1.162181,0 1.675866,1.23538 0.851939,2.048861 -0.522115,0.515494 -1.126934,0.542392 -1.67774,0.07462 z m 2.780604,-0.09201 c -0.374474,-0.369724 -0.423284,-0.501051 -0.3506,-0.943285 0.118405,-0.72038 0.53618,-1.088187 1.236028,-1.088187 0.699848,0 1.117624,0.367807 1.236028,1.088187 0.07269,0.442234 0.02388,0.573561 -0.3506,0.943285 -0.300932,0.297119 -0.573881,0.429526 -0.885428,0.429526 -0.311544,0 -0.584496,-0.132407 -0.885428,-0.429526 z"id="tiltImage"inkscape:connector-curvature="0"><title>').h("i18n",t,{},{$key:"threed.tilt.reset"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-outer tc-ctl-threed-cm-tilt-outer-circle"id="tiltOuter"d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"inkscape:connector-curvature="0"><title>').h("i18n",t,{},{$key:"threed.tilt.drag"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-outer tc-ctl-threed-cm-tilt-outer-shell-circle"sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc"inkscape:connector-curvature="0"id="tiltShell"d="m 44.44423,48.705554 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 C 37.721509,56.11715 36.90502,57.97796 36.90502,60.0297 c 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 h 3.029207 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z"><title>').h("i18n",t,{},{$key:"threed.tilt.drag"}).w('</title></path></g></g><g id="rotateLayer"inkscape:groupmode="layer"inkscape:label="rotateLayer"style="display:inline"transform="translate(-2.3693123,-42.387899)"><path class="tc-ctl-threed-cm-rotate-right"sodipodi:nodetypes="cccccccc"inkscape:connector-curvature="0"id="right"d="m 53.241331,72.907368 0.900176,1.930847 c 3.602027,-1.827343 6.291427,-4.493353 8.092762,-8.066897 l 0.969844,0.452626 -0.663464,-4.788009 -3.222445,2.974451 0.983506,0.459005 c -1.447339,3.107391 -3.949649,5.598011 -7.060379,7.037977 z"><title>').h("i18n",t,{},{$key:"threed.rotate.right"}).w('</title></path><path class="tc-ctl-threed-cm-rotate-left"sodipodi:nodetypes="cccccccc"inkscape:connector-curvature="0"id="left"d="m 42.795431,72.906221 -0.900176,1.930846 c -3.602027,-1.827342 -6.291427,-4.493352 -8.092762,-8.066896 l -0.969844,0.452626 0.663465,-4.788009 3.222444,2.974451 -0.983506,0.459005 c 1.44734,3.107391 3.949649,5.598011 7.060379,7.037977 z"><title>').h("i18n",t,{},{$key:"threed.rotate.left"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-up"sodipodi:nodetypes="cccccccc"inkscape:connector-curvature="0"id="up"d="M 7.737296,54.610066 5.80645,53.70989 c 1.827342,-3.602027 4.493352,-6.291427 8.066896,-8.092762 l -0.452626,-0.969844 4.788009,0.663465 -2.974451,3.222444 -0.459005,-0.983506 c -3.107391,1.44734 -5.598011,3.949649 -7.037977,7.060379 z"><title>').h("i18n",t,{},{$key:"threed.tilt.left"}).w('</title></path><path class="tc-ctl-threed-cm-tilt-down"sodipodi:nodetypes="cccccccc"inkscape:connector-curvature="0"id="down"d="m 7.684579,65.708846 -1.930847,0.900176 c 1.827343,3.602027 4.493353,6.291427 8.066897,8.092762 l -0.452626,0.969844 4.788009,-0.663464 -2.974451,-3.222445 -0.459005,0.983506 C 11.615165,71.321886 9.124545,68.819576 7.684579,65.708846 Z"><title>').h("i18n",t,{},{$key:"threed.tilt.right"}).w('</title></path><g class="tc-ctl-threed-cm-rotate-indicator"><path class="tc-ctl-threed-cm-rotate-inner"inkscape:connector-curvature="0"d="m 48.010487,52.995444 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"id="rotateInner"><title>').h("i18n",t,{},{$key:"threed.rotate.reset"}).w('</title></path><path class="tc-ctl-threed-cm-rotate-inner-image"d="m 45.461645,60.604061 c 0.860585,-1.857231 1.777009,-3.864779 2.036499,-4.461218 0.471802,-1.084433 0.471802,-1.084433 0.66474,-0.667935 2.070474,4.46957 3.86201,8.443545 3.825603,8.485934 -0.02561,0.02982 -0.943964,-0.165127 -2.040793,-0.433206 -1.994234,-0.487419 -1.994234,-0.487419 -3.881098,-0.01711 -1.037775,0.258673 -1.950491,0.470314 -2.028258,0.470314 -0.07777,0 0.562721,-1.519553 1.423307,-3.376784 z m 1.23418,2.027617 c 1.353421,-0.310159 1.353421,-0.310159 1.353421,-2.998288 0,-1.534227 -0.05572,-2.627602 -0.129797,-2.547123 -0.101525,0.110295 -2.316061,4.831583 -2.659547,5.670031 -0.09645,0.23543 -0.15884,0.240844 1.435923,-0.12462 z"id="rotateImage"inkscape:connector-curvature="0"><title>').h("i18n",t,{},{$key:"threed.rotate.reset"}).w('</title></path><path class="tc-ctl-threed-cm-rotate-outer tc-ctl-threed-cm-rotate-outer-circle"inkscape:connector-curvature="0"d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,4.156022 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z"id="rotateOuter"><title>').h("i18n",t,{},{$key:"threed.rotate.drag"}).w('</title></path><path class="tc-ctl-threed-cm-rotate-outer tc-ctl-threed-cm-rotate-outer-shell-circle"d="m 48.010487,48.839422 c -6.246102,0 -11.312196,5.070128 -11.312196,11.324146 0,6.254017 5.066094,11.330914 11.312196,11.330914 6.246102,0 11.312196,-5.076897 11.312196,-11.330914 0,-6.254018 -5.066094,-11.324146 -11.312196,-11.324146 z m 0,0.379051 c 2.995132,0 5.705501,1.203885 7.681205,3.154245 l -2.386853,2.382605 0.135232,0.135376 2.386853,-2.382606 c 1.930016,1.972963 3.12387,4.674054 3.12387,7.655475 0,2.981421 -1.193854,5.680844 -3.12387,7.655474 l -2.386853,-2.382605 -0.135232,0.135375 2.386853,2.382606 c -1.975664,1.951759 -4.686314,3.161013 -7.681205,3.161013 -1.94179,0 -3.766282,-0.506879 -5.347316,-1.395323 -0.850442,-0.477894 -1.630441,-1.06619 -2.320365,-1.745384 l 2.407138,-2.402912 c 1.358381,1.325983 3.214811,2.145699 5.260543,2.145699 4.163407,0 7.545972,-3.385283 7.545972,-7.553943 0,-4.168661 -3.382565,-7.547175 -7.545972,-7.547175 -2.045732,0 -3.902162,0.81461 -5.260543,2.13893 l -2.407138,-2.402912 c 1.972594,-1.940536 4.681097,-3.133938 7.667681,-3.133938 z m -0.189325,0.182756 v 3.01887 h 0.378651 v -3.01887 z m -7.606826,3.086558 2.400376,2.402912 c -1.326946,1.360319 -2.143435,3.221129 -2.143435,5.272869 0,2.05174 0.816489,3.910884 2.143435,5.272869 l -2.400376,2.402912 c -0.435151,-0.44326 -0.832923,-0.923297 -1.188195,-1.435068 -0.462681,-0.666492 -0.853281,-1.386809 -1.160484,-2.149815 -0.508689,-1.263436 -0.788715,-2.64392 -0.788715,-4.090898 0,-2.99182 1.197141,-5.70104 3.137394,-7.675781 z m 7.796151,0.507657 c 3.959106,0 7.167321,3.203889 7.167321,7.168124 0,3.964234 -3.208215,7.174892 -7.167321,7.174892 -3.959106,0 -7.160559,-3.210658 -7.160559,-7.174892 0,-3.964235 3.201453,-7.168124 7.160559,-7.168124 z m -10.744219,6.978598 v 0.379051 h 3.022445 v -0.379051 z m 18.513325,0 v 0.379051 H 58.8088 v -0.379051 z m -7.931385,7.932994 v 3.01887 h 0.37189 v -3.01887 z"id="rotateShell"inkscape:connector-curvature="0"sodipodi:nodetypes="ssssssccccsccccssccsssccscccccccsccssscsssssccccccccccccccc"><title>').h("i18n",t,{},{$key:"threed.rotate.drag"}).w("</title></path></g></g></svg></div>")}dust.register(e.CLASS+"-cm-ctls",t);t.__dustBody=!0;return t};e.template[e.CLASS+"-overlay"]=function(){function t(e,t){return e.w('<div class="tc-ctl-threed-overlay" hidden><svg class="tc-ctl-threed-overlay-svg"><defs><filter id="fGaussian" x="0" y="0"><feGaussianBlur in="SourceGraphic" stdDeviation="3" /></filter></defs><rect width="100%" height="100%" fill="white" fill-opacity="0.5" filter="url(#fGaussian)" /> </svg> </div>')}dust.register(e.CLASS+"-overlay",t);t.__dustBody=!0;return t};e.template[e.CLASS]=function(){function t(e,t){return e.w('<button class="tc-ctl-threed-btn tc-beta-button" title="').h("i18n",t,{},{$key:"threed.tip"}).w('"></button>')}dust.register(e.CLASS,t);t.__dustBody=!0;return t}}e.viewer;e.mapView;e.terrainProvider;e.register=function(e){var t=this;TC.Control.prototype.register.call(t,e);t.mapView=new MapView(e,t)};e.renderData=function(e,t){var r=this;TC.Control.prototype.renderData.call(r,e,function(){r.getRenderedHtml(r.CLASS+"-overlay",{},function(e){r.overlay=$(e)});r.$button=r._$div.find("."+r.CLASS+"-btn");r.$button.on(TC.Consts.event.CLICK,function(){r.$button.attr("disabled","disabled");r.waiting||(r.waiting=r.map.getLoadingIndicator().addWait());for(var e=[],t=0,n=r.threeDControls.length;n>t;t++){var i=r.threeDControls[t];i=i.substr(0,1).toUpperCase()+i.substr(1);e=e.concat(r.map.getControlsByClass("TC.control."+i))}r.ctrlsToMng=e;if(r.mapIs3D){r.deactivate();r.cameraControls.resetRotation({duration:1e3}).then(function(){var e=function(){r.mapIs3D=!1;r.map._$div.removeClass(TC.Consts.classes.THREED);r.$button.attr("title",r.getLocaleString("threed.tip"));r.map3D.destroy.call(r);r.map3D.setViewFromCameraView.call(r).then(function(){r.$divThreedMap.removeClass(r.classes.MAPTHREED);r.$divThreedMap.removeClass("tc-ctl-threed-divMap-fadeIn").addClass("tc-ctl-threed-divMap-fadeOut");$(r.mapView.viewHTML).removeClass("tc-ctl-threed-divMap-fadeOut").addClass("tc-ctl-threed-divMap-fadeIn");r.viewer.destroy();r.viewer=null;r.$button.removeAttr("disabled");r.$button.toggleClass(r.classes.BTNACTIVE);r.map.getLoadingIndicator().removeWait(r.waiting);delete r.waiting});r.mapView.setRotation(0);r._ovMap.wrap.draw3DCamera(null)},t=p(r.viewer.scene),n=Cesium.Matrix4.fromTranslation(t),i=m(r.viewer.scene,t);r.map3D.rotateAroundAxis(r.viewer.scene.camera,-i,r.viewer.scene.camera.right,n,{duration:1500,callback:e})})}else{r.activate();if(r.browserSupportWebGL.call(r)||!r.browserSupportWebGL.call(r)){r.mapIs3D=!0;r.overlay.removeAttr("hidden");r.overlay.appendTo(r.map._$div.parent());r.map._$div.addClass(TC.Consts.classes.THREED);r.$divThreedMap=$("#"+r.selectors.divThreedMap);r.$divThreedMap.addClass(r.classes.MAPTHREED);r.$divThreedMap.addClass(r.classes.LOADING);r.$button.attr("title",r.getLocaleString("threed.two.tip"));r.$button.removeClass(r.classes.BETA);r.map3D.loadViewer.call(r).then(function(){r.$divThreedMap.removeClass("tc-ctl-threed-divMap-fadeOut").addClass("tc-ctl-threed-divMap-fadeIn");$(r.mapView.viewHTML).removeClass("tc-ctl-threed-divMap-fadeIn").addClass("tc-ctl-threed-divMap-fadeOut");r.$divThreedMap.removeClass(r.classes.LOADING);r.$button.toggleClass(r.classes.BTNACTIVE);if(r.options.allowedGFI){r.map3D.linked2DControls.featureInfo=new TwoDLinkedFeatureInfo(r);var e=new Cesium.ScreenSpaceEventHandler(r.viewer.canvas,!1);e.setInputAction(function(e){var t=r.viewer.camera.getPickRay(e.position),n=r.viewer.scene.globe.pick(t,r.viewer.scene);n&&r.map3D.getInfoOnPickedPosition.call(r,n)},Cesium.ScreenSpaceEventType.LEFT_CLICK)}r.map3D.setCameraFromMapView.call(r);r.map3D.setBaseLayer.call(r,r.map.baseLayer);r.map.workLayers.filter(function(e){return e instanceof TC.layer.Raster}).reverse().forEach(function(e){r.map3D.addLayer.call(r,e)});$.when(r.viewer.readyPromise).then(function(){r.cameraControls?r.cameraControls.render.call(r.cameraControls):r.cameraControls=new CameraControls(r);var e=Cesium.Math.toRadians(50),t=p(r.viewer.scene);t=Cesium.Matrix4.fromTranslation(t);var n=function(){Cesium.Camera.DEFAULT_VIEW_RECTANGLE=r.map3D.initialRectangle=r.viewer.camera.computeViewRectangle();Cesium.Camera.DEFAULT_VIEW_FACTOR=0;r.$button.removeAttr("disabled");r.overlay.attr("hidden","hidden");r.map.getLoadingIndicator().removeWait(r.waiting);delete r.waiting;r.$events.on(TC.Consts.event.TERRAINLOADED,function(){if(r.viewer.billboardCollection){for(var e=0;e<r.viewer.billboardCollection.length;e++){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(r.viewer.billboardCollection.get(e).position),n=r.viewer.scene.globe.getHeight(t),i={longitude:t.longitude,latitude:t.latitude,height:t.height+n};r.viewer.billboardCollection.get(e).position=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}r.map3D.customRender.restart()}})};r.map3D.rotateAroundAxis(r.viewer.scene.camera,-e,r.viewer.scene.camera.right,t,{duration:2e3,callback:n})}.bind(r))})}}})});$.isFunction(t)&&t()};e.activate=function(){var e=this;TC.Control.prototype.activate.call(e)};e.deactivate=function(){var e=this;TC.Control.prototype.deactivate.call(e)};MapView=function(e,t){var r=this;r.map=e;r.parent=t;$.when(r.map.getViewHTML()).then(function(e){r.viewHTML=e}.bind(r));r.proj4Obj=proj4(r.map.crs);r.proj4Obj.oProj.METERS_PER_UNIT=1;r.maxResolution;r._oldMapSetCenter=e.setCenter;e.setCenter=function(n,i){t.mapIs3D?t.map3D.flyToMapCoordinates.call(t,n):r._oldMapSetCenter.call(e,n,i)}};MapView.prototype.getCenter=function(){return this.map.getCenter()};MapView.prototype.getExtent=function(){return this.map.getExtent()};MapView.prototype.getResolution=function(){return this.map.getResolution()};MapView.prototype.getRotation=function(){return this.map.getRotation()};MapView.prototype.getMaxResolution=function(){if(this.maxResolution)return this.maxResolution;if(null!==this.map.getResolutions())this.maxResolution=this.map.getResolutions()[0];else{var e=this.map.options.baselayerExtent;this.maxResolution=(e[2]-e[0])/this.parent.Consts.DEFAULT_TILE_SIZE}return this.maxResolution};MapView.prototype.getPixelFromCoordinate=function(e){return this.map.getPixelFromCoordinate(e)};MapView.prototype.setCenter=function(e){this._oldMapSetCenter.call(this.map,e)};MapView.prototype.setExtent=function(e){this.map.setExtent(e)};MapView.prototype.setResolution=function(e){this.map.setResolution(e)};MapView.prototype.setRotation=function(e){this.map.setRotation(e)};var t=function(e,t){var r=1e6,n=t[0]-e[0],i=t[1]-e[1],a=Math.atan(i/n);0>n&&(a+=Math.PI);return[e[0]+r*Math.cos(a),e[1]+r*Math.sin(a)]},r=function(e,t){var r=t[0]-e[0],n=t[1]-e[1];return r*r+n*n},n=function(e){var n=this;e=e||{};if(e.nearMapCoords){var a=e.bottomPixel.clone();a.y=Math.round(9*a.y/10);var s=i.call(n,a);if(s){var o=[e.nearMapCoords,s].sort(function(t,n){return r(e.cameraPosition,t)-r(e.cameraPosition,n)});return t.apply(this,o)}}return null},i=function(e){var t=this,r=c(t.viewer.scene,e);if(r){r=Cesium.Cartographic.fromCartesian(r);return TC.Util.reproject([Cesium.Math.toDegrees(r.longitude),Cesium.Math.toDegrees(r.latitude)],t.map3D.crs,t.map.crs)}return null},a=function(e,t){var r=this,n=r.viewer.camera.frustum.fovy,i=r.mapView.proj4Obj.oProj.METERS_PER_UNIT,a=e*r.mapView.viewHTML.getBoundingClientRect().height,s=Math.cos(Math.abs(t)),o=a*i*s;return o/2/Math.tan(n/2)},o=function(e,t){var r=this,n=r.viewer.scene.canvas,i=r.viewer.camera.frustum.fovy,a=r.mapView.proj4Obj.oProj.METERS_PER_UNIT,s=2*e*Math.tan(i/2),o=Math.cos(Math.abs(t)),l=s/a/o,c=l/n.clientHeight,u=r.map.getResolutions();if(null==u){u=new Array(22);for(var p=0,h=u.length;h>p;++p)u[p]=r.mapView.getMaxResolution()/Math.pow(2,p)}for(var p=0;p<u.length;p++){if(u[p]<Math.abs(c)){c=u[p-1];break}if(u[p]===Math.abs(c)){c=u[p];break}p===u.length-1&&(c=u[p])}return c},l=function(e,t,r,n,i){function a(i){s||(s=i);var l=h(o((i-s)/u,0,1));e.transform.clone(m);var c=(l-f)*t;f=l;e.lookAtTransform(n);e.rotate(r,c);e.lookAtTransform(m);if(1>l)requestAnimationFrame(a);else{d&&d();y.resolve()}}var s,o=Cesium.Math.clamp,l=Cesium.defaultValue,c=i||{},u=l(c.duration,500),p=function(e){return e},h=l(c.easing,p),d=c.callback,f=0,m=new Cesium.Matrix4,y=new $.Deferred;requestAnimationFrame(a);return y},c=function(e,t){var r=e.camera.getPickRay(t),n=e.globe.pick(r,e);return n||e.camera.pickEllipsoid(t)},u=function(e){var t=e.canvas,r=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight/2);return c(e,r)},p=function(e){var t=e.canvas,r=new Cesium.Cartesian2(t.clientWidth/2,t.clientHeight);return c(e,r)},h=function(e){var t=e.camera,r=t.frustum.fovy/2,n=t.direction,i=Cesium.Quaternion.fromAxisAngle(t.right,r),a=Cesium.Matrix3.fromQuaternion(i),s=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(a,n,s);return new Cesium.Ray(t.position,s)},d=function(e,t,r,n){var i=e.camera,a=m(e,r),s=i.right,o=Cesium.Quaternion.fromAxisAngle(s,a),c=Cesium.Matrix3.fromQuaternion(o),u=new Cesium.Cartesian3;Cesium.Cartesian3.subtract(i.position,r,u);var p=new Cesium.Cartesian3;Cesium.Matrix3.multiplyByVector(c,u,p);Cesium.Cartesian3.add(p,r,p);var h=Cesium.Matrix4.fromTranslation(p);l(i,t,p,h,n)},f=function(e,t,r){var n=new Cesium.Cartesian3,i=new Cesium.Cartesian3,a=new Cesium.Cartesian3;Cesium.Cartesian3.normalize(e,n);Cesium.Cartesian3.normalize(t,i);Cesium.Cartesian3.cross(n,i,a);var s=Cesium.Cartesian3.dot(n,i),o=Cesium.Cartesian3.magnitude(a),l=Cesium.Cartesian3.dot(r,a),c=Math.atan2(o,s);return l>=0?c:-c},m=function(e,t){var r=e.camera,n=r.frustum.fovy/2,i=h(e),a=Cesium.Cartesian3.clone(i.direction);Cesium.Cartesian3.negate(a,a);var s=new Cesium.Cartesian3;Cesium.Ellipsoid.WGS84.geocentricSurfaceNormal(t,s);var o=new Cesium.Cartesian3;Cesium.Cartesian3.negate(r.right,o);var l=f(s,a,o);return l+n};CameraControls=function(e){var t=this;t.parent=e;var r=function(e){var t=this;t.isFocusingCameraCtrls=!1},a=function(){var e=this;e.isFocusingCameraCtrls=!0;e.lastFocused=performance.now();if(e.$div.hasClass(e.parent.classes.OUTFOCUS)){e.$div.removeClass(e.parent.classes.OUTFOCUS);e.$tiltIndicatorOuterCircle.attr("class",e.$tiltIndicatorOuterCircle.attr("class").replace(e.parent.classes.OUTFOCUS,""));e.$tiltIndicatorOuterShellCircle.attr("class",e.$tiltIndicatorOuterShellCircle.attr("class").replace(e.parent.classes.OUTFOCUS,""));e.$rotateIndicatorOuterCircle.attr("class",e.$rotateIndicatorOuterCircle.attr("class").replace(e.parent.classes.OUTFOCUS,""));e.$rotateIndicatorOuterShellCircle.attr("class",e.$rotateIndicatorOuterShellCircle.attr("class").replace(e.parent.classes.OUTFOCUS,""))}},s=function(){var e=this;e.moving=!0},l=function(){var e=this;e.moving=!1},c=function(){var e=this,t=e.parent;e.parent.map3D.isLoadingTiles.call(e.parent)&&e.customCollisionDetection();var r=e.getCamera(),a=r.positionCartographic;if(e.moving){u(e.$tiltIndicator,r.pitch);u(e.$rotateIndicator,-r.heading);e.disableTilt(5);e._coordsXY=TC.Util.reproject([Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude)],t.map3D.crs,t.map.crs);t.mapView.setCenter(e._coordsXY);t.mapView.setResolution(o.call(t,a.height,a.latitude))}if(e._coordsXY){t._ovMap=t._ovMap||t.map.getControlsByClass("TC.control.OverviewMap")[0];if(t._ovMap){var s=t.viewer.scene,l=s.canvas,c=new Cesium.Cartesian2(0,l.clientHeight-1),p=new Cesium.Cartesian2(l.clientWidth-1,l.clientHeight-1),h=[c,p,new Cesium.Cartesian2(l.clientWidth-1,0),new Cesium.Cartesian2(0,0)].map(function(e){return i.call(t,e)}).filter(function(e){return null!==e});if(h.length&&h.length<4){var d=n.call(t,{nearMapCoords:h[0],bottomPixel:c,cameraPosition:e._coordsXY}),f=n.call(t,{nearMapCoords:h[1],bottomPixel:p,cameraPosition:e._coordsXY});if(d&&f){h[2]=f;h[3]=d}}t._ovMap.wrap.draw3DCamera({position:e._coordsXY,heading:r.heading,fov:h})}}},u=function(e,t){var r=$(e)[0].getBBox();value="rotate("+Cesium.Math.toDegrees(t)+" "+(r.x+r.width/2)+" "+(r.y+r.height/2)+")";document.getElementsByClassName(e[0].className.baseVal)[0].setAttribute("transform",value)};t.outControlsEvents=TC.Util.detectMouse()?"mouseleave":"touchleave, touchend";t.outControls=r.bind(t);t.inControlsEvents=TC.Util.detectMouse()?"mouseenter":"touchmove, touchstart";t.inControls=a.bind(t);t.moveStart=s.bind(t);t.moveEnd=l.bind(t);t.postRender=c.bind(t);t.selectors={tilt:"-cm-tilt",rotate:"-cm-rotate",indicator:"-indicator",leftArrow:"-left",rightArrow:"-right",downArrow:"-down",upArrow:"-up"};t.render()};CameraControls.prototype.bind=function(){function e(){t.lastFocused||(t.lastFocused=performance.now());var r=performance.now()-t.lastFocused;if(r>5e3&&t.isFocusingCameraCtrls!==!0&&!t.$div.hasClass(t.parent.classes.OUTFOCUS)){t.$div.addClass(t.parent.classes.OUTFOCUS);t.$tiltIndicatorOuterCircle.attr("class",t.$tiltIndicatorOuterCircle.attr("class")+" "+t.parent.classes.OUTFOCUS);t.$tiltIndicatorOuterShellCircle.attr("class",t.$tiltIndicatorOuterShellCircle.attr("class")+" "+t.parent.classes.OUTFOCUS);t.$rotateIndicatorOuterCircle.attr("class",t.$rotateIndicatorOuterCircle.attr("class")+" "+t.parent.classes.OUTFOCUS);t.$rotateIndicatorOuterShellCircle.attr("class",t.$rotateIndicatorOuterShellCircle.attr("class")+" "+t.parent.classes.OUTFOCUS)}t.rAFInOutControls=requestAnimationFrame(e)}var t=this;t.getCamera().moveStart.addEventListener(t.moveStart);t.getCamera().moveEnd.addEventListener(t.moveEnd);t.parent.viewer.scene.postRender.addEventListener(t.postRender);t.$div.on(t.outControlsEvents,t.outControls);t.$div.on(t.inControlsEvents,t.inControls);t.rAFInOutControls=requestAnimationFrame(e)};CameraControls.prototype.unbind=function(){var e=this;e.$div.addClass(TC.Consts.classes.HIDDEN);e.getCamera().moveStart.removeEventListener(e.moveStart);e.getCamera().moveEnd.removeEventListener(e.moveEnd);e.parent.viewer.scene.postRender.removeEventListener(e.postRender);e.$div.off(e.outControlsEvents,e.outControls);e.$div.off(e.inControlsEvents,e.inControls);window.cancelAnimationFrame(e.rAFInOutControls);e.lastFocused=void 0;e.rAFInOutControls=void 0};CameraControls.prototype.getCamera=function(){var e=this;return e.parent.viewer.scene.camera};CameraControls.prototype.render=function(){var e=this;if(e.$div){e.$div.removeClass(TC.Consts.classes.HIDDEN);e.bind()}else e.parent.getRenderedHtml(e.parent.CLASS+"-cm-ctls",{},function(t){e.$div=$('<div class="'+e.parent.CLASS+'-cm-ctls"></div>');e.$div.appendTo(e.parent.map._$div);$(t).appendTo(e.$div);var r="."+e.parent.CLASS+e.selectors.tilt;e.$tiltIndicatorInner=e.$div.find("[class^="+r.replace(".","")+"-inner]");e.$tiltIndicatorInner.on(TC.Consts.event.CLICK,e.resetTilt.bind(e));e.$tiltIndicator=e.$div.find(r+"-indicator");e.$tiltIndicatorOuterCircle=e.$div.find(r+"-outer-circle");e.$tiltIndicatorOuterShellCircle=e.$div.find(r+"-outer-shell-circle");e.$tiltIndicatorCircle=e.$div.find("[class^="+r.replace(".","")+"-outer]");e.$tiltIndicatorCircle.on("mousedown",function(e){var t=this;e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();var r=new Cesium.Cartesian2,n=e.currentTarget,i=e.currentTarget.getBoundingClientRect(),a=new Cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),s=new Cesium.Cartesian2(e.clientX-i.left,e.clientY-i.top),o=Cesium.Cartesian2.subtract(s,a,r);t.draggingTilt.call(t,n,o);e.cancelBubble=!0;e.returnValue=!1;return!1}.bind(e));e.$tiltUp=e.$div.find(r+e.selectors.upArrow);e.$tiltUp.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(t){if(void 0!==$(t.target).attr("disabled")){t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();t.cancelBubble=!0;t.returnValue=!1;return!1}t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();e.inControls(t);var r=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(r,e.tiltUpMouseUpFunction,!1);e.tiltUpMouseUpFunction=void 0;e.tilt.call(e,5);e.tiltUpInterval=setInterval(function(){e.isTiltUpDisabled?e.tiltUpMouseUpFunction():e.tilt.call(e,5)}.bind(e),101);e.tiltUpMouseUpFunction=function(){clearInterval(e.tiltUpInterval);e.tiltUpInterval=void 0;document.removeEventListener(r,e.tiltUpMouseUpFunction,!1);e.tiltUpMouseUpFunction=void 0};document.addEventListener(r,e.tiltUpMouseUpFunction,!1);t.cancelBubble=!0;t.returnValue=!1;return!1}.bind(e));e.$tiltDown=e.$div.find(r+e.selectors.downArrow);e.$tiltDown.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(t){if(void 0!==$(t.target).attr("disabled")){t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();t.cancelBubble=!0;t.returnValue=!1;return!1}t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();e.inControls(t);var r=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(r,e.tiltDownMouseUpFunction,!1);e.tiltDownMouseUpFunction=void 0;e.tilt.call(e,-5);e.tiltDownInterval=setInterval(function(){e.isTiltDownDisabled?e.tiltDownMouseUpFunction():e.tilt.call(e,-5)}.bind(e),101);e.tiltDownMouseUpFunction=function(){clearInterval(e.tiltDownInterval);e.tiltDownInterval=void 0;document.removeEventListener(r,e.tiltDownMouseUpFunction,!1);e.tiltDownMouseUpFunction=void 0};document.addEventListener(r,e.tiltDownMouseUpFunction,!1);t.cancelBubble=!0;t.returnValue=!1;return!1}.bind(e));var n="."+e.parent.CLASS+e.selectors.rotate;e.$rotateIndicatorInner=e.$div.find("[class^="+n.replace(".","")+"-inner]");e.$rotateIndicatorInner.on(TC.Consts.event.CLICK,e.resetRotation.bind(e));e.$rotateIndicator=e.$div.find(n+"-indicator");e.$rotateIndicatorOuterCircle=e.$div.find(n+"-outer-circle");e.$rotateIndicatorOuterShellCircle=e.$div.find(n+"-outer-shell-circle");e.$rotateIndicatorCircle=e.$div.find("[class^="+n.replace(".","")+"-outer]");e.$rotateIndicatorCircle.on("mousedown",function(e){var t=this;e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();var r=new Cesium.Cartesian2,n=e.currentTarget,i=e.currentTarget.getBoundingClientRect(),a=new Cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),s=new Cesium.Cartesian2(e.clientX-i.left,e.clientY-i.top),o=Cesium.Cartesian2.subtract(s,a,r);t.draggingRotate.call(t,n,o);e.cancelBubble=!0;e.returnValue=!1;return!1}.bind(e));e.$rotateLeft=e.$div.find(n+e.selectors.leftArrow);e.$rotateLeft.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(t){t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();e.inControls(t);var r=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(r,e.rotateLeftMouseUpFunction,!1);e.rotateLeftMouseUpFunction=void 0;e.rotate.call(e,-15);e.rotateLeftInterval=setInterval(function(){e.rotate.call(e,-15)}.bind(e),101);e.rotateLeftMouseUpFunction=function(){clearInterval(e.rotateLeftInterval);e.rotateLeftInterval=void 0;document.removeEventListener(r,e.rotateLeftMouseUpFunction,!1);e.rotateLeftMouseUpFunction=void 0};document.addEventListener(r,e.rotateLeftMouseUpFunction,!1);t.cancelBubble=!0;t.returnValue=!1;return!1}.bind(e));e.$rotateRight=e.$div.find(n+e.selectors.rightArrow);e.$rotateRight.on(TC.Util.detectMouse()?"mousedown":"touchstart",function(t){t.stopPropagation&&t.stopPropagation();t.preventDefault&&t.preventDefault();e.inControls(t);var r=TC.Util.detectMouse()?"mouseup":"touchend";document.removeEventListener(r,e.rotateRightMouseUpFunction,!1);e.rotateRightMouseUpFunction=void 0;e.rotate.call(e,15);e.rotateRightInterval=setInterval(function(){e.rotate.call(e,15)}.bind(e),101);e.rotateRightMouseUpFunction=function(){clearInterval(e.rotateRightInterval);e.rotateRightInterval=void 0;document.removeEventListener(r,e.rotateRightMouseUpFunction,!1);e.rotateRightMouseUpFunction=void 0};document.addEventListener(r,e.rotateRightMouseUpFunction,!1);t.cancelBubble=!0;t.returnValue=!1;return!1}.bind(e));e.bind()}.bind(this))};CameraControls.prototype.disableTilt=function(e){var t=this,r=Cesium.Math.toRadians(Math.abs(e));t.isTiltUpDisabled=void 0==p(t.parent.viewer.scene)?!0:t.getCamera().pitch+r>=Cesium.Math.PI_OVER_TWO;t.isTiltDownDisabled=t.getCamera().pitch-r<=-Cesium.Math.PI_OVER_TWO;t.$tiltUp.attr("disabled",t.isTiltUpDisabled);t.isTiltUpDisabled?-1==t.$tiltUp.attr("class").indexOf(t.parent.classes.CAMERACTRARROWDISABLED)&&t.$tiltUp.attr("class",t.$tiltUp.attr("class")+" "+t.parent.classes.CAMERACTRARROWDISABLED):t.$tiltUp.attr("class",t.$tiltUp.attr("class").replace(" "+t.parent.classes.CAMERACTRARROWDISABLED,""));t.$tiltDown.attr("disabled",t.isTiltDownDisabled);t.isTiltDownDisabled?-1==t.$tiltDown.attr("class").indexOf(t.parent.classes.CAMERACTRARROWDISABLED)&&t.$tiltDown.attr("class",t.$tiltDown.attr("class")+" "+t.parent.classes.CAMERACTRARROWDISABLED):t.$tiltDown.attr("class",t.$tiltDown.attr("class").replace(" "+t.parent.classes.CAMERACTRARROWDISABLED,""))};CameraControls.prototype.tilt=function(e){var t=this;t.disableTilt(e);void 0==u(t.parent.viewer.scene)&&(e>0?t.getCamera().lookUp():t.getCamera().lookDown());if(!(e>=Cesium.Math.PI_OVER_TWO&&t.isTiltUpDisabled||e<=-Cesium.Math.PI_OVER_TWO&&t.isTiltDownDisabled)){var r=Cesium.Math.toRadians(e),n=u(t.parent.viewer.scene);if(n){var i=Cesium.Matrix4.fromTranslation(n);t.parent.map3D.rotateAroundAxis(t.getCamera(),-r,t.getCamera().right,i,{duration:100})}}};CameraControls.prototype.rotate=function(e){var t=this;e=Cesium.Math.toRadians(e);var r=p(t.parent.viewer.scene);r&&d(t.parent.viewer.scene,e,r,{duration:100})};CameraControls.prototype.draggingTilt=function(e,t){var r=this;r.$tiltIndicatorOuterCircle.attr("class",r.$tiltIndicatorOuterCircle.attr("class")+" "+r.parent.classes.HIGHLIGHTED);var n=new Cesium.Matrix4,i=new Cesium.Matrix4,a=new Cesium.Cartesian2;document.removeEventListener("mousemove",r.tiltMouseMoveFunction,!1);document.removeEventListener("mouseup",r.tiltMouseUpFunction,!1);r.tiltTickFunction&&r.parent.viewer.clock.onTick.removeEventListener(r.tiltTickFunction);r.tiltMouseMoveFunction=void 0;r.tiltMouseUpFunction=void 0;r.tiltTickFunction=void 0;r.isTilting=!0;r.tiltLastTimestamp=performance.now();var s=r.parent.viewer.scene,o=s.camera,l=u(s);

if(l){r.tiltFrame=Cesium.Transforms.eastNorthUpToFixedFrame(l,Cesium.Ellipsoid.WGS84,i);r.tiltIsLook=!1}else{r.tiltFrame=Cesium.Transforms.eastNorthUpToFixedFrame(o.positionWC,Cesium.Ellipsoid.WGS84,i);r.tiltIsLook=!0}var c=Math.atan2(-t.y,t.x);r.tiltInitialCursorAngle=Cesium.Math.zeroToTwoPi(c-Cesium.Math.PI_OVER_TWO);r.tiltInitialCameraAngle=Math.atan2(o.position.y,o.position.x);r.tiltTickFunction=function(e){var t=this,r=performance.now(),i=(r-t.tiltLastTimestamp,u(s));i&&!t.tiltLastPivot&&(t.tiltLastPivot=i);if(!i&&t.tiltLastPivot)i=t.tiltLastPivot;else if(!t.tiltLastPivot)return;var a=t.tiltCursorAngle+Cesium.Math.PI_OVER_TWO,l=a-t.tiltInitialCursorAngle;s=t.parent.viewer.scene;o=s.camera;var c=Cesium.Matrix4.clone(o.transform,n);o.lookAtTransform(t.tiltFrame);var p=Cesium.Math.zeroToTwoPi(t.tiltInitialCameraAngle-l),h=Math.atan2(o.position.y,o.position.x),d=.02*Math.sin(p-h);t.tiltIsLook?o.look(o.right,-d):o.rotateUp(d);o.lookAtTransform(c);t.tiltLastTimestamp=r}.bind(r);r.tiltMouseMoveFunction=function(t){var r=this,n=e.getBoundingClientRect();center=new Cesium.Cartesian2((n.right-n.left)/2,(n.bottom-n.top)/2);var i=new Cesium.Cartesian2(t.clientX-n.left,t.clientY-n.top),s=Cesium.Cartesian2.subtract(i,center,a),o=Math.atan2(-s.y,s.x);r.tiltCursorAngle=Cesium.Math.zeroToTwoPi(o-Cesium.Math.PI_OVER_TWO)}.bind(r);r.tiltMouseUpFunction=function(e){r.$tiltIndicatorOuterCircle.attr("class",r.$tiltIndicatorOuterCircle.attr("class").replace(r.parent.classes.HIGHLIGHTED,""));r.isTilting=!1;document.removeEventListener("mousemove",r.tiltMouseMoveFunction,!1);document.removeEventListener("mouseup",r.tiltMouseUpFunction,!1);void 0!==r.tiltTickFunction&&r.parent.viewer.clock.onTick.removeEventListener(r.tiltTickFunction);r.tiltMouseMoveFunction=void 0;r.tiltMouseUpFunction=void 0;r.tiltTickFunction=void 0};document.addEventListener("mousemove",r.tiltMouseMoveFunction,!1);document.addEventListener("mouseup",r.tiltMouseUpFunction,!1);r._unsubscribeFromClockTick=r.parent.viewer.clock.onTick.addEventListener(r.tiltTickFunction);var c=Math.atan2(-t.y,t.x);r.tiltCursorAngle=Cesium.Math.zeroToTwoPi(c-Cesium.Math.PI_OVER_TWO)};CameraControls.prototype.draggingRotate=function(e,t){var r=this;r.$rotateIndicatorOuterCircle.attr("class",r.$rotateIndicatorOuterCircle.attr("class")+" "+r.parent.classes.HIGHLIGHTED);var n=new Cesium.Matrix4,i=new Cesium.Matrix4,a=new Cesium.Cartesian2;document.removeEventListener("mousemove",r.rotateMouseMoveFunction,!1);document.removeEventListener("mouseup",r.rotateMouseUpFunction,!1);r.rotateMouseMoveFunction=void 0;r.rotateMouseUpFunction=void 0;r.isRotating=!0;r.rotateInitialCursorAngle=Math.atan2(-t.y,t.x);var s=r.parent.viewer.scene,o=s.camera,l=u(r.parent.viewer.scene);if(null==l||void 0==l){l=p(r.parent.viewer.scene);if(null==l||void 0==l){r.rotateFrame=Cesium.Transforms.eastNorthUpToFixedFrame(o.positionWC,Cesium.Ellipsoid.WGS84,i);r.rotateIsLook=!0}else{r.rotateFrame=Cesium.Transforms.eastNorthUpToFixedFrame(l,Cesium.Ellipsoid.WGS84,i);r.rotateIsLook=!1}}else{r.rotateFrame=Cesium.Transforms.eastNorthUpToFixedFrame(l,Cesium.Ellipsoid.WGS84,i);r.rotateIsLook=!1}try{var c=Cesium.Matrix4.clone(o.transform,n);o.lookAtTransform(r.rotateFrame);r.rotateInitialCameraAngle=Math.atan2(o.position.y,o.position.x);r.rotateInitialCameraDistance=Cesium.Cartesian3.magnitude(new Cesium.Cartesian3(o.position.x,o.position.y,0));o.lookAtTransform(c)}catch(h){r.rotateMouseUpFunction()}r.rotateMouseMoveFunction=function(t){var i=e.getBoundingClientRect(),s=new Cesium.Cartesian2((i.right-i.left)/2,(i.bottom-i.top)/2),l=new Cesium.Cartesian2(t.clientX-i.left,t.clientY-i.top),u=Cesium.Cartesian2.subtract(l,s,a),p=Math.atan2(-u.y,u.x),h=p-r.rotateInitialCursorAngle,d=Cesium.Math.zeroToTwoPi(r.rotateInitialCameraAngle-h);o=r.parent.viewer.scene.camera;try{c=Cesium.Matrix4.clone(o.transform,n);o.lookAtTransform(r.rotateFrame);var f=Math.atan2(o.position.y,o.position.x);o.rotateRight(d-f);o.lookAtTransform(c)}catch(t){r.rotateMouseUpFunction()}};r.rotateMouseUpFunction=function(e){r.isRotating=!1;r.$rotateIndicatorOuterCircle.attr("class",r.$rotateIndicatorOuterCircle.attr("class").replace(r.parent.classes.HIGHLIGHTED,""));document.removeEventListener("mousemove",r.rotateMouseMoveFunction,!1);document.removeEventListener("mouseup",r.rotateMouseUpFunction,!1);r.rotateMouseMoveFunction=void 0;r.rotateMouseUpFunction=void 0};document.addEventListener("mousemove",r.rotateMouseMoveFunction,!1);document.addEventListener("mouseup",r.rotateMouseUpFunction,!1)};CameraControls.prototype.resetTilt=function(){var e=this,t=-e.getCamera().pitch-Cesium.Math.toRadians(50);e.tilt(Cesium.Math.toDegrees(t))};CameraControls.prototype.resetRotation=function(e){var t,r=this,n=new $.Deferred;t=-r.getCamera().heading;for(;t<-Math.PI;)t+=2*Math.PI;for(;t>Math.PI;)t-=2*Math.PI;e?e.callback=function(){n.resolve()}:n.resolve();var i=p(r.parent.viewer.scene);i&&d(r.parent.viewer.scene,t,i,e);return n};CameraControls.prototype.customCollisionDetection=function(){{var e,t,r=this,n=new Cesium.Matrix4,i=new Cesium.Cartographic,a=r.parent.viewer.scene,s=r.parent.viewer.scene.camera,o=a.screenSpaceCameraController,l=(o.enableCollisionDetection,o.minimumCollisionTerrainHeight),c=o.minimumZoomDistance,u=a.globe,p=u.ellipsoid;a.mapProjection}if(!Cesium.Matrix4.equals(s.transform,Cesium.Matrix4.IDENTITY)){e=Cesium.Matrix4.clone(s.transform,n);t=Cesium.Cartesian3.magnitude(s.position);s._setTransform(Cesium.Matrix4.IDENTITY)}var h=i;p.cartesianToCartographic(s.position,h);var d=!1;if(h.height<l){var f=u.getHeight(h);if(void 0!==f&&null!==f){f+=c;if(h.height<f){h.height=f;p.cartographicToCartesian(h,s.position);d=!0}}}if(void 0!==e&&null!==e){s._setTransform(e);if(d){Cesium.Cartesian3.normalize(s.position,s.position);Cesium.Cartesian3.negate(s.position,s.direction);Cesium.Cartesian3.multiplyByScalar(s.position,Math.max(t,c),s.position);Cesium.Cartesian3.normalize(s.direction,s.direction);Cesium.Cartesian3.cross(s.direction,s.up,s.right);Cesium.Cartesian3.cross(s.right,s.direction,s.up)}}};CameraControls.prototype.limitCameraToInitExtent=function(){var e=this,t=e.viewer.camera.positionCartographic.clone();if(!(t.longitude>=e.initExtent.west&&t.longitude<=e.initExtent.east&&t.latitude>=e.initExtent.south&&t.latitude<=e.initExtent.north)){var r=e.viewer.scene.screenSpaceCameraController.maximumZoomDistance,n=.05*t.height/r;t.longitude=Math.max(e.initExtent.west-n,t.longitude);t.latitude=Math.max(e.initExtent.south-n,t.latitude);t.longitude=Math.min(e.initExtent.east+n,t.longitude);t.latitude=Math.min(e.initExtent.north+n,t.latitude);e.viewer.camera.setView({destination:Cesium.Ellipsoid.WGS84.cartographicToCartesian(t),orientation:{heading:e.viewer.camera.heading,pitch:e.viewer.camera.pitch}})}e.viewer.scene.screenSpaceCameraController.minimumZoomDistance=t.height>1800?400:200};CustomRenderLoop=function(e,t,r){this.map2D=e;this.listentTo=[TC.Consts.event.LAYERADD,TC.Consts.event.LAYERORDER,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYEROPACITY,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.ZOOM,TC.Consts.event.BASELAYERCHANGE,TC.Consts.event.FEATUREADD,TC.Consts.event.FEATUREREMOVE,TC.Consts.event.LAYERUPDATE,TC.Consts.event.TERRAINLOADED,TC.Consts.event.ZOOMTO].join(" ");this.map3D=t;this.scene_=this.map3D.scene;this.verboseRendering=r;this._boundNotifyRepaintRequired=this.notifyRepaintRequired.bind(this);this.lastCameraViewMatrix_=new Cesium.Matrix4;this.lastCameraMoveTime_=0;this.stoppedRendering=!1;this._removeTileLoadProgressListener=this.scene_.globe.tileLoadProgressEvent.addEventListener(function(e){this.tilesWaiting=0===e?!1:!0}.bind(this));this._removePostRenderListener=this.scene_.postRender.addEventListener(this.postRender.bind(this));this._wheelEvent="";this._wheelEvent="onwheel"in this.scene_.canvas?"wheel":document.onmousewheel?"mousewheel":"DOMMouseScroll";this._originalLoadWithXhr=Cesium.loadWithXhr.load;this._originalScheduleTask=Cesium.TaskProcessor.prototype.scheduleTask;this._originalCameraSetView=Cesium.Camera.prototype.setView;this._originalCameraMove=Cesium.Camera.prototype.move;this._originalCameraRotate=Cesium.Camera.prototype.rotate;this._originalCameraLookAt=Cesium.Camera.prototype.lookAt;this._originalCameraFlyTo=Cesium.Camera.prototype.flyTo;this.enable()};CustomRenderLoop.prototype.repaintOn_=function(e,t){var r=this.scene_.canvas;r.addEventListener(e,this._boundNotifyRepaintRequired,t)};CustomRenderLoop.prototype.removeRepaintOn_=function(e,t){var r=this.scene_.canvas;r.removeEventListener(e,this._boundNotifyRepaintRequired,t)};CustomRenderLoop.prototype.enable=function(){this.repaintOn_("mousemove",!1);this.repaintOn_("mousedown",!1);this.repaintOn_("mouseup",!1);this.repaintOn_("touchstart",!1);this.repaintOn_("touchend",!1);this.repaintOn_("touchmove",!1);if(window.PointerEvent){this.repaintOn_("pointerdown",!1);this.repaintOn_("pointerup",!1);this.repaintOn_("pointermove",!1)}this.repaintOn_(this._wheelEvent,!1);window.addEventListener("resize",this._boundNotifyRepaintRequired,!1);var e=this;Cesium.loadWithXhr.load=function(t,r,n,i,a,s,o,l,c){s.promise.always(e._boundNotifyRepaintRequired);e._originalLoadWithXhr(t,r,n,i,a,s,o,l,c)};Cesium.TaskProcessor.prototype.scheduleTask=function(t,r){var n=e._originalScheduleTask.call(this,t,r),i=this;if(!i._originalWorkerMessageSinkRepaint){var a=i._worker;i._originalWorkerMessageSinkRepaint=a.onmessage;a.onmessage=function(t){i._originalWorkerMessageSinkRepaint(t);e.notifyRepaintRequired()}}return n};Cesium.Camera.prototype.setView=function(){e._originalCameraSetView.apply(this,arguments);e.notifyRepaintRequired()};Cesium.Camera.prototype.move=function(){e._originalCameraMove.apply(this,arguments);e.notifyRepaintRequired()};Cesium.Camera.prototype.rotate=function(){e._originalCameraRotate.apply(this,arguments);e.notifyRepaintRequired()};Cesium.Camera.prototype.lookAt=function(){e._originalCameraLookAt.apply(this,arguments);e.notifyRepaintRequired()};Cesium.Camera.prototype.flyTo=function(){e._originalCameraFlyTo.apply(this,arguments);e.notifyRepaintRequired()};this.map2D.on(this.listentTo,this._boundNotifyRepaintRequired)};CustomRenderLoop.prototype.disable=function(){if(this._removePostRenderListener){this._removePostRenderListener();this._removePostRenderListener=void 0}if(this._removeTileLoadProgressListener){this._removeTileLoadProgressListener();this._removeTileLoadProgressListener=void 0}this.removeRepaintOn_("mousemove",!1);this.removeRepaintOn_("mousedown",!1);this.removeRepaintOn_("mouseup",!1);this.removeRepaintOn_("touchstart",!1);this.removeRepaintOn_("touchend",!1);this.removeRepaintOn_("touchmove",!1);if(window.PointerEvent){this.removeRepaintOn_("pointerdown",!1);this.removeRepaintOn_("pointerup",!1);this.removeRepaintOn_("pointermove",!1)}this.removeRepaintOn_(this._wheelEvent,!1);window.removeEventListener("resize",this._boundNotifyRepaintRequired,!1);Cesium.loadWithXhr.load=this._originalLoadWithXhr;Cesium.TaskProcessor.prototype.scheduleTask=this._originalScheduleTask;Cesium.Camera.prototype.setView=this._originalCameraSetView;Cesium.Camera.prototype.move=this._originalCameraMove;Cesium.Camera.prototype.rotate=this._originalCameraRotate;Cesium.Camera.prototype.lookAt=this._originalCameraLookAt;Cesium.Camera.prototype.flyTo=this._originalCameraFlyTo;this.map2D.off(this.listentTo,this._boundNotifyRepaintRequired)};CustomRenderLoop.prototype.postRender=function(e){var t=Date.now(),r=this.scene_,n=r.camera;Cesium.Matrix4.equalsEpsilon(this.lastCameraViewMatrix_,n.viewMatrix,1e-5)||(this.lastCameraMoveTime_=t);var i=t-this.lastCameraMoveTime_<3e3,a=r.tweens;if(!i&&!this.tilesWaiting&&0==a.length){this.verboseRendering&&console.log("stopping rendering @ "+Date.now());this.parent.setBlockRendering(!0);this.stoppedRendering=!0}Cesium.Matrix4.clone(n.viewMatrix,this.lastCameraViewMatrix_)};CustomRenderLoop.prototype.restart=function(){this.notifyRepaintRequired()};CustomRenderLoop.prototype.notifyRepaintRequired=function(){this.verboseRendering&&this.stoppedRendering&&console.log("starting rendering @ "+Date.now());this.lastCameraMoveTime_=Date.now();this.parent.setBlockRendering(!1);this.stoppedRendering=!1};CustomRenderLoop.prototype.setDebug=function(e){this.verboseRendering=e};CustomRender=function(e,t,r){this.idRequestAnimationFrame=null;this._blockRendering=!1;this._canvasClientWidth=0;this._canvasClientHeight=0;this._resolutionScale=1;this._viewer=t;this._canvas=t.scene.canvas;this._clock=t.clock||new Cesium.Clock;this._handleResize=function(e){var t=this._canvas.clientWidth,r=this._canvas.clientHeight;if(!(0===t|0===r||t===this._canvasClientWidth&&r===this._canvasClientHeight)){var n=this._resolutionScale;this._canvasClientWidth=t;this._canvasClientHeight=r;t*=n;r*=n;this._canvas.width=t;this._canvas.height=r;e.scene.camera.frustum.aspectRatio=t/r}};this._renderingAnimation=function(){function e(){if(this._blockRendering)this._clock.tick();else{this._viewer.scene.initializeFrame();this._handleResize(this._viewer);var t=this._clock.tick()||Cesium.JulianDate.now();this._viewer.scene.render(t)}this.idRequestAnimationFrame=requestAnimationFrame(e.bind(this))}this.idRequestAnimationFrame=requestAnimationFrame(e.bind(this))};r&&(this._resolutionScale=.5);this.renderLoop=new CustomRenderLoop(e,t,!1);this.renderLoop.parent=this};CustomRender.prototype.start=function(e){this.renderLoop.setDebug(e||!1);this._renderingAnimation()};CustomRender.prototype.stop=function(){window.cancelAnimationFrame(this.idRequestAnimationFrame)};CustomRender.prototype.restart=function(){this.renderLoop.restart()};CustomRender.prototype.setBlockRendering=function(e){this._blockRendering=e};CustomRender.prototype.getCanvas=function(){return this._canvas};TwoDLinkedFeatureInfo=function(e){this.layer=null;var t=null,r=null,n=null,i=null,a=function(){var t=new $.Deferred;if(r)t.resolve();else{TC.control.ResultsPanel||TC.syncLoadJS(TC.apiLocation+"TC/control/ResultsPanel");r=new TC.control.ResultsPanel({div:"results-panel",content:"table",titles:{main:e.getLocaleString("threed.rs.panel.gfi"),max:e.getLocaleString("threed.rs.panel.gfi")},openOn:e.Consts.events.GFI});r.register(e.map);r.render(function(){r.onClose=function(){c();e.map.$events.trigger($.Event(TC.Consts.event.POPUPHIDE,{control:n.popup}))}.bind(this);e.map.on(TC.Consts.event.RESULTSPANELCLOSE,r.onClose);t.resolve()})}return t},l=function(r){if(t)t.position=r;else{var n=(TC.control.FeatureInfoCommons.prototype.markerStyle,{position:r,billboard:{image:TC.Util.getBackgroundUrlFromCss(e.CLASS+"-marker"),eyeOffset:new Cesium.Cartesian3(0,0,-100),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}});t=e.map3D.addNativeFeature.call(e,n)}},c=function(){e.map3D.removeFeature.call(e,t);t=null};n=e.map.getControlsByClass(TC.control.FeatureInfo)[0];if(n){n.marker=!0;i=n.popup.$popupDiv;n.popup.hide();this.layer=n.layer;e.map3D.vector2DLayers.push(this.layer)}this.clear=function(){this.layer=null;c();if(r){r.onClose&&e.map.off(TC.Consts.event.RESULTSPANELCLOSE,r.onClose);r.close()}if(n){n.popup.$popupDiv=i;n.popup.hide()}};this.send=function(t){var u=new $.Deferred;e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait());n.popup.$popupDiv=i;l(t);$.when(a()).then(function(){for(var i,a=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),l=TC.Util.reproject([Cesium.Math.toDegrees(a.longitude),Cesium.Math.toDegrees(a.latitude)],e.map3D.crs,e.map.crs),p=e.map.options.pixelTolerance||TC.Cfg.pixelTolerance,h=2*p+1,d=e.viewer.scene.globe._surface._tilesToRender,f=0;!i&&f<d.length;++f){var m=d[f];Cesium.Rectangle.contains(m.rectangle,a)&&(i=m)}if(!i)return u;for(var y=i.data.imagery,g=y.length-1;g>=0;--g){var v=y[g],C=v.readyImagery;if(!C)return u}var T=o.call(e,e.viewer.camera.positionCartographic.height,e.viewer.camera.positionCartographic.latitude),L=h*T/2,w=[l[0]-L,l[1]-L,l[0]+L,l[1]+L],b=[p,p];e.map.one(TC.Consts.event.POPUP,function(e){r.open(e.control.$popupDiv.find("."+n.CLASS).clone(!0,!0));n.popup.$popupDiv=r.$divTable;n.onShowPopUp(e);n.popup.$popupDiv.removeAttr("style");u.resolve(e)});e.map.one(TC.Consts.event.NOFEATUREINFO,function(e){n.isActive=savedIsActive;c(s);r&&r.close();u.resolve(e)});e.map.one(TC.Consts.event.FEATUREINFO,function(e){n.isActive=savedIsActive;if(0==e.featureCount){c();r&&r.close()}u.resolve(e)});savedIsActive=n.isActive;n.isActive=!0;n.beforeGetFeatureInfo({xy:b,control:n});n.wrap.getFeatureInfo(b,{mapSize:[h,h],boundingBox:w})});return u}};TwoDLinkedLegend=function(e){var t=e.map.getControlsByClass(TC.control.Legend)[0];this.refresh=function(){t&&e.map3D.workLayers.length>0&&t.loadGraphics()}};RasterConverter=function(e){this.layerCrs=null;var e=e,t={CRS:["Capability","Layer","CRS"],TILEMATRIXSET:["Contents","TileMatrixSet","Identifier"],TILEMATRIXSETLABELS:["Contents","TileMatrixSet"]},r=function(e,t,n){if(n<t.length-1)return e.hasOwnProperty(t[n])?r(e[t[n]],t,++n):null;if(e instanceof Array){for(var i=[],a=0;a<e.length;a++)e[a].hasOwnProperty(t[n])&&i.push(e[a][t[n]]);return i}return e[t[n]]},n=function(e){return(capsURL=TC.Util.isOnCapabilities(e.url))&&(caps=TC.capabilities[capsURL])?r(caps,t.CRS,0)||r(caps,t.TILEMATRIXSET,0):null},i=function(e,n){if((capsURL=TC.Util.isOnCapabilities(e.url))&&(caps=TC.capabilities[capsURL]))for(var i=r(caps,t.TILEMATRIXSETLABELS,0),a=0;a<i.length;a++)if(i[a].Identifier===n)return r(i[a],["TileMatrix","Identifier"],0);return null},a=function(e){var t=i(e,this.layerCrs),r={url:e.options.urlPattern,layer:e.layerNames,style:"default",format:e.format||e.options.format,tileMatrixSetID:this.layerCrs,tileMatrixLabels:t,tilingScheme:new Cesium.GeographicTilingScheme};e.usesProxy&&(r.proxy={getURL:function(e){return TC.proxify(e)}});return new Cesium.WebMapTileServiceImageryProvider(r)},s=function(e){var t={url:e.url,layers:e.layerNames,parameters:{version:"1.3.0",transparent:!0,format:e.format||e.options.format}};(e.usesProxy||e.usesSSL&&!TC.Util.isSameOrigin(e.url))&&(t.proxy={getURL:function(e){return TC.proxify(e)}});return new Cesium.WebMapServiceImageryProvider(t)};this.isCompatible=function(t){var r=n(t);if(r&&r.length&&e.test(r.join(","))){this.layerCrs=r.join(",").match(e)[0];return!0}return!1};this.convert=function(e){var t;this.isCompatible(e);if(null!=this.layerCrs){switch(!0){case TC.Consts.layerType.WMTS==e.type:t=a.call(this,e);break;case TC.Consts.layerType.WMS==e.type:t=s(e)}if(t){if(void 0!==t.enablePickFeatures){t.enablePickFeatures=!1;t.tcLayer=e}return t}}return null}};FeatureConverter=function(){var e=null,t=function(e,t){e instanceof Array&&(e="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")");var r=Cesium.Color.fromCssColorString(e);return t?r.withAlpha(t):r},r=function(e,t,r){for(var n in t){var i=e[t[n].prop];if(i)if("function"==typeof i){var a=i(r);a&&(t[n].val=a)}else t[n].val=i}},n=function(t){var r;if(1==t.length){var n,i,a,s,o=t[0],l=1e3;n=new Cesium.Cartesian3(o.x-l,o.y,o.z);i=new Cesium.Cartesian3(o.x,o.y-l,o.z);a=new Cesium.Cartesian3(o.x+l,o.y,o.z);s=new Cesium.Cartesian3(o.x,o.y+l,o.z);r=Cesium.Rectangle.fromCartesianArray([n,i,a,s],Cesium.Ellipsoid.WGS84)}else r=Cesium.Rectangle.fromCartesianArray(t,Cesium.Ellipsoid.WGS84);var c=e.camera.getRectangleCameraCoordinates(r),u=Cesium.Cartesian3.distance(c,Cesium.BoundingSphere.fromPoints(t).center),p=e.camera.frustum.getPixelDimensions(e.drawingBufferWidth,e.drawingBufferHeight,u,new Cesium.Cartesian2);p=Math.max(p.x,p.y);return 0==Math.round(p)?1:p},i=function(e){var t;t=e.layer.hasOwnProperty("styles")?e.layer.styles:TC.Defaults.styles;t=void 0==t[e.STYLETYPE]?t["polyline"===e.STYLETYPE?"line":e.STYLETYPE]:t["multipolygon"===e.STYLETYPE?"polygon":e.STYLETYPE];t=$.extend({},t,e.options,e.getStyle());return t},a=function(e){var a={},s=i(e);a.options=function(){var n={},i={color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"}};r(s,i,e);var a;i.color.hasOwnProperty("val")&&(a=i.opacity.hasOwnProperty("val")?t(i.color.val,i.opacity.val):t(i.color.val));n.color=Cesium.ColorGeometryInstanceAttribute.fromColor(a);i.outlineColor.hasOwnProperty("val")&&(a=i.outlineOpacity.hasOwnProperty("val")?t(i.outlineColor.val,i.outlineOpacity.val):t(i.outlineColor.val));n.outlineColor=Cesium.ColorGeometryInstanceAttribute.fromColor(a);i.width.hasOwnProperty("val")&&(n.width=i.width.val);return n};TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon?a.geometryType=function(t,r){for(var i=[],a=[],s=function(t){return new Cesium.GeometryInstance({id:e.id,geometry:new Cesium.PolygonGeometry({polygonHierarchy:t}),attributes:{color:r.color}})},o=function(t){return new Cesium.GeometryInstance({id:e.id+"outLine",geometry:new Cesium.CorridorGeometry({positions:t,width:n(t)*r.width}),attributes:{color:r.outlineColor}})},l=0;l<t.length;l++){for(var c=0;c<t[l].length;c++){var u;if(0==c){a.push(o(t[l][0]));u=new Cesium.PolygonHierarchy(t[l][0])}else{a.push(o(t[l][c]));u.holes.push(new Cesium.PolygonHierarchy(t[l][c]))}}i.push(s(u))}return[new Cesium.GroundPrimitive({geometryInstances:i}),new Cesium.GroundPrimitive({geometryInstances:a})]}:TC.feature.Polygon&&e instanceof TC.feature.Polygon&&(a.geometryType=function(t,r){return[new Cesium.GroundPrimitive({geometryInstances:new Cesium.GeometryInstance({id:e.id,geometry:new Cesium.PolygonGeometry({polygonHierarchy:new Cesium.PolygonHierarchy(t)}),attributes:{color:r.color}})}),new Cesium.GroundPrimitive({geometryInstances:new Cesium.GeometryInstance({id:e.id+"outLine",geometry:new Cesium.CorridorGeometry({positions:t,width:n(t)*r.width}),attributes:{color:r.outlineColor}})})]});return a},s=function(e){var a={},s=i(e);a.options=function(){var n={},i={color:{prop:"strokeColor"},opacity:{prop:"strokeOpacity"},width:{prop:"strokeWidth"}};r(s,i,e);i.width.hasOwnProperty("val")&&(n.width=i.width.val);var a;i.color.hasOwnProperty("val")&&(a=i.opacity.hasOwnProperty("val")?t(i.color.val,i.opacity.val):t(i.color.val));n.color=Cesium.ColorGeometryInstanceAttribute.fromColor(a);return n};TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline?a.geometryType=function(t,r){1==t.length&&(t=t[0]);return new Cesium.GroundPrimitive({geometryInstances:new Cesium.GeometryInstance({id:e.id,geometry:new Cesium.CorridorGeometry({positions:t,width:n(t)*r.width}),attributes:{color:r.color}})})}:TC.feature.Polyline&&e instanceof TC.feature.Polyline&&(a.geometryType=function(t,r){return new Cesium.GroundPrimitive({geometryInstances:new Cesium.GeometryInstance({id:e.id,geometry:new Cesium.CorridorGeometry({positions:t,width:n(t)*r.width}),attributes:{color:r.color}})})});return a},o=function(e){var n={},a=i(e);n.options=function(){var n={},i={rotation:{prop:"angle"},label:{prop:"label"},fontSize:{prop:"fontSize"},fontColor:{prop:"fontColor"},outlineLabelColor:{prop:"labelOutlineColor"},outlineLabelWidth:{prop:"labelOutlineWidth"},anchor:{prop:"anchor"},height:{prop:"height"},width:{prop:"width"},url:{prop:"url"},color:{prop:"fillColor"},opacity:{prop:"fillOpacity"},outlineColor:{prop:"strokeColor"},outlineOpacity:{prop:"strokeOpacity"},outlineWidth:{prop:"strokeWidth"},radius:{prop:"radius"}};r(a,i,e);if(i.anchor.hasOwnProperty("val")){n.url=!i.url.hasOwnProperty("val")&&e.options.url?e.options.url:i.url.val;n.anchor=i.anchor.val}i.height.hasOwnProperty("val")&&(n.height=i.height.val);i.width.hasOwnProperty("val")&&(n.width=i.width.val);i.rotation.hasOwnProperty("val")&&(n.rotation=i.rotation.val);i.label.hasOwnProperty("val")&&(n.label=i.label.val);i.fontSize.hasOwnProperty("val")&&(n.fontSize=i.fontSize.val);i.fontColor.hasOwnProperty("val")&&(n.fontColor=t(i.fontColor.val));i.outlineLabelColor.hasOwnProperty("val")&&(n.outlineLabelColor=t(i.outlineLabelColor.val));i.outlineLabelWidth.hasOwnProperty("val")&&(n.outlineLabelWidth=i.outlineLabelWidth.val);i.color.hasOwnProperty("val")&&(n.color=i.opacity.hasOwnProperty("val")?t(i.color.val,i.opacity.val):t(i.color.val));i.outlineColor.hasOwnProperty("val")&&(n.outlineColor=i.outlineOpacity.hasOwnProperty("val")?t(i.outlineColor.val,i.outlineOpacity.val):t(i.outlineColor.val));i.outlineWidth.hasOwnProperty("val")&&(n.outlineWidth=i.outlineWidth.val);i.radius.hasOwnProperty("val")&&(n.radius=i.radius.val);return n};if(TC.feature.Marker&&e instanceof TC.feature.Marker)n.geometryType=function(t,r){var n={id:e.id,name:e.id,position:t[0],billboard:{image:r.url,width:r.width,height:r.height,eyeOffset:new Cesium.Cartesian3(0,0,-100),pixelOffset:new Cesium.Cartesian2(r.anchor[0],r.anchor[1]),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}};return r.label?[n,{id:e.id,name:e.id,position:t[0],label:{text:r.label,font:"14pt sans-serif",heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BOTTOM,fillColor:r.fontColor,showBackground:!0,eyeOffset:new Cesium.Cartesian3(0,0,-100)}}]:n};else if(TC.feature.Point&&e instanceof TC.feature.Point){var s=new Cesium.PinBuilder;n.geometryType=function(t,r){var n=r.label;return n&&!/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(n)?{id:e.id,name:e.id,position:t[0],label:{text:r.label,font:"14px san-serif Arial",showBackground:!0,eyeOffset:new Cesium.Cartesian3(0,0,-100),heightReference:Cesium.HeightReference.CLAMP_TO_GROUND,horizontalOrigin:Cesium.HorizontalOrigin.LEFT,verticalOrigin:Cesium.VerticalOrigin.BASELINE,fillColor:Cesium.Color.WHITE}}:/^[0-9]*\-{0,1}[a-z]{0,4}$/gi.test(n)?{id:e.id,name:e.id,position:t[0],billboard:{image:s.fromText(n,r.fontColor,48).toDataURL(),eyeOffset:new Cesium.Cartesian3(0,0,-100),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}}:{id:e.id,name:e.id,position:t[0],billboard:{image:s.fromColor(Cesium.Color.fromCssColorString(TC.Cfg.styles.point.fillColor),24).toDataURL(),eyeOffset:new Cesium.Cartesian3(0,0,-100),verticalOrigin:Cesium.VerticalOrigin.BOTTOM,heightReference:Cesium.HeightReference.CLAMP_TO_GROUND}}}}return n};this.convert=function(t,r,n,i){e=t;var l,c,u,p,h,d=[],f=function(e,t){e=TC.Util.reproject(e,n,i);t.push(e.length>2?Cesium.Cartesian3.fromDegrees(e[0],e[1],e[2]):Cesium.Cartesian3.fromDegrees(e[0],e[1]))},m=r.geometry,y=function(e,t){if($.isArray(e))for(var r=0;r<e.length;r++)f(e[r],t)},g=function(e,t){if($.isArray(e))for(var r=0;r<e.length;r++){t.push([]);y(e[r],t[t.length-1])}},v=function(e){if($.isArray(e))for(var t=0;t<e.length;t++){d.push([]);g(e[t],d[d.length-1])}};switch(!0){case TC.feature.MultiPolygon&&r instanceof TC.feature.MultiPolygon:h=m;if($.isArray(h)){v(h);c=a.call(self,r)}break;case TC.feature.Polygon&&r instanceof TC.feature.Polygon||TC.feature.MultiPolyline&&r instanceof TC.feature.MultiPolyline:p=m;if($.isArray(p)){g(p,d);r instanceof TC.feature.Polygon?c=a(r):r instanceof TC.feature.MultiPolyline&&(c=s(r))}break;case TC.feature.Polyline&&r instanceof TC.feature.Polyline:u=m;if($.isArray(u)){y(u,d);c=s(r)}break;case TC.feature.Marker&&r instanceof TC.feature.Marker:u=[m];y(u,d);c=o(r);break;case TC.feature.Point&&r instanceof TC.feature.Point:u=[m];y(u,d);c=o(r)}if(0==d.length)return null;l={id:r.id,attributes:r.data,geometry:c.geometryType(d,c.options()),boundigSphere:Cesium.BoundingSphere.fromPoints(d)};return l}};e.map3D=function(){var e={baseMap:"",baseMaps:[],baseVector:""},t={layers:[],getProperties:function(e){if(e.options&&e.options.hasOwnProperty("4326")){t.layers.push({id:e.id,opts:e.options[4326]});return t.layers[t.layers.length-1].opts}return null},findById:function(e){if(0==this.layers.length)return null;for(var t=0;t<this.layers.length;t++)if(this.layers[t].id.toLowerCase().trim()===e.toLowerCase().trim())return this.layers[t].opts;return null}},r=function(r){var n=this,i=r.baseLayer instanceof TC.layer.Raster;i?null==(crs=s.isCompatible(r.baseLayer))&&null==t.getProperties.call(n,n.map.baseLayer)&&r.toast(n.getLocaleString("threed.baseLayerNoCompatible",{name:r.baseLayer.layerNames})):e.baseVector=r.baseLayer;if(0===e.baseMaps.length)for(var a=0;a<r.baseLayers.length;a++)r.baseLayers[a]instanceof TC.layer.Raster&&!s.isCompatible(r.baseLayers[a])&&null==t.getProperties.call(n,r.baseLayers[a])&&e.baseMaps.push({l:r.baseLayers[a],i:a});e.baseMap=i?r.baseLayer:n.Consts.BLANK_BASE},n=function(t){var r=!1;if(e.baseMaps&&e.baseMaps.length){for(var n=0;n<e.baseMaps.length;n++)for(var i=0;i<t.baseLayers.length;i++)if(t.baseLayers[i]===e.baseMaps[n].l){e.baseMap==t.baseLayers[i]&&(r=!0);t.$events.trigger($.Event(TC.Consts.event.LAYERREMOVE,{layer:t.baseLayers[i]}));t.baseLayers.splice(i,1);break}if(r){t.baseLayer=t.baseLayers[0];t.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:t.baseLayer}))}}},i=function(t){if(e.baseMaps&&e.baseMaps.length)for(var r=0;r<e.baseMaps.length;r++){t.$events.trigger($.Event(TC.Consts.event.LAYERADD,{layer:e.baseMaps[r].l}));t.baseLayers.splice(e.baseMaps[r].i,0,e.baseMaps[r].l)}},s=new RasterConverter(/(EPSG\:?4326)/i),c=new FeatureConverter,h=function(){var e=new $.Deferred;window.Cesium?e.resolve():TC.loadJS(!window.Cesium,[TC.Consts.url.CESIUM],function(){e.resolve()});return e},d=function(){var e=this;if(!TC.Util.detectMobile()){e.viewer.scene.screenSpaceCameraController.enableZoom=!1;var t,r=e.viewer.scene.canvas;t="onwheel"in r?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";r.addEventListener(t,function(t){var r;if(t.deltaY){var n=t.deltaMode;r=n===t.DOM_DELTA_PIXEL?-t.deltaY:n===t.DOM_DELTA_LINE?40*-t.deltaY:120*-t.deltaY}else r=t.detail>0?-120*t.detail:t.wheelDelta;e.map3D.zoomToCartesian.call(e,e.map3D._lastMousePosition,r)},!1);var n=new Cesium.ScreenSpaceEventHandler(e.viewer.scene.canvas);n.setInputAction(function(t){e.map3D._lastMousePosition=t},Cesium.ScreenSpaceEventType.MOUSE_MOVE);n.setInputAction(function(t){e.map3D.zoomToCartesian.call(e,e.map3D._lastMousePosition,t)},Cesium.ScreenSpaceEventType.WHEEL);var i=new Cesium.Cartesian2,a=0;n.setInputAction(function(e){Cesium.Cartesian2.lerp(e.position1,e.position2,.5,i)},Cesium.ScreenSpaceEventType.PINCH_START);n.setInputAction(function(t){var r=t.distance.endPosition.y-t.distance.startPosition.y,n=r/e.viewer.scene.canvas.clientHeight;n=Math.min(n,e.viewer.scene.screenSpaceCameraController.maximumMovementRatio);a=n},Cesium.ScreenSpaceEventType.PINCH_MOVE);n.setInputAction(function(t){e.map3D.zoomToCartesian.call(e,{endPosition:i},a)},Cesium.ScreenSpaceEventType.PINCH_END)}},f=function(e){var t=e;switch(!0){case e instanceof Cesium.GroundPrimitive:this.viewer.scene.groundPrimitives.add(e);break;case e instanceof Object&&e.hasOwnProperty("billboard"):this.viewer.billboardCollection||(this.viewer.billboardCollection=this.viewer.scene.primitives.add(new Cesium.BillboardCollection({scene:this.viewer.scene})));var r=this.viewer.billboardCollection.add({position:e.position,image:e.billboard.image,verticalOrigin:e.billboard.verticalOrigin,heightReference:e.billboard.heightReference});t=r;break;case e instanceof Object:t=this.viewer.entities.add(e)}return t},m=function(e,t,r){e.vector2DFeatures.hasOwnProperty(t)?e.vector2DFeatures[t].push(r):e.vector2DFeatures[t]=[r]},y=[TC.Consts.event.BEFOREBASELAYERCHANGE,TC.Consts.event.BASELAYERCHANGE,TC.Consts.event.LAYERADD,TC.Consts.event.LAYERREMOVE,TC.Consts.event.LAYERVISIBILITY,TC.Consts.event.LAYEROPACITY,TC.Consts.event.LAYERORDER,TC.Consts.event.FEATUREADD,TC.Consts.event.FEATUREREMOVE,TC.Consts.event.FEATURESCLEAR,TC.Consts.event.ZOOM,TC.Consts.event.ZOOMTO],g=function(e){var t=this,r=e.type+".tc";switch(!0){case r==TC.Consts.event.BEFOREBASELAYERCHANGE:t.waiting||(t.waiting=t.map.getLoadingIndicator().addWait());break;case r==TC.Consts.event.BASELAYERCHANGE:t.map3D.setBaseLayer.call(t,e.layer);break;case r==TC.Consts.event.LAYERADD:t.map3D.addLayer.call(t,e.layer);break;case r==TC.Consts.event.LAYERREMOVE:t.map3D.removeLayer.call(t,e.layer);break;case r==TC.Consts.event.LAYERVISIBILITY:t.map3D.setRenderOptionsLayer.call(t,e.layer,{visibility:e.layer.getVisibility()
});break;case r==TC.Consts.event.LAYEROPACITY:t.map3D.setRenderOptionsLayer.call(t,e.layer,{opacity:e.layer.getOpacity()});break;case r==TC.Consts.event.LAYERORDER:for(var n=0;n<t.map3D.workLayers.length;n++)if(t.map3D.workLayers[n].imageryProvider&&t.map3D.workLayers[n].imageryProvider.layers.join(",")===e.layer.names.join(",")){if(e.oldIndex>e.newIndex)for(var i=e.oldIndex-e.newIndex,a=0;i>a;a++)t.viewer.scene.imageryLayers.lower(t.map3D.workLayers[n]);else for(var i=e.newIndex-e.oldIndex,a=0;i>a;a++)t.viewer.scene.imageryLayers.raise(t.map3D.workLayers[n]);t.map3D.workLayers.splice(e.newIndex,0,t.map3D.workLayers.splice(e.oldIndex,1)[0]);break}break;case r==TC.Consts.event.FEATUREADD:t.map3D.addFeature.call(t,e.feature);break;case r==TC.Consts.event.FEATUREREMOVE:if(t.map3D.vector2DFeatures&&t.map3D.vector2DFeatures.hasOwnProperty(e.layer.id)){for(var s=t.map3D.vector2DFeatures[e.layer.id],n=0;n<s.length;n++)t.map3D.removeFeature.call(t,s[n]);delete t.map3D.vector2DFeatures[e.layer.id]}break;case r==TC.Consts.event.FEATURESCLEAR:if(t.map3D.vector2DFeatures&&t.map3D.vector2DFeatures.hasOwnProperty(e.layer.id)){for(var s=t.map3D.vector2DFeatures[e.layer.id],n=0;n<s.length;n++)t.map3D.removeFeature.call(t,s[n]);delete t.map3D.vector2DFeatures[e.layer.id]}break;case r==TC.Consts.event.ZOOM:t.cameraControls&&!t.cameraControls.moving&&t.map3D.flyToMapCoordinates.call(t,t.mapView.getCenter());break;case r==TC.Consts.event.ZOOMTO:if(t.lastZoom&&performance.now()-t.lastZoom<50)return;t.lastZoom=performance.now();var o=TC.Util.reproject(e.extent.slice(0,2),t.map.crs,t.map3D.crs),l=TC.Util.reproject(e.extent.slice(2),t.map.crs,t.map3D.crs),c=Cesium.Rectangle.fromDegrees(o[0],o[1],l[0],l[1]);t.map3D.flyToRectangle.call(t,c)}},v=function(e){for(var t=this,r=0,n=t.map.controls.length;n>r;r++){var i=t.map.controls[r];if(t.ctrlsToMng.indexOf(i)<0)switch(!0){case t.direction.TO_TWO_D==e:i.enable();break;case t.direction.TO_THREE_D==e:i.disable()}}switch(!0){case t.direction.TO_TWO_D==e:$("[data-no-3d]").removeClass(TC.Consts.classes.HIDDEN);t.ctrlsToMng.forEach(function(e){e._$div.removeClass(TC.Consts.classes.THREED)});break;case t.direction.TO_THREE_D==e:$("[data-no-3d]").addClass(TC.Consts.classes.HIDDEN);t.ctrlsToMng.forEach(function(e){e._$div.addClass(TC.Consts.classes.THREED)})}t.map3D.linked2DControls.legend=new TwoDLinkedLegend(t)},C=function(){for(var e=this,t=new $.Deferred,r=[],n=0;n<e.threeDControls.length;n++){var i=e.threeDControls[n];i=i.substr(0,1).toUpperCase()+i.substr(1);var a=e.map.getControlsByClass("TC.control."+i);a&&a.length&&a[0].getLayer?r.push(a[0].getLayer()):a[0].layer?r.push(a[0].layer):a[0].layers&&a[0].layers.forEach(function(e){e instanceof TC.layer.Vector&&r.push(e)})}$.when.apply($,r).then(function(){if(arguments&&arguments.length){e.map3D.vector2DLayers=Array.prototype.slice.call(arguments,0).filter(function(e){return e instanceof TC.layer.Vector});e.map3D.vector2DLayers.forEach(function(t){t.features&&t.features.length&&t.features.forEach(function(t){e.map3D.addFeature.call(e,t)})})}t.resolve()});return t},T=function(e){var t,r,n,i=this,a=200,s=function(e){var t=this,r=new Cesium.Cartesian2(t.viewer.scene.canvas.clientWidth/2,t.viewer.scene.canvas.clientHeight/2);t.map3D.zoomToCartesian.call(t,{endPosition:r},e)};if(e){t=function(e){var t=this;e.stopPropagation&&e.stopPropagation();e.preventDefault&&e.preventDefault();var r=TC.Util.reproject(t.map.options.initialExtent.slice(0,2),t.map.crs,t.map3D.crs),n=TC.Util.reproject(t.map.options.initialExtent.slice(2),t.map.crs,t.map3D.crs),i=Cesium.Rectangle.fromDegrees(r[0],r[1],n[0],n[1]);t.map3D.flyToRectangle.call(t,i,{duration:.1});return!1}.bind(i);r=function(e){s.call(i,a)}.bind(i);n=function(e){s.call(i,-a)}.bind(i);$("."+TC.control.NavBar.prototype.CLASS+"-btn-home").on("click",t);$("."+TC.control.NavBar.prototype.CLASS+"-btn-zoomin").on("click",r);$("."+TC.control.NavBar.prototype.CLASS+"-btn-zoomout").on("click",n)}else{$("."+TC.control.NavBar.prototype.CLASS+"-btn-home").off("click",t);$("."+TC.control.NavBar.prototype.CLASS+"-btn-zoomin").off("click",r);$("."+TC.control.NavBar.prototype.CLASS+"-btn-zoomout").off("click",n)}};return{crs:"EPSG:4326",crsPattern:/(EPSG\:?4326)/i,customRender:null,baseLayer:null,workLayers:[],vector2DLayers:[],vector2DFeatures:{},linked2DControls:{},isLoadingTiles:function(){var e=this,t=e.viewer.scene.globe._surface;return!t._tileProvider.ready||t._tileLoadQueueHigh.length>0||t._tileLoadQueueMedium.length>0||t._tileLoadQueueLow.length>0||t._debug.tilesWaitingForChildren>0},loadTerrainProvider:function(){var e=this;e.terrainProvider||(e.terrainProvider=new Cesium.CesiumTerrainProvider({url:e.Consts.TERRAIN_URL,requestWaterMask:!0,requestVertexNormals:!0}));return e.terrainProvider},loadViewer:function(){var e=this,t=new $.Deferred;e.viewer?t.resolve(e.viewer):h().then(function(){var r=new Cesium.Globe;r.baseColor=Cesium.Color.WHITE;r.enableLighting=!0;e.viewer=e.map3D.viewer=new Cesium.Viewer(e.selectors.divThreedMap,{terrainProvider:e.map3D.loadTerrainProvider.call(e),terrainExaggeration:1,terrainShadows:Cesium.ShadowMode.ENABLED,animation:!1,timeline:!1,fullscreenButton:!1,baseLayerPicker:!1,imageryProvider:!1,navigationInstructionsInitiallyVisible:!1,navigationHelpButton:!1,geocoder:!1,homeButton:!1,infoBox:!1,sceneModePicker:!1,selectionIndicator:!1,globe:r,useDefaultRenderLoop:!e.options.customRender});if(e.options.customRender){e.map3D.customRender=new CustomRender(e.map,e.viewer,e.isSlower);e.map3D.customRender.start(e.options.isDebug||!1);e.map3D.customRender.parent=e}e.viewer.readyPromise=new $.Deferred;e.viewer.scene.backgroundColor=Cesium.Color.WHITE;e.viewer.scene.screenSpaceCameraController.enableCollisionDetection=!0;e.viewer.scene.screenSpaceCameraController.maximumZoomDistance=5e5;e.viewer.scene.globe.depthTestAgainstTerrain=!0;e.viewer.scene.imageryLayers.removeAll();e.viewer.terrainProvider.errorEvent.addEventListener(function(e){if(e.error)switch(e.error.statusCode){case 403:case 404:}},e);e.viewer.scene.renderError.addEventListener(function(e){var t=this;t.$divThreedMap.addClass(t.classes.LOADING);t.map.toast("Error",{type:TC.Consts.msgType.ERROR})},e);e.map3D.tileLoadingHandler=new Cesium.EventHelper;e.map3D.tileLoadingHandler.add(e.viewer.scene.globe.tileLoadProgressEvent,function(t){e.waiting||(e.waiting=e.map.getLoadingIndicator().addWait());if(0===t){e.map.getLoadingIndicator().removeWait(e.waiting);delete e.waiting;e.viewer.readyPromise.resolve();e.$events.trigger(TC.Consts.event.TERRAINLOADED,{})}else e.$events.trigger(TC.Consts.event.TERRAINRECEIVING,{})}.bind(e));d.call(e);T.call(e,!0);$(".cesium-viewer-bottom").remove();e.map3D._event2DHandler=g.bind(e);e.map.on(y.join(" "),e.map3D._event2DHandler);v.call(e,e.direction.TO_THREE_D);C.call(e);t.resolve(e.viewer)});return t},setBaseLayer:function(i){var a=this;if(a.map3D.baseLayer){if(a.map3D.baseLayer!==a.Consts.BLANK_BASE){a.viewer.scene.imageryLayers.raiseToTop(a.map3D.baseLayer);a.viewer.scene.imageryLayers.remove(a.map3D.baseLayer,!0)}if(i instanceof TC.layer.Vector){a.map3D.baseLayer=a.Consts.BLANK_BASE;a.map.getLoadingIndicator().removeWait(a.waiting);delete a.waiting}else{if(null!=(obj=t.findById(i.id))){$.extend(obj,{map:a.map});i=new TC.layer.Raster(obj);i.isBase=!0}a.map3D.addLayer.call(a,i)}}else{r.call(a,a.map);n.call(a,a.map);if(i instanceof TC.layer.Raster){if(i.options.relatedWMTS){a.map.baseLayer=i=a.map.getLayer(i.options.relatedWMTS);a.map.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:a.map.baseLayer}))}else if(null!=(obj=t.findById(a.map.baseLayer.id))){$.extend(obj,{map:a.map});i=new TC.layer.Raster(obj);i.isBase=!0}a.map3D.addLayer.call(a,i)}else a.map3D.baseLayer=a.Consts.BLANK_BASE}e.baseMap=a.map.baseLayer},addLayer:function(e){var t=this;switch(!0){case TC.Consts.layerType.VECTOR==e.type:t.map3D.vector2DLayers.push(e);break;case TC.Consts.layerType.WMTS==e.type:case TC.Consts.layerType.WMS==e.type:if(s.isCompatible(e)){var r=s.convert(e);if(r){var n=t.viewer.scene.imageryLayers.addImageryProvider(r);if(e.isBase){t.map3D.baseLayer=n;t.viewer.scene.imageryLayers.lowerToBottom(n)}else{n.show=e.getVisibility();n.alpha=e.getOpacity();t.map3D.workLayers.push(n);t.map3D.linked2DControls.legend.refresh()}}}else t.map.toast(t.getLocaleString("threed.crsNoCompatible",{name:e.layerNames}))}},removeLayer:function(e){var t=this;switch(!0){case TC.Consts.layerType.VECTOR==e.type:if(t.map3D.vector2DFeatures&&t.map3D.vector2DFeatures.hasOwnProperty(e.id)){for(var r=t.map3D.vector2DFeatures[e.id],n=0;n<r.length;n++)t.map3D.removeFeature.call(t,r[n]);delete t.map3D.vector2DFeatures[e.id]}break;case TC.Consts.layerType.WMTS==e.type:case TC.Consts.layerType.WMS==e.type:for(var n=0;n<t.map3D.workLayers.length;n++)if(e.names&&t.map3D.workLayers[n].imageryProvider.layers.join(",")===e.names.join(",")||e.title&&t.map3D.workLayers[n].imageryProvider.layers.join(",")===e.title){t.viewer.scene.imageryLayers.raiseToTop(t.map3D.workLayers[n]);t.viewer.scene.imageryLayers.remove(t.map3D.workLayers[n],!0);t.map3D.workLayers.splice(n,1);break}}},setRenderOptionsLayer:function(e,t){var r=this;switch(!0){case TC.Consts.layerType.Vector==e.type:if(r.map3D.vector2DFeatures[e.id])for(var n=r.map3D.vector2DFeatures[e.id],i=0;i<n.length;i++)r.map3D.setRenderOptionsFeature(n[i],{show:!n[i].show});break;case TC.Consts.layerType.WMTS==e.type:case TC.Consts.layerType.WMS==e.type:for(var i=0;i<r.map3D.workLayers.length;i++)if(e.names&&r.map3D.workLayers[i].imageryProvider.layers.join(",")===e.names.join(",")||e.title&&r.map3D.workLayers[i].imageryProvider.layers.join(",")===e.title){t.hasOwnProperty("visibility")&&(r.map3D.workLayers[i].show=t.visibility);t.hasOwnProperty("opacity")&&(r.map3D.workLayers[i].alpha=t.opacity);break}}},flyToMapCoordinates:function(e){var t=this,r=TC.Util.reproject(e,t.map.crs,t.map3D.crs),n=t.viewer.camera.positionCartographic.height,i=Cesium.Cartesian3.fromDegrees(r[0],r[1],n),a=t.viewer.camera;a.flyTo({destination:i,orientation:{heading:a.heading,pitch:a.pitch}})},flyToRectangle:function(e,t){var r=this,n=$.Deferred();t=t||{};var i=Cesium.Math.EPSILON3;if(e.east===e.west){e.east+=i;e.west-=i}if(e.north===e.south){e.north+=i;e.south-=i}var a=.2,s=e.width*a/2,o=e.height*a/2;e.east-=s;e.west+=o;e.north+=o;e.south-=o;var l=r.viewer.scene,c=l.camera,u=c.getRectangleCameraCoordinates(e),h=Cesium.Ellipsoid.WGS84.cartesianToCartographic(u),d=l.globe.terrainProvider,f=6,m=[Cesium.Rectangle.center(e)];Cesium.sampleTerrain(d,f,m).then(function(i){var a={longitude:h.longitude,latitude:h.latitude,height:h.height+i[0].height},s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(a);r.$events.one(TC.Consts.event.TERRAINLOADED,function(){var t=c.getRectangleCameraCoordinates(e),i=Cesium.Ellipsoid.WGS84.cartesianToCartographic(t),a=r.viewer.scene.globe.getHeight(i),s={longitude:i.longitude,latitude:i.latitude,height:i.height+a},o=Cesium.Ellipsoid.WGS84.cartographicToCartesian(s);c.flyTo({duration:3,destination:o,complete:function(){var e=Cesium.Math.toRadians(50),t=p(this.viewer.scene);t=Cesium.Matrix4.fromTranslation(t);this.map3D.rotateAroundAxis(this.viewer.scene.camera,-e,this.viewer.scene.camera.right,t,{duration:250,callback:function(){n.resolve()}})}.bind(r)})});c.flyTo({duration:t.duration||1,destination:s,complete:function(){r.map3D.isLoadingTiles.call(r)||r.$events.trigger(TC.Consts.event.TERRAINLOADED,{})}})});return n},zoomToCartesian:function(e,t){var r=this,n=r.viewer.scene;if(!e||!e.endPosition){var i=n.canvas,a=new Cesium.Cartesian2(i.clientWidth/2,i.clientHeight/2);e={endPosition:a}}var s=n.camera.getPickRay(e.endPosition),o=n.globe.pick(s,n);if(o){var l=Cesium.Cartesian3.distance(s.origin,o);if(1>l)return;r.map3D._zoomTo||(r.map3D._zoomTo={amount:0});r.map3D._zoomTo.direction=t>0?1:0;r.map3D._zoomTo.amount+=5*l/100;r.map3D._zoomTo.endPosition=e.endPosition}var c=function(t){var r=this,n=r.viewer.scene,i=n.camera.getPickRay(e.endPosition||t.endPosition),a=n.globe.pick(i,n);if(a){var s=Cesium.Cartesian3.distance(i.origin,a);if(1>s)return;var o=n.camera.position,l=(n.camera.direction,toGo=new Cesium.Cartesian3);Cesium.Cartesian3.multiplyByScalar(i.direction,1==t.direction?t.amount:-t.amount,l);Cesium.Cartesian3.add(o,l,toGo);var c=new Cesium.Ray(toGo,i.direction),u=n.globe.pick(c,n);if(u){var p=function(){this.map3D._zoomTo={direction:1,amount:0,endPosition:{}}};Cesium.Cartesian3.distance(toGo,u)<1||Math.abs(Cesium.Ellipsoid.WGS84.cartesianToCartographic(toGo).height)<n.screenSpaceCameraController.minimumZoomDistance?p.call(r):r.viewer.camera.flyTo({destination:toGo,orientation:{heading:n.camera.heading,pitch:n.camera.pitch,roll:n.camera.roll},duration:1,easingFunction:Cesium.EasingFunction.LINEAR_NONE,complete:function(e){this.map3D._zoomTo={direction:1,amount:0,endPosition:{}}}.bind(r,Cesium.Cartesian3.distance(toGo,u))})}}};setTimeout(function(){c.call(r,r.map3D._zoomTo)}.bind(r),50)},rotateAroundAxis:function(e,t,r,n,i){return l(e,t,r,n,i)},addFeature:function(e,t){var r=this;if(!(r.map3D.linked2DControls.featureInfo&&e.layer===r.map3D.linked2DControls.featureInfo.layer&&e instanceof TC.feature.Marker)&&r.map3D.vector2DLayers.indexOf(e.layer)>-1){var n=c.convert(r.viewer.scene,e,r.map.crs,r.map3D.crs);if(n)if(n.geometry instanceof Array)n.geometry.forEach(function(t){t=f.call(r,t);m(r.map3D,e.layer.id,t)});else{var i=f.call(r,n.geometry);m(r.map3D,e.layer.id,i)}}},removeFeature:function(e){var t=this;if(e){switch(!0){case e instanceof Cesium.GroundPrimitive:t.viewer.scene.groundPrimitives.remove(e);break;case e instanceof Cesium.Billboard:t.viewer.billboardCollection.remove(e);break;case e instanceof Object:t.viewer.entities.removeById(e.id)}t.map3D.customRender.restart()}},setRenderOptionsFeature:function(e,t){e&&(e.show=t.show)},addNativeFeature:function(e){return f.call(this,e)},setCameraFromMapView:function(){var e=this,t=e.mapView.getCenter();if(t){var r=TC.Util.reproject(t,e.map.crs,e.map3D.crs),n=a.call(e,e.mapView.getResolution()||0,Cesium.Math.toRadians(r[0])),r=TC.Util.reproject(t,e.map.crs,e.map3D.crs),i=new Cesium.Cartographic(Cesium.Math.toRadians(r[0]),Cesium.Math.toRadians(r[1]));e.viewer.scene.globe&&(i.height=e.viewer.scene.globe.getHeight(i)||0);var s=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i),o={pitch:Cesium.Math.toRadians(-90),heading:-e.mapView.getRotation(),roll:0};e.viewer.camera.setView({destination:s,orientation:o});e.viewer.camera.moveBackward(n)}},setViewFromCameraView:function(){var e=this;if(!e.setViewFromCameraViewInProgress||"resolved"==e.setViewFromCameraViewInProgress.state()){e.setViewFromCameraViewInProgress=new $.Deferred;{var t=Cesium.Ellipsoid.WGS84,r=e.viewer.scene;target_=u(r)}if(!target_){var n=e.viewer.scene.globe,i=e.viewer.camera.positionCartographic.clone(),a=n.getHeight(i);i.height=a||0;target_=Cesium.Ellipsoid.WGS84.cartographicToCartesian(i)}var s=Cesium.Cartesian3.distance(target_,e.viewer.camera.position),l=t.cartesianToCartographic(target_),c=TC.Util.reproject([Cesium.Math.toDegrees(l.longitude),Cesium.Math.toDegrees(l.latitude)],e.map3D.crs,e.map.crs);e.mapView.setCenter(c);e.mapView.setResolution(o.call(e,s,l?l.latitude:0));e.setViewFromCameraViewInProgress.resolve()}return e.setViewFromCameraViewInProgress},getInfoOnPickedPosition:function(e){var t=this;if(e){t.map.one(TC.Consts.event.DRAWTABLE,function(e){t.map.getLoadingIndicator().removeWait(t.waiting);delete t.waiting});t.map3D.linked2DControls.featureInfo.send.call(t,e).then(function(e){t.map.getLoadingIndicator().removeWait(t.waiting);delete t.waiting})}},destroy:function(){var t=this;t.map3D.customRender.stop();t.map3D.vector2DLayers=[];t.map3D.vector2DFeatures={};t.map.off(y.join(" "),t.map3D._event2DHandler);v.call(t,t.direction.TO_TWO_D);T.call(t,!1);i();t.map.baseLayer=e.baseMap==t.Consts.BLANK_BASE?e.baseVector:e.baseMap;t.map.$events.trigger($.Event(TC.Consts.event.BASELAYERCHANGE,{layer:t.map.baseLayer}));e.baseMap="";t.map3D.baseLayer=null;t.map3D.workLayers=[];t.cameraControls.unbind();t.map3D.linked2DControls.featureInfo&&t.map3D.linked2DControls.featureInfo.clear(t.map);t.map3D.tileLoadingHandler.removeAll();delete t.map3D.tileLoadingHandler}}}();e.browserSupportWebGL=function(){var e=this,t=!1;if(window.WebGLRenderingContext){var r=document.createElement("canvas"),n={alpha:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};try{var i=r.getContext("webgl",n)||r.getContext("experimental-webgl",n)||r.getContext("webkit-3d",n)||r.getContext("moz-webgl",n);if(i)t=!0;else{n.failIfMajorPerformanceCaveat=!1;i=r.getContext("webgl",n)||r.getContext("experimental-webgl",n)||r.getContext("webkit-3d",n)||r.getContext("moz-webgl",n);if(i){t="slow";e.isSlower=!0}else t=!1}}catch(a){console.log(E)}if("slow"===t||!t){var s="slow"===t?"threed.slowSupport.supported":"threed.not.supported";e.map.toast(e.getLocaleString(s),{type:TC.Consts.msgType.WARNING,duration:1e4})}return t}t=!1}}();TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.Consts.BLANK_IMAGE="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAQAIBRAA7";!function(){var e=function(){this.strategy;this.setStrategy=function(e){this.strategy=e};this.query=function(e,t,r,n){return this.strategy.query(e,t,r,n)}},t=function(){this.query=function(e,t,r,i){t.usesSSL=TC.Util.isSecureURL(e);n(e).then(r,function(a,s,o){if(a.status)i(t,s+"]["+o);else{t.usesProxy=!0;n(e,!0).then(function(e){r(e)},function(e,r,n){i(t,r+"]["+n)})}})}},r=function(){var e=function(e){var t=$.Deferred();$.ajax({type:"GET",url:e,dataType:"jsonp",success:function(e){t.resolve(!1)},error:function(e,r,n){t.resolve(e.status&&200===e.status&&"parsererror"!==r?!0:!1)}});return t};this.query=function(t,r,i,a){var s=t.replace(/^(f|ht)tp?:\/\//i,"https://");n(s).then(function(e){r.usesSSL=!0;i(e)},function(o,l,c){o.status?n(t,!0).then(function(e){r.usesProxy=!0;r.usesSSL=!0;i(e)},function(e,t,n){a(r,t+"]["+n)}):TC.isUsingServiceWorker&&TC.isUsingServiceWorker()?n(t,!0).then(function(e){r.usesProxy=!0;r.usesSSL=!1;i(e)},function(e,t,n){a(r,t+"]["+n)}):e(s).then(function(e){e?n(t,!0).then(function(e){r.usesProxy=!0;r.usesSSL=TC.Util.isSecureURL(t);i(e)},function(e,t,n){a(r,t+"]["+n)}):n(t,!0).then(function(e){r.usesProxy=!1;r.usesSSL=!1;i(e)},function(e,t,n){a(r,t+"]["+n)})})})}},n=function(e,t){var r=TC._capabilitiesRequests[e]=!t&&TC._capabilitiesRequests[e]||$.ajax({url:t?TC.proxify(e):e,type:"GET",dataType:a?"text":"xml"});return r},i={},a=window.hasOwnProperty("Worker"),s=$.Deferred();if(a){var o=TC.apiLocation+"TC/workers/tc-caps-web-worker.js";TC.Util.isSameOrigin(TC.apiLocation)?s.resolve(o):$.ajax({url:o,type:"GET",dataType:"text"}).then(function(e){var t=new Blob([e],{type:"text/javascript"}),r=window.URL.createObjectURL(t);s.resolve(r)},function(e){s.reject()})}var l=function(e,t,r){var n=e.url,a=!1,s=i[n];if(s){e._capabilitiesPromise=s;a=!0}else e._capabilitiesPromise=s=i[n]=$.Deferred();s.then(function(t){if(t.error)u(e,t.error);else{e.capabilities=e.capabilities||t;var r=e.getGetMapUrl();TC.capabilities[e.options.url]=TC.capabilities[e.options.url]||t;TC.capabilities[r]=TC.capabilities[r]||t;t.usesProxy&&(e.usesProxy=!0);t.usesSSL&&(e.usesSSL=!0);d(e)}});if(!a){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){localforage.getItem(e.CAPABILITIES_STORE_KEY_PREFIX+n).then(function(t){t&&i[e.url].resolve(t)})});var o,l={};if(e.type===TC.Consts.layerType.WMTS)if(e.options.encoding===TC.Consts.WMTSEncoding.RESTFUL){var p="/1.0.0/WMTSCapabilities.xml";if(n.indexOf(p)<n.length-p.length){"/"===n[n.length-1]&&(p=p.substr(1));o=n+p}else o=n}else{o=n;l.SERVICE="WMTS";l.VERSION="1.0.0";l.REQUEST="GetCapabilities"}else{o=n;l.SERVICE="WMS";l.VERSION="1.3.0";l.REQUEST="GetCapabilities"}o=o+"?"+$.param(l);TC._capabilitiesRequests=TC._capabilitiesRequests||{};TC.isUsingServiceWorker=null;if(!TC.isUsingServiceWorker){var h=e.map||$("#map").data("map"),f=h?h.getControlsByClass("TC.control.SWCacheClient"):null;TC.isUsingServiceWorker=f&&f.length>0?function(){return"pending"!==f[0].getServiceWorker().state()?f[0].serviceWorkerEnabled:!1}:function(){return!1}}c(o,e,t,r)}},c=function(n,i,a,s){var o=new e,l=function(e){a(i,e)};o.setStrategy(TC.Util.isSecureURL(document.location.href)&&!TC.Util.isSecureURL(n)?new r:new t);o.query(n,i,l,s)},u=function(e,t){var r="No se pudo obtener el documento de capacidades de servicio "+e.url+": ["+t+"]";e._capabilitiesPromise.reject(r);TC.error(r);e.map&&e.map.$events.trigger($.Event(TC.Consts.event.LAYERERROR,{layer:e,reason:"couldNotGetCapabilities"}));e.wrap.setLayer(null)},p=function(e,t){TC.loadJS(!window.localforage,[TC.Consts.url.LOCALFORAGE],function(){var r=e.CAPABILITIES_STORE_KEY_PREFIX+e.options.url,n=function(){localforage.setItem(r,t)};e.map?e.map.loaded(n):n()})},h=function(e,t){var r;if(t.documentElement){if($(t).find("ServiceException").length>0)r={error:$(t).find("ServiceException").text()};else{var n=e.type===TC.Consts.layerType.WMTS?new e.wrap.WmtsParser:new e.wrap.WmsParser;r=n.read(t);e.type===TC.Consts.layerType.WMTS&&r.Contents&&r.Contents.Layer&&$("Layer",t).each(function(e,t){var n=TC.Util.getElementByNodeName(t,"ows:Identifier")[0],i=n.firstChild.data,a=$(t),s=r.Contents.Layer.filter(function(e){return e.Identifier==i});if(s.length){s=s[0];for(var o=0;o<s.TileMatrixSetLink.length;o++){var l=s.TileMatrixSetLink[o];matrixId=l.TileMatrixSet;xmlLink=a.find("TileMatrixSetLink").each(function(e,t){return $(t).find("TileMatrixSet:first").text()==matrixId});if(xmlLink.length){xmlLink=xmlLink[0];l.TileMatrixSetLimits=[];$(xmlLink).find("TileMatrixLimits").each(function(e,t){var r=$(t);l.TileMatrixSetLimits.push({TileMatrix:r.find("TileMatrix").text(),MinTileRow:parseInt(r.find("MinTileRow").text()),MinTileCol:parseInt(r.find("MinTileCol").text()),MaxTileRow:parseInt(r.find("MaxTileRow").text()),MaxTileCol:parseInt(r.find("MaxTileCol").text())})})}}}})}e.usesProxy&&(r.usesProxy=!0);i[e.url].resolve(r);p(e,r)}else if(a&&"string"==typeof t)s.then(function(n){var a=new Worker(n);a.onmessage=function(t){r="success"===t.data.state?t.data.capabilities:{error:"Web worker error"};e.usesProxy&&(r.usesProxy=!0);e.usesSSL&&(r.usesSSL=!0);i[e.url].resolve(r);a.terminate();p(e,r)};a.postMessage({type:e.type,text:t})});else{r=t;e.usesProxy&&(r.usesProxy=!0);i[e.url].resolve(r)}},d=function(e){var t;if(!e.wrap.layer){switch(e.type){case TC.Consts.layerType.GROUP:break;case TC.Consts.layerType.WMTS:t=m(e);break;default:t=f(e)}e.wrap.setLayer(t)}},f=function(e){var t=$.isArray(e.names)?e.names.join(","):e.names,r=e.options.format,n=e.options,i={LAYERS:t,FORMAT:r,TRANSPARENT:e.transparent,VERSION:e.capabilities.version||"1.3.0"};e.params&&$.extend(i,e.params);var a=e.getPreferredInfoFormat();null!==a&&(i.INFO_FORMAT=a);return e.wrap.createWmsLayer(e.url,i,n)},m=function(e){return e.wrap.createWmtsLayer(e.options.matrixSet,e.names[0],e.options)},y=function P(e,t){var r=$.inArray(t.name,e.availableNames);if(-1===r)for(var n=0,i=t.children.length;i>n;n++){r=P(e,t.children[n]);if(-1!==r)break}return r},g=function _(e,t){var r=function(t,r){return y(e,r)-y(e,t)};t.children.sort(r);for(var n=0,i=t.children.length;i>n;n++)_(e,t.children[n])},v=function N(e,t,r){var n=!1;r.count=r.count+1;if(e.name===t)n=!0;else for(var i=e.children.length-1;i>=0;i--)if(N(e.children[i],t,r)){n=!0;break}return n};TC.layer.Raster=function(){var e=this;this._capabilitiesPromise=null;TC.Layer.apply(e,arguments);e.wrap=new TC.wrap.layer.Raster(e);e.transparent=e.options.transparent===!1?!1:!0;e.url=e.options.url;e.params=e.options.params;if("string"==typeof e.options.layerNames)e.names=e.availableNames=e.options.layerNames.split(",");else{e.names=[];e.availableNames=[];if($.isArray(e.options.layerNames))for(var t=0;t<e.options.layerNames.length;t++){var r=e.options.layerNames[t];if("string"==typeof r){e.names.push(r);e.availableNames.push(r)}else if(r.hasOwnProperty("name")){e.availableNames.push(r.name);(void 0===r.isVisible||r.isVisible)&&e.names.push(r.name)}}else{var n=e.options.params?e.options.params.sld_body:null;if(n){var i=$.parseXML(n),a=TC.Util.getElementByNodeName(i,"sld:NamedLayer");if(a&&a.length>0){var s=TC.Util.getElementByNodeName(a[0],"sld:Name");if(s&&s.length>0){var r=$(s[0]).text();e.names.push(r);e.availableNames.push(r)}}}}}e.ignorePrefixes=void 0===e.options.ignorePrefixes?!0:e.options.ignorePrefixes;e._capabilitiesNodes={};l(e,h,u);e._disgregatedLayerNames=null;TC.Consts.layerType.WMTS==e.type&&e.wrap.setWMTSUrl()};TC.inherit(TC.layer.Raster,TC.Layer);TC.layer.Raster.prototype.CAPABILITIES_STORE_KEY_PREFIX="TC.capabilities.";TC.layer.Raster.prototype.setVisibility=function(e){var t=this;t.tree=null;t._cache.visibilityStates={};TC.Layer.prototype.setVisibility.call(t,e)};var C=function(e){var t=e.layerNames,r=e.matrixSet,n=e.capabilities,i=[],a=n.Contents.TileMatrixSet.filter(function(e){return e.Identifier==r});if(a.length){a=a[0];var s=n.Contents.Layer.filter(function(e){return e.Identifier==t})[0];if(s.TileMatrixSetLink&&s.TileMatrixSetLink.length&&s.TileMatrixSetLink[0].TileMatrixSetLimits){for(var o,l=s.TileMatrixSetLink[0].TileMatrixSetLimits,c=0;c<l.length;c++){o=l[c];var u=a.TileMatrix.filter(function(e){return e.Identifier==o.TileMatrix});if(u.length){var p=$.extend({matrixIndex:a.TileMatrix.indexOf(u[0])},u[0],o);i.push(p)}}return i}return a.TileMatrix}return null},T=function(e,t){if(e.type!==TC.Consts.layerType.WMS)return t;var r=t.slice();L(e,r,e.wrap.getRootLayerNode());return r},L=function M(e,t,r){var n=!1,i=e.wrap.getLayerNodes(r);if(i.length){for(var a=0,s=i.length;s>a;a++)M(e,t,i[a])&&(n=!0);var o,l,c=$.map(i,function(t){return e.wrap.getName(t)}).reverse(),u=!1;l=o=$.inArray(c[0],t);if(0>o)u=!0;else for(var a=1,s=c.length;s>a;a++)if(c[a]!=t[++o]){u=!0;break}if(!u){var p=e.wrap.getName(r);if(p&&c.length>1){t.splice(l,c.length,p);n=!0}}}return n},w=function(e,t){for(var r=[],n=t.slice(),i=e.wrap.getRootLayerNode(),a=0,s=n.length;s>a;a++)r=r.concat(b(e,n[a],i));return r},b=function k(e,t,r,n){for(var i=[],a=e.wrap.getName(r),s=e.compareNames(t,a),o=!1,l=e.wrap.getLayerNodes(r),c=0;c<l.length;c++){var u=k(e,t,l[c],n||s);u.length?i=i.concat(u):o=!0}(!l.length||o)&&(n||s)&&(i=[a]);return i},S=function(e){return $.extend({aggregate:!0,lazy:!1},e)},E=function(e,t,r){var n,i,a,s=[];n=e?e:[];i=t?t:[];a=r?r:[];for(var o=n.concat(i),l=0;l<o.length;l++)$.inArray(o[l],o)===l&&-1===$.inArray(o[l],a)&&(s[s.length]=o[l]);return s},O=function(e,t){var r="string"==typeof t?t.split(","):t;if(e.capabilities){var n=e.getTree();r.sort(function(e,t){var r={count:0},i={count:0};v(n,e,r);v(n,t,i);return r.count-i.count})}return r},A=function(e,t,r,n){return $.grep(r,function(r){return e.compareNames(t,r,n)}).length>0};TC.layer.Raster.prototype.getLimitedMatrixSet=function(){return C(this)};TC.layer.Raster.prototype.setLayerNames=function(e,t){var r=this,n=new $.Deferred;$.when(r.wrap.getLayer()).then(function(){var i=$.isArray(e)?e:e.split(",");r.names=i;var a=S(t);a.aggregate&&(i=T(r,i));r._disgregatedLayerNames=null;var s={LAYERS:i.join(","),TRANSPARENT:!0};i.length||r.setVisibility(!1);if(a.lazy){var o=r._newParams||r.wrap.getParams();r._newParams=$.extend(o,s)}else{r.map&&r.map.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATEPARAMS,{layer:r}));r.tree=null;r._cache.visibilityStates={};r.wrap.setParams(s);(a.reset||!r.map)&&(r.availableNames=r.names);r.map&&r.map.$events.trigger($.Event(TC.Consts.event.UPDATEPARAMS,{layer:r}))}n.resolve(r.names)});return n};TC.layer.Raster.prototype.addLayerNames=function(e,t){var r=this,n=new $.Deferred;$.when(r.wrap.getLayer()).then(function(){var i=S(t),a=$.isArray(e)?e:e.split(","),s=r.wrap.getParams().LAYERS;if(i.aggregate){a=w(r,a);s=r.getDisgregatedLayerNames()}$.when(r.setLayerNames(O(r,E(s,a,null)),t)).then(function(e){n.resolve(e)})});return n};TC.layer.Raster.prototype.removeLayerNames=function(e,t){var r=this,n=new $.Deferred;$.when(r.wrap.getLayer()).then(function(){var i=S(t),a=$.isArray(e)?e:e.split(","),s=r.wrap.getParams().LAYERS;if(i.aggregate){a=w(r,a);s=r.getDisgregatedLayerNames()}$.when(r.setLayerNames(O(r,E(s,null,a)),t)).then(function(e){n.resolve(e)})});return n};TC.layer.Raster.prototype.toggleLayerNames=function(e,t){var r=this,n=new $.Deferred;$.when(r.wrap.getLayer()).then(function(){var i=S(t),a=$.isArray(e)?e:e.split(","),s=r.wrap.getParams().LAYERS;if(i.aggregate){a=w(r,a);s=r.getDisgregatedLayerNames()}for(var o=[],l=[],c=0;c<a.length;c++){var u=a[c];$.inArray(u,s)<0?o[o.length]=u:l[l.length]=u}var p=[];o.length>0&&p.push(r.addLayerNames(o,i));l.length>0&&p.push(r.removeLayerNames(l,i));$.when.apply(this,p).then(function(e,t){n.resolve(e?t?e.concat(t):e:[])})});return n};TC.layer.Raster.prototype.getDisgregatedLayerNames=function(){var e=this,t=e.wrap.getLayer();if(e.wrap.isNative(t)&&e.type===TC.Consts.layerType.WMS){if(!e._disgregatedLayerNames){var r=e.wrap.getParams().LAYERS;r=$.isArray(r)?r:r.split(",");e._disgregatedLayerNames=w(e,r)}}else e._disgregatedLayerNames=e.names;return e._disgregatedLayerNames.slice()};TC.layer.Raster.prototype.isValidFromNames=function(){for(var e=this,t=!0,r=0,n=e.names.length;n>r;r++)if(!e.getLayerNodeByName(e.names[r])){t=!1;break}return t};TC.layer.Raster.prototype.isCompatible=function(e){var t=this,r=!1;switch(t.type){case TC.Consts.layerType.WMTS:case TC.Consts.layerType.WMS:r=t.wrap.isCompatible(e)}return r};TC.layer.Raster.prototype.isVisibleByScale=function(e,t){var r,n,i,a=this,s=function(){return a.map.wrap.getResolution()/28e-5};switch(a.type){case TC.Consts.layerType.WMTS:r=!1;var o=a.wrap.getTileMatrix(a.options.matrixSet);if(o){n=s();for(i=0;i<o.length;i++){var l=a.wrap.getScaleDenominators(o[i]);if(l[0]===n){r=!0;break}}}break;case TC.Consts.layerType.WMS:r=!0;var c=a.wrap.getAllLayerNodes();if(c.length>0){n=s();var u;if("number"==typeof e)u=a._capabilitiesNodes[e];else for(i=0;i<c.length;i++){var p=c[i];if(a.compareNames(a.wrap.getName(p),e,t)){u=p;break}}if(u){var l=a.wrap.getScaleDenominators(u);r=!(parseFloat(l[1])>n||parseFloat(l[0])<n)}}break;default:r=!0}return r};TC.layer.Raster.prototype.isVisibleByName=function(e,t){var r=this,n=!1;switch(r.type){case TC.Consts.layerType.WMTS:if(r.wrap.getWMTSLayer()){n=!0;break}break;case TC.Consts.layerType.WMS:var i=function(e){return a(e,r.wrap.getRootLayerNode())},a=function l(e,n){var i=null,a=r.wrap.getName(n);if(r.compareNames(a,e,t))i=[a];else for(var s=r.wrap.getLayerNodes(n),o=0;o<s.length;o++){var c=s[o],u=l(e,c);if(u){TC.Util.fastUnshift(u,a);i=u;break}}return i},s=i(e);if(s)for(var o=0;o<s.length;o++)if(A(r,s[o],r.names)){n=!0;break}break;default:n=!0}return n};TC.layer.Raster.prototype.getTree=function(){var e=this,t=e.tree,r=function(t,r){e.options.inverseTree?TC.Util.fastUnshift(t.children,r):t.children[t.children.length]=r};if(!t){var n,i=function o(t,i,a){var s;for(var l in e._capabilitiesNodes)if(e._capabilitiesNodes[l]===t){s=l;break}if(!s){s=TC.getUID();e._capabilitiesNodes[s]=t}var c={name:e.wrap.getName(t),title:t.title||t.Title,uid:s,children:[]};a&&(n=c);A(e,c.name,e.availableNames)&&(i=!0);if(e.options.isBase){c.name=e.names.join(",");c.title=e.title||c.title;c.isBase=e.isDefault;e.options.thumbnail&&(c.legend={src:e.options.thumbnail})}else{c.isVisible=c===n?e.getVisibility():e.isVisibleByName(c.name);var u,p=e.wrap.getLayerNodes(t);for(u=0;u<p.length;u++){var h=o(p[u],i);h&&r(c,h)}c.legend=e.wrap.getLegend(t);if(!i&&!a){n.children=n.children.concat(c.children);c=null}}return c};switch(e.type){case TC.Consts.layerType.WMTS:t=i(e.wrap.getWMTSLayer(),!e.options.hideTree,!0);break;case TC.Consts.layerType.WMS:if(e.capabilities){t=i(e.wrap.getRootLayerNode(),!e.options.hideTree,!0);var a=e._cache.visibilityStates,s=function l(e){var t=TC.Consts.visibility.NOT_VISIBLE;if(e){if(void 0!==a[e.uid])t=a[e.uid];else{if(e.children)for(var r=!1,n=!1,i=0,s=e.children.length;s>i;i++){var o=l(e.children[i]);switch(o){case TC.Consts.visibility.VISIBLE:r=!0;break;case TC.Consts.visibility.NOT_VISIBLE:n=!0;

break;case TC.Consts.visibility.HAS_VISIBLE:r=!0;n=!0}r&&(t=n?TC.Consts.visibility.HAS_VISIBLE:TC.Consts.visibility.VISIBLE)}e.isVisible&&(t=TC.Consts.visibility.VISIBLE);a[e.uid]=t}e.visibilityState=t}return t};s(t);e.options.hideTree&&g(e,t)}}t||(t={name:e.name,title:e.title});t.title=e.title||t.title;e.tree=t}return t};TC.layer.Raster.prototype.setNodeVisibility=function(e,t){var r=this;r.tree||(r.tree=r.getTree());var n=function s(e){var t=[];if(e.name)t[0]=e.name;else for(var r=0;r<e.children.length;r++)t=t.concat(s(e.children[r]));return t},i=r.findNode(e,r.tree);if(i===r.tree)t&&0===r.names.length?r.addLayerNames(r.availableNames).then(function(){r.setVisibility(!0)}):r.setVisibility(t);else{var a=n(i);t?r.addLayerNames(a):r.removeLayerNames(a)}};TC.layer.Raster.prototype.getNodeVisibility=function(e){var t=this;t.tree||(t.tree=t.getTree());return t._cache.visibilityStates[e]};TC.layer.Raster.prototype.getNodePath=function(e,t){var r=this,n=[];if(r.type===TC.Consts.layerType.WMS&&r.capabilities){e=e||r.names[0];var i=function a(n){var i=[],s=r.wrap.getName(n);if(r.compareNames(s,e,t))i.push(n);else for(var o=r.wrap.getLayerNodes(n),l=0;l<o.length;l++){var c=a(o[l]);if(c.length){i=c;TC.Util.fastUnshift(i,n);break}}return i};n=i(r.wrap.getRootLayerNode())}return n};TC.layer.Raster.prototype.getPath=function(e,t){return $.map(this.getNodePath(e,t),function(e){return e.title||e.Title})};TC.layer.Raster.prototype.getLayerNodeByName=function(e){for(var t=null,r=this,n=r.wrap.getServiceType()===TC.Consts.layerType.WMTS?r.wrap.getIdentifier:r.wrap.getName,i=r.wrap.getAllLayerNodes(),a=0,s=i.length;s>a;a++)if(r.compareNames(n(i[a]),e)){t=i[a];break}return t};TC.layer.Raster.prototype.getChildrenLayers=function(e){var t=[],r=function(e,t){if(e&&e.Layer&&e.Layer.length)for(var n=0;n<e.Layer.length;n++){t[t.length]=e.Layer[n];r(e.Layer[n],t)}};r(e,t);return t};TC.layer.Raster.prototype.compareNames=function(e,t,r){var n=e===t,i=this,a=void 0!==r?r:i.ignorePrefixes;if(!n&&a&&e&&t){var s=e.indexOf(":"),o=t.indexOf(":");s>=0&&0>o?n=e.substr(s+1)===t:o>=0&&0>s&&(n=e===t.substr(o+1))}return n};TC.layer.Raster.prototype.getCapabilitiesPromise=function(){return this._capabilitiesPromise};TC.layer.Raster.prototype.getResolutions=function(){return this.wrap.getResolutions()};TC.layer.Raster.prototype.searchSubLayers=function(e){this.patternFn||(this.patternFn=function(e){e=e.replace(/[^a-z\u00e1\u00e9\u00ed\u00f3\u00fa\u00fc\u00f1 ]/gi,"\\$&");e=e.replace(/(a|\u00e1)/gi,"(a|\xe1)");e=e.replace(/(e|\u00e9)/gi,"(e|\xe9)");e=e.replace(/(i|\u00ed)/gi,"(i|\xed)");e=e.replace(/(o|\u00f3)/gi,"(o|\xf3)");e=e.replace(/(u|\u00fa|\u00fc)/gi,"(u|\xfa|\xfc)");e=e.replace(/(n|\u00f1)/gi,"(n|\xf1)");return e});if(e&&e.length&&e.length>=3){var t=this,r=null;if(this.lastPattern&&e.indexOf(this.lastPattern)>=0)r=this.lastMatches;else if(t.availableNames&&t.availableNames.length>0){r=[];for(var n=0;n<t.availableNames.length;n++){var i=t.getLayerNodeByName(t.availableNames[n]);if(i){r[r.length]=i;r=r.concat(t.getChildrenLayers(i))}}}else r=t.wrap.getAllLayerNodes();var a=this.patternFn(e),s=new RegExp(a,"i"),o=r.map(function(e,r){delete e.tcScore;e.tcPosition=r;t.wrap.normalizeLayerNode(e);var n=e.Title.trim(),i=s.exec(n),a=i?i.index:-1,o=-1;if(e.Abstract){var l=e.Abstract.trim(),c=s.exec(l);o=c?c.index:-1}i&&n==i[0]?e.tcScore=20:0==a?e.tcScore=15:a>-1?e.tcScore=10:0==o?e.tcScore=5:o>-1&&(e.tcScore=1);return e.tcScore?e:null}).filter(function(e){return null!=e}).sort(function(e,t){if(t.tcScore===e.tcScore){var r=TC.Util.replaceAccent(e.Title),n=TC.Util.replaceAccent(t.Title);return n>r?-1:r>n?1:0}return t.tcScore-e.tcScore});this.lastPattern=e;this.lastMatches=o;return o}return[]};var x=function(e){var t=e;if(e){var r=e.match(/\??SERVICE=\w+&/i);r&&(t=t.replace(r[0],""))}return t};TC.layer.Raster.prototype.getGetMapUrl=function(){return x(this.wrap.getGetMapUrl())};TC.layer.Raster.prototype.getPreferredInfoFormat=function(){for(var e=this,t=null,r=e.wrap.getInfoFormats(),n=0;n<TC.wrap.layer.Raster.infoFormatPreference.length;n++){var i=TC.wrap.layer.Raster.infoFormatPreference[n];if($.inArray(i,r)>=0){t=i;break}}return t};TC.layer.Raster.prototype.getLegendGraphicImage=function(){var e=this,t=$.Deferred();if(e.options.params.base64LegendSrc)return t.resolve(e.options.params.base64LegendSrc);if("function"==typeof window.btoa){for(var r=e.names[0],n=e.wrap.getInfo(r),i=new XMLHttpRequest,a=n.legend[0].src.split("?"),s=a[1].split("&"),o=e.options.params.sld_body?"sld_body="+e.options.params.sld_body:"",l=0;l<s.length;l++){var c=s[l].split("=");c&&c.length>1&&c[1]&&(o+="&"+s[l])}e.options.params.env&&(o+="&"+e.options.params.env);i.open("POST",a[0],!0);i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.responseType="arraybuffer";i.onload=function(r){if(200===this.status){for(var n=new Uint8Array(this.response),a=n.length,s=new Array(a);a--;)s[a]=String.fromCharCode(n[a]);var o=s.join(""),l=i.getResponseHeader("content-type");if(0===l.indexOf("image")){var c;c="data:"+l+";base64,"+window.btoa(o);e.options.params.base64LegendSrc=c;t.resolve(c)}}};i.send(o)}else t.reject("Funci\xf3n window.btoa no soportada por el navegador");return t.promise()}}();var esriParser={parse:function(e){var t=[],r=(new DOMParser).parseFromString(e,"text/xml");if("FeatureInfoResponse"===r.documentElement.tagName)for(var n=r.documentElement.getElementsByTagName("FeatureInfoCollection"),i=0,a=n.length;a>i;i++)for(var s=n[i],o=s.getAttribute("layername"),l=s.getElementsByTagName("FeatureInfo"),c=0,u=l.length;u>c;c++){for(var p=l[c].getElementsByTagName("Field"),h={},d=0,f=p.length;f>d;d++){var m=p[d];h[getElementText(m.getElementsByTagName("FieldName")[0])]=getElementText(m.getElementsByTagName("FieldValue")[0])}var y=new ol.Feature(h);y.setId(o+"."+TC.getUID());t[t.length]=y}return t}};TC.layer.Raster.prototype.getWFSCapabilitiesPromise=function(){"undefined"==typeof WFSCapabilities&&TC.syncLoadJS(TC.apiLocation+"TC/layer/WFSCapabilitiesParser");var e=this.options.url.replace(/service=wms/i,"service=wfs").replace(/\/wms(\/|\?|\b)/i,"$'/wfs/"),t=$.Deferred(),r=e.substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.WFScapabilities[r]){setTimeout(function(){t.resolve(TC.WFScapabilities[r])},100);return t}var n={};n.SERVICE="WFS";n.VERSION="2.0.0";n.REQUEST="GetCapabilities";$.ajax({url:this.usesProxy?TC.proxify(e+"?"+$.param(n)):this.usesSSL?e.replace(/^(f|ht)tp?:\/\//i,"https://")+"?"+$.param(n):e+"?"+$.param(n),type:"GET"}).then(function(){var e,n;n=jQuery.isXMLDoc(arguments[0])?arguments[0]:(new DOMParser).parseFromString(arguments[0],"text/xml");var i=$(n).find("ServiceException");0===i.length&&(i=$(n).find("ExceptionText"));if(i.length>0)t.reject(null,"error",i.html());else{try{e=WFSCapabilities.Parse(n)}catch(a){t.reject(a);return}if(e.Operations){var s=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.WFScapabilities[s]=e;TC.WFScapabilities[r]=e;t.resolve(e)}else t.reject(null)}},function(e,r,n){t.reject(e,r,n)});return t};TC.layer=TC.layer||{};TC.Layer||TC.syncLoadJS(TC.apiLocation+"TC/Layer");TC.layer.Vector=function(){var e=this;TC.Layer.apply(e,arguments);e.type=e.options.type||TC.Consts.layerType.VECTOR;e.features=[];e.selectedFeatures=[];var t=function(e){var t=e.indexOf("?");if(t>=0)e=e.substr(0,t);else{t=e.indexOf("#");t>=0&&(e=e.substr(0,t))}return".kml"===e.substr(e.length-4).toLowerCase()};if(e.url&&(t(e.url)||e.type===TC.Consts.layerType.KML)){e.type=TC.Consts.layerType.KML;var r=function(e){for(var t=e,r=new RegExp("([^/]+.kml)","i"),n=0;3>n;n++){e=decodeURIComponent(e);var i=r.exec(e);if(i.length>1){t=i[1];break}}return t};e.title=e.options.title||r(e.url)}e.wrap=new TC.wrap.layer.Vector(e);var n=e.wrap.createVectorLayer();e.wrap.setLayer(n)};TC.inherit(TC.layer.Vector,TC.Layer);!function(){var e=TC.layer.Vector.prototype;e.getTree=function(){var e=this,t=null;if(!e.options.stealth){t={};t.children=[];for(var r=0;r<e.features.length;r++){var n=e.features[r].getPath();if(n.length){var i=TC.Util.addArrayToTree(n,t);i&&(i.legend=e.features[r].getLegend())}}t.name=e.name||t.name;t.title=e.title||t.title;t.uid=e.id}return t};var t=function(e,t,r,n){var i=new $.Deferred;$.when(t.call(e,[r],n)).then(function(t){i.resolve(t[0]);e.map.$events.trigger($.Event(TC.Consts.event.FEATUREADD,{layer:e,feature:t[0]}))});return i},r=function(e,t,r,n,i){var a=new $.Deferred,s=e.options.styles&&e.options.styles[n]||TC.Cfg.styles[n],o=$.extend(!0,{},s,i);TC.loadJS(!TC.feature||TC.feature&&!TC.feature[r],[TC.apiLocation+"TC/feature/"+r],function(){for(var n=TC.feature[r],i=new Array(t.length),s=[],l=0,c=t.length;c>l;l++){var u,p=t[l];if(p instanceof n){u=p;u.layer=e}else{o.layer=e;u=new n(p,o)}i[l]=u;e.features[e.features.length]=u;u.wrap.isNative(p)||(s[s.length]=u.wrap.feature);u.options.showPopup&&u.showPopup()}s.length&&e.wrap.addFeatures(s);a.resolve(i)});return a};e.addPoint=function(e,r){return t(this,this.addPoints,e,r)};e.addPoints=function(e,t){return r(this,e,"Point",TC.Consts.geom.POINT,t)};e.addMarker=function(e,r){return t(this,this.addMarkers,e,r)};e.addMarkers=function(e,t){return r(this,e,"Marker","marker",t)};e.addPolyline=function(e,r){return t(this,this.addPolylines,e,r)};e.addPolylines=function(e,t){return r(this,e,"Polyline",TC.Consts.geom.POLYLINE,t)};e.addMultiPolyline=function(e,r){return t(this,this.addMultiPolylines,e,r)};e.addMultiPolylines=function(e,t){return r(this,e,"MultiPolyline",TC.Consts.geom.POLYLINE,t)};e.addPolygon=function(e,r){return t(this,this.addPolygons,e,r)};e.addPolygons=function(e,t){return r(this,e,"Polygon",TC.Consts.geom.POLYGON,t)};e.addMultiPolygon=function(e,r){return t(this,this.addMultiPolygons,e,r)};e.addMultiPolygons=function(e,t){return r(this,e,"MultiPolygon",TC.Consts.geom.POLYGON,t)};e.addCircle=function(e,r){return t(this,this.addCircles,e,r)};e.addCircles=function(e,t){return r(this,e,"Circle",TC.Consts.geom.POLYGON,t)};e.addFeature=function(e){var t,r=this;TC.feature&&(TC.feature.Point&&e instanceof TC.feature.Point?t=r.addPoint(e):TC.feature.Polyline&&e instanceof TC.feature.Polyline?t=r.addPolyline(e):TC.feature.Polygon&&e instanceof TC.feature.Polygon?t=r.addPolygon(e):TC.feature.MultiPolygon&&e instanceof TC.feature.MultiPolygon?t=r.addMultiPolygon(e):TC.feature.MultiPolyline&&e instanceof TC.feature.MultiPolyline?t=r.addMultiPolyline(e):TC.feature.Circle&&e instanceof TC.feature.Circle&&(t=r.addCircle(e)));return t};e.removeFeature=function(e){this.wrap.removeFeature(e)};e.getFeatureById=function(e){var t=null,r=this.wrap.getFeatureById(e);r&&(t=r._wrap.parent);return t};e.clearFeatures=function(){var e=this;if(e.features&&e.wrap){e.features.length=0;e.wrap.clearFeatures()}};e.describeFeatureType=function(e,t){var r=this,n=$.Deferred();$.ajax({url:r.wrap.getDescribeFeatureTypeUrl(),type:"GET",dataType:"xml"}).then(function(e){var t="http://www.w3.org/2001/XMLSchema",r=e.getElementsByTagNameNS(t,"complexType")[0];if(r){for(var i=r.getElementsByTagNameNS(t,"element"),a=new Array(i.length),s=0,o=i.length;o>s;s++){var l=i[s];a[s]={name:l.getAttribute("name"),type:l.getAttribute("type"),nillable:"true"===l.getAttribute("nillable")?!0:!1,minOccurs:parseInt(l.getAttribute("minOccurs")),maxOccurs:parseInt(l.getAttribute("maxOccurs"))}}n.resolve(a)}else{var c=e.getElementsByTagName("Exception")[0];c&&n.reject(c.getElementsByTagName("ExceptionText")[0].innerHTML)}},function(e,t,r){n.reject(r)});n.then(function(t){$.isFunction(e)&&e(t)},function(e){$.isFunction(t)&&t(e)});return n.promise()};e["import"]=function(e){this.wrap["import"](e)};e.setNodeVisibility=function(e,t){var r=this;r.state=TC.Layer.state.LOADING;r.map.$events.trigger($.Event(TC.Consts.event.BEFOREUPDATE));r.map.$events.trigger($.Event(TC.Consts.event.BEFORELAYERUPDATE,{layer:r}));r.tree||(r.tree=r.getTree());var n=r.findNode(e,r.tree);if(n===r.tree)r.setVisibility(t);else{var i=r._cache.visibilityStates;i[e]=t?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;var a,s,o=!1;for(a=0;a<r.features.length;a++){s=r.features[a];if(s.id==e){o=!0;s.setVisibility(t);break}}if(!o)for(a=0;a<r.features.length;a++){s=r.features[a];void 0===s._path&&(s._path="/"+s.getPath().join("/"));s._path===e&&s.setVisibility(t)}}r.state=TC.Layer.state.IDLE;r.map.$events.trigger($.Event(TC.Consts.event.LAYERUPDATE,{layer:r}));r.map.$events.trigger($.Event(TC.Consts.event.UPDATE))};e.getNodeVisibility=function(e){var t=this,r=TC.Layer.prototype.getNodeVisibility.call(t,e);t.tree||(t.tree=t.getTree());var n=t.findNode(e,t.tree);if(n===t.tree)r=t.getVisibility()?TC.Consts.visibility.VISIBLE:TC.Consts.visibility.NOT_VISIBLE;else{var i=t._cache.visibilityStates,a=i[e];void 0!==a&&(r=a)}return r};e.setModifiable=function(e){this.wrap.setModifiable(e)};e.applyEdits=function(e,t,r){return this.wrap.sendTransaction(e,t,r)};e.refresh=function(){return this.wrap.reloadSource()}}();var WFSCapabilities=function(){var e={V1_0_0:"1.0.0",V1_1_0:"1.1.0",V2_0_0:"2.0.0"},t=function(){var t,s=[],o=[],l=[],c=xml2json(arguments[0]);switch(c.version){case e.V1_0_0:t=e.V1_0_0;break;case e.V1_1_0:t=e.V1_1_0;break;case e.V2_0_0:t=e.V2_0_0}s=r(c,t),o=n(c,t),l=i(c,t);var u=a(c,t),p={Operations:s,FeatureTypes:o,Filters:l};return $.extend(p,u),p},r=function(t,r){switch(r){case e.V1_0_0:var n=t.Capability.Request;if(n.GetFeature){var i=[];for(var a in n.GetFeature.ResultFormat)i.push(a.toLowerCase());n.GetFeature.outputFormat=i,delete n.GetFeature.ResultFormat,n.GetFeature.Operations=t.FeatureTypeList.Operations}return n;case e.V1_1_0:return{};case e.V2_0_0:var s={};for(var a in t.OperationsMetadata){var o={};o[a]=t.OperationsMetadata[a];for(var l in o[a])o[a][l]&&o[a][l].hasOwnProperty("AllowedValues")&&(o[a][l]=o[a][l].AllowedValues.Value);$.extend(s,o)}return s}return null},n=function(t,r){switch(r){case e.V1_0_0:for(var n={},i=0;i<t.FeatureTypeList.FeatureType.length;i++){var a=t.FeatureTypeList.FeatureType[i].Name;n[a.substring(a.indexOf(":")+1)]=t.FeatureTypeList.FeatureType[i]}return n;case e.V1_1_0:return{};case e.V2_0_0:for(var n={},i=0;i<t.FeatureTypeList.FeatureType.length;i++){var a=t.FeatureTypeList.FeatureType[i].Name;n[a.substring(a.indexOf(":")+1)]=t.FeatureTypeList.FeatureType[i]}return n}return null},i=function(t,r){switch(r){case e.V1_0_0:return t.Filter_Capabilities;case e.V1_1_0:return{};case e.V2_0_0:var n=t.Filter_Capabilities;return n}return null},a=function(t,r){switch(r){case e.V1_0_0:var n={};for(var i in t)"string"==typeof t[i]&&(n[i]=t[i]);return n;case e.V1_1_0:return{};case e.V2_0_0:var n={};for(var i in t)"string"==typeof t[i]&&(n[i]=t[i]);return n}return{}},s=function(e){var e=e,t=$.Deferred(),r=e.substring(e.indexOf("://")<0?0:e.indexOf("://")+3);if(TC.capabilities[r])return t.resolve(TC.capabilities[r]),t;var n={};return n.SERVICE="WFS",n.VERSION="2.0.0",n.REQUEST="GetCapabilities",$.ajax({url:TC.proxify(e)+"?"+$.param(n),type:"GET"}).then(function(){var e=WFSCapabilities.Parse(arguments[0]),n=e.Operations.GetCapabilities.DCP&&e.Operations.GetCapabilities.DCP.HTTP.Get["xlink:href"]||e.Operations.GetCapabilities.DCPType[0].HTTP.Get.onlineResource;TC.capabilities[n]=e,TC.capabilities[r]=e,t.resolve(WFSCapabilities.Parse(arguments[0]))}),t};return{Promises:s,Parse:t}}(),TC=TC||{};TC.Geometry=TC.Geometry||{isPoint:function(e){return $.isArray(e)&&e.length>=2&&"number"==typeof e[0]&&"number"==typeof e[1]},isRing:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isPoint(e[0]))},isRingCollection:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isRing(e[0]))},isMultiRingCollection:function(e){return $.isArray(e)&&(0===e.length||TC.Geometry.isRingCollection(e[0]))},getNearest:function(e,t){return TC.wrap.Geometry.getNearest(e,t)},isInside:function t(e,r){var n=!1;if(TC.Geometry.isPoint(e))if(TC.Geometry.isPoint(r))n=e[0]===r[0]&&e[1]===r[1];else if(TC.Geometry.isRing(r))for(var i=0,a=r.length-1;i<r.length;a=i++){var s=r[i][0],o=r[i][1],l=r[a][0],c=r[a][1],u=o>e[1]!=c>e[1]&&e[0]<(l-s)*(e[1]-o)/(c-o)+s;u&&(n=!n)}else if(TC.Geometry.isRingCollection(r)&&r.length>0){if(t(e,r[0])){for(var p=!1,i=1;i<r.length;i++)if(t(e,r[i])){p=!0;break}p||(n=!0)}}else if(TC.Geometry.isMultiRingCollection(r)&&r.length>0)for(var i=0,h=r.length;h>i;i++)if(t(e,r[i])){n=!0;break}return n}};var SITNA=window.SITNA||{},TC=window.TC||{};TC.isDebug=!1;!function(){if(!window.TC||!window.TC.Cfg){var e,t;if(document.currentScript)t=document.currentScript;else{var r=document.getElementsByTagName("script");t=r[r.length-1]}var e=t.getAttribute("src");TC.apiLocation=e.substr(0,e.lastIndexOf("/")+1);var n=TC.apiLocation+(TC.isDebug?"tcmap.js":"tcmap.min.js"),i=new XMLHttpRequest;i.open("GET",n,!1);i.send(null);var a=document.getElementsByTagName("head")[0],t=document.createElement("script");t.type="text/javascript";t.text=i.responseText;a.appendChild(t)}}();SITNA.Map=function(e,t){var r,n,i=this,a=new TC.Map(e,t);i.addLayer=function(e,t){a.addLayer(e,t)};i.setBaseLayer=function(e,t){a.setBaseLayer(e,t)};i.addMarker=function(e,t){a.addMarker(e,t)};i.zoomToMarkers=function(e){a.zoomToMarkers(e)};i.loaded=function(e){a.loaded(e)};a.loaded(function(){r=new TC.control.Search;r.register(a);r.getLayer().then(function(e){n=e});if(!a.activeControl){var e=a.getControlsByClass("TC.control.FeatureInfo")[0];e&&e.activate()}});i.getQueryableData=function(e,t){var n=r.availableSearchTypes[e];if(n.queryableData)t&&t(n.queryableData);else{var i={request:"GetFeature",service:"WFS",typename:n.featurePrefix+":"+n.featureType,version:n.version,propertyname:(n.dataIdProperty instanceof Array?n.dataIdProperty:[n.dataIdProperty]).concat(n.outputProperties instanceof Array?n.outputProperties:[n.outputProperties]).join(","),outputformat:TC.Consts.format.JSON},a=n.url+"?"+$.param(i);$.ajax({url:a}).done(function(e){n.queryableData=[];if(e.features)for(var i=e.features,a=0;a<i.length;a++){var s=i[a],e={};e.id=[];n.dataIdProperty instanceof Array||(n.dataIdProperty=[n.dataIdProperty]);for(var o=0;o<n.dataIdProperty.length;o++)s.properties.hasOwnProperty(n.dataIdProperty[o])&&e.id.push(s.properties[n.dataIdProperty[o]]);e.id=e.id.join(n.idPropertiesIdentifier?n.idPropertiesIdentifier:"");e.label=[];n.outputProperties instanceof Array||(n.outputProperties=[n.outputProperties]);for(var l=0;l<n.outputProperties.length;l++)s.properties.hasOwnProperty(n.outputProperties[l])&&e.label.push(s.properties[n.outputProperties[l]]);var c=e.label instanceof Array&&e.label.join("").trim().length>0||!(e.label instanceof Array)&&e.label.trim().length>0;e.label=n.outputFormatLabel?n.outputFormatLabel.tcFormat(e.label):e.label.join("-");c&&n.queryableData.push(e)}n.queryableData=n.queryableData.sort(function(e,t){return(n.idPropertiesIdentifier?-1!=e.id.indexOf(n.idPropertiesIdentifier):1)?r.removePunctuation(e.label.split(" ")[0])<r.removePunctuation(t.label.split(" ")[0])?-1:r.removePunctuation(e.label.split(" ")[0])>r.removePunctuation(t.label.split(" ")[0])?1:0:r.removePunctuation(e.label)<r.removePunctuation(t.label)?-1:r.removePunctuation(e.label)>r.removePunctuation(t.label)?1:0});n.queryableData=n.queryableData.filter(function(e,t,r){return 1>t?!0:e.id!==r[t-1].id&&e.label!==r[t-1].label});t&&t(n.queryableData)})}};i.getMunicipalities=function(e){i.getQueryableData(SITNA.Consts.mapSearchType.MUNICIPALITY,e)};i.getUrbanAreas=function(e){i.getQueryableData(SITNA.Consts.mapSearchType.URBAN,e)};i.getCommonwealths=function(e){i.getQueryableData(SITNA.Consts.mapSearchType.COMMONWEALTH,e)};i.getCouncils=function(e){i.getQueryableData(SITNA.Consts.mapSearchType.COUNCIL,e)};i.searchCommonwealth=function(e,t){i.searchTyped(SITNA.Consts.mapSearchType.COMMONWEALTH,e,t)};i.searchCouncil=function(e,t){i.searchTyped(SITNA.Consts.mapSearchType.COUNCIL,e,t)};i.searchUrbanArea=function(e,t){i.searchTyped(SITNA.Consts.mapSearchType.URBAN,e,t)};i.searchMunicipality=function(e,t){i.searchTyped(SITNA.Consts.mapSearchType.MUNICIPALITY,e,t)};i.searchTyped=function(e,t,s){var o=TC.getUID(),l=r.availableSearchTypes[e];t instanceof Array&&l.goToIdFormat&&(t=l.goToIdFormat.tcFormat(t));r._search.data=r._search.data||[];r._search.data.push({dataLayer:l.featureType,dataRole:e,id:t,label:"",text:""});i.removeSearch();if(r.availableSearchTypes[e]&&!r.allowedSearchTypes[e]){r.allowedSearchTypes={};r.allowedSearchTypes[e]={};r.availableSearchTypes[e].hasOwnProperty("goTo")||(r.allowedSearchTypes[e]={goTo:function(){var n,s=function(e,t,r){return e[t][r]},c=function(e){var t=[];l.idPropertiesIdentifier&&(e=e.split(l.idPropertiesIdentifier));e instanceof Array||(e=[e]);for(var r=0;r<l.dataIdProperty.length;r++)t.push({name:l.dataIdProperty[r],value:e[r],type:TC.Consts.comparison.EQUAL_TO});return t},u={id:o,type:SITNA.Consts.layerType.WFS,url:l.url,version:l.version,stealth:!0,geometryName:"the_geom",featurePrefix:l.featurePrefix,featureType:l.featureType,properties:c(t),outputFormat:TC.Consts.format.JSON,styles:{polygon:{fillColor:s.bind(self,l.styles[l.featureType],"polygon","fillColor"),fillOpacity:s.bind(self,l.styles[l.featureType],"polygon","fillOpacity")},line:{strokeColor:s.bind(self,l.styles[l.featureType],"line","strokeColor"),strokeOpacity:s.bind(self,l.styles[l.featureType],"line","strokeOpacity"),strokeWidth:s.bind(self,l.styles[l.featureType],"line","strokeWidth")}}};a.addLayer(u).then(function(t){n=t;i.search={layer:t,type:e};delete r.allowedSearchTypes[e]});a.one(TC.Consts.event.FEATURESADD,function(e){if(e.layer==n&&e.layer.features&&e.layer.features.length>0){for(var t=0;t<e.layer.features.length;t++)e.layer.features[t].showsPopup!=r.queryableFeatures&&(e.layer.features[t].showsPopup=r.queryableFeatures);a.zoomToFeatures(e.layer.features)}})}})}a.one(TC.Consts.event.SEARCHQUERYEMPTY,function(e){a.toast(r.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});s&&s(null)});a.one(TC.Consts.event.FEATURESADD,function(t){t.layer==n&&t.layer.features&&t.layer.features.length>0&&a.zoomToFeatures(t.layer.features);i.search={layer:t.layer,type:e};s&&s(t.layer.id!==o?t.layer.id:o)});r.goToResult(t)};i.searchFeature=function(e,t,n,s){var o=TC.getUID(),l=r.featurePrefix;i.removeSearch();e=(e||"").trim();t=(t||"").trim();n=(n||"").trim();if(0==e.length||0==t.length||0==n.length){a.toast(r.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});s&&s(null)}else{if(e.indexOf(":")>-1){l=e.split(":")[0];e=e.split(":")[1]}var c,u={id:o,type:SITNA.Consts.layerType.WFS,url:r.url,version:r.version,stealth:!0,geometryName:"the_geom",featurePrefix:l,featureType:e,maxFeatures:1,properties:r.transformFilter([{name:t,value:n,type:TC.Consts.comparison.EQUAL_TO}]),outputFormat:TC.Consts.format.JSON};a.addLayer(u).then(function(e){c=e;i.search={layer:e,type:SITNA.Consts.mapSearchType.GENERIC}});a.on(TC.Consts.event.FEATURESADD,function(e){if(e.layer==c&&e.layer.features&&e.layer.features.length>0){for(var t=0;t<e.layer.features.length;t++)e.layer.features[t].showsPopup!=r.queryableFeatures&&(e.layer.features[t].showsPopup=r.queryableFeatures);a.zoomToFeatures(e.layer.features)}});a.on(TC.Consts.event.LAYERUPDATE,function(e){e.layer==c&&e.newData&&e.newData.features&&0==e.newData.features.length&&a.toast(r.EMPTY_RESULTS_LABEL,{type:TC.Consts.msgType.INFO,duration:5e3});s&&s(e.layer==c&&e.newData&&e.newData.features&&0==e.newData.features.length?null:o)})}};i.removeSearch=function(e){if(i.search)if(r.availableSearchTypes[i.search.type]&&r.availableSearchTypes[i.search.type].hasOwnProperty("goTo")){for(var t=0;t<i.search.layer.features.length;t++)i.search.layer.removeFeature(i.search.layer.features[t]);i.search=null}else a.removeLayer(i.search.layer).then(function(){i.search=null});e&&e()};i.exportImage=function(){return a.exportImage()};i.search=null};SITNA.Consts=TC.Consts;SITNA.Cfg=TC.Cfg;SITNA.Cfg.layout=TC.apiLocation+"TC/layout/responsive";